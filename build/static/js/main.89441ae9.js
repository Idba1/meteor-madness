/*! For license information please see main.89441ae9.js.LICENSE.txt */
(()=>{var t={579:(t,e,n)=>{"use strict";t.exports=n(1153)},1153:(t,e,n)=>{"use strict";var i=n(5043),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(t,e,n){var i,a={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(u=e.ref),e)o.call(e,i)&&!l.hasOwnProperty(i)&&(a[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps)void 0===a[i]&&(a[i]=e[i]);return{$$typeof:r,type:t,key:c,ref:u,props:a,_owner:s.current}}e.Fragment=a,e.jsx=c,e.jsxs=c},2016:(t,e,n)=>{"use strict";t.exports=n(6958)},2284:(t,e,n)=>{"use strict";function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}n.d(e,{A:()=>i})},2730:(t,e,n)=>{"use strict";var i=n(5043),r=n(7067);function a(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(s[t]=e,t=0;t<e.length;t++)o.add(e[t])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(t,e,n,i,r,a,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){g[t]=new m(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];g[e]=new m(e,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){g[t]=new m(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){g[t]=new m(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){g[t]=new m(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){g[t]=new m(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){g[t]=new m(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){g[t]=new m(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){g[t]=new m(t,5,!1,t.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(t){return t[1].toUpperCase()}function _(t,e,n,i){var r=g.hasOwnProperty(e)?g[e]:null;(null!==r?0!==r.type:i||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,i){if(null===e||"undefined"===typeof e||function(t,e,n,i){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,r,i)&&(n=null),i||null===r?function(t){return!!h.call(f,t)||!h.call(p,t)&&(d.test(t)?f[t]=!0:(p[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=null===n?3!==r.type&&"":n:(e=r.attributeName,i=r.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(y,v);g[e]=new m(e,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(y,v);g[e]=new m(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(y,v);g[e]=new m(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!0,!0)});var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),E=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function N(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=D&&t[D]||t["@@iterator"])?t:null}var z,F=Object.assign;function O(t){if(void 0===z)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);z=e&&e[1]||""}return"\n"+z+t}var B=!1;function U(t,e){if(!t||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?O(t):""}function j(t){switch(t.tag){case 5:return O(t.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return t=U(t.type,!1);case 11:return t=U(t.type.render,!1);case 1:return t=U(t.type,!0);default:return""}}function V(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case S:return"Fragment";case w:return"Portal";case T:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case E:return(t.displayName||"Context")+".Consumer";case A:return(t._context.displayName||"Context")+".Provider";case C:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case L:return null!==(e=t.displayName||null)?e:V(t.type)||"Memo";case k:e=t._payload,t=t._init;try{return V(t(e))}catch(n){}}return null}function H(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(e);case 8:return e===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function G(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function W(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function q(t){t._valueTracker||(t._valueTracker=function(t){var e=W(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){i=""+t,a.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function Z(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=W(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function X(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Y(t,e){var n=e.checked;return F({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function K(t,e){var n=null==e.defaultValue?"":e.defaultValue,i=null!=e.checked?e.checked:e.defaultChecked;n=G(null!=e.value?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function J(t,e){null!=(e=e.checked)&&_(t,"checked",e,!1)}function $(t,e){J(t,e);var n=G(e.value),i=e.type;if(null!=n)"number"===i?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===i||"reset"===i)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,G(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function Q(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!("submit"!==i&&"reset"!==i||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&X(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+G(n),e=null,r=0;r<t.length;r++){if(t[r].value===n)return t[r].selected=!0,void(i&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function it(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(a(91));return F({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rt(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(a(92));if(et(n)){if(1<n.length)throw Error(a(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:G(n)}}function at(t,e){var n=G(e.value),i=G(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=i&&(t.defaultValue=""+i)}function ot(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function st(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?st(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,ut,ht=(ut=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,i){MSApp.execUnsafeLocalFunction(function(){return ut(t,e)})}:ut);function dt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var pt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ft=["Webkit","ms","Moz","O"];function mt(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||pt.hasOwnProperty(t)&&pt[t]?(""+e).trim():e+"px"}function gt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=mt(n,e[n],i);"float"===n&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}Object.keys(pt).forEach(function(t){ft.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pt[e]=pt[t]})});var yt=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vt(t,e){if(e){if(yt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(a(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(a(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(a(62))}}function _t(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bt=null;function xt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var wt=null,St=null,Mt=null;function Tt(t){if(t=_r(t)){if("function"!==typeof wt)throw Error(a(280));var e=t.stateNode;e&&(e=xr(e),wt(t.stateNode,t.type,e))}}function At(t){St?Mt?Mt.push(t):Mt=[t]:St=t}function Et(){if(St){var t=St,e=Mt;if(Mt=St=null,Tt(t),e)for(t=0;t<e.length;t++)Tt(e[t])}}function Ct(t,e){return t(e)}function Pt(){}var It=!1;function Lt(t,e,n){if(It)return t(e,n);It=!0;try{return Ct(t,e,n)}finally{It=!1,(null!==St||null!==Mt)&&(Pt(),Et())}}function kt(t,e){var n=t.stateNode;if(null===n)return null;var i=xr(n);if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(a(231,e,typeof n));return n}var Rt=!1;if(u)try{var Dt={};Object.defineProperty(Dt,"passive",{get:function(){Rt=!0}}),window.addEventListener("test",Dt,Dt),window.removeEventListener("test",Dt,Dt)}catch(ut){Rt=!1}function Nt(t,e,n,i,r,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var zt=!1,Ft=null,Ot=!1,Bt=null,Ut={onError:function(t){zt=!0,Ft=t}};function jt(t,e,n,i,r,a,o,s,l){zt=!1,Ft=null,Nt.apply(Ut,arguments)}function Vt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Ht(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function Gt(t){if(Vt(t)!==t)throw Error(a(188))}function Wt(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=Vt(t)))throw Error(a(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Gt(r),t;if(o===i)return Gt(r),e;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?t:e}(t))?qt(t):null}function qt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=qt(t);if(null!==e)return e;t=t.sibling}return null}var Zt=r.unstable_scheduleCallback,Xt=r.unstable_cancelCallback,Yt=r.unstable_shouldYield,Kt=r.unstable_requestPaint,Jt=r.unstable_now,$t=r.unstable_getCurrentPriorityLevel,Qt=r.unstable_ImmediatePriority,te=r.unstable_UserBlockingPriority,ee=r.unstable_NormalPriority,ne=r.unstable_LowPriority,ie=r.unstable_IdlePriority,re=null,ae=null;var oe=Math.clz32?Math.clz32:function(t){return t>>>=0,0===t?32:31-(se(t)/le|0)|0},se=Math.log,le=Math.LN2;var ce=64,ue=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=he(s):0!==(a&=o)&&(i=he(a))}else 0!==(o=n&~r)?i=he(o):0!==a&&(i=he(a));if(0===i)return 0;if(0!==e&&e!==i&&0===(e&r)&&((r=i&-i)>=(a=e&-e)||16===r&&0!==(4194240&a)))return e;if(0!==(4&i)&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-oe(e)),i|=t[n],e&=~r;return i}function pe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function fe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function me(){var t=ce;return 0===(4194240&(ce<<=1))&&(ce=64),t}function ge(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ye(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-oe(e)]=n}function ve(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-oe(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var _e=0;function be(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var xe,we,Se,Me,Te,Ae=!1,Ee=[],Ce=null,Pe=null,Ie=null,Le=new Map,ke=new Map,Re=[],De="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ne(t,e){switch(t){case"focusin":case"focusout":Ce=null;break;case"dragenter":case"dragleave":Pe=null;break;case"mouseover":case"mouseout":Ie=null;break;case"pointerover":case"pointerout":Le.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ke.delete(e.pointerId)}}function ze(t,e,n,i,r,a){return null===t||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==e&&(null!==(e=_r(e))&&we(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function Fe(t){var e=vr(t.target);if(null!==e){var n=Vt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Ht(n)))return t.blockedOn=e,void Te(t.priority,function(){Se(n)})}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function Oe(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ye(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=_r(n))&&we(e),t.blockedOn=n,!1;var i=new(n=t.nativeEvent).constructor(n.type,n);bt=i,n.target.dispatchEvent(i),bt=null,e.shift()}return!0}function Be(t,e,n){Oe(t)&&n.delete(e)}function Ue(){Ae=!1,null!==Ce&&Oe(Ce)&&(Ce=null),null!==Pe&&Oe(Pe)&&(Pe=null),null!==Ie&&Oe(Ie)&&(Ie=null),Le.forEach(Be),ke.forEach(Be)}function je(t,e){t.blockedOn===e&&(t.blockedOn=null,Ae||(Ae=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ue)))}function Ve(t){function e(e){return je(e,t)}if(0<Ee.length){je(Ee[0],t);for(var n=1;n<Ee.length;n++){var i=Ee[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==Ce&&je(Ce,t),null!==Pe&&je(Pe,t),null!==Ie&&je(Ie,t),Le.forEach(e),ke.forEach(e),n=0;n<Re.length;n++)(i=Re[n]).blockedOn===t&&(i.blockedOn=null);for(;0<Re.length&&null===(n=Re[0]).blockedOn;)Fe(n),null===n.blockedOn&&Re.shift()}var He=b.ReactCurrentBatchConfig,Ge=!0;function We(t,e,n,i){var r=_e,a=He.transition;He.transition=null;try{_e=1,Ze(t,e,n,i)}finally{_e=r,He.transition=a}}function qe(t,e,n,i){var r=_e,a=He.transition;He.transition=null;try{_e=4,Ze(t,e,n,i)}finally{_e=r,He.transition=a}}function Ze(t,e,n,i){if(Ge){var r=Ye(t,e,n,i);if(null===r)Gi(t,e,i,Xe,n),Ne(t,i);else if(function(t,e,n,i,r){switch(e){case"focusin":return Ce=ze(Ce,t,e,n,i,r),!0;case"dragenter":return Pe=ze(Pe,t,e,n,i,r),!0;case"mouseover":return Ie=ze(Ie,t,e,n,i,r),!0;case"pointerover":var a=r.pointerId;return Le.set(a,ze(Le.get(a)||null,t,e,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,ke.set(a,ze(ke.get(a)||null,t,e,n,i,r)),!0}return!1}(r,t,e,n,i))i.stopPropagation();else if(Ne(t,i),4&e&&-1<De.indexOf(t)){for(;null!==r;){var a=_r(r);if(null!==a&&xe(a),null===(a=Ye(t,e,n,i))&&Gi(t,e,i,Xe,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Gi(t,e,i,null,n)}}var Xe=null;function Ye(t,e,n,i){if(Xe=null,null!==(t=vr(t=xt(i))))if(null===(e=Vt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=Ht(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Xe=t,null}function Ke(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($t()){case Qt:return 1;case te:return 4;case ee:case ne:return 16;case ie:return 536870912;default:return 16}default:return 16}}var Je=null,$e=null,Qe=null;function tn(){if(Qe)return Qe;var t,e,n=$e,i=n.length,r="value"in Je?Je.value:Je.textContent,a=r.length;for(t=0;t<i&&n[t]===r[t];t++);var o=i-t;for(e=1;e<=o&&n[i-e]===r[a-e];e++);return Qe=r.slice(t,1<e?1-e:void 0)}function en(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function nn(){return!0}function rn(){return!1}function an(t){function e(e,n,i,r,a){for(var o in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),e}var on,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),hn=F({},cn,{view:0,detail:0}),dn=an(hn),pn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ln&&(ln&&"mousemove"===t.type?(on=t.screenX-ln.screenX,sn=t.screenY-ln.screenY):sn=on=0,ln=t),on)},movementY:function(t){return"movementY"in t?t.movementY:sn}}),fn=an(pn),mn=an(F({},pn,{dataTransfer:0})),gn=an(F({},hn,{relatedTarget:0})),yn=an(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=F({},cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),_n=an(vn),bn=an(F({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Sn[t])&&!!e[t]}function Tn(){return Mn}var An=F({},hn,{key:function(t){if(t.key){var e=xn[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=en(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?wn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(t){return"keypress"===t.type?en(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?en(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),En=an(An),Cn=an(F({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=an(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),In=an(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ln=F({},pn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kn=an(Ln),Rn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,Nn=null;u&&"documentMode"in document&&(Nn=document.documentMode);var zn=u&&"TextEvent"in window&&!Nn,Fn=u&&(!Dn||Nn&&8<Nn&&11>=Nn),On=String.fromCharCode(32),Bn=!1;function Un(t,e){switch(t){case"keyup":return-1!==Rn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Vn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Hn[t.type]:"textarea"===e}function Wn(t,e,n,i){At(i),0<(e=qi(e,"onChange")).length&&(n=new un("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var qn=null,Zn=null;function Xn(t){Oi(t,0)}function Yn(t){if(Z(br(t)))return t}function Kn(t,e){if("change"===t)return e}var Jn=!1;if(u){var $n;if(u){var Qn="oninput"in document;if(!Qn){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),Qn="function"===typeof ti.oninput}$n=Qn}else $n=!1;Jn=$n&&(!document.documentMode||9<document.documentMode)}function ei(){qn&&(qn.detachEvent("onpropertychange",ni),Zn=qn=null)}function ni(t){if("value"===t.propertyName&&Yn(Zn)){var e=[];Wn(e,Zn,t,xt(t)),Lt(Xn,e)}}function ii(t,e,n){"focusin"===t?(ei(),Zn=n,(qn=e).attachEvent("onpropertychange",ni)):"focusout"===t&&ei()}function ri(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Yn(Zn)}function ai(t,e){if("click"===t)return Yn(e)}function oi(t,e){if("input"===t||"change"===t)return Yn(e)}var si="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function li(t,e){if(si(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(e,r)||!si(t[r],e[r]))return!1}return!0}function ci(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ui(t,e){var n,i=ci(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=ci(i)}}function hi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function di(){for(var t=window,e=X();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(i){n=!1}if(!n)break;e=X((t=e.contentWindow).document)}return e}function pi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function fi(t){var e=di(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(e=i.start,void 0===(t=i.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!t.extend&&a>i&&(r=i,i=a,a=r),r=ui(n,a);var o=ui(n,i);r&&o&&(1!==t.rangeCount||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&((e=e.createRange()).setStart(r.node,r.offset),t.removeAllRanges(),a>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,yi=null,vi=null,_i=!1;function bi(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==gi||gi!==X(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=qi(yi,"onSelect")).length&&(e=new un("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=gi)))}function xi(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var wi={animationend:xi("Animation","AnimationEnd"),animationiteration:xi("Animation","AnimationIteration"),animationstart:xi("Animation","AnimationStart"),transitionend:xi("Transition","TransitionEnd")},Si={},Mi={};function Ti(t){if(Si[t])return Si[t];if(!wi[t])return t;var e,n=wi[t];for(e in n)if(n.hasOwnProperty(e)&&e in Mi)return Si[t]=n[e];return t}u&&(Mi=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ai=Ti("animationend"),Ei=Ti("animationiteration"),Ci=Ti("animationstart"),Pi=Ti("transitionend"),Ii=new Map,Li="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ki(t,e){Ii.set(t,e),l(e,[t])}for(var Ri=0;Ri<Li.length;Ri++){var Di=Li[Ri];ki(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}ki(Ai,"onAnimationEnd"),ki(Ei,"onAnimationIteration"),ki(Ci,"onAnimationStart"),ki("dblclick","onDoubleClick"),ki("focusin","onFocus"),ki("focusout","onBlur"),ki(Pi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ni="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ni));function Fi(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,i,r,o,s,l,c){if(jt.apply(this,arguments),zt){if(!zt)throw Error(a(198));var u=Ft;zt=!1,Ft=null,Ot||(Ot=!0,Bt=u)}}(i,e,void 0,t),t.currentTarget=null}function Oi(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;t:{var a=void 0;if(e)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break t;Fi(r,s,c),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break t;Fi(r,s,c),a=l}}}if(Ot)throw t=Bt,Ot=!1,Bt=null,t}function Bi(t,e){var n=e[mr];void 0===n&&(n=e[mr]=new Set);var i=t+"__bubble";n.has(i)||(Hi(e,t,2,!1),n.add(i))}function Ui(t,e,n){var i=0;e&&(i|=4),Hi(n,t,i,e)}var ji="_reactListening"+Math.random().toString(36).slice(2);function Vi(t){if(!t[ji]){t[ji]=!0,o.forEach(function(e){"selectionchange"!==e&&(zi.has(e)||Ui(e,!1,t),Ui(e,!0,t))});var e=9===t.nodeType?t:t.ownerDocument;null===e||e[ji]||(e[ji]=!0,Ui("selectionchange",!1,e))}}function Hi(t,e,n,i){switch(Ke(e)){case 1:var r=We;break;case 4:r=qe;break;default:r=Ze}n=r.bind(null,e,n,t),r=void 0,!Rt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),i?void 0!==r?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):void 0!==r?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Gi(t,e,n,i,r){var a=i;if(0===(1&e)&&0===(2&e)&&null!==i)t:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=vr(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue t}s=s.parentNode}}i=i.return}Lt(function(){var i=a,r=xt(n),o=[];t:{var s=Ii.get(t);if(void 0!==s){var l=un,c=t;switch(t){case"keypress":if(0===en(n))break t;case"keydown":case"keyup":l=En;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ai:case Ei:case Ci:l=yn;break;case Pi:l=In;break;case"scroll":l=dn;break;case"wheel":l=kn;break;case"copy":case"cut":case"paste":l=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var u=0!==(4&e),h=!u&&"scroll"===t,d=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=kt(f,d))&&u.push(Wi(f,m,p)))),h)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,r),o.push({event:s,listeners:u}))}}if(0===(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(s="mouseover"===t||"pointerover"===t)||n===bt||!(c=n.relatedTarget||n.fromElement)||!vr(c)&&!c[fr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?vr(c):null)&&(c!==(h=Vt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(u=Cn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?s:br(l),p=null==c?s:br(c),(s=new u(m,f+"leave",l,n,r)).target=h,s.relatedTarget=p,m=null,vr(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)t:{for(d=c,f=0,p=u=l;p;p=Zi(p))f++;for(p=0,m=d;m;m=Zi(m))p++;for(;0<f-p;)u=Zi(u),f--;for(;0<p-f;)d=Zi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break t;u=Zi(u),d=Zi(d)}u=null}else u=null;null!==l&&Xi(o,s,l,u,!1),null!==c&&null!==h&&Xi(o,h,c,u,!0)}if("select"===(l=(s=i?br(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Kn;else if(Gn(s))if(Jn)g=oi;else{g=ri;var y=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ai);switch(g&&(g=g(t,i))?Wn(o,g,n,r):(y&&y(t,s,i),"focusout"===t&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&tt(s,"number",s.value)),y=i?br(i):window,t){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(gi=y,yi=i,vi=null);break;case"focusout":vi=yi=gi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,bi(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":bi(o,n,r)}var v;if(Dn)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else Vn?Un(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Vn&&(v=tn()):($e="value"in(Je=r)?Je.value:Je.textContent,Vn=!0)),0<(y=qi(i,_)).length&&(_=new bn(_,t,null,n,r),o.push({event:_,listeners:y}),v?_.data=v:null!==(v=jn(n))&&(_.data=v))),(v=zn?function(t,e){switch(t){case"compositionend":return jn(e);case"keypress":return 32!==e.which?null:(Bn=!0,On);case"textInput":return(t=e.data)===On&&Bn?null:t;default:return null}}(t,n):function(t,e){if(Vn)return"compositionend"===t||!Dn&&Un(t,e)?(t=tn(),Qe=$e=Je=null,Vn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Fn&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(i=qi(i,"onBeforeInput")).length&&(r=new bn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=v))}Oi(o,e)})}function Wi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function qi(t,e){for(var n=e+"Capture",i=[];null!==t;){var r=t,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=kt(t,n))&&i.unshift(Wi(t,a,r)),null!=(a=kt(t,e))&&i.push(Wi(t,a,r))),t=t.return}return i}function Zi(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Xi(t,e,n,i,r){for(var a=e._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=kt(n,a))&&o.unshift(Wi(n,l,s)):r||null!=(l=kt(n,a))&&o.push(Wi(n,l,s))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}var Yi=/\r\n?/g,Ki=/\u0000|\uFFFD/g;function Ji(t){return("string"===typeof t?t:""+t).replace(Yi,"\n").replace(Ki,"")}function $i(t,e,n){if(e=Ji(e),Ji(t)!==e&&n)throw Error(a(425))}function Qi(){}var tr=null,er=null;function nr(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(t){return ar.resolve(null).then(t).catch(sr)}:ir;function sr(t){setTimeout(function(){throw t})}function lr(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return t.removeChild(r),void Ve(e);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ve(e)}function cr(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function ur(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,yr="__reactHandles$"+hr;function vr(t){var e=t[dr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fr]||n[dr]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=ur(t);null!==t;){if(n=t[dr])return n;t=ur(t)}return e}n=(t=n).parentNode}return null}function _r(t){return!(t=t[dr]||t[fr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function br(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(a(33))}function xr(t){return t[pr]||null}var wr=[],Sr=-1;function Mr(t){return{current:t}}function Tr(t){0>Sr||(t.current=wr[Sr],wr[Sr]=null,Sr--)}function Ar(t,e){Sr++,wr[Sr]=t.current,t.current=e}var Er={},Cr=Mr(Er),Pr=Mr(!1),Ir=Er;function Lr(t,e){var n=t.type.contextTypes;if(!n)return Er;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function kr(t){return null!==(t=t.childContextTypes)&&void 0!==t}function Rr(){Tr(Pr),Tr(Cr)}function Dr(t,e,n){if(Cr.current!==Er)throw Error(a(168));Ar(Cr,e),Ar(Pr,n)}function Nr(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(a(108,H(t)||"Unknown",r));return F({},n,i)}function zr(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Er,Ir=Cr.current,Ar(Cr,t),Ar(Pr,Pr.current),!0}function Fr(t,e,n){var i=t.stateNode;if(!i)throw Error(a(169));n?(t=Nr(t,e,Ir),i.__reactInternalMemoizedMergedChildContext=t,Tr(Pr),Tr(Cr),Ar(Cr,t)):Tr(Pr),Ar(Pr,n)}var Or=null,Br=!1,Ur=!1;function jr(t){null===Or?Or=[t]:Or.push(t)}function Vr(){if(!Ur&&null!==Or){Ur=!0;var t=0,e=_e;try{var n=Or;for(_e=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}Or=null,Br=!1}catch(r){throw null!==Or&&(Or=Or.slice(t+1)),Zt(Qt,Vr),r}finally{_e=e,Ur=!1}}return null}var Hr=[],Gr=0,Wr=null,qr=0,Zr=[],Xr=0,Yr=null,Kr=1,Jr="";function $r(t,e){Hr[Gr++]=qr,Hr[Gr++]=Wr,Wr=t,qr=e}function Qr(t,e,n){Zr[Xr++]=Kr,Zr[Xr++]=Jr,Zr[Xr++]=Yr,Yr=t;var i=Kr;t=Jr;var r=32-oe(i)-1;i&=~(1<<r),n+=1;var a=32-oe(e)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Kr=1<<32-oe(e)+r|n<<r|i,Jr=a+t}else Kr=1<<a|n<<r|i,Jr=t}function ta(t){null!==t.return&&($r(t,1),Qr(t,1,0))}function ea(t){for(;t===Wr;)Wr=Hr[--Gr],Hr[Gr]=null,qr=Hr[--Gr],Hr[Gr]=null;for(;t===Yr;)Yr=Zr[--Xr],Zr[Xr]=null,Jr=Zr[--Xr],Zr[Xr]=null,Kr=Zr[--Xr],Zr[Xr]=null}var na=null,ia=null,ra=!1,aa=null;function oa(t,e){var n=Lc(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function sa(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,na=t,ia=cr(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,na=t,ia=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Yr?{id:Kr,overflow:Jr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=Lc(18,null,null,0)).stateNode=e,n.return=t,t.child=n,na=t,ia=null,!0);default:return!1}}function la(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function ca(t){if(ra){var e=ia;if(e){var n=e;if(!sa(t,e)){if(la(t))throw Error(a(418));e=cr(n.nextSibling);var i=na;e&&sa(t,e)?oa(i,n):(t.flags=-4097&t.flags|2,ra=!1,na=t)}}else{if(la(t))throw Error(a(418));t.flags=-4097&t.flags|2,ra=!1,na=t}}}function ua(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;na=t}function ha(t){if(t!==na)return!1;if(!ra)return ua(t),ra=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!nr(t.type,t.memoizedProps)),e&&(e=ia)){if(la(t))throw da(),Error(a(418));for(;e;)oa(t,e),e=cr(e.nextSibling)}if(ua(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(a(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){ia=cr(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}ia=null}}else ia=na?cr(t.stateNode.nextSibling):null;return!0}function da(){for(var t=ia;t;)t=cr(t.nextSibling)}function pa(){ia=na=null,ra=!1}function fa(t){null===aa?aa=[t]:aa.push(t)}var ma=b.ReactCurrentBatchConfig;function ga(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,t));var r=i,o=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===o?e.ref:(e=function(t){var e=r.refs;null===t?delete e[o]:e[o]=t},e._stringRef=o,e)}if("string"!==typeof t)throw Error(a(284));if(!n._owner)throw Error(a(290,t))}return t}function ya(t,e){throw t=Object.prototype.toString.call(e),Error(a(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function va(t){return(0,t._init)(t._payload)}function _a(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=Rc(t,e)).index=0,t.sibling=null,t}function o(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function s(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,n,i){return null===e||6!==e.tag?((e=Fc(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function c(t,e,n,i){var a=n.type;return a===S?h(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===k&&va(a)===e.type)?((i=r(e,n.props)).ref=ga(t,e,n),i.return=t,i):((i=Dc(n.type,n.key,n.props,null,t.mode,i)).ref=ga(t,e,n),i.return=t,i)}function u(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Oc(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function h(t,e,n,i,a){return null===e||7!==e.tag?((e=Nc(n,t.mode,i,a)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Fc(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case x:return(n=Dc(e.type,e.key,e.props,null,t.mode,n)).ref=ga(t,null,e),n.return=t,n;case w:return(e=Oc(e,t.mode,n)).return=t,e;case k:return d(t,(0,e._init)(e._payload),n)}if(et(e)||N(e))return(e=Nc(e,t.mode,n,null)).return=t,e;ya(t,e)}return null}function p(t,e,n,i){var r=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===r?c(t,e,n,i):null;case w:return n.key===r?u(t,e,n,i):null;case k:return p(t,e,(r=n._init)(n._payload),i)}if(et(n)||N(n))return null!==r?null:h(t,e,n,i,null);ya(t,n)}return null}function f(t,e,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(e,t=t.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case x:return c(e,t=t.get(null===i.key?n:i.key)||null,i,r);case w:return u(e,t=t.get(null===i.key?n:i.key)||null,i,r);case k:return f(t,e,n,(0,i._init)(i._payload),r)}if(et(i)||N(i))return h(e,t=t.get(n)||null,i,r,null);ya(e,i)}return null}function m(r,a,s,l){for(var c=null,u=null,h=a,m=a=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(r,h,s[m],l);if(null===y){null===h&&(h=g);break}t&&h&&null===y.alternate&&e(r,h),a=o(y,a,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===s.length)return n(r,h),ra&&$r(r,m),c;if(null===h){for(;m<s.length;m++)null!==(h=d(r,s[m],l))&&(a=o(h,a,m),null===u?c=h:u.sibling=h,u=h);return ra&&$r(r,m),c}for(h=i(r,h);m<s.length;m++)null!==(g=f(h,r,m,s[m],l))&&(t&&null!==g.alternate&&h.delete(null===g.key?m:g.key),a=o(g,a,m),null===u?c=g:u.sibling=g,u=g);return t&&h.forEach(function(t){return e(r,t)}),ra&&$r(r,m),c}function g(r,s,l,c){var u=N(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,m=s,g=s=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var _=p(r,m,v.value,c);if(null===_){null===m&&(m=y);break}t&&m&&null===_.alternate&&e(r,m),s=o(_,s,g),null===h?u=_:h.sibling=_,h=_,m=y}if(v.done)return n(r,m),ra&&$r(r,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(r,v.value,c))&&(s=o(v,s,g),null===h?u=v:h.sibling=v,h=v);return ra&&$r(r,g),u}for(m=i(r,m);!v.done;g++,v=l.next())null!==(v=f(m,r,g,v.value,c))&&(t&&null!==v.alternate&&m.delete(null===v.key?g:v.key),s=o(v,s,g),null===h?u=v:h.sibling=v,h=v);return t&&m.forEach(function(t){return e(r,t)}),ra&&$r(r,g),u}return function t(i,a,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case x:t:{for(var c=o.key,u=a;null!==u;){if(u.key===c){if((c=o.type)===S){if(7===u.tag){n(i,u.sibling),(a=r(u,o.props.children)).return=i,i=a;break t}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===k&&va(c)===u.type){n(i,u.sibling),(a=r(u,o.props)).ref=ga(i,u,o),a.return=i,i=a;break t}n(i,u);break}e(i,u),u=u.sibling}o.type===S?((a=Nc(o.props.children,i.mode,l,o.key)).return=i,i=a):((l=Dc(o.type,o.key,o.props,null,i.mode,l)).ref=ga(i,a,o),l.return=i,i=l)}return s(i);case w:t:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break t}n(i,a);break}e(i,a),a=a.sibling}(a=Oc(o,i.mode,l)).return=i,i=a}return s(i);case k:return t(i,a,(u=o._init)(o._payload),l)}if(et(o))return m(i,a,o,l);if(N(o))return g(i,a,o,l);ya(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=Fc(o,i.mode,l)).return=i,i=a),s(i)):n(i,a)}}var ba=_a(!0),xa=_a(!1),wa=Mr(null),Sa=null,Ma=null,Ta=null;function Aa(){Ta=Ma=Sa=null}function Ea(t){var e=wa.current;Tr(wa),t._currentValue=e}function Ca(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Pa(t,e){Sa=t,Ta=Ma=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(_s=!0),t.firstContext=null)}function Ia(t){var e=t._currentValue;if(Ta!==t)if(t={context:t,memoizedValue:e,next:null},null===Ma){if(null===Sa)throw Error(a(308));Ma=t,Sa.dependencies={lanes:0,firstContext:t}}else Ma=Ma.next=t;return e}var La=null;function ka(t){null===La?La=[t]:La.push(t)}function Ra(t,e,n,i){var r=e.interleaved;return null===r?(n.next=n,ka(e)):(n.next=r.next,r.next=n),e.interleaved=n,Da(t,i)}function Da(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}var Na=!1;function za(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fa(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Oa(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ba(t,e,n){var i=t.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Cl)){var r=i.pending;return null===r?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Da(t,n)}return null===(r=i.interleaved)?(e.next=e,ka(i)):(e.next=r.next,r.next=e),i.interleaved=e,Da(t,n)}function Ua(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ve(t,n)}}function ja(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=e:a=a.next=e}else r=a=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Va(t,e,n,i){var r=t.updateQueue;Na=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=t.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var h=r.baseState;for(o=0,u=c=l=null,s=a;;){var d=s.lane,p=s.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});t:{var f=t,m=s;switch(d=e,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break t}h=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break t;h=F({},h,d);break t;case 2:Na=!0}}null!==s.callback&&0!==s.lane&&(t.flags|=64,null===(d=r.effects)?r.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,o|=d;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(d=s).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(e=r.shared.interleaved)){r=e;do{o|=r.lane,r=r.next}while(r!==e)}else null===a&&(r.shared.lanes=0);zl|=o,t.lanes=o,t.memoizedState=h}}function Ha(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Ga={},Wa=Mr(Ga),qa=Mr(Ga),Za=Mr(Ga);function Xa(t){if(t===Ga)throw Error(a(174));return t}function Ya(t,e){switch(Ar(Za,e),Ar(qa,t),Ar(Wa,Ga),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}Tr(Wa),Ar(Wa,e)}function Ka(){Tr(Wa),Tr(qa),Tr(Za)}function Ja(t){Xa(Za.current);var e=Xa(Wa.current),n=lt(e,t.type);e!==n&&(Ar(qa,t),Ar(Wa,n))}function $a(t){qa.current===t&&(Tr(Wa),Tr(qa))}var Qa=Mr(0);function to(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var eo=[];function no(){for(var t=0;t<eo.length;t++)eo[t]._workInProgressVersionPrimary=null;eo.length=0}var io=b.ReactCurrentDispatcher,ro=b.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,uo=!1,ho=0,po=0;function fo(){throw Error(a(321))}function mo(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!si(t[n],e[n]))return!1;return!0}function go(t,e,n,i,r,o){if(ao=o,oo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,io.current=null===t||null===t.memoizedState?Qo:ts,t=n(i,r),uo){o=0;do{if(uo=!1,ho=0,25<=o)throw Error(a(301));o+=1,lo=so=null,e.updateQueue=null,io.current=es,t=n(i,r)}while(uo)}if(io.current=$o,e=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,e)throw Error(a(300));return t}function yo(){var t=0!==ho;return ho=0,t}function vo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=t:lo=lo.next=t,lo}function _o(){if(null===so){var t=oo.alternate;t=null!==t?t.memoizedState:null}else t=so.next;var e=null===lo?oo.memoizedState:lo.next;if(null!==e)lo=e,so=t;else{if(null===t)throw Error(a(310));t={memoizedState:(so=t).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=t:lo=lo.next=t}return lo}function bo(t,e){return"function"===typeof e?e(t):e}function xo(t){var e=_o(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var i=so,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=s=null,c=null,u=o;do{var h=u.lane;if((ao&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,s=i):c=c.next=d,oo.lanes|=h,zl|=h}u=u.next}while(null!==u&&u!==o);null===c?s=i:c.next=l,si(i,e.memoizedState)||(_s=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=c,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{o=r.lane,oo.lanes|=o,zl|=o,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function wo(t){var e=_o(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,o=e.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=t(o,s.action),s=s.next}while(s!==r);si(o,e.memoizedState)||(_s=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,i]}function So(){}function Mo(t,e){var n=oo,i=_o(),r=e(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,_s=!0),i=i.queue,zo(Eo.bind(null,n,i,t),[t]),i.getSnapshot!==e||o||null!==lo&&1&lo.memoizedState.tag){if(n.flags|=2048,Lo(9,Ao.bind(null,n,i,r,e),void 0,null),null===Pl)throw Error(a(349));0!==(30&ao)||To(n,e,r)}return r}function To(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=oo.updateQueue)?(e={lastEffect:null,stores:null},oo.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Ao(t,e,n,i){e.value=n,e.getSnapshot=i,Co(e)&&Po(t)}function Eo(t,e,n){return n(function(){Co(e)&&Po(t)})}function Co(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!si(t,n)}catch(i){return!0}}function Po(t){var e=Da(t,1);null!==e&&nc(e,t,1,-1)}function Io(t){var e=vo();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bo,lastRenderedState:t},e.queue=t,t=t.dispatch=Xo.bind(null,oo,t),[e.memoizedState,t]}function Lo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=oo.updateQueue)?(e={lastEffect:null,stores:null},oo.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function ko(){return _o().memoizedState}function Ro(t,e,n,i){var r=vo();oo.flags|=t,r.memoizedState=Lo(1|e,n,void 0,void 0===i?null:i)}function Do(t,e,n,i){var r=_o();i=void 0===i?null:i;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==i&&mo(i,o.deps))return void(r.memoizedState=Lo(e,n,a,i))}oo.flags|=t,r.memoizedState=Lo(1|e,n,a,i)}function No(t,e){return Ro(8390656,8,t,e)}function zo(t,e){return Do(2048,8,t,e)}function Fo(t,e){return Do(4,2,t,e)}function Oo(t,e){return Do(4,4,t,e)}function Bo(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Uo(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Do(4,4,Bo.bind(null,e,t),n)}function jo(){}function Vo(t,e){var n=_o();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&mo(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Ho(t,e){var n=_o();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&mo(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Go(t,e,n){return 0===(21&ao)?(t.baseState&&(t.baseState=!1,_s=!0),t.memoizedState=n):(si(n,e)||(n=me(),oo.lanes|=n,zl|=n,t.baseState=!0),e)}function Wo(t,e){var n=_e;_e=0!==n&&4>n?n:4,t(!0);var i=ro.transition;ro.transition={};try{t(!1),e()}finally{_e=n,ro.transition=i}}function qo(){return _o().memoizedState}function Zo(t,e,n){var i=ec(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Yo(t))Ko(e,n);else if(null!==(n=Ra(t,e,n,i))){nc(n,t,i,tc()),Jo(n,e,i)}}function Xo(t,e,n){var i=ec(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yo(t))Ko(e,r);else{var a=t.alternate;if(0===t.lanes&&(null===a||0===a.lanes)&&null!==(a=e.lastRenderedReducer))try{var o=e.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var l=e.interleaved;return null===l?(r.next=r,ka(e)):(r.next=l.next,l.next=r),void(e.interleaved=r)}}catch(c){}null!==(n=Ra(t,e,r,i))&&(nc(n,t,i,r=tc()),Jo(n,e,i))}}function Yo(t){var e=t.alternate;return t===oo||null!==e&&e===oo}function Ko(t,e){uo=co=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Jo(t,e,n){if(0!==(4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ve(t,n)}}var $o={readContext:Ia,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},Qo={readContext:Ia,useCallback:function(t,e){return vo().memoizedState=[t,void 0===e?null:e],t},useContext:Ia,useEffect:No,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Ro(4194308,4,Bo.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ro(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ro(4,2,t,e)},useMemo:function(t,e){var n=vo();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=vo();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Zo.bind(null,oo,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},vo().memoizedState=t},useState:Io,useDebugValue:jo,useDeferredValue:function(t){return vo().memoizedState=t},useTransition:function(){var t=Io(!1),e=t[0];return t=Wo.bind(null,t[1]),vo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=oo,r=vo();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=e(),null===Pl)throw Error(a(349));0!==(30&ao)||To(i,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,No(Eo.bind(null,i,o,t),[t]),i.flags|=2048,Lo(9,Ao.bind(null,i,o,n,e),void 0,null),n},useId:function(){var t=vo(),e=Pl.identifierPrefix;if(ra){var n=Jr;e=":"+e+"R"+(n=(Kr&~(1<<32-oe(Kr)-1)).toString(32)+n),0<(n=ho++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=po++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ts={readContext:Ia,useCallback:Vo,useContext:Ia,useEffect:zo,useImperativeHandle:Uo,useInsertionEffect:Fo,useLayoutEffect:Oo,useMemo:Ho,useReducer:xo,useRef:ko,useState:function(){return xo(bo)},useDebugValue:jo,useDeferredValue:function(t){return Go(_o(),so.memoizedState,t)},useTransition:function(){return[xo(bo)[0],_o().memoizedState]},useMutableSource:So,useSyncExternalStore:Mo,useId:qo,unstable_isNewReconciler:!1},es={readContext:Ia,useCallback:Vo,useContext:Ia,useEffect:zo,useImperativeHandle:Uo,useInsertionEffect:Fo,useLayoutEffect:Oo,useMemo:Ho,useReducer:wo,useRef:ko,useState:function(){return wo(bo)},useDebugValue:jo,useDeferredValue:function(t){var e=_o();return null===so?e.memoizedState=t:Go(e,so.memoizedState,t)},useTransition:function(){return[wo(bo)[0],_o().memoizedState]},useMutableSource:So,useSyncExternalStore:Mo,useId:qo,unstable_isNewReconciler:!1};function ns(t,e){if(t&&t.defaultProps){for(var n in e=F({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}function is(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:F({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var rs={isMounted:function(t){return!!(t=t._reactInternals)&&Vt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=tc(),r=ec(t),a=Oa(i,r);a.payload=e,void 0!==n&&null!==n&&(a.callback=n),null!==(e=Ba(t,a,r))&&(nc(e,t,r,i),Ua(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=tc(),r=ec(t),a=Oa(i,r);a.tag=1,a.payload=e,void 0!==n&&null!==n&&(a.callback=n),null!==(e=Ba(t,a,r))&&(nc(e,t,r,i),Ua(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=tc(),i=ec(t),r=Oa(n,i);r.tag=2,void 0!==e&&null!==e&&(r.callback=e),null!==(e=Ba(t,r,i))&&(nc(e,t,i,n),Ua(e,t,i))}};function as(t,e,n,i,r,a,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,a,o):!e.prototype||!e.prototype.isPureReactComponent||(!li(n,i)||!li(r,a))}function os(t,e,n){var i=!1,r=Er,a=e.contextType;return"object"===typeof a&&null!==a?a=Ia(a):(r=kr(e)?Ir:Cr.current,a=(i=null!==(i=e.contextTypes)&&void 0!==i)?Lr(t,r):Er),e=new e(n,a),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=rs,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function ss(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&rs.enqueueReplaceState(e,e.state,null)}function ls(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},za(t);var a=e.contextType;"object"===typeof a&&null!==a?r.context=Ia(a):(a=kr(e)?Ir:Cr.current,r.context=Lr(t,a)),r.state=t.memoizedState,"function"===typeof(a=e.getDerivedStateFromProps)&&(is(t,e,a,n),r.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(e=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&rs.enqueueReplaceState(r,r.state,null),Va(t,n,r,i),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4194308)}function cs(t,e){try{var n="",i=e;do{n+=j(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:t,source:e,stack:r,digest:null}}function us(t,e,n){return{value:t,source:null,stack:null!=n?n:null,digest:null!=e?e:null}}function hs(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(t,e,n){(n=Oa(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Gl||(Gl=!0,Wl=i),hs(0,e)},n}function fs(t,e,n){(n=Oa(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"===typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){hs(0,e)}}var a=t.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){hs(0,e),"function"!==typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function ms(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new ds;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Tc.bind(null,t,e,n),e.then(t,t))}function gs(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function ys(t,e,n,i,r){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=Oa(-1,1)).tag=2,Ba(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var vs=b.ReactCurrentOwner,_s=!1;function bs(t,e,n,i){e.child=null===t?xa(e,null,n,i):ba(e,t.child,n,i)}function xs(t,e,n,i,r){n=n.render;var a=e.ref;return Pa(e,r),i=go(t,e,n,i,a,r),n=yo(),null===t||_s?(ra&&n&&ta(e),e.flags|=1,bs(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Gs(t,e,r))}function ws(t,e,n,i,r){if(null===t){var a=n.type;return"function"!==typeof a||kc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Dc(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=a,Ss(t,e,a,i,r))}if(a=t.child,0===(t.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&t.ref===e.ref)return Gs(t,e,r)}return e.flags|=1,(t=Rc(a,i)).ref=e.ref,t.return=e,e.child=t}function Ss(t,e,n,i,r){if(null!==t){var a=t.memoizedProps;if(li(a,i)&&t.ref===e.ref){if(_s=!1,e.pendingProps=i=a,0===(t.lanes&r))return e.lanes=t.lanes,Gs(t,e,r);0!==(131072&t.flags)&&(_s=!0)}}return As(t,e,n,i,r)}function Ms(t,e,n){var i=e.pendingProps,r=i.children,a=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ar(Rl,kl),kl|=n;else{if(0===(1073741824&n))return t=null!==a?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ar(Rl,kl),kl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Ar(Rl,kl),kl|=i}else null!==a?(i=a.baseLanes|n,e.memoizedState=null):i=n,Ar(Rl,kl),kl|=i;return bs(t,e,r,n),e.child}function Ts(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function As(t,e,n,i,r){var a=kr(n)?Ir:Cr.current;return a=Lr(e,a),Pa(e,r),n=go(t,e,n,i,a,r),i=yo(),null===t||_s?(ra&&i&&ta(e),e.flags|=1,bs(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Gs(t,e,r))}function Es(t,e,n,i,r){if(kr(n)){var a=!0;zr(e)}else a=!1;if(Pa(e,r),null===e.stateNode)Hs(t,e),os(e,n,i),ls(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,s=e.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ia(c):c=Lr(e,c=kr(n)?Ir:Cr.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==c)&&ss(e,o,i,c),Na=!1;var d=e.memoizedState;o.state=d,Va(e,i,o,r),l=e.memoizedState,s!==i||d!==l||Pr.current||Na?("function"===typeof u&&(is(e,n,u,i),l=e.memoizedState),(s=Na||as(e,n,s,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4194308)):("function"===typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"===typeof o.componentDidMount&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Fa(t,e),s=e.memoizedProps,c=e.type===e.elementType?s:ns(e.type,s),o.props=c,h=e.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ia(l):l=Lr(e,l=kr(n)?Ir:Cr.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&ss(e,o,i,l),Na=!1,d=e.memoizedState,o.state=d,Va(e,i,o,r);var f=e.memoizedState;s!==h||d!==f||Pr.current||Na?("function"===typeof p&&(is(e,n,p,i),f=e.memoizedState),(c=Na||as(e,n,c,i,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Cs(t,e,n,i,a,r)}function Cs(t,e,n,i,r,a){Ts(t,e);var o=0!==(128&e.flags);if(!i&&!o)return r&&Fr(e,n,!1),Gs(t,e,a);i=e.stateNode,vs.current=e;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=ba(e,t.child,null,a),e.child=ba(e,null,s,a)):bs(t,e,s,a),e.memoizedState=i.state,r&&Fr(e,n,!0),e.child}function Ps(t){var e=t.stateNode;e.pendingContext?Dr(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Dr(0,e.context,!1),Ya(t,e.containerInfo)}function Is(t,e,n,i,r){return pa(),fa(r),e.flags|=256,bs(t,e,n,i),e.child}var Ls,ks,Rs,Ds,Ns={dehydrated:null,treeContext:null,retryLane:0};function zs(t){return{baseLanes:t,cachePool:null,transitions:null}}function Fs(t,e,n){var i,r=e.pendingProps,o=Qa.current,s=!1,l=0!==(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&0!==(2&o)),i?(s=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(o|=1),Ar(Qa,1&o),null===t)return ca(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(l=r.children,t=r.fallback,s?(r=e.mode,s=e.child,l={mode:"hidden",children:l},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=zc(l,r,0,null),t=Nc(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=zs(n),e.memoizedState=Ns,t):Os(e,l));if(null!==(o=t.memoizedState)&&null!==(i=o.dehydrated))return function(t,e,n,i,r,o,s){if(n)return 256&e.flags?(e.flags&=-257,Bs(t,e,s,i=us(Error(a(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(o=i.fallback,r=e.mode,i=zc({mode:"visible",children:i.children},r,0,null),(o=Nc(o,r,s,null)).flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,0!==(1&e.mode)&&ba(e,t.child,null,s),e.child.memoizedState=zs(s),e.memoizedState=Ns,o);if(0===(1&e.mode))return Bs(t,e,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bs(t,e,s,i=us(o=Error(a(419)),i,void 0))}if(l=0!==(s&t.childLanes),_s||l){if(null!==(i=Pl)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Da(t,r),nc(i,t,r,-1))}return mc(),Bs(t,e,s,i=us(Error(a(421))))}return"$?"===r.data?(e.flags|=128,e.child=t.child,e=Ec.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,ia=cr(r.nextSibling),na=e,ra=!0,aa=null,null!==t&&(Zr[Xr++]=Kr,Zr[Xr++]=Jr,Zr[Xr++]=Yr,Kr=t.id,Jr=t.overflow,Yr=e),e=Os(e,i.children),e.flags|=4096,e)}(t,e,l,r,i,o,n);if(s){s=r.fallback,l=e.mode,i=(o=t.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&e.child!==o?((r=e.child).childLanes=0,r.pendingProps=c,e.deletions=null):(r=Rc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Rc(i,s):(s=Nc(s,l,n,null)).flags|=2,s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,l=null===(l=t.child.memoizedState)?zs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=t.childLanes&~n,e.memoizedState=Ns,r}return t=(s=t.child).sibling,r=Rc(s,{mode:"visible",children:r.children}),0===(1&e.mode)&&(r.lanes=n),r.return=e,r.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Os(t,e){return(e=zc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Bs(t,e,n,i){return null!==i&&fa(i),ba(e,t.child,null,n),(t=Os(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Us(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),Ca(t.return,e,n)}function js(t,e,n,i,r){var a=t.memoizedState;null===a?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Vs(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(bs(t,e,i.children,n),0!==(2&(i=Qa.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Us(t,n,e);else if(19===t.tag)Us(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Ar(Qa,i),0===(1&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===to(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),js(e,!1,r,n,a);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===to(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}js(e,!0,n,null,a);break;case"together":js(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Hs(t,e){0===(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gs(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),zl|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(a(153));if(null!==e.child){for(n=Rc(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Rc(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Ws(t,e){if(!ra)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qs(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Zs(t,e,n){var i=e.pendingProps;switch(ea(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(e),null;case 1:case 17:return kr(e.type)&&Rr(),qs(e),null;case 3:return i=e.stateNode,Ka(),Tr(Pr),Tr(Cr),no(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(ha(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==aa&&(oc(aa),aa=null))),ks(t,e),qs(e),null;case 5:$a(e);var r=Xa(Za.current);if(n=e.type,null!==t&&null!=e.stateNode)Rs(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(a(166));return qs(e),null}if(t=Xa(Wa.current),ha(e)){i=e.stateNode,n=e.type;var o=e.memoizedProps;switch(i[dr]=e,i[pr]=o,t=0!==(1&e.mode),n){case"dialog":Bi("cancel",i),Bi("close",i);break;case"iframe":case"object":case"embed":Bi("load",i);break;case"video":case"audio":for(r=0;r<Ni.length;r++)Bi(Ni[r],i);break;case"source":Bi("error",i);break;case"img":case"image":case"link":Bi("error",i),Bi("load",i);break;case"details":Bi("toggle",i);break;case"input":K(i,o),Bi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Bi("invalid",i);break;case"textarea":rt(i,o),Bi("invalid",i)}for(var l in vt(n,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&$i(i.textContent,c,t),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&$i(i.textContent,c,t),r=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bi("scroll",i)}switch(n){case"input":q(i),Q(i,o,!0);break;case"textarea":q(i),ot(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Qi)}i=r,e.updateQueue=i,null!==i&&(e.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=st(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof i.is?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),"select"===n&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[dr]=e,t[pr]=i,Ls(t,e,!1,!1),e.stateNode=t;t:{switch(l=_t(n,i),n){case"dialog":Bi("cancel",t),Bi("close",t),r=i;break;case"iframe":case"object":case"embed":Bi("load",t),r=i;break;case"video":case"audio":for(r=0;r<Ni.length;r++)Bi(Ni[r],t);r=i;break;case"source":Bi("error",t),r=i;break;case"img":case"image":case"link":Bi("error",t),Bi("load",t),r=i;break;case"details":Bi("toggle",t),r=i;break;case"input":K(t,i),r=Y(t,i),Bi("invalid",t);break;case"option":default:r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=F({},i,{value:void 0}),Bi("invalid",t);break;case"textarea":rt(t,i),r=it(t,i),Bi("invalid",t)}for(o in vt(n,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?gt(t,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ht(t,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&dt(t,u):"number"===typeof u&&dt(t,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Bi("scroll",t):null!=u&&_(t,o,u,l))}switch(n){case"input":q(t),Q(t,i,!1);break;case"textarea":q(t),ot(t);break;case"option":null!=i.value&&t.setAttribute("value",""+G(i.value));break;case"select":t.multiple=!!i.multiple,null!=(o=i.value)?nt(t,!!i.multiple,o,!1):null!=i.defaultValue&&nt(t,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(t.onclick=Qi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return qs(e),null;case 6:if(t&&null!=e.stateNode)Ds(t,e,t.memoizedProps,i);else{if("string"!==typeof i&&null===e.stateNode)throw Error(a(166));if(n=Xa(Za.current),Xa(Wa.current),ha(e)){if(i=e.stateNode,n=e.memoizedProps,i[dr]=e,(o=i.nodeValue!==n)&&null!==(t=na))switch(t.tag){case 3:$i(i.nodeValue,n,0!==(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&$i(i.nodeValue,n,0!==(1&t.mode))}o&&(e.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=e,e.stateNode=i}return qs(e),null;case 13:if(Tr(Qa),i=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(ra&&null!==ia&&0!==(1&e.mode)&&0===(128&e.flags))da(),pa(),e.flags|=98560,o=!1;else if(o=ha(e),null!==i&&null!==i.dehydrated){if(null===t){if(!o)throw Error(a(318));if(!(o=null!==(o=e.memoizedState)?o.dehydrated:null))throw Error(a(317));o[dr]=e}else pa(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;qs(e),o=!1}else null!==aa&&(oc(aa),aa=null),o=!0;if(!o)return 65536&e.flags?e:null}return 0!==(128&e.flags)?(e.lanes=n,e):((i=null!==i)!==(null!==t&&null!==t.memoizedState)&&i&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&Qa.current)?0===Dl&&(Dl=3):mc())),null!==e.updateQueue&&(e.flags|=4),qs(e),null);case 4:return Ka(),ks(t,e),null===t&&Vi(e.stateNode.containerInfo),qs(e),null;case 10:return Ea(e.type._context),qs(e),null;case 19:if(Tr(Qa),null===(o=e.memoizedState))return qs(e),null;if(i=0!==(128&e.flags),null===(l=o.rendering))if(i)Ws(o,!1);else{if(0!==Dl||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(l=to(t))){for(e.flags|=128,Ws(o,!1),null!==(i=l.updateQueue)&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;null!==n;)t=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,t=l.dependencies,o.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ar(Qa,1&Qa.current|2),e.child}t=t.sibling}null!==o.tail&&Jt()>Vl&&(e.flags|=128,i=!0,Ws(o,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=to(l))){if(e.flags|=128,i=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ra)return qs(e),null}else 2*Jt()-o.renderingStartTime>Vl&&1073741824!==n&&(e.flags|=128,i=!0,Ws(o,!1),e.lanes=4194304);o.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=o.last)?n.sibling=l:e.child=l,o.last=l)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Jt(),e.sibling=null,n=Qa.current,Ar(Qa,i?1&n|2:1&n),e):(qs(e),null);case 22:case 23:return hc(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&0!==(1&e.mode)?0!==(1073741824&kl)&&(qs(e),6&e.subtreeFlags&&(e.flags|=8192)):qs(e),null;case 24:case 25:return null}throw Error(a(156,e.tag))}function Xs(t,e){switch(ea(e),e.tag){case 1:return kr(e.type)&&Rr(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return Ka(),Tr(Pr),Tr(Cr),no(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return $a(e),null;case 13:if(Tr(Qa),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(a(340));pa()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return Tr(Qa),null;case 4:return Ka(),null;case 10:return Ea(e.type._context),null;case 22:case 23:return hc(),null;default:return null}}Ls=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ks=function(){},Rs=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Xa(Wa.current);var a,o=null;switch(n){case"input":r=Y(t,r),i=Y(t,i),o=[];break;case"select":r=F({},r,{value:void 0}),i=F({},i,{value:void 0}),o=[];break;case"textarea":r=it(t,r),i=it(t,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(t.onclick=Qi)}for(u in vt(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Bi("scroll",t),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}},Ds=function(t,e,n,i){n!==i&&(e.flags|=4)};var Ys=!1,Ks=!1,Js="function"===typeof WeakSet?WeakSet:Set,$s=null;function Qs(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Mc(t,e,i)}else n.current=null}function tl(t,e,n){try{n()}catch(i){Mc(t,e,i)}}var el=!1;function nl(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,void 0!==a&&tl(e,n,a)}r=r.next}while(r!==i)}}function il(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function rl(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"===typeof e?e(t):e.current=t}}function al(t){var e=t.alternate;null!==e&&(t.alternate=null,al(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[dr],delete e[pr],delete e[mr],delete e[gr],delete e[yr])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ol(t){return 5===t.tag||3===t.tag||4===t.tag}function sl(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||ol(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ll(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=Qi));else if(4!==i&&null!==(t=t.child))for(ll(t,e,n),t=t.sibling;null!==t;)ll(t,e,n),t=t.sibling}function cl(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&null!==(t=t.child))for(cl(t,e,n),t=t.sibling;null!==t;)cl(t,e,n),t=t.sibling}var ul=null,hl=!1;function dl(t,e,n){for(n=n.child;null!==n;)pl(t,e,n),n=n.sibling}function pl(t,e,n){if(ae&&"function"===typeof ae.onCommitFiberUnmount)try{ae.onCommitFiberUnmount(re,n)}catch(s){}switch(n.tag){case 5:Ks||Qs(n,e);case 6:var i=ul,r=hl;ul=null,dl(t,e,n),hl=r,null!==(ul=i)&&(hl?(t=ul,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(t=ul,n=n.stateNode,8===t.nodeType?lr(t.parentNode,n):1===t.nodeType&&lr(t,n),Ve(t)):lr(ul,n.stateNode));break;case 4:i=ul,r=hl,ul=n.stateNode.containerInfo,hl=!0,dl(t,e,n),ul=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Ks&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&tl(n,e,o),r=r.next}while(r!==i)}dl(t,e,n);break;case 1:if(!Ks&&(Qs(n,e),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Mc(n,e,s)}dl(t,e,n);break;case 21:dl(t,e,n);break;case 22:1&n.mode?(Ks=(i=Ks)||null!==n.memoizedState,dl(t,e,n),Ks=i):dl(t,e,n);break;default:dl(t,e,n)}}function fl(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new Js),e.forEach(function(e){var i=Cc.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))})}}function ml(t,e){var n=e.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=t,s=e,l=s;t:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break t;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break t}l=l.return}if(null===ul)throw Error(a(160));pl(o,s,r),ul=null,hl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Mc(r,e,u)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)gl(e,t),e=e.sibling}function gl(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ml(e,t),yl(t),4&i){try{nl(3,t,t.return),il(3,t)}catch(g){Mc(t,t.return,g)}try{nl(5,t,t.return)}catch(g){Mc(t,t.return,g)}}break;case 1:ml(e,t),yl(t),512&i&&null!==n&&Qs(n,n.return);break;case 5:if(ml(e,t),yl(t),512&i&&null!==n&&Qs(n,n.return),32&t.flags){var r=t.stateNode;try{dt(r,"")}catch(g){Mc(t,t.return,g)}}if(4&i&&null!=(r=t.stateNode)){var o=t.memoizedProps,s=null!==n?n.memoizedProps:o,l=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(r,o),_t(l,s);var u=_t(l,o);for(s=0;s<c.length;s+=2){var h=c[s],d=c[s+1];"style"===h?gt(r,d):"dangerouslySetInnerHTML"===h?ht(r,d):"children"===h?dt(r,d):_(r,h,d,u)}switch(l){case"input":$(r,o);break;case"textarea":at(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?nt(r,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?nt(r,!!o.multiple,o.defaultValue,!0):nt(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(g){Mc(t,t.return,g)}}break;case 6:if(ml(e,t),yl(t),4&i){if(null===t.stateNode)throw Error(a(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(g){Mc(t,t.return,g)}}break;case 3:if(ml(e,t),yl(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ve(e.containerInfo)}catch(g){Mc(t,t.return,g)}break;case 4:default:ml(e,t),yl(t);break;case 13:ml(e,t),yl(t),8192&(r=t.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Jt())),4&i&&fl(t);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&t.mode?(Ks=(u=Ks)||h,ml(e,t),Ks=u):ml(e,t),yl(t),8192&i){if(u=null!==t.memoizedState,(t.stateNode.isHidden=u)&&!h&&0!==(1&t.mode))for($s=t,h=t.child;null!==h;){for(d=$s=h;null!==$s;){switch(f=(p=$s).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Qs(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){Mc(i,n,g)}}break;case 5:Qs(p,p.return);break;case 22:if(null!==p.memoizedState){xl(d);continue}}null!==f?(f.return=p,$s=f):xl(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=mt("display",s))}catch(g){Mc(t,t.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Mc(t,t.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(e,t),yl(t),4&i&&fl(t);case 21:}}function yl(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(ol(n)){var i=n;break t}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(dt(r,""),i.flags&=-33),cl(t,sl(t),r);break;case 3:case 4:var o=i.stateNode.containerInfo;ll(t,sl(t),o);break;default:throw Error(a(161))}}catch(s){Mc(t,t.return,s)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function vl(t,e,n){$s=t,_l(t,e,n)}function _l(t,e,n){for(var i=0!==(1&t.mode);null!==$s;){var r=$s,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Ys;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Ks;s=Ys;var c=Ks;if(Ys=o,(Ks=l)&&!c)for($s=r;null!==$s;)l=(o=$s).child,22===o.tag&&null!==o.memoizedState?wl(r):null!==l?(l.return=o,$s=l):wl(r);for(;null!==a;)$s=a,_l(a,e,n),a=a.sibling;$s=r,Ys=s,Ks=c}bl(t)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,$s=a):bl(t)}}function bl(t){for(;null!==$s;){var e=$s;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Ks||il(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!Ks)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:ns(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;null!==o&&Ha(e,o,i);break;case 3:var s=e.updateQueue;if(null!==s){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}Ha(e,s,n)}break;case 5:var l=e.stateNode;if(null===n&&4&e.flags){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var u=e.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ve(d)}}}break;default:throw Error(a(163))}Ks||512&e.flags&&rl(e)}catch(p){Mc(e,e.return,p)}}if(e===t){$s=null;break}if(null!==(n=e.sibling)){n.return=e.return,$s=n;break}$s=e.return}}function xl(t){for(;null!==$s;){var e=$s;if(e===t){$s=null;break}var n=e.sibling;if(null!==n){n.return=e.return,$s=n;break}$s=e.return}}function wl(t){for(;null!==$s;){var e=$s;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{il(4,e)}catch(l){Mc(e,n,l)}break;case 1:var i=e.stateNode;if("function"===typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(l){Mc(e,r,l)}}var a=e.return;try{rl(e)}catch(l){Mc(e,a,l)}break;case 5:var o=e.return;try{rl(e)}catch(l){Mc(e,o,l)}}}catch(l){Mc(e,e.return,l)}if(e===t){$s=null;break}var s=e.sibling;if(null!==s){s.return=e.return,$s=s;break}$s=e.return}}var Sl,Ml=Math.ceil,Tl=b.ReactCurrentDispatcher,Al=b.ReactCurrentOwner,El=b.ReactCurrentBatchConfig,Cl=0,Pl=null,Il=null,Ll=0,kl=0,Rl=Mr(0),Dl=0,Nl=null,zl=0,Fl=0,Ol=0,Bl=null,Ul=null,jl=0,Vl=1/0,Hl=null,Gl=!1,Wl=null,ql=null,Zl=!1,Xl=null,Yl=0,Kl=0,Jl=null,$l=-1,Ql=0;function tc(){return 0!==(6&Cl)?Jt():-1!==$l?$l:$l=Jt()}function ec(t){return 0===(1&t.mode)?1:0!==(2&Cl)&&0!==Ll?Ll&-Ll:null!==ma.transition?(0===Ql&&(Ql=me()),Ql):0!==(t=_e)?t:t=void 0===(t=window.event)?16:Ke(t.type)}function nc(t,e,n,i){if(50<Kl)throw Kl=0,Jl=null,Error(a(185));ye(t,n,i),0!==(2&Cl)&&t===Pl||(t===Pl&&(0===(2&Cl)&&(Fl|=n),4===Dl&&sc(t,Ll)),ic(t,i),1===n&&0===Cl&&0===(1&e.mode)&&(Vl=Jt()+500,Br&&Vr()))}function ic(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-oe(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=pe(s,e)):l<=e&&(t.expiredLanes|=s),a&=~s}}(t,e);var i=de(t,t===Pl?Ll:0);if(0===i)null!==n&&Xt(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&Xt(n),1===e)0===t.tag?function(t){Br=!0,jr(t)}(lc.bind(null,t)):jr(lc.bind(null,t)),or(function(){0===(6&Cl)&&Vr()}),n=null;else{switch(be(i)){case 1:n=Qt;break;case 4:n=te;break;case 16:default:n=ee;break;case 536870912:n=ie}n=Pc(n,rc.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function rc(t,e){if($l=-1,Ql=0,0!==(6&Cl))throw Error(a(327));var n=t.callbackNode;if(wc()&&t.callbackNode!==n)return null;var i=de(t,t===Pl?Ll:0);if(0===i)return null;if(0!==(30&i)||0!==(i&t.expiredLanes)||e)e=gc(t,i);else{e=i;var r=Cl;Cl|=2;var o=fc();for(Pl===t&&Ll===e||(Hl=null,Vl=Jt()+500,dc(t,e));;)try{vc();break}catch(l){pc(t,l)}Aa(),Tl.current=o,Cl=r,null!==Il?e=0:(Pl=null,Ll=0,e=Dl)}if(0!==e){if(2===e&&(0!==(r=fe(t))&&(i=r,e=ac(t,r))),1===e)throw n=Nl,dc(t,0),sc(t,i),ic(t,Jt()),n;if(6===e)sc(t,i);else{if(r=t.current.alternate,0===(30&i)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(s){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)&&(2===(e=gc(t,i))&&(0!==(o=fe(t))&&(i=o,e=ac(t,o))),1===e))throw n=Nl,dc(t,0),sc(t,i),ic(t,Jt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(a(345));case 2:case 5:xc(t,Ul,Hl);break;case 3:if(sc(t,i),(130023424&i)===i&&10<(e=jl+500-Jt())){if(0!==de(t,0))break;if(((r=t.suspendedLanes)&i)!==i){tc(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=ir(xc.bind(null,t,Ul,Hl),e);break}xc(t,Ul,Hl);break;case 4:if(sc(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var s=31-oe(i);o=1<<s,(s=e[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Jt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ml(i/1960))-i)){t.timeoutHandle=ir(xc.bind(null,t,Ul,Hl),i);break}xc(t,Ul,Hl);break;default:throw Error(a(329))}}}return ic(t,Jt()),t.callbackNode===n?rc.bind(null,t):null}function ac(t,e){var n=Bl;return t.current.memoizedState.isDehydrated&&(dc(t,e).flags|=256),2!==(t=gc(t,e))&&(e=Ul,Ul=n,null!==e&&oc(e)),t}function oc(t){null===Ul?Ul=t:Ul.push.apply(Ul,t)}function sc(t,e){for(e&=~Ol,e&=~Fl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-oe(e),i=1<<n;t[n]=-1,e&=~i}}function lc(t){if(0!==(6&Cl))throw Error(a(327));wc();var e=de(t,0);if(0===(1&e))return ic(t,Jt()),null;var n=gc(t,e);if(0!==t.tag&&2===n){var i=fe(t);0!==i&&(e=i,n=ac(t,i))}if(1===n)throw n=Nl,dc(t,0),sc(t,e),ic(t,Jt()),n;if(6===n)throw Error(a(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xc(t,Ul,Hl),ic(t,Jt()),null}function cc(t,e){var n=Cl;Cl|=1;try{return t(e)}finally{0===(Cl=n)&&(Vl=Jt()+500,Br&&Vr())}}function uc(t){null!==Xl&&0===Xl.tag&&0===(6&Cl)&&wc();var e=Cl;Cl|=1;var n=El.transition,i=_e;try{if(El.transition=null,_e=1,t)return t()}finally{_e=i,El.transition=n,0===(6&(Cl=e))&&Vr()}}function hc(){kl=Rl.current,Tr(Rl)}function dc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,rr(n)),null!==Il)for(n=Il.return;null!==n;){var i=n;switch(ea(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Rr();break;case 3:Ka(),Tr(Pr),Tr(Cr),no();break;case 5:$a(i);break;case 4:Ka();break;case 13:case 19:Tr(Qa);break;case 10:Ea(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Pl=t,Il=t=Rc(t.current,null),Ll=kl=e,Dl=0,Nl=null,Ol=Fl=zl=0,Ul=Bl=null,null!==La){for(e=0;e<La.length;e++)if(null!==(i=(n=La[e]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}La=null}return t}function pc(t,e){for(;;){var n=Il;try{if(Aa(),io.current=$o,co){for(var i=oo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}co=!1}if(ao=0,lo=so=oo=null,uo=!1,ho=0,Al.current=null,null===n||null===n.return){Dl=1,Nl=e,Il=null;break}t:{var o=t,s=n.return,l=n,c=e;if(e=Ll,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,ys(f,s,l,0,e),1&f.mode&&ms(o,u,e),c=u;var m=(e=f).updateQueue;if(null===m){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break t}if(0===(1&e)){ms(o,u,e),mc();break t}c=Error(a(426))}else if(ra&&1&l.mode){var y=gs(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ys(y,s,l,0,e),fa(cs(c,l));break t}}o=c=cs(c,l),4!==Dl&&(Dl=2),null===Bl?Bl=[o]:Bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e,ja(o,ps(0,c,e));break t;case 1:l=c;var v=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===ql||!ql.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e,ja(o,fs(o,l,e));break t}}o=o.return}while(null!==o)}bc(n)}catch(b){e=b,Il===n&&null!==n&&(Il=n=n.return);continue}break}}function fc(){var t=Tl.current;return Tl.current=$o,null===t?$o:t}function mc(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Pl||0===(268435455&zl)&&0===(268435455&Fl)||sc(Pl,Ll)}function gc(t,e){var n=Cl;Cl|=2;var i=fc();for(Pl===t&&Ll===e||(Hl=null,dc(t,e));;)try{yc();break}catch(r){pc(t,r)}if(Aa(),Cl=n,Tl.current=i,null!==Il)throw Error(a(261));return Pl=null,Ll=0,Dl}function yc(){for(;null!==Il;)_c(Il)}function vc(){for(;null!==Il&&!Yt();)_c(Il)}function _c(t){var e=Sl(t.alternate,t,kl);t.memoizedProps=t.pendingProps,null===e?bc(t):Il=e,Al.current=null}function bc(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=Zs(n,e,kl)))return void(Il=n)}else{if(null!==(n=Xs(n,e)))return n.flags&=32767,void(Il=n);if(null===t)return Dl=6,void(Il=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Il=e);Il=e=t}while(null!==e);0===Dl&&(Dl=5)}function xc(t,e,n){var i=_e,r=El.transition;try{El.transition=null,_e=1,function(t,e,n,i){do{wc()}while(null!==Xl);if(0!==(6&Cl))throw Error(a(327));n=t.finishedWork;var r=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(a(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-oe(n),a=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~a}}(t,o),t===Pl&&(Il=Pl=null,Ll=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Zl||(Zl=!0,Pc(ee,function(){return wc(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=El.transition,El.transition=null;var s=_e;_e=1;var l=Cl;Cl|=4,Al.current=null,function(t,e){if(tr=Ge,pi(t=di())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var i=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(x){n=null;break t}var s=0,l=-1,c=-1,u=0,h=0,d=t,p=null;e:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=s+r),d!==o||0!==i&&3!==d.nodeType||(c=s+i),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===t)break e;if(p===n&&++u===r&&(l=s),p===o&&++h===i&&(c=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(er={focusedElem:t,selectionRange:n},Ge=!1,$s=e;null!==$s;)if(t=(e=$s).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,$s=t;else for(;null!==$s;){e=$s;try{var m=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=e.stateNode,_=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:ns(e.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var b=e.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(x){Mc(e,e.return,x)}if(null!==(t=e.sibling)){t.return=e.return,$s=t;break}$s=e.return}m=el,el=!1}(t,n),gl(n,t),fi(er),Ge=!!tr,er=tr=null,t.current=n,vl(n,t,r),Kt(),Cl=l,_e=s,El.transition=o}else t.current=n;if(Zl&&(Zl=!1,Xl=t,Yl=r),o=t.pendingLanes,0===o&&(ql=null),function(t){if(ae&&"function"===typeof ae.onCommitFiberRoot)try{ae.onCommitFiberRoot(re,t,void 0,128===(128&t.current.flags))}catch(e){}}(n.stateNode),ic(t,Jt()),null!==e)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Gl)throw Gl=!1,t=Wl,Wl=null,t;0!==(1&Yl)&&0!==t.tag&&wc(),o=t.pendingLanes,0!==(1&o)?t===Jl?Kl++:(Kl=0,Jl=t):Kl=0,Vr()}(t,e,n,i)}finally{El.transition=r,_e=i}return null}function wc(){if(null!==Xl){var t=be(Yl),e=El.transition,n=_e;try{if(El.transition=null,_e=16>t?16:t,null===Xl)var i=!1;else{if(t=Xl,Xl=null,Yl=0,0!==(6&Cl))throw Error(a(331));var r=Cl;for(Cl|=4,$s=t.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for($s=u;null!==$s;){var h=$s;switch(h.tag){case 0:case 11:case 15:nl(8,h,o)}var d=h.child;if(null!==d)d.return=h,$s=d;else for(;null!==$s;){var p=(h=$s).sibling,f=h.return;if(al(h),h===u){$s=null;break}if(null!==p){p.return=f,$s=p;break}$s=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else t:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,$s=v;break t}$s=o.return}}var _=t.current;for($s=_;null!==$s;){var b=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,$s=b;else t:for(s=_;null!==$s;){if(0!==(2048&(l=$s).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(w){Mc(l,l.return,w)}if(l===s){$s=null;break t}var x=l.sibling;if(null!==x){x.return=l.return,$s=x;break t}$s=l.return}}if(Cl=r,Vr(),ae&&"function"===typeof ae.onPostCommitFiberRoot)try{ae.onPostCommitFiberRoot(re,t)}catch(w){}i=!0}return i}finally{_e=n,El.transition=e}}return!1}function Sc(t,e,n){t=Ba(t,e=ps(0,e=cs(n,e),1),1),e=tc(),null!==t&&(ye(t,1,e),ic(t,e))}function Mc(t,e,n){if(3===t.tag)Sc(t,t,n);else for(;null!==e;){if(3===e.tag){Sc(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===ql||!ql.has(i))){e=Ba(e,t=fs(e,t=cs(n,t),1),1),t=tc(),null!==e&&(ye(e,1,t),ic(e,t));break}}e=e.return}}function Tc(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=tc(),t.pingedLanes|=t.suspendedLanes&n,Pl===t&&(Ll&n)===n&&(4===Dl||3===Dl&&(130023424&Ll)===Ll&&500>Jt()-jl?dc(t,0):Ol|=n),ic(t,e)}function Ac(t,e){0===e&&(0===(1&t.mode)?e=1:(e=ue,0===(130023424&(ue<<=1))&&(ue=4194304)));var n=tc();null!==(t=Da(t,e))&&(ye(t,e,n),ic(t,n))}function Ec(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Ac(t,n)}function Cc(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(e),Ac(t,n)}function Pc(t,e){return Zt(t,e)}function Ic(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(t,e,n,i){return new Ic(t,e,n,i)}function kc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Rc(t,e){var n=t.alternate;return null===n?((n=Lc(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Dc(t,e,n,i,r,o){var s=2;if(i=t,"function"===typeof t)kc(t)&&(s=1);else if("string"===typeof t)s=5;else t:switch(t){case S:return Nc(n.children,r,o,e);case M:s=8,r|=8;break;case T:return(t=Lc(12,n,e,2|r)).elementType=T,t.lanes=o,t;case P:return(t=Lc(13,n,e,r)).elementType=P,t.lanes=o,t;case I:return(t=Lc(19,n,e,r)).elementType=I,t.lanes=o,t;case R:return zc(n,r,o,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case A:s=10;break t;case E:s=9;break t;case C:s=11;break t;case L:s=14;break t;case k:s=16,i=null;break t}throw Error(a(130,null==t?t:typeof t,""))}return(e=Lc(s,n,e,r)).elementType=t,e.type=i,e.lanes=o,e}function Nc(t,e,n,i){return(t=Lc(7,t,i,e)).lanes=n,t}function zc(t,e,n,i){return(t=Lc(22,t,i,e)).elementType=R,t.lanes=n,t.stateNode={isHidden:!1},t}function Fc(t,e,n){return(t=Lc(6,t,null,e)).lanes=n,t}function Oc(t,e,n){return(e=Lc(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Bc(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ge(0),this.expirationTimes=ge(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ge(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(t,e,n,i,r,a,o,s,l){return t=new Bc(t,e,n,s,l),1===e?(e=1,!0===a&&(e|=8)):e=0,a=Lc(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},za(a),t}function jc(t){if(!t)return Er;t:{if(Vt(t=t._reactInternals)!==t||1!==t.tag)throw Error(a(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(kr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(a(171))}if(1===t.tag){var n=t.type;if(kr(n))return Nr(t,n,e)}return e}function Vc(t,e,n,i,r,a,o,s,l){return(t=Uc(n,i,!0,t,0,a,0,s,l)).context=jc(null),n=t.current,(a=Oa(i=tc(),r=ec(n))).callback=void 0!==e&&null!==e?e:null,Ba(n,a,r),t.current.lanes=r,ye(t,r,i),ic(t,i),t}function Hc(t,e,n,i){var r=e.current,a=tc(),o=ec(r);return n=jc(n),null===e.context?e.context=n:e.pendingContext=n,(e=Oa(a,o)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),null!==(t=Ba(r,e,o))&&(nc(t,r,o,a),Ua(t,r,o)),o}function Gc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Wc(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function qc(t,e){Wc(t,e),(t=t.alternate)&&Wc(t,e)}Sl=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||Pr.current)_s=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return _s=!1,function(t,e,n){switch(e.tag){case 3:Ps(e),pa();break;case 5:Ja(e);break;case 1:kr(e.type)&&zr(e);break;case 4:Ya(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ar(wa,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=e.memoizedState))return null!==i.dehydrated?(Ar(Qa,1&Qa.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Fs(t,e,n):(Ar(Qa,1&Qa.current),null!==(t=Gs(t,e,n))?t.sibling:null);Ar(Qa,1&Qa.current);break;case 19:if(i=0!==(n&e.childLanes),0!==(128&t.flags)){if(i)return Vs(t,e,n);e.flags|=128}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ar(Qa,Qa.current),i)break;return null;case 22:case 23:return e.lanes=0,Ms(t,e,n)}return Gs(t,e,n)}(t,e,n);_s=0!==(131072&t.flags)}else _s=!1,ra&&0!==(1048576&e.flags)&&Qr(e,qr,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Hs(t,e),t=e.pendingProps;var r=Lr(e,Cr.current);Pa(e,n),r=go(null,e,i,t,r,n);var o=yo();return e.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,kr(i)?(o=!0,zr(e)):o=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,za(e),r.updater=rs,e.stateNode=r,r._reactInternals=e,ls(e,i,t,n),e=Cs(null,e,i,!0,o,n)):(e.tag=0,ra&&o&&ta(e),bs(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(Hs(t,e),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"===typeof t)return kc(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===C)return 11;if(t===L)return 14}return 2}(i),t=ns(i,t),r){case 0:e=As(null,e,i,t,n);break t;case 1:e=Es(null,e,i,t,n);break t;case 11:e=xs(null,e,i,t,n);break t;case 14:e=ws(null,e,i,ns(i.type,t),n);break t}throw Error(a(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,As(t,e,i,r=e.elementType===i?r:ns(i,r),n);case 1:return i=e.type,r=e.pendingProps,Es(t,e,i,r=e.elementType===i?r:ns(i,r),n);case 3:t:{if(Ps(e),null===t)throw Error(a(387));i=e.pendingProps,r=(o=e.memoizedState).element,Fa(t,e),Va(e,i,null,n);var s=e.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,256&e.flags){e=Is(t,e,i,n,r=cs(Error(a(423)),e));break t}if(i!==r){e=Is(t,e,i,n,r=cs(Error(a(424)),e));break t}for(ia=cr(e.stateNode.containerInfo.firstChild),na=e,ra=!0,aa=null,n=xa(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),i===r){e=Gs(t,e,n);break t}bs(t,e,i,n)}e=e.child}return e;case 5:return Ja(e),null===t&&ca(e),i=e.type,r=e.pendingProps,o=null!==t?t.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==o&&nr(i,o)&&(e.flags|=32),Ts(t,e),bs(t,e,s,n),e.child;case 6:return null===t&&ca(e),null;case 13:return Fs(t,e,n);case 4:return Ya(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=ba(e,null,i,n):bs(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,xs(t,e,i,r=e.elementType===i?r:ns(i,r),n);case 7:return bs(t,e,e.pendingProps,n),e.child;case 8:case 12:return bs(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,o=e.memoizedProps,s=r.value,Ar(wa,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!Pr.current){e=Gs(t,e,n);break t}}else for(null!==(o=e.child)&&(o.return=e);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Oa(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ca(o.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===e.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Ca(s,n,e),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===e){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Pa(e,n),i=i(r=Ia(r)),e.flags|=1,bs(t,e,i,n),e.child;case 14:return r=ns(i=e.type,e.pendingProps),ws(t,e,i,r=ns(i.type,r),n);case 15:return Ss(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ns(i,r),Hs(t,e),e.tag=1,kr(i)?(t=!0,zr(e)):t=!1,Pa(e,n),os(e,i,r),ls(e,i,r,n),Cs(null,e,i,!0,t,n);case 19:return Vs(t,e,n);case 22:return Ms(t,e,n)}throw Error(a(156,e.tag))};var Zc="function"===typeof reportError?reportError:function(t){console.error(t)};function Xc(t){this._internalRoot=t}function Yc(t){this._internalRoot=t}function Kc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Jc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function $c(){}function Qc(t,e,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var t=Gc(o);s.call(t)}}Hc(e,o,t,r)}else o=function(t,e,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var t=Gc(o);a.call(t)}}var o=Vc(e,i,t,0,null,!1,0,"",$c);return t._reactRootContainer=o,t[fr]=o.current,Vi(8===t.nodeType?t.parentNode:t),uc(),o}for(;r=t.lastChild;)t.removeChild(r);if("function"===typeof i){var s=i;i=function(){var t=Gc(l);s.call(t)}}var l=Uc(t,0,!1,null,0,!1,0,"",$c);return t._reactRootContainer=l,t[fr]=l.current,Vi(8===t.nodeType?t.parentNode:t),uc(function(){Hc(e,l,n,i)}),l}(n,e,t,r,i);return Gc(o)}Yc.prototype.render=Xc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(a(409));Hc(t,e,null,null)},Yc.prototype.unmount=Xc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;uc(function(){Hc(null,t,null,null)}),e[fr]=null}},Yc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Me();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Re.length&&0!==e&&e<Re[n].priority;n++);Re.splice(n,0,t),0===n&&Fe(t)}},xe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=he(e.pendingLanes);0!==n&&(ve(e,1|n),ic(e,Jt()),0===(6&Cl)&&(Vl=Jt()+500,Vr()))}break;case 13:uc(function(){var e=Da(t,1);if(null!==e){var n=tc();nc(e,t,1,n)}}),qc(t,1)}},we=function(t){if(13===t.tag){var e=Da(t,134217728);if(null!==e)nc(e,t,134217728,tc());qc(t,134217728)}},Se=function(t){if(13===t.tag){var e=ec(t),n=Da(t,e);if(null!==n)nc(n,t,e,tc());qc(t,e)}},Me=function(){return _e},Te=function(t,e){var n=_e;try{return _e=t,e()}finally{_e=n}},wt=function(t,e,n){switch(e){case"input":if($(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=xr(i);if(!r)throw Error(a(90));Z(i),$(i,r)}}}break;case"textarea":at(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},Ct=cc,Pt=uc;var tu={usingClientEntryPoint:!1,Events:[_r,br,xr,At,Et,cc]},eu={findFiberByHostInstance:vr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Wt(t))?null:t.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{re=iu.inject(nu),ae=iu}catch(ut){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(e))throw Error(a(200));return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.createRoot=function(t,e){if(!Kc(t))throw Error(a(299));var n=!1,i="",r=Zc;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onRecoverableError&&(r=e.onRecoverableError)),e=Uc(t,1,!1,null,0,n,0,i,r),t[fr]=e.current,Vi(8===t.nodeType?t.parentNode:t),new Xc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(a(188));throw t=Object.keys(t).join(","),Error(a(268,t))}return t=null===(t=Wt(e))?null:t.stateNode},e.flushSync=function(t){return uc(t)},e.hydrate=function(t,e,n){if(!Jc(e))throw Error(a(200));return Qc(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!Kc(t))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=Zc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),e=Vc(e,null,t,1,null!=n?n:null,r,0,o,s),t[fr]=e.current,Vi(t),i)for(t=0;t<i.length;t++)r=(r=(n=i[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Yc(e)},e.render=function(t,e,n){if(!Jc(e))throw Error(a(200));return Qc(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Jc(t))throw Error(a(40));return!!t._reactRootContainer&&(uc(function(){Qc(null,null,t,!1,function(){t._reactRootContainer=null,t[fr]=null})}),!0)},e.unstable_batchedUpdates=cc,e.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Jc(n))throw Error(a(200));if(null==t||void 0===t._reactInternals)throw Error(a(38));return Qc(t,e,n,!1,i)},e.version="18.3.1-next-f1338f8080-20240426"},2897:(t,e,n)=>{var i=n(3693);function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}t.exports=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){i(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t},t.exports.__esModule=!0,t.exports.default=t.exports},3693:(t,e,n)=>{var i=n(7736);t.exports=function(t,e,n){return(e=i(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.__esModule=!0,t.exports.default=t.exports},3719:function(t,e,n){var i=n(2897).default;t.exports=function(){"use strict";var t={},e={};function n(n,i,r){if(e[n]=r,"index"===n){var a="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",o={};return e.shared(o),e.index(t,o),"undefined"!==typeof window&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([a],{type:"text/javascript"}))),t}}return n("shared",["exports"],function(t){function e(t,e,n,i){return new(n||(n=Promise))(function(r,a){function o(t){try{l(i.next(t))}catch(t){a(t)}}function s(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,s)}l((i=i.apply(t,e||[])).next())})}function n(t,e){this.x=t,this.y=e}function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var a,o;"function"==typeof SuppressedError&&SuppressedError,n.prototype={clone(){return new n(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,e){return this.clone()._rotateAround(t,e)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){const e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult(t){const e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){const t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){const e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround(t,e){const n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:n},n.convert=function(t){if(t instanceof n)return t;if(Array.isArray(t))return new n(+t[0],+t[1]);if(void 0!==t.x&&void 0!==t.y)return new n(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};var s=function(){if(o)return a;function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}return o=1,a=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},a}(),l=r(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const n=4*i;e.fillStyle="rgb(".concat(n,",").concat(n+1,",").concat(n+2,")"),e.fillRect(i%t,Math.floor(i/t),1,1)}const n=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&n[e]!==e){u=!0;break}}}return u||!1}var p=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array;function m(){var t=new f(9);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y(){var t=new f(3);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v(t){return Math.hypot(t[0],t[1],t[2])}function _(t,e,n){var i=new f(3);return i[0]=t,i[1]=e,i[2]=n,i}function b(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function x(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function w(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2];return t[0]=r*l-a*s,t[1]=a*o-i*l,t[2]=i*s-r*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var S,M=v;function T(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t}function A(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function E(t,e,n,i){var r=.5*Math.PI/180;e*=r,n*=r,i*=r;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return t[0]=a*l*u-o*s*c,t[1]=o*s*u+a*l*c,t[2]=o*l*c-a*s*u,t[3]=o*l*u+a*s*c,t}function C(){var t=new f(2);return f!=Float32Array&&(t[0]=0,t[1]=0),t}function P(t,e){var n=new f(2);return n[0]=t,n[1]=e,n}y(),S=new f(4),f!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0,S[3]=0),y(),_(1,0,0),_(0,1,0),A(),A(),m(),C();const I=8192;function L(t,e,n){return e*(I/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function k(t,e){return(t%e+e)%e}function R(t,e,n){return t*(1-n)+e*n}function D(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function N(t,e,n,i){const r=new l(t,e,n,i);return t=>r.solve(t)}const z=N(.25,.1,.25,1);function F(t,e,n){return Math.min(n,Math.max(e,t))}function O(t,e,n){const i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function B(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}let U=1;function j(t,e,n){const i={};for(const r in t)i[r]=e.call(this,t[r],r,t);return i}function V(t,e,n){const i={};for(const r in t)e.call(this,t[r],r,t)&&(i[r]=t[r]);return i}function H(t){return Array.isArray(t)?t.map(H):"object"==typeof t&&t?j(t,H):t}const G={};function W(t){G[t]||("undefined"!=typeof console&&console.warn(t),G[t]=!0)}function q(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Z(t){return"undefined"!=typeof WorkerGlobalScope&&void 0!==t&&t instanceof WorkerGlobalScope}let X=null;function Y(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function J(t,n,i,r,a){return e(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const o=null==e?void 0:e.format;if(!o||!o.startsWith("BGR")&&!o.startsWith("RGB"))throw new Error("Unrecognized format ".concat(o));const s=o.startsWith("BGR"),l=new Uint8ClampedArray(r*a*4);if(yield e.copyTo(l,function(t,e,n,i,r){const a=4*Math.max(-e,0),o=(Math.max(0,n)-n)*i*4+a,s=4*i,l=Math.max(0,e),c=Math.max(0,n);return{rect:{x:l,y:c,width:Math.min(t.width,e+i)-l,height:Math.min(t.height,n+r)-c},layout:[{offset:o,stride:s}]}}(t,n,i,r,a)),s)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}})}let $,Q;function tt(t,e,n,i){return t.addEventListener(e,n,i),{unsubscribe:()=>{t.removeEventListener(e,n,i)}}}function et(t){return t*Math.PI/180}function nt(t){return t/Math.PI*180}const it={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},rt={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},at="AbortError";function ot(){return new Error(at)}const st={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function lt(t){return st.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]}const ct="global-dispatcher";class ut extends Error{constructor(t,e,n,i){super("AJAXError: ".concat(e," (").concat(t,"): ").concat(n)),this.status=t,this.statusText=e,this.url=n,this.body=i}}const ht=()=>Z(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,dt=function(t,n){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){const e=lt(t.url);if(e)return e(t,n);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,targetMapId:ct},n)}if(!(/^file:/.test(i=t.url)||/^file:/.test(ht())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(t,n){return e(this,void 0,void 0,function*(){const e=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:ht(),signal:n.signal});let i,r;"json"!==t.type||e.headers.has("Accept")||e.headers.set("Accept","application/json");try{i=yield fetch(e)}catch(e){throw new ut(0,e.message,t.url,new Blob)}if(!i.ok){const e=yield i.blob();throw new ut(i.status,i.statusText,t.url,e)}r="arrayBuffer"===t.type||"image"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text();const a=yield r;if(n.signal.aborted)throw ot();return{data:a,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires")}})}(t,n);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,mustQueue:!0,targetMapId:ct},n)}var i;return function(t,e){return new Promise((n,i)=>{var r;const a=new XMLHttpRequest;a.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(a.responseType="arraybuffer");for(const e in t.headers)a.setRequestHeader(e,t.headers[e]);"json"===t.type&&(a.responseType="text",(null===(r=t.headers)||void 0===r?void 0:r.Accept)||a.setRequestHeader("Accept","application/json")),a.withCredentials="include"===t.credentials,a.onerror=()=>{i(new Error(a.statusText))},a.onload=()=>{if(!e.signal.aborted)if((a.status>=200&&a.status<300||0===a.status)&&null!==a.response){let e=a.response;if("json"===t.type)try{e=JSON.parse(a.response)}catch(t){return void i(t)}n({data:e,cacheControl:a.getResponseHeader("Cache-Control"),expires:a.getResponseHeader("Expires")})}else{const e=new Blob([a.response],{type:a.getResponseHeader("Content-Type")});i(new ut(a.status,a.statusText,t.url,e))}},e.signal.addEventListener("abort",()=>{a.abort(),i(ot())}),a.send(t.body)})}(t,n)};function pt(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function ft(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function mt(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class gt{constructor(t){B(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=t}}class yt extends gt{constructor(t){super("error",B({error:t},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class vt{on(t,e){return this._listeners=this._listeners||{},ft(t,e,this._listeners),{unsubscribe:()=>{this.off(t,e)}}}off(t,e){return mt(t,e,this._listeners),mt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},ft(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new gt(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const a of i)mt(n,a,this._oneTimeListeners),a.call(this,t);const r=this._eventedParent;r&&(B(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof yt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var _t={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const bt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(t,e){const n={};for(const i in t)"ref"!==i&&(n[i]=t[i]);return bt.forEach(t=>{t in e&&(n[t]=e[t])}),n}function wt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!wt(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!wt(t[n],e[n]))return!1;return!0}return t===e}function St(t,e){t.push(e)}function Mt(t,e,n){St(n,{command:"addSource",args:[t,e[t]]})}function Tt(t,e,n){St(e,{command:"removeSource",args:[t]}),n[t]=!0}function At(t,e,n,i){Tt(t,n,i),Mt(t,e,n)}function Et(t,e,n){let i;for(i in t[n])if(Object.prototype.hasOwnProperty.call(t[n],i)&&"data"!==i&&!wt(t[n][i],e[n][i]))return!1;for(i in e[n])if(Object.prototype.hasOwnProperty.call(e[n],i)&&"data"!==i&&!wt(t[n][i],e[n][i]))return!1;return!0}function Ct(t,e,n,i,r,a){t=t||{},e=e||{};for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(wt(t[o],e[o])||n.push({command:a,args:[i,o,e[o],r]}));for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&!Object.prototype.hasOwnProperty.call(t,o)&&(wt(t[o],e[o])||n.push({command:a,args:[i,o,e[o],r]}))}function Pt(t){return t.id}function It(t,e){return t[e.id]=e,t}class Lt{constructor(t,e,n,i){this.message=(t?"".concat(t,": "):"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function kt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}class Rt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Dt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new Dt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error("".concat(t," not found in scope."))}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Nt={kind:"null"},zt={kind:"number"},Ft={kind:"string"},Ot={kind:"boolean"},Bt={kind:"color"},Ut={kind:"projectionDefinition"},jt={kind:"object"},Vt={kind:"value"},Ht={kind:"collator"},Gt={kind:"formatted"},Wt={kind:"padding"},qt={kind:"colorArray"},Zt={kind:"numberArray"},Xt={kind:"resolvedImage"},Yt={kind:"variableAnchorOffsetCollection"};function Kt(t,e){return{kind:"array",itemType:t,N:e}}function Jt(t){if("array"===t.kind){const e=Jt(t.itemType);return"number"==typeof t.N?"array<".concat(e,", ").concat(t.N,">"):"value"===t.itemType.kind?"array":"array<".concat(e,">")}return t.kind}const $t=[Nt,zt,Ft,Ot,Bt,Ut,Gt,jt,Kt(Vt),Wt,Zt,qt,Xt,Yt];function Qt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Qt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of $t)if(!Qt(t,e))return null}return"Expected ".concat(Jt(t)," but found ").concat(Jt(e)," instead.")}function te(t,e){return e.some(e=>e.kind===t.kind)}function ee(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function ne(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const ie=.96422,re=.82521,ae=4/29,oe=6/29,se=3*oe*oe,le=oe*oe*oe,ce=Math.PI/180,ue=180/Math.PI;function he(t){return(t%=360)<0&&(t+=360),t}function de(t){let e,n,[i,r,a,o]=t;const s=fe((.2225045*(i=pe(i))+.7168786*(r=pe(r))+.0606169*(a=pe(a)))/1);i===r&&r===a?e=n=s:(e=fe((.4360747*i+.3850649*r+.1430804*a)/ie),n=fe((.0139322*i+.0971045*r+.7141733*a)/re));const l=116*s-16;return[l<0?0:l,500*(e-s),200*(s-n),o]}function pe(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fe(t){return t>le?Math.pow(t,1/3):t/se+ae}function me(t){let[e,n,i,r]=t,a=(e+16)/116,o=isNaN(n)?a:a+n/500,s=isNaN(i)?a:a-i/200;return a=1*ye(a),o=ie*ye(o),s=re*ye(s),[ge(3.1338561*o-1.6168667*a-.4906146*s),ge(-.9787684*o+1.9161415*a+.033454*s),ge(.0719453*o-.2289914*a+1.4052427*s),r]}function ge(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function ye(t){return t>oe?t*t*t:se*(t-ae)}const ve=Object.hasOwn||function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function _e(t,e){return ve(t,e)?t[e]:void 0}function be(t){return parseInt(t.padEnd(2,t),16)/255}function xe(t,e){return we(e?t/100:t,0,1)}function we(t,e,n){return Math.min(Math.max(e,t),n)}function Se(t){return!t.some(Number.isNaN)}const Me={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Te(t,e,n){return t+n*(e-t)}function Ae(t,e,n){return t.map((t,i)=>Te(t,e[i],n))}class Ee{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.r=t,this.g=e,this.b=n,this.a=i,r||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[t,e,n,i]))}static parse(t){if(t instanceof Ee)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=_e(Me,t);if(e){const[t,n,i]=e;return[t/255,n/255,i/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let n=1;return[be(t.slice(n,n+=e)),be(t.slice(n,n+=e)),be(t.slice(n,n+=e)),be(t.slice(n,n+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,n,i,r,a,o,s,l,c,u,h,d]=e,p=[r||" ",s||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[i,o,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[we(+n/e,0,1),we(+a/e,0,1),we(+l/e,0,1),h?xe(+h,d):1];if(Se(t))return t}}return}}const n=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[t,e,i,r,a,o,s,l,c]=n,u=[i||" ",a||" ",s].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,we(+r,0,100),we(+o,0,100),l?xe(+l,c):1];if(Se(t))return function(t){let[e,n,i,r]=t;function a(t){const r=(t+e/30)%12,a=n*Math.min(i,1-i);return i-a*Math.max(-1,Math.min(r-3,9-r,1))}return e=he(e),n/=100,i/=100,[a(0),a(8),a(4),r]}(t)}}}(t);return e?new Ee(...e,!1):void 0}get rgb(){const{r:t,g:e,b:n,a:i}=this,r=i||1/0;return this.overwriteGetter("rgb",[t/r,e/r,n/r,i])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,n,i,r]=de(t),a=Math.sqrt(n*n+i*i);return[Math.round(1e4*a)?he(Math.atan2(i,n)*ue):NaN,a,e,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",de(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,n,i]=this.rgb;return"rgba(".concat([t,e,n].map(t=>Math.round(255*t)).join(","),",").concat(i,")")}static interpolate(t,e,n){switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb"){case"rgb":{const[i,r,a,o]=Ae(t.rgb,e.rgb,n);return new Ee(i,r,a,o,!1)}case"hcl":{const[i,r,a,o]=t.hcl,[s,l,c,u]=e.hcl;let h,d;if(isNaN(i)||isNaN(s))isNaN(i)?isNaN(s)?h=NaN:(h=s,1!==a&&0!==a||(d=l)):(h=i,1!==c&&0!==c||(d=r));else{let t=s-i;s>i&&t>180?t-=360:s<i&&i-s>180&&(t+=360),h=i+n*t}const[p,f,m,g]=function(t){let[e,n,i,r]=t;return e=isNaN(e)?0:e*ce,me([i,Math.cos(e)*n,Math.sin(e)*n,r])}([h,null!=d?d:Te(r,l,n),Te(a,c,n),Te(o,u,n)]);return new Ee(p,f,m,g,!1)}case"lab":{const[i,r,a,o]=me(Ae(t.lab,e.lab,n));return new Ee(i,r,a,o,!1)}}}}Ee.black=new Ee(0,0,0,1),Ee.white=new Ee(1,1,1,1),Ee.transparent=new Ee(0,0,0,0),Ee.red=new Ee(1,0,0,1);class Ce{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Pe=["bottom","center","top"];class Ie{constructor(t,e,n,i,r,a){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r,this.verticalAlign=a}}class Le{constructor(t){this.sections=t}static fromString(t){return new Le([new Ie(t,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Le?t:Le.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}}class ke{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ke)return t;if("number"==typeof t)return new ke([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ke(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new ke(Ae(t.values,e.values,n))}}class Re{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Re)return t;if("number"==typeof t)return new Re([t]);if(Array.isArray(t)){for(const e of t)if("number"!=typeof e)return;return new Re(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new Re(Ae(t.values,e.values,n))}}class De{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof De)return t;if("string"==typeof t){const e=Ee.parse(t);if(!e)return;return new De([e])}if(!Array.isArray(t))return;const e=[];for(const n of t){if("string"!=typeof n)return;const t=Ee.parse(n);if(!t)return;e.push(t)}return new De(e)}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb";const r=[];if(t.values.length!=e.values.length)throw new Error("colorArray: Arrays have mismatched length (".concat(t.values.length," vs. ").concat(e.values.length,"), cannot interpolate."));for(let a=0;a<t.values.length;a++)r.push(Ee.interpolate(t.values[a],e.values[a],n,i));return new De(r)}}class Ne extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ze=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fe{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Fe)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const n=t[e],i=t[e+1];if("string"!=typeof n||!ze.has(n))return;if(!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new Fe(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){const i=t.values,r=e.values;if(i.length!==r.length)throw new Ne("Cannot interpolate values of different length. from: ".concat(t.toString(),", to: ").concat(e.toString()));const a=[];for(let o=0;o<i.length;o+=2){if(i[o]!==r[o])throw new Ne("Cannot interpolate values containing mismatched anchors. from[".concat(o,"]: ").concat(i[o],", to[").concat(o,"]: ").concat(r[o]));a.push(i[o]);const[t,e]=i[o+1],[s,l]=r[o+1];a.push([Te(t,s,n),Te(e,l,n)])}return new Fe(a)}}class Oe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Oe({name:t,available:!1}):null}}class Be{constructor(t,e,n){this.from=t,this.to=e,this.transition=n}static interpolate(t,e,n){return new Be(t,e,n)}static parse(t){return t instanceof Be?t:Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]?new Be(t[0],t[1],t[2]):"object"==typeof t&&"string"==typeof t.from&&"string"==typeof t.to&&"number"==typeof t.transition?new Be(t.from,t.to,t.transition):"string"==typeof t?new Be(t,t,1):void 0}}function Ue(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([t,e,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function je(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Be||t instanceof Ee||t instanceof Ce||t instanceof Le||t instanceof ke||t instanceof Re||t instanceof De||t instanceof Fe||t instanceof Oe)return!0;if(Array.isArray(t)){for(const e of t)if(!je(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!je(t[e]))return!1;return!0}return!1}function Ve(t){if(null===t)return Nt;if("string"==typeof t)return Ft;if("boolean"==typeof t)return Ot;if("number"==typeof t)return zt;if(t instanceof Ee)return Bt;if(t instanceof Be)return Ut;if(t instanceof Ce)return Ht;if(t instanceof Le)return Gt;if(t instanceof ke)return Wt;if(t instanceof Re)return Zt;if(t instanceof De)return qt;if(t instanceof Fe)return Yt;if(t instanceof Oe)return Xt;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=Ve(i);if(n){if(n===t)continue;n=Vt;break}n=t}return Kt(n||Vt,e)}return jt}function He(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Ee||t instanceof Be||t instanceof Le||t instanceof ke||t instanceof Re||t instanceof De||t instanceof Fe||t instanceof Oe?t.toString():JSON.stringify(t)}class Ge{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!je(t[1]))return e.error("invalid value");const n=t[1];let i=Ve(n);const r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new Ge(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const We={string:Ft,number:zt,boolean:Ot,object:jt};class qe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,a;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in We)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=We[n],i++}else r=Vt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],i++}n=Kt(r,a)}else{if(!We[r])throw new Error("Types doesn't contain name = ".concat(r));n=We[r]}const a=[];for(;i<t.length;i++){const n=e.parse(t[i],i,Vt);if(!n)return null;a.push(n)}return new qe(n,a)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!Qt(this.type,Ve(n)))return n;if(e===this.args.length-1)throw new Ne("Expected value to be of type ".concat(Jt(this.type),", but found ").concat(Jt(Ve(n))," instead."))}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ze={"to-boolean":Ot,"to-color":Bt,"to-number":zt,"to-string":Ft};class Xe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(!Ze[n])throw new Error("Can't parse ".concat(n," as it is not part of the known types"));if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=Ze[n],r=[];for(let a=1;a<t.length;a++){const n=e.parse(t[a],a,Vt);if(!n)return null;r.push(n)}return new Xe(i,r)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof Ee)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?"Invalid rgba value ".concat(JSON.stringify(e),": expected an array containing either three or four numeric values."):Ue(e[0],e[1],e[2],e[3]),!n))return new Ee(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Ne(n||"Could not parse color from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"padding":{let e;for(const n of this.args){e=n.evaluate(t);const i=ke.parse(e);if(i)return i}throw new Ne("Could not parse padding from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"numberArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=Re.parse(e);if(i)return i}throw new Ne("Could not parse numberArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"colorArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=De.parse(e);if(i)return i}throw new Ne("Could not parse colorArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"variableAnchorOffsetCollection":{let e;for(const n of this.args){e=n.evaluate(t);const i=Fe.parse(e);if(i)return i}throw new Ne("Could not parse variableAnchorOffsetCollection from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"number":{let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new Ne("Could not convert ".concat(JSON.stringify(e)," to number."))}case"formatted":return Le.fromString(He(this.args[0].evaluate(t)));case"resolvedImage":return Oe.fromString(He(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return He(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ye=["Unknown","Point","LineString","Polygon"];class Ke{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ye[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache.get(t);return e||(e=Ee.parse(t),this._parseColorCache.set(t,e)),e}}class Je{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Dt,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this.registry=t,this.path=n,this.key=n.map(t=>"[".concat(t,"]")).join(""),this.scope=r,this.errors=a,this.expectedType=i,this._isConstant=e}parse(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new qe(e,[t]):"coerce"===n?new Xe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found ".concat(typeof i,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;const r=this.registry[i];if(r){let i=r.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,r=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind){if("projectionDefinition"===t.kind&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(t.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(t.kind)&&["value","number","array"].includes(r.kind)||"colorArray"===t.kind&&["value","string","array"].includes(r.kind)||"variableAnchorOffsetCollection"===t.kind&&["value","array"].includes(r.kind))i=n(i,t,e.typeAnnotation||"coerce");else if(this.checkSubtype(t,r))return null}else i=n(i,t,e.typeAnnotation||"assert")}if(!(i instanceof Ge)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){const e=new Ke;try{i=new Ge(i.type,i.evaluate(e))}catch(t){return this.error(t.message),null}}return i}return this.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof t," instead."))}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new Je(this.registry,this._isConstant,i,e||null,r,this.errors)}error(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(t=>"[".concat(t,"]")).join(""));this.errors.push(new Rt(r,t))}checkSubtype(t,e){const n=Qt(t,e);return n&&this.error(n),n}}class $e{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=e.parse(t[r+1],r+1);if(!a)return null;n.push([i,a])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new $e(n,i):null}outputDefined(){return this.result.outputDefined()}}class Qe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Qe(n,e.scope.get(n)):e.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class tn{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,zt),i=e.parse(t[2],2,Kt(e.expectedType||Vt));return n&&i?new tn(i.type.itemType,n,i):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new Ne("Array index out of bounds: ".concat(e," < 0."));if(e>=n.length)throw new Ne("Array index out of bounds: ".concat(e," > ").concat(n.length-1,"."));if(e!==Math.floor(e))throw new Ne("Array index must be an integer, but found ".concat(e," instead."));return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class en{constructor(t,e){this.type=Ot,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Vt),i=e.parse(t[2],2,Vt);return n&&i?te(n.type,[Ot,Ft,zt,Nt,Vt])?new en(n,i):e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(n.type)," instead")):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!ee(e,["boolean","string","number","null"]))throw new Ne("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(Ve(e))," instead."));if(!ee(n,["string","array"]))throw new Ne("Expected second argument to be of type array or string, but found ".concat(Jt(Ve(n))," instead."));return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class nn{constructor(t,e,n){this.type=zt,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Vt),i=e.parse(t[2],2,Vt);if(!n||!i)return null;if(!te(n.type,[Ot,Ft,zt,Nt,Vt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,zt);return r?new nn(n,i,r):null}return new nn(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!ee(e,["boolean","string","number","null"]))throw new Ne("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(Ve(e))," instead."));let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(t)),ee(n,["string"])){const t=n.indexOf(e,i);return-1===t?-1:[...n.slice(0,t)].length}if(ee(n,["array"]))return n.indexOf(e,i);throw new Ne("Expected second argument to be of type array or string, but found ".concat(Jt(Ve(n))," instead."))}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class rn{constructor(t,e,n,i,r,a){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a}static parse(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},a=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const s=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Ve(t)))return null}else n=Ve(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=a.length}const u=e.parse(s,l,i);if(!u)return null;i=i||u.type,a.push(u)}const o=e.parse(t[1],1,Vt);if(!o)return null;const s=e.parse(t[t.length-1],t.length-1,i);return s?"value"!==o.type.kind&&e.concat(1).checkSubtype(n,o.type)?null:new rn(n,i,o,r,a,s):null}evaluate(t){const e=this.input.evaluate(t);return(Ve(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class an{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let a=1;a<t.length-1;a+=2){const r=e.parse(t[a],a,Ot);if(!r)return null;const o=e.parse(t[a+1],a+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=e.parse(t[t.length-1],t.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new an(n,i,r)}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(t=>{let[e,n]=t;return n.outputDefined()})&&this.otherwise.outputDefined()}}class on{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Vt),i=e.parse(t[2],2,zt);if(!n||!i)return null;if(!te(n.type,[Kt(Vt),Ft,Vt]))return e.error("Expected first argument to be of type array or string, but found ".concat(Jt(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,zt);return r?new on(n.type,n,i,r):null}return new on(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);let i;if(this.endIndex&&(i=this.endIndex.evaluate(t)),ee(e,["string"]))return[...e].slice(n,i).join("");if(ee(e,["array"]))return e.slice(n,i);throw new Ne("Expected first argument to be of type array or string, but found ".concat(Jt(Ve(e))," instead."))}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function sn(t,e){const n=t.length-1;let i,r,a=0,o=n,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),i=t[s],r=t[s+1],i<=e){if(s===n||e<r)return s;a=s+1}else{if(!(i>e))throw new Ne("Input is not a number.");o=s-1}return 0}class ln{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,zt);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let a=1;a<t.length;a+=2){const n=1===a?-1/0:t[a],o=t[a+1],s=a,l=a+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new ln(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[sn(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function cn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var un,hn,dn=function(){if(hn)return un;function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}return hn=1,un=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},un}(),pn=cn(dn);class fn{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of r)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(t,e,n,i){let r=0;if("exponential"===t.name)r=mn(e,t.base,n,i);else if("linear"===t.name)r=mn(e,1,n,i);else if("cubic-bezier"===t.name){const a=t.controlPoints;r=new pn(a[0],a[1],a[2],a[3]).solve(mn(e,1,n,i))}return r}static parse(t,e){let[n,i,r,...a]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const t=i.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,zt),!r)return null;const o=[];let s=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||e.expectedType==qt?e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType):s=Bt;for(let l=0;l<a.length;l+=2){const t=a[l],n=a[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,s);if(!c)return null;s=s||c.type,o.push([t,c])}return ne(s,zt)||ne(s,Ut)||ne(s,Bt)||ne(s,Wt)||ne(s,Zt)||ne(s,qt)||ne(s,Yt)||ne(s,Kt(zt))?new fn(s,n,i,r,o):e.error("Type ".concat(Jt(s)," is not interpolatable."))}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const a=sn(e,i),o=fn.interpolationFactor(this.interpolation,i,e[a],e[a+1]),s=n[a].evaluate(t),l=n[a+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Te(s,l,o);case"color":return Ee.interpolate(s,l,o);case"padding":return ke.interpolate(s,l,o);case"colorArray":return De.interpolate(s,l,o);case"numberArray":return Re.interpolate(s,l,o);case"variableAnchorOffsetCollection":return Fe.interpolate(s,l,o);case"array":return Ae(s,l,o);case"projectionDefinition":return Be.interpolate(s,l,o)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ee.interpolate(s,l,o,"hcl");case"colorArray":return De.interpolate(s,l,o,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ee.interpolate(s,l,o,"lab");case"colorArray":return De.interpolate(s,l,o,"lab")}}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function mn(t,e,n,i){const r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}const gn={color:Ee.interpolate,number:Te,padding:ke.interpolate,numberArray:Re.interpolate,colorArray:De.interpolate,variableAnchorOffsetCollection:Fe.interpolate,array:Ae};class yn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const o of t.slice(1)){const t=e.parse(o,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}if(!n)throw new Error("No output type");const a=i&&r.some(t=>Qt(i,t.type));return new yn(a?Vt:n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof Oe&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function vn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function _n(t,e,n,i){return 0===i.compare(e,n)}function bn(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=Ot,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let a=e.parse(t[1],1,Vt);if(!a)return null;if(!vn(n,a.type))return e.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Jt(a.type),"'."));let o=e.parse(t[2],2,Vt);if(!o)return null;if(!vn(n,o.type))return e.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Jt(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '".concat(Jt(a.type),"' and '").concat(Jt(o.type),"'."));i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new qe(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new qe(a.type,[o])));let s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(s=e.parse(t[3],3,Ht),!s)return null}return new r(a,o,s)}evaluate(r){const a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=Ve(a),n=Ve(o);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new Ne('Expected arguments for "'.concat(t,'" to be (string, string) or (number, number), but found (').concat(e.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const t=Ve(a),n=Ve(o);if("string"!==t.kind||"string"!==n.kind)return e(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):e(r,a,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const xn=bn("==",function(t,e,n){return e===n},_n),wn=bn("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!_n(0,e,n,i)}),Sn=bn("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),Mn=bn(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),Tn=bn("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),An=bn(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class En{constructor(t,e,n){this.type=Ht,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Ot);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Ot);if(!r)return null;let a=null;return n.locale&&(a=e.parse(n.locale,1,Ft),!a)?null:new En(i,r,a)}evaluate(t){return new Ce(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Cn{constructor(t,e,n,i,r){this.type=Ft,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,zt);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,Ft),!r))return null;let a=null;if(i.currency&&(a=e.parse(i.currency,1,Ft),!a))return null;let o=null;if(i["min-fraction-digits"]&&(o=e.parse(i["min-fraction-digits"],1,zt),!o))return null;let s=null;return i["max-fraction-digits"]&&(s=e.parse(i["max-fraction-digits"],1,zt),!s)?null:new Cn(n,r,a,o,s)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Pn{constructor(t){this.type=Gt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let a=1;a<=t.length-1;++a){const n=t[a];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,zt),!t))return null;let a=null;if(n["text-font"]&&(a=e.parse(n["text-font"],1,Kt(Ft)),!a))return null;let o=null;if(n["text-color"]&&(o=e.parse(n["text-color"],1,Bt),!o))return null;let s=null;if(n["vertical-align"]){if("string"==typeof n["vertical-align"]&&!Pe.includes(n["vertical-align"]))return e.error("'vertical-align' must be one of: 'bottom', 'center', 'top' but found '".concat(n["vertical-align"],"' instead."));if(s=e.parse(n["vertical-align"],1,Ft),!s)return null}const l=i[i.length-1];l.scale=t,l.font=a,l.textColor=o,l.verticalAlign=s}else{const n=e.parse(t[a],1,Vt);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Pn(i)}evaluate(t){return new Le(this.sections.map(e=>{const n=e.content.evaluate(t);return Ve(n)===Xt?new Ie("",n,null,null,null,e.verticalAlign?e.verticalAlign.evaluate(t):null):new Ie(He(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null,e.verticalAlign?e.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor),e.verticalAlign&&t(e.verticalAlign)}outputDefined(){return!1}}class In{constructor(t){this.type=Xt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ft);return n?new In(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=Oe.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ln{constructor(t){this.type=zt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found ".concat(Jt(n.type)," instead.")):new Ln(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return[...e].length;if(Array.isArray(e))return e.length;throw new Ne("Expected value to be of type string or array, but found ".concat(Jt(Ve(e))," instead."))}eachChild(t){t(this.input)}outputDefined(){return!1}}const kn=8192;function Rn(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*kn),Math.round(i*r*kn)]}function Dn(t,e){const n=Math.pow(2,e.z);return[(r=(t[0]/kn+e.x)/n,360*r-180),(i=(t[1]/kn+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function Nn(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function zn(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fn(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],a=t[0]-n[0],o=t[1]-n[1];return i*o-a*r==0&&i*a<=0&&r*o<=0}function On(t,e,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(a=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*a[0]&&!(!Gn(t,e,n,i)||!Gn(n,i,t,e));var r,a}function Bn(t,e,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(On(t,e,i[n],i[n+1]))return!0;return!1}function Un(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(const s of e)for(let e=0;e<s.length-1;e++){if(Fn(t,s[e],s[e+1]))return n;(a=s[e])[1]>(r=t)[1]!=(o=s[e+1])[1]>r[1]&&r[0]<(o[0]-a[0])*(r[1]-a[1])/(o[1]-a[1])+a[0]&&(i=!i)}var r,a,o;return i}function jn(t,e){for(const n of e)if(Un(t,n))return!0;return!1}function Vn(t,e){for(const n of t)if(!Un(n,e))return!1;for(let n=0;n<t.length-1;++n)if(Bn(t[n],t[n+1],e))return!1;return!0}function Hn(t,e){for(const n of e)if(Vn(t,n))return!0;return!1}function Gn(t,e,n,i){const r=i[0]-n[0],a=i[1]-n[1],o=(t[0]-n[0])*a-r*(t[1]-n[1]),s=(e[0]-n[0])*a-r*(e[1]-n[1]);return o>0&&s<0||o<0&&s>0}function Wn(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=[];for(let i=0;i<t[r].length;i++){const o=Rn(t[r][i],n);Nn(e,o),a.push(o)}i.push(a)}return i}function qn(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=Wn(t[r],e,n);i.push(a)}return i}function Zn(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}Nn(e,t)}function Xn(t,e,n,i){const r=Math.pow(2,i.z)*kn,a=[i.x*kn,i.y*kn],o=[];for(const s of t)for(const t of s){const i=[t.x+a[0],t.y+a[1]];Zn(i,e,n,r),o.push(i)}return o}function Yn(t,e,n,i){const r=Math.pow(2,i.z)*kn,a=[i.x*kn,i.y*kn],o=[];for(const l of t){const t=[];for(const n of l){const i=[n.x+a[0],n.y+a[1]];Nn(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){(s=e)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const t of o)for(const i of t)Zn(i,e,n,r)}var s;return o}class Kn{constructor(t,e){this.type=Ot,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(je(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const n of e.features){const{type:e,coordinates:i}=n.geometry;"Polygon"===e&&t.push(i),"MultiPolygon"===e&&t.push(...i)}if(t.length)return new Kn(e,{type:"MultiPolygon",coordinates:t})}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Kn(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Kn(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=Wn(e.coordinates,i,r),o=Xn(t.geometry(),n,i,r);if(!zn(n,i))return!1;for(const t of o)if(!Un(t,a))return!1}if("MultiPolygon"===e.type){const a=qn(e.coordinates,i,r),o=Xn(t.geometry(),n,i,r);if(!zn(n,i))return!1;for(const t of o)if(!jn(t,a))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=Wn(e.coordinates,i,r),o=Yn(t.geometry(),n,i,r);if(!zn(n,i))return!1;for(const t of o)if(!Vn(t,a))return!1}if("MultiPolygon"===e.type){const a=qn(e.coordinates,i,r),o=Yn(t.geometry(),n,i,r);if(!zn(n,i))return!1;for(const t of o)if(!Hn(t,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Jn=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1);const a=i+1;if(a<this.length&&n(e[a],e[i])<0&&(i=a),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}};function $n(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ti;for(;i>n;){if(i-n>600){const a=i-n+1,o=e-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);$n(t,e,Math.max(n,Math.floor(e-o*l/a+c)),Math.min(i,Math.floor(e+(a-o)*l/a+c)),r)}const a=t[e];let o=n,s=i;for(Qn(t,n,e),r(t[i],a)>0&&Qn(t,n,i);o<s;){for(Qn(t,o,s),o++,s--;r(t[o],a)<0;)o++;for(;r(t[s],a)>0;)s--}0===r(t[n],a)?Qn(t,n,s):(s++,Qn(t,s,i)),s<=e&&(n=s+1),e<=s&&(i=s-1)}}function Qn(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function ti(t,e){return t<e?-1:t>e?1:0}function ei(t,e){if(t.length<=1)return[t];const n=[];let i,r;for(const a of t){const t=ii(a);0!==t&&(a.area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[a]):i.push(a))}if(i&&n.push(i),e>1)for(let a=0;a<n.length;a++)n[a].length<=e||($n(n[a],e,1,n[a].length-1,ni),n[a]=n[a].slice(0,e));return n}function ni(t,e){return e.area-t.area}function ii(t){let e=0;for(let n,i,r=0,a=t.length,o=a-1;r<a;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}const ri=1/298.257223563,ai=ri*(2-ri),oi=Math.PI/180;class si{constructor(t){const e=6378.137*oi*1e3,n=Math.cos(t*oi),i=1/(1-ai*(1-n*n)),r=Math.sqrt(i);this.kx=e*r*n,this.ky=e*r*i*(1-ai)}distance(t,e){const n=this.wrap(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(t,e){let n,i,r,a,o=1/0;for(let s=0;s<t.length-1;s++){let l=t[s][0],c=t[s][1],u=this.wrap(t[s+1][0]-l)*this.kx,h=(t[s+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=t[s+1][0],c=t[s+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<o&&(o=p,n=l,i=c,r=s,a=d)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,a))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function li(t,e){return e[0]-t[0]}function ci(t){return t[1]-t[0]+1}function ui(t,e){return t[1]>=t[0]&&t[1]<e}function hi(t,e){if(t[0]>t[1])return[null,null];const n=ci(t);if(e){if(2===n)return[t,null];const e=Math.floor(n/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}function di(t,e){if(!ui(e,t.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let i=e[0];i<=e[1];++i)Nn(n,t[i]);return n}function pi(t){const e=[1/0,1/0,-1/0,-1/0];for(const n of t)for(const t of n)Nn(e,t);return e}function fi(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function mi(t,e,n){if(!fi(t)||!fi(e))return NaN;let i=0,r=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),n.distance([0,0],[i,r])}function gi(t,e,n){const i=n.pointOnLine(e,t);return n.distance(t,i.point)}function yi(t,e,n,i,r){const a=Math.min(gi(t,[n,i],r),gi(e,[n,i],r)),o=Math.min(gi(n,[t,e],r),gi(i,[t,e],r));return Math.min(a,o)}function vi(t,e,n,i,r){if(!ui(e,t.length)||!ui(i,n.length))return 1/0;let a=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(let t=i[0];t<i[1];++t){const i=n[t],o=n[t+1];if(On(e,s,i,o))return 0;a=Math.min(a,yi(e,s,i,o,r))}}return a}function _i(t,e,n,i,r){if(!ui(e,t.length)||!ui(i,n.length))return NaN;let a=1/0;for(let o=e[0];o<=e[1];++o)for(let e=i[0];e<=i[1];++e)if(a=Math.min(a,r.distance(t[o],n[e])),0===a)return a;return a}function bi(t,e,n){if(Un(t,e,!0))return 0;let i=1/0;for(const r of e){const e=r[0],a=r[r.length-1];if(e!==a&&(i=Math.min(i,gi(t,[a,e],n)),0===i))return i;const o=n.pointOnLine(r,t);if(i=Math.min(i,n.distance(t,o.point)),0===i)return i}return i}function xi(t,e,n,i){if(!ui(e,t.length))return NaN;for(let a=e[0];a<=e[1];++a)if(Un(t[a],n,!0))return 0;let r=1/0;for(let a=e[0];a<e[1];++a){const e=t[a],o=t[a+1];for(const t of n)for(let n=0,a=t.length,s=a-1;n<a;s=n++){const a=t[s],l=t[n];if(On(e,o,a,l))return 0;r=Math.min(r,yi(e,o,a,l,i))}}return r}function wi(t,e){for(const n of t)for(const t of n)if(Un(t,e,!0))return!0;return!1}function Si(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=pi(t),a=pi(e);if(i!==1/0&&mi(r,a,n)>=i)return i;if(zn(r,a)){if(wi(t,e))return 0}else if(wi(e,t))return 0;let o=1/0;for(const s of t)for(let t=0,i=s.length,r=i-1;t<i;r=t++){const i=s[r],a=s[t];for(const t of e)for(let e=0,r=t.length,s=r-1;e<r;s=e++){const r=t[s],l=t[e];if(On(i,a,r,l))return 0;o=Math.min(o,yi(i,a,r,l,n))}}return o}function Mi(t,e,n,i,r,a){if(!a)return;const o=mi(di(i,a),r,n);o<e&&t.push([o,a,[0,0]])}function Ti(t,e,n,i,r,a,o){if(!a||!o)return;const s=mi(di(i,a),di(r,o),n);s<e&&t.push([s,a,o])}function Ai(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=Math.min(i.distance(t[0],n[0][0]),r);if(0===a)return a;const o=new Jn([[0,[0,t.length-1],[0,0]]],li),s=pi(n);for(;o.length>0;){const r=o.pop();if(r[0]>=a)continue;const l=r[1],c=e?50:100;if(ci(l)<=c){if(!ui(l,t.length))return NaN;if(e){const e=xi(t,l,n,i);if(isNaN(e)||0===e)return e;a=Math.min(a,e)}else for(let e=l[0];e<=l[1];++e){const r=bi(t[e],n,i);if(a=Math.min(a,r),0===a)return 0}}else{const n=hi(l,e);Mi(o,a,i,t,s,n[0]),Mi(o,a,i,t,s,n[1])}}return a}function Ei(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(a,r.distance(t[0],n[0]));if(0===o)return o;const s=new Jn([[0,[0,t.length-1],[0,n.length-1]]],li);for(;s.length>0;){const a=s.pop();if(a[0]>=o)continue;const l=a[1],c=a[2],u=e?50:100,h=i?50:100;if(ci(l)<=u&&ci(c)<=h){if(!ui(l,t.length)&&ui(c,n.length))return NaN;let a;if(e&&i)a=vi(t,l,n,c,r),o=Math.min(o,a);else if(e&&!i){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(a=gi(n[t],e,r),o=Math.min(o,a),0===o)return o}else if(!e&&i){const e=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(a=gi(t[n],e,r),o=Math.min(o,a),0===o)return o}else a=_i(t,l,n,c,r),o=Math.min(o,a)}else{const a=hi(l,e),u=hi(c,i);Ti(s,o,r,t,n,a[0],u[0]),Ti(s,o,r,t,n,a[0],u[1]),Ti(s,o,r,t,n,a[1],u[0]),Ti(s,o,r,t,n,a[1],u[1])}}return o}function Ci(t){return"MultiPolygon"===t.type?t.coordinates.map(t=>({type:"Polygon",coordinates:t})):"MultiLineString"===t.type?t.coordinates.map(t=>({type:"LineString",coordinates:t})):"MultiPoint"===t.type?t.coordinates.map(t=>({type:"Point",coordinates:t})):[t]}class Pi{constructor(t,e){this.type=zt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'distance' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(je(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new Pi(e,e.features.map(t=>Ci(t.geometry)).flat());if("Feature"===e.type)return new Pi(e,Ci(e.geometry));if("type"in e&&"coordinates"in e)return new Pi(e,Ci(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>Dn([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new si(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,Ei(i,!1,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,Ei(i,!1,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,Ai(i,!1,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>Dn([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new si(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,Ei(i,!0,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,Ei(i,!0,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,Ai(i,!0,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("Polygon"===t.geometryType())return function(t,e){const n=t.geometry();if(0===n.length||0===n[0].length)return NaN;const i=ei(n,0).map(e=>e.map(e=>e.map(e=>Dn([e.x,e.y],t.canonical)))),r=new si(i[0][0][0][1]);let a=1/0;for(const o of e)for(const t of i){switch(o.type){case"Point":a=Math.min(a,Ai([o.coordinates],!1,t,r,a));break;case"LineString":a=Math.min(a,Ai(o.coordinates,!0,t,r,a));break;case"Polygon":a=Math.min(a,Si(t,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ii{constructor(t){this.type=Vt,this.key=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=t[1];return null==n?e.error("Global state property must be defined."):"string"!=typeof n?e.error("Global state property must be string, but found ".concat(typeof t[1]," instead.")):new Ii(n)}evaluate(t){var e;const n=null===(e=t.globals)||void 0===e?void 0:e.globalState;return n&&0!==Object.keys(n).length?_e(n,this.key):null}eachChild(){}outputDefined(){return!1}}const Li={"==":xn,"!=":wn,">":Mn,"<":Sn,">=":An,"<=":Tn,array:qe,at:tn,boolean:qe,case:an,coalesce:yn,collator:En,format:Pn,image:In,in:en,"index-of":nn,interpolate:fn,"interpolate-hcl":fn,"interpolate-lab":fn,length:Ln,let:$e,literal:Ge,match:rn,number:qe,"number-format":Cn,object:qe,slice:on,step:ln,string:qe,"to-boolean":Xe,"to-color":Xe,"to-number":Xe,"to-string":Xe,var:Qe,within:Kn,distance:Pi,"global-state":Ii};class ki{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const n=t[0],i=ki.definitions[n];if(!i)return e.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(e=>{let[n]=e;return!Array.isArray(n)||n.length===t.length-1});let s=null;for(const[l,c]of o){s=new Je(e.registry,Fi,e.path,null,e.scope);const i=[];let a=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=s.parse(n,1+i.length,r);if(!o){a=!0;break}i.push(o)}if(!a)if(Array.isArray(l)&&l.length!==i.length)s.error("Expected ".concat(l.length," arguments, but found ").concat(i.length," instead."));else{for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];s.concat(t+1).checkSubtype(e,n.type)}if(0===s.errors.length)return new ki(n,r,c,i)}}if(1===o.length)e.errors.push(...s.errors);else{const n=(o.length?o:a).map(t=>{let[e]=t;return n=e,Array.isArray(n)?"(".concat(n.map(Jt).join(", "),")"):"(".concat(Jt(n.type),"...)");var n}).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(Jt(n.type))}e.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(t,e){ki.definitions=e;for(const n in e)t[n]=ki}}function Ri(t,e){let[n,i,r,a]=e;n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=a?a.evaluate(t):1,s=Ue(n,i,r,o);if(s)throw new Ne(s);return new Ee(n/255,i/255,r/255,o,!1)}function Di(t,e){return t in e}function Ni(t,e){const n=e[t];return void 0===n?null:n}function zi(t){return{type:t}}function Fi(t){if(t instanceof Qe)return Fi(t.boundExpression);if(t instanceof ki&&"error"===t.name)return!1;if(t instanceof En)return!1;if(t instanceof Kn)return!1;if(t instanceof Pi)return!1;if(t instanceof Ii)return!1;const e=t instanceof Xe||t instanceof qe;let n=!0;return t.eachChild(t=>{n=e?n&&Fi(t):n&&t instanceof Ge}),!!n&&Oi(t)&&Ui(t,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Oi(t){if(t instanceof ki){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Kn)return!1;if(t instanceof Pi)return!1;let e=!0;return t.eachChild(t=>{e&&!Oi(t)&&(e=!1)}),e}function Bi(t){if(t instanceof ki&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Bi(t)&&(e=!1)}),e}function Ui(t,e){if(t instanceof ki&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!Ui(t,e)&&(n=!1)}),n}function ji(t){return{result:"success",value:t}}function Vi(t){return{result:"error",value:t}}function Hi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Gi(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Wi(t){return!!t.expression&&t.expression.interpolated}function qi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Zi(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)&&Ve(t)===jt}function Xi(t){return t}function Yi(t,e){const n=t.stops&&"object"==typeof t.stops[0][0],i=n||!(n||void 0!==t.property),r=t.type||(Wi(e)?"exponential":"interval"),a=function(t){switch(t.type){case"color":return Ee.parse;case"padding":return ke.parse;case"numberArray":return Re.parse;case"colorArray":return De.parse;default:return null}}(e);if(a&&((t=kt({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],a(t[1])])),t.default=a(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==(o=t.colorSpace)&&"hcl"!==o&&"lab"!==o)throw new Error('Unknown color space: "'.concat(t.colorSpace,'"'));var o;const s=function(t){switch(t){case"exponential":return Qi;case"interval":return $i;case"categorical":return Ji;case"identity":return tr;default:throw new Error('Unknown function type "'.concat(t,'"'))}}(r);let l,c;if("categorical"===r){l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}if(n){const n={},i=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],a=r[0].zoom;void 0===n[a]&&(n[a]={zoom:a,type:t.type,property:t.property,default:t.default,stops:[]},i.push(a)),n[a].stops.push([r[0].value,r[1]])}const r=[];for(const t of i)r.push([n[t].zoom,Yi(n[t],e)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:fn.interpolationFactor.bind(void 0,a),zoomStops:r.map(t=>t[0]),evaluate:(n,i)=>{let{zoom:a}=n;return Qi({stops:r,base:t.base},e,a).evaluate(a,i)}}}if(i){const n="exponential"===r?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:fn.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map(t=>t[0]),evaluate:n=>{let{zoom:i}=n;return s(t,e,i,l,c)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[t.property]:void 0;return void 0===r?Ki(t.default,e.default):s(t,e,r,l,c)}}}function Ki(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Ji(t,e,n,i,r){return Ki(typeof n===r?i[n]:void 0,t.default,e.default)}function $i(t,e,n){if("number"!==qi(n))return Ki(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=sn(t.stops.map(t=>t[0]),n);return t.stops[r][1]}function Qi(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==qi(n))return Ki(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const a=sn(t.stops.map(t=>t[0]),n),o=function(t,e,n,i){const r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],l=t.stops[a+1][1],c=gn[e.type]||Xi;return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=s.evaluate.apply(void 0,n),a=l.evaluate.apply(void 0,n);if(void 0!==r&&void 0!==a)return c(r,a,o,t.colorSpace)}}:c(s,l,o,t.colorSpace)}function tr(t,e,n){switch(e.type){case"color":n=Ee.parse(n);break;case"formatted":n=Le.fromString(n.toString());break;case"resolvedImage":n=Oe.fromString(n.toString());break;case"padding":n=ke.parse(n);break;case"colorArray":n=De.parse(n);break;case"numberArray":n=Re.parse(n);break;default:qi(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0)}return Ki(n,t.default,e.default)}ki.register(Li,{error:[{kind:"error"},[Ft],(t,e)=>{let[n]=e;throw new Ne(n.evaluate(t))}],typeof:[Ft,[Vt],(t,e)=>{let[n]=e;return Jt(Ve(n.evaluate(t)))}],"to-rgba":[Kt(zt,4),[Bt],(t,e)=>{let[n]=e;const[i,r,a,o]=n.evaluate(t).rgb;return[255*i,255*r,255*a,o]}],rgb:[Bt,[zt,zt,zt],Ri],rgba:[Bt,[zt,zt,zt,zt],Ri],has:{type:Ot,overloads:[[[Ft],(t,e)=>{let[n]=e;return Di(n.evaluate(t),t.properties())}],[[Ft,jt],(t,e)=>{let[n,i]=e;return Di(n.evaluate(t),i.evaluate(t))}]]},get:{type:Vt,overloads:[[[Ft],(t,e)=>{let[n]=e;return Ni(n.evaluate(t),t.properties())}],[[Ft,jt],(t,e)=>{let[n,i]=e;return Ni(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[Vt,[Ft],(t,e)=>{let[n]=e;return Ni(n.evaluate(t),t.featureState||{})}],properties:[jt,[],t=>t.properties()],"geometry-type":[Ft,[],t=>t.geometryType()],id:[Vt,[],t=>t.id()],zoom:[zt,[],t=>t.globals.zoom],"heatmap-density":[zt,[],t=>t.globals.heatmapDensity||0],elevation:[zt,[],t=>t.globals.elevation||0],"line-progress":[zt,[],t=>t.globals.lineProgress||0],accumulated:[Vt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[zt,zi(zt),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[zt,zi(zt),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:zt,overloads:[[[zt,zt],(t,e)=>{let[n,i]=e;return n.evaluate(t)-i.evaluate(t)}],[[zt],(t,e)=>{let[n]=e;return-n.evaluate(t)}]]},"/":[zt,[zt,zt],(t,e)=>{let[n,i]=e;return n.evaluate(t)/i.evaluate(t)}],"%":[zt,[zt,zt],(t,e)=>{let[n,i]=e;return n.evaluate(t)%i.evaluate(t)}],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(t,e)=>{let[n,i]=e;return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[zt,[zt],(t,e)=>{let[n]=e;return Math.sqrt(n.evaluate(t))}],log10:[zt,[zt],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN10}],ln:[zt,[zt],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))}],log2:[zt,[zt],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN2}],sin:[zt,[zt],(t,e)=>{let[n]=e;return Math.sin(n.evaluate(t))}],cos:[zt,[zt],(t,e)=>{let[n]=e;return Math.cos(n.evaluate(t))}],tan:[zt,[zt],(t,e)=>{let[n]=e;return Math.tan(n.evaluate(t))}],asin:[zt,[zt],(t,e)=>{let[n]=e;return Math.asin(n.evaluate(t))}],acos:[zt,[zt],(t,e)=>{let[n]=e;return Math.acos(n.evaluate(t))}],atan:[zt,[zt],(t,e)=>{let[n]=e;return Math.atan(n.evaluate(t))}],min:[zt,zi(zt),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[zt,zi(zt),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[zt,[zt],(t,e)=>{let[n]=e;return Math.abs(n.evaluate(t))}],round:[zt,[zt],(t,e)=>{let[n]=e;const i=n.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[zt,[zt],(t,e)=>{let[n]=e;return Math.floor(n.evaluate(t))}],ceil:[zt,[zt],(t,e)=>{let[n]=e;return Math.ceil(n.evaluate(t))}],"filter-==":[Ot,[Ft,Vt],(t,e)=>{let[n,i]=e;return t.properties()[n.value]===i.value}],"filter-id-==":[Ot,[Vt],(t,e)=>{let[n]=e;return t.id()===n.value}],"filter-type-==":[Ot,[Ft],(t,e)=>{let[n]=e;return t.geometryType()===n.value}],"filter-<":[Ot,[Ft,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Ot,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Ot,[Ft,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Ot,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Ot,[Ft,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Ot,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Ot,[Ft,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Ot,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Ot,[Vt],(t,e)=>{let[n]=e;return n.value in t.properties()}],"filter-has-id":[Ot,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ot,[Kt(Ft)],(t,e)=>{let[n]=e;return n.value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ot,[Kt(Vt)],(t,e)=>{let[n]=e;return n.value.indexOf(t.id())>=0}],"filter-in-small":[Ot,[Ft,Kt(Vt)],(t,e)=>{let[n,i]=e;return i.value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Ot,[Ft,Kt(Vt)],(t,e)=>{let[n,i]=e;return function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Ot,overloads:[[[Ot,Ot],(t,e)=>{let[n,i]=e;return n.evaluate(t)&&i.evaluate(t)}],[zi(Ot),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(t,e)=>{let[n,i]=e;return n.evaluate(t)||i.evaluate(t)}],[zi(Ot),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Ot,[Ot],(t,e)=>{let[n]=e;return!n.evaluate(t)}],"is-supported-script":[Ot,[Ft],(t,e)=>{let[n]=e;const i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[Ft,[Ft],(t,e)=>{let[n]=e;return n.evaluate(t).toUpperCase()}],downcase:[Ft,[Ft],(t,e)=>{let[n]=e;return n.evaluate(t).toLowerCase()}],concat:[Ft,zi(Vt),(t,e)=>e.map(e=>He(e.evaluate(t))).join("")],"resolved-locale":[Ft,[Ht],(t,e)=>{let[n]=e;return n.evaluate(t).resolvedLocale()}]});class er{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Ke,this._defaultValue=e?function(t){if("color"===t.type&&Zi(t.default))return new Ee(0,0,0,0);switch(t.type){case"color":return Ee.parse(t.default)||null;case"padding":return ke.parse(t.default)||null;case"numberArray":return Re.parse(t.default)||null;case"colorArray":return De.parse(t.default)||null;case"variableAnchorOffsetCollection":return Fe.parse(t.default)||null;case"projectionDefinition":return Be.parse(t.default)||null;default:return void 0===t.default?null:t.default}}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Ne("Expected value to be one of ".concat(Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", "),", but found ").concat(JSON.stringify(t)," instead."));return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function nr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Li}function ir(t,e){const n=new Je(Li,Fi,[],e?function(t){const e={color:Bt,string:Ft,number:zt,enum:Ft,boolean:Ot,formatted:Gt,padding:Wt,numberArray:Zt,colorArray:qt,projectionDefinition:Ut,resolvedImage:Xt,variableAnchorOffsetCollection:Yt};return"array"===t.type?Kt(e[t.value]||Vt,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?ji(new er(i,e)):Vi(n.errors)}class rr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Bi(e.expression),this.globalStateRefs=cr(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}}class ar{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Bi(e.expression),this.globalStateRefs=cr(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}interpolationFactor(t,e,n){return this.interpolationType?fn.interpolationFactor(this.interpolationType,t,e,n):0}}function or(t,e){const n=ir(t,e);if("error"===n.result)return n;const i=n.value.expression,r=Oi(i);if(!r&&!Hi(e))return Vi([new Rt("","data expressions not supported")]);const a=Ui(i,["zoom"]);if(!a&&!Gi(e))return Vi([new Rt("","zoom expressions not supported")]);const o=lr(i);return o||a?o instanceof Rt?Vi([o]):o instanceof fn&&!Wi(e)?Vi([new Rt("",'"interpolate" expressions cannot be used with this property')]):ji(o?new ar(r?"camera":"composite",n.value,o.labels,o instanceof fn?o.interpolation:void 0):new rr(r?"constant":"source",n.value)):Vi([new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sr{constructor(t,e){this._parameters=t,this._specification=e,kt(this,Yi(this._parameters,this._specification))}static deserialize(t){return new sr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function lr(t){let e=null;if(t instanceof $e)e=lr(t.result);else if(t instanceof yn){for(const n of t.args)if(e=lr(n),e)break}else(t instanceof ln||t instanceof fn)&&t.input instanceof ki&&"zoom"===t.input.name&&(e=t);return e instanceof Rt||t.eachChild(t=>{const n=lr(t);n instanceof Rt?e=n:!e&&n?e=new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Rt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function cr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return t instanceof Ii&&e.add(t.key),t.eachChild(t=>{cr(t,e)}),e}function ur(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ur(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const hr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function dr(t){if(null==t)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ur(t)||(t=mr(t));const e=ir(t,hr);if("error"===e.result)throw new Error(e.value.map(t=>"".concat(t.key,": ").concat(t.message)).join(", "));return{filter:(t,n,i)=>e.value.evaluate(t,n,{},i),needGeometry:fr(t),getGlobalStateRefs:()=>cr(e.value.expression)}}function pr(t,e){return t<e?-1:t>e?1:0}function fr(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(fr(t[e]))return!0;return!1}function mr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?gr(t[1],t[2],"=="):"!="===e?_r(gr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?gr(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(mr))):"all"===e?["all"].concat(t.slice(1).map(mr)):"none"===e?["all"].concat(t.slice(1).map(mr).map(_r)):"in"===e?yr(t[1],t.slice(2)):"!in"===e?_r(yr(t[1],t.slice(2))):"has"===e?vr(t[1]):"!has"!==e||_r(vr(t[1]));var n}function gr(t,e,n){switch(t){case"$type":return["filter-type-".concat(n),e];case"$id":return["filter-id-".concat(n),e];default:return["filter-".concat(n),t,e]}}function yr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(pr)]]:["filter-in-small",t,["literal",e]]}}function vr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function _r(t){return["!",t]}function br(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const n of t)e+="".concat(br(n),",");return"".concat(e,"]")}const n=Object.keys(t).sort();let i="{";for(let r=0;r<n.length;r++)i+="".concat(JSON.stringify(n[r]),":").concat(br(t[n[r]]),",");return"".concat(i,"}")}function xr(t){let e="";for(const n of bt)e+="/".concat(br(t[n]));return e}function wr(t){const e=t.value;return e?[new Lt(t.key,e,"constants have been deprecated as of v8")]:[]}function Sr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Mr(t){if(Array.isArray(t))return t.map(Mr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Mr(t[n]);return e}return Sr(t)}function Tr(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=t.validateSpec;let l=[];const c=qi(n);if("object"!==c)return[new Lt(e,n,"object expected, ".concat(c," found"))];for(const u in n){const t=u.split(".")[0],c=_e(i,t)||i["*"];let h;if(_e(r,t))h=r[t];else if(_e(i,t))h=s;else if(r["*"])h=r["*"];else{if(!i["*"]){l.push(new Lt(e,n[u],'unknown property "'.concat(u,'"')));continue}h=s}l=l.concat(h({key:(e?"".concat(e,"."):e)+u,value:n[u],valueSpec:c,style:a,styleSpec:o,object:n,objectKey:u,validateSpec:s},n))}for(const u in i)r[u]||i[u].required&&void 0===i[u].default&&void 0===n[u]&&l.push(new Lt(e,n,'missing required property "'.concat(u,'"')));return l}function Ar(t){const e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,a=t.key,o=t.arrayElementValidator||t.validateSpec;if("array"!==qi(e))return[new Lt(a,e,"array expected, ".concat(qi(e)," found"))];if(n.length&&e.length!==n.length)return[new Lt(a,e,"array length ".concat(n.length," expected, length ").concat(e.length," found"))];if(n["min-length"]&&e.length<n["min-length"])return[new Lt(a,e,"array length at least ".concat(n["min-length"]," expected, length ").concat(e.length," found"))];let s={type:n.value,values:n.values};r.$version<7&&(s.function=n.function),"object"===qi(n.value)&&(s=n.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(o({array:e,arrayIndex:c,value:e[c],valueSpec:s,validateSpec:t.validateSpec,style:i,styleSpec:r,key:"".concat(a,"[").concat(c,"]")}));return l}function Er(t){const e=t.key,n=t.value,i=t.valueSpec;let r=qi(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new Lt(e,n,"number expected, ".concat(r," found"))]:"minimum"in i&&n<i.minimum?[new Lt(e,n,"".concat(n," is less than the minimum value ").concat(i.minimum))]:"maximum"in i&&n>i.maximum?[new Lt(e,n,"".concat(n," is greater than the maximum value ").concat(i.maximum))]:[]}function Cr(t){const e=t.valueSpec,n=Sr(t.value.type);let i,r,a,o={};const s="categorical"!==n&&void 0===t.value.property,l=!s,c="array"===qi(t.value.stops)&&"array"===qi(t.value.stops[0])&&"object"===qi(t.value.stops[0][0]),u=Tr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new Lt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(Ar({key:t.key,value:i,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===qi(i)&&0===i.length&&e.push(new Lt(t.key,i,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&s&&u.push(new Lt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new Lt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Wi(t.valueSpec)&&u.push(new Lt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Hi(t.valueSpec)?u.push(new Lt(t.key,t.value,"property functions not supported")):s&&!Gi(t.valueSpec)&&u.push(new Lt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==t.value.property||u.push(new Lt(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,s=t.key;if("array"!==qi(i))return[new Lt(s,i,"array expected, ".concat(qi(i)," found"))];if(2!==i.length)return[new Lt(s,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==qi(i[0]))return[new Lt(s,i,"object expected, ".concat(qi(i[0])," found"))];if(void 0===i[0].zoom)return[new Lt(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Lt(s,i,"object stop key must have value")];if(a&&a>Sr(i[0].zoom))return[new Lt(s,i[0].zoom,"stop zoom values must appear in ascending order")];Sr(i[0].zoom)!==a&&(a=Sr(i[0].zoom),r=void 0,o={}),n=n.concat(Tr({key:"".concat(s,"[0]"),value:i[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Er,value:d}}))}else n=n.concat(d({key:"".concat(s,"[0]"),value:i[0],validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},i));return nr(Mr(i[1]))?n.concat([new Lt("".concat(s,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(t.validateSpec({key:"".concat(s,"[1]"),value:i[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,a){const s=qi(t.value),l=Sr(t.value),c=null!==t.value?t.value:a;if(i){if(s!==i)return[new Lt(t.key,c,"".concat(s," stop domain type must match previous stop domain type ").concat(i))]}else i=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Lt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let i="number expected, ".concat(s," found");return Hi(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Lt(t.key,c,i)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==r&&l<r?[new Lt(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new Lt(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Lt(t.key,c,"integer expected, found ".concat(l))]}}function Pr(t){const e=("property"===t.expressionContext?or:ir)(Mr(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new Lt("".concat(t.key).concat(e.key),t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Lt(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Bi(n))return[new Lt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Bi(n))return[new Lt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ui(n,["zoom","feature-state"]))return[new Lt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Oi(n))return[new Lt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ir(t){const e=t.key,n=t.value,i=qi(n);return"string"!==i?[new Lt(e,n,"color expected, ".concat(i," found"))]:Ee.parse(String(n))?[]:[new Lt(e,n,'color expected, "'.concat(n,'" found'))]}function Lr(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Sr(n))&&r.push(new Lt(e,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(Sr(n))&&r.push(new Lt(e,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function kr(t){return ur(Mr(t.value))?Pr(kt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rr(t)}function Rr(t){const e=t.value,n=t.key;if("array"!==qi(e))return[new Lt(n,e,"array expected, ".concat(qi(e)," found"))];const i=t.styleSpec;let r,a=[];if(e.length<1)return[new Lt(n,e,"filter array must have at least 1 element")];switch(a=a.concat(Lr({key:"".concat(n,"[0]"),value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),Sr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Sr(e[1])&&a.push(new Lt(n,e,'"$type" cannot be use with operator "'.concat(e[0],'"')));case"==":case"!=":3!==e.length&&a.push(new Lt(n,e,'filter array for operator "'.concat(e[0],'" must have 3 elements')));case"in":case"!in":e.length>=2&&(r=qi(e[1]),"string"!==r&&a.push(new Lt("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found"))));for(let o=2;o<e.length;o++)r=qi(e[o]),"$type"===Sr(e[1])?a=a.concat(Lr({key:"".concat(n,"[").concat(o,"]"),value:e[o],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new Lt("".concat(n,"[").concat(o,"]"),e[o],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)a=a.concat(Rr({key:"".concat(n,"[").concat(i,"]"),value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=qi(e[1]),2!==e.length?a.push(new Lt(n,e,'filter array for "'.concat(e[0],'" operator must have 2 elements'))):"string"!==r&&a.push(new Lt("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found")))}return a}function Dr(t,e){const n=t.key,i=t.validateSpec,r=t.style,a=t.styleSpec,o=t.value,s=t.objectKey,l=a["".concat(e,"_").concat(t.layerType)];if(!l)return[];const c=s.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return i({key:n,value:o,valueSpec:a.transition,style:r,styleSpec:a});const u=t.valueSpec||l[s];if(!u)return[new Lt(n,o,'unknown property "'.concat(s,'"'))];let h;if("string"===qi(o)&&Hi(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(o)))return[new Lt(n,o,'"'.concat(s,'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": ').concat(JSON.stringify(h[1])," }`."))];const d=[];return"symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&d.push(new Lt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Zi(Mr(o))&&"identity"===Sr(o.type)&&d.push(new Lt(n,o,'"text-font" does not support identity functions'))),d.concat(i({key:t.key,value:o,valueSpec:u,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:s}))}function Nr(t){return Dr(t,"paint")}function zr(t){return Dr(t,"layout")}function Fr(t){let e=[];const n=t.value,i=t.key,r=t.style,a=t.styleSpec;if("object"!==qi(n))return[new Lt(i,n,"object expected, ".concat(qi(n)," found"))];n.type||n.ref||e.push(new Lt(i,n,'either "type" or "ref" is required'));let o=Sr(n.type);const s=Sr(n.ref);if(n.id){const a=Sr(n.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];Sr(t.id)===a&&e.push(new Lt(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new Lt(i,n[t],'"'.concat(t,'" is prohibited for ref layers')))}),r.layers.forEach(e=>{Sr(e.id)===s&&(t=e)}),t?t.ref?e.push(new Lt(i,n.ref,"ref cannot reference another ref layer")):o=Sr(t.type):e.push(new Lt(i,n.ref,'ref layer "'.concat(s,'" not found')))}else if("background"!==o)if(n.source){const t=r.sources&&r.sources[n.source],a=t&&Sr(t.type);t?"vector"===a&&"raster"===o?e.push(new Lt(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster-dem"!==a&&"hillshade"===o||"raster-dem"!==a&&"color-relief"===o?e.push(new Lt(i,n.source,'layer "'.concat(n.id,'" requires a raster-dem source'))):"raster"===a&&"raster"!==o?e.push(new Lt(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==o&&"color-relief"!==o?e.push(new Lt(i,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==o||!n.paint||!n.paint["line-gradient"]||"geojson"===a&&t.lineMetrics||e.push(new Lt(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):e.push(new Lt(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):e.push(new Lt(i,n.source,'source "'.concat(n.source,'" not found')))}else e.push(new Lt(i,n,'missing required property "source"'));return e=e.concat(Tr({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:"".concat(i,".type"),value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:n,objectKey:"type"}),filter:kr,layout:t=>Tr({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>zr(kt({layerType:o},t))}}),paint:t=>Tr({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Nr(kt({layerType:o},t))}})}})),e}function Or(t){const e=t.value,n=t.key,i=qi(e);return"string"!==i?[new Lt(n,e,"string expected, ".concat(i," found"))]:[]}const Br={promoteId:function(t){let{key:e,value:n}=t;if("string"===qi(n))return Or({key:e,value:n});{const t=[];for(const i in n)t.push(...Or({key:"".concat(e,".").concat(i),value:n[i]}));return t}}};function Ur(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style,a=t.validateSpec;if(!e.type)return[new Lt(n,e,'"type" is required')];const o=Sr(e.type);let s;switch(o){case"vector":case"raster":return s=Tr({key:n,value:e,valueSpec:i["source_".concat(o.replace("-","_"))],style:t.style,styleSpec:i,objectElementValidators:Br,validateSpec:a}),s;case"raster-dem":return s=function(t){var e;const n=null!==(e=t.sourceName)&&void 0!==e?e:"",i=t.value,r=t.styleSpec,a=r.source_raster_dem,o=t.style;let s=[];const l=qi(i);if(void 0===i)return s;if("object"!==l)return s.push(new Lt("source_raster_dem",i,"object expected, ".concat(l," found"))),s;const c="custom"===Sr(i.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?'"'.concat(t.value.encoding,'"'):"Default";for(const d in i)!c&&u.includes(d)?s.push(new Lt(d,i[d],'In "'.concat(n,'": "').concat(d,'" is only valid when "encoding" is set to "custom". ').concat(h," encoding found"))):a[d]?s=s.concat(t.validateSpec({key:d,value:i[d],valueSpec:a[d],validateSpec:t.validateSpec,style:o,styleSpec:r})):s.push(new Lt(d,i[d],'unknown property "'.concat(d,'"')));return s}({sourceName:n,value:e,style:t.style,styleSpec:i,validateSpec:a}),s;case"geojson":if(s=Tr({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,validateSpec:a,objectElementValidators:Br}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],a="string"==typeof i?[i,["accumulated"],["get",t]]:i;s.push(...Pr({key:"".concat(n,".").concat(t,".map"),value:r,expressionContext:"cluster-map"})),s.push(...Pr({key:"".concat(n,".").concat(t,".reduce"),value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return Tr({key:n,value:e,valueSpec:i.source_video,style:r,validateSpec:a,styleSpec:i});case"image":return Tr({key:n,value:e,valueSpec:i.source_image,style:r,validateSpec:a,styleSpec:i});case"canvas":return[new Lt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lr({key:"".concat(n,".type"),value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function jr(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let a=[];const o=qi(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new Lt("light",e,"object expected, ".concat(o," found"))]),a;for(const s in e){const o=s.match(/^(.*)-transition$/);a=a.concat(o&&i[o[1]]&&i[o[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:n.transition,validateSpec:t.validateSpec,style:r,styleSpec:n}):i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n}):[new Lt(s,e[s],'unknown property "'.concat(s,'"'))])}return a}function Vr(t){const e=t.value,n=t.styleSpec,i=n.sky,r=t.style,a=qi(e);if(void 0===e)return[];if("object"!==a)return[new Lt("sky",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=o.concat(i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n}):[new Lt(s,e[s],'unknown property "'.concat(s,'"'))]);return o}function Hr(t){const e=t.value,n=t.styleSpec,i=n.terrain,r=t.style;let a=[];const o=qi(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new Lt("terrain",e,"object expected, ".concat(o," found"))]),a;for(const s in e)a=a.concat(i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n}):[new Lt(s,e[s],'unknown property "'.concat(s,'"'))]);return a}function Gr(t){let e=[];const n=t.value,i=t.key;if(Array.isArray(n)){const r=[],a=[];for(const o in n)n[o].id&&r.includes(n[o].id)&&e.push(new Lt(i,n,"all the sprites' ids must be unique, but ".concat(n[o].id," is duplicated"))),r.push(n[o].id),n[o].url&&a.includes(n[o].url)&&e.push(new Lt(i,n,"all the sprites' URLs must be unique, but ".concat(n[o].url," is duplicated"))),a.push(n[o].url),e=e.concat(Tr({key:"".concat(i,"[").concat(o,"]"),value:n[o],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return Or({key:i,value:n})}function Wr(t){return e=t.value,Boolean(e)&&e.constructor===Object?[]:[new Lt(t.key,t.value,"object expected, ".concat(qi(t.value)," found"))];var e}const qr={"*":()=>[],array:Ar,boolean:function(t){const e=t.value,n=t.key,i=qi(e);return"boolean"!==i?[new Lt(n,e,"boolean expected, ".concat(i," found"))]:[]},number:Er,color:Ir,constants:wr,enum:Lr,filter:kr,function:Cr,layer:Fr,object:Tr,source:Ur,light:jr,sky:Vr,terrain:Hr,projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,r=t.style,a=qi(e);if(void 0===e)return[];if("object"!==a)return[new Lt("projection",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=o.concat(i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n}):[new Lt(s,e[s],'unknown property "'.concat(s,'"'))]);return o},projectionDefinition:function(t){const e=t.key;let n=t.value;n=n instanceof String?n.valueOf():n;const i=qi(n);return"array"!==i||function(t){return Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]}(n)||function(t){return!!["interpolate","step","literal"].includes(t[0])}(n)?["array","string"].includes(i)?[]:[new Lt(e,n,'projection expected, invalid type "'.concat(i,'" found'))]:[new Lt(e,n,"projection expected, invalid array ".concat(JSON.stringify(n)," found"))]},string:Or,formatted:function(t){return 0===Or(t).length?[]:Pr(t)},resolvedImage:function(t){return 0===Or(t).length?[]:Pr(t)},padding:function(t){const e=t.key,n=t.value;if("array"===qi(n)){if(n.length<1||n.length>4)return[new Lt(e,n,"padding requires 1 to 4 values; ".concat(n.length," values found"))];const i={type:"number"};let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return Er({key:e,value:n,valueSpec:{}})},numberArray:function(t){const e=t.key,n=t.value;if("array"===qi(n)){const i={type:"number"};if(n.length<1)return[new Lt(e,n,"array length at least 1 expected, length 0 found")];let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return Er({key:e,value:n,valueSpec:{}})},colorArray:function(t){const e=t.key,n=t.value;if("array"===qi(n)){if(n.length<1)return[new Lt(e,n,"array length at least 1 expected, length 0 found")];let t=[];for(let i=0;i<n.length;i++)t=t.concat(Ir({key:"".concat(e,"[").concat(i,"]"),value:n[i]}));return t}return Ir({key:e,value:n})},variableAnchorOffsetCollection:function(t){const e=t.key,n=t.value,i=qi(n),r=t.styleSpec;if("array"!==i||n.length<1||n.length%2!=0)return[new Lt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let o=0;o<n.length;o+=2)a=a.concat(Lr({key:"".concat(e,"[").concat(o,"]"),value:n[o],valueSpec:r.layout_symbol["text-anchor"]})),a=a.concat(Ar({key:"".concat(e,"[").concat(o+1,"]"),value:n[o+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:r}));return a},sprite:Gr,state:Wr};function Zr(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return t.validateSpec=Zr,n.expression&&Zi(Sr(e))?Cr(t):n.expression&&nr(Mr(e))?Pr(t):n.type&&qr[n.type]?qr[n.type](t):Tr(kt({},t,{valueSpec:n.type?i[n.type]:n}))}function Xr(t){const e=t.value,n=t.key,i=Or(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new Lt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Lt(n,e,'"glyphs" url must include a "{range}" token'))),i}function Yr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_t,n=[];return n=n.concat(Zr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:Zr,objectElementValidators:{glyphs:Xr,"*":()=>[]}})),t.constants&&(n=n.concat(wr({key:"constants",value:t.constants}))),Jr(n)}function Kr(t){return function(e){return t(i(i({},e),{},{validateSpec:Zr}))}}function Jr(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function $r(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Jr(t.apply(this,n))}}Yr.source=$r(Kr(Ur)),Yr.sprite=$r(Kr(Gr)),Yr.glyphs=$r(Kr(Xr)),Yr.light=$r(Kr(jr)),Yr.sky=$r(Kr(Vr)),Yr.terrain=$r(Kr(Hr)),Yr.state=$r(Kr(Wr)),Yr.layer=$r(Kr(Fr)),Yr.filter=$r(Kr(kr)),Yr.paintProperty=$r(Kr(Nr)),Yr.layoutProperty=$r(Kr(zr));const Qr=Yr,ta=Qr.light,ea=Qr.sky,na=Qr.paintProperty,ia=Qr.layoutProperty;function ra(t,e){let n=!1;if(e&&e.length)for(const i of e)t.fire(new yt(new Error(i.message))),n=!0;return n}class aa{constructor(t,e,n){const i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(let t=0;t<this.d*this.d;t++){const e=r[3+t],n=r[3+t+1];i.push(e===n?null:r.subarray(e,n))}const a=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],a),this.bboxes=r.subarray(a),this.insert=this._insertReadonly}else{this.d=e+2*n;for(let t=0;t<this.d*this.d;t++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;const r=n/e*t;this.min=-r,this.max=t+r}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,n,i,r,a){this.cells[r].push(a)}query(t,e,n,i,r){const a=this.min,o=this.max;if(t<=a&&e<=a&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);{const a=[];return this._forEachCell(t,e,n,i,this._queryCell,a,{},r),a}}_queryCell(t,e,n,i,r,a,o,s){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===o[h]){const l=4*h;(s?s(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&n>=c[l+0]&&i>=c[l+1])?(o[h]=!0,a.push(r[h])):o[h]=!1}}}}_forEachCell(t,e,n,i,r,a,o,s){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,t,e,n,i,c,a,o,s))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let n=0;for(let a=0;a<this.cells.length;a++)n+=this.cells[a].length;const i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let r=e;for(let a=0;a<t.length;a++){const e=t[a];i[3+a]=r,i.set(e,r),r+=e.length}return i[3+t.length]=r,i.set(this.keys,r),r+=this.keys.length,i[3+t.length+1]=r,i.set(this.bboxes,r),r+=this.bboxes.length,i.buffer}static serialize(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}}static deserialize(t){return new aa(t.buffer)}}const oa={};function sa(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(oa[t])throw new Error("".concat(t," is already registered."));Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),oa[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}sa("Object",Object),sa("Set",Set),sa("TransferableGridIndex",aa),sa("Color",Ee),sa("Error",Error),sa("AJAXError",ut),sa("ResolvedImage",Oe),sa("StylePropertyFunction",sr),sa("StyleExpression",er,{omit:["_evaluator"]}),sa("ZoomDependentExpression",ar),sa("ZoomConstantExpression",rr),sa("CompoundExpression",ki,{omit:["_evaluate"]});for(const i in Li)Li[i]._classRegistryKey||sa("Expression_".concat(i),Li[i]);function la(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ca(t){return t.$name||t.constructor._classRegistryKey}function ua(t){return!function(t){if(null===t||"object"!=typeof t)return!1;const e=ca(t);return!(!e||"Object"===e)}(t)&&(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||t instanceof Error||la(t)||Y(t)||ArrayBuffer.isView(t)||t instanceof ImageData)}function ha(t,e){if(ua(t))return(la(t)||Y(t))&&e&&e.push(t),ArrayBuffer.isView(t)&&e&&e.push(t.buffer),t instanceof ImageData&&e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(ha(i,e));return n}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);const n=ca(t);if(!n)throw new Error("can't serialize object of unregistered class ".concat(t.constructor.name));if(!oa[n])throw new Error("".concat(n," is not registered."));const{klass:i}=oa[n],r=i.serialize?i.serialize(t,e):{};if(i.serialize){if(e&&r===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const i in t){if(!t.hasOwnProperty(i))continue;if(oa[n].omit.indexOf(i)>=0)continue;const a=t[i];r[i]=oa[n].shallow.indexOf(i)>=0?a:ha(a,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}function da(t){if(ua(t))return t;if(Array.isArray(t))return t.map(da);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);const e=ca(t)||"Object";if(!oa[e])throw new Error("can't deserialize unregistered class ".concat(e));const{klass:n}=oa[e];if(!n)throw new Error("can't deserialize unregistered class ".concat(e));if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const r of Object.keys(t)){if("$name"===r)continue;const n=t[r];i[r]=oa[e].shallow.indexOf(r)>=0?n:da(n)}return i}class pa{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const fa={"Latin-1 Supplement":t=>t>=128&&t<=255,"Hangul Jamo":t=>t>=4352&&t<=4607,Khmer:t=>t>=6016&&t<=6143,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Kanbun:t=>t>=12688&&t<=12703,"CJK Strokes":t=>t>=12736&&t<=12783,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Hangul Syllables":t=>t>=44032&&t<=55215,"Private Use Area":t=>t>=57344&&t<=63743,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ma(t){for(const e of t)if(xa(e.charCodeAt(0)))return!0;return!1}function ga(t){for(const e of t)if(!_a(e.charCodeAt(0)))return!1;return!0}function ya(t){const e=t.map(t=>{try{return new RegExp("\\p{sc=".concat(t,"}"),"u").source}catch(t){return null}}).filter(t=>t);return new RegExp(e.join("|"),"u")}const va=ya(["Arab","Dupl","Mong","Ougr","Syrc"]);function _a(t){return!va.test(String.fromCodePoint(t))}const ba=ya(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function xa(t){return!(746!==t&&747!==t&&(t<4352||!(fa["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||fa["CJK Compatibility"](t)||fa["CJK Strokes"](t)||!(!fa["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||fa["Enclosed CJK Letters and Months"](t)||fa["Ideographic Description Characters"](t)||fa.Kanbun(t)||fa.Katakana(t)&&12540!==t||!(!fa["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!fa["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||fa["Vertical Forms"](t)||fa["Yijing Hexagram Symbols"](t)||/(?:[\u1400-\u167F\u18B0-\u18F5]|\uD806[\uDEB0-\uDEBF])/.test(String.fromCodePoint(t))||/[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/.test(String.fromCodePoint(t))||ba.test(String.fromCodePoint(t)))))}function wa(t){return!(xa(t)||function(t){return!!(fa["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||fa["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||fa["Letterlike Symbols"](t)||fa["Number Forms"](t)||fa["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||fa["Control Pictures"](t)&&9251!==t||fa["Optical Character Recognition"](t)||fa["Enclosed Alphanumerics"](t)||fa["Geometric Shapes"](t)||fa["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||fa["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||fa["CJK Symbols and Punctuation"](t)||fa.Katakana(t)||fa["Private Use Area"](t)||fa["CJK Compatibility Forms"](t)||fa["Small Form Variants"](t)||fa["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}const Sa=ya(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ma(t){return Sa.test(String.fromCodePoint(t))}function Ta(t,e){return!(!e&&Ma(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||fa.Khmer(t))}function Aa(t){for(const e of t)if(Ma(e.charCodeAt(0)))return!0;return!1}const Ea=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(t){this.pluginStatus=t.pluginStatus,this.pluginURL=t.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(t){if(Ea.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=t.applyArabicShaping,this.processBidirectionalText=t.processBidirectionalText,this.processStyledBidirectionalText=t.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(t,n){return e(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==t.pluginStatus)return this.setState(t),t;const e=t.pluginURL,i=new Promise(t=>{this.loadScriptResolve=t});n(e);const r=new Promise(t=>setTimeout(()=>t(),this.TIMEOUT));if(yield Promise.race([i,r]),this.isParsed()){const t={pluginStatus:"loaded",pluginURL:e};return this.setState(t),t}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from ".concat(e))})}};class Ca{constructor(t,e){this.zoom=t,e?(this.now=e.now||0,this.fadeDuration=e.fadeDuration||0,this.zoomHistory=e.zoomHistory||new pa,this.transition=e.transition||{},this.globalState=e.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pa,this.transition={},this.globalState={})}isSupportedScript(t){return function(t,e){for(const n of t)if(!Ta(n.charCodeAt(0),e))return!1;return!0}(t,"loaded"===Ea.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class Pa{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Zi(t))return new sr(t,e);if(nr(t)){const n=or(t,e);if("error"===n.result)throw new Error(n.value.map(t=>"".concat(t.key,": ").concat(t.message)).join(", "));return n.value}{let n=t;return"color"===e.type&&"string"==typeof t?n=Ee.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"numberArray"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"colorArray"!==e.type||"string"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)?n=Fe.parse(t):"projectionDefinition"===e.type&&"string"==typeof t&&(n=Be.parse(t)):n=De.parse(t):n=Re.parse(t):n=ke.parse(t),{globalStateRefs:new Set,kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class Ia{constructor(t){this.property=t,this.value=new Pa(t,void 0)}transitioned(t,e){return new ka(this.property,this.value,e,B({},t.transition,this.transition),t.now)}untransitioned(){return new ka(this.property,this.value,null,{},0)}}class La{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return H(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ia(this._values[t].property)),this._values[t].value=new Pa(this._values[t].property,null===e?void 0:H(e))}getTransition(t){return H(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ia(this._values[t].property)),this._values[t].transition=H(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const i=this.getTransition(e);void 0!==i&&(t["".concat(e,"-transition")]=i)}return t}transitioned(t,e){const n=new Ra(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(t,e._values[i]);return n}untransitioned(){const t=new Ra(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class ka{constructor(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const i=t.now||0,r=this.value.possiblyEvaluate(t,e,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return a.possiblyEvaluate(t,e,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t,e,n),r,D(o))}}return r}}class Ra{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const i=new za(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Da{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return H(this._values[t].value)}setValue(t,e){this._values[t]=new Pa(this._values[t].property,null===e?void 0:H(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const i=new za(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}}class Na{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,i){return this.property.evaluate(this.value,this.parameters,t,e,n,i)}}class za{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Fa{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,n){const i=gn[this.specification.type];return i?i(t,e,n):t}}class Oa{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,i){return new Na(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,i)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Na(this,{kind:"constant",value:void 0},t.parameters);const i=gn[this.specification.type];if(i){const r=i(t.value.value,e.value.value,n);return new Na(this,{kind:"constant",value:r},t.parameters)}return t}evaluate(t,e,n,i,r,a){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r,a)}}class Ba extends Oa{possiblyEvaluate(t,e,n,i){if(void 0===t.value)return new Na(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i),a="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(a,a,a,e);return new Na(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Na(this,{kind:"constant",value:n},e)}return new Na(this,t.expression,e)}evaluate(t,e,n,i,r,a){if("source"===t.kind){const o=t.evaluate(e,n,i,r,a);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class Ua{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Ca(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Ca(Math.floor(e.zoom),e)),t.expression.evaluate(new Ca(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class ja{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){return!!t.expression.evaluate(e,null,{},n,i)}interpolate(){return!1}}class Va{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const i=this.defaultPropertyValues[e]=new Pa(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new Ia(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}}}sa("DataDrivenProperty",Oa),sa("DataConstantProperty",Fa),sa("CrossFadedDataDrivenProperty",Ba),sa("CrossFadedProperty",Ua),sa("ColorRampProperty",ja);const Ha="-transition";class Ga extends vt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=dr(t.filter)),e.layout&&(this._unevaluatedLayout=new Da(e.layout)),e.paint)){this._transitionablePaint=new La(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new za(e.paint)}}setFilter(t){this.filter=t,this._featureFilter=dr(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const e in this._unevaluatedLayout._values){const n=this._unevaluatedLayout._values[e];for(const e of n.getGlobalStateRefs())t.add(e)}for(const e of this._featureFilter.getGlobalStateRefs())t.add(e);return t}setLayoutProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=e&&this._validate(ia,"layers.".concat(this.id,".layout.").concat(t),t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(Ha)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e&&this._validate(na,"layers.".concat(this.id,".paint.").concat(t),t,e,n))return!1;if(t.endsWith(Ha))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const o=this._transitionablePaint._values[t].value;return o.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(t,a,o)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),V(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&ra(this,t.call(Qr,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Na&&Hi(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Wa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qa{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Za{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xa(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:t.map(t=>{const r=Wa[t.type].BYTES_PER_ELEMENT,a=n=Ya(n,Math.max(e,r)),o=t.components||1;return i=Math.max(i,r),n+=r*o,{name:t.name,type:t.type,components:o,offset:a}}),size:Ya(n,Math.max(i,e)),alignment:e}}function Ya(t,e){return Math.ceil(t/e)*e}class Ka extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t}}Ka.prototype.bytesPerElement=4,sa("StructArrayLayout2i4",Ka);class Ja extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t}}Ja.prototype.bytesPerElement=6,sa("StructArrayLayout3i6",Ja);class $a extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const a=4*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,t}}$a.prototype.bytesPerElement=8,sa("StructArrayLayout4i8",$a);class Qa extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t}}Qa.prototype.bytesPerElement=12,sa("StructArrayLayout2i4i12",Qa);class to extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=4*t,l=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[l+4]=i,this.uint8[l+5]=r,this.uint8[l+6]=a,this.uint8[l+7]=o,t}}to.prototype.bytesPerElement=8,sa("StructArrayLayout2i4ub8",to);class eo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t}}eo.prototype.bytesPerElement=8,sa("StructArrayLayout2f8",eo);class no extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,a,o,s,l,c)}emplace(t,e,n,i,r,a,o,s,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}no.prototype.bytesPerElement=20,sa("StructArrayLayout10ui20",no);class io extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,n,i,r,a,o,s,l,c,u,h)}emplace(t,e,n,i,r,a,o,s,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}io.prototype.bytesPerElement=24,sa("StructArrayLayout4i4ui4i24",io);class ro extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}ro.prototype.bytesPerElement=12,sa("StructArrayLayout3f12",ro);class ao extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}ao.prototype.bytesPerElement=4,sa("StructArrayLayout1ul4",ao);class oo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,i,r,a,o,s,l)}emplace(t,e,n,i,r,a,o,s,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+3]=r,this.int16[u+4]=a,this.int16[u+5]=o,this.uint32[h+3]=s,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}oo.prototype.bytesPerElement=20,sa("StructArrayLayout6i1ul2ui20",oo);class so extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t}}so.prototype.bytesPerElement=12,sa("StructArrayLayout2i2i2i12",so);class lo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r)}emplace(t,e,n,i,r,a){const o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[s+6]=r,this.int16[s+7]=a,t}}lo.prototype.bytesPerElement=16,sa("StructArrayLayout2f1f2i16",lo);class co extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=16*t,l=4*t,c=8*t;return this.uint8[s+0]=e,this.uint8[s+1]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.int16[c+6]=a,this.int16[c+7]=o,t}}co.prototype.bytesPerElement=16,sa("StructArrayLayout2ub2f2i16",co);class uo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t}}uo.prototype.bytesPerElement=6,sa("StructArrayLayout3ui6",uo);class ho extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g)}emplace(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y){const v=24*t,_=12*t,b=48*t;return this.int16[v+0]=e,this.int16[v+1]=n,this.uint16[v+2]=i,this.uint16[v+3]=r,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[v+10]=l,this.uint16[v+11]=c,this.uint16[v+12]=u,this.float32[_+7]=h,this.float32[_+8]=d,this.uint8[b+36]=p,this.uint8[b+37]=f,this.uint8[b+38]=m,this.uint32[_+10]=g,this.int16[v+22]=y,t}}ho.prototype.bytesPerElement=48,sa("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ho);class po extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M,T,A,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M,T,A,E)}emplace(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M,T,A,E,C){const P=32*t,I=16*t;return this.int16[P+0]=e,this.int16[P+1]=n,this.int16[P+2]=i,this.int16[P+3]=r,this.int16[P+4]=a,this.int16[P+5]=o,this.int16[P+6]=s,this.int16[P+7]=l,this.uint16[P+8]=c,this.uint16[P+9]=u,this.uint16[P+10]=h,this.uint16[P+11]=d,this.uint16[P+12]=p,this.uint16[P+13]=f,this.uint16[P+14]=m,this.uint16[P+15]=g,this.uint16[P+16]=y,this.uint16[P+17]=v,this.uint16[P+18]=_,this.uint16[P+19]=b,this.uint16[P+20]=x,this.uint16[P+21]=w,this.uint16[P+22]=S,this.uint32[I+12]=M,this.float32[I+13]=T,this.float32[I+14]=A,this.uint16[P+30]=E,this.uint16[P+31]=C,t}}po.prototype.bytesPerElement=64,sa("StructArrayLayout8i15ui1ul2f2ui64",po);class fo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}fo.prototype.bytesPerElement=4,sa("StructArrayLayout1f4",fo);class mo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[6*t+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}mo.prototype.bytesPerElement=12,sa("StructArrayLayout1ui2f12",mo);class go extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=n,this.uint16[r+3]=i,t}}go.prototype.bytesPerElement=8,sa("StructArrayLayout1ul2ui8",go);class yo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t}}yo.prototype.bytesPerElement=4,sa("StructArrayLayout2ui4",yo);class vo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}vo.prototype.bytesPerElement=2,sa("StructArrayLayout1ui2",vo);class _o extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const a=4*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,t}}_o.prototype.bytesPerElement=16,sa("StructArrayLayout4f16",_o);class bo extends qa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new n(this.anchorPointX,this.anchorPointY)}}bo.prototype.size=20;class xo extends oo{get(t){return new bo(this,t)}}sa("CollisionBoxArray",xo);class wo extends qa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}wo.prototype.size=48;class So extends ho{get(t){return new wo(this,t)}}sa("PlacedSymbolArray",So);class Mo extends qa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Mo.prototype.size=64;class To extends po{get(t){return new Mo(this,t)}}sa("SymbolInstanceArray",To);class Ao extends fo{getoffsetX(t){return this.float32[1*t+0]}}sa("GlyphOffsetArray",Ao);class Eo extends Ja{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}sa("SymbolLineVertexArray",Eo);class Co extends qa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Co.prototype.size=12;class Po extends mo{get(t){return new Co(this,t)}}sa("TextAnchorOffsetArray",Po);class Io extends qa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Io.prototype.size=8;class Lo extends go{get(t){return new Io(this,t)}}sa("FeatureIndexArray",Lo);class ko extends Ka{}class Ro extends Ka{}class Do extends Ka{}class No extends Qa{}class zo extends to{}class Fo extends eo{}class Oo extends no{}class Bo extends io{}class Uo extends ro{}class jo extends ao{}class Vo extends so{}class Ho extends co{}class Go extends uo{}class Wo extends yo{}const qo=Xa([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zo}=qo;class Xo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,e,n,i){const r=this.segments[this.segments.length-1];return t>Xo.MAX_VERTEX_ARRAY_LENGTH&&W("Max vertices per segment is ".concat(Xo.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t,". Consider using the `fillLargeMeshArrays` function if you require meshes with more than ").concat(Xo.MAX_VERTEX_ARRAY_LENGTH," vertices.")),this._forceNewSegmentOnNextPrepare||!r||r.vertexLength+t>Xo.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i?this.createNewSegment(e,n,i):r}createNewSegment(t,e,n){const i={vertexOffset:t.length,primitiveOffset:e.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==n&&(i.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(i),i}getOrCreateLatestSegment(t,e,n){return this.prepareSegment(0,t,e,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,i){return new Xo([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function Yo(t,e){return 256*(t=F(Math.floor(t),0,255))+F(Math.floor(e),0,255)}Xo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,sa("SegmentVector",Xo);const Ko=Xa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jo,$o,Qo,ts={exports:{}},es={exports:{}},ns={exports:{}},is=function(){if(Qo)return ts.exports;Qo=1;var t=(Jo||(Jo=1,es.exports=function(t,e){var n,i,r,a,o,s,l,c;for(i=t.length-(n=3&t.length),r=e,o=3432918353,s=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(a=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}),es.exports),e=($o||($o=1,ns.exports=function(t,e){for(var n,i=t.length,r=e^i,a=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:r^=(255&t.charCodeAt(a+2))<<16;case 2:r^=(255&t.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}),ns.exports);return ts.exports=t,ts.exports.murmur3=t,ts.exports.murmur2=e,ts.exports}(),rs=r(is);class as{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,i){this.ids.push(os(t)),this.positions.push(e,n,i)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=os(t);let n=0,i=this.ids.length-1;for(;n<i;){const t=n+i>>1;this.ids[t]>=e?i=t:n=t+1}const r=[];for(;this.ids[n]===e;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(t,e){const n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return ss(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(t){const e=new as;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function os(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:rs(String(t))}function ss(t,e,n,i){for(;n<i;){const r=t[n+i>>1];let a=n-1,o=i+1;for(;;){do{a++}while(t[a]<r);do{o--}while(t[o]>r);if(a>=o)break;ls(t,a,o),ls(e,3*a,3*o),ls(e,3*a+1,3*o+1),ls(e,3*a+2,3*o+2)}o-n<i-o?(ss(t,e,n,o),n=o+1):(ss(t,e,o+1,i),i=o)}}function ls(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}sa("FeaturePositionMap",as);class cs{constructor(t,e){this.gl=t.gl,this.location=e}}class us extends cs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class hs extends cs{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ds extends cs{constructor(t,e){super(t,e),this.current=Ee.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ps=new Float32Array(16);function fs(t){return[Yo(255*t.r,255*t.g),Yo(255*t.b,255*t.a)]}class ms{constructor(t,e,n){this.value=t,this.uniformNames=e.map(t=>"u_".concat(t)),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new ds(t,e):new us(t,e)}}class gs{constructor(t,e){this.uniformNames=e.map(t=>"u_".concat(t)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,n,i){const r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,n){return"u_pattern"===n.substr(0,9)?new hs(t,e):new us(t,e)}}class ys{constructor(t,e,n,i){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_".concat(t),type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(t,e,n,i,r){const a=this.paintVertexArray.length,o=this.expression.evaluate(new Ca(0),e,{},i,[],r);this.paintVertexArray.resize(t),this._setPaintValue(a,t,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(t,e,r)}_setPaintValue(t,e,n){if("color"===this.type){const i=fs(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vs{constructor(t,e,n,i,r,a){this.expression=t,this.uniformNames=e.map(t=>"u_".concat(t,"_t")),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_".concat(t),type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,e,n,i,r){const a=this.expression.evaluate(new Ca(this.zoom),e,{},i,[],r),o=this.expression.evaluate(new Ca(this.zoom+1),e,{},i,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,a,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),a=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(t,e,r,a)}_setPaintValue(t,e,n,i){if("color"===this.type){const r=fs(n),a=fs(i);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1],a[0],a[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,i=F(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(i)}getBinding(t,e,n){return new us(t,e)}}class _s{constructor(t,e,n,i,r,a){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=i,this.layerId=a,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,e,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,i,r){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(t,e,n,i){if(!i||!n)return;const{min:r,mid:a,max:o}=n,s=i[r],l=i[a],c=i[o];if(s&&l&&c)for(let u=t;u<e;u++)this.zoomInPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ko.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ko.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bs{constructor(t,e,n){this.binders={},this._buffers=[];const i=[];for(const r in t.paint._values){if(!n(r))continue;const a=t.paint.get(r);if(!(a instanceof Na&&Hi(a.property.specification)))continue;const o=ws(r,t.type),s=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,u=a.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[r]=h?new gs(s.value,o):new ms(s.value,o,l),i.push("/u_".concat(r));else if("source"===s.kind||h){const n=Ss(r,l,"source");this.binders[r]=h?new _s(s,l,c,e,n,t.id):new ys(s,o,l,n),i.push("/a_".concat(r))}else{const t=Ss(r,l,"composite");this.binders[r]=new vs(s,o,l,c,e,t),i.push("/z_".concat(r))}}this.cacheKey=i.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof ys||e instanceof vs?e.maxValue:0}populatePaintArrays(t,e,n,i,r){for(const a in this.binders){const o=this.binders[a];(o instanceof ys||o instanceof vs||o instanceof _s)&&o.populatePaintArray(t,e,n,i,r)}}setConstantPatternPositions(t,e){for(const n in this.binders){const i=this.binders[n];i instanceof gs&&i.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,i,r){let a=!1;for(const o in t){const s=e.getPositions(o);for(const e of s){const s=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof ys||l instanceof vs||l instanceof _s)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(e.start,e.end,s,t[o],r),a=!0}}}}return a}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof ms||n instanceof gs)&&t.push(...n.uniformNames.map(t=>"#define HAS_UNIFORM_".concat(t)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof ys||n instanceof vs)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name);else if(n instanceof _s)for(let e=0;e<Ko.members.length;e++)t.push(Ko.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof ms||n instanceof gs||n instanceof vs)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof ms||r instanceof gs||r instanceof vs)for(const a of r.uniformNames)if(e[a]){const o=r.getBinding(t,e[a],a);n.push({name:a,property:i,binding:o})}}return n}setUniforms(t,e,n,i){for(const{name:r,property:a,binding:o}of e)this.binders[a].setUniform(o,i,n.get(a),r)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof _s){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof ys||n instanceof vs)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof ys||n instanceof vs||n instanceof _s)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof ys||e instanceof vs||e instanceof _s)&&e.destroy()}}}class xs{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new bs(i,e,n);this.needsUpload=!1,this._featureMap=new as,this._bufferOffset=0}populatePaintArrays(t,e,n,i,r,a){for(const o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,i,r,a);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ws(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace("".concat(e,"-"),"").replace(/-/g,"_")]}function Ss(t,e,n){const i={color:{source:eo,composite:_o},number:{source:fo,composite:eo}},r=function(t){return{"line-pattern":{source:Oo,composite:Oo},"fill-pattern":{source:Oo,composite:Oo},"fill-extrusion-pattern":{source:Oo,composite:Oo}}[t]}(t);return r&&r[n]||i[e][n]}sa("ConstantBinder",ms),sa("CrossFadedConstantBinder",gs),sa("SourceExpressionBinder",ys),sa("CrossFadedCompositeBinder",_s),sa("CompositeExpressionBinder",vs),sa("ProgramConfiguration",bs,{omit:["_buffers"]}),sa("ProgramConfigurationSet",xs);const Ms=Math.pow(2,14)-1,Ts=-Ms-1;function As(t){const e=I/t.extent,n=t.loadGeometry();for(let i=0;i<n.length;i++){const t=n[i];for(let n=0;n<t.length;n++){const i=t[n],r=Math.round(i.x*e),a=Math.round(i.y*e);i.x=F(r,Ts,Ms),i.y=F(a,Ts,Ms),(r<i.x||r>i.x+1||a<i.y||a>i.y+1)&&W("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Es(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?As(t):[]}}const Cs=-32768;function Ps(t,e,n,i,r){t.emplaceBack(Cs+8*e+i,Cs+8*n+r)}class Is{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ro,this.indexArray=new Go,this.segments=new Xo,this.programConfigurations=new xs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){const i=this.layers[0],r=[];let a=null,o=!1,s="heatmap"===i.type;if("circle"===i.type){const t=i;a=t.layout.get("circle-sort-key"),o=!a.isConstant(),s=s||"map"===t.paint.get("circle-pitch-alignment")}const l=s?e.subdivisionGranularity.circle:1;for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Es(c,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),e,n))continue;const i=o?a.evaluate(e,{},n):void 0,s={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:t?e.geometry:As(c),patterns:{},sortKey:i};r.push(s)}o&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const c of r){const{geometry:i,index:r,sourceLayerIndex:a}=c,o=t[r].feature;this.addFeature(c,i,r,n,l),e.featureIndex.insert(o,i,r,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i){let r,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;switch(a){case 1:r=[0,7];break;case 3:r=[0,2,5,7];break;case 5:r=[0,1,3,4,6,7];break;case 7:r=[0,1,2,3,4,5,6,7];break;default:throw new Error("Invalid circle bucket granularity: ".concat(a,"; valid values are 1, 3, 5, 7."))}const o=r.length;for(const s of e)for(const e of s){const n=e.x,i=e.y;if(n<0||n>=I||i<0||i>=I)continue;const a=this.segments.prepareSegment(o*o,this.layoutVertexArray,this.indexArray,t.sortKey),s=a.vertexLength;for(let t=0;t<o;t++)for(let e=0;e<o;e++)Ps(this.layoutVertexArray,n,i,r[e],r[t]);for(let t=0;t<o-1;t++)for(let e=0;e<o-1;e++){const n=s+t*o+e,i=s+(t+1)*o+e;this.indexArray.emplaceBack(n,i+1,n+1),this.indexArray.emplaceBack(n,i,i+1)}a.vertexLength+=o*o,a.primitiveLength+=(o-1)*(o-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},i)}}function Ls(t,e){for(let n=0;n<t.length;n++)if(Us(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Us(t,e[n]))return!0;return!!Ns(t,e)}function ks(t,e,n){return!!Us(t,e)||!!Fs(e,t,n)}function Rs(t,e){if(1===t.length)return Bs(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++)if(Us(t,i[e]))return!0}for(let n=0;n<t.length;n++)if(Bs(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ns(t,e[n]))return!0;return!1}function Ds(t,e,n){if(t.length>1){if(Ns(t,e))return!0;for(let i=0;i<e.length;i++)if(Fs(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Fs(t[i],e,n))return!0;return!1}function Ns(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)if(zs(i,r,e[t],e[t+1]))return!0}return!1}function zs(t,e,n,i){return q(t,n,i)!==q(e,n,i)&&q(t,e,n)!==q(t,e,i)}function Fs(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(Os(t,e[r-1],e[r])<i)return!0;return!1}function Os(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function Bs(t,e){let n,i,r,a=!1;for(let o=0;o<t.length;o++){n=t[o];for(let t=0,o=n.length-1;t<n.length;o=t++)i=n[t],r=n[o],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(a=!a)}return a}function Us(t,e){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const a=t[i],o=t[r];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function js(t,e,n){const i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;const a=q(t,e,n[0]);return a!==q(t,e,n[1])||a!==q(t,e,n[2])||a!==q(t,e,n[3])}function Vs(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Hs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Gs(t,e,i,r,a){if(!e[0]&&!e[1])return t;const o=n.convert(e)._mult(a);"viewport"===i&&o._rotate(-r);const s=[];for(let n=0;n<t.length;n++)s.push(t[n].sub(o));return s}let Ws,qs;sa("CircleBucket",Is,{omit:["layers"]});var Zs={get paint(){return qs=qs||new Va({"circle-radius":new Oa(_t.paint_circle["circle-radius"]),"circle-color":new Oa(_t.paint_circle["circle-color"]),"circle-blur":new Oa(_t.paint_circle["circle-blur"]),"circle-opacity":new Oa(_t.paint_circle["circle-opacity"]),"circle-translate":new Fa(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new Fa(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fa(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fa(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Oa(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Oa(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Oa(_t.paint_circle["circle-stroke-opacity"])})},get layout(){return Ws=Ws||new Va({"circle-sort-key":new Oa(_t.layout_circle["circle-sort-key"])})}};class Xs extends Ga{constructor(t){super(t,Zs)}createBucket(t){return new Is(t)}queryRadius(t){const e=t;return Vs("circle-radius",this,e)+Vs("circle-stroke-width",this,e)+Hs(this.paint.get("circle-translate"))}queryIntersectsFeature(t){let{queryGeometry:e,feature:n,featureState:i,geometry:r,transform:a,pixelsToTileUnits:o,unwrappedTileID:s,getElevation:l}=t;const c=Gs(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-a.bearingInRadians,o),u=this.paint.get("circle-radius").evaluate(n,i)+this.paint.get("circle-stroke-width").evaluate(n,i),h="map"===this.paint.get("circle-pitch-alignment"),d=h?c:function(t,e,n,i){return t.map(t=>Ys(t,e,n,i))}(c,a,s,l),p=h?u*o:u;for(const f of r)for(const t of f){const e=h?t:Ys(t,a,s,l);let n=p;const i=a.projectTileCoordinates(t.x,t.y,s,l).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?n*=i/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(n*=a.cameraToCenterDistance/i),ks(d,e,n))return!0}return!1}}function Ys(t,e,i,r){const a=e.projectTileCoordinates(t.x,t.y,i,r).point;return new n((.5*a.x+.5)*e.width,(.5*-a.y+.5)*e.height)}class Ks extends Is{}let Js;sa("HeatmapBucket",Ks,{omit:["layers"]});var $s={get paint(){return Js=Js||new Va({"heatmap-radius":new Oa(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Oa(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fa(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ja(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fa(_t.paint_heatmap["heatmap-opacity"])})}};function Qs(t,e,n,i){let{width:r,height:a}=e;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*a*n)throw new RangeError("mismatched image size. expected: ".concat(i.length," but got: ").concat(r*a*n))}else i=new Uint8Array(r*a*n);return t.width=r,t.height=a,t.data=i,t}function tl(t,e,n){let{width:i,height:r}=e;if(i===t.width&&r===t.height)return;const a=Qs({},{width:i,height:r},n);el(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=a.data}function el(t,e,n,i,r,a){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,s=e.data;if(o===s)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<r.height;l++){const c=((n.y+l)*t.width+n.x)*a,u=((i.y+l)*e.width+i.x)*a;for(let t=0;t<r.width*a;t++)s[u+t]=o[c+t]}return e}class nl{constructor(t,e){Qs(this,t,1,e)}resize(t){tl(this,t,1)}clone(){return new nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){el(t,e,n,i,r,1)}}class il{constructor(t,e){Qs(this,t,4,e)}resize(t){tl(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){el(t,e,n,i,r,4)}setPixel(t,e,n){const i=4*(t*this.width+e);this.data[i+0]=Math.round(255*n.r/n.a),this.data[i+1]=Math.round(255*n.g/n.a),this.data[i+2]=Math.round(255*n.b/n.a),this.data[i+3]=Math.round(255*n.a)}}function rl(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new il({width:n,height:i});if(Math.log(n)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - ".concat(n));const a=(i,a,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);r.setPixel(i/4/n,a/4,s)};if(t.clips)for(let o=0,s=0;o<i;++o,s+=4*n)for(let e=0,i=0;e<n;e++,i+=4){const r=e/(n-1),{start:l,end:c}=t.clips[o];a(s,i,l*(1-r)+c*r)}else for(let o=0,s=0;o<n;o++,s+=4)a(0,s,o/(n-1));return r}sa("AlphaImage",nl),sa("RGBAImage",il);const al="big-fb";class ol extends Ga{createBucket(t){return new Ks(t)}constructor(t){super(t,$s),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(al)&&this.heatmapFbos.delete(al)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let sl;var ll={get paint(){return sl=sl||new Va({"hillshade-illumination-direction":new Fa(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Fa(_t.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Fa(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fa(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fa(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fa(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fa(_t.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Fa(_t.paint_hillshade["hillshade-method"])})}};class cl extends Ga{constructor(t){super(t,ll),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,e=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,i=this.paint.get("hillshade-shadow-color").values;const r=Math.max(t.length,e.length,n.length,i.length);t=t.concat(Array(r-t.length).fill(t.at(-1))),e=e.concat(Array(r-e.length).fill(e.at(-1))),n=n.concat(Array(r-n.length).fill(n.at(-1))),i=i.concat(Array(r-i.length).fill(i.at(-1)));const a=e.map(et);return{directionRadians:t.map(et),altitudeRadians:a,shadowColor:i,highlightColor:n}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let ul;var hl={get paint(){return ul=ul||new Va({"color-relief-opacity":new Fa(_t["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ja(_t["paint_color-relief"]["color-relief-color"])})}};class dl{constructor(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)}update(t,e,n){const{width:i,height:r}=t,a=!(this.size&&this.size[0]===i&&this.size[1]===r||n),{context:o}=this,{gl:s}=o;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[i,r],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Y(t)?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,r,0,this.format,s.UNSIGNED_BYTE,t.data);else{const{x:e,y:a}=n||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Y(t)?s.texSubImage2D(s.TEXTURE_2D,0,e,a,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,e,a,i,r,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D),o.pixelStoreUnpackFlipY.setDefault(),o.pixelStoreUnpack.setDefault(),o.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,e,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class pl{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void W('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".'));this.stride=e.height;const s=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=r,this.blueFactor=a,this.baseShift=o;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let l=0;l<s;l++)this.data[this._idx(-1,l)]=this.data[this._idx(0,l)],this.data[this._idx(s,l)]=this.data[this._idx(s-1,l)],this.data[this._idx(l,-1)]=this.data[this._idx(l,0)],this.data[this._idx(l,s)]=this.data[this._idx(l,s-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(s,-1)]=this.data[this._idx(s-1,0)],this.data[this._idx(-1,s)]=this.data[this._idx(0,s-1)],this.data[this._idx(s,s)]=this.data[this._idx(s-1,s-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let l=0;l<s;l++)for(let t=0;t<s;t++){const e=this.get(l,t);e>this.max&&(this.max=e),e<this.min&&(this.min=e)}}get(t,e){const n=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return this.unpack(n[i],n[i+1],n[i+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,n){return t*this.redFactor+e*this.greenFactor+n*this.blueFactor-this.baseShift}pack(t){return fl(t,this.getUnpackVector())}getPixels(){return new il({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,r=e*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}const s=-e*this.dim,l=-n*this.dim;for(let c=a;c<o;c++)for(let e=i;e<r;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+s,c+l)]}}function fl(t,e){const n=e[0],i=e[1],r=e[2],a=e[3],o=Math.min(n,i,r),s=Math.round((t+a)/o);return{r:Math.floor(s*o/n)%256,g:Math.floor(s*o/i)%256,b:Math.floor(s*o/r)%256}}sa("DEMData",pl);class ml extends Ga{constructor(t){super(t,hl)}_createColorRamp(t){const e={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof rr&&n._styleExpression.expression instanceof fn){this.colorRampExpression=n;const t=n._styleExpression.expression;e.elevationStops=t.labels,e.colorStops=[];for(const n of e.elevationStops)e.colorStops.push(t.evaluate({globals:{elevation:n}}))}if(e.elevationStops.length<1&&(e.elevationStops=[0],e.colorStops=[Ee.transparent]),e.elevationStops.length<2&&(e.elevationStops.push(e.elevationStops[0]+1),e.colorStops.push(e.colorStops[0])),e.elevationStops.length<=t)return e;const i={elevationStops:[],colorStops:[]},r=(e.elevationStops.length-1)/(t-1);for(let a=0;a<e.elevationStops.length-.5;a+=r)i.elevationStops.push(e.elevationStops[Math.round(a)]),i.colorStops.push(e.colorStops[Math.round(a)]);return W("Too many colors in specification of ".concat(this.id," color-relief layer, may not render properly.")),i}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,e,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const i=this._createColorRamp(e),r=new il({width:i.colorStops.length,height:1}),a=new il({width:i.colorStops.length,height:1});for(let o=0;o<i.elevationStops.length;o++){const t=fl(i.elevationStops[o],n);a.setPixel(0,o,new Ee(t.r/255,t.g/255,t.b/255,1)),r.setPixel(0,o,i.colorStops[o])}return this.colorRampTextures={elevationTexture:new dl(t,a,t.gl.RGBA),colorTexture:new dl(t,r,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}}const gl=Xa([{name:"a_pos",components:2,type:"Int16"}],4),{members:yl}=gl;function vl(t,e,n){const i=n.patternDependencies;let r=!1;for(const a of e){const e=a.paint.get("".concat(t,"-pattern"));e.isConstant()||(r=!0);const n=e.constantOr(null);n&&(r=!0,i[n.to]=!0,i[n.from]=!0)}return r}function _l(t,e,n,i,r){const a=r.patternDependencies;for(const o of e){const e=o.paint.get("".concat(t,"-pattern")).value;if("constant"!==e.kind){let t=e.evaluate({zoom:i-1},n,{},r.availableImages),s=e.evaluate({zoom:i},n,{},r.availableImages),l=e.evaluate({zoom:i+1},n,{},r.availableImages);t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,l=l&&l.name?l.name:l,a[t]=!0,a[s]=!0,a[l]=!0,n.patterns[o.id]={min:t,mid:s,max:l}}}return n}function bl(t,e,n,i,r){let a;if(r===function(t,e,n,i){let r=0;for(let a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(let o=e;o<n;o+=i)a=Vl(o/i|0,t[o],t[o+1],a);else for(let o=n-i;o>=e;o-=i)a=Vl(o/i|0,t[o],t[o+1],a);return a&&zl(a,a.next)&&(Hl(a),a=a.next),a}function xl(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!zl(i,i.next)&&0!==Nl(i.prev,i,i.next))i=i.next;else{if(Hl(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function wl(t,e,n,i,r,a,o){if(!t)return;!o&&a&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=Il(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n=1;do{let i,r=t;t=null;let a=null;for(e=0;r;){e++;let o=r,s=0;for(let t=0;t<n&&(s++,o=o.nextZ,o);t++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||r.z<=o.z)?(i=r,r=r.nextZ,s--):(i=o,o=o.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=o}a.nextZ=null,n*=2}while(e>1)}(r)}(t,i,r,a);let s=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(a?Ml(t,i,r,a):Sl(t))e.push(l.i,t.i,c.i),Hl(t),t=c.next,s=c.next;else if((t=c)===s){o?1===o?wl(t=Tl(xl(t),e),e,n,i,r,a,2):2===o&&Al(t,e,n,i,r,a):wl(xl(t),e,n,i,r,a,1);break}}}function Sl(t){const e=t.prev,n=t,i=t.next;if(Nl(e,n,i)>=0)return!1;const r=e.x,a=n.x,o=i.x,s=e.y,l=n.y,c=i.y,u=Math.min(r,a,o),h=Math.min(s,l,c),d=Math.max(r,a,o),p=Math.max(s,l,c);let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Rl(r,s,a,l,o,c,f.x,f.y)&&Nl(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ml(t,e,n,i){const r=t.prev,a=t,o=t.next;if(Nl(r,a,o)>=0)return!1;const s=r.x,l=a.x,c=o.x,u=r.y,h=a.y,d=o.y,p=Math.min(s,l,c),f=Math.min(u,h,d),m=Math.max(s,l,c),g=Math.max(u,h,d),y=Il(p,f,e,n,i),v=Il(m,g,e,n,i);let _=t.prevZ,b=t.nextZ;for(;_&&_.z>=y&&b&&b.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&Rl(s,u,l,h,c,d,_.x,_.y)&&Nl(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&Rl(s,u,l,h,c,d,b.x,b.y)&&Nl(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&Rl(s,u,l,h,c,d,_.x,_.y)&&Nl(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&Rl(s,u,l,h,c,d,b.x,b.y)&&Nl(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Tl(t,e){let n=t;do{const i=n.prev,r=n.next.next;!zl(i,r)&&Fl(i,n,n.next,r)&&Ul(i,r)&&Ul(r,i)&&(e.push(i.i,n.i,r.i),Hl(n),Hl(n.next),n=t=r),n=n.next}while(n!==t);return xl(n)}function Al(t,e,n,i,r,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Dl(o,t)){let s=jl(o,t);return o=xl(o,o.next),s=xl(s,s.next),wl(o,e,n,i,r,a,0),void wl(s,e,n,i,r,a,0)}t=t.next}o=o.next}while(o!==t)}function El(t,e){let n=t.x-e.x;return 0===n&&(n=t.y-e.y,0===n)&&(n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function Cl(t,e){const n=function(t,e){let n=e;const i=t.x,r=t.y;let a,o=-1/0;if(zl(t,n))return n;do{if(zl(t,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o&&(o=t,a=n.x<n.next.x?n:n.next,t===i))return a}n=n.next}while(n!==e);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(i>=n.x&&n.x>=l&&i!==n.x&&kl(r<c?i:o,r,l,c,r<c?o:i,r,n.x,n.y)){const e=Math.abs(r-n.y)/(i-n.x);Ul(n,t)&&(e<u||e===u&&(n.x>a.x||n.x===a.x&&Pl(a,n)))&&(a=n,u=e)}n=n.next}while(n!==s);return a}(t,e);if(!n)return e;const i=jl(n,t);return xl(i,i.next),xl(n,n.next)}function Pl(t,e){return Nl(t.prev,t,e.prev)<0&&Nl(e.next,t,t.next)<0}function Il(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ll(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function kl(t,e,n,i,r,a,o,s){return(r-o)*(e-s)>=(t-o)*(a-s)&&(t-o)*(i-s)>=(n-o)*(e-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function Rl(t,e,n,i,r,a,o,s){return!(t===o&&e===s)&&kl(t,e,n,i,r,a,o,s)}function Dl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Fl(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ul(t,e)&&Ul(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Nl(t.prev,t,e.prev)||Nl(t,e.prev,e))||zl(t,e)&&Nl(t.prev,t,t.next)>0&&Nl(e.prev,e,e.next)>0)}function Nl(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function zl(t,e){return t.x===e.x&&t.y===e.y}function Fl(t,e,n,i){const r=Bl(Nl(t,e,n)),a=Bl(Nl(t,e,i)),o=Bl(Nl(n,i,t)),s=Bl(Nl(n,i,e));return r!==a&&o!==s||!(0!==r||!Ol(t,n,e))||!(0!==a||!Ol(t,i,e))||!(0!==o||!Ol(n,t,i))||!(0!==s||!Ol(n,e,i))}function Ol(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Bl(t){return t>0?1:t<0?-1:0}function Ul(t,e){return Nl(t.prev,t,t.next)<0?Nl(t,e,t.next)>=0&&Nl(t,t.prev,e)>=0:Nl(t,e,t.prev)<0||Nl(t,t.next,e)<0}function jl(t,e){const n=Gl(t.i,t.x,t.y),i=Gl(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Vl(t,e,n,i){const r=Gl(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Hl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gl(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Wl{constructor(t,e){if(e>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=e}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class ql{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}ql.noSubdivision=new ql({fill:new Wl(0,0),line:new Wl(0,0),tile:new Wl(0,0),stencil:new Wl(0,0),circle:1}),sa("SubdivisionGranularityExpression",Wl),sa("SubdivisionGranularitySetting",ql);const Zl=-32768,Xl=32767;class Yl{constructor(t,e){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=I/t,this._canonical=e}_getKey(t,e){return(t+=32768)<<16|e+32768}_vertexToIndex(t,e){if(t<-32768||e<-32768||t>32767||e>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const n=0|Math.round(t),i=0|Math.round(e),r=this._getKey(n,i);if(this._vertexDictionary.has(r))return this._vertexDictionary.get(r);const a=this._vertexBuffer.length/2;return this._vertexDictionary.set(r,a),this._vertexBuffer.push(n,i),a}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(t,e){const n=[];for(let i=0;i<e.length;i+=3){const r=e[i],a=e[i+1],o=e[i+2],s=t[2*r],l=t[2*r+1];(t[2*a]-s)*(t[2*o+1]-l)-(t[2*a+1]-l)*(t[2*o]-s)>0?(n.push(r),n.push(o),n.push(a)):(n.push(r),n.push(a),n.push(o))}return n}(this._vertexBuffer,t);const e=[],n=t.length;for(let i=0;i<n;i+=3){const n=[t[i+0],t[i+1],t[i+2]],r=[this._vertexBuffer[2*t[i+0]+0],this._vertexBuffer[2*t[i+0]+1],this._vertexBuffer[2*t[i+1]+0],this._vertexBuffer[2*t[i+1]+1],this._vertexBuffer[2*t[i+2]+0],this._vertexBuffer[2*t[i+2]+1]];let a=1/0,o=1/0,s=-1/0,l=-1/0;for(let t=0;t<3;t++){const e=r[2*t],n=r[2*t+1];a=Math.min(a,e),s=Math.max(s,e),o=Math.min(o,n),l=Math.max(l,n)}if(a===s||o===l)continue;const c=Math.floor(a/this._granularityCellSize),u=Math.ceil(s/this._granularityCellSize),h=Math.floor(o/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let t=h;t<d;t++){const i=this._scanlineGenerateVertexRingForCellRow(t,r,n);$l(this._vertexBuffer,i,e)}else e.push(...n)}return e}_scanlineGenerateVertexRingForCellRow(t,e,n){const i=t*this._granularityCellSize,r=i+this._granularityCellSize,a=[];for(let o=0;o<3;o++){const t=e[2*o],s=e[2*o+1],l=e[2*(o+1)%6],c=e[(2*(o+1)+1)%6],u=e[2*(o+2)%6],h=e[(2*(o+2)+1)%6],d=l-t,p=c-s,f=0===d,m=0===p,g=(i-s)/p,y=(r-s)/p,v=Math.min(g,y),_=Math.max(g,y);if(!m&&(v>=1||_<=0)||m&&(s<i||s>r)){c>=i&&c<=r&&a.push(n[(o+1)%3]);continue}!m&&v>0&&a.push(this._vertexToIndex(t+d*v,s+p*v));const b=t+d*Math.max(v,0),x=t+d*Math.min(_,1);f||this._generateIntraEdgeVertices(a,t,s,l,c,b,x),!m&&_<1&&a.push(this._vertexToIndex(t+d*_,s+p*_)),(m||c>=i&&c<=r)&&a.push(n[(o+1)%3]),!m&&(c<=i||c>=r)&&this._generateInterEdgeVertices(a,t,s,l,c,u,h,x,i,r)}return a}_generateIntraEdgeVertices(t,e,n,i,r,a,o){const s=i-e,l=r-n,c=0===l,u=c?Math.min(e,i):Math.min(a,o),h=c?Math.max(e,i):Math.max(a,o),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?e<i:a<o)for(let f=d;f<=p;f++){const i=f*this._granularityCellSize;t.push(this._vertexToIndex(i,n+l*(i-e)/s))}else for(let f=p;f>=d;f--){const i=f*this._granularityCellSize;t.push(this._vertexToIndex(i,n+l*(i-e)/s))}}_generateInterEdgeVertices(t,e,n,i,r,a,o,s,l,c){const u=r-n,h=a-i,d=o-r,p=(l-r)/d,f=(c-r)/d,m=Math.min(p,f),g=Math.max(p,f),y=i+h*m;let v=Math.floor(Math.min(y,s)/this._granularityCellSize)+1,_=Math.ceil(Math.max(y,s)/this._granularityCellSize)-1,b=s<y;const x=0===d;if(x&&(o===l||o===c))return;if(x||m>=1||g<=0){const t=n-o,i=a+(e-a)*Math.min((l-o)/t,(c-o)/t);v=Math.floor(Math.min(i,s)/this._granularityCellSize)+1,_=Math.ceil(Math.max(i,s)/this._granularityCellSize)-1,b=s<i}const w=u>0?c:l;if(b)for(let S=v;S<=_;S++)t.push(this._vertexToIndex(S*this._granularityCellSize,w));else for(let S=_;S>=v;S--)t.push(this._vertexToIndex(S*this._granularityCellSize,w))}_generateOutline(t){const e=[];for(const n of t){const t=Jl(n,this._granularity,!0),i=this._pointArrayToIndices(t),r=[];for(let e=1;e<i.length;e++)r.push(i[e-1]),r.push(i[e]);e.push(r)}return e}_handlePoles(t){let e=!1,n=!1;this._canonical&&(0===this._canonical.y&&(e=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(e||n)&&this._fillPoles(t,e,n)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let e=0;e<t.length;e+=2){const n=t[e+1];n===Zl&&(t[e+1]=-32767),n===Xl&&(t[e+1]=32766)}}_generatePoleQuad(t,e,n,i,r,a){i>r!=(a===Zl)?(t.push(e),t.push(n),t.push(this._vertexToIndex(i,a)),t.push(n),t.push(this._vertexToIndex(r,a)),t.push(this._vertexToIndex(i,a))):(t.push(n),t.push(e),t.push(this._vertexToIndex(i,a)),t.push(this._vertexToIndex(r,a)),t.push(n),t.push(this._vertexToIndex(i,a)))}_fillPoles(t,e,n){const i=this._vertexBuffer,r=I,a=t.length;for(let o=2;o<a;o+=3){const a=t[o-2],s=t[o-1],l=t[o],c=i[2*a],u=i[2*a+1],h=i[2*s],d=i[2*s+1],p=i[2*l],f=i[2*l+1];e&&(0===u&&0===d&&this._generatePoleQuad(t,a,s,c,h,Zl),0===d&&0===f&&this._generatePoleQuad(t,s,l,h,p,Zl),0===f&&0===u&&this._generatePoleQuad(t,l,a,p,c,Zl)),n&&(u===r&&d===r&&this._generatePoleQuad(t,a,s,c,h,Xl),d===r&&f===r&&this._generatePoleQuad(t,s,l,h,p,Xl),f===r&&u===r&&this._generatePoleQuad(t,l,a,p,c,Xl))}}_initializeVertices(t){for(let e=0;e<t.length;e+=2)this._vertexToIndex(t[e],t[e+1])}subdividePolygonInternal(t,e){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:n,holeIndices:i}=function(t){const e=[],n=[];for(const i of t)if(0!==i.length){i!==t[0]&&e.push(n.length/2);for(let t=0;t<i.length;t++)n.push(i[t].x),n.push(i[t].y)}return{flattened:n,holeIndices:e}}(t);let r;this._initializeVertices(n);try{const t=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=e&&e.length,r=i?e[0]*n:t.length;let a=bl(t,0,r,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(i&&(a=function(t,e,n,i){const r=[];for(let a=0,o=e.length;a<o;a++){const n=bl(t,e[a]*i,a<o-1?e[a+1]*i:t.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Ll(n))}r.sort(El);for(let a=0;a<r.length;a++)n=Cl(r[a],n);return n}(t,e,a,n)),t.length>80*n){s=t[0],l=t[1];let e=s,i=l;for(let a=n;a<r;a+=n){const n=t[a],r=t[a+1];n<s&&(s=n),r<l&&(l=r),n>e&&(e=n),r>i&&(i=r)}c=Math.max(e-s,i-l),c=0!==c?32767/c:0}return wl(a,o,n,s,l,c,0),o}(n,i),e=this._convertIndices(n,t);r=this._subdivideTrianglesScanline(e)}catch(t){console.error(t)}let a=[];return e&&(a=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(r),{verticesFlattened:this._vertexBuffer,indicesTriangles:r,indicesLineList:a}}_convertIndices(t,e){const n=[];for(let i=0;i<e.length;i++)n.push(this._vertexToIndex(t[2*e[i]],t[2*e[i]+1]));return n}_pointArrayToIndices(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n];e.push(this._vertexToIndex(i.x,i.y))}return e}}function Kl(t,e,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Yl(n,e).subdividePolygonInternal(t,i)}function Jl(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||t.length<1)return[];if(t.length<2)return[];const r=t[0],a=t[t.length-1],o=i&&(r.x!==a.x||r.y!==a.y);if(e<2)return o?[...t,t[0]]:[...t];const s=Math.floor(I/e),l=[];l.push(new n(t[0].x,t[0].y));const c=t.length,u=o?c:c-1;for(let h=0;h<u;h++){const e=t[h],i=h<c-1?t[h+1]:t[0],r=e.x,a=e.y,o=i.x,u=i.y,d=r!==o,p=a!==u;if(!d&&!p)continue;const f=o-r,m=u-a,g=Math.abs(f),y=Math.abs(m);let v=r,_=a;for(;;){const t=f>0?(Math.floor(v/s)+1)*s:(Math.ceil(v/s)-1)*s,e=m>0?(Math.floor(_/s)+1)*s:(Math.ceil(_/s)-1)*s,i=Math.abs(v-t),r=Math.abs(_-e),a=Math.abs(v-o),c=Math.abs(_-u),h=d?i/g:Number.POSITIVE_INFINITY,b=p?r/y:Number.POSITIVE_INFINITY;if((a<=i||!d)&&(c<=r||!p))break;if(h<b&&d||!p){v=t,_+=m*h;const e=new n(v,Math.round(_));l[l.length-1].x===e.x&&l[l.length-1].y===e.y||l.push(e)}else{v+=f*b,_=e;const t=new n(Math.round(v),_);l[l.length-1].x===t.x&&l[l.length-1].y===t.y||l.push(t)}}const b=new n(o,u);l[l.length-1].x===b.x&&l[l.length-1].y===b.y||l.push(b)}return l}function $l(t,e,n){if(0===e.length)throw new Error("Subdivision vertex ring is empty.");let i=0,r=t[2*e[0]];for(let l=1;l<e.length;l++){const n=t[2*e[l]];n<r&&(r=n,i=l)}const a=e.length;let o=i,s=(o+1)%a;for(;;){const i=o-1>=0?o-1:a-1,r=(s+1)%a,l=t[2*e[i]],c=t[2*e[r]],u=t[2*e[o]],h=t[2*e[o]+1],d=t[2*e[s]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const n=d-h,a=-(t[2*e[s]]-u),o=h<d?1:-1;((l-u)*n+(t[2*e[i]+1]-h)*a)*o>((c-u)*n+(t[2*e[r]+1]-h)*a)*o&&(p=!0)}if(p){const t=e[i],r=e[o],l=e[s];t!==r&&t!==l&&r!==l&&n.push(l,r,t),o--,o<0&&(o=a-1)}else{const t=e[r],i=e[o],l=e[s];t!==i&&t!==l&&i!==l&&n.push(l,i,t),s++,s>=a&&(s=0)}if(i===r)break}}function Ql(t,e,n,i,r,a,o,s,l){const c=r.length/2,u=o&&s&&l;if(c<Xo.MAX_VERTEX_ARRAY_LENGTH){const h=e.prepareSegment(c,n,i),d=h.vertexLength;for(let t=0;t<a.length;t+=3)i.emplaceBack(d+a[t],d+a[t+1],d+a[t+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=a.length/3,u&&(f=o.prepareSegment(c,n,s),p=f.vertexLength,f.vertexLength+=c);for(let e=0;e<r.length;e+=2)t(r[e],r[e+1]);if(u)for(let t=0;t<l.length;t++){const e=l[t];for(let t=1;t<e.length;t+=2)s.emplaceBack(p+e[t-1],p+e[t]);f.primitiveLength+=e.length/2}}else!function(t,e,n,i,r,a){const o=[];for(let h=0;h<i.length/2;h++)o.push(-1);const s={count:0};let l=0,c=t.getOrCreateLatestSegment(e,n),u=c.vertexLength;for(let h=2;h<r.length;h+=3){const d=r[h-2],p=r[h-1],f=r[h];let m=o[d]<l,g=o[p]<l,y=o[f]<l;c.vertexLength+((m?1:0)+(g?1:0)+(y?1:0))>Xo.MAX_VERTEX_ARRAY_LENGTH&&(c=t.createNewSegment(e,n),l=s.count,m=!0,g=!0,y=!0,u=0);const v=tc(o,i,a,s,d,m,c),_=tc(o,i,a,s,p,g,c),b=tc(o,i,a,s,f,y,c);n.emplaceBack(u+v-l,u+_-l,u+b-l),c.primitiveLength++}}(e,n,i,r,a,t),u&&function(t,e,n,i,r,a){const o=[];for(let h=0;h<i.length/2;h++)o.push(-1);const s={count:0};let l=0,c=t.getOrCreateLatestSegment(e,n),u=c.vertexLength;for(let h=0;h<r.length;h++){const d=r[h];for(let p=1;p<r[h].length;p+=2){const r=d[p-1],h=d[p];let f=o[r]<l,m=o[h]<l;c.vertexLength+((f?1:0)+(m?1:0))>Xo.MAX_VERTEX_ARRAY_LENGTH&&(c=t.createNewSegment(e,n),l=s.count,f=!0,m=!0,u=0);const g=tc(o,i,a,s,r,f,c),y=tc(o,i,a,s,h,m,c);n.emplaceBack(u+g-l,u+y-l),c.primitiveLength++}}}(o,n,s,r,l,t),e.forceNewSegmentOnNextPrepare(),null==o||o.forceNewSegmentOnNextPrepare()}function tc(t,e,n,i,r,a,o){if(a){const a=i.count;return n(e[2*r],e[2*r+1]),t[r]=i.count,i.count++,o.vertexLength++,a}return t[r]}class ec{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Do,this.indexArray=new Go,this.indexArray2=new Wo,this.programConfigurations=new xs(t.layers,t.zoom),this.segments=new Xo,this.segments2=new Xo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=vl("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Es(o,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),u,n))continue;const h=r?i.evaluate(u,{},n,e.availableImages):void 0,d={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:As(o),patterns:{},sortKey:h};a.push(d)}r&&a.sort((t,e)=>t.sortKey-e.sortKey);for(const o of a){const{geometry:i,index:r,sourceLayerIndex:a}=o;if(this.hasPattern){const t=_l("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{},e.subdivisionGranularity);e.featureIndex.insert(t[r].feature,i,r,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n,t.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yl),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,i,r,a){for(const o of ei(e,500)){const t=Kl(o,i,a.fill.getGranularityForZoomLevel(i.z)),e=this.layoutVertexArray;Ql((t,n)=>{e.emplaceBack(t,n)},this.segments,this.layoutVertexArray,this.indexArray,t.verticesFlattened,t.indicesTriangles,this.segments2,this.indexArray2,t.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}let nc,ic;sa("FillBucket",ec,{omit:["layers","patternFeatures"]});var rc={get paint(){return ic=ic||new Va({"fill-antialias":new Fa(_t.paint_fill["fill-antialias"]),"fill-opacity":new Oa(_t.paint_fill["fill-opacity"]),"fill-color":new Oa(_t.paint_fill["fill-color"]),"fill-outline-color":new Oa(_t.paint_fill["fill-outline-color"]),"fill-translate":new Fa(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new Fa(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ba(_t.paint_fill["fill-pattern"])})},get layout(){return nc=nc||new Va({"fill-sort-key":new Oa(_t.layout_fill["fill-sort-key"])})}};class ac extends Ga{constructor(t){super(t,rc)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ec(t)}queryRadius(){return Hs(this.paint.get("fill-translate"))}queryIntersectsFeature(t){let{queryGeometry:e,geometry:n,transform:i,pixelsToTileUnits:r}=t;return Rs(Gs(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-i.bearingInRadians,r),n)}isTileClipped(){return!0}}const oc=Xa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sc=Xa([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lc}=oc;class cc{constructor(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(uc,this,e)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos,i=[];let r,a=1,o=0,s=0,l=0;for(;t.pos<e;){if(o<=0){const e=t.readVarint();a=7&e,o=e>>3}if(o--,1===a||2===a)s+=t.readSVarint(),l+=t.readSVarint(),1===a&&(r&&i.push(r),r=[]),r&&r.push(new n(s,l));else{if(7!==a)throw new Error("unknown command ".concat(a));r&&r.push(r[0].clone())}}return r&&i.push(r),i}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n=1,i=0,r=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;for(;t.pos<e;){if(i<=0){const e=t.readVarint();n=7&e,i=e>>3}if(i--,1===n||2===n)r+=t.readSVarint(),a+=t.readSVarint(),r<o&&(o=r),r>s&&(s=r),a<l&&(l=a),a>c&&(c=a);else if(7!==n)throw new Error("unknown command ".concat(n))}return[o,l,s,c]}toGeoJSON(t,e,n){const i=this.extent*Math.pow(2,n),r=this.extent*t,a=this.extent*e,o=this.loadGeometry();function s(t){return[360*(t.x+r)/i-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+a)/i)*Math.PI))-90]}function l(t){return t.map(s)}let c;if(1===this.type){const t=[];for(const n of o)t.push(n[0]);const e=l(t);c=1===t.length?{type:"Point",coordinates:e[0]}:{type:"MultiPoint",coordinates:e}}else if(2===this.type){const t=o.map(l);c=1===t.length?{type:"LineString",coordinates:t[0]}:{type:"MultiLineString",coordinates:t}}else{if(3!==this.type)throw new Error("unknown feature type");{const t=function(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let a=0;a<e;a++){const e=hc(t[a]);0!==e&&(void 0===r&&(r=e<0),r===e<0?(i&&n.push(i),i=[t[a]]):i&&i.push(t[a]))}return i&&n.push(i),n}(o),e=[];for(const n of t)e.push(n.map(l));c=1===e.length?{type:"Polygon",coordinates:e[0]}:{type:"MultiPolygon",coordinates:e}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function uc(t,e,n){1===t?e.id=n.readVarint():2===t?function(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(n,e):3===t?e.type=n.readVarint():4===t&&(e._geometry=n.pos)}function hc(t){let e=0;for(let n,i,r=0,a=t.length,o=a-1;r<a;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}cc.types=["Unknown","Point","LineString","Polygon"];class dc{constructor(t,e){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(pc,this,e),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new cc(this._pbf,e,this.extent,this._keys,this._values)}}function pc(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}if(null==e)throw new Error("unknown feature value");return e}(n))}class fc{constructor(t,e){this.layers=t.readFields(mc,{},e)}}function mc(t,e,n){if(3===t){const t=new dc(n,n.readVarint()+n.pos);t.length&&(e[t.name]=t)}}const gc=Math.pow(2,13);function yc(t,e,n,i,r,a,o,s){t.emplaceBack(e,n,2*Math.floor(i*gc)+o,r*gc*2,a*gc*2,Math.round(s))}class vc{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new No,this.centroidVertexArray=new ko,this.indexArray=new Go,this.programConfigurations=new xs(t.layers,t.zoom),this.segments=new Xo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.features=[],this.hasPattern=vl("fill-extrusion",this.layers,e);for(const{feature:i,id:r,index:a,sourceLayerIndex:o}of t){const t=this.layers[0]._featureFilter.needGeometry,s=Es(i,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),s,n))continue;const l={id:r,sourceLayerIndex:o,index:a,geometry:t?s.geometry:As(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(_l("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,a,n,{},e.subdivisionGranularity),e.featureIndex.insert(i,l.geometry,a,o,this.index,!0)}}addFeatures(t,e,n){for(const i of this.features){const{geometry:r}=i;this.addFeature(i,r,i.index,e,n,t.subdivisionGranularity)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lc),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,sc.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,n,i,r,a){for(const o of ei(e,500)){const e={x:0,y:0,sampleCount:0},n=this.layoutVertexArray.length;this.processPolygon(e,i,t,o,a);const r=this.layoutVertexArray.length-n,s=Math.floor(e.x/e.sampleCount),l=Math.floor(e.y/e.sampleCount);for(let t=0;t<r;t++)this.centroidVertexArray.emplaceBack(s,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}processPolygon(t,e,n,i,r){if(i.length<1)return;if(xc(i[0]))return;for(const u of i)0!==u.length&&_c(t,u);const a={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},o=r.fill.getGranularityForZoomLevel(e.z),s="Polygon"===cc.types[n.type];for(const u of i){if(0===u.length)continue;if(xc(u))continue;const t=Jl(u,o,s);this._generateSideFaces(t,a)}if(!s)return;const l=Kl(i,e,o,!1),c=this.layoutVertexArray;Ql((t,e)=>{yc(c,t,e,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(t,e){let n=0;for(let i=1;i<t.length;i++){const r=t[i],a=t[i-1];if(bc(r,a))continue;e.segment.vertexLength+4>Xo.MAX_VERTEX_ARRAY_LENGTH&&(e.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const o=r.sub(a)._perp()._unit(),s=a.dist(r);n+s>32768&&(n=0),yc(this.layoutVertexArray,r.x,r.y,o.x,o.y,0,0,n),yc(this.layoutVertexArray,r.x,r.y,o.x,o.y,0,1,n),n+=s,yc(this.layoutVertexArray,a.x,a.y,o.x,o.y,0,0,n),yc(this.layoutVertexArray,a.x,a.y,o.x,o.y,0,1,n);const l=e.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),e.segment.vertexLength+=4,e.segment.primitiveLength+=2}}}function _c(t,e){for(let n=0;n<e.length;n++){const i=e[n];n===e.length-1&&e[0].x===i.x&&e[0].y===i.y||(t.x+=i.x,t.y+=i.y,t.sampleCount++)}}function bc(t,e){return t.x===e.x&&(t.x<0||t.x>I)||t.y===e.y&&(t.y<0||t.y>I)}function xc(t){return t.every(t=>t.x<0)||t.every(t=>t.x>I)||t.every(t=>t.y<0)||t.every(t=>t.y>I)}let wc;sa("FillExtrusionBucket",vc,{omit:["layers","features"]});var Sc={get paint(){return wc=wc||new Va({"fill-extrusion-opacity":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ba(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Mc extends Ga{constructor(t){super(t,Sc)}createBucket(t){return new vc(t)}queryRadius(){return Hs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t){let{queryGeometry:e,feature:i,featureState:r,geometry:a,transform:o,pixelsToTileUnits:s,pixelPosMatrix:l}=t;const c=Gs(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-o.bearingInRadians,s),u=this.paint.get("fill-extrusion-height").evaluate(i,r),h=this.paint.get("fill-extrusion-base").evaluate(i,r),d=function(t,e){const i=[];for(const r of t){const t=[r.x,r.y,0,1];T(t,t,e),i.push(new n(t[0]/t[3],t[1]/t[3]))}return i}(c,l),p=function(t,e,i,r){const a=[],o=[],s=r[8]*e,l=r[9]*e,c=r[10]*e,u=r[11]*e,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const m of t){const t=[],e=[];for(const i of m){const a=i.x,o=i.y,m=r[0]*a+r[4]*o+r[12],g=r[1]*a+r[5]*o+r[13],y=r[2]*a+r[6]*o+r[14],v=r[3]*a+r[7]*o+r[15],_=y+c,b=v+u,x=m+h,w=g+d,S=y+p,M=v+f,T=new n((m+s)/b,(g+l)/b);T.z=_/b,t.push(T);const A=new n(x/M,w/M);A.z=S/M,e.push(A)}a.push(t),o.push(e)}return[a,o]}(a,h,u,l);return function(t,e,n){let i=1/0;Rs(n,e)&&(i=Ac(n,e[0]));for(let r=0;r<e.length;r++){const a=e[r],o=t[r];for(let t=0;t<a.length-1;t++){const e=a[t],r=[e,a[t+1],o[t+1],o[t],e];Ls(n,r)&&(i=Math.min(i,Ac(n,r)))}}return i!==1/0&&i}(p[0],p[1],d)}}function Tc(t,e){return t.x*e.x+t.y*e.y}function Ac(t,e){if(1===t.length){let n=0;const i=e[n++];let r;for(;!r||i.equals(r);)if(r=e[n++],!r)return 1/0;for(;n<e.length;n++){const a=e[n],o=t[0],s=r.sub(i),l=a.sub(i),c=o.sub(i),u=Tc(s,s),h=Tc(s,l),d=Tc(l,l),p=Tc(c,s),f=Tc(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,v=i.z*(1-g-y)+r.z*g+a.z*y;if(isFinite(v))return v}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}const Ec=Xa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cc}=Ec,Pc=Xa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ic}=Pc,Lc=Math.cos(Math.PI/180*37.5),kc=Math.pow(2,14)/.5;class Rc{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new zo,this.layoutVertexArray2=new Fo,this.indexArray=new Go,this.programConfigurations=new xs(t.layers,t.zoom),this.segments=new Xo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=vl("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Es(o,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),e,n))continue;const u=r?i.evaluate(e,{},n):void 0,h={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:As(o),patterns:{},sortKey:u};a.push(h)}r&&a.sort((t,e)=>t.sortKey-e.sortKey);for(const o of a){const{geometry:i,index:r,sourceLayerIndex:a}=o;if(this.hasPattern){const t=_l("line",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{},e.subdivisionGranularity);e.featureIndex.insert(t[r].feature,i,r,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n,t.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ic)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,i,r,a){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),l=o.get("line-cap"),c=o.get("line-miter-limit"),u=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const h of e)this.addLine(h,t,s,l,c,u,i,a);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}addLine(t,e,n,i,r,a,o,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Jl(t,o?s.line.getGranularityForZoomLevel(o.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===cc.types[e.type];let c=t.length;for(;c>=2&&t[c-1].equals(t[c-2]);)c--;let u=0;for(;u<c-1&&t[u].equals(t[u+1]);)u++;if(c<(l?3:2))return;"bevel"===n&&(r=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,m,g,y;this.e1=this.e2=-1,l&&(p=t[c-2],y=t[u].sub(p)._unit()._perp());for(let v=u;v<c;v++){if(m=v===c-1?l?t[u+1]:void 0:t[v+1],m&&t[v].equals(m))continue;y&&(g=y),p&&(f=p),p=t[v],y=m?m.sub(p)._unit()._perp():g,g=g||y;let e=g.add(y);0===e.x&&0===e.y||e._unit();const o=g.x*y.x+g.y*y.y,s=e.x*y.x+e.y*y.y,_=0!==s?1/s:1/0,b=2*Math.sqrt(2-2*s),x=s<Lc&&f&&m,w=g.x*y.y-g.y*y.x>0;if(x&&v>u){const t=p.dist(f);if(t>2*h){const e=p.sub(p.sub(f)._mult(h/t)._round());this.updateDistance(f,e),this.addCurrentVertex(e,g,0,0,d),f=e}}const S=f&&m;let M=S?n:l?"butt":i;if(S&&"round"===M&&(_<a?M="miter":_<=2&&(M="fakeround")),"miter"===M&&_>r&&(M="bevel"),"bevel"===M&&(_>2&&(M="flipbevel"),_<r&&(M="miter")),f&&this.updateDistance(f,p),"miter"===M)e._mult(_),this.addCurrentVertex(p,e,0,0,d);else if("flipbevel"===M){if(_>100)e=y.mult(-1);else{const t=_*g.add(y).mag()/g.sub(y).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(p,e,0,0,d),this.addCurrentVertex(p,e.mult(-1),0,0,d)}else if("bevel"===M||"fakeround"===M){const t=-Math.sqrt(_*_-1),e=w?t:0,n=w?0:t;if(f&&this.addCurrentVertex(p,g,e,n,d),"fakeround"===M){const t=Math.round(180*b/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+o*(o*(3.55645-1.43519*o)-3.2452))*t*t+(.848013+o*(.215638*o-1.06021)))}const i=y.sub(g)._mult(n)._add(g)._unit()._mult(w?-1:1);this.addHalfVertex(p,i.x,i.y,!1,w,0,d)}}m&&this.addCurrentVertex(p,y,-e,-n,d)}else if("butt"===M)this.addCurrentVertex(p,e,0,0,d);else if("square"===M){const t=f?1:-1;this.addCurrentVertex(p,e,t,t,d)}else"round"===M&&(f&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,y,-1,-1,d,!0),this.addCurrentVertex(p,y,0,0,d)));if(x&&v<c-1){const t=p.dist(m);if(t>2*h){const e=p.add(m.sub(p)._mult(h/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,y,0,0,d),p=e}}}}addCurrentVertex(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=e.y*i-e.x,s=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,a,!1,n,r),this.addHalfVertex(t,o,s,a,!0,-i,r),this.distance>kc/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,n,i,r,a))}addHalfVertex(t,e,n,i,r,a,o){let{x:s,y:l}=t;const c=.5*(this.lineClips?this.scaledDistance*(kc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1)|(63&c)<<2,c>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,u,this.e2),o.primitiveLength++),r?this.e2=u:this.e1=u}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let Dc,Nc;sa("LineBucket",Rc,{omit:["layers","patternFeatures"]});var zc={get paint(){return Nc=Nc||new Va({"line-opacity":new Oa(_t.paint_line["line-opacity"]),"line-color":new Oa(_t.paint_line["line-color"]),"line-translate":new Fa(_t.paint_line["line-translate"]),"line-translate-anchor":new Fa(_t.paint_line["line-translate-anchor"]),"line-width":new Oa(_t.paint_line["line-width"]),"line-gap-width":new Oa(_t.paint_line["line-gap-width"]),"line-offset":new Oa(_t.paint_line["line-offset"]),"line-blur":new Oa(_t.paint_line["line-blur"]),"line-dasharray":new Ua(_t.paint_line["line-dasharray"]),"line-pattern":new Ba(_t.paint_line["line-pattern"]),"line-gradient":new ja(_t.paint_line["line-gradient"])})},get layout(){return Dc=Dc||new Va({"line-cap":new Fa(_t.layout_line["line-cap"]),"line-join":new Oa(_t.layout_line["line-join"]),"line-miter-limit":new Fa(_t.layout_line["line-miter-limit"]),"line-round-limit":new Fa(_t.layout_line["line-round-limit"]),"line-sort-key":new Oa(_t.layout_line["line-sort-key"])})}};class Fc extends Oa{possiblyEvaluate(t,e){return e=new Ca(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=B({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}let Oc;class Bc extends Ga{constructor(t){super(t,zc),this.gradientVersion=0,Oc||(Oc=new Fc(zc.paint.properties["line-width"].specification),Oc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof ln,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Oc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Rc(t)}queryRadius(t){const e=t,n=Uc(Vs("line-width",this,e),Vs("line-gap-width",this,e)),i=Vs("line-offset",this,e);return n/2+Math.abs(i)+Hs(this.paint.get("line-translate"))}queryIntersectsFeature(t){let{queryGeometry:e,feature:i,featureState:r,geometry:a,transform:o,pixelsToTileUnits:s}=t;const l=Gs(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-o.bearingInRadians,s),c=s/2*Uc(this.paint.get("line-width").evaluate(i,r),this.paint.get("line-gap-width").evaluate(i,r)),u=this.paint.get("line-offset").evaluate(i,r);return u&&(a=function(t,e){const i=[];for(let r=0;r<t.length;r++){const a=t[r],o=[];for(let t=0;t<a.length;t++){const i=a[t-1],r=a[t],s=a[t+1],l=0===t?new n(0,0):r.sub(i)._unit()._perp(),c=t===a.length-1?new n(0,0):s.sub(r)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),o.push(u._mult(e)._add(r))}i.push(o)}return i}(a,u*s)),function(t,e,n){for(let i=0;i<e.length;i++){const r=e[i];if(t.length>=3)for(let e=0;e<r.length;e++)if(Us(t,r[e]))return!0;if(Ds(t,r,n))return!0}return!1}(l,a,c)}isTileClipped(){return!0}}function Uc(t,e){return e>0?e+2*t:t}const jc=Xa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vc=Xa([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hc=Xa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Xa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gc=Xa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wc=Xa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qc(t,e,n){return t.sections.forEach(t=>{t.text=function(t,e,n){const i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Ea.applyArabicShaping&&(t=Ea.applyArabicShaping(t)),t}(t.text,e,n)}),t}Xa([{name:"triangle",components:3,type:"Uint16"}]),Xa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Xa([{type:"Float32",name:"offsetX"}]),Xa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Xa([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Zc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Xc=24;const Yc=4294967296,Kc=1/Yc,Jc="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class $c{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<n;){const n=this.readVarint(),i=n>>3,r=this.pos;this.type=7&n,t(i,e,this),this.pos===r&&this.skip(n)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Yc;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Yc;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const e=this.buf;let n,i;return i=e[this.pos++],n=127&i,i<128?n:(i=e[this.pos++],n|=(127&i)<<7,i<128?n:(i=e[this.pos++],n|=(127&i)<<14,i<128?n:(i=e[this.pos++],n|=(127&i)<<21,i<128?n:(i=e[this.pos],n|=(15&i)<<28,function(t,e,n){const i=n.buf;let r,a;if(a=i[n.pos++],r=(112&a)>>4,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<3,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<10,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<17,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<24,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(1&a)<<31,a<128)return Qc(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(n,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return Boolean(this.readVarint())}readString(){const t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Jc?Jc.decode(this.buf.subarray(e,t)):function(t,e,n){let i="",r=e;for(;r<n;){const e=t[r];let a,o,s,l=null,c=e>239?4:e>223?3:e>191?2:1;if(r+c>n)break;1===c?e<128&&(l=e):2===c?(a=t[r+1],128==(192&a)&&(l=(31&e)<<6|63&a,l<=127&&(l=null))):3===c?(a=t[r+1],o=t[r+2],128==(192&a)&&128==(192&o)&&(l=(15&e)<<12|(63&a)<<6|63&o,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(a=t[r+1],o=t[r+2],s=t[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&e)<<18|(63&a)<<12|(63&o)<<6|63&s,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,e,t)}readBytes(){const t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(e));return t}readPackedSVarint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(t){const e=7&t;if(0===e)for(;this.buf[this.pos++]>127;);else if(2===e)this.pos=this.readVarint()+this.pos;else if(5===e)this.pos+=4;else{if(1!==e)throw new Error("Unimplemented type: ".concat(e));this.pos+=8}}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){const t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.dataView=new DataView(t.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Kc),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Kc),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?function(t,e){let n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),4294967295^n?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){const n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const e=this.pos;this.pos=function(t,e,n){for(let i,r,a=0;a<e.length;a++){if(i=e.charCodeAt(a),i>55295&&i<57344){if(!r){i>56319||a+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);const n=this.pos-e;n>=128&&tu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const e=t.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,e){this.pos++;const n=this.pos;t(e,this);const i=this.pos-n;i>=128&&tu(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(t,e,n){this.writeTag(t,2),this.writeRawMessage(e,n)}writePackedVarint(t,e){e.length&&this.writeMessage(t,eu,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,nu,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,au,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,iu,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,ru,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,ou,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,su,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,lu,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,cu,e)}writeBytesField(t,e){this.writeTag(t,2),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,5),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,5),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,1),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,1),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,0),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,0),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,2),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,5),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,1),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}}function Qc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function tu(t,e,n){const i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(let r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function eu(t,e){for(let n=0;n<t.length;n++)e.writeVarint(t[n])}function nu(t,e){for(let n=0;n<t.length;n++)e.writeSVarint(t[n])}function iu(t,e){for(let n=0;n<t.length;n++)e.writeFloat(t[n])}function ru(t,e){for(let n=0;n<t.length;n++)e.writeDouble(t[n])}function au(t,e){for(let n=0;n<t.length;n++)e.writeBoolean(t[n])}function ou(t,e){for(let n=0;n<t.length;n++)e.writeFixed32(t[n])}function su(t,e){for(let n=0;n<t.length;n++)e.writeSFixed32(t[n])}function lu(t,e){for(let n=0;n<t.length;n++)e.writeFixed64(t[n])}function cu(t,e){for(let n=0;n<t.length;n++)e.writeSFixed64(t[n])}function uu(t,e,n){1===t&&n.readMessage(hu,e)}function hu(t,e,n){if(3===t){const{id:t,bitmap:i,width:r,height:a,left:o,top:s,advance:l}=n.readMessage(du,{});e.push({id:t,bitmap:new nl({width:r+6,height:a+6},i),metrics:{width:r,height:a,left:o,top:s,advance:l}})}}function du(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function pu(t){let e=0,n=0;for(const o of t)e+=o.w*o.h,n=Math.max(n,o.w);t.sort((t,e)=>e.h-t.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let r=0,a=0;for(const o of t)for(let t=i.length-1;t>=0;t--){const e=i[t];if(!(o.w>e.w||o.h>e.h)){if(o.x=e.x,o.y=e.y,a=Math.max(a,o.y+o.h),r=Math.max(r,o.x+o.w),o.w===e.w&&o.h===e.h){const e=i.pop();e&&t<i.length&&(i[t]=e)}else o.h===e.h?(e.x+=o.w,e.w-=o.w):o.w===e.w?(e.y+=o.h,e.h-=o.h):(i.push({x:e.x+o.w,y:e.y,w:e.w-o.w,h:o.h}),e.y+=o.h,e.h-=o.h);break}}return{w:r,h:a,fill:e/(r*a)||0}}class fu{constructor(t,e){let{pixelRatio:n,version:i,stretchX:r,stretchY:a,content:o,textFitWidth:s,textFitHeight:l}=e;this.paddedRect=t,this.pixelRatio=n,this.stretchX=r,this.stretchY=a,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class mu{constructor(t,e){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,r),this.addImages(e,i,r);const{w:a,h:o}=pu(r),s=new il({width:a||1,height:o||1});for(const l in t){const e=t[l],i=n[l].paddedRect;il.copy(e.data,s,{x:0,y:0},{x:i.x+1,y:i.y+1},e.data)}for(const l in e){const t=e[l],n=i[l].paddedRect,r=n.x+1,a=n.y+1,o=t.data.width,c=t.data.height;il.copy(t.data,s,{x:0,y:0},{x:r,y:a},t.data),il.copy(t.data,s,{x:0,y:c-1},{x:r,y:a-1},{width:o,height:1}),il.copy(t.data,s,{x:0,y:0},{x:r,y:a+c},{width:o,height:1}),il.copy(t.data,s,{x:o-1,y:0},{x:r-1,y:a},{width:1,height:c}),il.copy(t.data,s,{x:0,y:0},{x:r+o,y:a},{width:1,height:c})}this.image=s,this.iconPositions=n,this.patternPositions=i}addImages(t,e,n){for(const i in t){const r=t[i],a={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(a),e[i]=new fu(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[i,r]=t.tl;n.update(e.data,void 0,{x:i,y:r})}}var gu;sa("ImagePosition",fu),sa("ImageAtlas",mu),t.ao=void 0,(gu=t.ao||(t.ao={}))[gu.none=0]="none",gu[gu.horizontal=1]="horizontal",gu[gu.vertical=2]="vertical",gu[gu.horizontalOnly=3]="horizontalOnly";class yu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,e,n){const i=new yu;return i.scale=t||1,i.fontStack=e,i.verticalAlign=n||"bottom",i}static forImage(t,e){const n=new yu;return n.imageName=t,n.verticalAlign=e||"bottom",n}}class vu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new vu;for(let i=0;i<t.sections.length;i++){const r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;e+=i&&wa(i)&&!Zc[t[n+1]]||r&&wa(r)&&!Zc[t[n-1]]||!Zc[t[n]]?t[n]:Zc[t[n]]}return e}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&bu[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&bu[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new vu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}getMaxImageSize(t){let e=0,n=0;for(let i=0;i<this.length();i++){const r=this.getSection(i);if(r.imageName){const i=t[r.imageName];if(!i)continue;const a=i.displaySize;e=Math.max(e,a[0]),n=Math.max(n,a[1])}}return{maxImageWidth:e,maxImageHeight:n}}addTextSection(t,e){this.text+=t.text,this.sections.push(yu.forText(t.scale,t.fontStack||e,t.verticalAlign));const n=this.sections.length-1;for(let i=0;i<t.text.length;++i)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void W("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(yu.forImage(e,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):W("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _u(e,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=vu.fromFeature(e,a);let y;d===t.ao.vertical&&g.verticalizePunctuation();const{processBidirectionalText:v,processStyledBidirectionalText:_}=Ea;if(v&&1===g.sections.length){y=[];const t=v(g.toString(),Cu(g,u,o,n,r,f));for(const e of t){const t=new vu;t.text=e,t.sections=g.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);y.push(t)}}else if(_){y=[];const t=_(g.text,g.sectionIndex,Cu(g,u,o,n,r,f));for(const e of t){const t=new vu;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const n=[],i=t.text;let r=0;for(const a of e)n.push(t.substring(r,a)),r=a;return r<i.length&&n.push(t.substring(r,i.length)),n}(g,Cu(g,u,o,n,r,f));const b=[],x={positionedLines:b,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(t,e,n,i,r,a,o,s,l,c,u,h){let d=0,p=0,f=0,m=0;const g="right"===s?1:"left"===s?0:.5,y=Xc/h;let v=0;for(const x of r){x.trim();const r=x.getMaxScale(),o={positionedGlyphs:[],lineOffset:0};t.positionedLines[v]=o;const s=o.positionedGlyphs;let h=0;if(!x.length()){p+=a,++v;continue}const _=Iu(i,x,y);for(let a=0;a<x.length();a++){const o=x.getSection(a),f=x.getSectionIndex(a),m=x.getCharCode(a),g=ku(l,u,m);let v;if(o.imageName){if(t.iconsInText=!0,o.scale=o.scale*y,v=Du(o,g,r,_,i),!v)continue;h=Math.max(h,v.imageOffset)}else if(v=Ru(o,m,g,_,e,n),!v)continue;const{rect:b,metrics:w,baselineOffset:S}=v;s.push({glyph:m,imageName:o.imageName,x:d,y:p+S+-17,vertical:g,scale:o.scale,fontStack:o.fontStack,sectionIndex:f,metrics:w,rect:b}),g?(t.verticalizable=!0,d+=(o.imageName?w.advance:Xc)*o.scale+c):d+=w.advance*o.scale+c}0!==s.length&&(f=Math.max(d-c,f),Nu(s,0,s.length-1,g)),d=0,o.lineOffset=Math.max(h,(r-1)*Xc);const b=a*r+h;p+=b,m=Math.max(b,m),++v}const{horizontalAlign:_,verticalAlign:b}=Pu(o);(function(t,e,n,i,r,a,o,s,l){const c=(e-n)*r;let u=0;u=a!==o?-s*i- -17:-i*l*o+.5*o;for(const h of t)for(const t of h.positionedGlyphs)t.x+=c,t.y+=u})(t.positionedLines,g,_,b,f,m,a,p,r.length),t.top+=-b*p,t.bottom=t.top+p,t.left+=-_*f,t.right=t.left+f}(x,n,i,r,y,s,l,c,d,u,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(b)&&x}const bu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},wu={40:!0};function Su(t,e,n,i,r,a){if(e.imageName){const t=i[e.imageName];return t?t.displaySize[0]*e.scale*Xc/a+r:0}{const i=n[e.fontStack],a=i&&i[t];return a?a.metrics.advance*e.scale+r:0}}function Mu(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function Tu(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Au(t,e,n,i,r,a){let o=null,s=Mu(e,n,r,a);for(const l of i){const t=Mu(e-l.x,n,r,a)+l.badness;t<=s&&(o=l,s=t)}return{index:t,x:e,priorBreak:o,badness:s}}function Eu(t){return t?Eu(t.priorBreak).concat(t.index):[]}function Cu(t,e,n,i,r,a){if(!t)return[];const o=[],s=function(t,e,n,i,r,a){let o=0;for(let s=0;s<t.length();s++){const n=t.getSection(s);o+=Su(t.getCharCode(s),n,i,r,e,a)}return o/Math.max(1,Math.ceil(o/n))}(t,e,n,i,r,a),l=t.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<t.length();h++){const n=t.getSection(h),d=t.getCharCode(h);if(bu[d]||(c+=Su(d,n,i,r,e,a)),h<t.length()-1){const e=!((u=d)<11904)&&(!!fa["CJK Compatibility Forms"](u)||!!fa["CJK Compatibility"](u)||!!fa["CJK Strokes"](u)||!!fa["CJK Symbols and Punctuation"](u)||!!fa["Enclosed CJK Letters and Months"](u)||!!fa["Halfwidth and Fullwidth Forms"](u)||!!fa["Ideographic Description Characters"](u)||!!fa["Vertical Forms"](u)||ba.test(String.fromCodePoint(u)));(xu[d]||e||n.imageName||h!==t.length()-2&&wu[t.getCharCode(h+1)])&&o.push(Au(h+1,c,s,o,Tu(d,t.getCharCode(h+1),e&&l),!1))}}var u;return Eu(Au(t.length(),c,s,o,0,!0))}function Pu(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Iu(t,e,n){const i=e.getMaxScale()*Xc,{maxImageWidth:r,maxImageHeight:a}=e.getMaxImageSize(t),o=Math.max(i,a*n);return{verticalLineContentWidth:Math.max(i,r*n),horizontalLineContentHeight:o}}function Lu(t){switch(t){case"top":return 0;case"center":return.5;default:return 1}}function ku(e,n,i){return!(e===t.ao.horizontal||!n&&!xa(i)||n&&(bu[i]||(r=i,/(?:[\u0600-\u0604\u0606-\u060B\u060D-\u061A\u061C-\u061E\u0620-\u063F\u0641-\u064A\u0656-\u066F\u0671-\u06DC\u06DE-\u06FF\u0750-\u077F\u0870-\u0891\u0897-\u08E1\u08E3-\u08FF\uFB50-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFF\uFE70-\uFE74\uFE76-\uFEFC]|\uD803[\uDE60-\uDE7E\uDEC2-\uDEC7\uDED0-\uDED8\uDEFA-\uDEFF]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB\uDEF0\uDEF1])/.test(String.fromCodePoint(r)))));var r}function Ru(t,e,n,i,r,a){const o=a[t.fontStack],s=function(t,e,n,i){if(t&&t.rect)return t;const r=e[n.fontStack],a=r&&r[i];return a?{rect:null,metrics:a.metrics}:null}(o&&o[e],r,t,e);if(null===s)return null;let l;if(n)l=i.verticalLineContentWidth-t.scale*Xc;else{const e=Lu(t.verticalAlign);l=(i.horizontalLineContentHeight-t.scale*Xc)*e}return{rect:s.rect,metrics:s.metrics,baselineOffset:l}}function Du(t,e,n,i,r){const a=r[t.imageName];if(!a)return null;const o=a.paddedRect,s=a.displaySize,l={width:s[0],height:s[1],left:1,top:-3,advance:e?s[1]:s[0]};let c;if(e)c=i.verticalLineContentWidth-s[1]*t.scale;else{const e=Lu(t.verticalAlign);c=(i.horizontalLineContentHeight-s[1]*t.scale)*e}return{rect:o,metrics:l,baselineOffset:c,imageOffset:(e?s[0]:s[1])*t.scale-Xc*n}}function Nu(t,e,n,i){if(0===i)return;const r=t[n],a=(t[n].x+r.metrics.advance*r.scale)*i;for(let o=e;o<=n;o++)t[o].x-=a}function zu(t,e,n){const{horizontalAlign:i,verticalAlign:r}=Pu(n),a=e[0]-t.displaySize[0]*i,o=e[1]-t.displaySize[1]*r;return{image:t,top:o,bottom:o+t.displaySize[1],left:a,right:a+t.displaySize[0]}}function Fu(t){var e,n;let i=t.left,r=t.top,a=t.right-i,o=t.bottom-r;const s=null!==(e=t.image.textFitWidth)&&void 0!==e?e:"stretchOrShrink",l=null!==(n=t.image.textFitHeight)&&void 0!==n?n:"stretchOrShrink",c=(t.image.content[2]-t.image.content[0])/(t.image.content[3]-t.image.content[1]);if("proportional"===l){if("stretchOnly"===s&&a/o<c||"proportional"===s){const t=Math.ceil(o*c);i*=t/a,a=t}}else if("proportional"===s&&"stretchOnly"===l&&0!==c&&a/o>c){const t=Math.ceil(a/c);r*=t/o,o=t}return{x1:i,y1:r,x2:i+a,y2:r+o}}function Ou(t,e,n,i,r,a){const o=t.image;let s;if(o.content){const t=o.content,e=o.pixelRatio||1;s=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e]}const l=e.left*a,c=e.right*a;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=e.top*a,m=e.bottom*a;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{image:o,top:u,right:h,bottom:d,left:p,collisionPadding:s}}const Bu=128,Uu=32640;function ju(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ca(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:i}=n;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let a=r;for(;a<e.length&&e[a]<t+1;)a++;a=Math.min(e.length-1,a);const o=e[r],s=e[a];return"composite"===n.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:s,minSize:n.evaluate(new Ca(o)),maxSize:n.evaluate(new Ca(s)),interpolationType:i}}}function Vu(t,e,n){let i="never";const r=t.get(e);return r?i=r:t.get(n)&&(i="always"),i}const Hu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gu(t,e,n,i,r,a,o,s,l,c,u,h,d){const p=s?Math.min(Uu,Math.round(s[0])):0,f=s?Math.min(Uu,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),a,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Wu(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function qu(t){for(const e of t.sections)if(Aa(e.text))return!0;return!1}class Zu{constructor(t){this.layoutVertexArray=new Bo,this.indexArray=new Go,this.programConfigurations=t,this.segments=new Xo,this.dynamicLayoutVertexArray=new Uo,this.opacityVertexArray=new jo,this.hasVisibleVertices=!1,this.placedSymbolArray=new So}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Hu,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}sa("SymbolBuffers",Zu);class Xu{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new Xo,this.collisionVertexArray=new Ho}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Hc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}sa("CollisionBuffers",Xu);class Yu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ju(this.zoom,n["text-size"]),this.iconSizeData=ju(this.zoom,n["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),a=i.get("symbol-z-order");this.canOverlap="never"!==Vu(i,"text-overlap","text-allow-overlap")||"never"!==Vu(i,"icon-overlap","icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map(e=>t.ao[e])),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=e.sourceID}createArrays(){this.text=new Zu(new xs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Zu(new xs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ao,this.lineVertexArray=new Eo,this.symbolInstances=new To,this.textAnchorOffsets=new Po}calculateGlyphDependencies(t,e,n,i,r){for(let a=0;a<t.length;a++)if(e[t.charCodeAt(a)]=!0,(n||i)&&r){const n=Zc[t.charAt(a)];n&&(e[n.charCodeAt(0)]=!0)}}populate(e,n,i){const r=this.layers[0],a=r.layout,o=a.get("text-font"),s=a.get("text-field"),l=a.get("icon-image"),c=("constant"!==s.value.kind||s.value.value instanceof Le&&!s.value.value.isEmpty()||s.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=a.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,m=new Ca(this.zoom,{globalState:this.globalState});for(const{feature:g,id:y,index:v,sourceLayerIndex:_}of e){const e=r._featureFilter.needGeometry,n=Es(g,e);if(!r._featureFilter.filter(m,n,i))continue;let s,l;if(e||(n.geometry=As(g)),c){const t=r.getValueAndResolveTokens("text-field",n,i,f),e=Le.factory(t),a=this.hasRTLText=this.hasRTLText||qu(e);(!a||"unavailable"===Ea.getRTLTextPluginStatus()||a&&Ea.isParsed())&&(s=qc(e,r,n))}if(u){const t=r.getValueAndResolveTokens("icon-image",n,i,f);l=t instanceof Oe?t:Oe.fromString(t)}if(!s&&!l)continue;const b=this.sortFeaturesByKey?h.evaluate(n,{},i):void 0;if(this.features.push({id:y,text:s,icon:l,index:v,sourceLayerIndex:_,geometry:n.geometry,properties:g.properties,type:cc.types[g.type],sortKey:b}),l&&(d[l.name]=!0),s){const e=o.evaluate(n,{},i).join(","),r="viewport"!==a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.ao.vertical)>=0;for(const t of s.sections)if(t.image)d[t.image.name]=!0;else{const n=ma(s.toString()),i=t.fontStack||e,a=p[i]=p[i]||{};this.calculateGlyphDependencies(t.text,a,r,this.allowVerticalPlacement,n)}}}"line"===a.get("symbol-placement")&&(this.features=function(t){const e={},n={},i=[];let r=0;function a(e){i.push(t[e]),r++}function o(t,e,r){const a=n[t];return delete n[t],n[e]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(r[0]),a}function s(t,n,r){const a=e[n];return delete e[n],e[t]=a,i[a].geometry[0].shift(),i[a].geometry[0]=r[0].concat(i[a].geometry[0]),a}function l(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return"".concat(t,":").concat(i.x,":").concat(i.y)}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){a(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in e&&n[p]!==e[f]){const t=s(p,f,h),r=o(p,f,i[t].geometry);delete e[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[t].geometry=null}else p in n?o(p,f,h):f in e?s(p,f,h):(a(c),e[p]=r-1,n[f]=r-1)}return i.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length;if(void 0!==t.segment){let n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]);const r={};for(let a=t.segment+1;a<e.length;a++)r[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(let a=t.segment||0;a>=0;a--)r[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:i},a>0&&(i+=e[a-1].dist(e[a]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,n,i,r,a,o,s,l,c,u,h,d){const p=e.indexArray,f=e.layoutVertexArray,m=e.segments.prepareSegment(4*n.length,f,p,this.canOverlap?o.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,v=this.allowVerticalPlacement&&s===t.ao.vertical?Math.PI/2:0,_=o.text&&o.text.sections;for(let t=0;t<n.length;t++){const{tl:r,tr:a,bl:s,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:b,glyphOffset:x,isSDF:w,sectionIndex:S}=n[t],M=m.vertexLength,T=x[1];Gu(f,l.x,l.y,r.x,T+r.y,u.x,u.y,i,w,h.x,h.y,y,b),Gu(f,l.x,l.y,a.x,T+a.y,u.x+u.w,u.y,i,w,g.x,h.y,y,b),Gu(f,l.x,l.y,s.x,T+s.y,u.x,u.y+u.h,i,w,h.x,g.y,y,b),Gu(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,i,w,g.x,g.y,y,b),Wu(e.dynamicLayoutVertexArray,l,v),p.emplaceBack(M,M+2,M+1),p.emplaceBack(M+1,M+2,M+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),t!==n.length-1&&S===n[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,o,o.index,{},d,_&&_[S])}e.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h)}_addCollisionDebugVertex(t,e,n,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(a.x),Math.round(a.y))}addCollisionDebugVertices(t,e,i,r,a,o,s){const l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,u=a.layoutVertexArray,h=a.collisionVertexArray,d=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,h,o,d,p,new n(t,e)),this._addCollisionDebugVertex(u,h,o,d,p,new n(i,e)),this._addCollisionDebugVertex(u,h,o,d,p,new n(i,r)),this._addCollisionDebugVertex(u,h,o,d,p,new n(t,r)),l.vertexLength+=4;const f=a.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(t,e,n,i){for(let r=t;r<e;r++){const t=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,i?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xu(Vo,Gc.members,Wo),this.iconCollisionBox=new Xu(Vo,Gc.members,Wo);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,n,i,r,a,o,s,l){const c={};for(let u=e;u<n;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=i;u<r;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=a;u<o;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=s;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+2,r+1),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),i=[],r=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const t=this.symbolInstances.get(o);i.push(0|Math.round(e*t.anchorX+n*t.anchorY)),r.push(t.featureIndex)}return a.sort((t,e)=>i[t]-i[e]||r[e]-r[t]),a}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ku,Ju;sa("SymbolBucket",Yu,{omit:["layers","collisionBoxArray","features","compareText"]}),Yu.MAX_GLYPHS=65535,Yu.addDynamicAttributes=Wu;var $u={get paint(){return Ju=Ju||new Va({"icon-opacity":new Oa(_t.paint_symbol["icon-opacity"]),"icon-color":new Oa(_t.paint_symbol["icon-color"]),"icon-halo-color":new Oa(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new Oa(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Oa(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new Fa(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fa(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new Oa(_t.paint_symbol["text-opacity"]),"text-color":new Oa(_t.paint_symbol["text-color"],{runtimeType:Bt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Oa(_t.paint_symbol["text-halo-color"]),"text-halo-width":new Oa(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new Oa(_t.paint_symbol["text-halo-blur"]),"text-translate":new Fa(_t.paint_symbol["text-translate"]),"text-translate-anchor":new Fa(_t.paint_symbol["text-translate-anchor"])})},get layout(){return Ku=Ku||new Va({"symbol-placement":new Fa(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new Fa(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fa(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Oa(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fa(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Fa(_t.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Fa(_t.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Fa(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fa(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fa(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new Oa(_t.layout_symbol["icon-size"]),"icon-text-fit":new Fa(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fa(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new Oa(_t.layout_symbol["icon-image"]),"icon-rotate":new Oa(_t.layout_symbol["icon-rotate"]),"icon-padding":new Oa(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new Fa(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new Oa(_t.layout_symbol["icon-offset"]),"icon-anchor":new Oa(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fa(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fa(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fa(_t.layout_symbol["text-rotation-alignment"]),"text-field":new Oa(_t.layout_symbol["text-field"]),"text-font":new Oa(_t.layout_symbol["text-font"]),"text-size":new Oa(_t.layout_symbol["text-size"]),"text-max-width":new Oa(_t.layout_symbol["text-max-width"]),"text-line-height":new Fa(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new Oa(_t.layout_symbol["text-letter-spacing"]),"text-justify":new Oa(_t.layout_symbol["text-justify"]),"text-radial-offset":new Oa(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fa(_t.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Oa(_t.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Oa(_t.layout_symbol["text-anchor"]),"text-max-angle":new Fa(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new Fa(_t.layout_symbol["text-writing-mode"]),"text-rotate":new Oa(_t.layout_symbol["text-rotate"]),"text-padding":new Fa(_t.layout_symbol["text-padding"]),"text-keep-upright":new Fa(_t.layout_symbol["text-keep-upright"]),"text-transform":new Oa(_t.layout_symbol["text-transform"]),"text-offset":new Oa(_t.layout_symbol["text-offset"]),"text-allow-overlap":new Fa(_t.layout_symbol["text-allow-overlap"]),"text-overlap":new Fa(_t.layout_symbol["text-overlap"]),"text-ignore-placement":new Fa(_t.layout_symbol["text-ignore-placement"]),"text-optional":new Fa(_t.layout_symbol["text-optional"])})}};class Qu{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Nt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}sa("FormatSectionOverride",Qu,{omit:["defaultValue"]});class th extends Ga{constructor(t){super(t,$u)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const n of t)e.indexOf(n)<0&&e.push(n);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,i){const r=this.layout.get(t).evaluate(e,{},n,i),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||nr(a.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,(e,n)=>t&&n in t?String(t[n]):"")}(e.properties,r)}createBucket(t){return new Yu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of $u.paint.overridableProperties){if(!th.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new Qu(e),i=new er(n,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new rr("source",i):new ar("composite",i,e.value.zoomStops),this.paint._values[t]=new Na(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&th.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),i=$u.paint.properties[e];let r=!1;const a=t=>{for(const e of t)if(i.overrides&&i.overrides.hasOverride(e))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Le)a(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{r||(e instanceof Ge&&Ve(e.value)===Gt?a(e.value.sections):e instanceof Pn?a(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return r}}let eh;var nh={get paint(){return eh=eh||new Va({"background-color":new Fa(_t.paint_background["background-color"]),"background-pattern":new Ua(_t.paint_background["background-pattern"]),"background-opacity":new Fa(_t.paint_background["background-opacity"])})}};class ih extends Ga{constructor(t){super(t,nh)}}let rh;var ah={get paint(){return rh=rh||new Va({"raster-opacity":new Fa(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new Fa(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fa(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fa(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new Fa(_t.paint_raster["raster-saturation"]),"raster-contrast":new Fa(_t.paint_raster["raster-contrast"]),"raster-resampling":new Fa(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new Fa(_t.paint_raster["raster-fade-duration"])})}};class oh extends Ga{constructor(t){super(t,ah)}}class sh extends Ga{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lh{constructor(t){this._methodToThrottle=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ch={once:!0},uh=6371008.8;class hh{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(e,")"));if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hh(O(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(t){const e=Math.PI/180,n=this.lat*e,i=t.lat*e,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return uh*Math.acos(Math.min(r,1))}static convert(t){if(t instanceof hh)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new hh(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new hh(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dh=2*Math.PI*uh;function ph(t){return dh*Math.cos(t*Math.PI/180)}function fh(t){return(180+t)/360}function mh(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function gh(t,e){return t/ph(e)}function yh(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function vh(t,e){return t*ph(yh(e))}class _h{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=hh.convert(t);return new _h(fh(n.lng),mh(n.lat),gh(e,n.lat))}toLngLat(){return new hh(360*this.x-180,yh(this.y))}toAltitude(){return vh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/dh*(t=yh(this.y),1/Math.cos(t*Math.PI/180));var t}}function bh(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class xh{constructor(t,e,n){if(!function(t,e,n){return!(t<0||t>25||n<0||n>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))}(t,e,n))throw new Error("x=".concat(e,", y=").concat(n,", z=").concat(t," outside of bounds. 0<=x<").concat(Math.pow(2,t),", 0<=y<").concat(Math.pow(2,t)," 0<=z<=25 "));this.z=t,this.x=e,this.y=n,this.key=Mh(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,n){const i=(a=this.y,o=this.z,s=bh(256*(r=this.x),256*(a=Math.pow(2,o)-a-1),o),l=bh(256*(r+1),256*(a+1),o),s[0]+","+s[1]+","+l[0]+","+l[1]);var r,a,o,s,l;const c=function(t,e,n){let i,r="";for(let a=t;a>0;a--)i=1<<a-1,r+=(e&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new n((t.x*e-this.x)*I,(t.y*e-this.y)*I)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class wh{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Mh(t,e.z,e.z,e.x,e.y)}}class Sh{constructor(t,e,n,i,r){if(this.terrainRttPosMatrix32f=null,t<n)throw new Error("overscaledZ should be >= z; overscaledZ = ".concat(t,"; z = ").concat(n));this.overscaledZ=t,this.wrap=e,this.canonical=new xh(n,+i,+r),this.key=Mh(e,t,n,i,r)}clone(){return new Sh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error("targetZ > this.overscaledZ; targetZ = ".concat(t,"; overscaledZ = ").concat(this.overscaledZ));const e=this.canonical.z-t;return t>this.canonical.z?new Sh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error("targetZ > this.overscaledZ; targetZ = ".concat(t,"; overscaledZ = ").concat(this.overscaledZ));const n=this.canonical.z-t;return t>this.canonical.z?Mh(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Mh(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Sh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Sh(e,this.wrap,e,n,i),new Sh(e,this.wrap,e,n+1,i),new Sh(e,this.wrap,e,n,i+1),new Sh(e,this.wrap,e,n+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Sh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Sh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}getTilePoint(t){return this.canonical.getTilePoint(new _h(t.x-this.wrap,t.y))}}function Mh(t,e,n,i,r){(t*=2)<0&&(t=-1*t-1);const a=1<<n;return(a*a*t+a*r+i).toString(36)+n.toString(36)+e.toString(36)}function Th(t,e){return e?t.properties[e]:t.id}sa("CanonicalTileID",xh),sa("OverscaledTileID",Sh,{omit:["terrainRttPosMatrix32f"]});class Ah{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const e=new Ah;return e.extend(t(new n(this.minX,this.minY))),e.extend(t(new n(this.maxX,this.minY))),e.extend(t(new n(this.minX,this.maxY))),e.extend(t(new n(this.maxX,this.maxY))),e}static fromPoints(t){const e=new Ah;for(const n of t)e.extend(n);return e}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Eh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error("Out of bounds. Index requested n=".concat(t," can't be >= this._numberToString.length ").concat(this._numberToString.length));return this._numberToString[t]}}class Ch{constructor(t,e,n,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class Ph{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new aa(I,16,0),this.grid3D=new aa(I,16,0),this.featureIndexArray=new Lo,this.promoteId=e}insert(t,e,n,i,r,a){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);const s=a?this.grid3D:this.grid;for(let l=0;l<e.length;l++){const t=e[l],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const i=t[e];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<I&&n[1]<I&&n[2]>=0&&n[3]>=0&&s.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fc(new $c(this.rawTileData)).layers,this.sourceLayerCoder=new Eh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,r){this.loadVTLayers();const a=t.params,o=I/t.tileSize/t.scale,s=dr(a.filter),l=t.queryGeometry,c=t.queryPadding*o,u=Ah.fromPoints(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Ah.fromPoints(t.cameraQueryGeometry).expandBy(c),p=this.grid3D.query(d.minX,d.minY,d.maxX,d.maxY,(e,i,r,a)=>function(t,e,i,r,a){for(const n of t)if(e<=n.x&&i<=n.y&&r>=n.x&&a>=n.y)return!0;const o=[new n(e,i),new n(e,a),new n(r,a),new n(r,i)];if(t.length>2)for(const n of o)if(Us(t,n))return!0;for(let n=0;n<t.length-1;n++)if(js(t[n],t[n+1],o))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,r+c,a+c));for(const n of p)h.push(n);h.sort(Lh);const f={};let m;for(let n=0;n<h.length;n++){const c=h[n];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,a.layers,a.availableImages,e,i,r,(e,n,i)=>(d||(d=As(e)),n.queryIntersectsFeature({queryGeometry:l,feature:e,featureState:i,geometry:d,zoom:this.z,transform:t.transform,pixelsToTileUnits:o,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return f}loadMatchingFeature(t,e,n,i,r,a,o,s,l,c,u){const h=this.bucketLayerIDs[e];if(a&&!h.some(t=>a.has(t)))return;const d=this.sourceLayerCoder.decode(n),p=this.vtLayers[d].feature(i);if(r.needGeometry){const t=Es(p,!0);if(!r.filter(new Ca(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new Ca(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let m=0;m<h.length;m++){const e=h[m];if(a&&!a.has(e))continue;const n=s[e];if(!n)continue;let r={};f&&c&&(r=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const d=B({},l[e]);d.paint=Ih(d.paint,n.paint,p,r,o),d.layout=Ih(d.layout,n.layout,p,r,o);const g=!u||u(p,n,r);if(!g)continue;const y=new Ch(p,this.z,this.x,this.y,f);y.layer=d;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:i,feature:y,intersectionZ:g})}}lookupSymbolFeatures(t,e,n,i,r,a,o,s){const l={};this.loadVTLayers();const c=dr(r);for(const u of t)this.loadMatchingFeature(l,n,i,u,c,a,o,s,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){var n;let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i)),void 0===i&&(null===(n=t.properties)||void 0===n?void 0:n.cluster)&&this.promoteId&&(i=Number(t.properties.cluster_id))),i}}function Ih(t,e,n,i,r){return j(t,(t,a)=>{const o=e instanceof za?e.get(a):null;return o&&o.evaluate?o.evaluate(n,i,r):o})}function Lh(t,e){return e-t}function kh(t,e,i,r,a){const o=[];for(let s=0;s<t.length;s++){const l=t[s];let c;for(let t=0;t<l.length-1;t++){let s=l[t],u=l[t+1];s.x<e&&u.x<e||(s.x<e?s=new n(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<e&&(u=new n(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<i&&u.y<i||(s.y<i?s=new n(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y<i&&(u=new n(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),s.x>=r&&u.x>=r||(s.x>=r?s=new n(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=r&&(u=new n(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=a&&u.y>=a||(s.y>=a?s=new n(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round():u.y>=a&&(u=new n(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(u)))))}}return o}sa("FeatureIndex",Ph,{omit:["rawTileData","sourceLayerCoder"]});class Rh extends n{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new Rh(this.x,this.y,this.angle,this.segment)}}function Dh(t,e,n,i,r){if(void 0===e.segment||0===n)return!0;let a=e,o=e.segment+1,s=0;for(;s>-n/2;){if(o--,o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;const l=[];let c=0;for(;s<n/2;){const e=t[o],n=t[o+1];if(!n)return!1;let a=t[o-1].angleTo(e)-e.angleTo(n);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),c+=a;s-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;o++,s+=e.dist(n)}return!0}function Nh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function zh(t,e,n){return t?.6*e*n:0}function Fh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Oh(t,e,n,i,r,a){const o=zh(n,r,a),s=Fh(n,i)*a;let l=0;const c=Nh(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],i=t[u+1],r=n.dist(i);if(l+r>c){const a=(c-l)/r,h=gn.number(n.x,i.x,a),d=gn.number(n.y,i.y,a),p=new Rh(h,d,i.angleTo(n),u);return p._round(),!o||Dh(t,p,s,o,e)?p:void 0}l+=r}}function Bh(t,e,n,i,r,a,o,s,l){const c=zh(i,a,o),u=Fh(i,r),h=u*o,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Uh(t,d?e/2*s%e:(u/2+2*a)*o*s%e,e,c,n,h,d,!1,l)}function Uh(t,e,n,i,r,a,o,s,l){const c=a/2,u=Nh(t);let h=0,d=e-n,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],o=t[f+1],s=e.dist(o),m=o.angleTo(e);for(;d+n<h+s;){d+=n;const g=(d-h)/s,y=gn.number(e.x,o.x,g),v=gn.number(e.y,o.y,g);if(y>=0&&y<l&&v>=0&&v<l&&d-c>=0&&d+c<=u){const e=new Rh(y,v,m,f);e._round(),i&&!Dh(t,e,a,i,r)||p.push(e)}}h+=s}return s||p.length||o||(p=Uh(t,h/2,n,i,r,a,o,!0,l)),p}function jh(t,e,i,r){const a=[],o=t.image,s=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2;let u={x1:t.left,y1:t.top,x2:t.right,y2:t.bottom};const h=o.stretchX||[[0,l]],d=o.stretchY||[[0,c]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=l-f,y=c-m;let v=0,_=f,b=0,x=m,w=0,S=g,M=0,T=y;if(o.content&&r){const e=o.content,n=e[2]-e[0],i=e[3]-e[1];(o.textFitWidth||o.textFitHeight)&&(u=Fu(t)),v=Vh(h,0,e[0]),b=Vh(d,0,e[1]),_=Vh(h,e[0],e[2]),x=Vh(d,e[1],e[3]),w=e[0]-v,M=e[1]-b,S=n-_,T=i-x}const A=u.x1,E=u.y1,C=u.x2-A,P=u.y2-E,I=(t,r,a,l)=>{const c=Gh(t.stretch-v,_,C,A),u=Wh(t.fixed-w,S,t.stretch,f),h=Gh(r.stretch-b,x,P,E),d=Wh(r.fixed-M,T,r.stretch,m),p=Gh(a.stretch-v,_,C,A),g=Wh(a.fixed-w,S,a.stretch,f),y=Gh(l.stretch-b,x,P,E),I=Wh(l.fixed-M,T,l.stretch,m),L=new n(c,h),k=new n(p,h),R=new n(p,y),D=new n(c,y),N=new n(u/s,d/s),z=new n(g/s,I/s),F=e*Math.PI/180;if(F){const t=Math.sin(F),e=Math.cos(F),n=[e,-t,t,e];L._matMult(n),k._matMult(n),D._matMult(n),R._matMult(n)}const O=t.stretch+t.fixed,B=r.stretch+r.fixed;return{tl:L,tr:k,bl:D,br:R,tex:{x:o.paddedRect.x+1+O,y:o.paddedRect.y+1+B,w:a.stretch+a.fixed-O,h:l.stretch+l.fixed-B},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:N,pixelOffsetBR:z,minFontScaleX:S/s/C,minFontScaleY:T/s/P,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const t=Hh(h,g,f),e=Hh(d,y,m);for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)a.push(I(i,e[t],r,e[t+1]))}}else a.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function Vh(t,e,n){let i=0;for(const r of t)i+=Math.max(e,Math.min(n,r[1]))-Math.max(e,Math.min(n,r[0]));return i}function Hh(t,e,n){const i=[{fixed:-1,stretch:0}];for(const[r,a]of t){const t=i[i.length-1];i.push({fixed:r-t.stretch,stretch:t.stretch}),i.push({fixed:r-t.stretch,stretch:t.stretch+(a-r)})}return i.push({fixed:e+1,stretch:n}),i}function Gh(t,e,n,i){return t/e*n+i}function Wh(t,e,n,i){return t-e*n/i}sa("Anchor",Rh);class qh{constructor(t,e,i,r,a,o,s,l,c,u){var h;if(this.boxStartIndex=t.length,c){let t=o.top,e=o.bottom;const n=o.collisionPadding;n&&(t-=n[1],e+=n[3]);let i=e-t;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{const c=(null===(h=o.image)||void 0===h?void 0:h.content)&&(o.image.textFitWidth||o.image.textFitHeight)?Fu(o):{x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};c.y1=c.y1*s-l[0],c.y2=c.y2*s+l[2],c.x1=c.x1*s-l[3],c.x2=c.x2*s+l[1];const d=o.collisionPadding;if(d&&(c.x1-=d[0]*s,c.y1-=d[1]*s,c.x2+=d[2]*s,c.y2+=d[3]*s),u){const t=new n(c.x1,c.y1),e=new n(c.x2,c.y1),i=new n(c.x1,c.y2),r=new n(c.x2,c.y2),a=u*Math.PI/180;t._rotate(a),e._rotate(a),i._rotate(a),r._rotate(a),c.x1=Math.min(t.x,e.x,i.x,r.x),c.x2=Math.max(t.x,e.x,i.x,r.x),c.y1=Math.min(t.y,e.y,i.y,r.y),c.y2=Math.max(t.y,e.y,i.y,r.y)}t.emplaceBack(e.x,e.y,c.x1,c.y1,c.x2,c.y2,i,r,a)}this.boxEndIndex=t.length}}class Zh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1);const a=i+1;if(a<this.length&&n(e[a],e[i])<0&&(i=a),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}}function Xh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Ah.fromPoints(t[0]),a=Math.min(r.width(),r.height());let o=a/2;const s=new Zh([],Yh),{minX:l,minY:c,maxX:u,maxY:h}=r;if(0===a)return new n(l,c);for(let n=l;n<u;n+=a)for(let e=c;e<h;e+=a)s.push(new Kh(n+o,e+o,o,t));let d=function(t){let e=0,n=0,i=0;const r=t[0];for(let a=0,o=r.length,s=o-1;a<o;s=a++){const t=r[a],o=r[s],l=t.x*o.y-o.x*t.y;n+=(t.x+o.x)*l,i+=(t.y+o.y)*l,e+=3*l}return new Kh(n/e,i/e,0,t)}(t),p=s.length;for(;s.length;){const n=s.pop();(n.d>d.d||!d.d)&&(d=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=e||(o=n.h/2,s.push(new Kh(n.p.x-o,n.p.y-o,o,t)),s.push(new Kh(n.p.x+o,n.p.y-o,o,t)),s.push(new Kh(n.p.x-o,n.p.y+o,o,t)),s.push(new Kh(n.p.x+o,n.p.y+o,o,t)),p+=4)}return i&&(console.log("num probes: ".concat(p)),console.log("best distance: ".concat(d.d))),d.p}function Yh(t,e){return e.max-t.max}function Kh(t,e,i,r){this.p=new n(t,e),this.h=i,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const a=e[r];for(let e=0,r=a.length,o=r-1;e<r;o=e++){const r=a[e],s=a[o];r.y>t.y!=s.y>t.y&&t.x<(s.x-r.x)*(t.y-r.y)/(s.y-r.y)+r.x&&(n=!n),i=Math.min(i,Os(t,r,s))}}return(n?1:-1)*Math.sqrt(i)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Jh;t.aE=void 0,(Jh=t.aE||(t.aE={}))[Jh.center=1]="center",Jh[Jh.left=2]="left",Jh[Jh.right=3]="right",Jh[Jh.top=4]="top",Jh[Jh.bottom=5]="bottom",Jh[Jh["top-left"]=6]="top-left",Jh[Jh["top-right"]=7]="top-right",Jh[Jh["bottom-left"]=8]="bottom-left",Jh[Jh["bottom-right"]=9]="bottom-right";const $h=Number.POSITIVE_INFINITY;function Qh(t,e){return e[1]!==$h?function(t,e,n){let i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(t,e[0],e[1]):function(t,e){let n=0,i=0;e<0&&(e=0);const r=e/Math.SQRT2;switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(t,e[0])}function td(t,e,n){var i;const r=t.layout,a=null===(i=r.get("text-variable-anchor-offset"))||void 0===i?void 0:i.evaluate(e,{},n);if(a){const t=a.values,e=[];for(let n=0;n<t.length;n+=2){const i=e[n]=t[n],r=t[n+1].map(t=>t*Xc);i.startsWith("top")?r[1]-=7:i.startsWith("bottom")&&(r[1]+=7),e[n+1]=r}return new Fe(e)}const o=r.get("text-variable-anchor");if(o){let i;i=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[r.get("text-radial-offset").evaluate(e,{},n)*Xc,$h]:r.get("text-offset").evaluate(e,{},n).map(t=>t*Xc);const a=[];for(const t of o)a.push(t,Qh(t,i));return new Fe(a)}return null}function ed(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nd(e,n,i,r,a,o,s,l,c,u,h,d){let p=o.textMaxSize.evaluate(n,{});void 0===p&&(p=s);const f=e.layers[0].layout,m=f.get("icon-offset").evaluate(n,{},h),g=rd(i.horizontal),y=s/24,v=e.tilePixelRatio*y,_=e.tilePixelRatio*p/24,b=e.tilePixelRatio*l,x=e.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*e.tilePixelRatio,S=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const r=t.get("icon-padding").evaluate(e,{},n),a=r&&r.values;return[a[0]*i,a[1]*i,a[2]*i,a[3]*i]}(f,n,h,e.tilePixelRatio),M=f.get("text-max-angle")/180*Math.PI,T="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),A="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),E=f.get("symbol-placement"),C=x/2,P=f.get("icon-text-fit");let L;r&&"none"!==P&&(e.allowVerticalPlacement&&i.vertical&&(L=Ou(r,i.vertical,P,f.get("icon-text-fit-padding"),m,y)),g&&(r=Ou(r,g,P,f.get("icon-text-fit-padding"),m,y)));const k=h?d.line.getGranularityForZoomLevel(h.z):1,R=(l,d)=>{d.x<0||d.x>=I||d.y<0||d.y>=I||function(e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M,T){const A=e.addToLineVertexArray(n,i);let E,C,P,I,L=0,k=0,R=0,D=0,N=-1,z=-1;const F={};let O=rs("");if(e.allowVerticalPlacement&&r.vertical){const t=l.layout.get("text-rotate").evaluate(x,{},M)+90;P=new qh(c,n,u,h,d,r.vertical,p,f,m,t),s&&(I=new qh(c,n,u,h,d,s,y,v,m,t))}if(a){const i=l.layout.get("icon-rotate").evaluate(x,{}),r="none"!==l.layout.get("icon-text-fit"),o=jh(a,i,S,r),p=s?jh(s,i,S,r):void 0;C=new qh(c,n,u,h,d,a,y,v,!1,i),L=4*o.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Bu*l.layout.get("icon-size").evaluate(x,{})],m[0]>Uu&&W("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))):"composite"===f.kind&&(m=[Bu*w.compositeIconSizes[0].evaluate(x,{},M),Bu*w.compositeIconSizes[1].evaluate(x,{},M)],(m[0]>Uu||m[1]>Uu)&&W("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))),e.addSymbols(e.icon,o,m,b,_,x,t.ao.none,n,A.lineStartIndex,A.lineLength,-1,M),N=e.icon.placedSymbolArray.length-1,p&&(k=4*p.length,e.addSymbols(e.icon,p,m,b,_,x,t.ao.vertical,n,A.lineStartIndex,A.lineLength,-1,M),z=e.icon.placedSymbolArray.length-1)}const B=Object.keys(r.horizontal);for(const W of B){const i=r.horizontal[W];if(!E){O=rs(i.text);const t=l.layout.get("text-rotate").evaluate(x,{},M);E=new qh(c,n,u,h,d,i,p,f,m,t)}const a=1===i.positionedLines.length;if(R+=id(e,n,i,o,l,m,x,g,A,r.vertical?t.ao.horizontal:t.ao.horizontalOnly,a?B:[W],F,N,w,M),a)break}r.vertical&&(D+=id(e,n,r.vertical,o,l,m,x,g,A,t.ao.vertical,["vertical"],F,z,w,M));const U=E?E.boxStartIndex:e.collisionBoxArray.length,j=E?E.boxEndIndex:e.collisionBoxArray.length,V=P?P.boxStartIndex:e.collisionBoxArray.length,H=P?P.boxEndIndex:e.collisionBoxArray.length,G=C?C.boxStartIndex:e.collisionBoxArray.length,q=C?C.boxEndIndex:e.collisionBoxArray.length,Z=I?I.boxStartIndex:e.collisionBoxArray.length,X=I?I.boxEndIndex:e.collisionBoxArray.length;let Y=-1;const K=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;Y=K(E,Y),Y=K(P,Y),Y=K(C,Y),Y=K(I,Y);const J=Y>-1?1:0;J&&(Y*=T/Xc),e.glyphOffsetArray.length>=Yu.MAX_GLYPHS&&W("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey);const $=td(l,x,M),[Q,tt]=function(e,n){const i=e.length,r=null==n?void 0:n.values;if((null==r?void 0:r.length)>0)for(let a=0;a<r.length;a+=2){const n=r[a+1];e.emplaceBack(t.aE[r[a]],n[0],n[1])}return[i,e.length]}(e.textAnchorOffsets,$);e.symbolInstances.emplaceBack(n.x,n.y,F.right>=0?F.right:-1,F.center>=0?F.center:-1,F.left>=0?F.left:-1,F.vertical||-1,N,z,O,U,j,V,H,G,q,Z,X,u,R,D,L,k,J,0,p,Y,Q,tt)}(e,d,l,i,r,a,L,e.layers[0],e.collisionBoxArray,n.index,n.sourceLayerIndex,e.index,v,[w,w,w,w],T,c,b,S,A,m,n,o,u,h,s)};if("line"===E)for(const t of kh(n.geometry,0,0,I,I)){const n=Jl(t,k),a=Bh(n,x,M,i.vertical||g,r,24,_,e.overscaling,I);for(const t of a)g&&ad(e,g.text,C,t)||R(n,t)}else if("line-center"===E){for(const t of n.geometry)if(t.length>1){const e=Jl(t,k),n=Oh(e,M,i.vertical||g,r,24,_);n&&R(e,n)}}else if("Polygon"===n.type)for(const t of ei(n.geometry,0)){const e=Xh(t,16);R(Jl(t[0],k,!0),new Rh(e.x,e.y,0))}else if("LineString"===n.type)for(const t of n.geometry){const e=Jl(t,k);R(e,new Rh(e[0].x,e[0].y,0))}else if("Point"===n.type)for(const t of n.geometry)for(const e of t)R([e],new Rh(e.x,e.y,0))}function id(t,e,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=function(t,e,i,r,a,o,s,l){const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const h of e.positionedLines)for(const t of h.positionedGlyphs){if(!t.rect)continue;const r=t.rect||{};let o=4,d=!0,p=1,f=0;const m=(a||l)&&t.vertical,g=t.metrics.advance*t.scale/2;if(l&&e.verticalizable&&(f=h.lineOffset/2-(t.imageName?-(Xc-t.metrics.width*t.scale)/2:(t.scale-1)*Xc)),t.imageName){const e=s[t.imageName];d=e.sdf,p=e.pixelRatio,o=1/p}const y=a?[t.x+g,t.y]:[0,0];let v=a?[0,0]:[t.x+g+i[0],t.y+i[1]-f],_=[0,0];m&&(_=v,v=[0,0]);const b=t.metrics.isDoubleResolution?2:1,x=(t.metrics.left-o)*t.scale-g+v[0],w=(-t.metrics.top-o)*t.scale+v[1],S=x+r.w/b*t.scale/p,M=w+r.h/b*t.scale/p,T=new n(x,w),A=new n(S,w),E=new n(x,M),C=new n(S,M);if(m){const e=new n(-g,g- -17),i=-Math.PI/2,r=12-g,a=new n(22-r,-(t.imageName?r:0)),o=new n(..._);T._rotateAround(i,e)._add(a)._add(o),A._rotateAround(i,e)._add(a)._add(o),E._rotateAround(i,e)._add(a)._add(o),C._rotateAround(i,e)._add(a)._add(o)}if(c){const t=Math.sin(c),e=Math.cos(c),n=[e,-t,t,e];T._matMult(n),A._matMult(n),E._matMult(n),C._matMult(n)}const P=new n(0,0),I=new n(0,0);u.push({tl:T,tr:A,bl:E,br:C,tex:r,writingMode:e.writingMode,glyphOffset:y,sectionIndex:t.sectionIndex,isSDF:d,pixelOffsetTL:P,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,a,o,s,r,t.allowVerticalPlacement),y=t.textSizeData;let v=null;"source"===y.kind?(v=[Bu*a.layout.get("text-size").evaluate(s,{})],v[0]>Uu&&W("".concat(t.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))):"composite"===y.kind&&(v=[Bu*f.compositeTextSizes[0].evaluate(s,{},m),Bu*f.compositeTextSizes[1].evaluate(s,{},m)],(v[0]>Uu||v[1]>Uu)&&W("".concat(t.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))),t.addSymbols(t.text,g,v,l,o,s,u,e,c.lineStartIndex,c.lineLength,p,m);for(const n of h)d[n]=t.text.placedSymbolArray.length-1;return 4*g.length}function rd(t){for(const e in t)return t[e];return null}function ad(t,e,n,i){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<n)return!0}else r[e]=[];return r[e].push(i),!1}const od=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,n]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=od[15&n];if(!r)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new sd(o,a,r,t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const r=od.indexOf(this.ArrayType),a=2*t*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+s,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+a+o+s),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+s,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=e,n}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return ld(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:a,nodeSize:o}=this,s=[0,r.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let o=h;o<=u;o++){const s=a[2*o],c=a[2*o+1];s>=t&&s<=n&&c>=e&&c<=i&&l.push(r[o])}continue}const d=h+u>>1,p=a[2*d],f=a[2*d+1];p>=t&&p<=n&&f>=e&&f<=i&&l.push(r[d]),(0===c?t<=p:e<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?n>=p:i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return l}within(t,e,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:a}=this,o=[0,i.length-1,0],s=[],l=n*n;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,h=o.pop()||0;if(u-h<=a){for(let n=h;n<=u;n++)dd(r[2*n],r[2*n+1],t,e)<=l&&s.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];dd(p,f,t,e)<=l&&s.push(i[d]),(0===c?t-n<=p:e-n<=f)&&(o.push(h),o.push(d-1),o.push(1-c)),(0===c?t+n>=p:e+n>=f)&&(o.push(d+1),o.push(u),o.push(1-c))}return s}}function ld(t,e,n,i,r,a){if(r-i<=n)return;const o=i+r>>1;cd(t,e,o,i,r,a),ld(t,e,n,i,o-1,1-a),ld(t,e,n,o+1,r,1-a)}function cd(t,e,n,i,r,a){for(;r>i;){if(r-i>600){const o=r-i+1,s=n-i+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);cd(t,e,n,Math.max(i,Math.floor(n-s*c/o+u)),Math.min(r,Math.floor(n+(o-s)*c/o+u)),a)}const o=e[2*n+a];let s=i,l=r;for(ud(t,e,i,n),e[2*r+a]>o&&ud(t,e,i,r);s<l;){for(ud(t,e,s,l),s++,l--;e[2*s+a]<o;)s++;for(;e[2*l+a]>o;)l--}e[2*i+a]===o?ud(t,e,i,l):(l++,ud(t,e,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function ud(t,e,n,i){hd(t,n,i),hd(e,2*n,2*i),hd(e,2*n+1,2*i+1)}function hd(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function dd(t,e,n,i){const r=t-n,a=e-i;return r*r+a*a}var pd;t.cx=void 0,(pd=t.cx||(t.cx={})).create="create",pd.load="load",pd.fullLoad="fullLoad";let fd=null,md=[];const gd=1e3/60,yd="loadTime",vd="fullLoadTime",_d={mark(t){performance.mark(t)},frame(t){const e=t;null!=fd&&md.push(e-fd),fd=e},clearMetrics(){fd=null,md=[],performance.clearMeasures(yd),performance.clearMeasures(vd);for(const e in t.cx)performance.clearMarks(t.cx[e])},getPerformanceMetrics(){performance.measure(yd,t.cx.create,t.cx.load),performance.measure(vd,t.cx.create,t.cx.fullLoad);const e=performance.getEntriesByName(yd)[0].duration,n=performance.getEntriesByName(vd)[0].duration,i=md.length,r=1/(md.reduce((t,e)=>t+e,0)/i/1e3),a=md.filter(t=>t>gd).reduce((t,e)=>t+(e-gd)/gd,0);return{loadTime:e,fullLoadTime:n,fps:r,percentDroppedFrames:a/(i+a)*100,totalFrames:i}}};t.$=I,t.A=f,t.B=function(t){let[e,n,i]=t;return n+=90,n*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i)}},t.C=gn,t.D=Fa,t.E=vt,t.F=Ca,t.G=ea,t.H=function(t){if(null==X){const e=t.navigator?t.navigator.userAgent:null;X=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return X},t.I=fu,t.J=class{constructor(t,e){this.target=t,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lh(()=>this.process()),this.subscription=tt(this.target,"message",t=>this.receive(t),!1),this.globalScope=Z(self)?t:window}registerMessageHandler(t,e){this.messageHandlers[t]=e}sendAsync(t,e){return new Promise((n,i)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10),a=e?tt(e.signal,"abort",()=>{null==a||a.unsubscribe(),delete this.resolveRejects[r];const e={id:r,type:"<cancel>",origin:location.origin,targetMapId:t.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)},ch):null;this.resolveRejects[r]={resolve:t=>{null==a||a.unsubscribe(),n(t)},reject:t=>{null==a||a.unsubscribe(),i(t)}};const o=[],s=Object.assign(Object.assign({},t),{id:r,sourceMapId:this.mapId,origin:location.origin,data:ha(t.data,o)});this.target.postMessage(s,{transfer:o})})}receive(t){const e=t.data,n=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&"resource://android"!==e.origin&&"resource://android"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[n];const t=this.abortControllers[n];return delete this.abortControllers[n],void(t&&t.abort())}if(Z(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(0===this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,n){return e(this,void 0,void 0,function*(){if("<response>"===n.type){const e=this.resolveRejects[t];if(delete this.resolveRejects[t],!e)return;return void(n.error?e.reject(da(n.error)):e.resolve(da(n.data)))}if(!this.messageHandlers[n.type])return void this.completeTask(t,new Error("Could not find a registered handler for ".concat(n.type,", map ID: ").concat(this.mapId,", available handlers: ").concat(Object.keys(this.messageHandlers).join(", "))));const e=da(n.data),i=new AbortController;this.abortControllers[t]=i;try{const r=yield this.messageHandlers[n.type](n.sourceMapId,e,i);this.completeTask(t,null,r)}catch(e){this.completeTask(t,e)}})}completeTask(t,e,n){const i=[];delete this.abortControllers[t];const r={id:t,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?ha(e):null,data:ha(n,i)};this.target.postMessage(r,{transfer:i})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},t.K=ct,t.L=function(){var t=new f(16);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.M=function(t,e,n){var i,r,a,o,s,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=i=e[0],t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=i*m+s*g+h*y+e[12],t[13]=r*m+l*g+d*y+e[13],t[14]=a*m+c*g+p*y+e[14],t[15]=o*m+u*g+f*y+e[15]),t},t.N=function(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.O=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*i+b*s+x*h+w*m,t[1]=_*r+b*l+x*d+w*g,t[2]=_*a+b*c+x*p+w*y,t[3]=_*o+b*u+x*f+w*v,t[4]=(_=n[4])*i+(b=n[5])*s+(x=n[6])*h+(w=n[7])*m,t[5]=_*r+b*l+x*d+w*g,t[6]=_*a+b*c+x*p+w*y,t[7]=_*o+b*u+x*f+w*v,t[8]=(_=n[8])*i+(b=n[9])*s+(x=n[10])*h+(w=n[11])*m,t[9]=_*r+b*l+x*d+w*g,t[10]=_*a+b*c+x*p+w*y,t[11]=_*o+b*u+x*f+w*v,t[12]=(_=n[12])*i+(b=n[13])*s+(x=n[14])*h+(w=n[15])*m,t[13]=_*r+b*l+x*d+w*g,t[14]=_*a+b*c+x*p+w*y,t[15]=_*o+b*u+x*f+w*v,t},t.P=n,t.Q=function(t,e){const n={};for(let i=0;i<e.length;i++){const r=e[i];r in t&&(n[r]=t[r])}return n},t.R=il,t.S=hh,t.T=dl,t.U=mh,t.V=fh,t.W=h,t.X=d,t.Y=J,t.Z=Sh,t._=e,t.a=st,t.a$=M,t.a0=function(t,e){var n,i,r,a;if(!t)return null!=e?e:{};if(!e)return t;const o=Object.assign({},t);if(e.removeAll&&(o.removeAll=!0),e.remove){const t=new Set(o.remove?o.remove.concat(e.remove):e.remove);o.remove=Array.from(t.values())}if(e.add){const t=o.add?o.add.concat(e.add):e.add,n=new Map(t.map(t=>[t.id,t]));o.add=Array.from(n.values())}if(e.update){const t=new Map(null===(n=o.update)||void 0===n?void 0:n.map(t=>[t.id,t]));for(const n of e.update){const e=null!==(i=t.get(n.id))&&void 0!==i?i:{id:n.id};n.newGeometry&&(e.newGeometry=n.newGeometry),n.addOrUpdateProperties&&(e.addOrUpdateProperties=(null!==(r=e.addOrUpdateProperties)&&void 0!==r?r:[]).concat(n.addOrUpdateProperties)),n.removeProperties&&(e.removeProperties=(null!==(a=e.removeProperties)&&void 0!==a?a:[]).concat(n.removeProperties)),n.removeAllProperties&&(e.removeAllProperties=!0),t.set(n.id,e)}o.update=Array.from(t.values())}return o},t.a1=_h,t.a2=Ah,t.a3=25,t.a4=xh,t.a5=t=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const i of t){const t=window.document.createElement("source");pt(i)||(e.crossOrigin="Anonymous"),t.src=i,e.appendChild(t)}})},t.a6=Lt,t.a7=function(){return U++},t.a8=xo,t.a9=Yu,t.aA=function(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(const a of t)e=Math.min(e,a.x),n=Math.min(n,a.y),i=Math.max(i,a.x),r=Math.max(r,a.y);return[e,n,i,r]},t.aB=Xc,t.aC=L,t.aD=function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!n[0]&&!n[1])return[0,0];const a=r?"map"===i?-t.bearingInRadians:0:"viewport"===i?t.bearingInRadians:0;if(a){const t=Math.sin(a),e=Math.cos(a);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}return[r?n[0]:L(e,n[0],t.zoom),r?n[1]:L(e,n[1],t.zoom)]},t.aF=Vu,t.aG=ed,t.aH=Pu,t.aI=sd,t.aJ=Xa,t.aK=ql,t.aL=ko,t.aM=Xo,t.aN=Go,t.aO=O,t.aP=nt,t.aQ=vh,t.aR=x,t.aS=b,t.aT=function(t){var e=new f(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.aU=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.aV=function(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t},t.aW=w,t.aX=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.aY=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},t.aZ=v,t.a_=function(t,e,n){const i=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return 0===i?null:(-(t[0]*n[0]+t[1]*n[1]+t[2]*n[2])-n[3])/i},t.aa=dr,t.ab=Es,t.ac=Ch,t.ad=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,i,r)=>{const a=i||r;return e[n]=!a||a.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ae=et,t.af=function(t){return Math.pow(2,t)},t.ag=g,t.ah=F,t.ai=85.051129,t.aj=gh,t.ak=function(t){return Math.log(t)/Math.LN2},t.al=function(t){var e=t[0],n=t[1];return e*e+n*n},t.am=function(t,e){const n=[];for(const i in t)i in e||n.push(i);return n},t.an=function(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:a,maxZoom:o}=t,s=r?F(fn.interpolationFactor(r,e,a,o),0,1):0;"camera"===t.kind?i=gn.number(t.minSize,t.maxSize,s):n=s}return{uSizeT:n,uSize:i}},t.ap=function(t,e,n){let{uSize:i,uSizeT:r}=e,{lowerSize:a,upperSize:o}=n;return"source"===t.kind?a/Bu:"composite"===t.kind?gn.number(a/Bu,o/Bu,r):i},t.aq=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=n*s-i*o,_=n*l-r*o,b=n*c-a*o,x=i*l-r*s,w=i*c-a*s,S=r*c-a*l,M=u*m-h*f,T=u*g-d*f,A=u*y-p*f,E=h*g-d*m,C=h*y-p*m,P=d*y-p*g,I=v*P-_*C+b*E+x*A-w*T+S*M;return I?(t[0]=(s*P-l*C+c*E)*(I=1/I),t[1]=(r*C-i*P-a*E)*I,t[2]=(m*S-g*w+y*x)*I,t[3]=(d*w-h*S-p*x)*I,t[4]=(l*A-o*P-c*T)*I,t[5]=(n*P-r*A+a*T)*I,t[6]=(g*b-f*S-y*_)*I,t[7]=(u*S-d*b+p*_)*I,t[8]=(o*C-s*A+c*M)*I,t[9]=(i*A-n*C-a*M)*I,t[10]=(f*w-m*b+y*v)*I,t[11]=(h*b-u*w-p*v)*I,t[12]=(s*T-o*E-l*M)*I,t[13]=(n*E-i*T+r*M)*I,t[14]=(m*_-f*x-g*v)*I,t[15]=(u*x-h*_+d*v)*I,t):null},t.ar=C,t.as=function(t){return Math.hypot(t[0],t[1])},t.at=function(t){return t[0]=0,t[1]=0,t},t.au=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},t.av=Wu,t.aw=T,t.ax=function(t,e,i,r){const a=e.y-t.y,o=e.x-t.x,s=r.y-i.y,l=r.x-i.x,c=s*o-l*a;if(0===c)return null;const u=(l*(t.y-i.y)-s*(t.x-i.x))/c;return new n(t.x+u*o,t.y+u*a)},t.ay=kh,t.az=Ls,t.b=Y,t.b$=class extends lo{},t.b0=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.b1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},t.b2=wh,t.b3=Mh,t.b4=function(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+i)*(a=1/(i-r)),t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t},t.b5=function(t){var e=new f(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.b6=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+c*i,t[1]=o*r+u*i,t[2]=s*r+h*i,t[3]=l*r+d*i,t[4]=c*r-a*i,t[5]=u*r-o*i,t[6]=h*r-s*i,t[7]=d*r-l*i,t},t.b7=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+c*i,t[5]=o*r+u*i,t[6]=s*r+h*i,t[7]=l*r+d*i,t[8]=c*r-a*i,t[9]=u*r-o*i,t[10]=h*r-s*i,t[11]=d*r-l*i,t},t.b8=function(){const t=new Float32Array(16);return g(t),t},t.b9=function(){const t=new Float64Array(16);return g(t),t},t.bA=function(t,e){const n=k(t,360),i=k(e,360),r=i-n,a=i>n?r-360:r+360;return Math.abs(r)<Math.abs(a)?r:a},t.bB=function(t){return t[0]=0,t[1]=0,t[2]=0,t},t.bC=function(t,e,n,i){const r=Math.sqrt(t*t+e*e),a=Math.sqrt(n*n+i*i);t/=r,e/=r,n/=a,i/=a;const o=Math.acos(t*n+e*i);return-e*n+t*i>0?o:-o},t.bD=function(t,e){const n=k(t,2*Math.PI),i=k(e,2*Math.PI);return Math.min(Math.abs(n-i),Math.abs(n-i+2*Math.PI),Math.abs(n-i-2*Math.PI))},t.bE=function(){const t={},e=_t.$version;for(const n in _t.$root){const i=_t.$root[n];if(i.required){let r=null;r="version"===n?e:"array"===i.type?[]:{},null!=r&&(t[n]=r)}}return t},t.bF=pa,t.bG=ht,t.bH=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(!t(e[i],n[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.bI=function(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=xt(t[n],e[t[n].ref]));return t},t.bJ=function(t){if("custom"===t.type)return new sh(t);switch(t.type){case"background":return new ih(t);case"circle":return new Xs(t);case"color-relief":return new ml(t);case"fill":return new ac(t);case"fill-extrusion":return new Mc(t);case"heatmap":return new ol(t);case"hillshade":return new cl(t);case"line":return new Bc(t);case"raster":return new oh(t);case"symbol":return new th(t)}},t.bK=H,t.bL=function(t,e){if(!t)return[{command:"setStyle",args:[e]}];let n=[];try{if(!wt(t.version,e.version))return[{command:"setStyle",args:[e]}];wt(t.center,e.center)||n.push({command:"setCenter",args:[e.center]}),wt(t.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),wt(t.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),wt(t.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),wt(t.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),wt(t.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),wt(t.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),wt(t.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),wt(t.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),wt(t.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),wt(t.light,e.light)||n.push({command:"setLight",args:[e.light]}),wt(t.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),wt(t.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),wt(t.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const i={},r=[];!function(t,e,n,i){let r;for(r in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)||Tt(r,n,i));for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?wt(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&Et(t,e,r)?St(n,{command:"setGeoJSONSourceData",args:[r,e[r].data]}):At(r,e,n,i)):Mt(r,e,n))}(t.sources,e.sources,r,i);const a=[];t.layers&&t.layers.forEach(t=>{"source"in t&&i[t.source]?n.push({command:"removeLayer",args:[t.id]}):a.push(t)}),n=n.concat(r),function(t,e,n){e=e||[];const i=(t=t||[]).map(Pt),r=e.map(Pt),a=t.reduce(It,{}),o=e.reduce(It,{}),s=i.slice(),l=Object.create(null);let c,u,h,d,p;for(let f=0,m=0;f<i.length;f++)c=i[f],Object.prototype.hasOwnProperty.call(o,c)?m++:(St(n,{command:"removeLayer",args:[c]}),s.splice(s.indexOf(c,m),1));for(let f=0,m=0;f<r.length;f++)c=r[r.length-1-f],s[s.length-1-f]!==c&&(Object.prototype.hasOwnProperty.call(a,c)?(St(n,{command:"removeLayer",args:[c]}),s.splice(s.lastIndexOf(c,s.length-m),1)):m++,d=s[s.length-f],St(n,{command:"addLayer",args:[o[c],d]}),s.splice(s.length-f,0,c),l[c]=!0);for(let f=0;f<r.length;f++)if(c=r[f],u=a[c],h=o[c],!l[c]&&!wt(u,h))if(wt(u.source,h.source)&&wt(u["source-layer"],h["source-layer"])&&wt(u.type,h.type)){for(p in Ct(u.layout,h.layout,n,c,null,"setLayoutProperty"),Ct(u.paint,h.paint,n,c,null,"setPaintProperty"),wt(u.filter,h.filter)||St(n,{command:"setFilter",args:[c,h.filter]}),wt(u.minzoom,h.minzoom)&&wt(u.maxzoom,h.maxzoom)||St(n,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ct(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):wt(u[p],h[p])||St(n,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ct(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):wt(u[p],h[p])||St(n,{command:"setLayerProperty",args:[c,p,h[p]]}))}else St(n,{command:"removeLayer",args:[c]}),d=s[s.lastIndexOf(c)+1],St(n,{command:"addLayer",args:[h,d]})}(a,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:"setStyle",args:[e]}]}return n},t.bM=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===t.render&&e.push({message:"layers.".concat(n,': missing required method "render"')}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),e},t.bN=j,t.bO=V,t.bP=class extends cs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.bQ=ds,t.bR=class extends cs{constructor(t,e){super(t,e),this.current=ps}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.bS=hs,t.bT=class extends cs{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.bU=class extends cs{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.bV=m,t.bW=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.bX=function(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t},t.bY=function(t,e,n,i,r,a,o){var s=1/(e-n),l=1/(i-r),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*l,t[14]=(o+a)*c,t[15]=1,t},t.bZ=class extends cs{constructor(t,e){super(t,e),this.current=new Array}set(t){if(t!=this.current){this.current=t;const e=new Float32Array(4*t.length);for(let n=0;n<t.length;n++)e[4*n]=t[n].r,e[4*n+1]=t[n].g,e[4*n+2]=t[n].b,e[4*n+3]=t[n].a;this.gl.uniform4fv(this.location,e)}}},t.b_=class extends cs{constructor(t,e){super(t,e),this.current=new Array}set(t){if(t!=this.current){this.current=t;const e=new Float32Array(t);this.gl.uniform1fv(this.location,e)}}},t.ba=function(){return new Float64Array(16)},t.bb=function(t,e,n){const i=new Float64Array(4);return E(i,t,e-90,n),i},t.bc=function(t,e,n,i){var r,a,o,s,l,c=e[0],u=e[1],h=e[2],d=e[3],f=n[0],m=n[1],g=n[2],y=n[3];return(a=c*f+u*m+h*g+d*y)<0&&(a=-a,f=-f,m=-m,g=-g,y=-y),1-a>p?(r=Math.acos(a),o=Math.sin(r),s=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(s=1-i,l=i),t[0]=s*c+l*f,t[1]=s*u+l*m,t[2]=s*h+l*g,t[3]=s*d+l*y,t},t.bd=function(t){const e=new Float64Array(9);var n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_;h=(r=(i=t)[0])*(l=r+r),d=(a=i[1])*l,f=(o=i[2])*l,m=o*(c=a+a),y=(s=i[3])*l,v=s*c,_=s*(u=o+o),(n=e)[0]=1-(p=a*c)-(g=o*u),n[3]=d-_,n[6]=f+v,n[1]=d+_,n[4]=1-h-g,n[7]=m-y,n[2]=f-v,n[5]=m+y,n[8]=1-h-p;const b=nt(-Math.asin(F(e[2],-1,1)));let x,w;return Math.hypot(e[5],e[8])<.001?(x=0,w=-nt(Math.atan2(e[3],e[4]))):(x=nt(0===e[5]&&0===e[8]?0:Math.atan2(e[5],e[8])),w=nt(0===e[1]&&0===e[0]?0:Math.atan2(e[1],e[0]))),{roll:x,pitch:b+90,bearing:w}},t.be=function(t,e){return t.roll==e.roll&&t.pitch==e.pitch&&t.bearing==e.bearing},t.bf=Ee,t.bg=us,t.bh=Zl,t.bi=Xl,t.bj=Wl,t.bk=R,t.bl=D,t.bm=Be,t.bn=function(t,e,n,i,r){return R(i,r,F((t-e)/(n-e),0,1))},t.bo=k,t.bp=function(){return new Float64Array(3)},t.bq=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},t.br=E,t.bs=function(t,e,n){var i=n[0],r=n[1],a=n[2],o=e[0],s=e[1],l=e[2],c=r*l-a*s,u=a*o-i*l,h=i*s-r*o,d=r*h-a*u,p=a*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,t[0]=o+(c*=m)+(d*=2),t[1]=s+u+p,t[2]=l+h+f,t},t.bt=function(t,e,n){const i=(r=[t[0],t[1],t[2],e[0],e[1],e[2],n[0],n[1],n[2]])[0]*((u=r[8])*(o=r[4])-(s=r[5])*(c=r[7]))+r[1]*(-u*(a=r[3])+s*(l=r[6]))+r[2]*(c*a-o*l);var r,a,o,s,l,c,u;if(0===i)return null;const h=w([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),d=w([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),p=w([],[t[0],t[1],t[2]],[e[0],e[1],e[2]]),f=x([],h,-t[3]);return b(f,f,x([],d,-e[3])),b(f,f,x([],p,-n[3])),x(f,f,1/i),f},t.bu=uh,t.bv=function(){return new Float64Array(4)},t.bw=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},t.bx=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},t.by=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},t.bz=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-c*i,t[1]=o*r-u*i,t[2]=s*r-h*i,t[3]=l*r-d*i,t[8]=a*i+c*r,t[9]=o*i+u*r,t[10]=s*i+h*r,t[11]=l*i+d*r,t},t.c=ot,t.c0=Wc,t.c1=class extends uo{},t.c2=al,t.c3=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.c4=rl,t.c5=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/(o=o||1),t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,t},t.c6=class extends $a{},t.c7=class extends vo{},t.c8=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},t.c9=function(t,e){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=e[0],b=e[1],x=e[2],w=e[3],S=e[4],M=e[5],T=e[6],A=e[7],E=e[8],C=e[9],P=e[10],I=e[11],L=e[12],k=e[13],R=e[14],D=e[15];return Math.abs(n-_)<=p*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-b)<=p*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(r-x)<=p*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-w)<=p*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-S)<=p*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-M)<=p*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(l-T)<=p*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-A)<=p*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-E)<=p*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-C)<=p*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-P)<=p*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-I)<=p*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(m-L)<=p*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-k)<=p*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(y-R)<=p*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(v-D)<=p*Math.max(1,Math.abs(v),Math.abs(D))},t.cA=function(t,e){st.REGISTERED_PROTOCOLS[t]=e},t.cB=function(t){delete st.REGISTERED_PROTOCOLS[t]},t.cC=function(t,e){const n={};for(let r=0;r<t.length;r++){const i=e&&e[t[r].id]||xr(t[r]);e&&(e[t[r].id]=i);let a=n[i];a||(a=n[i]=[]),a.push(t[r])}const i=[];for(const r in n)i.push(n[r]);return i},t.cD=sa,t.cE=Eh,t.cF=Ph,t.cG=mu,t.cH=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=I/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const n=e.bucket.layers[0],i=n.layout,r=n._unevaluatedLayout._values,a={layoutIconSize:r["icon-size"].possiblyEvaluate(new Ca(e.bucket.zoom+1),e.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Ca(e.bucket.zoom+1),e.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Ca(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.bucket.textSizeData;a.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Ca(t),e.canonical),r["text-size"].possiblyEvaluate(new Ca(n),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.bucket.iconSizeData;a.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Ca(t),e.canonical),r["icon-size"].possiblyEvaluate(new Ca(n),e.canonical)]}const o=i.get("text-line-height")*Xc,s="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),l=i.get("text-keep-upright"),c=i.get("text-size");for(const u of e.bucket.features){const r=i.get("text-font").evaluate(u,{},e.canonical).join(","),h=c.evaluate(u,{},e.canonical),d=a.layoutTextSize.evaluate(u,{},e.canonical),p=a.layoutIconSize.evaluate(u,{},e.canonical),f={horizontal:{},vertical:void 0},m=u.text;let g,y=[0,0];if(m){const a=m.toString(),c=i.get("text-letter-spacing").evaluate(u,{},e.canonical)*Xc,p=ga(a)?c:0,g=i.get("text-anchor").evaluate(u,{},e.canonical),v=td(n,u,e.canonical);if(!v){const t=i.get("text-radial-offset").evaluate(u,{},e.canonical);y=t?Qh(g,[t*Xc,$h]):i.get("text-offset").evaluate(u,{},e.canonical).map(t=>t*Xc)}let _=s?"center":i.get("text-justify").evaluate(u,{},e.canonical);const b="point"===i.get("symbol-placement")?i.get("text-max-width").evaluate(u,{},e.canonical)*Xc:1/0,x=()=>{e.bucket.allowVerticalPlacement&&ma(a)&&(f.vertical=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,b,o,g,"left",p,y,t.ao.vertical,!0,d,h))};if(!s&&v){const n=new Set;if("auto"===_)for(let t=0;t<v.values.length;t+=2)n.add(ed(v.values[t]));else n.add(_);let i=!1;for(const a of n)if(!f.horizontal[a])if(i)f.horizontal[a]=f.horizontal[0];else{const n=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,b,o,"center",a,p,y,t.ao.horizontal,!1,d,h);n&&(f.horizontal[a]=n,i=1===n.positionedLines.length)}x()}else{"auto"===_&&(_=ed(g));const n=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,b,o,g,_,p,y,t.ao.horizontal,!1,d,h);n&&(f.horizontal[_]=n),x(),ma(a)&&s&&l&&(f.vertical=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,b,o,g,_,p,y,t.ao.vertical,!1,d,h))}}let v=!1;if(u.icon&&u.icon.name){const t=e.imageMap[u.icon.name];t&&(g=zu(e.imagePositions[u.icon.name],i.get("icon-offset").evaluate(u,{},e.canonical),i.get("icon-anchor").evaluate(u,{},e.canonical)),v=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=v:e.bucket.sdfIcons!==v&&W("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const _=rd(f.horizontal)||f.vertical;e.bucket.iconsInText=!!_&&_.iconsInText,(_||g)&&nd(e.bucket,u,f,g,e.imageMap,a,d,p,y,v,e.canonical,e.subdivisionGranularity)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.cI=Rc,t.cJ=ec,t.cK=vc,t.cL=fc,t.cM=$c,t.cN=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.cO=function(t,n,i,r,a){return e(this,void 0,void 0,function*(){if(d())try{return yield J(t,n,i,r,a)}catch(t){}return function(t,e,n,i,r){const a=t.width,o=t.height;$&&Q||($=new OffscreenCanvas(a,o),Q=$.getContext("2d",{willReadFrequently:!0})),$.width=a,$.height=o,Q.drawImage(t,0,0,a,o);const s=Q.getImageData(e,n,i,r);return Q.clearRect(0,0,a,o),s.data}(t,n,i,r,a)})},t.cP=pl,t.cQ=r,t.cR=dc,t.cS=cc,t.cT=ir,t.cU=function(t,e){const n=new Map;if(null==t);else if("Feature"===t.type)n.set(Th(t,e),t);else for(const i of t.features)n.set(Th(i,e),i);return n},t.cV=function(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=Th(t,e);if("FeatureCollection"===t.type){const n=new Set;for(const i of t.features){const t=Th(i,e);if(null==t)return!1;if(n.has(t))return!1;n.add(t)}return!0}return!1},t.cW=function(t,e,n){var i,r,a,o;if(e.removeAll&&t.clear(),e.remove)for(const s of e.remove)t.delete(s);if(e.add)for(const s of e.add){const e=Th(s,n);null!=e&&t.set(e,s)}if(e.update)for(const s of e.update){let e=t.get(s.id);if(null==e)continue;const n=!s.removeAllProperties&&((null===(i=s.removeProperties)||void 0===i?void 0:i.length)>0||(null===(r=s.addOrUpdateProperties)||void 0===r?void 0:r.length)>0);if((s.newGeometry||s.removeAllProperties||n)&&(e=Object.assign({},e),t.set(s.id,e),n&&(e.properties=Object.assign({},e.properties))),s.newGeometry&&(e.geometry=s.newGeometry),s.removeAllProperties)e.properties={};else if((null===(a=s.removeProperties)||void 0===a?void 0:a.length)>0)for(const t of s.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(o=s.addOrUpdateProperties)||void 0===o?void 0:o.length)>0)for(const{key:t,value:i}of s.addOrUpdateProperties)e.properties[t]=i}},t.cX=Ea,t.ca=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.cb=t=>"symbol"===t.type,t.cc=t=>"circle"===t.type,t.cd=t=>"heatmap"===t.type,t.ce=t=>"line"===t.type,t.cf=t=>"fill"===t.type,t.cg=t=>"fill-extrusion"===t.type,t.ch=t=>"hillshade"===t.type,t.ci=t=>"color-relief"===t.type,t.cj=t=>"raster"===t.type,t.ck=t=>"background"===t.type,t.cl=t=>"custom"===t.type,t.cm=N,t.cn=function(t,e,n){const i=P(e.x-n.x,e.y-n.y),r=P(t.x-n.x,t.y-n.y);var a,o;return nt(Math.atan2(i[0]*r[1]-i[1]*r[0],(a=i)[0]*(o=r)[0]+a[1]*o[1]))},t.co=z,t.cp=function(t,e){return rt[e]&&(t instanceof MouseEvent||t instanceof WheelEvent)},t.cq=function(t,e){return it[e]&&"touches"in t},t.cr=function(t){return it[t]||rt[t]},t.cs=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t},t.ct=function(t,e){const{x:n,y:i}=_h.fromLngLat(e);return!(t<0||t>25||i<0||i>=1||n<0||n>=1)},t.cu=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.cv=class extends Ja{},t.cw=_d,t.cy=function(t){return t.message===at},t.cz=ut,t.d=pt,t.e=B,t.f=t=>e(void 0,void 0,void 0,function*(){if(0===t.byteLength)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(t)],{type:"image/png"});try{return createImageBitmap(e)}catch(t){throw new Error("Could not load image because of ".concat(t.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}}),t.g=lt,t.h=t=>new Promise((e,n)=>{const i=new Image;i.onload=()=>{e(i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame(()=>{i.src=K})},i.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(r):K}),t.i=Z,t.j=(t,e)=>dt(B(t,{type:"json"}),e),t.k=yt,t.l=gt,t.m=dt,t.n=(t,e)=>dt(B(t,{type:"arrayBuffer"}),e),t.o=function(t){return new $c(t).readFields(uu,[])},t.p=pu,t.q=nl,t.r=Va,t.s=tt,t.t=La,t.u=fa,t.v=_t,t.w=W,t.x=ta,t.y=ra,t.z=Qr}),n("worker",["./shared"],function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,n){for(const r of e){this._layerConfigs[r.id]=r;const e=this._layers[r.id]=t.bJ(r);e._featureFilter=t.aa(e.filter),this.keyCache[r.id]&&delete this.keyCache[r.id]}for(const t of n)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const i=t.cC(Object.values(this._layerConfigs),this.keyCache);for(const t of i){const e=t.map(t=>this._layers[t.id]),n=e[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const a=n.sourceLayer||"_geojsonTileLayer";let o=r[a];o||(o=r[a]=[]),o.push(e)}}}class n{constructor(e){const n={},i=[];for(const t in e){const r=e[t],a=n[t]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const n={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};i.push(n),a[t]={rect:n,metrics:e.metrics}}}const{w:r,h:a}=t.p(i),o=new t.q({width:r||1,height:a||1});for(const s in e){const i=e[s];for(const e in i){const r=i[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const a=n[s][e].rect;t.q.copy(r.bitmap,o,{x:0,y:0},{x:a.x+1,y:a.y+1},r.bitmap)}}this.image=o,this.positions=n}}t.cD("GlyphAtlas",n);class i{constructor(e){this.tileID=new t.Z(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[],this.globalState=e.globalState}parse(e,i,a,o,s){return t._(this,void 0,void 0,function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a8;const l=new t.cE(Object.keys(e.layers).sort()),c=new t.cF(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:a,subdivisionGranularity:s},d=i.familiesBySource[this.source];for(const n in d){const i=e.layers[n];if(!i)continue;1===i.version&&t.w('Vector tile source "'.concat(this.source,'" layer "').concat(n,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const o=l.encode(n),s=[];for(let t=0;t<i.length;t++){const e=i.feature(t),r=c.getId(e,n);s.push({feature:e,id:r,index:t,sourceLayerIndex:o})}for(const e of d[n]){const n=e[0];n.source!==this.source&&t.w("layer.source = ".concat(n.source," does not equal this.source = ").concat(this.source)),n.minzoom&&this.zoom<Math.floor(n.minzoom)||n.maxzoom&&this.zoom>=n.maxzoom||"none"!==n.visibility&&(r(e,this.zoom,a),(u[n.id]=n.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:o,sourceID:this.source,globalState:this.globalState})).populate(s,h,this.tileID.canonical),c.bucketLayerIDs.push(e.map(t=>t.id)))}}const p=t.bN(h.glyphDependencies,t=>Object.keys(t).map(Number));this.inFlightDependencies.forEach(t=>null==t?void 0:t.abort()),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const t=new AbortController;this.inFlightDependencies.push(t),f=o.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},t)}const m=Object.keys(h.iconDependencies);let g=Promise.resolve({});if(m.length){const t=new AbortController;this.inFlightDependencies.push(t),g=o.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"icons"}},t)}const y=Object.keys(h.patternDependencies);let v=Promise.resolve({});if(y.length){const t=new AbortController;this.inFlightDependencies.push(t),v=o.sendAsync({type:"GI",data:{icons:y,source:this.source,tileID:this.tileID,type:"patterns"}},t)}const[_,b,x]=yield Promise.all([f,g,v]),w=new n(_),S=new t.cG(b,x);for(const e in u){const n=u[e];n instanceof t.a9?(r(n.layers,this.zoom,a),t.cH({bucket:n,glyphMap:_,glyphPositions:w.positions,imageMap:b,imagePositions:S.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):n.hasPattern&&(n instanceof t.cI||n instanceof t.cJ||n instanceof t.cK)&&(r(n.layers,this.zoom,a),n.addFeatures(h,this.tileID.canonical,S.patternPositions))}return this.status="done",{buckets:Object.values(u).filter(t=>!t.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:w.image,imageAtlas:S,glyphMap:this.returnDependencies?_:null,iconMap:this.returnDependencies?b:null,glyphPositions:this.returnDependencies?w.positions:null}})}}function r(e,n,i){const r=new t.F(n);for(const t of e)t.recalculate(r,i)}class a{constructor(t,e,n){this.actor=t,this.layerIndex=e,this.availableImages=n,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,n){return t._(this,void 0,void 0,function*(){const i=yield t.n(e.request,n);try{return{vectorTile:new t.cL(new t.cM(i.data)),rawData:i.data,cacheControl:i.cacheControl,expires:i.expires}}catch(t){const r=new Uint8Array(i.data);let a="Unable to parse the tile at ".concat(e.request.url,", ");throw a+=31===r[0]&&139===r[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: ".concat(t.message),new Error(a)}})}loadTile(e){return t._(this,void 0,void 0,function*(){const n=e.uid,r=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.cN(e.request),a=new i(e);this.loading[n]=a;const o=new AbortController;a.abort=o;try{const i=yield this.loadVectorTile(e,o);if(delete this.loading[n],!i)return null;const s=i.rawData,l={};i.expires&&(l.expires=i.expires),i.cacheControl&&(l.cacheControl=i.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}a.vectorTile=i.vectorTile;const u=a.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);this.loaded[n]=a,this.fetching[n]={rawTileData:s,cacheControl:l,resourceTiming:c};try{const e=yield u;return t.e({rawTileData:s.slice(0)},e,l,c)}finally{delete this.fetching[n]}}catch(t){throw delete this.loading[n],a.status="done",this.loaded[n]=a,t}})}reloadTile(e){return t._(this,void 0,void 0,function*(){const n=e.uid;if(!this.loaded||!this.loaded[n])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const i=this.loaded[n];if(i.showCollisionBoxes=e.showCollisionBoxes,i.globalState=e.globalState,"parsing"===i.status){const r=yield i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);let a;if(this.fetching[n]){const{rawTileData:e,cacheControl:i,resourceTiming:o}=this.fetching[n];delete this.fetching[n],a=t.e({rawTileData:e.slice(0)},r,i,o)}else a=r;return a}if("done"===i.status&&i.vectorTile)return i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity)})}abortTile(e){return t._(this,void 0,void 0,function*(){const t=this.loading,n=e.uid;t&&t[n]&&t[n].abort&&(t[n].abort.abort(),delete t[n])})}removeTile(e){return t._(this,void 0,void 0,function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]})}}class o{constructor(){this.loaded={}}loadTile(e){return t._(this,void 0,void 0,function*(){const{uid:n,encoding:i,rawImageData:r,redFactor:a,greenFactor:o,blueFactor:s,baseShift:l}=e,c=r.width+2,u=r.height+2,h=t.b(r)?new t.R({width:c,height:u},yield t.cO(r,-1,-1,c,u)):r,d=new t.cP(n,h,i,a,o,s,l);return this.loaded=this.loaded||{},this.loaded[n]=d,d})}removeTile(t){const e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]}}var s,l,c=function(){if(l)return s;function t(t,n){if(0!==t.length){e(t[0],n);for(var i=1;i<t.length;i++)e(t[i],!n)}}function e(t,e){for(var n=0,i=0,r=0,a=t.length,o=a-1;r<a;o=r++){var s=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]),l=n+s;i+=Math.abs(n)>=Math.abs(s)?n-l+s:s-l+n,n=l}n+i>=0!=!!e&&t.reverse()}return l=1,s=function e(n,i){var r,a=n&&n.type;if("FeatureCollection"===a)for(r=0;r<n.features.length;r++)e(n.features[r],i);else if("GeometryCollection"===a)for(r=0;r<n.geometries.length;r++)e(n.geometries[r],i);else if("Feature"===a)e(n.geometry,i);else if("Polygon"===a)t(n.coordinates,i);else if("MultiPolygon"===a)for(r=0;r<n.coordinates.length;r++)t(n.coordinates[r],i);return n}}(),u=t.cQ(c);class h extends t.cS{constructor(e,n){super(new t.cM,0,n,[],[]),this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},"id"in e&&("string"==typeof e.id?this.id=parseInt(e.id,10):"number"!=typeof e.id||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const i of n){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}class d extends t.cR{constructor(e,n){super(new t.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=n?n.version:1,this.extent=n?n.extent:4096,this.length=e.length,this.features=e}feature(t){return new h(this.features[t],this.extent)}}function p(t,e){e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let a=0;a<t.length;a++)n.feature=t.feature(a),e.writeMessage(2,f,n);const i=n.keys;for(const a of i)e.writeStringField(3,a);const r=n.values;for(const a of r)e.writeMessage(4,_,a)}function f(t,e){if(!t.feature)return;const n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,m,t),e.writeVarintField(3,n.type),e.writeMessage(4,v,n)}function m(t,e){for(const i in null===(n=t.feature)||void 0===n?void 0:n.properties){var n;let r=t.feature.properties[i],a=t.keycache[i];if(null===r)continue;void 0===a&&(t.keys.push(i),a=t.keys.length-1,t.keycache[i]=a),e.writeVarint(a),"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r&&(r=JSON.stringify(r));const o=typeof r+":"+r;let s=t.valuecache[o];void 0===s&&(t.values.push(r),s=t.values.length-1,t.valuecache[o]=s),e.writeVarint(s)}}function g(t,e){return(e<<3)+(7&t)}function y(t){return t<<1^t>>31}function v(t,e){const n=t.loadGeometry(),i=t.type;let r=0,a=0;for(const o of n){let n=1;1===i&&(n=o.length),e.writeVarint(g(1,n));const s=3===i?o.length-1:o.length;for(let t=0;t<s;t++){1===t&&1!==i&&e.writeVarint(g(2,s-1));const n=o[t].x-r,l=o[t].y-a;e.writeVarint(y(n)),e.writeVarint(y(l)),r+=n,a+=l}3===t.type&&e.writeVarint(g(7,1))}}function _(t,e){const n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}const b={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},x=Math.fround||(w=new Float32Array(1),t=>(w[0]=+t,w[0]));var w;class S{constructor(t){this.options=Object.assign(Object.create(b),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:n,maxZoom:i}=this.options;e&&console.time("total time");const r="prepare ".concat(t.length," points");e&&console.time(r),this.points=t;const a=[];for(let s=0;s<t.length;s++){const e=t[s];if(!e.geometry)continue;const[n,i]=e.geometry.coordinates,r=x(A(n)),o=x(E(i));a.push(r,o,1/0,s,-1,1),this.options.reduce&&a.push(0)}let o=this.trees[i+1]=this._createTree(a);e&&console.timeEnd(r);for(let s=i;s>=n;s--){const t=+Date.now();o=this.trees[s]=this._createTree(this._cluster(o,s)),e&&console.log("z%d: %d clusters in %dms",s,o.numItems,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){const t=this.getClusters([n,i,180,a],e),o=this.getClusters([-180,i,r,a],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],s=o.range(A(n),E(a),A(r),E(i)),l=o.data,c=[];for(const u of s){const t=this.stride*u;c.push(l[t+5]>1?M(l,t,this.clusterProps):this.points[l[t+3]])}return c}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const a=r.data;if(e*this.stride>=a.length)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=r.within(a[e*this.stride],a[e*this.stride+1],o),l=[];for(const c of s){const e=c*this.stride;a[e+4]===t&&l.push(a[e+5]>1?M(a,e,this.clusterProps):this.points[a[e+3]])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,n){const i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i}getTile(t,e,n){const i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:a,radius:o}=this.options,s=o/a,l=(n-s)/r,c=(n+1+s)/r,u={features:[]};return this._addTileFeatures(i.range((e-s)/r,l,(e+1+s)/r,c),i.data,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-s/r,l,1,c),i.data,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,l,s/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,i,r){const a=this.getChildren(e);for(const o of a){const e=o.properties;if(e&&e.cluster?r+e.point_count<=i?r+=e.point_count:r=this._appendLeaves(t,e.cluster_id,n,i,r):r<i?r++:t.push(o),t.length===n)break}return r}_createTree(e){const n=new t.aI(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)n.add(e[t],e[t+1]);return n.finish(),n.data=e,n}_addTileFeatures(t,e,n,i,r,a){for(const o of t){const t=o*this.stride,s=e[t+5]>1;let l,c,u;if(s)l=T(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const n=this.points[e[t+3]];l=n.properties;const[i,r]=n.geometry.coordinates;c=A(i),u=E(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=s||this.options.generateId?e[t+3]:this.points[e[t+3]].id,void 0!==d&&(h.id=d),a.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:n,extent:i,reduce:r,minPoints:a}=this.options,o=n/(i*Math.pow(2,e)),s=t.data,l=[],c=this.stride;for(let u=0;u<s.length;u+=c){if(s[u+2]<=e)continue;s[u+2]=e;const n=s[u],i=s[u+1],h=t.within(s[u],s[u+1],o),d=s[u+5];let p=d;for(const t of h){const n=t*c;s[n+2]>e&&(p+=s[n+5])}if(p>d&&p>=a){let t,a=n*d,o=i*d,f=-1;const m=(u/c<<5)+(e+1)+this.points.length;for(const n of h){const i=n*c;if(s[i+2]<=e)continue;s[i+2]=e;const l=s[i+5];a+=s[i]*l,o+=s[i+1]*l,s[i+4]=m,r&&(t||(t=this._map(s,u,!0),f=this.clusterProps.length,this.clusterProps.push(t)),r(t,this._map(s,i)))}s[u+4]=m,l.push(a/p,o/p,1/0,m,-1,p),r&&l.push(f)}else{for(let t=0;t<c;t++)l.push(s[u+t]);if(p>1)for(const t of h){const n=t*c;if(!(s[n+2]<=e)){s[n+2]=e;for(let t=0;t<c;t++)l.push(s[n+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,n){if(t[e+5]>1){const i=this.clusterProps[t[e+6]];return n?Object.assign({},i):i}const i=this.points[t[e+3]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function M(t,e,n){return{type:"Feature",id:t[e+3],properties:T(t,e,n),geometry:{type:"Point",coordinates:[(i=t[e],360*(i-.5)),C(t[e+1])]}};var i}function T(t,e,n){const i=t[e+5],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,a=t[e+6],o=-1===a?{}:Object.assign({},n[a]);return Object.assign(o,{cluster:!0,cluster_id:t[e+3],point_count:i,point_count_abbreviated:r})}function A(t){return t/360+.5}function E(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function C(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function P(t,e,n,i){let r=i;const a=e+(n-e>>1);let o,s=n-e;const l=t[e],c=t[e+1],u=t[n],h=t[n+1];for(let d=e+3;d<n;d+=3){const e=I(t[d],t[d+1],l,c,u,h);if(e>r)o=d,r=e;else if(e===r){const t=Math.abs(d-a);t<s&&(o=d,s=t)}}r>i&&(o-e>3&&P(t,e,o,i),t[o+2]=r,n-o>3&&P(t,o,n,i))}function I(t,e,n,i,r,a){let o=r-n,s=a-i;if(0!==o||0!==s){const l=((t-n)*o+(e-i)*s)/(o*o+s*s);l>1?(n=r,i=a):l>0&&(n+=o*l,i+=s*l)}return o=t-n,s=e-i,o*o+s*s}function L(t,e,n,i){const r={id:null==t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)k(r,n);else if("Polygon"===e)k(r,n[0]);else if("MultiLineString"===e)for(const a of n)k(r,a);else if("MultiPolygon"===e)for(const a of n)k(r,a[0]);return r}function k(t,e){for(let n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function R(t,e,n,i){if(!e.geometry)return;const r=e.geometry.coordinates;if(r&&0===r.length)return;const a=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let s=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===a)D(r,s);else if("MultiPoint"===a)for(const c of r)D(c,s);else if("LineString"===a)N(r,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(const n of r)s=[],N(n,s,o,!1),t.push(L(l,"LineString",s,e.properties));return}z(r,s,o,!1)}else if("Polygon"===a)z(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(const r of e.geometry.geometries)R(t,{id:l,geometry:r,properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of r){const e=[];z(t,e,o,!0),s.push(e)}}t.push(L(l,a,s,e.properties))}function D(t,e){e.push(F(t[0]),O(t[1]),0)}function N(t,e,n,i){let r,a,o=0;for(let l=0;l<t.length;l++){const n=F(t[l][0]),s=O(t[l][1]);e.push(n,s,0),l>0&&(o+=i?(r*s-n*a)/2:Math.sqrt(Math.pow(n-r,2)+Math.pow(s-a,2))),r=n,a=s}const s=e.length-3;e[2]=1,P(e,0,s,n),e[s+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function z(t,e,n,i){for(let r=0;r<t.length;r++){const a=[];N(t[r],a,n,i),e.push(a)}}function F(t){return t/360+.5}function O(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function B(t,e,n,i,r,a,o,s){if(i/=e,a>=(n/=e)&&o<i)return t;if(o<n||a>=i)return null;const l=[];for(const c of t){const t=c.geometry;let e=c.type;const a=0===r?c.minX:c.minY,o=0===r?c.maxX:c.maxY;if(a>=n&&o<i){l.push(c);continue}if(o<n||a>=i)continue;let u=[];if("Point"===e||"MultiPoint"===e)U(t,u,n,i,r);else if("LineString"===e)j(t,u,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===e)H(t,u,n,i,r,!1);else if("Polygon"===e)H(t,u,n,i,r,!0);else if("MultiPolygon"===e)for(const s of t){const t=[];H(s,t,n,i,r,!0),t.length&&u.push(t)}if(u.length){if(s.lineMetrics&&"LineString"===e){for(const t of u)l.push(L(c.id,e,t,c.tags));continue}"LineString"!==e&&"MultiLineString"!==e||(1===u.length?(e="LineString",u=u[0]):e="MultiLineString"),"Point"!==e&&"MultiPoint"!==e||(e=3===u.length?"Point":"MultiPoint"),l.push(L(c.id,e,u,c.tags))}}return l.length?l:null}function U(t,e,n,i,r){for(let a=0;a<t.length;a+=3){const o=t[a+r];o>=n&&o<=i&&G(e,t[a],t[a+1],t[a+2])}}function j(t,e,n,i,r,a,o){let s=V(t);const l=0===r?W:q;let c,u,h=t.start;for(let g=0;g<t.length-3;g+=3){const d=t[g],p=t[g+1],f=t[g+2],m=t[g+3],y=t[g+4],v=0===r?d:p,_=0===r?m:y;let b=!1;o&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(p-y,2))),v<n?_>n&&(u=l(s,d,p,m,y,n),o&&(s.start=h+c*u)):v>i?_<i&&(u=l(s,d,p,m,y,i),o&&(s.start=h+c*u)):G(s,d,p,f),_<n&&v>=n&&(u=l(s,d,p,m,y,n),b=!0),_>i&&v<=i&&(u=l(s,d,p,m,y,i),b=!0),!a&&b&&(o&&(s.end=h+c*u),e.push(s),s=V(t)),o&&(h+=c)}let d=t.length-3;const p=t[d],f=t[d+1],m=0===r?p:f;m>=n&&m<=i&&G(s,p,f,t[d+2]),d=s.length-3,a&&d>=3&&(s[d]!==s[0]||s[d+1]!==s[1])&&G(s,s[0],s[1],s[2]),s.length&&e.push(s)}function V(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function H(t,e,n,i,r,a){for(const o of t)j(o,e,n,i,r,a,!1)}function G(t,e,n,i){t.push(e,n,i)}function W(t,e,n,i,r,a){const o=(a-e)/(i-e);return G(t,a,n+(r-n)*o,1),o}function q(t,e,n,i,r,a){const o=(a-n)/(r-n);return G(t,e+(i-e)*o,a,1),o}function Z(t,e){const n=[];for(let i=0;i<t.length;i++){const r=t[i],a=r.type;let o;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=X(r.geometry,e);else if("MultiLineString"===a||"Polygon"===a){o=[];for(const t of r.geometry)o.push(X(t,e))}else if("MultiPolygon"===a){o=[];for(const t of r.geometry){const n=[];for(const i of t)n.push(X(i,e));o.push(n)}}n.push(L(r.id,a,o,r.tags))}return n}function X(t,e){const n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(let i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function Y(t,e){if(t.transformed)return t;const n=1<<t.z,i=t.x,r=t.y;for(const a of t.features){const t=a.geometry,o=a.type;if(a.geometry=[],1===o)for(let s=0;s<t.length;s+=2)a.geometry.push(K(t[s],t[s+1],e,n,i,r));else for(let s=0;s<t.length;s++){const o=[];for(let a=0;a<t[s].length;a+=2)o.push(K(t[s][a],t[s][a+1],e,n,i,r));a.geometry.push(o)}}return t.transformed=!0,t}function K(t,e,n,i,r,a){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-a))]}function J(t,e,n,i,r){const a=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const s of t)$(o,s,a,r);return o}function $(t,e,n,i){const r=e.geometry,a=e.type,o=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===a||"MultiPoint"===a)for(let s=0;s<r.length;s+=3)o.push(r[s],r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)Q(o,r,t,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(let s=0;s<r.length;s++)Q(o,r[s],t,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(let s=0;s<r.length;s++){const e=r[s];for(let i=0;i<e.length;i++)Q(o,e[i],t,n,!0,0===i)}if(o.length){let n=e.tags||null;if("LineString"===a&&i.lineMetrics){n={};for(const t in e.tags)n[t]=e.tags[t];n.mapbox_clip_start=r.start/r.size,n.mapbox_clip_end=r.end/r.size}const s={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:n};null!==e.id&&(s.id=e.id),t.features.push(s)}}function Q(t,e,n,i,r,a){const o=i*i;if(i>0&&e.size<(r?o:i))return void(n.numPoints+=e.length/3);const s=[];for(let l=0;l<e.length;l+=3)(0===i||e[l+2]>o)&&(n.numSimplified++,s.push(e[l],e[l+1])),n.numPoints++;r&&function(t,e){let n=0;for(let i=0,r=t.length,a=r-2;i<r;a=i,i+=2)n+=(t[i]-t[a])*(t[i+1]+t[a+1]);if(n>0===e)for(let i=0,r=t.length;i<r/2;i+=2){const e=t[i],n=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=e,t[r-1-i]=n}}(s,a),t.push(s)}const tt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class et{constructor(t,e){const n=(e=this.options=function(t,e){for(const n in e)t[n]=e[n];return t}(Object.create(tt),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(t,e){const n=[];if("FeatureCollection"===t.type)for(let i=0;i<t.features.length;i++)R(n,t.features[i],e,i);else R(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){const n=e.buffer/e.extent;let i=t;const r=B(t,1,-1-n,n,0,-1,2,e),a=B(t,1,1-n,2+n,0,-1,2,e);return(r||a)&&(i=B(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=Z(r,1).concat(i)),a&&(i=i.concat(Z(a,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,n,i,r,a,o){const s=[t,e,n,i],l=this.options,c=l.debug;for(;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();const u=1<<e,h=nt(e,n,i);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=J(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t="z".concat(e);this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==r){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===r)continue;if(null!=r){const t=r-e;if(n!==a>>t||i!==o>>t)continue}}if(d.source=null,0===t.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let y=null,v=null,_=null,b=null,x=B(t,u,n-p,n+m,0,d.minX,d.maxX,l),w=B(t,u,n+f,n+g,0,d.minX,d.maxX,l);t=null,x&&(y=B(x,u,i-p,i+m,1,d.minY,d.maxY,l),v=B(x,u,i+f,i+g,1,d.minY,d.maxY,l),x=null),w&&(_=B(w,u,i-p,i+m,1,d.minY,d.maxY,l),b=B(w,u,i+f,i+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*n,2*i),s.push(v||[],e+1,2*n,2*i+1),s.push(_||[],e+1,2*n+1,2*i),s.push(b||[],e+1,2*n+1,2*i+1)}}getTile(t,e,n){t=+t,e=+e,n=+n;const i=this.options,{extent:r,debug:a}=i;if(t<0||t>24)return null;const o=1<<t,s=nt(t,e=e+o&o-1,n);if(this.tiles[s])return Y(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",t,e,n);let l,c=t,u=e,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[nt(c,u,h)];return l&&l.source?(a>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,t,e,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?Y(this.tiles[s],r):null):null}}function nt(t,e,n){return 32*((1<<t)*n+e)+t}class it extends a{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,n){return t._(this,void 0,void 0,function*(){const n=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return null;const r=new d(i.features,{version:2,extent:t.$});let a=function(e){const n=new t.cM;return function(t,e){for(const n in t.layers)e.writeMessage(3,p,t.layers[n])}(e,n),n.finish()}(r);return 0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),{vectorTile:r,rawData:a.buffer}})}loadData(e){return t._(this,void 0,void 0,function*(){var n;null===(n=this._pendingRequest)||void 0===n||n.abort();const i=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.cN(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest);const n=yield this._pendingData;this._geoJSONIndex=e.cluster?new S(function(e){let{superclusterOptions:n,clusterProperties:i}=e;if(!i||!n)return n;const r={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(i);for(const c of l){const[e,n]=i[c],o=t.cT(n),s=t.cT("string"==typeof e?[e,["accumulated"],["get",c]]:e);r[c]=o.value,a[c]=s.value}return n.map=t=>{s.properties=t;const e={};for(const n of l)e[n]=r[n].evaluate(o,s);return e},n.reduce=(t,e)=>{s.properties=e;for(const n of l)o.accumulated=t[n],t[n]=a[n].evaluate(o,s)},n}(e)).load(n.features):function(t,e){return new et(t,e)}(n,e.geojsonVtOptions),this.loaded={};const r={data:n};if(i){const t=i.finish();t&&(r.resourceTiming={},r.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}return r}catch(e){if(delete this._pendingRequest,t.cy(e))return{abandoned:!0};throw e}})}getData(){return t._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(t){const e=this.loaded;return e&&e[t.uid]?super.reloadTile(t):this.loadTile(t)}loadAndProcessGeoJSON(e,n){return t._(this,void 0,void 0,function*(){let i=yield this.loadGeoJSON(e,n);if(delete this._pendingRequest,"object"!=typeof i)throw new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object."));if(u(i,!0),e.filter){const n=t.cT(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(t=>"".concat(t.key,": ").concat(t.message)).join(", "));const r=i.features.filter(t=>n.value.evaluate({zoom:0},t));i={type:"FeatureCollection",features:r}}return i})}loadGeoJSON(e,n){return t._(this,void 0,void 0,function*(){const{promoteId:i}=e;if(e.request){const r=yield t.j(e.request,n);return this._dataUpdateable=t.cV(r.data,i)?t.cU(r.data,i):void 0,r.data}if("string"==typeof e.data)try{const n=JSON.parse(e.data);return this._dataUpdateable=t.cV(n,i)?t.cU(n,i):void 0,n}catch(t){throw new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object."))}if(!e.dataDiff)throw new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object."));if(!this._dataUpdateable)throw new Error("Cannot update existing geojson data in ".concat(e.source));return t.cW(this._dataUpdateable,e.dataDiff,i),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(e){return t._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(t){return this._geoJSONIndex.getClusterExpansionZoom(t.clusterId)}getClusterChildren(t){return this._geoJSONIndex.getChildren(t.clusterId)}getClusterLeaves(t){return this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset)}}class rt{constructor(e){this.self=e,this.actor=new t.J(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(t,e)=>{if(this.externalWorkerSourceTypes[t])throw new Error('Worker source with name "'.concat(t,'" already registered.'));this.externalWorkerSourceTypes[t]=e},this.self.addProtocol=t.cA,this.self.removeProtocol=t.cB,this.self.registerRTLTextPlugin=e=>{t.cX.setMethods(e)},this.actor.registerMessageHandler("LDT",(t,e)=>this._getDEMWorkerSource(t,e.source).loadTile(e)),this.actor.registerMessageHandler("RDT",(e,n)=>t._(this,void 0,void 0,function*(){this._getDEMWorkerSource(e,n.source).removeTile(n)})),this.actor.registerMessageHandler("GCEZ",(e,n)=>t._(this,void 0,void 0,function*(){return this._getWorkerSource(e,n.type,n.source).getClusterExpansionZoom(n)})),this.actor.registerMessageHandler("GCC",(e,n)=>t._(this,void 0,void 0,function*(){return this._getWorkerSource(e,n.type,n.source).getClusterChildren(n)})),this.actor.registerMessageHandler("GCL",(e,n)=>t._(this,void 0,void 0,function*(){return this._getWorkerSource(e,n.type,n.source).getClusterLeaves(n)})),this.actor.registerMessageHandler("LD",(t,e)=>this._getWorkerSource(t,e.type,e.source).loadData(e)),this.actor.registerMessageHandler("GD",(t,e)=>this._getWorkerSource(t,e.type,e.source).getData()),this.actor.registerMessageHandler("LT",(t,e)=>this._getWorkerSource(t,e.type,e.source).loadTile(e)),this.actor.registerMessageHandler("RT",(t,e)=>this._getWorkerSource(t,e.type,e.source).reloadTile(e)),this.actor.registerMessageHandler("AT",(t,e)=>this._getWorkerSource(t,e.type,e.source).abortTile(e)),this.actor.registerMessageHandler("RMT",(t,e)=>this._getWorkerSource(t,e.type,e.source).removeTile(e)),this.actor.registerMessageHandler("RS",(e,n)=>t._(this,void 0,void 0,function*(){if(!this.workerSources[e]||!this.workerSources[e][n.type]||!this.workerSources[e][n.type][n.source])return;const t=this.workerSources[e][n.type][n.source];delete this.workerSources[e][n.type][n.source],void 0!==t.removeSource&&t.removeSource(n)})),this.actor.registerMessageHandler("RM",e=>t._(this,void 0,void 0,function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})),this.actor.registerMessageHandler("SR",(e,n)=>t._(this,void 0,void 0,function*(){this.referrer=n})),this.actor.registerMessageHandler("SRPS",(t,e)=>this._syncRTLPluginState(t,e)),this.actor.registerMessageHandler("IS",(e,n)=>t._(this,void 0,void 0,function*(){this.self.importScripts(n)})),this.actor.registerMessageHandler("SI",(t,e)=>this._setImages(t,e)),this.actor.registerMessageHandler("UL",(e,n)=>t._(this,void 0,void 0,function*(){this._getLayerIndex(e).update(n.layers,n.removedIds)})),this.actor.registerMessageHandler("SL",(e,n)=>t._(this,void 0,void 0,function*(){this._getLayerIndex(e).replace(n)}))}_setImages(e,n){return t._(this,void 0,void 0,function*(){this.availableImages[e]=n;for(const t in this.workerSources[e]){const i=this.workerSources[e][t];for(const t in i)i[t].availableImages=n}})}_syncRTLPluginState(e,n){return t._(this,void 0,void 0,function*(){return yield t.cX.syncState(n,this.self.importScripts)})}_getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}_getLayerIndex(t){let n=this.layerIndexes[t];return n||(n=this.layerIndexes[t]=new e),n}_getWorkerSource(t,e,n){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){const i={sendAsync:(e,n)=>(e.targetMapId=t,this.actor.sendAsync(e,n))};switch(e){case"vector":this.workerSources[t][e][n]=new a(i,this._getLayerIndex(t),this._getAvailableImages(t));break;case"geojson":this.workerSources[t][e][n]=new it(i,this._getLayerIndex(t),this._getAvailableImages(t));break;default:this.workerSources[t][e][n]=new this.externalWorkerSourceTypes[e](i,this._getLayerIndex(t),this._getAvailableImages(t))}}return this.workerSources[t][e][n]}_getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new o),this.demWorkerSources[t][e]}}return t.i(self)&&(self.worker=new rt(self)),rt}),n("index",["exports","./shared"],function(t,e){var n="5.6.2";function i(){var t=new e.A(4);return e.A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}let r,a;const o={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(t,n,i){const r=requestAnimationFrame(t=>{a(),n(t)}),{unsubscribe:a}=e.s(t.signal,"abort",()=>{a(),cancelAnimationFrame(r),i(e.c())},!1)},frameAsync(t){return new Promise((e,n)=>{this.frame(t,e,n)})},getImageData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height),n},resolveURL:t=>(r||(r=document.createElement("a")),r.href=t,r.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==a&&(a=matchMedia("(prefers-reduced-motion: reduce)")),a.matches)}};class s{static testProp(t){if(!s.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in s.docStyle)return t[e];return t[0]}static create(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){s.docStyle&&s.selectProp&&(s.userSelect=s.docStyle[s.selectProp],s.docStyle[s.selectProp]="none")}static enableDrag(){s.docStyle&&s.selectProp&&(s.docStyle[s.selectProp]=s.userSelect)}static setTransform(t,e){t.style[s.transformProp]=e}static addEventListener(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.addEventListener(e,n,"passive"in i?i:i.capture)}static removeEventListener(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.removeEventListener(e,n,"passive"in i?i:i.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",s.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",s.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",s.suppressClickInternal,!0)},0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,n,i){const r=n.boundingClientRect;return new e.P((i.clientX-r.left)/n.x-t.clientLeft,(i.clientY-r.top)/n.y-t.clientTop)}static mousePos(t,e){const n=s.getScale(t);return s.getPoint(t,n,e)}static touchPos(t,e){const n=[],i=s.getScale(t);for(let r=0;r<e.length;r++)n.push(s.getPoint(t,i,e[r]));return n}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const e=(new DOMParser).parseFromString(t,"text/html").body||document.createElement("body"),n=e.querySelectorAll("script");for(const i of n)i.remove();return s.clean(e),e.innerHTML}static isPossiblyDangerous(t,e){const n=e.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!n.includes("javascript:")&&!n.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const e=t.children;for(const n of e)s.removeAttributes(n),s.clean(n)}static removeAttributes(t){for(const{name:e,value:n}of t.attributes)s.isPossiblyDangerous(e,n)&&t.removeAttribute(e)}}s.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,s.selectProp=s.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),s.transformProp=s.testProp(["transform","WebkitTransform"]);const l={supported:!1,testSupport:function(t){!h&&u&&(d?p(t):c=t)}};let c,u,h=!1,d=!1;function p(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,u),t.isContextLost())return;l.supported=!0}catch(t){}t.deleteTexture(e),h=!0}var f;"undefined"!=typeof document&&(u=document.createElement("img"),u.onload=()=>{c&&p(c),c=null,d=!0},u.onerror=()=>{h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(t){let n,i,r,a;t.resetRequestQueue=()=>{n=[],i=0,r=0,a={}},t.addThrottleControl=t=>{const e=r++;return a[e]=t,e},t.removeThrottleControl=t=>{delete a[t],s()},t.getImage=function(t,i){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((a,o)=>{l.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),e.e(t,{type:"image"}),n.push({abortController:i,requestParameters:t,supportImageRefresh:r,state:"queued",onError:t=>{o(t)},onSuccess:t=>{a(t)}}),s()})};const o=t=>e._(this,void 0,void 0,function*(){t.state="running";const{requestParameters:n,supportImageRefresh:r,onError:a,onSuccess:o,abortController:l}=t,u=!1===r&&!e.i(self)&&!e.g(n.url)&&(!n.headers||Object.keys(n.headers).reduce((t,e)=>t&&"accept"===e,!0));i++;const h=u?c(n,l):e.m(n,l);try{const n=yield h;delete t.abortController,t.state="completed",n.data instanceof HTMLImageElement||e.b(n.data)?o(n):n.data&&o({data:yield(d=n.data,"function"==typeof createImageBitmap?e.f(d):e.h(d)),cacheControl:n.cacheControl,expires:n.expires})}catch(e){delete t.abortController,a(e)}finally{i--,s()}var d}),s=()=>{const t=(()=>{for(const t of Object.keys(a))if(a[t]())return!0;return!1})()?e.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=i;e<t&&n.length>0;e++){const t=n.shift();t.abortController.signal.aborted?e--:o(t)}},c=(t,n)=>new Promise((i,r)=>{const a=new Image,o=t.url,s=t.credentials;s&&"include"===s?a.crossOrigin="use-credentials":(s&&"same-origin"===s||!e.d(o))&&(a.crossOrigin="anonymous"),n.signal.addEventListener("abort",()=>{a.src="",r(e.c())}),a.fetchPriority="high",a.onload=()=>{a.onerror=a.onload=null,i({data:a})},a.onerror=()=>{a.onerror=a.onload=null,n.signal.aborted||r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},a.src=o})}(f||(f={})),f.resetRequestQueue();class m{constructor(t){this._transformRequestFn=null!=t?t:null}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function g(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const n=[];for(const{id:i,url:r}of t){const t="".concat(i).concat(r);-1===n.indexOf(t)&&(n.push(t),e.push({id:i,url:r}))}}return e}function y(t,e,n){try{const i=new URL(t);return i.pathname+="".concat(e).concat(n),i.toString()}catch(e){throw new Error('Invalid sprite URL "'.concat(t,'", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically'))}}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class _ extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,promiseResolve:e}of this.requestors)e(this._getImagesForIds(t));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const t=n.spriteData;n.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),n.spriteData=null}return n}addImage(t,e){if(this.images[t])throw new Error("Image id ".concat(t," already exist, use updateImage instead"));this._validate(t,e)&&(this.images[t]=e)}_validate(t,n){let i=!0;const r=n.data||n.spriteData;return this._validateStretch(n.stretchX,r&&r.width)||(this.fire(new e.k(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),i=!1),this._validateStretch(n.stretchY,r&&r.height)||(this.fire(new e.k(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.k(new Error('Image "'.concat(t,'" has invalid "content" value')))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let n=0;for(const i of t){if(i[0]<n||i[1]<i[0]||e<i[1])return!1;n=i[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const n=e.spriteData,i=n&&n.width||e.data.width,r=n&&n.height||e.data.height;return!(t[0]<0||i<t[0]||t[1]<0||r<t[1]||t[2]<0||i<t[2]||t[3]<0||r<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.getImage(t);if(n&&(i.data.width!==e.data.width||i.data.height!==e.data.height))throw new Error("size mismatch between old image (".concat(i.data.width,"x").concat(i.data.height,") and new image (").concat(e.data.width,"x").concat(e.data.height,")."));e.version=i.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((e,n)=>{let i=!0;if(!this.isLoaded())for(const r of t)this.images[r]||(i=!1);this.isLoaded()||i?e(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:e})})}_getImagesForIds(t){const n={};for(const i of t){let t=this.getImage(i);t||(this.fire(new e.l("styleimagemissing",{id:i})),t=this.getImage(i)),t?n[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,textFitWidth:t.textFitWidth,textFitHeight:t.textFitHeight,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w('Image "'.concat(i,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}return n}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(t){const n=this.patterns[t],i=this.getImage(t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new e.I(n,i);this.patterns[t]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:n,h:i}=e.p(t),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const a in this.patterns){const{bin:t}=this.patterns[a],n=t.x+1,i=t.y+1,o=this.getImage(a).data,s=o.width,l=o.height;e.R.copy(o,r,{x:0,y:0},{x:n,y:i},{width:s,height:l}),e.R.copy(o,r,{x:0,y:l-1},{x:n,y:i-1},{width:s,height:1}),e.R.copy(o,r,{x:0,y:0},{x:n,y:i+l},{width:s,height:1}),e.R.copy(o,r,{x:s-1,y:0},{x:n-1,y:i},{width:1,height:l}),e.R.copy(o,r,{x:0,y:0},{x:n+s,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const t=this.getImage(n);t||e.w('Image with ID: "'.concat(n,'" was not found')),v(t)&&this.updateImage(n,t)}}}const b=1e20;function x(t,e,n,i,r,a,o,s,l){for(let c=e;c<e+i;c++)w(t,n*a+c,a,r,o,s,l);for(let c=n;c<n+r;c++)w(t,c*a+e,1,i,o,s,l)}function w(t,e,n,i,r,a,o){a[0]=0,o[0]=-b,o[1]=b,r[0]=t[e];for(let s=1,l=0,c=0;s<i;s++){r[s]=t[e+s*n];const i=s*s;do{const t=a[l];c=(r[s]-r[t]+i-t*t)/(s-t)/2}while(c<=o[l]&&--l>-1);l++,a[l]=s,o[l]=c,o[l+1]=b}for(let s=0,l=0;s<i;s++){for(;o[l+1]<s;)l++;const i=a[l],c=s-i;t[e+s*n]=r[i]+c*c}}class S{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return e._(this,void 0,void 0,function*(){const e=[];for(const r in t)for(const n of t[r])e.push(this._getAndCacheGlyphsPromise(r,n));const n=yield Promise.all(e),i={};for(const{stack:t,id:r,glyph:a}of n)i[t]||(i[t]={}),i[t][r]=a&&{id:a.id,bitmap:a.bitmap.clone(),metrics:a.metrics};return i})}_getAndCacheGlyphsPromise(t,n){return e._(this,void 0,void 0,function*(){let e=this.entries[t];e||(e=this.entries[t]={glyphs:{},requests:{},ranges:{}});let i=e.glyphs[n];if(void 0!==i)return{stack:t,id:n,glyph:i};if(i=this._tinySDF(e,t,n),i)return e.glyphs[n]=i,{stack:t,id:n,glyph:i};const r=Math.floor(n/256);if(256*r>65535)throw new Error("glyphs > 65535 not supported");if(e.ranges[r])return{stack:t,id:n,glyph:i};if(!this.url)throw new Error("glyphsUrl is not set");if(!e.requests[r]){const n=S.loadGlyphRange(t,r,this.url,this.requestManager);e.requests[r]=n}const a=yield e.requests[r];for(const t in a)this._doesCharSupportLocalGlyph(+t)||(e.glyphs[+t]=a[+t]);return e.ranges[r]=!0,{stack:t,id:n,glyph:a[n]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(/(?:[\u3006\u3007\u3021-\u3029\u3038-\u303A\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFA6D\uFA70-\uFAD9]|\uD81B[\uDFE4\uDFF2-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82C[\uDD70-\uDEFB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79])|[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|(?:[\u3041-\u3096\u309D-\u309F]|\uD82C[\uDC01-\uDD1F\uDD32\uDD50-\uDD52]|\uD83C\uDE00)|(?:[\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u32D0-\u32FE\u3300-\u3357\uFF66-\uFF6F\uFF71-\uFF9D]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00\uDD20-\uDD22\uDD55\uDD64-\uDD67])/.test(String.fromCodePoint(t))||e.u["CJK Unified Ideographs"](t)||e.u["Hangul Syllables"](t)||e.u.Hiragana(t)||e.u.Katakana(t)||e.u["CJK Symbols and Punctuation"](t)||e.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,n,i){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(i))return;let a=t.tinySDF;if(!a){let e="400";/bold/i.test(n)?e="900":/medium/i.test(n)?e="500":/light/i.test(n)&&(e="200"),a=t.tinySDF=new S.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:r,fontWeight:e})}const o=a.draw(String.fromCharCode(i));return{id:i,bitmap:new e.q({width:o.width||60,height:o.height||60},o.data),metrics:{width:o.glyphWidth/2||24,height:o.glyphHeight/2||24,left:o.glyphLeft/2+.5||0,top:o.glyphTop/2-27.5||-8,advance:o.glyphAdvance/2||24,isDoubleResolution:!0}}}}S.loadGlyphRange=function(t,n,i,r){return e._(this,void 0,void 0,function*(){const a=256*n,o=a+255,s=r.transformRequest(i.replace("{fontstack}",t).replace("{range}","".concat(a,"-").concat(o)),"Glyphs"),l=yield e.n(s,new AbortController);if(!l||!l.data)throw new Error("Could not load glyph range. range: ".concat(n,", ").concat(a,"-").concat(o));const c={};for(const t of e.o(l.data))c[t.id]=t;return c})},S.TinySDF=class{constructor(){let{fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:a="normal",fontStyle:o="normal",lang:s=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=e,this.cutoff=i,this.radius=n,this.lang=s;const l=this.size=t+4*e,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font="".concat(o," ").concat(a," ").concat(t,"px ").concat(r),u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:a}=this.ctx.measureText(t),o=Math.ceil(n),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(i)),c=s+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:e};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;this.lang&&(f.lang=this.lang),f.clearRect(m,m,s,l),f.fillText(t,m,m+o);const v=f.getImageData(m,m,s,l);y.fill(b,0,h),g.fill(0,0,h);for(let _=0;_<l;_++)for(let t=0;t<s;t++){const e=v.data[4*(_*s+t)+3]/255;if(0===e)continue;const n=(_+m)*c+t+m;if(1===e)y[n]=0,g[n]=b;else{const t=.5-e;y[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}x(y,0,0,c,u,c,this.f,this.v,this.z),x(g,m,m,s,l,c,this.f,this.v,this.z);for(let _=0;_<h;_++){const t=Math.sqrt(y[_])-Math.sqrt(g[_]);d[_]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class M{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,n){return e.B(t.expression.evaluate(n))}interpolate(t,n,i){return{x:e.C.number(t.x,n.x,i),y:e.C.number(t.y,n.y,i),z:e.C.number(t.z,n.z,i)}}}let T;class A extends e.E{constructor(t){super(),T=T||new e.r({anchor:new e.D(e.v.light.anchor),position:new M,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.t(T),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.x,t,n))for(const e in t){const n=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),n):this._transitionable.setValue(e,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.y(this,t.call(e.z,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.v}))}}const E=new e.r({"sky-color":new e.D(e.v.sky["sky-color"]),"horizon-color":new e.D(e.v.sky["horizon-color"]),"fog-color":new e.D(e.v.sky["fog-color"]),"fog-ground-blend":new e.D(e.v.sky["fog-ground-blend"]),"horizon-fog-blend":new e.D(e.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new e.D(e.v.sky["sky-horizon-blend"]),"atmosphere-blend":new e.D(e.v.sky["atmosphere-blend"])});class C extends e.E{constructor(t){super(),this._transitionable=new e.t(E),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.F(0))}setSky(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.G,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const e in t){const n=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),n):this._transitionable.setValue(e,n)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!1!==(null==i?void 0:i.validate)&&e.y(this,t.call(e.z,e.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class P{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]}getDashRanges(t,e,n){const i=[];let r=t.length%2==1?-t[t.length-1]*n:0,a=t[0]*n,o=!0;i.push({left:r,right:a,isDash:o,zeroLength:0===t[0]});let s=t[0];for(let l=1;l<t.length;l++){o=!o;const e=t[l];r=s*n,s+=e,a=s*n,i.push({left:r,right:a,isDash:o,zeroLength:0===e})}return i}addRoundDash(t,e,n){const i=e/2;for(let r=-n;r<=n;r++){const e=this.width*(this.nextRow+n+r);let a=0,o=t[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=t[++a]);const l=Math.abs(s-o.left),c=Math.abs(s-o.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(o.isDash){const t=i-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=i-Math.sqrt(u*u+d*d);this.data[e+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let o=t.length-1;o>=0;--o){const e=t[o],n=t[o+1];e.zeroLength?t.splice(o,1):n&&n.isDash===e.isDash&&(n.left=e.left,t.splice(o,1))}const e=t[0],n=t[t.length-1];e.isDash===n.isDash&&(e.left=n.left-this.width,n.right=e.right+this.width);const i=this.width*this.nextRow;let r=0,a=t[r];for(let o=0;o<this.width;o++){o/a.right>1&&(a=t[++r]);const e=Math.abs(o-a.left),n=Math.abs(o-a.right),s=Math.min(e,n);this.data[i+o]=Math.max(0,Math.min(255,(a.isDash?s:-s)+128))}}addDash(t,n){const i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return e.w("LineAtlas out of space"),null;let a=0;for(let e=0;e<t.length;e++)a+=t[e];if(0!==a){const e=this.width/a,r=this.getDashRanges(t,this.width,e);n?this.addRoundDash(r,e,i):this.addRegularDash(r)}const o={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:a};return this.nextRow+=r,this.dirty=!0,o}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}const I="maplibre_preloaded_worker_pool";class L{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<L.workerCount;)this.workers.push(new Worker(e.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[I]}numActive(){return Object.keys(this.active).length}}const k=Math.floor(o.hardwareConcurrency/2);let R,D;function N(){return R||(R=new L),R}L.workerCount=e.H(globalThis)?Math.max(Math.min(k,3),1):1;class z{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const i=this.workerPool.acquire(n);for(let r=0;r<i.length;r++){const t=new e.J(i[r],n);t.name="Worker ".concat(r),this.actors.push(t)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,e){const n=[];for(const i of this.actors)n.push(i.sendAsync({type:t,data:e}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.actors.forEach(t=>{t.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,e){for(const n of this.actors)n.registerMessageHandler(t,e)}}function F(){return D||(D=new z(N(),e.K),D.registerMessageHandler("GR",(t,n,i)=>e.m(n,i))),D}function O(t,n){const i=e.L();return e.M(i,i,[1,1,0]),e.N(i,i,[.5*t.width,.5*t.height,1]),t.calculatePosMatrix?e.O(i,i,t.calculatePosMatrix(n.toUnwrapped())):i}function B(t,e,n,i,r,a,o){var s;const l=function(t,e,n){if(t)for(const i of t){const t=e[i];if(t&&t.source===n&&"fill-extrusion"===t.type)return!0}else for(const i in e){const t=e[i];if(t.source===n&&"fill-extrusion"===t.type)return!0}return!1}(null!==(s=null==r?void 0:r.layers)&&void 0!==s?s:null,e,t.id),c=a.maxPitchScaleFactor(),u=t.tilesIn(i,c,l);u.sort(U);const h=[];for(const d of u)h.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(e,n,t._state,d.queryGeometry,d.cameraQueryGeometry,d.scale,r,a,c,O(t.transform,d.tileID),o?(t,e)=>o(d.tileID,t,e):void 0)});return function(t,e){for(const n in t)for(const i of t[n])j(i,e);return t}(function(t){const e={},n={};for(const i of t){const t=i.queryResults,r=i.wrappedTileID,a=n[r]=n[r]||{};for(const n in t){const i=t[n],r=a[n]=a[n]||{},o=e[n]=e[n]||[];for(const t of i)r[t.featureIndex]||(r[t.featureIndex]=!0,o.push(t))}}return e}(h),t)}function U(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function j(t,e){const n=t.feature,i=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}function V(t,n,i){return e._(this,void 0,void 0,function*(){let r=t;if(t.url?r=(yield e.j(n.transformRequest(t.url,"Source"),i)).data:yield o.frameAsync(i),!r)return null;const a=e.Q(e.e(r,t),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in r&&r.vector_layers&&(a.vectorLayerIds=r.vector_layers.map(t=>t.id)),a})}class H{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof e.S?new e.S(t.lng,t.lat):e.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.S?new e.S(t.lng,t.lat):e.S.convert(t),this}extend(t){const n=this._sw,i=this._ne;let r,a;if(t instanceof e.S)r=t,a=t;else{if(!(t instanceof H))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(H.convert(t)):this.extend(e.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(e.S.convert(t)):this;if(r=t._sw,a=t._ne,!r||!a)return this}return n||i?(n.lng=Math.min(r.lng,n.lng),n.lat=Math.min(r.lat,n.lat),i.lng=Math.max(a.lng,i.lng),i.lat=Math.max(a.lat,i.lat)):(this._sw=new e.S(r.lng,r.lat),this._ne=new e.S(a.lng,a.lat)),this}getCenter(){return new e.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.S(this.getWest(),this.getNorth())}getSouthEast(){return new e.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:i}=e.S.convert(t);let r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(t){return t instanceof H?t:t?new H(t):t}static fromLngLat(t){const n=360*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/40075017,i=n/Math.cos(Math.PI/180*t.lat);return new H(new e.S(t.lng-i,t.lat-n),new e.S(t.lng+i,t.lat+n))}adjustAntiMeridian(){const t=new e.S(this._sw.lng,this._sw.lat),n=new e.S(this._ne.lng,this._ne.lat);return new H(t,t.lng>n.lng?new e.S(n.lng+360,n.lat):n)}}class G{constructor(t,e,n){this.bounds=H.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),i=Math.floor(e.V(this.bounds.getWest())*n),r=Math.floor(e.U(this.bounds.getNorth())*n),a=Math.ceil(e.V(this.bounds.getEast())*n),o=Math.ceil(e.U(this.bounds.getSouth())*n);return t.x>=i&&t.x<a&&t.y>=r&&t.y<o}}class W extends e.E{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.Q(n,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return e._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(e.e(this,t),t.bounds&&(this.tileBounds=new G(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return e.e({},this._options)}loadTile(t){return e._(this,void 0,void 0,function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(e,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};n.request.collectResourceTiming=this._collectResourceTiming;let i="RT";if(t.actor&&"expired"!==t.state){if("loading"===t.state)return new Promise((e,n)=>{t.reloadPromise={resolve:e,reject:n}})}else t.actor=this.dispatcher.getActor(),i="LT";t.abortController=new AbortController;try{const e=yield t.actor.sendAsync({type:i,data:n},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,e)}catch(e){if(delete t.abortController,t.aborted)return;if(e&&404!==e.status)throw e;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,e){if(e&&e.resourceTiming&&(t.resourceTiming=e.resourceTiming),e&&this.map._refreshExpiredTiles&&t.setExpiryData(e),t.loadVectorData(e,this.map.painter),t.reloadPromise){const e=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(e.resolve).catch(e.reject)}}abortTile(t){return e._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return e._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class q extends e.E{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},n),e.e(this,e.Q(n,["url","scheme","tileSize"]))}load(){return e._(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function*(){t._loaded=!1,t.fire(new e.l("dataloading",{dataType:"source"})),t._tileJSONRequest=new AbortController;try{const i=yield V(t._options,t.map._requestManager,t._tileJSONRequest);t._tileJSONRequest=null,t._loaded=!0,i&&(e.e(t,i),i.bounds&&(t.tileBounds=new G(i.bounds,t.minzoom,t.maxzoom)),t.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(n){t._tileJSONRequest=null,t.fire(new e.k(n))}}()})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return e.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return e._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const i=yield f.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const n=this.map.painter.context,r=n.gl,a=i.data;t.texture=this.map.painter.getTileTexture(a.width),t.texture?t.texture.update(a,{useMipmap:!0}):(t.texture=new e.T(n,a,r.RGBA,{useMipmap:!0}),t.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}})}abortTile(t){return e._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return e._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Z extends q{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return e._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const n=yield f.getImage(i,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(n&&n.data){const i=n.data;this.map._refreshExpiredTiles&&(n.cacheControl||n.expires)&&t.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const r=e.b(i)&&e.W()?i:yield this.readImageNow(i),a={type:this.type,uid:t.uid,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||"expired"===t.state){t.actor=this.dispatcher.getActor();const e=yield t.actor.sendAsync({type:"LDT",data:a});t.dem=e,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}})}readImageNow(t){return e._(this,void 0,void 0,function*(){if("undefined"!=typeof VideoFrame&&e.X()){const n=t.width+2,i=t.height+2;try{return new e.R({width:n,height:i},yield e.Y(t,-1,-1,n,i))}catch(t){}}return o.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,a=0===n.x?t.wrap-1:t.wrap,o=(n.x+1+i)%i,s=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.Z(t.overscaledZ,a,n.z,r,n.y).key]={backfilled:!1},l[new e.Z(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(l[new e.Z(t.overscaledZ,a,n.z,r,n.y-1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.Z(t.overscaledZ,a,n.z,r,n.y+1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),l}unloadTile(t){return e._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class X extends e.E{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.e({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,void 0!==n.clusterMaxZoom&&this.maxzoom<=n.clusterMaxZoom&&e.w('The maxzoom value "'.concat(this.maxzoom,'" is expected to be greater than the clusterMaxZoom value "').concat(n.clusterMaxZoom,'".')),this.workerOptions=e.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==n.buffer?n.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==n.tolerance?n.tolerance:.375),extent:e.$,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.$,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(e.$/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||void 0===t||e.w("Integer expected for option 'clusterMaxZoom': provided value \"".concat(t,'" rounded to "').concat(n,'"')),n}load(){return e._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._pendingWorkerUpdate={data:t},this._updateWorkerData(),this}updateData(t){return this._pendingWorkerUpdate.diff=e.a0(this._pendingWorkerUpdate.diff,t),this._updateWorkerData(),this}getData(){return e._(this,void 0,void 0,function*(){const t=e.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return"GeometryCollection"===t.type?t.geometries.map(t=>t.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return e._(this,void 0,void 0,function*(){const t=new H,e=yield this.getData();let n;switch(e.type){case"FeatureCollection":n=e.features.map(t=>this.getCoordinatesFromGeometry(t.geometry)).flat(1/0);break;case"Feature":n=this.getCoordinatesFromGeometry(e.geometry);break;default:n=this.getCoordinatesFromGeometry(e)}if(0==n.length)return t;for(let i=0;i<n.length-1;i+=2)t.extend([n[i],n[i+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,e,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:e,offset:n}})}_updateWorkerData(){return e._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:t,diff:n}=this._pendingWorkerUpdate;if(!t&&!n)return void e.w("No data or diff provided to GeoJSONSource ".concat(this.id,"."));const i=e.e({type:this.type},this.workerOptions);t?("string"==typeof t?(i.request=this.map._requestManager.transformRequest(o.resolveURL(t),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(t),this._pendingWorkerUpdate.data=void 0):n&&(i.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new e.l("dataloading",{dataType:"source"}));try{const t=yield this.actor.sendAsync({type:"LD",data:i});if(this._isUpdatingWorker=!1,this._removed||t.abandoned)return void this.fire(new e.l("dataabort",{dataType:"source"}));this._data=t.data;let n=null;t.resourceTiming&&t.resourceTiming[this.id]&&(n=t.resourceTiming[this.id].slice(0));const r={dataType:"source"};this._collectResourceTiming&&n&&n.length>0&&e.e(r,{resourceTiming:n}),this.fire(new e.l("data",Object.assign(Object.assign({},r),{sourceDataType:"metadata"}))),this.fire(new e.l("data",Object.assign(Object.assign({},r),{sourceDataType:"content"})))}catch(t){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new e.l("dataabort",{dataType:"source"}));this.fire(new e.k(t))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&void 0===this._pendingWorkerUpdate.data&&void 0===this._pendingWorkerUpdate.diff}loadTile(t){return e._(this,void 0,void 0,function*(){const e=t.actor?"RT":"LT";t.actor=this.actor;const n={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const i=yield this.actor.sendAsync({type:e,data:n},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(i,this.map.painter,"RT"===e)})}abortTile(t){return e._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return e._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Y extends e.E{constructor(t,e,n,i){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=e}load(t){return e._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const e=yield f.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,e&&e.data&&(this.image=e.data,t&&(this.coordinates=t),this._finishLoading())}catch(t){this._request=null,this._loaded=!0,this.fire(new e.k(t))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(e.a1.fromLngLat);var i;return this.tileID=function(t){const n=e.a2.fromPoints(t),i=n.width(),r=n.height(),a=Math.max(i,r),o=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),s=Math.pow(2,o);return new e.a4(o,Math.floor((n.minX+n.maxX)/2*s),Math.floor((n.minY+n.maxY)/2*s))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(t=>this.tileID.getTilePoint(t)._round()),this.flippedWindingOrder=((i=this.tileCoords)[1].x-i[0].x)*(i[2].y-i[0].y)-(i[1].y-i[0].y)*(i[2].x-i[0].x)<0,this.fire(new e.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new e.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return e._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:i,maxX:r,maxY:a}=e.a2.fromPoints(t),o={};for(let s=0;s<=e.a3;s++){const t=Math.pow(2,s),e=Math.floor(n*t),l=Math.floor(i*t),c=Math.floor(r*t),u=Math.floor(a*t);o[s]={minTileX:e,minTileY:l,maxTileX:c,maxTileY:u}}return o}}class K extends Y{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){return e._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,"Source").url);try{const t=yield e.a5(this.urls);if(this._loaded=!0,!t)return;this.video=t,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(t){this.fire(new e.k(t))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.k(new e.a6("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class J extends Y{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new e.k(new e.a6("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.k(new e.a6("sources.".concat(t),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.k(new e.a6("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new e.k(new e.a6("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.k(new e.a6("sources.".concat(t),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){return e._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(n,this.canvas,i.RGBA,{premultiply:!0});let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const $={},Q=t=>{switch(t){case"geojson":return X;case"image":return Y;case"raster":return q;case"raster-dem":return Z;case"vector":return W;case"video":return K;case"canvas":return J}return $[t]},tt="RTLPluginLoaded";class et extends e.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=F()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(t=>{throw this.status="error",t})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return e._(this,arguments,void 0,function(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){if(e.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(e.url=o.resolveURL(t),!e.url)throw new Error("requested url ".concat(t," is invalid"));if("unavailable"===e.status){if(!n)return e._requestImport();e.status="deferred",e._syncState(e.status)}else if("requested"===e.status)return e._requestImport()}()})}_requestImport(){return e._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new e.l(tt))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let nt=null;function it(){return nt||(nt=new et),nt}class rt{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a7(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const n={};if(!e)return n;for(const i of t){const t=i.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){i.layers=t,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)n[e.id]=i}}return n}(t.buckets,null==n?void 0:n.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.a9){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.a9&&n.hasRTLText){this.hasRTLText=!0,it().lazyLoad();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(t).queryRadius(e))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a8}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const n=this.buckets[e];n.uploadPending()&&n.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new e.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,n,i,r,a,o,s,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:a,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:o,queryPadding:this.queryPadding*l,getElevation:u},t,e,n):{}}querySourceFeatures(t,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),a=n&&n.sourceLayer?n.sourceLayer:"",o=r._geojsonTileLayer||r[a];if(!o)return;const s=e.aa(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<o.length;d++){const n=o.feature(d);if(s.needGeometry){const t=e.ab(n,!0);if(!s.filter(new e.F(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new e.F(this.tileID.overscaledZ),n))continue;const r=i.getId(n,a),p=new e.ac(n,l,c,u,r);p.tile=h,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const n=e.ad(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(n)if(this.expirationTime<n)e=!0;else{const i=this.expirationTime-n;i?this.expirationTime=t+Math.max(i,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!e.style.hasLayer(i))continue;const r=this.buckets[i],a=r.layers[0].sourceLayer||"_geojsonTileLayer",o=n[a],s=t[a];if(!o||!s||0===Object.keys(s).length)continue;r.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.now()+t}setDependencies(t,e){const n={};for(const i of e)n[i]=!0;this.dependencies[t]=n}hasDependency(t,e){for(const n of t){const t=this.dependencies[n];if(t)for(const n of e)if(t[n])return!0}return!1}}class at{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,n){const i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:e,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout(()=>{this.remove(t,r)},n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const n in this.data)for(const i of this.data[n])t(i.value)||e.push(i);for(const n of e)this.remove(n.value.tileID,n)}}class ot{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,i){const r=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.e(this.stateChanges[t][r],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])i[e]||(this.deletedStates[t][r][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(t,e,n){if(null===this.deletedStates[t])return;const i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}getState(t,n){const i=String(n),r=e.e({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][n];if(null===e)return{};for(const t in e)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,n){const i={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const t={};for(const n in this.stateChanges[r])this.state[r][n]||(this.state[r][n]={}),e.e(this.state[r][n],this.stateChanges[r][n]),t[n]=this.state[r][n];i[r]=t}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const t={};if(null===this.deletedStates[r])for(const e in this.state[r])t[e]={},this.state[r][e]={};else for(const e in this.deletedStates[r]){if(null===this.deletedStates[r][e])this.state[r][e]={};else for(const t of Object.keys(this.deletedStates[r][e]))delete this.state[r][e][t];t[e]=this.state[r][e]}i[r]=i[r]||{},e.e(i[r],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const e in t)t[e].setFeatureState(i,n)}}const st=89.25;function lt(t,n){const i=e.ah(n.lat,-e.ai,e.ai);return new e.P(e.V(n.lng)*t,e.U(i)*t)}function ct(t,n){return new e.a1(n.x/t,n.y/t).toLngLat()}function ut(t){return t.cameraToCenterDistance*Math.min(.85*Math.tan(e.ae(90-t.pitch)),Math.tan(e.ae(st-t.pitch)))}function ht(t,n){const i=t.canonical,r=n/e.af(i.z),a=i.x+Math.pow(2,i.z)*t.wrap,o=e.ag(new Float64Array(16));return e.M(o,o,[a*r,i.y*r,0]),e.N(o,o,[r/e.$,r/e.$,1]),o}function dt(t,n,i,r,a){const o=e.a1.fromLngLat(t,n),s=a*e.aj(1,t.lat),l=s*Math.cos(e.ae(i)),c=Math.sqrt(s*s-l*l),u=c*Math.sin(e.ae(-r)),h=c*Math.cos(e.ae(-r));return new e.a1(o.x+u,o.y+h,o.z+l)}function pt(t,e,n){const i=e.intersectsFrustum(t);if(!n||0===i)return i;const r=e.intersectsPlane(n);return 0===r?0:2===i&&2===r?2:1}function ft(t,e,n){let i=0;const r=(n-e)/10;for(let a=0;a<10;a++)i+=r*Math.pow(Math.cos(e+(a+.5)/10*(n-e)),t);return i}function mt(t,n){return function(i,r,a,o,s){const l=2*((t-1)/e.ak(Math.cos(e.ae(st-s))/Math.cos(e.ae(st)))-1),c=Math.acos(a/o),u=2*ft(l-1,0,e.ae(s/2)),h=Math.min(e.ae(st),c+e.ae(s/2)),d=ft(l-1,Math.min(h,c-e.ae(s/2)),h),p=Math.atan(r/a),f=Math.hypot(r,a);let m=i;return m+=e.ak(o/f/Math.max(.5,Math.cos(e.ae(s/2)))),m+=l*e.ak(Math.cos(p))/2,m-=e.ak(Math.max(1,d/u/n))/2,m}}const gt=mt(9.314,3);function yt(t,n){const i=(n.roundZoom?Math.round:Math.floor)(t.zoom+e.ak(t.tileSize/n.tileSize));return Math.max(0,i)}function vt(t,n){const i=t.getCameraFrustum(),r=t.getClippingPlane(),a=t.screenPointToMercatorCoordinate(t.getCameraPoint()),o=e.a1.fromLngLat(t.center,t.elevation);a.z=o.z+Math.cos(t.pitchInRadians)*t.cameraToCenterDistance/t.worldSize;const s=t.getCoveringTilesDetailsProvider(),l=s.allowVariableZoom(t,n),c=yt(t,n),u=n.minzoom||0,h=void 0!==n.maxzoom?n.maxzoom:t.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*a.x,p*a.y,0],m=[p*o.x,p*o.y,0],g=Math.hypot(o.x-a.x,o.y-a.y),y=Math.abs(o.z-a.z),v=Math.hypot(g,y),_=t=>({zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),b=[],x=[];if(t.renderWorldCopies&&s.allowWorldCopies())for(let e=1;e<=3;e++)b.push(_(-e)),b.push(_(e));for(b.push(_(0));b.length>0;){const p=b.pop(),g=p.x,_=p.y;let w=p.fullyVisible;const S={x:g,y:_,z:p.zoom},M=s.getTileBoundingVolume(S,p.wrap,t.elevation,n);if(!w){const t=pt(i,M,r);if(0===t)continue;w=2===t}const T=s.distanceToTile2d(a.x,a.y,S,M);let A=c;l&&(A=(n.calculateTileZoom||gt)(t.zoom+e.ak(t.tileSize/n.tileSize),T,y,v,t.fov)),A=(n.roundZoom?Math.round:Math.floor)(A),A=Math.max(0,A);const E=Math.min(A,h);if(p.wrap=s.getWrap(o,S,p.wrap),p.zoom>=E){if(p.zoom<u)continue;const t=d-p.zoom,i=f[0]-.5-(g<<t),r=f[1]-.5-(_<<t),a=n.reparseOverscaled?Math.max(p.zoom,A):p.zoom;x.push({tileID:new e.Z(p.zoom===h?a:p.zoom,p.wrap,p.zoom,g,_),distanceSq:e.al([m[0]-.5-g,m[1]-.5-_]),tileDistanceToCamera:Math.sqrt(i*i+r*r)})}else for(let t=0;t<4;t++)b.push({zoom:p.zoom+1,x:(g<<1)+t%2,y:(_<<1)+(t>>1),wrap:p.wrap,fullyVisible:w})}return x.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}const _t=e.a2.fromPoints([new e.P(0,0),new e.P(e.$,e.$)]);class bt extends e.E{constructor(t,e,n){super(),this.id=t,this.dispatcher=n,this.on("data",t=>this._dataHandler(t)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((t,e,n,i)=>{const r=new(Q(e.type))(t,e,n,i);if(r.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(r.id));return r})(t,e,n,this),this._tiles={},this._cache=new at(0,t=>this._unloadTile(t)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ot,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,i){return e._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,i)}catch(n){t.state="errored",404!==n.status?this._source.fire(new e.k(n,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new e.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(xt).map(t=>t.key)}getRenderableIds(t){const n=[];for(const e in this._tiles)this._isIdRenderable(e,t)&&n.push(this._tiles[e]);return t?n.sort((t,n)=>{const i=t.tileID,r=n.tileID,a=new e.P(i.canonical.x,i.canonical.y)._rotate(-this.transform.bearingInRadians),o=new e.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians);return i.overscaledZ-r.overscaledZ||o.y-a.y||o.x-a.x}).map(t=>t.tileID.key):n.map(t=>t.tileID).sort(xt).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)t?this._reloadTile(e,"expired"):"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading")}}_reloadTile(t,n){return e._(this,void 0,void 0,function*(){const e=this._tiles[t];e&&("loading"!==e.state&&(e.state=n),yield this._loadTile(e,t,n))})}_tileLoaded(t,n,i){t.timeAdded=o.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let i=0;i<e.length;i++){const r=e[i];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);n(t,e),n(e,t)}}function n(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let n=e.tileID.canonical.x-t.tileID.canonical.x;const i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,n,i){for(const r in this._tiles){let a=this._tiles[r];if(i[r]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>n)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>e+1;){const t=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[t.key],a&&a.hasData()&&(o=t)}let s=o;for(;s.overscaledZ>e;)if(s=s.scaledTo(s.overscaledZ-1),t[s.key]||t[s.canonical.key]){i[o.key]=o;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(let n=t.overscaledZ-1;n>=e;n--){const e=t.scaledTo(n),i=this._getLoadedTile(e);if(i)return i}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,i=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(n*i*(null===this._maxTileCacheZoomLevels?e.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(a)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),t[i.tileID.key]=i}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}_updateCoveredAndRetainedTiles(t,e,n,i,r,a){const s={},l={},c=Object.keys(t),u=o.now();for(const o of c){const n=t[o],i=this._tiles[o];if(!i||0!==i.fadeEndTime&&i.fadeEndTime<=u)continue;const r=this.findLoadedParent(n,e),a=this.findLoadedSibling(n),c=r||a||null;c&&(this._addTile(c.tileID),s[c.tileID.key]=c.tileID),l[o]=n}this._retainLoadedChildren(l,i,n,t);for(const o in s)t[o]||(this._coveredTiles[o]=!0,t[o]=s[o]);if(a){const e={},n={};for(const t of r)this._tiles[t.key].hasData()?e[t.key]=t:n[t.key]=t;for(const i in n){const r=n[i].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(e[r[0].key]=t[r[0].key]=r[0],e[r[1].key]=t[r[1].key]=r[1],e[r[2].key]=t[r[2].key]=r[2],e[r[3].key]=t[r[3].key]=r[3],delete n[i])}for(const i in n){const r=n[i],a=this.findLoadedParent(r,this._source.minzoom),o=this.findLoadedSibling(r),s=a||o||null;if(s){e[s.tileID.key]=t[s.tileID.key]=s.tileID;for(const t in e)e[t].isChildOf(s.tileID)&&delete e[t]}}for(const t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}update(t,n){if(!this._sourceLoaded||this._paused)return;let i;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.Z(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(i=vt(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(i=i.filter(t=>this._source.hasTile(t)))):i=[];const r=yt(t,this._source),a=Math.max(r-bt.maxOverzooming,this._source.minzoom),o=Math.max(r+bt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of i)if(e.canonical.z>this._source.minzoom){const n=e.scaledTo(e.canonical.z-1);t[n.key]=n;const i=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[i.key]=i}i=i.concat(Object.values(t))}const s=0===i.length&&!this._updated&&this._didEmitContent;this._updated=!0,s&&this.fire(new e.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(i,r);wt(this._source.type)&&this._updateCoveredAndRetainedTiles(l,a,o,r,i,n);for(const e in l)this._tiles[e].clearFadeHold();const c=e.am(this._tiles,l);for(const e of c){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){var n;const i={},r={},a=Math.max(e-bt.maxOverzooming,this._source.minzoom),o=Math.max(e+bt.maxUnderzooming,this._source.minzoom),s={};for(const l of t){const t=this._addTile(l);i[l.key]=l,t.hasData()||e<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,e,o,i);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){i[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(i[t[0].key]&&i[t[1].key]&&i[t[2].key]&&i[t[3].key])continue}let o=t.wasRequested();for(let e=l.overscaledZ-1;e>=a;--e){const a=l.scaledTo(e);if(r[a.key])break;if(r[a.key]=!0,t=this.getTile(a),!t&&o&&(t=this._addTile(a)),t){const e=t.hasData();if((e||!(null===(n=this.map)||void 0===n?void 0:n.cancelPendingTileRequestsWhileZooming)||o)&&(i[a.key]=a),o=t.wasRequested(),e)break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let n,i=this._tiles[t].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}e.push(i.key);const t=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(t),n)break;i=t}for(const t of e)this._loadedParentTiles[t]=n}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const e=this._tiles[t].tileID,n=this._getLoadedTile(e);this._loadedSiblingTiles[e.key]=n}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const i=n;return n||(n=new rt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._tiles[t.key]=n,i||this._source.fire(new e.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},n))}refreshTiles(t){for(const e in this._tiles)(this._isIdRenderable(e)||"errored"==this._tiles[e].state)&&t.some(t=>t.equals(this._tiles[e].tileID.canonical))&&this._reloadTile(e,"expired")}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}_dataHandler(t){const e=t.sourceDataType;"source"===t.dataType&&"metadata"===e&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===e&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,i){const r=[],a=this.transform;if(!a)return r;const o=a.getCoveringTilesDetailsProvider().allowWorldCopies(),s=i?a.getCameraQueryGeometry(t):t,l=t=>a.screenPointToMercatorCoordinate(t,this.terrain),c=this.transformBbox(t,l,!o),u=this.transformBbox(s,l,!o),h=this.getIds(),d=e.a2.fromPoints(u);for(let p=0;p<h.length;p++){const t=this._tiles[h[p]];if(t.holdingForFade())continue;const i=o?[t.tileID]:[t.tileID.unwrapTo(-1),t.tileID.unwrapTo(0)],s=Math.pow(2,a.zoom-t.tileID.overscaledZ),l=n*t.queryPadding*e.$/t.tileSize/s;for(const n of i){const i=d.map(t=>n.getTilePoint(new e.a1(t.x,t.y)));if(i.expandBy(l),i.intersects(_t)){const e=c.map(t=>n.getTilePoint(t)),i=u.map(t=>n.getTilePoint(t));r.push({tile:t,tileID:o?n:n.unwrapTo(0),queryGeometry:e,cameraQueryGeometry:i,scale:s})}}}return r}transformBbox(t,n,i){let r=t.map(n);if(i){const i=e.a2.fromPoints(t);i.shrinkBy(.001*Math.min(i.width(),i.height()));const a=i.map(n);e.a2.fromPoints(r).covers(a)||(r=r.map(t=>t.x>.5?new e.a1(t.x-1,t.y,t.z):t))}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);return this.transform&&this.transform.populateCache(e),e}hasTransition(){if(this._source.hasTransition())return!0;if(wt(this._source.type)){const t=o.now();for(const e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)}removeFeatureState(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,n){const i=this._tiles[t];i&&i.setDependencies(e,n)}reloadTilesForDependencies(t,e){for(const n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter(n=>!n.hasDependency(t,e))}}function xt(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function wt(t){return"raster"===t||"image"===t||"video"===t}bt.maxOverzooming=10,bt.maxUnderzooming=3;class St{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ah(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const a=n-1,o=this._distances[a],s=i-o,l=s>0?(r-o)/s:0;return this.points[a].mult(1-l).add(this.points[n].mult(l))}}function Mt(t,e){let n=!0;return"always"===t||"never"!==t&&"never"!==e||(n=!1),n}class Tt{constructor(t,e,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(let a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)}_insertBoxCell(t,e,n,i,r,a){this.boxCells[r].push(a)}_insertCircleCell(t,e,n,i,r,a){this.circleCells[r].push(a)}_query(t,e,n,i,r,a,o){if(n<0||t>this.width||i<0||e>this.height)return[];const s=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return[{key:null,x1:t,y1:e,x2:n,y2:i}];for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],n=this.circles[3*t+1],i=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-i,y1:n-i,x2:e+i,y2:n+i})}}else this._forEachCell(t,e,n,i,this._queryCell,s,{hitTest:r,overlapMode:a,seenUids:{box:{},circle:{}}},o);return s}query(t,e,n,i){return this._query(t,e,n,i,!1,null)}hitTest(t,e,n,i,r,a){return this._query(t,e,n,i,!0,r,a).length>0}hitTestCircle(t,e,n,i,r){const a=t-n,o=t+n,s=e-n,l=e+n;if(o<0||a>this.width||l<0||s>this.height)return!1;const c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(t,e,n,i,r,a,o,s){const{seenUids:l,hitTest:c,overlapMode:u}=o,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const o of h)if(!l.box[o]){l.box[o]=!0;const h=4*o,d=this.boxKeys[o];if(t<=r[h+2]&&e<=r[h+3]&&n>=r[h+0]&&i>=r[h+1]&&(!s||s(d))&&(!c||!Mt(u,d.overlapMode))&&(a.push({key:d,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const o of d)if(!l.circle[o]){l.circle[o]=!0;const h=3*o,d=this.circleKeys[o];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],t,e,n,i)&&(!s||s(d))&&(!c||!Mt(u,d.overlapMode))){const t=r[h],e=r[h+1],n=r[h+2];if(a.push({key:d,x1:t-n,y1:e-n,x2:t+n,y2:e+n}),c)return!0}}}return!1}_queryCellCircle(t,e,n,i,r,a,o,s){const{circle:l,seenUids:c,overlapMode:u}=o,h=this.boxCells[r];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const n=4*e,i=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[n+0],t[n+1],t[n+2],t[n+3])&&(!s||s(i))&&!Mt(u,i.overlapMode))return a.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const t=this.circles;for(const e of d)if(!c.circle[e]){c.circle[e]=!0;const n=3*e,i=this.circleKeys[e];if(this._circlesCollide(t[n],t[n+1],t[n+2],l.x,l.y,l.radius)&&(!s||s(i))&&!Mt(u,i.overlapMode))return a.push(!0),!0}}}_forEachCell(t,e,n,i,r,a,o,s){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,n,i,this.xCellCount*l+d,a,o,s))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,n,i,r,a){const o=i-t,s=r-e,l=n+a;return l*l>o*o+s*s}_circleAndRectCollide(t,e,n,i,r,a,o){const s=(a-i)/2,l=Math.abs(t-(i+s));if(l>s+n)return!1;const c=(o-r)/2,u=Math.abs(e-(r+c));if(u>c+n)return!1;if(l<=s||u<=c)return!0;const h=l-s,d=u-c;return h*h+d*d<=n*n}}function At(t,n,r){const a=e.L();if(!t){const{vecSouth:t,vecEast:e}=Ct(n),r=i();r[0]=e[0],r[1]=e[1],r[2]=t[0],r[3]=t[1],o=r,(d=(l=(s=r)[0])*(h=s[3])-(u=s[2])*(c=s[1]))&&(o[0]=h*(d=1/d),o[1]=-c*d,o[2]=-u*d,o[3]=l*d),a[0]=r[0],a[1]=r[1],a[4]=r[2],a[5]=r[3]}var o,s,l,c,u,h,d;return e.N(a,a,[1/r,1/r,1]),a}function Et(t,n,i,r){if(t){const t=e.L();if(!n){const{vecSouth:e,vecEast:n}=Ct(i);t[0]=n[0],t[1]=n[1],t[4]=e[0],t[5]=e[1]}return e.N(t,t,[r,r,1]),t}return i.pixelsToClipSpaceMatrix}function Ct(t){const n=Math.cos(t.rollInRadians),i=Math.sin(t.rollInRadians),r=Math.cos(t.pitchInRadians),a=Math.cos(t.bearingInRadians),o=Math.sin(t.bearingInRadians),s=e.ar();s[0]=-a*r*i-o*n,s[1]=-o*r*i+a*n;const l=e.as(s);l<1e-9?e.at(s):e.au(s,s,1/l);const c=e.ar();c[0]=a*r*n-o*i,c[1]=o*r*n+a*i;const u=e.as(c);return u<1e-9?e.at(c):e.au(c,c,1/u),{vecEast:c,vecSouth:s}}function Pt(t,n,i,r){let a;r?(a=[t,n,r(t,n),1],e.aw(a,a,i)):(a=[t,n,0,1],qt(a,a,i));const o=a[3];return{point:new e.P(a[0]/o,a[1]/o),signedDistanceFromCamera:o,isOccluded:!1}}function It(t,e){return.5+t/e*.5}function Lt(t,e){return t.x>=-e[0]&&t.x<=e[0]&&t.y>=-e[1]&&t.y<=e[1]}function kt(t,n,i,r,a,o,s,l,c,u,h,d,p){const f=i?t.textSizeData:t.iconSizeData,m=e.an(f,n.transform.zoom),g=[256/n.width*2+1,256/n.height*2+1],y=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;y.clear();const v=t.lineVertexArray,_=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,b=n.transform.width/n.transform.height;let x=!1;for(let w=0;w<_.length;w++){const i=_.get(w);if(i.hidden||i.writingMode===e.ao.vertical&&!x){Wt(i.numGlyphs,y);continue}x=!1;const S=new e.P(i.anchorX,i.anchorY),M={getElevation:p,pitchedLabelPlaneMatrix:r,lineVertexArray:v,pitchWithMap:o,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:S,unwrappedTileID:c,width:u,height:h,translation:d},T=Ut(i.anchorX,i.anchorY,M);if(!Lt(T.point,g)){Wt(i.numGlyphs,y);continue}const A=It(n.transform.cameraToCenterDistance,T.signedDistanceFromCamera),E=e.ap(f,m,i),C=o?E*n.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,c)/A:E*A,P=Nt({projectionContext:M,pitchedLabelPlaneMatrixInverse:a,symbol:i,fontSize:C,flip:!1,keepUpright:s,glyphOffsetArray:t.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:b,rotateToLine:l});x=P.useVertical,(P.notEnoughRoom||x||P.needsFlipping&&Nt({projectionContext:M,pitchedLabelPlaneMatrixInverse:a,symbol:i,fontSize:C,flip:!0,keepUpright:s,glyphOffsetArray:t.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:b,rotateToLine:l}).notEnoughRoom)&&Wt(i.numGlyphs,y)}i?t.text.dynamicLayoutVertexBuffer.updateData(y):t.icon.dynamicLayoutVertexBuffer.updateData(y)}function Rt(t,e,n,i,r,a,o,s){const l=a.glyphStartIndex+a.numGlyphs,c=a.lineStartIndex,u=a.lineStartIndex+a.lineLength,h=e.getoffsetX(a.glyphStartIndex),d=e.getoffsetX(l-1),p=Ht(t*h,n,i,r,a.segment,c,u,s,o);if(!p)return null;const f=Ht(t*d,n,i,r,a.segment,c,u,s,o);return f?s.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function Dt(t,n,i,r){return t===e.ao.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(t===e.ao.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function Nt(t){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:i,symbol:r,fontSize:a,flip:o,keepUpright:s,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=t,d=a/24,p=r.lineOffsetX*d,f=r.lineOffsetY*d;let m;if(r.numGlyphs>1){const t=r.glyphStartIndex+r.numGlyphs,e=r.lineStartIndex,a=r.lineStartIndex+r.lineLength,c=Rt(d,l,p,f,o,r,h,n);if(!c)return{notEnoughRoom:!0};const g=Bt(c.first.point.x,c.first.point.y,n,i),y=Bt(c.last.point.x,c.last.point.y,n,i);if(s&&!o){const t=Dt(r.writingMode,g,y,u);if(t)return t}m=[c.first];for(let i=r.glyphStartIndex+1;i<t-1;i++){const t=Ht(d*l.getoffsetX(i),p,f,o,r.segment,e,a,n,h);if(!t)return{notEnoughRoom:!0};m.push(t)}m.push(c.last)}else{if(s&&!o){const t=Ot(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,a=r.lineStartIndex+r.segment+1,o=new e.P(n.lineVertexArray.getx(a),n.lineVertexArray.gety(a)),s=Ot(o.x,o.y,n),l=s.signedDistanceFromCamera>0?s.point:zt(n.tileAnchorPoint,o,t,1,n),c=Bt(t.x,t.y,n,i),h=Bt(l.x,l.y,n,i),d=Dt(r.writingMode,c,h,u);if(d)return d}const t=Ht(d*l.getoffsetX(r.glyphStartIndex),p,f,o,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,n,h);if(!t||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[t]}for(const g of m)e.av(c,g.point,g.angle);return{}}function zt(t,e,n,i,r){const a=t.add(t.sub(e)._unit()),o=Ot(a.x,a.y,r).point,s=n.sub(o);return n.add(s._mult(i/s.mag()))}function Ft(t,n,i){const r=n.projectionCache;if(r.projections[t])return r.projections[t];const a=new e.P(n.lineVertexArray.getx(t),n.lineVertexArray.gety(t)),o=Ot(a.x,a.y,n);if(o.signedDistanceFromCamera>0)return r.projections[t]=o.point,r.anyProjectionOccluded=r.anyProjectionOccluded||o.isOccluded,o.point;const s=t-i.direction;return zt(0===i.distanceFromAnchor?n.tileAnchorPoint:new e.P(n.lineVertexArray.getx(s),n.lineVertexArray.gety(s)),a,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,n)}function Ot(t,e,n){const i=t+n.translation[0],r=e+n.translation[1];let a;return n.pitchWithMap?(a=Pt(i,r,n.pitchedLabelPlaneMatrix,n.getElevation),a.isOccluded=!1):(a=n.transform.projectTileCoordinates(i,r,n.unwrappedTileID,n.getElevation),a.point.x=(.5*a.point.x+.5)*n.width,a.point.y=(.5*-a.point.y+.5)*n.height),a}function Bt(t,n,i,r){if(i.pitchWithMap){const a=[t,n,0,1];return e.aw(a,a,r),i.transform.projectTileCoordinates(a[0]/a[3],a[1]/a[3],i.unwrappedTileID,i.getElevation).point}return{x:t/i.width*2-1,y:1-n/i.height*2}}function Ut(t,e,n){return n.transform.projectTileCoordinates(t,e,n.unwrappedTileID,n.getElevation)}function jt(t,e,n){return t._unit()._perp()._mult(e*n)}function Vt(t,n,i,r,a,o,s,l,c){if(l.projectionCache.offsets[t])return l.projectionCache.offsets[t];const u=i.add(n);if(t+c.direction<r||t+c.direction>=a)return l.projectionCache.offsets[t]=u,u;const h=Ft(t+c.direction,l,c),d=jt(h.sub(i),s,c.direction),p=i.add(d),f=h.add(d);return l.projectionCache.offsets[t]=e.ax(o,u,p,f)||u,l.projectionCache.offsets[t]}function Ht(t,e,n,i,r,a,o,s,l){const c=i?t-e:t+e;let u=c>0?1:-1,h=0;i&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?a+r:a+r+1;s.projectionCache.cachedAnchorPoint?d=s.projectionCache.cachedAnchorPoint:(d=Ot(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,s.projectionCache.cachedAnchorPoint=d);let f,m,g=d,y=d,v=0,_=0;const b=Math.abs(c),x=[];let w;for(;v+_<=b;){if(p+=u,p<a||p>=o)return null;v+=_,y=g,m=f;const t={absOffsetX:b,direction:u,distanceFromAnchor:v,previousVertex:y};if(g=Ft(p,s,t),0===n)x.push(y),w=g.sub(y);else{let e;const i=g.sub(y);e=0===i.mag()?jt(Ft(p+u,s,t).sub(g),n,u):jt(i,n,u),m||(m=y.add(e)),f=Vt(p,e,g,a,o,m,n,s,t),x.push(m),w=f.sub(m)}_=w.mag()}const S=w._mult((b-v)/_)._add(m||y),M=h+Math.atan2(g.y-y.y,g.x-y.x);return x.push(S),{point:S,angle:l?M:0,path:x}}const Gt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wt(t,e){for(let n=0;n<t;n++){const t=e.length;e.resize(t+4),e.float32.set(Gt,3*t)}}function qt(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}const Zt=100;class Xt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt(t.width+200,t.height+200,25),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Tt(t.width+200,t.height+200,25);this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zt,this.screenBottomBoundary=t.height+Zt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,n,i,r,a,o,s,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(t.anchorPointX+s[0],t.anchorPointY+s[1],r,c,h),p=n*d.perspectiveRatio;let f;if(a||o)f=this._projectCollisionBox(t,p,i,r,a,o,s,d,c,u,h);else{const e=d.x+(u?u.x*p:0),n=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[e+t.x1*p,n+t.y1*p,e+t.x2*p,n+t.y2*p]}}const[m,g,y,v]=f.box,_=a?f.allPointsOccluded:d.isOccluded;let b=_;return b||(b=d.perspectiveRatio<this.perspectiveRatioCutoff),b||(b=!this.isInsideGrid(m,g,y,v)),b||"always"!==e&&this.grid.hitTest(m,g,y,v,e,l)?{box:[m,g,y,v],placeable:!1,offscreen:!1,occluded:_}:{box:[m,g,y,v],placeable:!0,offscreen:this.isOffscreen(m,g,y,v),occluded:_}}placeCollisionCircles(t,n,i,r,a,o,s,l,c,u,h,d,p,f){const m=[],g=new e.P(n.anchorX,n.anchorY),y=this.getPerspectiveRatio(g.x,g.y,o,f),v=(c?a*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,o)/y:a*y)/e.aB,_={getElevation:f,pitchedLabelPlaneMatrix:s,lineVertexArray:i,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:g,unwrappedTileID:o,width:this.transform.width,height:this.transform.height,translation:p},b=Rt(v,r,n.lineOffsetX*v,n.lineOffsetY*v,!1,n,!1,_);let x=!1,w=!1,S=!0;if(b){const n=.5*h*y+d,i=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),a=new St,o=b.first,s=b.last;let p=[];for(let t=o.path.length-1;t>=1;t--)p.push(o.path[t]);for(let t=1;t<s.path.length;t++)p.push(s.path[t]);const f=2.5*n;if(c){const t=this.projectPathToScreenSpace(p,_);p=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let g=[];if(p.length>0){const t=p[0].clone(),n=p[0].clone();for(let e=1;e<p.length;e++)t.x=Math.min(t.x,p[e].x),t.y=Math.min(t.y,p[e].y),n.x=Math.max(n.x,p[e].x),n.y=Math.max(n.y,p[e].y);g=t.x>=i.x&&n.x<=r.x&&t.y>=i.y&&n.y<=r.y?[p]:n.x<i.x||t.x>r.x||n.y<i.y||t.y>r.y?[]:e.ay([p],i.x,i.y,r.x,r.y)}for(const e of g){a.reset(e,.25*n);let i=0;i=a.length<=.5*n?1:Math.ceil(a.paddedLength/f)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),o=a.lerp(r),s=o.x+Zt,c=o.y+Zt;m.push(s,c,n,0);const h=s-n,d=c-n,p=s+n,f=c+n;if(S=S&&this.isOffscreen(h,d,p,f),w=w||this.isInsideGrid(h,d,p,f),"always"!==t&&this.grid.hitTestCircle(s,c,n,t,u)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!w||y<this.perspectiveRatioCutoff?[]:m,offscreen:S,collisionDetected:x}}projectPathToScreenSpace(t,n){const i=function(t,n){const i=e.L();return e.aq(i,n.pitchedLabelPlaneMatrix),t.map(t=>{const e=Pt(t.x,t.y,i,n.getElevation),r=n.transform.projectTileCoordinates(e.point.x,e.point.y,n.unwrappedTileID,n.getElevation);return r.point.x=(.5*r.point.x+.5)*n.width,r.point.y=(.5*-r.point.y+.5)*n.height,r})}(t,n);return function(t){let e=0,n=0,i=0,r=0;for(let a=0;a<t.length;a++)t[a].isOccluded?(i=a+1,r=0):(r++,r>n&&(n=r,e=i));return t.slice(e,e+n)}(i)}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[],i=new e.a2;for(const h of t){const t=new e.P(h.x+Zt,h.y+Zt);i.extend(t),n.push(t)}const{minX:r,minY:a,maxX:o,maxY:s}=i,l=this.grid.query(r,a,o,s).concat(this.ignoredGrid.query(r,a,o,s)),c={},u={};for(const h of l){const t=h.key;if(void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]={}),c[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.P(h.x1,h.y1),new e.P(h.x2,h.y1),new e.P(h.x2,h.y2),new e.P(h.x1,h.y2)];e.az(n,i)&&(c[t.bucketInstanceId][t.featureIndex]=!0,void 0===u[t.bucketInstanceId]&&(u[t.bucketInstanceId]=[]),u[t.bucketInstanceId].push(t.featureIndex))}return u}insertCollisionBox(t,e,n,i,r,a){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:a,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,n,i,r,a){const o=n?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:a,overlapMode:e};for(let l=0;l<t.length;l+=4)o.insertCircle(s,t[l],t[l+1],t[l+2])}projectAndGetPerspectiveRatio(t,n,i,r,a){if(a){let i;r?(i=[t,n,r(t,n),1],e.aw(i,i,a)):(i=[t,n,0,1],qt(i,i,a));const o=i[3];return{x:(i[0]/o+1)/2*this.transform.width+Zt,y:(-i[1]/o+1)/2*this.transform.height+Zt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/o*.5,isOccluded:!1,signedDistanceFromCamera:o}}{const e=this.transform.projectTileCoordinates(t,n,i,r);return{x:(e.point.x+1)/2*this.transform.width+Zt,y:(1-e.point.y)/2*this.transform.height+Zt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/e.signedDistanceFromCamera*.5,isOccluded:e.isOccluded,signedDistanceFromCamera:e.signedDistanceFromCamera}}}getPerspectiveRatio(t,e,n,i){const r=this.transform.projectTileCoordinates(t,e,n,i);return.5+this.transform.cameraToCenterDistance/r.signedDistanceFromCamera*.5}isOffscreen(t,e,n,i){return n<Zt||t>=this.screenRightBoundary||i<Zt||e>this.screenBottomBoundary}isInsideGrid(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const t=e.ag([]);return e.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,i,r,a,o,s,l,c,u,h){let d=1,p=0,f=0,m=1;const g=t.anchorPointX+s[0],y=t.anchorPointY+s[1];if(o&&!a){const t=this.projectAndGetPerspectiveRatio(g+1,y,r,c,h),e=t.x-l.x,n=Math.atan((t.y-l.y)/e)+(e<0?Math.PI:0),i=Math.sin(n),a=Math.cos(n);d=a,p=i,f=-i,m=a}else if(!o&&a){const t=Ct(this.transform);d=t.vecEast[0],p=t.vecEast[1],f=t.vecSouth[0],m=t.vecSouth[1]}let v=l.x,_=l.y,b=n;a&&(v=g,_=y,b=Math.pow(2,-(this.transform.zoom-i.overscaledZ)),b*=this.transform.getPitchedTextCorrection(g,y,r),u||(b*=e.ah(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(v+=d*u.x*b+f*u.y*b,_+=p*u.x*b+m*u.y*b);const x=t.x1*b,w=t.x2*b,S=(x+w)/2,M=t.y1*b,T=t.y2*b,A=(M+T)/2,E=[{offsetX:x,offsetY:M},{offsetX:S,offsetY:M},{offsetX:w,offsetY:M},{offsetX:w,offsetY:A},{offsetX:w,offsetY:T},{offsetX:S,offsetY:T},{offsetX:x,offsetY:T},{offsetX:x,offsetY:A}];let C=[];for(const{offsetX:I,offsetY:L}of E)C.push(new e.P(v+d*I+f*L,_+p*I+m*L));let P=!1;if(a){const t=C.map(t=>this.projectAndGetPerspectiveRatio(t.x,t.y,r,c,h));P=t.some(t=>!t.isOccluded),C=t.map(t=>new e.P(t.x,t.y))}else P=!0;return{box:e.aA(C),allPointsOccluded:!P}}}class Yt{constructor(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class Kt{constructor(t,e,n,i,r){this.text=new Yt(t?t.text:null,e,n,r),this.icon=new Yt(t?t.icon:null,e,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jt{constructor(t,e,n){this.text=t,this.icon=e,this.skipFade=n}}class $t{constructor(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class Qt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function te(t,n,i,r,a){const{horizontalAlign:o,verticalAlign:s}=e.aH(t);return new e.P(-(o-.5)*n+r[0]*a,-(s-.5)*i+r[1]*a)}class ee{constructor(t,e,n,i,r){this.transform=t.clone(),this.terrain=e,this.collisionIndex=new Xt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Qt(i),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const e=this.terrain;return e?(n,i)=>e.getElevation(t,n,i):null}getBucketParts(t,n,i,r){const a=i.getBucket(n),o=i.latestFeatureIndex;if(!a||!o||n.id!==a.layerIds[0])return;const s=i.collisionBoxArray,l=a.layers[0].layout,c=a.layers[0].paint,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/e.$,d=i.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=e.aC(i,1,this.transform.zoom),m=e.aD(this.collisionIndex.transform,i,c.get("text-translate"),c.get("text-translate-anchor")),g=e.aD(this.collisionIndex.transform,i,c.get("icon-translate"),c.get("icon-translate-anchor")),y=At(p,this.transform,f);this.retainedQueryData[a.bucketInstanceId]=new $t(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,i.tileID);const v={bucket:a,layout:l,translationText:m,translationIcon:g,unwrappedTileID:d,pitchedLabelPlaneMatrix:y,scale:u,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.an(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r)for(const e of a.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:v})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:v})}attemptAnchorPlacement(t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b){const x=e.aE[t.textAnchor],w=[t.textOffset0,t.textOffset1],S=te(x,i,r,w,a),M=this.collisionIndex.placeCollisionBox(n,d,l,c,u,s,o,g,h.predicate,_,S,b);if((!v||this.collisionIndex.placeCollisionBox(v,d,l,c,u,s,o,y,h.predicate,_,S,b).placeable)&&M.placeable){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(t=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:w,width:i,height:r,anchor:x,textBoxScale:a,prevAnchor:t},this.markUsedJustification(f,x,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:S,placedGlyphBoxes:M}}}placeLayerBucketPart(t,n,i){const{bucket:r,layout:a,translationText:o,translationIcon:s,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=t.parameters,m=a.get("text-optional"),g=a.get("icon-optional"),y=e.aF(a,"text-overlap","text-allow-overlap"),v="always"===y,_=e.aF(a,"icon-overlap","icon-allow-overlap"),b="always"===_,x="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),S="none"!==a.get("icon-text-fit"),M="viewport-y"===a.get("symbol-z-order"),T=v&&(b||!r.hasIconData()||g),A=b&&(v||!r.hasTextData()||m);!r.collisionArrays&&d&&r.deserializeCollisionBoxes(d);const E=this.retainedQueryData[r.bucketInstanceId].tileID,C=this._getTerrainElevationFunc(E),P=this.transform.getFastPathSimpleProjectionMatrix(E),I=(t,d,b)=>{var M,I;if(n[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new Jt(!1,!1,!1));let L=!1,k=!1,R=!0,D=null,N={box:null,placeable:!1,offscreen:null,occluded:!1},z={placeable:!1},F=null,O=null,B=null,U=0,j=0,V=0;d.textFeatureIndex?U=d.textFeatureIndex:t.useRuntimeCollisionCircles&&(U=t.featureIndex),d.verticalTextFeatureIndex&&(j=d.verticalTextFeatureIndex);const H=d.textBox;if(H){const n=n=>{let i=e.ao.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,i=e,this.markUsedOrientation(r,i,t))}return i},a=(n,i)=>{if(r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const t of r.writingModes)if(t===e.ao.vertical?(N=i(),z=N):N=n(),N&&N.placeable)break}else N=n()},c=t.textAnchorOffsetStartIndex,h=t.textAnchorOffsetEndIndex;if(h===c){const i=(e,n)=>{const i=this.collisionIndex.placeCollisionBox(e,y,u,E,l,w,x,o,f.predicate,C,void 0,P);return i&&i.placeable&&(this.markUsedOrientation(r,n,t),this.placedOrientations[t.crossTileID]=n),i};a(()=>i(H,e.ao.horizontal),()=>{const n=d.verticalTextBox;return r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?i(n,e.ao.vertical):{box:null,offscreen:null}}),n(N&&N.placeable)}else{let p=e.aE[null===(I=null===(M=this.prevPlacement)||void 0===M?void 0:M.variableOffsets[t.crossTileID])||void 0===I?void 0:I.anchor];const m=(e,n,a)=>{const d=e.x2-e.x1,m=e.y2-e.y1,g=t.textBoxScale,v=S&&"never"===_?n:null;let b=null,M="never"===y?1:2,T="never";p&&M++;for(let i=0;i<M;i++){for(let n=c;n<h;n++){const i=r.textAnchorOffsets.get(n);if(p&&i.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(i,e,d,m,g,x,w,u,E,l,f,T,t,r,a,o,s,v,C);if(c&&(b=c.placedGlyphBoxes,b&&b.placeable))return L=!0,D=c.shift,b}p?p=null:T=y}return i&&!b&&(b={box:this.collisionIndex.placeCollisionBox(H,"always",u,E,l,w,x,o,f.predicate,C,void 0,P).box,offscreen:!1,placeable:!1,occluded:!1}),b};a(()=>m(H,d.iconBox,e.ao.horizontal),()=>{const n=d.verticalTextBox;return r.allowVerticalPlacement&&(!N||!N.placeable)&&t.numVerticalGlyphVertices>0&&n?m(n,d.verticalIconBox,e.ao.vertical):{box:null,occluded:!0,offscreen:null}}),N&&(L=N.placeable,R=N.offscreen);const g=n(N&&N.placeable);if(!L&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(r,e.anchor,t,g))}}}if(F=N,L=F&&F.placeable,R=F&&F.offscreen,t.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),s=e.ap(r.textSizeData,p,n),u=a.get("text-padding");O=this.collisionIndex.placeCollisionCircles(y,n,r.lineVertexArray,r.glyphOffsetArray,s,l,c,i,w,f.predicate,t.collisionCircleDiameter,u,o,C),O.circles.length&&O.collisionDetected&&!i&&e.w("Collisions detected, but collision boxes are not shown"),L=v||O.circles.length>0&&!O.collisionDetected,R=R&&O.offscreen}if(d.iconFeatureIndex&&(V=d.iconFeatureIndex),d.iconBox){const t=t=>this.collisionIndex.placeCollisionBox(t,_,u,E,l,w,x,s,f.predicate,C,S&&D?D:void 0,P);z&&z.placeable&&d.verticalIconBox?(B=t(d.verticalIconBox),k=B.placeable):(B=t(d.iconBox),k=B.placeable),R=R&&B.offscreen}const G=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,W=g||0===t.numIconVertices;G||W?W?G||(k=k&&L):L=k&&L:k=L=k&&L;const q=k&&B.placeable;if(L&&F.placeable&&this.collisionIndex.insertCollisionBox(F.box,y,a.get("text-ignore-placement"),r.bucketInstanceId,z&&z.placeable&&j?j:U,f.ID),q&&this.collisionIndex.insertCollisionBox(B.box,_,a.get("icon-ignore-placement"),r.bucketInstanceId,V,f.ID),O&&L&&this.collisionIndex.insertCollisionCircles(O.circles,y,a.get("text-ignore-placement"),r.bucketInstanceId,U,f.ID),i&&this.storeCollisionData(r.bucketInstanceId,b,d,F,B,O),0===t.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===r.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[t.crossTileID]=new Jt((L||T)&&!(null==F?void 0:F.occluded),(k||A)&&!(null==B?void 0:B.occluded),R||r.justReloaded),n[t.crossTileID]=!0};if(M){if(0!==t.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const e=r.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let t=e.length-1;t>=0;--t){const n=e[t];I(r.symbolInstances.get(n),r.collisionArrays[n],n)}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)I(r.symbolInstances.get(e),r.collisionArrays[e],e);r.justReloaded=!1}storeCollisionData(t,e,n,i,r,a){if(n.textBox||n.iconBox){let a,o;this.collisionBoxArrays.has(t)?a=this.collisionBoxArrays.get(t):(a=new Map,this.collisionBoxArrays.set(t,a)),a.has(e)?o=a.get(e):(o={text:null,icon:null},a.set(e,o)),n.textBox&&(o.text=i.box),n.iconBox&&(o.icon=r.box)}if(a){let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=[]);for(let t=0;t<a.circles.length;t+=4)e.push(a.circles[t+0]-Zt),e.push(a.circles[t+1]-Zt),e.push(a.circles[t+2]),e.push(a.collisionDetected?1:0)}}markUsedJustification(t,n,i,r){let a;a=r===e.ao.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[e.aG(n)];const o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const e of o)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=a>=0&&e!==a?0:i.crossTileID)}markUsedOrientation(t,n,i){const r=n===e.ao.horizontal||n===e.ao.horizontalOnly?n:0,a=n===e.ao.vertical?n:0,o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const e of o)t.text.placedSymbolArray.get(e).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const i=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},a=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(const s in this.placements){const t=this.placements[s],e=r[s];e?(this.opacities[s]=new Kt(e,i,t.text,t.icon),n=n||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[s]=new Kt(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const s in r){const t=r[s];if(!this.opacities[s]){const e=new Kt(t,i,!1,!1);e.isHidden()||(this.opacities[s]=e,n=n||t.text.placed||t.icon.placed)}}for(const s in a)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=a[s]);for(const s in o)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=o[s]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const n={};for(const i of e){const e=i.getBucket(t);e&&i.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i.tileID,n,i.collisionBoxArray)}}updateBucketOpacities(t,n,i,r){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const a=t.layers[0],o=a.layout,s=new Kt(null,0,!1,!1,!0),l=o.get("text-allow-overlap"),c=o.get("icon-allow-overlap"),u=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===o.get("text-rotation-alignment"),d="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),f=new Kt(null,0,l&&(c||!t.hasIconData()||o.get("icon-optional")),c&&(l||!t.hasTextData()||o.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const m=(t,e,n)=>{for(let i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(n);t.hasVisibleVertices=t.hasVisibleVertices||n!==he},g=this.collisionBoxArrays.get(t.bucketInstanceId);for(let y=0;y<t.symbolInstances.length;y++){const n=t.symbolInstances.get(y),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:a,crossTileID:o}=n;let l=this.opacities[o];i[o]?l=s:l||(l=f,this.opacities[o]=l),i[o]=!0;const c=n.numIconVertices>0,v=this.placedOrientations[n.crossTileID],_=v===e.ao.vertical,b=v===e.ao.horizontal||v===e.ao.horizontalOnly;if(r>0||a>0){const e=ue(l.text);m(t.text,r,_?he:e),m(t.text,a,b?he:e);const i=l.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||_?1:0)}),n.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||b?1:0);const o=this.variableOffsets[n.crossTileID];o&&this.markUsedJustification(t,o.anchor,n,v);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(t,"left",n,s),this.markUsedOrientation(t,s,n))}if(c){const e=ue(l.icon),i=!(p&&n.verticalPlacedIconSymbolIndex&&_);n.placedIconSymbolIndex>=0&&(m(t.icon,n.numIconVertices,i?e:he),t.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=l.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(m(t.icon,n.numVerticalIconVertices,i?he:e),t.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=l.icon.isHidden())}const x=g&&g.has(y)?g.get(y):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[y];if(n){let i=new e.P(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(u){const t=this.variableOffsets[o];t?(i=te(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),h&&i._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):e=!1}if(n.textBox||n.verticalTextBox){let r;n.textBox&&(r=_),n.verticalTextBox&&(r=b),ne(t.textCollisionBox.collisionVertexArray,l.text.placed,!e||r,x.text,i.x,i.y)}}if(n.iconBox||n.verticalIconBox){const e=Boolean(!b&&n.verticalIconBox);let r;n.iconBox&&(r=e),n.verticalIconBox&&(r=!e),ne(t.iconCollisionBox.collisionVertexArray,l.icon.placed,r,x.icon,p?i.x:0,p?i.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error("bucket.text.opacityVertexArray.length (= ".concat(t.text.opacityVertexArray.length,") !== bucket.text.layoutVertexArray.length (= ").concat(t.text.layoutVertexArray.length,") / 4"));if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error("bucket.icon.opacityVertexArray.length (= ".concat(t.icon.opacityVertexArray.length,") !== bucket.icon.layoutVertexArray.length (= ").concat(t.icon.layoutVertexArray.length,") / 4"));t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function ne(t,e,n,i,r,a){i&&0!==i.length||(i=[0,0,0,0]);const o=i[0]-Zt,s=i[1]-Zt,l=i[2]-Zt,c=i[3]-Zt;t.emplaceBack(e?1:0,n?1:0,r||0,a||0,o,s),t.emplaceBack(e?1:0,n?1:0,r||0,a||0,l,s),t.emplaceBack(e?1:0,n?1:0,r||0,a||0,l,c),t.emplaceBack(e?1:0,n?1:0,r||0,a||0,o,c)}const ie=Math.pow(2,25),re=Math.pow(2,24),ae=Math.pow(2,17),oe=Math.pow(2,16),se=Math.pow(2,9),le=Math.pow(2,8),ce=Math.pow(2,1);function ue(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*ie+e*re+n*ae+e*oe+n*se+e*le+n*ce+e}const he=0;class de{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,n,i,r){const a=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(a,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<a.length;)if(e.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class pe{constructor(t,e,n,i,r,a,o,s){this.placement=new ee(t,e,a,o,s),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,e,n){const i=o.now(),r=()=>!this._forceFullPlacement&&o.now()-i>2;for(;this._currentPlacementIndex>=0;){const i=e[t[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=a)&&(!i.maxzoom||i.maxzoom>a)){if(this._inProgressLayer||(this._inProgressLayer=new de(i)),this._inProgressLayer.continuePlacement(n[i.source],this.placement,this._showCollisionBoxes,i,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const fe=512/e.$/2;class me{constructor(t,n,i){this.tileID=t,this.bucketInstanceId=i,this._symbolsByKey={};const r=new Map;for(let e=0;e<n.length;e++){const t=n.get(e),i=t.key,a=r.get(i);a?a.push(t):r.set(i,[t])}for(const[a,o]of r){const t={positions:o.map(t=>({x:Math.floor(t.anchorX*fe),y:Math.floor(t.anchorY*fe)})),crossTileIDs:o.map(t=>t.crossTileID)};if(t.positions.length>128){const n=new e.aI(t.positions.length,16,Uint16Array);for(const{x:e,y:i}of t.positions)n.add(e,i);n.finish(),delete t.positions,t.index=n}this._symbolsByKey[a]=t}}getScaledCoordinates(t,n){const{x:i,y:r,z:a}=this.tileID.canonical,{x:o,y:s,z:l}=n.canonical,c=fe/Math.pow(2,l-a),u=(s*e.$+t.anchorY)*c,h=r*e.$*fe;return{x:Math.floor((o*e.$+t.anchorX)*c-i*e.$*fe),y:Math.floor(u-h)}}findMatches(t,e,n){const i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const a=t.get(r);if(a.crossTileID)continue;const o=this._symbolsByKey[a.key];if(!o)continue;const s=this.getScaledCoordinates(a,e);if(o.index){const t=o.index.range(s.x-i,s.y-i,s.x+i,s.y+i).sort();for(const e of t){const t=o.crossTileIDs[e];if(!n[t]){n[t]=!0,a.crossTileID=t;break}}}else if(o.positions)for(let t=0;t<o.positions.length;t++){const e=o.positions[t],r=o.crossTileIDs[t];if(Math.abs(e.x-s.x)<=i&&Math.abs(e.y-s.y)<=i&&!n[r]){n[r]=!0,a.crossTileID=r;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(t=>{let{crossTileIDs:e}=t;return e})}}class ge{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ye{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const n in this.indexes){const t=this.indexes[n],i={};for(const n in t){const r=t[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=t}addBucket(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const i=this.usedCrossTileIDs[t.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>t.overscaledZ)for(const r in n){const a=n[r];a.tileID.isChildOf(t)&&a.findMatches(e.symbolInstances,t,i)}else{const a=n[t.scaledTo(Number(r)).key];a&&a.findMatches(e.symbolInstances,t,i)}}for(let r=0;r<e.symbolInstances.length;r++){const t=e.symbolInstances.get(r);t.crossTileID||(t.crossTileID=n.generate(),i[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new me(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const n of e.getCrossTileIDsLists())for(const e of n)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e}}class ve{constructor(){this.layerIndexes={},this.crossTileIDs=new ge,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,n){let i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new ye);let r=!1;const a={};i.handleWrapJump(n);for(const o of e){const e=o.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(o.tileID,e,this.crossTileIDs)&&(r=!0),a[e.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const n in this.layerIndexes)e[n]||delete this.layerIndexes[n]}}var _e="void main() {fragColor=vec4(1.0);}";const be={prelude:xe("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:xe("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:xe("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:xe("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:xe("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xe("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:xe(_e,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:xe("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:xe("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xe("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xe("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:xe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:xe("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:xe(_e,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:xe("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:xe("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:xe("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:xe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:xe("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:xe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:xe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xe("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:xe("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:xe("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:xe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:xe("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:xe("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:xe("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:xe("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:xe("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:xe("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:xe("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:xe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:xe("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:xe("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:xe("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function xe(t,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=e.match(/in ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(r):r,s={};return{fragmentSource:t=t.replace(n,(t,e,n,i,r)=>(s[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nin ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"))),vertexSource:e=e.replace(n,(t,e,n,i,r)=>{const a="float"===i?"vec2":"vec4",o=r.match(/color/)?"color":a;return s[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\nout ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(o,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define"===e?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(o,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")}),staticAttributes:i,staticUniforms:o}}class we{constructor(t,e,n){this.vertexBuffer=t,this.indexBuffer=e,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Se=e.aJ([{name:"a_pos",type:"Int16",components:2}]);const Me="#define PROJECTION_MERCATOR",Te="mercator";class Ae{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Te}get shaderDefine(){return Me}get shaderPreludeCode(){return be.projectionMercator}get vertexShaderPreludeCode(){return be.projectionMercator.vertexSource}get subdivisionGranularity(){return e.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,i,r,a){if(this._cachedMesh)return this._cachedMesh;const o=new e.aL;o.emplaceBack(0,0),o.emplaceBack(e.$,0),o.emplaceBack(0,e.$),o.emplaceBack(e.$,e.$);const s=t.createVertexBuffer(o,Se.members),l=e.aM.simpleSegment(0,0,4,2),c=new e.aN;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=t.createIndexBuffer(c);return this._cachedMesh=new we(s,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Ee{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.C.number(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.C.number(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.C.number(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.C.number(t.right,n.right,i)),this}getCenter(t,n){const i=e.ah((this.left+t-this.right)/2,0,t),r=e.ah((this.top+n-this.bottom)/2,0,n);return new e.P(i,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ee(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ce(t,e){if(!t.renderWorldCopies||t.lngRange)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}function Pe(t){return Math.max(0,Math.floor(t))}class Ie{constructor(t,n,i,r,a,o){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=void 0===o||!!o,this._minZoom=n||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==a?60:a,this.setMaxBounds(),this._width=0,this._height=0,this._center=new e.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Pe(this._zoom),this._scale=e.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ee,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,i){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Pe(this._zoom),this._scale=e.af(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Ee(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!i&&t.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=e.aO(t,-180,180)*Math.PI/180;var r,a,o,s,l,c,u,h,d;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=i(),r=this._rotationMatrix,o=-this._bearingInRadians,s=(a=this._rotationMatrix)[0],l=a[1],c=a[2],u=a[3],h=Math.sin(o),d=Math.cos(o),r[0]=s*d+c*h,r[1]=l*d+u*h,r[2]=s*-h+c*d,r[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=e.ah(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const e=t/180*Math.PI;this._rollInRadians!==e&&(this._unmodified=!1,this._rollInRadians=e,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return e.aP(this._fovInRadians)}setFov(t){t=e.ah(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=e.ae(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.getConstrained(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=e.af(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,e){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=e,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()}resize(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._width=t,this._height=e,n&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new H([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-e.ai,e.ai])}getConstrained(t,e){return this._callbacks.getConstrained(t,e)}getCameraQueryGeometry(t,n){if(1===n.length)return[n[0],t];{const{minX:i,minY:r,maxX:a,maxY:o}=e.a2.fromPoints(n).extend(t);return[new e.P(i,r),new e.P(a,r),new e.P(a,o),new e.P(i,o),new e.P(i,r)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:n}=this.getConstrained(this.center,this.zoom);this.setCenter(e),this.setZoom(n),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=e.ag(new Float64Array(16));e.N(t,t,[this._width/2,-this._height/2,1]),e.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=e.ag(new Float64Array(16)),e.N(t,t,[1,-1,1]),e.M(t,t,[-1,-1,0]),e.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,i,r){const a=void 0!==i?i:this.bearing,o=r=void 0!==r?r:this.pitch,s=e.a1.fromLngLat(t,n),l=-Math.cos(e.ae(o)),c=Math.sin(e.ae(o)),u=c*Math.sin(e.ae(a)),h=-c*Math.cos(e.ae(a));let d=this.elevation;const p=n-d;let f;l*p>=0||Math.abs(l)<.1?(f=1e4,d=n+f*l):f=-p/l;let m,g,y=e.aQ(1,s.y),v=0;do{if(v+=1,v>10)break;g=f/y,m=new e.a1(s.x+u*g,s.y+h*g),y=1/m.meterInMercatorCoordinateUnits()}while(Math.abs(f-g*y)>1e-12);return{center:m.toLngLat(),elevation:d,zoom:e.ak(this.height/2/Math.tan(this.fovInRadians/2)/g/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=e.aj(1,this.center.lat)*this.worldSize,i=this.cameraToCenterDistance/n,r=e.a1.fromLngLat(this.center,this.elevation),a=dt(this.center,this.elevation,this.pitch,this.bearing,i);this._elevation=t;const o=this.calculateCenterFromCameraLngLatAlt(a.toLngLat(),e.aQ(a.z,r.y),this.bearing,this.pitch);this._elevation=o.elevation,this._center=o.center,this.setZoom(o.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=e.aj(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/e.$,1/n/e.$]}}class Le{constructor(t,n){this.min=t,this.max=n,this.center=e.aR([],e.aS([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],i=e.aT(this.min),r=e.aT(this.max);for(let e=0;e<n.length;e++)i[e]=n[e]?this.min[e]:this.center[e],r[e]=n[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Le(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let e=!0;for(let n=0;n<t.planes.length;n++){const i=this.intersectsPlane(t.planes[n]);if(0===i)return 0;1===i&&(e=!1)}return e?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let e=t[3],n=t[3];for(let i=0;i<3;i++)t[i]>0?(e+=t[i]*this.min[i],n+=t[i]*this.max[i]):(n+=t[i]*this.min[i],e+=t[i]*this.max[i]);return e>=0?2:n<0?0:1}}class ke{distanceToTile2d(t,e,n,i){const r=i.distanceX([t,e]),a=i.distanceY([t,e]);return Math.hypot(r,a)}getWrap(t,e,n){return n}getTileBoundingVolume(t,n,i,r){var a,o;let s=0,l=0;if(null==r?void 0:r.terrain){const c=new e.Z(t.z,n,t.z,t.x,t.y),u=r.terrain.getMinMaxElevation(c);s=null!==(a=u.minElevation)&&void 0!==a?a:Math.min(0,i),l=null!==(o=u.maxElevation)&&void 0!==o?o:Math.max(0,i)}const c=1<<t.z;return new Le([n+t.x/c,t.y/c,s],[n+(t.x+1)/c,(t.y+1)/c,l])}allowVariableZoom(t,n){const i=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,r=e.ah(78.5-i/2,0,60);return!!n.terrain||t.pitch>r}allowWorldCopies(){return!0}prepareNextFrame(){}}class Re{constructor(t,e,n){this.points=t,this.planes=e,this.aabb=n}static fromInvProjectionMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;const o=a?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],s=Math.pow(2,i),l=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(i=>function(t,n,i,r){const a=e.aw([],t,n),o=1/a[3]/i*r;return e.aY(a,a,[o,o,1/a[3],o])}(i,t,n,s));r&&function(t,n,i,r){const a=r?4:0,o=r?0:4;let s=0;const l=[],c=[];for(let d=0;d<4;d++){const n=e.aU([],t[d+o],t[d+a]),i=e.aZ(n);e.aR(n,n,1/i),l.push(i),c.push(n)}for(let d=0;d<4;d++){const n=e.a_(t[d+a],c[d],i);s=null!==n&&n>=0?Math.max(s,n):Math.max(s,l[d])}const u=function(t,n){const i=e.aU([],t[n[0]],t[n[1]]),r=e.aU([],t[n[2]],t[n[1]]),a=[0,0,0,0];return e.aV(a,e.aW([],i,r)),a[3]=-e.aX(a,t[n[0]]),a}(t,n),h=function(t,n){const i=e.a$(t),r=e.b0([],t,1/i),a=e.aU([],n,e.aR([],r,e.aX(n,r))),o=e.a$(a);if(o>0){const t=Math.sqrt(1-r[3]*r[3]),i=e.aR([],r,-r[3]),s=e.aS([],i,e.aR([],a,t/o));return e.b1(n,s)}return null}(i,u);if(null!==h){const t=h/e.aX(c[0],u);s=Math.min(s,t)}for(let e=0;e<4;e++){const n=Math.min(s,l[e]);t[e+o]=[t[e+a][0]+c[e][0]*n,t[e+a][1]+c[e][1]*n,t[e+a][2]+c[e][2]*n,1]}}(l,o[0],r,a);const c=o.map(t=>{const n=e.aU([],l[t[0]],l[t[1]]),i=e.aU([],l[t[2]],l[t[1]]),r=e.aV([],e.aW([],n,i)),a=-e.aX(r,l[t[1]]);return r.concat(a)}),u=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],h=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of l)for(let t=0;t<3;t++)u[t]=Math.min(u[t],e[t]),h[t]=Math.max(h[t],e[t]);return new Re(l,c,new Le(u,h))}}class De{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,n){return this._helper.interpolatePadding(t,e,n)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._helper.resize(t,e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,e){}constructor(t,e,n,i,r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ie({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)},t,e,n,i,r),this._coveringTilesDetailsProvider=new ke}clone(){const t=new De;return t.apply(this),t}apply(t,e,n){this._helper.apply(t,e,n)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new e.b2(0,t)];if(this._helper._renderWorldCopies){const i=this.screenPointToMercatorCoordinate(new e.P(0,0)),r=this.screenPointToMercatorCoordinate(new e.P(this._helper._width,0)),a=this.screenPointToMercatorCoordinate(new e.P(this._helper._width,this._helper._height)),o=this.screenPointToMercatorCoordinate(new e.P(0,this._helper._height)),s=Math.floor(Math.min(i.x,r.x,a.x,o.x)),l=Math.floor(Math.max(i.x,r.x,a.x,o.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&n.push(new e.b2(u,t))}return n}getCameraFrustum(){return Re.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const e=this.screenPointToLocation(this.centerPoint,t),n=t?t.getElevationForLngLatZoom(e,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(n)}setLocationAtPoint(t,n){const i=e.aj(this.elevation,this.center.lat),r=this.screenPointToMercatorCoordinateAtZ(n,i),a=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,i),o=e.a1.fromLngLat(t),s=new e.a1(o.x-(r.x-a.x),o.y-(r.y-a.y));this.setCenter(null==s?void 0:s.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(e.a1.fromLngLat(t),n.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(e.a1.fromLngLat(t))}screenPointToLocation(t,e){var n;return null===(n=this.screenPointToMercatorCoordinate(t,e))||void 0===n?void 0:n.toLngLat()}screenPointToMercatorCoordinate(t,e){if(e){const n=e.pointCoordinate(t);if(null!=n)return n}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const i=n||0,r=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.aw(r,r,this._pixelMatrixInverse),e.aw(a,a,this._pixelMatrixInverse);const o=r[3],s=a[3],l=r[1]/o,c=a[1]/s,u=r[2]/o,h=a[2]/s,d=u===h?0:(i-u)/(h-u);return new e.a1(e.C.number(r[0]/o,a[0]/s,d)/this.worldSize,e.C.number(l,c,d)/this.worldSize,i)}coordinatePoint(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._pixelMatrix;const r=[t.x*this.worldSize,t.y*this.worldSize,n,1];return e.aw(r,r,i),new e.P(r[0]/r[3],r[1]/r[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ut(this));return(new H).extend(this.screenPointToLocation(new e.P(0,t))).extend(this.screenPointToLocation(new e.P(this._helper._width,t))).extend(this.screenPointToLocation(new e.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new e.P(0,this._helper._height)))}isPointOnMapSurface(t,e){return e?null!=e.pointCoordinate(t):t.y>this.height/2-ut(this)}calculatePosMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;var r;const a=null!==(r=t.key)&&void 0!==r?r:e.b3(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),o=n?this._alignedPosMatrixCache:this._posMatrixCache;if(o.has(a)){const t=o.get(a);return i?t.f32:t.f64}const s=ht(t,this.worldSize);e.O(s,n?this._alignedProjMatrix:this._viewProjMatrix,s);const l={f64:s,f32:new Float32Array(s)};return o.set(a,l),i?l.f32:l.f64}calculateFogMatrix(t){const n=t.key,i=this._fogMatrixCacheF32;if(i.has(n))return i.get(n);const r=ht(t,this.worldSize);return e.O(r,this._fogMatrix,r),i.set(n,new Float32Array(r)),i.get(n)}getConstrained(t,n){n=e.ah(+n,this.minZoom,this.maxZoom);const i={center:new e.S(t.lng,t.lat),zoom:n};let r=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===r){const t=180-1e-10;r=[-t,t]}const a=this.tileSize*e.af(i.zoom);let o=0,s=a,l=0,c=a,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const t=this._helper._latRange;o=e.U(t[1])*a,s=e.U(t[0])*a,s-o<p&&(u=p/(s-o))}r&&(l=e.aO(e.V(r[0])*a,0,a),c=e.aO(e.V(r[1])*a,0,a),c<l&&(c+=a),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=lt(a,t);let g,y;const v=Math.max(h||0,u||0);if(v){const t=new e.P(h?(c+l)/2:f,u?(s+o)/2:m);return i.center=ct(a,t).wrap(),i.zoom+=e.ak(v),i}if(this._helper._latRange){const t=p/2;m-t<o&&(y=o+t),m+t>s&&(y=s-t)}if(r){const t=(l+c)/2;let n=f;this._helper._renderWorldCopies&&(n=e.aO(f,t-a/2,t+a/2));const i=d/2;n-i<l&&(g=l+i),n+i>c&&(g=c-i)}if(void 0!==g||void 0!==y){const t=new e.P(null!=g?g:f,null!=y?y:m);i.center=ct(a,t).wrap()}return i}calculateCenterFromCameraLngLatAlt(t,e,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,n,i)}_calculateNearFarZIfNeeded(t,n,i){if(!this._helper.autoCalculateNearFarZ)return;const r=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),a=t-r*this._helper._pixelPerMeter/Math.cos(n),o=r<0?a:t,s=Math.PI/2+this.pitchInRadians,l=e.ae(this.fov)*(Math.abs(Math.cos(e.ae(this.roll)))*this.height+Math.abs(Math.sin(e.ae(this.roll)))*this.width)/this.height*(.5+i.y/this.height),c=Math.sin(l)*o/Math.sin(e.ah(Math.PI-s-l,.01,Math.PI-.01)),u=ut(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=e.ae(.75),p=h>d?2*h*(.5+i.y/(2*u)):d,f=Math.sin(p)*o/Math.sin(e.ah(Math.PI-s-p,.01,Math.PI-.01)),m=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*m+o),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=lt(this.worldSize,this.center),i=n.x,r=n.y;this._helper._pixelPerMeter=e.aj(1,this.center.lat)*this.worldSize;const a=e.ae(Math.min(this.pitch,st)),o=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(a));let s;this._calculateNearFarZIfNeeded(o,a,t),s=new Float64Array(16),e.b4(s,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),e.aq(this._invProjMatrix,s),s[8]=2*-t.x/this._helper._width,s[9]=2*t.y/this._helper._height,this._projectionMatrix=e.b5(s),e.N(s,s,[1,-1,1]),e.M(s,s,[0,0,-this._helper.cameraToCenterDistance]),e.b6(s,s,-this.rollInRadians),e.b7(s,s,this.pitchInRadians),e.b6(s,s,-this.bearingInRadians),e.M(s,s,[-i,-r,0]),this._mercatorMatrix=e.N([],s,[this.worldSize,this.worldSize,this.worldSize]),e.N(s,s,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=e.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,s),e.M(s,s,[0,0,-this.elevation]),this._viewProjMatrix=s,this._invViewProjMatrix=e.aq([],s);const l=[0,0,-1,1];e.aw(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),e.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,o,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,e.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),e.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),e.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),e.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),e.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),e.M(this._fogMatrix,this._fogMatrix,[-i,-r,0]),e.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),e.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=e.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,s);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=i-Math.round(i)+h*c+d*u,f=r-Math.round(r)+h*u+d*c,m=new Float64Array(s);if(e.M(m,m,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=m,s=e.aq(new Float64Array(16),this._pixelMatrix),!s)throw new Error("failed to invert matrix");this._pixelMatrixInverse=s,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new e.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.aw(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=e.aj(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const i=e.a1.fromLngLat(t),r=[i.x*this.worldSize,i.y*this.worldSize,n,1];return e.aw(r,r,this._viewProjMatrix),r[2]/r[3]}getProjectionData(t){const{overscaledTileID:n,aligned:i,applyTerrainMatrix:r}=t,a=this._helper.getMercatorTileCoordinates(n),o=n?this.calculatePosMatrix(n,i,!0):null;let s;return s=n&&n.terrainRttPosMatrix32f&&r?n.terrainRttPosMatrix32f:o||e.b8(),{mainMatrix:s,tileMercatorCoords:a,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:s}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,e,n){return 1}transformLightDirection(t){return e.aT(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,i,r){const a=this.calculatePosMatrix(i);let o;r?(o=[t,n,r(t,n),1],e.aw(o,o,a)):(o=[t,n,0,1],qt(o,o,a));const s=o[3];return{point:new e.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}populateCache(t){for(const e of t)this.calculatePosMatrix(e)}getMatrixForModel(t,n){const i=e.a1.fromLngLat(t,n),r=i.meterInMercatorCoordinateUnits(),a=e.b9();return e.M(a,a,[i.x,i.y,i.z]),e.b6(a,a,Math.PI),e.b7(a,a,Math.PI/2),e.N(a,a,[-r,r,r]),a}getProjectionDataForCustomLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=new e.Z(0,0,0,0,0),i=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),r=ht(n,this.worldSize);e.O(r,this._viewProjMatrix,r),i.tileMercatorCoords=[0,0,1,1];const a=[e.$,e.$,this.worldSize/this._helper.pixelsPerMeter],o=e.ba();return e.N(o,r,a),i.fallbackMatrix=o,i.mainMatrix=o,i}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Ne(){e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ze(t){if(t.useSlerp)if(t.k<1){const n=e.bb(t.startEulerAngles.roll,t.startEulerAngles.pitch,t.startEulerAngles.bearing),i=e.bb(t.endEulerAngles.roll,t.endEulerAngles.pitch,t.endEulerAngles.bearing),r=new Float64Array(4);e.bc(r,n,i,t.k);const a=e.bd(r);t.tr.setRoll(a.roll),t.tr.setPitch(a.pitch),t.tr.setBearing(a.bearing)}else t.tr.setRoll(t.endEulerAngles.roll),t.tr.setPitch(t.endEulerAngles.pitch),t.tr.setBearing(t.endEulerAngles.bearing);else t.tr.setRoll(e.C.number(t.startEulerAngles.roll,t.endEulerAngles.roll,t.k)),t.tr.setPitch(e.C.number(t.startEulerAngles.pitch,t.endEulerAngles.pitch,t.k)),t.tr.setBearing(e.C.number(t.startEulerAngles.bearing,t.endEulerAngles.bearing,t.k))}function Fe(t,n,i,r,a){const o=a.padding,s=lt(a.worldSize,i.getNorthWest()),l=lt(a.worldSize,i.getNorthEast()),c=lt(a.worldSize,i.getSouthEast()),u=lt(a.worldSize,i.getSouthWest()),h=e.ae(-r),d=s.rotate(h),p=l.rotate(h),f=c.rotate(h),m=u.rotate(h),g=new e.P(Math.max(d.x,p.x,m.x,f.x),Math.max(d.y,p.y,m.y,f.y)),y=new e.P(Math.min(d.x,p.x,m.x,f.x),Math.min(d.y,p.y,m.y,f.y)),v=g.sub(y),_=(a.width-(o.left+o.right+n.left+n.right))/v.x,b=(a.height-(o.top+o.bottom+n.top+n.bottom))/v.y;if(b<0||_<0)return void Ne();const x=Math.min(e.ak(a.scale*Math.min(_,b)),t.maxZoom),w=e.P.convert(t.offset),S=new e.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(e.ae(r)),M=w.add(S).mult(a.scale/e.af(x));return{center:ct(a.worldSize,s.add(c).div(2).sub(M)),zoom:x,bearing:r}}class Oe{get useGlobeControls(){return!1}handlePanInertia(t,e){return{easingOffset:t,easingCenter:e.center}}handleMapControlsRollPitchBearingZoom(t,e){t.bearingDelta&&e.setBearing(e.bearing+t.bearingDelta),t.pitchDelta&&e.setPitch(e.pitch+t.pitchDelta),t.rollDelta&&e.setRoll(e.roll+t.rollDelta),t.zoomDelta&&e.setZoom(e.zoom+t.zoomDelta)}handleMapControlsPan(t,e,n){t.around.distSqr(e.centerPoint)<.01||e.setLocationAtPoint(n,t.around)}cameraForBoxAndBearing(t,e,n,i,r){return Fe(t,e,n,i,r)}handleJumpToCenterZoom(t,n){t.zoom!==(void 0!==n.zoom?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),void 0!==n.center&&t.setCenter(e.S.convert(n.center))}handleEaseTo(t,n){const i=t.zoom,r=t.padding,a={roll:t.roll,pitch:t.pitch,bearing:t.bearing},o={roll:void 0===n.roll?t.roll:n.roll,pitch:void 0===n.pitch?t.pitch:n.pitch,bearing:void 0===n.bearing?t.bearing:n.bearing},s=void 0!==n.zoom,l=!t.isPaddingEqual(n.padding);let c=!1;const u=s?+n.zoom:t.zoom;let h=t.centerPoint.add(n.offsetAsPoint);const d=t.screenPointToLocation(h),{center:p,zoom:f}=t.getConstrained(e.S.convert(n.center||d),null!=u?u:i);Ce(t,p);const m=lt(t.worldSize,d),g=lt(t.worldSize,p).sub(m),y=e.af(f-i);return c=f!==i,{easeFunc:s=>{if(c&&t.setZoom(e.C.number(i,f,s)),e.be(a,o)||ze({startEulerAngles:a,endEulerAngles:o,tr:t,k:s,useSlerp:a.roll!=o.roll}),l&&(t.interpolatePadding(r,n.padding,s),h=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const n=e.af(t.zoom-i),r=f>i?Math.min(2,y):Math.max(.5,y),a=Math.pow(r,1-s),o=ct(t.worldSize,m.add(g.mult(s*a)).mult(n));t.setLocationAtPoint(t.renderWorldCopies?o.wrap():o,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(t,n){const i=void 0!==n.zoom,r=t.zoom,a=t.getConstrained(e.S.convert(n.center||n.locationAtOffset),i?+n.zoom:r),o=a.center,s=a.zoom;Ce(t,o);const l=lt(t.worldSize,n.locationAtOffset),c=lt(t.worldSize,o).sub(l),u=c.mag(),h=e.af(s-r);let d;if(void 0!==n.minZoom){const i=Math.min(+n.minZoom,r,s),a=t.getConstrained(o,i).zoom;d=e.af(a-r)}return{easeFunc:(n,i,a,u)=>{t.setZoom(1===n?s:r+e.ak(i));const h=1===n?o:ct(t.worldSize,l.add(c.mult(a)).mult(i));t.setLocationAtPoint(t.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:o,scaleOfMinZoom:d,pixelPathLength:u}}}class Be{constructor(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}}Be.Replace=[1,0],Be.disabled=new Be(Be.Replace,e.bf.transparent,[!1,!1,!1,!1]),Be.unblended=new Be(Be.Replace,e.bf.transparent,[!0,!0,!0,!0]),Be.alphaBlended=new Be([1,771],e.bf.transparent,[!0,!0,!0,!0]);const Ue=2305;class je{constructor(t,e,n){this.enable=t,this.mode=e,this.frontFace=n}}je.disabled=new je(!1,1029,Ue),je.backCCW=new je(!0,1029,Ue),je.frontCCW=new je(!0,1028,Ue);class Ve{constructor(t,e,n){this.func=t,this.mask=e,this.range=n}}Ve.ReadOnly=!1,Ve.ReadWrite=!0,Ve.disabled=new Ve(519,Ve.ReadOnly,[0,1]);const He=7680;class Ge{constructor(t,e,n,i,r,a){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=a}}Ge.disabled=new Ge({func:519,mask:0},0,0,He,He,He);const We=new WeakMap;function qe(t){var e;if(We.has(t))return We.get(t);{const n=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return We.set(t,n),n}}class Ze{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,i=n.gl;this._texFormat=i.RGBA,this._texType=i.UNSIGNED_BYTE;const r=new e.aL;r.emplaceBack(-1,-1),r.emplaceBack(2,-1),r.emplaceBack(-1,2);const a=new e.aN;a.emplaceBack(0,1,2),this._fullscreenTriangle=new we(n.createVertexBuffer(r,Se.members),n.createIndexBuffer(a),e.aM.simpleSegment(0,0,r.length,a.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(i.TEXTURE1);const o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(o),qe(i)&&(this._pbo=i.createBuffer(),i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.bufferData(i.PIXEL_PACK_BUFFER,4,i.STREAM_READ),i.bindBuffer(i.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,e){const n=this._updateCount;return this._readbackQueue?n>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():n>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,e),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,e=t.gl;t.activeTexture.set(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const i=this._cachedRenderContext.context,r=i.gl;if(this._bindFramebuffer(),i.viewport.set([0,0,this._texWidth,this._texHeight]),i.clear({color:e.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(i,r.TRIANGLES,Ve.disabled,Ge.disabled,Be.unblended,je.disabled,((t,e)=>({u_input:t,u_output_expected:e}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&qe(r)){r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null);const t=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);r.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:t}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&qe(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return e.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ze._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let e=0;return e+=t[0]/256,e+=t[1]/65536,e+=t[2]/16777216,t[3]<127&&(e=-e),e/128}}const Xe=e.$/128;function Ye(t,n){const i=void 0!==t.granularity?Math.max(t.granularity,1):1,r=i+(t.generateBorders?2:0),a=i+(t.extendToNorthPole||t.generateBorders?1:0)+(t.extendToSouthPole||t.generateBorders?1:0),o=r+1,s=a+1,l=t.generateBorders?-1:0,c=t.generateBorders||t.extendToNorthPole?-1:0,u=i+(t.generateBorders?1:0),h=i+(t.generateBorders||t.extendToSouthPole?1:0),d=o*s,p=r*a*6,f=o*s>65536;if(f&&"16bit"===n)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const m=f||"32bit"===n,g=new Int16Array(2*d);let y=0;for(let b=c;b<=h;b++)for(let n=l;n<=u;n++){let r=n/i*e.$;-1===n&&(r=-Xe),n===i+1&&(r=e.$+Xe);let a=b/i*e.$;-1===b&&(a=t.extendToNorthPole?e.bh:-Xe),b===i+1&&(a=t.extendToSouthPole?e.bi:e.$+Xe),g[y++]=r,g[y++]=a}const v=m?new Uint32Array(p):new Uint16Array(p);let _=0;for(let e=0;e<a;e++)for(let t=0;t<r;t++){const n=t+1+e*o,i=t+(e+1)*o,r=t+1+(e+1)*o;v[_++]=t+e*o,v[_++]=i,v[_++]=n,v[_++]=n,v[_++]=i,v[_++]=r}return{vertices:g.buffer.slice(0),indices:v.buffer.slice(0),uses32bitIndices:m}}const Ke=new e.aK({fill:new e.bj(128,2),line:new e.bj(512,0),tile:new e.bj(128,32),stencil:new e.bj(128,1),circle:3});class Je{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return be.projectionGlobe}get vertexShaderPreludeCode(){return be.projectionMercator.vertexSource}get subdivisionGranularity(){return Ke}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Ze(t));const n=e.U(this._errorQueryLatitudeDegrees),i=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,r=this._errorMeasurement.updateErrorLoop(n,i),a=o.now();r!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=r,this._errorMeasurementLastChangeTime=a);const s=Math.min(Math.max((a-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=e.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,e.bl(s))}_getMeshKey(t){return"".concat(t.granularity.toString(36),"_").concat(t.generateBorders?"b":"").concat(t.extendToNorthPole?"n":"").concat(t.extendToSouthPole?"s":"")}getMeshFromTileID(t,e,n,i,r){const a=("stencil"===r?Ke.stencil:Ke.tile).getGranularityForZoomLevel(e.z);return this._getMesh(t,{granularity:a,generateBorders:n,extendToNorthPole:0===e.y&&i,extendToSouthPole:e.y===(1<<e.z)-1&&i})}_getMesh(t,n){const i=this._getMeshKey(n);if(i in this._tileMeshCache)return this._tileMeshCache[i];const r=function(t,n){const i=Ye(n,"16bit"),r=e.aL.deserialize({arrayBuffer:i.vertices,length:i.vertices.byteLength/2/2}),a=e.aN.deserialize({arrayBuffer:i.indices,length:i.indices.byteLength/2/3});return new we(t.createVertexBuffer(r,Se.members),t.createIndexBuffer(a),e.aM.simpleSegment(0,0,r.length,a.length))}(t,n);return this._tileMeshCache[i]=r,r}recalculate(t){}hasTransition(){const t=o.now();let e=!1;return e=e||(t-this._errorMeasurementLastChangeTime)/1e3<.7,e=e||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,e}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const $e=new e.r({type:new e.D(e.v.projection.type)});class Qe extends e.E{constructor(t){super(),this._transitionable=new e.t($e),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.F(0)),this._mercatorProjection=new Ae,this._verticalPerspectiveProjection=new Je}get transitionState(){const t=this.properties.get("type");if("string"==typeof t&&"mercator"===t)return 0;if("string"==typeof t&&"vertical-perspective"===t)return 1;if(t instanceof e.bm){if("vertical-perspective"===t.from&&"mercator"===t.to)return 1-t.transition;if("mercator"===t.from&&"vertical-perspective"===t.to)return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,e,n,i,r){return this.currentProjection.getMeshFromTileID(t,e,n,i,r)}setProjection(t){this._transitionable.setValue("type",(null==t?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function tn(t){const e=rn(t.worldSize,t.center.lat);return 2*Math.PI*e}function en(t,n,i,r,a){const o=1/(1<<a),s=n/e.$*o+r*o,l=e.bo((t/e.$*o+i*o)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function nn(t){return function(t,e){const n=Math.cos(e),i=new Float64Array(3);return i[0]=Math.sin(t)*n,i[1]=Math.sin(e),i[2]=Math.cos(t)*n,i}(t.lng*Math.PI/180,t.lat*Math.PI/180)}function rn(t,e){return t/(2*Math.PI)/Math.cos(e*Math.PI/180)}function an(t){const n=Math.asin(t[1])/Math.PI*180,i=Math.sqrt(t[0]*t[0]+t[2]*t[2]);if(i>1e-6){const r=t[0]/i,a=Math.acos(t[2]/i),o=(r>0?a:-a)/Math.PI*180;return new e.S(e.aO(o,-180,180),n)}return new e.S(0,n)}function on(t){return Math.cos(t*Math.PI/180)}function sn(t,n){const i=on(t),r=on(n);return e.ak(r/i)}function ln(t,n){const i=t.rotate(n.bearingInRadians),r=n.zoom+sn(n.center.lat,0),a=e.bk(1/on(n.center.lat),1/on(Math.min(Math.abs(n.center.lat),60)),e.bn(r,7,3,0,1)),o=360/tn({worldSize:n.worldSize,center:{lat:n.center.lat}});return new e.S(n.center.lng-i.x*o*a,e.ah(n.center.lat+i.y*o,-e.ai,e.ai))}function cn(t){const e=.5*t,n=Math.sin(e),i=Math.cos(e);return Math.log(n+i)-Math.log(i-n)}function un(t,n,i,r){const a=t.lat+i*r;if(Math.abs(i)>1){const o=(Math.sign(t.lat+i)!==Math.sign(t.lat)?-Math.abs(t.lat):Math.abs(t.lat))*Math.PI/180,s=Math.abs(t.lat+i)*Math.PI/180,l=cn(o+r*(s-o)),c=cn(o),u=cn(s);return new e.S(t.lng+n*((l-c)/(u-c)),a)}return new e.S(t.lng+n*r,a)}class hn{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,e,n,i){const r="".concat(t.z,"_").concat(t.x,"_").concat(t.y,"_").concat((null==i?void 0:i.terrain)?"t":""),a=this._cache.get(r);if(a)return a;const o=this._cachePrevious.get(r);if(o)return this._cache.set(r,o),o;const s=this._boundingVolumeFactory(t,e,n,i);return this._cache.set(r,s),this._hadAnyChanges=!0,s}}class dn{constructor(t,e,n,i){this.min=n,this.max=i,this.points=t,this.planes=e}static fromAabb(t,e){const n=[];for(let i=0;i<8;i++)n.push([1&~i?t[0]:e[0],1==(i>>1&1)?e[1]:t[1],1==(i>>2&1)?e[2]:t[2]]);return new dn(n,[[-1,0,0,e[0]],[1,0,0,-t[0]],[0,-1,0,e[1]],[0,1,0,-t[1]],[0,0,-1,e[2]],[0,0,1,-t[2]]],t,e)}static fromCenterSizeAngles(t,n,i){const r=e.br([],i[0],i[1],i[2]),a=e.bs([],[n[0],0,0],r),o=e.bs([],[0,n[1],0],r),s=e.bs([],[0,0,n[2]],r),l=[...t],c=[...t];for(let e=0;e<8;e++)for(let n=0;n<3;n++){const i=t[n]+a[n]*(1&~e?-1:1)+o[n]*(1==(e>>1&1)?1:-1)+s[n]*(1==(e>>2&1)?1:-1);l[n]=Math.min(l[n],i),c[n]=Math.max(c[n],i)}const u=[];for(let h=0;h<8;h++){const n=[...t];e.aS(n,n,e.aR([],a,1&~h?-1:1)),e.aS(n,n,e.aR([],o,1==(h>>1&1)?1:-1)),e.aS(n,n,e.aR([],s,1==(h>>2&1)?1:-1)),u.push(n)}return new dn(u,[[...a,-e.aX(a,u[0])],[...o,-e.aX(o,u[0])],[...s,-e.aX(s,u[0])],[-a[0],-a[1],-a[2],-e.aX(a,u[7])],[-o[0],-o[1],-o[2],-e.aX(o,u[7])],[-s[0],-s[1],-s[2],-e.aX(s,u[7])]],l,c)}intersectsFrustum(t){let e=!0;const n=this.points.length,i=this.planes.length,r=t.planes.length,a=t.points.length;for(let o=0;o<r;o++){const i=t.planes[o];let r=0;for(let t=0;t<n;t++){const e=this.points[t];i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0&&r++}if(0===r)return 0;r<n&&(e=!1)}if(e)return 2;for(let o=0;o<i;o++){const e=this.planes[o];let n=0;for(let i=0;i<a;i++){const r=t.points[i];e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]>=0&&n++}if(0===n)return 0}return 1}intersectsPlane(t){const e=this.points.length;let n=0;for(let i=0;i<e;i++){const e=this.points[i];t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0&&n++}return n===e?2:0===n?0:1}}function pn(t,e,n){const i=t-e;return i<0?-i:Math.max(0,i-n)}function fn(t,e,n,i,r){const a=t-n;let o;return o=a<0?Math.min(-a,1+a-r):a>1?Math.min(Math.max(a-r,0),1-a):0,Math.max(o,pn(e,i,r))}class mn{constructor(){this._boundingVolumeCache=new hn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,e,n,i){const r=1<<n.z,a=1/r,o=n.x/r,s=n.y/r;let l=2;return l=Math.min(l,fn(t,e,o,s,a)),l=Math.min(l,fn(t,e,o+.5,-s-a,a)),l=Math.min(l,fn(t,e,o+.5,2-s-a,a)),l}getWrap(t,e,n){const i=1<<e.z,r=1/i,a=e.x/i,o=pn(t.x,a,r),s=pn(t.x,a-1,r),l=pn(t.x,a+1,r),c=Math.min(o,s,l);return c===l?1:c===s?-1:0}allowVariableZoom(t,e){return yt(t,e)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,e,n,i){return this._boundingVolumeCache.getTileBoundingVolume(t,e,n,i)}_computeTileBoundingVolume(t,n,i,r){var a,o;let s=0,l=0;if(null==r?void 0:r.terrain){const c=new e.Z(t.z,n,t.z,t.x,t.y),u=r.terrain.getMinMaxElevation(c);s=null!==(a=u.minElevation)&&void 0!==a?a:Math.min(0,i),l=null!==(o=u.maxElevation)&&void 0!==o?o:Math.max(0,i)}if(s/=e.bu,l/=e.bu,s+=1,l+=1,t.z<=0)return dn.fromAabb([-l,-l,-l],[l,l,l]);if(1===t.z)return dn.fromAabb([0===t.x?-l:0,0===t.y?0:-l,-l],[0===t.x?0:l,0===t.y?l:0,l]);{const n=[en(0,0,t.x,t.y,t.z),en(e.$,0,t.x,t.y,t.z),en(e.$,e.$,t.x,t.y,t.z),en(0,e.$,t.x,t.y,t.z)],i=[];for(const t of n)i.push(e.aR([],t,l));if(l!==s)for(const t of n)i.push(e.aR([],t,s));0===t.y&&i.push([0,1,0]),t.y===(1<<t.z)-1&&i.push([0,-1,0]);const r=[1,1,1],a=[-1,-1,-1];for(const t of i)for(let e=0;e<3;e++)r[e]=Math.min(r[e],t[e]),a[e]=Math.max(a[e],t[e]);const o=en(e.$/2,e.$/2,t.x,t.y,t.z),c=e.aW([],[0,1,0],o);e.aV(c,c);const u=e.aW([],o,c);e.aV(u,u);const h=e.aW([],n[2],n[1]);e.aV(h,h);const d=e.aW([],n[0],n[3]);e.aV(d,d),i.push(e.aR([],o,l)),t.y>=(1<<t.z)/2&&i.push(e.aR([],en(e.$/2,0,t.x,t.y,t.z),l)),t.y<(1<<t.z)/2&&i.push(e.aR([],en(e.$/2,e.$,t.x,t.y,t.z),l));const p=gn(o,i),f=gn(u,i),m=[-o[0],-o[1],-o[2],p.max],g=[o[0],o[1],o[2],-p.min],y=[-u[0],-u[1],-u[2],f.max],v=[u[0],u[1],u[2],-f.min],_=[...h,0],b=[...d,0],x=[];return 0===t.y?x.push(e.bt(b,_,m),e.bt(b,_,g)):x.push(e.bt(y,_,m),e.bt(y,_,g),e.bt(y,b,m),e.bt(y,b,g)),t.y===(1<<t.z)-1?x.push(e.bt(b,_,m),e.bt(b,_,g)):x.push(e.bt(v,_,m),e.bt(v,_,g),e.bt(v,b,m),e.bt(v,b,g)),new dn(x,[m,g,y,v,_,b],r,a)}}}function gn(t,n){let i=1/0,r=-1/0;for(const a of n){const n=e.aX(t,a);i=Math.min(i,n),r=Math.max(r,n)}return{min:i,max:r}}class yn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,n){return this._helper.interpolatePadding(t,e,n)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){this._helper.resize(t,e)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=e.bv(),this._projectionMatrix=e.b9(),this._globeViewProjMatrix32f=e.b8(),this._globeViewProjMatrixNoCorrection=e.b9(),this._globeViewProjMatrixNoCorrectionInverted=e.b9(),this._globeProjMatrixInverted=e.b9(),this._cameraPosition=e.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ie({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)}),this._coveringTilesDetailsProvider=new mn}clone(){const t=new yn;return t.apply(this),t}apply(t,e){this._globeLatitudeErrorCorrectionRadians=e||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=e.bp();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:e,applyGlobeMatrix:n}=t,i=this._helper.getMercatorTileCoordinates(e);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:i,clippingPlane:this._cachedClippingPlane,projectionTransition:n?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,i=this.cameraToCenterDistance/t,r=Math.sin(n)*i,a=Math.cos(n)*i+1,o=1/Math.sqrt(r*r+a*a)*1;let s=-r,l=a;const c=Math.sqrt(s*s+l*l);s/=c,l/=c;const u=[0,s,l];e.bw(u,u,[0,0,0],-this.bearingInRadians),e.bx(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),e.by(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/e.aZ(u);return e.aR(u,u,h),[...u,-o*h]}isLocationOccluded(t){return!this.isSurfacePointVisible(nn(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,i=this._helper._center.lat*Math.PI/180,r=Math.cos(i),a=[Math.sin(n)*r,Math.sin(i),Math.cos(n)*r],o=[a[2],0,-a[0]],s=[0,0,0];e.aW(s,o,a),e.aV(o,o),e.aV(s,s);const l=[0,0,0];return e.aV(l,[o[0]*t[0]+s[0]*t[1]+a[0]*t[2],o[1]*t[0]+s[1]*t[1]+a[1]*t[2],o[2]*t[0]+s[2]*t[1]+a[2]*t[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,i){const r=function(t,n,i){const r=1/(1<<i.z);return new e.a1(t/e.$*r+i.x*r,n/e.$*r+i.y*r)}(t,n,i.canonical),a=(o=r.y,[e.bo(r.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI]);var o;return this.getCircleRadiusCorrection()/Math.cos(a[1])}projectTileCoordinates(t,n,i,r){const a=i.canonical,o=en(t,n,a.x,a.y,a.z),s=1+(r?r(t,n):0)/e.bu,l=[o[0]*s,o[1]*s,o[2]*s,1];e.aw(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*o[0]+c[1]*o[1]+c[2]*o[2]+c[3]<0;return{point:new e.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=rn(this.worldSize,this.center.lat),n=e.ba(),i=e.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),e.b4(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const r=this.centerOffset;n[8]=2*-r.x/this._helper._width,n[9]=2*r.y/this._helper._height,this._projectionMatrix=e.b5(n),this._globeProjMatrixInverted=e.ba(),e.aq(this._globeProjMatrixInverted,n),e.M(n,n,[0,0,-this.cameraToCenterDistance]),e.b6(n,n,this.rollInRadians),e.b7(n,n,-this.pitchInRadians),e.b6(n,n,this.bearingInRadians),e.M(n,n,[0,0,-t]);const a=e.bp();a[0]=t,a[1]=t,a[2]=t,e.b7(i,n,this.center.lat*Math.PI/180),e.bz(i,i,-this.center.lng*Math.PI/180),e.N(i,i,a),this._globeViewProjMatrixNoCorrection=i,e.b7(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),e.bz(n,n,-this.center.lng*Math.PI/180),e.N(n,n,a),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=e.ba(),e.aq(this._globeViewProjMatrixNoCorrectionInverted,i);const o=e.bp();this._cameraPosition=e.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/t,e.bw(this._cameraPosition,this._cameraPosition,o,-this.rollInRadians),e.bx(this._cameraPosition,this._cameraPosition,o,this.pitchInRadians),e.bw(this._cameraPosition,this._cameraPosition,o,-this.bearingInRadians),e.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),e.bx(this._cameraPosition,this._cameraPosition,o,-this.center.lat*Math.PI/180),e.by(this._cameraPosition,this._cameraPosition,o,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const s=e.b5(this._globeViewProjMatrixNoCorrectionInverted);e.N(s,s,[1,1,-1]),this._cachedFrustum=Re.fromInvProjectionMatrix(s,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){e.w("calculateFogMatrix is not supported on globe projection.");const n=e.ba();return e.ag(n),n}getVisibleUnwrappedCoordinates(t){return[new e.b2(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&e.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const i=nn(t);e.aR(i,i,1+n/e.bu);const r=e.bv();return e.aw(r,[i[0],i[1],i[2],1],this._globeViewProjMatrixNoCorrection),r[2]/r[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,i=[new e.P(0,0),new e.P(t,0),new e.P(this.width,0),new e.P(this.width,n),new e.P(this.width,this.height),new e.P(t,this.height),new e.P(0,this.height),new e.P(0,n)],r=[];for(const e of i)r.push(this.unprojectScreenPoint(e));let a=0,o=0,s=0,l=0;const c=this.center;for(const h of r){const t=e.bA(c.lng,h.lng),n=e.bA(c.lat,h.lat);t<o&&(o=t),t>a&&(a=t),n<l&&(l=n),n>s&&(s=n)}const u=[c.lng+o,c.lat+l,c.lng+a,c.lat+s];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new H(u)}getConstrained(t,n){const i=e.ah(t.lat,-e.ai,e.ai),r=e.ah(+n,this.minZoom+sn(0,i),this.maxZoom);return{center:new e.S(t.lng,i),zoom:r}}calculateCenterFromCameraLngLatAlt(t,e,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,n,i)}setLocationAtPoint(t,n){const i=nn(this.unprojectScreenPoint(n)),r=nn(t),a=e.bp();e.bB(a);const o=e.bp();e.by(o,i,a,-this.center.lng*Math.PI/180),e.bx(o,o,a,this.center.lat*Math.PI/180);const s=r[0]*r[0]+r[2]*r[2],l=o[0]*o[0];if(s<l)return;const c=Math.sqrt(s-l),u=-c,h=e.bC(r[0],r[2],o[0],c),d=e.bC(r[0],r[2],o[0],u),p=e.bp();e.by(p,r,a,-h);const f=e.bC(p[1],p[2],o[1],o[2]),m=e.bp();e.by(m,r,a,-d);const g=e.bC(m[1],m[2],o[1],o[2]),y=.5*Math.PI,v=f>=-y&&f<=y,_=g>=-y&&g<=y;let b,x;if(v&&_){const t=this.center.lng*Math.PI/180,n=this.center.lat*Math.PI/180;e.bD(h,t)+e.bD(f,n)<e.bD(d,t)+e.bD(g,n)?(b=h,x=f):(b=d,x=g)}else if(v)b=h,x=f;else{if(!_)return;b=d,x=g}const w=b/Math.PI*180,S=x/Math.PI*180,M=this.center.lat;this.setCenter(new e.S(w,e.ah(S,-90,90))),this.setZoom(this.zoom+sn(M,this.center.lat))}locationToScreenPoint(t,n){const i=nn(t);if(n){const r=n.getElevationForLngLatZoom(t,this._helper._tileZoom);e.aR(i,i,1+r/e.bu)}return this._projectSurfacePointToScreen(i)}_projectSurfacePointToScreen(t){const n=e.bv();return e.aw(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new e.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const e=n.pointCoordinate(t);if(e)return e}return e.a1.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,e){var n;return null===(n=this.screenPointToMercatorCoordinate(t,e))||void 0===n?void 0:n.toLngLat()}isPointOnMapSurface(t,e){const n=this._cameraPosition,i=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(n,i)}getRayDirectionFromPixel(t){const n=e.bv();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,e.aw(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const i=e.bp();i[0]=n[0]-this._cameraPosition[0],i[1]=n[1]-this._cameraPosition[1],i[2]=n[2]-this._cameraPosition[2];const r=e.bp();return e.aV(r,i),r}isSurfacePointVisible(t){const e=this._cachedClippingPlane;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=e.bv();return e.aw(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const i=e.aX(t,n),r=e.bp(),a=e.bp();e.aR(a,n,i),e.aU(r,t,a);const o=1-e.aX(r,r);if(o<0)return null;const s=e.aX(t,t)-1,l=-i+(i<0?1:-1)*Math.sqrt(o),c=s/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(t){const n=this._cameraPosition,i=this.getRayDirectionFromPixel(t),r=this.rayPlanetIntersection(n,i);if(r){const t=e.bp();e.aS(t,n,[i[0]*r.tMin,i[1]*r.tMin,i[2]*r.tMin]);const a=e.bp();return e.aV(a,t),an(a)}const a=this._cachedClippingPlane,o=a[0]*i[0]+a[1]*i[1]+a[2]*i[2],s=-e.b1(a,n)/o,l=e.bp();if(s>0)e.aS(l,n,[i[0]*s,i[1]*s,i[2]*s]);else{const t=e.bp();e.aS(t,n,[2*i[0],2*i[1],2*i[2]]);const r=e.b1(this._cachedClippingPlane,t);e.aU(l,t,[this._cachedClippingPlane[0]*r,this._cachedClippingPlane[1]*r,this._cachedClippingPlane[2]*r])}const c=function(t){const n=e.bp();return n[0]=t[0]*-t[3],n[1]=t[1]*-t[3],n[2]=t[2]*-t[3],{center:n,radius:Math.sqrt(1-t[3]*t[3])}}(a);return an(function(t,n,i){const r=e.bp();e.aU(r,i,t);const a=e.bp();return e.bq(a,t,r,n/e.a$(r)),a}(c.center,c.radius,l))}getMatrixForModel(t,n){const i=e.S.convert(t),r=1/e.bu,a=e.b9();return e.bz(a,a,i.lng/180*Math.PI),e.b7(a,a,-i.lat/180*Math.PI),e.M(a,a,[0,0,1+n/e.bu]),e.b7(a,a,.5*Math.PI),e.N(a,a,[r,r,r]),a}getProjectionDataForCustomLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=this.getProjectionData({overscaledTileID:new e.Z(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class vn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,n){return this._helper.interpolatePadding(t,e,n)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._helper.resize(t,e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,e){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=e,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ie({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)}),this._globeness=1,this._mercatorTransform=new De,this._verticalPerspectiveTransform=new yn}clone(){const t=new vn;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const e=this._mercatorTransform.getProjectionData(t),n=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?n.mainMatrix:e.mainMatrix,clippingPlane:n.clippingPlane,tileMercatorCoords:n.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:e.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return e.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return e.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,i){const r=this._mercatorTransform.getPitchedTextCorrection(t,n,i),a=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,i);return e.bk(r,a,this._globeness)}projectTileCoordinates(t,e,n,i){return this.currentTransform.projectTileCoordinates(t,e,n,i)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,e){return this.currentTransform.lngLatToCameraDepth(t,e)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,e){return this.currentTransform.getConstrained(t,e)}calculateCenterFromCameraLngLatAlt(t,e,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,n,i)}setLocationAtPoint(t,e){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,e),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,e),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,e){return this.currentTransform.locationToScreenPoint(t,e)}screenPointToMercatorCoordinate(t,e){return this.currentTransform.screenPointToMercatorCoordinate(t,e)}screenPointToLocation(t,e){return this.currentTransform.screenPointToLocation(t,e)}isPointOnMapSurface(t,e){return this.currentTransform.isPointOnMapSurface(t,e)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,e){return this.currentTransform.getMatrixForModel(t,e)}getProjectionDataForCustomLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return e;const n=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return n.fallbackMatrix=e.mainMatrix,n}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class _n{get useGlobeControls(){return!0}handlePanInertia(t,n){const i=ln(t,n);return Math.abs(i.lng-n.center.lng)>180&&(i.lng=n.center.lng+179.5*Math.sign(i.lng-n.center.lng)),{easingCenter:i,easingOffset:new e.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const i=t.around,r=n.screenPointToLocation(i);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const a=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const o=n.zoom-a;if(0===o)return;const s=e.bA(n.center.lng,r.lng),l=s/(Math.abs(s/180)+1),c=e.bA(n.center.lat,r.lat),u=n.getRayDirectionFromPixel(i),h=n.cameraPosition,d=-1*e.aX(h,u),p=e.bp();e.aS(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=e.aZ(p)-1,m=Math.exp(.5*-Math.max(f-.3,0)),g=rn(n.worldSize,n.center.lat)/Math.min(n.width,n.height),y=e.bn(g,.9,.5,1,.25),v=(1-e.af(-o))*Math.min(m,y),_=n.center.lat,b=n.zoom,x=new e.S(n.center.lng+l*v,e.ah(n.center.lat+c*v,-e.ai,e.ai));n.setLocationAtPoint(r,i);const w=n.center,S=e.bn(Math.abs(s),45,85,0,1),M=e.bn(g,.75,.35,0,1),T=Math.pow(Math.max(S,M),.25),A=e.bA(w.lng,x.lng),E=e.bA(w.lat,x.lat);n.setCenter(new e.S(w.lng+A*T,w.lat+E*T).wrap()),n.setZoom(b+sn(_,n.center.lat))}handleMapControlsPan(t,e,n){if(!t.panDelta)return;const i=e.center.lat,r=e.zoom;e.setCenter(ln(t.panDelta,e).wrap()),e.setZoom(r+sn(i,e.center.lat))}cameraForBoxAndBearing(t,n,i,r,a){const o=Fe(t,n,i,r,a),s=n.left/a.width*2-1,l=(a.width-n.right)/a.width*2-1,c=n.top/a.height*-2+1,u=(a.height-n.bottom)/a.height*-2+1,h=e.bA(i.getWest(),i.getEast())<0,d=h?i.getEast():i.getWest(),p=h?i.getWest():i.getEast(),f=Math.max(i.getNorth(),i.getSouth()),m=Math.min(i.getNorth(),i.getSouth()),g=d+.5*e.bA(d,p),y=f+.5*e.bA(f,m),v=a.clone();v.setCenter(o.center),v.setBearing(o.bearing),v.setPitch(0),v.setRoll(0),v.setZoom(o.zoom);const _=v.modelViewProjectionMatrix,b=[nn(i.getNorthWest()),nn(i.getNorthEast()),nn(i.getSouthWest()),nn(i.getSouthEast()),nn(new e.S(p,y)),nn(new e.S(d,y)),nn(new e.S(g,f)),nn(new e.S(g,m))],x=nn(o.center);let w=Number.POSITIVE_INFINITY;for(const e of b)s<0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,x,_,"x",s))),l>0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,x,_,"x",l))),c>0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,x,_,"y",c))),u<0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,x,_,"y",u)));if(Number.isFinite(w)&&0!==w)return o.zoom=v.zoom+e.ak(w),o;Ne()}handleJumpToCenterZoom(t,n){const i=t.center.lat,r=t.getConstrained(n.center?e.S.convert(n.center):t.center,t.zoom).center;t.setCenter(r.wrap());const a=void 0!==n.zoom?+n.zoom:t.zoom+sn(i,r.lat);t.zoom!==a&&t.setZoom(a)}handleEaseTo(t,n){const i=t.zoom,r=t.center,a=t.padding,o={roll:t.roll,pitch:t.pitch,bearing:t.bearing},s={roll:void 0===n.roll?t.roll:n.roll,pitch:void 0===n.pitch?t.pitch:n.pitch,bearing:void 0===n.bearing?t.bearing:n.bearing},l=void 0!==n.zoom,c=!t.isPaddingEqual(n.padding);let u=!1;const h=n.center?e.S.convert(n.center):r,d=t.getConstrained(h,i).center;Ce(t,d);const p=t.clone();p.setCenter(d),p.setZoom(l?+n.zoom:i+sn(r.lat,h.lat)),p.setBearing(n.bearing);const f=new e.P(e.ah(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),e.ah(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));p.setLocationAtPoint(d,f);const m=(n.offset&&n.offsetAsPoint.mag())>0?p.center:d,g=l?+n.zoom:i+sn(r.lat,m.lat),y=i+sn(r.lat,0),v=g+sn(m.lat,0),_=e.bA(r.lng,m.lng),b=e.bA(r.lat,m.lat),x=e.af(v-y);return u=g!==i,{easeFunc:i=>{if(e.be(o,s)||ze({startEulerAngles:o,endEulerAngles:s,tr:t,k:i,useSlerp:o.roll!=s.roll}),c&&t.interpolatePadding(a,n.padding,i),n.around)e.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const e=v>y?Math.min(2,x):Math.max(.5,x),n=Math.pow(e,1-i),a=un(r,_,b,i*n);t.setCenter(a.wrap())}if(u){const n=e.C.number(y,v,i)+sn(0,t.center.lat);t.setZoom(n)}},isZooming:u,elevationCenter:m}}handleFlyTo(t,n){const i=void 0!==n.zoom,r=t.center,a=t.zoom,o=t.padding,s=!t.isPaddingEqual(n.padding),l=t.getConstrained(e.S.convert(n.center||n.locationAtOffset),a).center,c=i?+n.zoom:t.zoom+sn(t.center.lat,l.lat),u=t.clone();u.setCenter(l),u.setZoom(c),u.setBearing(n.bearing);const h=new e.P(e.ah(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),e.ah(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));u.setLocationAtPoint(l,h);const d=u.center;Ce(t,d);const p=function(t,n,i){const r=nn(n),a=nn(i),o=e.aX(r,a),s=Math.acos(o),l=tn(t);return s/(2*Math.PI)*l}(t,r,d),f=a+sn(r.lat,0),m=c+sn(d.lat,0),g=e.af(m-f);let y;if("number"==typeof n.minZoom){const i=+n.minZoom+sn(d.lat,0),r=Math.min(i,f,m)+sn(0,d.lat),a=t.getConstrained(d,r).zoom+sn(d.lat,0);y=e.af(a-f)}const v=e.bA(r.lng,d.lng),_=e.bA(r.lat,d.lat);return{easeFunc:(i,a,l,u)=>{const h=un(r,v,_,l);s&&t.interpolatePadding(o,n.padding,i);const p=1===i?d:h;t.setCenter(p.wrap());const m=f+e.ak(a);t.setZoom(1===i?c:m+sn(0,p.lat))},scaleOfZoom:g,targetCenter:d,scaleOfMinZoom:y,pixelPathLength:p}}static solveVectorScale(t,e,n,i,r){const a="x"===i?[n[0],n[4],n[8],n[12]]:[n[1],n[5],n[9],n[13]],o=[n[3],n[7],n[11],n[15]],s=t[0]*a[0]+t[1]*a[1]+t[2]*a[2],l=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],c=e[0]*a[0]+e[1]*a[1]+e[2]*a[2],u=e[0]*o[0]+e[1]*o[1]+e[2]*o[2];return c+r*l===s+r*u||o[3]*(s-c)+a[3]*(u-l)+s*u==c*l?null:(c+a[3]-r*u-r*o[3])/(c-s-r*u+r*l)}static getLesserNonNegativeNonNull(t,e){return null!==e&&e>=0&&e<t?e:t}}class bn{constructor(t){this._globe=t,this._mercatorCameraHelper=new Oe,this._verticalPerspectiveCameraHelper=new _n}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,e){return this.currentHelper.handlePanInertia(t,e)}handleMapControlsRollPitchBearingZoom(t,e){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,e)}handleMapControlsPan(t,e,n){this.currentHelper.handleMapControlsPan(t,e,n)}cameraForBoxAndBearing(t,e,n,i,r){return this.currentHelper.cameraForBoxAndBearing(t,e,n,i,r)}handleJumpToCenterZoom(t,e){this.currentHelper.handleJumpToCenterZoom(t,e)}handleEaseTo(t,e){return this.currentHelper.handleEaseTo(t,e)}handleFlyTo(t,e){return this.currentHelper.handleFlyTo(t,e)}}const xn=(t,n)=>e.y(t,n&&n.filter(t=>"source.canvas"!==t.identifier)),wn=e.bE();class Sn extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const t in this.sourceCaches){const e=this.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||this.sourceCaches[t].reload()}},this.map=t,this.dispatcher=new z(N(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(t,e)=>this.getGlyphs(t,e)),this.dispatcher.registerMessageHandler("GI",(t,e)=>this.getImages(t,e)),this.imageManager=new _,this.imageManager.setEventedParent(this),this.glyphManager=new S(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new P(256,512),this.crossTileSymbolIndex=new ve,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",e.bG()),it().on(tt,this._rtlPluginLoaded),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const n=e.getSource();if(n&&n.vectorLayerIds)for(const i in this._layers){const t=this._layers[i];t.source===n.id&&this._validateLayer(t)}})}setGlobalStateProperty(t,n){var i,r,a;this._checkLoaded();const o=null===n?null!==(a=null===(r=null===(i=this.stylesheet.state)||void 0===i?void 0:i[t])||void 0===r?void 0:r.default)&&void 0!==a?a:null:n;if(e.bH(o,this._globalState[t]))return this;this._globalState[t]=o;const s=this._findGlobalStateAffectedSources([t]);for(const e in this.sourceCaches)s.has(e)&&(this._reloadSource(e),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const r in t)!e.bH(this._globalState[r],t[r].default)&&(n.push(r),this._globalState[r]=t[r].default);const i=this._findGlobalStateAffectedSources(n);for(const e in this.sourceCaches)i.has(e)&&(this._reloadSource(e),this._changed=!0)}_findGlobalStateAffectedSources(t){if(0===t.length)return new Set;const e=new Set;for(const n in this._layers){const i=this._layers[n],r=i.getLayoutAffectingGlobalStateRefs();for(const n of t)r.has(n)&&e.add(i.source)}return e}loadURL(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.fire(new e.l("dataloading",{dataType:"style"})),n.validate="boolean"!=typeof n.validate||n.validate;const r=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const a=this._loadStyleRequest;e.j(r,this._loadStyleRequest).then(t=>{this._loadStyleRequest=null,this._load(t.data,n,i)}).catch(t=>{this._loadStyleRequest=null,t&&!a.signal.aborted&&this.fire(new e.k(t))})}loadJSON(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.fire(new e.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=!1!==n.validate,this._load(t,n,i)}).catch(()=>{})}loadEmpty(){this.fire(new e.l("dataloading",{dataType:"style"})),this._load(wn,{validate:!1})}_load(t,n,i){var r,a,o;const s=n.transformStyle?n.transformStyle(i,t):t;if(!n.validate||!xn(this,e.z(s))){this._loaded=!0,this.stylesheet=s;for(const t in s.sources)this.addSource(t,s.sources[t],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs),this._createLayers(),this.light=new A(this.stylesheet.light),this._setProjectionInternal((null===(r=this.stylesheet.projection)||void 0===r?void 0:r.type)||"mercator"),this.sky=new C(this.stylesheet.sky),this.map.setTerrain(null!==(a=this.stylesheet.terrain)&&void 0!==a?a:null),this.setGlobalState(null!==(o=this.stylesheet.state)&&void 0!==o?o:null),this.fire(new e.l("data",{dataType:"style"})),this.fire(new e.l("style.load"))}}_createLayers(){const t=e.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(t=>t.id),this._layers={},this._serializedLayers=null;for(const n of t){const t=e.bJ(n);t.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=t}}_loadSprite(t){let n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(t,n,i,r){return e._(this,void 0,void 0,function*(){const a=g(t),s=i>1?"@2x":"",l={},c={};for(const{id:t,url:i}of a){const a=n.transformRequest(y(i,s,".json"),"SpriteJSON");l[t]=e.j(a,r);const o=n.transformRequest(y(i,s,".png"),"SpriteImage");c[t]=f.getImage(o,r)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(t,n){return e._(this,void 0,void 0,function*(){const e={};for(const i in t){e[i]={};const r=o.getImageCanvasContext((yield n[i]).data),a=(yield t[i]).data;for(const t in a){const{width:n,height:o,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=a[t];e[i][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:n,height:o,x:s,y:l,context:r}}}}return e})}(l,c)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(t=>{if(this._spriteRequest=null,t)for(const e in t){this._spritesImagesIds[e]=[];const n=this._spritesImagesIds[e]?this._spritesImagesIds[e].filter(e=>!(e in t)):[];for(const t of n)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const r in t[e]){const n="default"===e?r:"".concat(e,":").concat(r);this._spritesImagesIds[e].push(n),n in this.imageManager.images?this.imageManager.updateImage(n,t[e][r],!1):this.imageManager.addImage(n,t[e][r]),i&&(this._changedImages[n]=!0)}}}).catch(t=>{this._spriteRequest=null,n=t,this.fire(new e.k(n))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"})),r&&r(n)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const i=t.sourceLayer;if(!i)return;const r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new e.k(new Error('Source layer "'.concat(i,'" does not exist on source "').concat(r.id,'" as specified by style layer "').concat(t.id,'".'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._serializedAllLayers();if(!t||0===t.length)return Object.values(n?e.bK(i):i);const r=[];for(const a of t)if(i[a]){const t=n?e.bK(i[a]):i[a];r.push(t)}return r}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const n of e){const e=this._layers[n];"custom"!==e.type&&(t[n]=e.serialize())}return t}hasTransitions(){var t,e,n;if(null===(t=this.light)||void 0===t?void 0:t.hasTransition())return!0;if(null===(e=this.sky)||void 0===e?void 0:e.hasTransition())return!0;if(null===(n=this.projection)||void 0===n?void 0:n.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const e=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(e.length||n.length)&&this._updateWorkerLayers(e,n);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error("Invalid action ".concat(e));this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const i in this._updatedPaintProps)this._layers[i].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const i={};for(const e in this.sourceCaches){const t=this.sourceCaches[e];i[e]=t.used,t.used=!1}for(const e of this._order){const n=this._layers[e];n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)&&n.source&&(this.sourceCaches[n.source].used=!0)}for(const r in i){const t=this.sourceCaches[r];!!i[r]!=!!t.used&&t.fire(new e.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:r}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new e.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;this._checkLoaded();const r=this.serialize();if(t=n.transformStyle?n.transformStyle(r,t):t,(null===(i=n.validate)||void 0===i||i)&&xn(this,e.z(t)))return!1;(t=e.bK(t)).layers=e.bI(t.layers);const a=e.bL(r,t),o=this._getOperationsToPerform(a);if(o.unimplemented.length>0)throw new Error("Unimplemented: ".concat(o.unimplemented.join(", "),"."));if(0===o.operations.length)return!1;for(const e of o.operations)e();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const e=[],n=[];for(const i of t)switch(i.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":e.push(()=>this.addLayer.apply(this,i.args));break;case"removeLayer":e.push(()=>this.removeLayer.apply(this,i.args));break;case"setPaintProperty":e.push(()=>this.setPaintProperty.apply(this,i.args));break;case"setLayoutProperty":e.push(()=>this.setLayoutProperty.apply(this,i.args));break;case"setFilter":e.push(()=>this.setFilter.apply(this,i.args));break;case"addSource":e.push(()=>this.addSource.apply(this,i.args));break;case"removeSource":e.push(()=>this.removeSource.apply(this,i.args));break;case"setLayerZoomRange":e.push(()=>this.setLayerZoomRange.apply(this,i.args));break;case"setLight":e.push(()=>this.setLight.apply(this,i.args));break;case"setGeoJSONSourceData":e.push(()=>this.setGeoJSONSourceData.apply(this,i.args));break;case"setGlyphs":e.push(()=>this.setGlyphs.apply(this,i.args));break;case"setSprite":e.push(()=>this.setSprite.apply(this,i.args));break;case"setTerrain":e.push(()=>this.map.setTerrain.apply(this,i.args));break;case"setSky":e.push(()=>this.setSky.apply(this,i.args));break;case"setProjection":this.setProjection.apply(this,i.args);break;case"setGlobalState":e.push(()=>this.setGlobalState.apply(this,i.args));break;case"setTransition":e.push(()=>{});break;default:n.push(i.command)}return{operations:e,unimplemented:n}}addImage(t,n){if(this.getImage(t))return this.fire(new e.k(new Error('An image named "'.concat(t,'" already exists.'))));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new e.k(new Error('An image named "'.concat(t,'" does not exist.'))));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error('Source "'.concat(t,'" already exists.'));if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.z.source,"sources.".concat(t),n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=this.sourceCaches[t]=new bt(t,n,this.dispatcher);r.style=this,r.setEventedParent(this,()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:t})),r.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.k(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(i,'" is using it.'))));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new e.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID=".concat(t));const n=this.sourceCaches[t].getSource();if("geojson"!==n.type)throw new Error("geojsonSource.type is ".concat(n.type,", which is !== 'geojson"));n.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.k(new Error('Layer "'.concat(r,'" already exists on this map.'))));let a;if("custom"===t.type){if(xn(this,e.bM(t)))return;a=e.bJ(t)}else{if("source"in t&&"object"==typeof t.source&&(this.addSource(r,t.source),t=e.bK(t),t=e.e(t,{source:r})),this._validate(e.z.layer,"layers.".concat(r),t,{arrayIndex:-1},i))return;a=e.bJ(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}})}const o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new e.k(new Error('Cannot add layer "'.concat(r,'" before non-existing layer "').concat(n,'".'))));else{if(this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a,this._removedLayers[r]&&a.source&&"custom"!==a.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.k(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be moved."))));if(t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new e.k(new Error('Cannot move layer "'.concat(t,'" before non-existing layer "').concat(n,'".')))):(this._order.splice(r,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new e.k(new Error('Cannot remove non-existing layer "'.concat(t,'".'))));n.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,i){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new e.k(new Error('Cannot set the zoom range of non-existing layer "'.concat(t,'".'))))}setFilter(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this.getLayer(t);if(r){if(!e.bH(r.filter,n))return null==n?(r.setFilter(void 0),void this._updateLayer(r)):void(this._validate(e.z.filter,"layers.".concat(r.id,".filter"),n,null,i)||(r.setFilter(e.bK(n)),this._updateLayer(r)))}else this.fire(new e.k(new Error('Cannot filter non-existing layer "'.concat(t,'".'))))}getFilter(t){return e.bK(this.getLayer(t).filter)}setLayoutProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this.getLayer(t);a?e.bH(a.getLayoutProperty(n),i)||(a.setLayoutProperty(n,i,r),this._updateLayer(a)):this.fire(new e.k(new Error('Cannot style non-existing layer "'.concat(t,'".'))))}getLayoutProperty(t,n){const i=this.getLayer(t);if(i)return i.getLayoutProperty(n);this.fire(new e.k(new Error('Cannot get style of non-existing layer "'.concat(t,'".'))))}setPaintProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this.getLayer(t);a?e.bH(a.getPaintProperty(n),i)||(a.setPaintProperty(n,i,r)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new e.k(new Error('Cannot style non-existing layer "'.concat(t,'".'))))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(t,n){this._checkLoaded();const i=t.source,r=t.sourceLayer,a=this.sourceCaches[i];if(void 0===a)return void this.fire(new e.k(new Error("The source '".concat(i,"' does not exist in the map's style."))));const o=a.getSource().type;"geojson"===o&&r?this.fire(new e.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===t.id&&this.fire(new e.k(new Error("The feature id parameter must be provided."))),a.setFeatureState(r,t.id,n)):this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const i=t.source,r=this.sourceCaches[i];if(void 0===r)return void this.fire(new e.k(new Error("The source '".concat(i,"' does not exist in the map's style."))));const a=r.getSource().type,o="vector"===a?t.sourceLayer:void 0;"vector"!==a||o?n&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.k(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(o,t.id,n):this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,i=t.sourceLayer,r=this.sourceCaches[n];if(void 0!==r)return"vector"!==r.getSource().type||i?(void 0===t.id&&this.fire(new e.k(new Error("The feature id parameter must be provided."))),r.getFeatureState(i,t.id)):void this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new e.k(new Error("The source '".concat(n,"' does not exist in the map's style."))))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=e.bN(this.sourceCaches,t=>t.serialize()),n=this._serializeByIds(this._order,!0),i=this.map.getTerrain()||void 0,r=this.stylesheet;return e.bO({version:r.version,name:r.name,metadata:r.metadata,light:r.light,sky:r.sky,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,projection:r.projection,sources:t,layers:n,terrain:i},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,n={},i=[];for(let a=this._order.length-1;a>=0;a--){const r=this._order[a];if(e(r)){n[r]=a;for(const e of t){const t=e[r];if(t)for(const e of t)i.push(e)}}}i.sort((t,e)=>e.intersectionZ-t.intersectionZ);const r=[];for(let a=this._order.length-1;a>=0;a--){const o=this._order[a];if(e(o))for(let t=i.length-1;t>=0;t--){const e=i[t].feature;if(n[e.layer.id]<a)break;r.push(e),i.pop()}else for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(t,n,i){n&&n.filter&&this._validate(e.z.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new e.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.k(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];r[n.source]=!0}}const a=[];n.availableImages=this._availableImages;const o=this._serializedAllLayers(),s=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,l=Object.assign(Object.assign({},n),{layers:s});for(const e in this.sourceCaches)n.layers&&!r[e]||a.push(B(this.sourceCaches[e],this._layers,o,t,l,i,this.map.terrain?(t,e,n)=>this.map.terrain.getElevation(t,e,n):void 0));return this.placement&&a.push(function(t,e,n,i,r,a,o){const s={},l=a.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(o[u]);c.sort(U);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=s[t]=s[t]||[],i=n[t];i.sort((t,e)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex});for(const t of i)e.push(t)}}return function(t,e,n){for(const i in t)for(const r of t[i])j(r,n[e[i].source]);return t}(s,t,n)}(this._layers,o,this.sourceCaches,t,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(t,n){n&&n.filter&&this._validate(e.z.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this.sourceCaches[t];return i?function(t,e){const n=t.getRenderableIds().map(e=>t.getTileByID(e)),i=[],r={};for(let a=0;a<n.length;a++){const t=n[a],o=t.tileID.canonical.key;r[o]||(r[o]=!0,t.querySourceFeatures(i,e))}return i}(i,n):[]}getLight(){return this.light.getLight()}setLight(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();const i=this.light.getLight();let r=!1;for(const o in t)if(!e.bH(t[o],i[o])){r=!0;break}if(!r)return;const a={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(a)}getProjection(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.sky}setSky(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();const i=this.getSky();let r=!1;if(!t&&!i)return;if(t&&!i)r=!0;else if(!t&&i)r=!0;else for(const o in t)if(!e.bH(t[o],i[o])){r=!0;break}if(!r)return;const a={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(a)}_setProjectionInternal(t){const n=function(t){if(Array.isArray(t)){const e=new Qe({type:t});return{projection:e,transform:new vn,cameraHelper:new bn(e)}}switch(t){case"mercator":return{projection:new Ae,transform:new De,cameraHelper:new Oe};case"globe":{const t=new Qe({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:t,transform:new vn,cameraHelper:new bn(t)}}case"vertical-perspective":return{projection:new Je,transform:new yn,cameraHelper:new _n};default:return e.w("Unknown projection name: ".concat(t,". Falling back to mercator projection.")),{projection:new Ae,transform:new De,cameraHelper:new Oe}}}(t);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const e in this.sourceCaches)this.sourceCaches[e].reload()}_validate(t,n,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!a||!1!==a.validate)&&xn(this,t.call(e.z,e.e({key:n,style:this.serialize(),value:i,styleSpec:e.v},r)))}_remove(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),it().off(tt,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!1,s=!1;const l={};for(const o of this._order){const e=this._layers[o];if("symbol"!==e.type)continue;if(!l[e.source]){const t=this.sourceCaches[e.source];l[e.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const n=this.crossTileSymbolIndex.addLayer(e,l[e.source],t.center.lng);a=a||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((r=r||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.now(),t.zoom))&&(this.pauseablePlacement=new pe(t,this.map.terrain,this._order,r,e,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const o of this._order){const t=this._layers[o];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n){return e._(this,void 0,void 0,function*(){const t=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const e=this.sourceCaches[n.source];return e&&e.setDependencies(n.tileID.key,n.type,n.icons),t})}getGlyphs(t,n){return e._(this,void 0,void 0,function*(){const t=yield this.glyphManager.getGlyphs(n.stacks),e=this.sourceCaches[n.source];return e&&e.setDependencies(n.tileID.key,n.type,[""]),t})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded(),t&&this._validate(e.z.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const a=[{id:t,url:n}],o=[...g(this.stylesheet.sprite),...a];this._validate(e.z.sprite,"sprite",o,null,i)||(this.stylesheet.sprite=o,this._loadSprite(a,!0,r))}removeSprite(t){this._checkLoaded();const n=g(this.stylesheet.sprite);if(n.find(e=>e.id===t)){if(this._spritesImagesIds[t])for(const e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;n.splice(n.findIndex(e=>e.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}else this.fire(new e.k(new Error('Sprite "'.concat(t,"\" doesn't exists on this map."))))}getSprite(){return g(this.stylesheet.sprite)}setSprite(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),t&&this._validate(e.z.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,i):(this._unloadSprite(),i&&i(null)))}}var Mn=e.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,n,i,r,a,o,s,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!c&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==n||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,n,i,r,a,o,s,l):(t.bindVertexArray.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind(),l&&l.bind())}freshBind(t,e,n,i,r,a,o,s){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o,this.boundDynamicVertexBuffer3=s,e.enableAttributes(u,t);for(const h of n)h.enableAttributes(u,t);a&&a.enableAttributes(u,t),o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const h of n)h.bind(),h.setVertexAttribPointers(u,t,r);a&&(a.bind(),a.setVertexAttribPointers(u,t,r)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const An=(t,n,i,r,a)=>({u_texture:0,u_ele_delta:t,u_fog_matrix:n,u_fog_color:i?i.properties.get("fog-color"):e.bf.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?0:i?i.calculateFogBlendOpacity(r):0,u_horizon_color:i?i.properties.get("horizon-color"):e.bf.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:a?1:0}),En={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Cn(t){const e=[];for(let n=0;n<t.length;n++){if(null===t[n])continue;const i=t[n].split(" ");e.push(i.pop())}return e}class Pn{constructor(t,n,i,r,a,o,s,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const u=t.gl;this.program=u.createProgram();const h=Cn(n.staticAttributes),d=i?i.getBinderAttributes():[],p=h.concat(d),f=be.prelude.staticUniforms?Cn(be.prelude.staticUniforms):[],m=s.staticUniforms?Cn(s.staticUniforms):[],g=n.staticUniforms?Cn(n.staticUniforms):[],y=i?i.getBinderUniforms():[],v=f.concat(m).concat(g).concat(y),_=[];for(const e of v)_.indexOf(e)<0&&_.push(e);const b=i?i.defines():[];qe(u)&&b.unshift("#version 300 es"),a&&b.push("#define OVERDRAW_INSPECTOR;"),o&&b.push("#define TERRAIN3D;"),l&&b.push(l),c&&b.push(...c);let x=b.concat(be.prelude.fragmentSource,s.fragmentSource,n.fragmentSource).join("\n"),w=b.concat(be.prelude.vertexSource,s.vertexSource,n.vertexSource).join("\n");qe(u)||(x=function(t){return t.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(x),w=function(t){return t.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const S=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,x),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error("Could not compile fragment shader: ".concat(u.getShaderInfoLog(S)));u.attachShader(this.program,S);const M=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(M,w),u.compileShader(M),!u.getShaderParameter(M,u.COMPILE_STATUS))throw new Error("Could not compile vertex shader: ".concat(u.getShaderInfoLog(M)));u.attachShader(this.program,M),this.attributes={};const T={};this.numAttributes=p.length;for(let e=0;e<this.numAttributes;e++)p[e]&&(u.bindAttribLocation(this.program,e,p[e]),this.attributes[p[e]]=e);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error("Program failed to link: ".concat(u.getProgramInfoLog(this.program)));u.deleteShader(M),u.deleteShader(S);for(let e=0;e<_.length;e++){const t=_[e];if(t&&!T[t]){const e=u.getUniformLocation(this.program,t);e&&(T[t]=e)}}this.fixedUniforms=r(t,T),this.terrainUniforms=((t,n)=>({u_depth:new e.bP(t,n.u_depth),u_terrain:new e.bP(t,n.u_terrain),u_terrain_dim:new e.bg(t,n.u_terrain_dim),u_terrain_matrix:new e.bR(t,n.u_terrain_matrix),u_terrain_unpack:new e.bS(t,n.u_terrain_unpack),u_terrain_exaggeration:new e.bg(t,n.u_terrain_exaggeration)}))(t,T),this.projectionUniforms=((t,n)=>({u_projection_matrix:new e.bR(t,n.u_projection_matrix),u_projection_tile_mercator_coords:new e.bS(t,n.u_projection_tile_mercator_coords),u_projection_clipping_plane:new e.bS(t,n.u_projection_clipping_plane),u_projection_transition:new e.bg(t,n.u_projection_transition),u_projection_fallback_matrix:new e.bR(t,n.u_projection_fallback_matrix)}))(t,T),this.binderUniforms=i?i.getUniforms(t,T):[]}draw(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v){const _=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(a),s){t.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,s.depthTexture),t.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,s.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(s[t])}if(l)for(const x in l)this.projectionUniforms[En[x]].set(l[x]);if(o)for(const x in this.fixedUniforms)this.fixedUniforms[x].set(o[x]);m&&m.setUniforms(t,this.binderUniforms,p,{zoom:f});let b=0;switch(e){case _.LINES:b=2;break;case _.TRIANGLES:b=3;break;case _.LINE_STRIP:b=1}for(const x of d.get()){const n=x.vaos||(x.vaos={});(n[c]||(n[c]=new Tn)).bind(t,this,u,m?m.getPaintVertexBuffers():[],h,x.vertexOffset,g,y,v),_.drawElements(e,x.primitiveLength*b,_.UNSIGNED_SHORT,x.primitiveOffset*b*2)}}}function In(t,n,i){const r=1/e.aC(i,1,n.transform.tileZoom),a=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,n.transform.tileZoom)/a,s=o*(i.tileID.canonical.x+i.tileID.wrap*a),l=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,l>>16],u_pixel_coord_lower:[65535&s,65535&l]}}const Ln=(t,n,i,r)=>{const a=t.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=e.bV();"viewport"===a.properties.get("anchor")&&e.bW(l,t.transform.bearingInRadians),e.bX(s,s,l);const c=t.transform.transformLightDirection(s),u=a.properties.get("color");return{u_lightpos:s,u_lightpos_globe:c,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:i,u_fill_translate:r}},kn=(t,n,i,r,a,o,s)=>e.e(Ln(t,n,i,r),In(o,t,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8}),Rn=(t,n,i,r)=>e.e(In(n,t,i),{u_fill_translate:r}),Dn=(t,e)=>({u_world:t,u_fill_translate:e}),Nn=(t,n,i,r,a)=>e.e(Rn(t,n,i,a),{u_world:r}),zn=(t,n,i,r,a)=>{const o=t.transform;let s,l,c=0;if("map"===i.paint.get("circle-pitch-alignment")){const t=e.aC(n,1,o.zoom);s=!0,l=[t,t],c=t/(e.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*a}else s=!1,l=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_pitch_with_map:+s,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:r}},Fn=t=>({u_pixel_extrude_scale:[1/t.width,1/t.height]}),On=t=>({u_viewport_size:[t.width,t.height]}),Bn=function(t){return{u_color:t,u_overlay:0,u_overlay_scale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1}},Un=(t,n,i,r)=>{const a=e.aC(t,1,n)/(e.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*r;return{u_extrude_scale:e.aC(t,1,n),u_intensity:i,u_globe_extrude_scale:a}},jn=(t,n,i,r)=>{const a=e.L();e.bY(a,0,t.width,t.height,0,0,1);const o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:i,u_color_ramp:r,u_opacity:n.paint.get("heatmap-opacity")}},Vn=(t,e,n)=>{const i=n.paint.get("hillshade-accent-color");let r;switch(n.paint.get("hillshade-method")){case"basic":r=4;break;case"combined":r=1;break;case"igor":r=2;break;case"multidirectional":r=3;break;default:r=0}const a=n.getIlluminationProperties();for(let o=0;o<a.directionRadians.length;o++)"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a.directionRadians[o]+=t.transform.bearingInRadians);return{u_image:0,u_latrange:Gn(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:a.altitudeRadians,u_azimuths:a.directionRadians,u_accent:i,u_method:r,u_highlights:a.highlightColor,u_shadows:a.shadowColor}},Hn=(t,n)=>{const i=n.stride,r=e.L();return e.bY(r,0,e.$,-e.$,0,0,1),e.M(r,r,[0,-e.$,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ,u_unpack:n.getUnpackVector()}};function Gn(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.a1(0,r/i).toLngLat().lat,new e.a1(0,(r+1)/i).toLngLat().lat]}const Wn=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:t.paint.get("color-relief-opacity")}},qn=(t,n,i,r)=>{const a=t.transform;return{u_translation:Jn(t,n,i),u_ratio:r/e.aC(n,1,a.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Zn=(t,n,i,r,a)=>e.e(qn(t,n,i,r),{u_image:0,u_image_height:a}),Xn=(t,n,i,r,a)=>{const o=t.transform,s=Kn(n,o);return{u_translation:Jn(t,n,i),u_texsize:n.imageAtlasTexture.size,u_ratio:r/e.aC(n,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Yn=(t,n,i,r,a,o)=>{const s=t.lineAtlas,l=Kn(n,t.transform),c="round"===i.layout.get("line-cap"),u=s.getDash(a.from,c),h=s.getDash(a.to,c),d=u.width*o.fromScale,p=h.width*o.toScale;return e.e(qn(t,n,i,r),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:s.width/(256*Math.min(d,p)*t.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Kn(t,n){return 1/e.aC(t,1,n.tileZoom)}function Jn(t,n,i){return e.aD(t.transform,n,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const $n=(t,e,n,i,r)=>{return{u_tl_parent:t,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(o=i.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=i.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Qn(i.paint.get("raster-hue-rotate")),u_coords_top:[r[0].x,r[0].y,r[1].x,r[1].y],u_coords_bottom:[r[3].x,r[3].y,r[2].x,r[2].y]};var a,o};function Qn(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const ti=(t,e,n,i,r,a,o,s,l,c,u,h,d)=>{const p=o.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:p.width/p.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+i,u_is_along_line:r,u_is_variable_anchor:a,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},ei=(t,n,i,r,a,o,s,l,c,u,h,d,p,f)=>{const m=s.transform;return e.e(ti(t,n,i,r,a,o,s,l,c,u,h,d,f),{u_gamma_scale:r?Math.cos(m.pitch*Math.PI/180)*m.cameraToCenterDistance:1,u_device_pixel_ratio:s.pixelRatio,u_is_halo:1})},ni=(t,n,i,r,a,o,s,l,c,u,h,d,p)=>e.e(ei(t,n,i,r,a,o,s,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),ii=(t,e)=>({u_opacity:t,u_color:e}),ri=(t,n,i,r,a)=>e.e(function(t,n,i,r){const a=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:l}=i.imageManager.getPixelSize(),c=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(r.tileID.canonical.x+r.tileID.wrap*c),d=u*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:a.tl,u_pattern_br_a:a.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,l],u_mix:n.t,u_pattern_size_a:a.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:n.fromScale,u_scale_b:n.toScale,u_tile_units_to_pixels:1/e.aC(r,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(i,a,n,r),{u_opacity:t}),ai=(t,e)=>{},oi={fillExtrusion:(t,n)=>({u_lightpos:new e.bT(t,n.u_lightpos),u_lightpos_globe:new e.bT(t,n.u_lightpos_globe),u_lightintensity:new e.bg(t,n.u_lightintensity),u_lightcolor:new e.bT(t,n.u_lightcolor),u_vertical_gradient:new e.bg(t,n.u_vertical_gradient),u_opacity:new e.bg(t,n.u_opacity),u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillExtrusionPattern:(t,n)=>({u_lightpos:new e.bT(t,n.u_lightpos),u_lightpos_globe:new e.bT(t,n.u_lightpos_globe),u_lightintensity:new e.bg(t,n.u_lightintensity),u_lightcolor:new e.bT(t,n.u_lightcolor),u_vertical_gradient:new e.bg(t,n.u_vertical_gradient),u_height_factor:new e.bg(t,n.u_height_factor),u_opacity:new e.bg(t,n.u_opacity),u_fill_translate:new e.bU(t,n.u_fill_translate),u_image:new e.bP(t,n.u_image),u_texsize:new e.bU(t,n.u_texsize),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade)}),fill:(t,n)=>({u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillPattern:(t,n)=>({u_image:new e.bP(t,n.u_image),u_texsize:new e.bU(t,n.u_texsize),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade),u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillOutline:(t,n)=>({u_world:new e.bU(t,n.u_world),u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillOutlinePattern:(t,n)=>({u_world:new e.bU(t,n.u_world),u_image:new e.bP(t,n.u_image),u_texsize:new e.bU(t,n.u_texsize),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade),u_fill_translate:new e.bU(t,n.u_fill_translate)}),circle:(t,n)=>({u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_scale_with_map:new e.bP(t,n.u_scale_with_map),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_extrude_scale:new e.bU(t,n.u_extrude_scale),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_globe_extrude_scale:new e.bg(t,n.u_globe_extrude_scale),u_translate:new e.bU(t,n.u_translate)}),collisionBox:(t,n)=>({u_pixel_extrude_scale:new e.bU(t,n.u_pixel_extrude_scale)}),collisionCircle:(t,n)=>({u_viewport_size:new e.bU(t,n.u_viewport_size)}),debug:(t,n)=>({u_color:new e.bQ(t,n.u_color),u_overlay:new e.bP(t,n.u_overlay),u_overlay_scale:new e.bg(t,n.u_overlay_scale)}),depth:ai,clippingMask:ai,heatmap:(t,n)=>({u_extrude_scale:new e.bg(t,n.u_extrude_scale),u_intensity:new e.bg(t,n.u_intensity),u_globe_extrude_scale:new e.bg(t,n.u_globe_extrude_scale)}),heatmapTexture:(t,n)=>({u_matrix:new e.bR(t,n.u_matrix),u_world:new e.bU(t,n.u_world),u_image:new e.bP(t,n.u_image),u_color_ramp:new e.bP(t,n.u_color_ramp),u_opacity:new e.bg(t,n.u_opacity)}),hillshade:(t,n)=>({u_image:new e.bP(t,n.u_image),u_latrange:new e.bU(t,n.u_latrange),u_exaggeration:new e.bg(t,n.u_exaggeration),u_altitudes:new e.b_(t,n.u_altitudes),u_azimuths:new e.b_(t,n.u_azimuths),u_accent:new e.bQ(t,n.u_accent),u_method:new e.bP(t,n.u_method),u_shadows:new e.bZ(t,n.u_shadows),u_highlights:new e.bZ(t,n.u_highlights)}),hillshadePrepare:(t,n)=>({u_matrix:new e.bR(t,n.u_matrix),u_image:new e.bP(t,n.u_image),u_dimension:new e.bU(t,n.u_dimension),u_zoom:new e.bg(t,n.u_zoom),u_unpack:new e.bS(t,n.u_unpack)}),colorRelief:(t,n)=>({u_image:new e.bP(t,n.u_image),u_unpack:new e.bS(t,n.u_unpack),u_dimension:new e.bU(t,n.u_dimension),u_elevation_stops:new e.bP(t,n.u_elevation_stops),u_color_stops:new e.bP(t,n.u_color_stops),u_color_ramp_size:new e.bP(t,n.u_color_ramp_size),u_opacity:new e.bg(t,n.u_opacity)}),line:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels)}),lineGradient:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels),u_image:new e.bP(t,n.u_image),u_image_height:new e.bg(t,n.u_image_height)}),linePattern:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_texsize:new e.bU(t,n.u_texsize),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_image:new e.bP(t,n.u_image),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade)}),lineSDF:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels),u_patternscale_a:new e.bU(t,n.u_patternscale_a),u_patternscale_b:new e.bU(t,n.u_patternscale_b),u_sdfgamma:new e.bg(t,n.u_sdfgamma),u_image:new e.bP(t,n.u_image),u_tex_y_a:new e.bg(t,n.u_tex_y_a),u_tex_y_b:new e.bg(t,n.u_tex_y_b),u_mix:new e.bg(t,n.u_mix)}),raster:(t,n)=>({u_tl_parent:new e.bU(t,n.u_tl_parent),u_scale_parent:new e.bg(t,n.u_scale_parent),u_buffer_scale:new e.bg(t,n.u_buffer_scale),u_fade_t:new e.bg(t,n.u_fade_t),u_opacity:new e.bg(t,n.u_opacity),u_image0:new e.bP(t,n.u_image0),u_image1:new e.bP(t,n.u_image1),u_brightness_low:new e.bg(t,n.u_brightness_low),u_brightness_high:new e.bg(t,n.u_brightness_high),u_saturation_factor:new e.bg(t,n.u_saturation_factor),u_contrast_factor:new e.bg(t,n.u_contrast_factor),u_spin_weights:new e.bT(t,n.u_spin_weights),u_coords_top:new e.bS(t,n.u_coords_top),u_coords_bottom:new e.bS(t,n.u_coords_bottom)}),symbolIcon:(t,n)=>({u_is_size_zoom_constant:new e.bP(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bP(t,n.u_is_size_feature_constant),u_size_t:new e.bg(t,n.u_size_t),u_size:new e.bg(t,n.u_size),u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_pitch:new e.bg(t,n.u_pitch),u_rotate_symbol:new e.bP(t,n.u_rotate_symbol),u_aspect_ratio:new e.bg(t,n.u_aspect_ratio),u_fade_change:new e.bg(t,n.u_fade_change),u_label_plane_matrix:new e.bR(t,n.u_label_plane_matrix),u_coord_matrix:new e.bR(t,n.u_coord_matrix),u_is_text:new e.bP(t,n.u_is_text),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_is_along_line:new e.bP(t,n.u_is_along_line),u_is_variable_anchor:new e.bP(t,n.u_is_variable_anchor),u_texsize:new e.bU(t,n.u_texsize),u_texture:new e.bP(t,n.u_texture),u_translation:new e.bU(t,n.u_translation),u_pitched_scale:new e.bg(t,n.u_pitched_scale)}),symbolSDF:(t,n)=>({u_is_size_zoom_constant:new e.bP(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bP(t,n.u_is_size_feature_constant),u_size_t:new e.bg(t,n.u_size_t),u_size:new e.bg(t,n.u_size),u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_pitch:new e.bg(t,n.u_pitch),u_rotate_symbol:new e.bP(t,n.u_rotate_symbol),u_aspect_ratio:new e.bg(t,n.u_aspect_ratio),u_fade_change:new e.bg(t,n.u_fade_change),u_label_plane_matrix:new e.bR(t,n.u_label_plane_matrix),u_coord_matrix:new e.bR(t,n.u_coord_matrix),u_is_text:new e.bP(t,n.u_is_text),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_is_along_line:new e.bP(t,n.u_is_along_line),u_is_variable_anchor:new e.bP(t,n.u_is_variable_anchor),u_texsize:new e.bU(t,n.u_texsize),u_texture:new e.bP(t,n.u_texture),u_gamma_scale:new e.bg(t,n.u_gamma_scale),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_is_halo:new e.bP(t,n.u_is_halo),u_translation:new e.bU(t,n.u_translation),u_pitched_scale:new e.bg(t,n.u_pitched_scale)}),symbolTextAndIcon:(t,n)=>({u_is_size_zoom_constant:new e.bP(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bP(t,n.u_is_size_feature_constant),u_size_t:new e.bg(t,n.u_size_t),u_size:new e.bg(t,n.u_size),u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_pitch:new e.bg(t,n.u_pitch),u_rotate_symbol:new e.bP(t,n.u_rotate_symbol),u_aspect_ratio:new e.bg(t,n.u_aspect_ratio),u_fade_change:new e.bg(t,n.u_fade_change),u_label_plane_matrix:new e.bR(t,n.u_label_plane_matrix),u_coord_matrix:new e.bR(t,n.u_coord_matrix),u_is_text:new e.bP(t,n.u_is_text),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_is_along_line:new e.bP(t,n.u_is_along_line),u_is_variable_anchor:new e.bP(t,n.u_is_variable_anchor),u_texsize:new e.bU(t,n.u_texsize),u_texsize_icon:new e.bU(t,n.u_texsize_icon),u_texture:new e.bP(t,n.u_texture),u_texture_icon:new e.bP(t,n.u_texture_icon),u_gamma_scale:new e.bg(t,n.u_gamma_scale),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_is_halo:new e.bP(t,n.u_is_halo),u_translation:new e.bU(t,n.u_translation),u_pitched_scale:new e.bg(t,n.u_pitched_scale)}),background:(t,n)=>({u_opacity:new e.bg(t,n.u_opacity),u_color:new e.bQ(t,n.u_color)}),backgroundPattern:(t,n)=>({u_opacity:new e.bg(t,n.u_opacity),u_image:new e.bP(t,n.u_image),u_pattern_tl_a:new e.bU(t,n.u_pattern_tl_a),u_pattern_br_a:new e.bU(t,n.u_pattern_br_a),u_pattern_tl_b:new e.bU(t,n.u_pattern_tl_b),u_pattern_br_b:new e.bU(t,n.u_pattern_br_b),u_texsize:new e.bU(t,n.u_texsize),u_mix:new e.bg(t,n.u_mix),u_pattern_size_a:new e.bU(t,n.u_pattern_size_a),u_pattern_size_b:new e.bU(t,n.u_pattern_size_b),u_scale_a:new e.bg(t,n.u_scale_a),u_scale_b:new e.bg(t,n.u_scale_b),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.bg(t,n.u_tile_units_to_pixels)}),terrain:(t,n)=>({u_texture:new e.bP(t,n.u_texture),u_ele_delta:new e.bg(t,n.u_ele_delta),u_fog_matrix:new e.bR(t,n.u_fog_matrix),u_fog_color:new e.bQ(t,n.u_fog_color),u_fog_ground_blend:new e.bg(t,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new e.bg(t,n.u_fog_ground_blend_opacity),u_horizon_color:new e.bQ(t,n.u_horizon_color),u_horizon_fog_blend:new e.bg(t,n.u_horizon_fog_blend),u_is_globe_mode:new e.bg(t,n.u_is_globe_mode)}),terrainDepth:(t,n)=>({u_ele_delta:new e.bg(t,n.u_ele_delta)}),terrainCoords:(t,n)=>({u_texture:new e.bP(t,n.u_texture),u_terrain_coords_id:new e.bg(t,n.u_terrain_coords_id),u_ele_delta:new e.bg(t,n.u_ele_delta)}),projectionErrorMeasurement:(t,n)=>({u_input:new e.bg(t,n.u_input),u_output_expected:new e.bg(t,n.u_output_expected)}),atmosphere:(t,n)=>({u_sun_pos:new e.bT(t,n.u_sun_pos),u_atmosphere_blend:new e.bg(t,n.u_atmosphere_blend),u_globe_position:new e.bT(t,n.u_globe_position),u_globe_radius:new e.bg(t,n.u_globe_radius),u_inv_proj_matrix:new e.bR(t,n.u_inv_proj_matrix)}),sky:(t,n)=>({u_sky_color:new e.bQ(t,n.u_sky_color),u_horizon_color:new e.bQ(t,n.u_horizon_color),u_horizon:new e.bU(t,n.u_horizon),u_horizon_normal:new e.bU(t,n.u_horizon_normal),u_sky_horizon_blend:new e.bg(t,n.u_sky_horizon_blend),u_sky_blend:new e.bg(t,n.u_sky_blend)})};class si{constructor(t,e,n){this.context=t;const i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const li={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ci{constructor(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error("Length of new data is ".concat(t.length,", which doesn't match current length of ").concat(this.length));const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let n=0;n<this.attributes.length;n++){const i=e.attributes[this.attributes[n].name];void 0!==i&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,e,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],a=e.attributes[r.name];void 0!==a&&t.vertexAttribPointer(a,r.components,t[li[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ui{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hi extends ui{getDefault(){return e.bf.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class di extends ui{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class pi extends ui{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class fi extends ui{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mi extends ui{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gi extends ui{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class yi extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class vi extends ui{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class _i extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class bi extends ui{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class xi extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class wi extends ui{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Si extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class Mi extends ui{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ti extends ui{getDefault(){return e.bf.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ai extends ui{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ei extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class Ci extends ui{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Pi extends ui{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ii extends ui{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Li extends ui{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ki extends ui{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ri extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Di extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ni extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class zi extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Fi extends ui{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oi extends ui{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const n=this.gl;qe(n)?n.bindVertexArray(t):null===(e=n.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Bi extends ui{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ui extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ji extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Vi extends ui{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Hi extends Vi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Gi extends Vi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wi extends Vi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const qi="Framebuffer is not complete";class Zi{constructor(t,e,n,i,r){this.context=t,this.width=e,this.height=n;const a=t.gl,o=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new Hi(t,o),i)this.depthAttachment=r?new Wi(t,o):new Gi(t,o);else if(r)throw new Error("Stencil cannot be set without depth");if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw new Error(qi)}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Xi{constructor(t){var e,n;if(this.gl=t,this.clearColor=new hi(this),this.clearDepth=new di(this),this.clearStencil=new pi(this),this.colorMask=new fi(this),this.depthMask=new mi(this),this.stencilMask=new gi(this),this.stencilFunc=new yi(this),this.stencilOp=new vi(this),this.stencilTest=new _i(this),this.depthRange=new bi(this),this.depthTest=new xi(this),this.depthFunc=new wi(this),this.blend=new Si(this),this.blendFunc=new Mi(this),this.blendColor=new Ti(this),this.blendEquation=new Ai(this),this.cullFace=new Ei(this),this.cullFaceSide=new Ci(this),this.frontFace=new Pi(this),this.program=new Ii(this),this.activeTexture=new Li(this),this.viewport=new ki(this),this.bindFramebuffer=new Ri(this),this.bindRenderbuffer=new Di(this),this.bindTexture=new Ni(this),this.bindVertexBuffer=new zi(this),this.bindElementBuffer=new Fi(this),this.bindVertexArray=new Oi(this),this.pixelStoreUnpack=new Bi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ui(this),this.pixelStoreUnpackFlipY=new ji(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),qe(t)){this.HALF_FLOAT=t.HALF_FLOAT;const i=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==i?void 0:i.RGBA16F_EXT,this.RGB16F=null!==(n=t.RGB16F)&&void 0!==n?n:null==i?void 0:i.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new si(this,t,e)}createVertexBuffer(t,e,n){return new ci(this,t,e,n)}createRenderbuffer(t,e,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,n,i){return new Zi(this,t,e,n,i)}clear(t){let{color:e,depth:n,stencil:i}=t;const r=this.gl;let a=0;e&&(a|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(a|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(a|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(a)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bH(t.blendFunction,Be.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return qe(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return qe(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Yi;function Ki(t,n,i,r,a){const o=t.context,s=t.transform,l=o.gl,c=t.useProgram("collisionBox"),u=[];let h=0,d=0;for(let e=0;e<r.length;e++){const p=r[e],f=n.getTile(p).getBucket(i);if(!f)continue;const m=a?f.textCollisionBox:f.iconCollisionBox,g=f.collisionCircleArray;g.length>0&&(u.push({circleArray:g,circleOffset:d,coord:p}),h+=g.length/4,d=h),m&&c.draw(o,l.LINES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,Fn(t.transform),t.style.map.terrain&&t.style.map.terrain.getTerrainData(p),s.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,t.transform.zoom,null,null,m.collisionVertexBuffer)}if(!a||!u.length)return;const p=t.useProgram("collisionCircle"),f=new e.b$;f.resize(4*h),f._trim();let m=0;for(const e of u)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],a=e.circleArray[n+2],o=e.circleArray[n+3];f.emplace(m++,i,r,a,o,0),f.emplace(m++,i,r,a,o,1),f.emplace(m++,i,r,a,o,2),f.emplace(m++,i,r,a,o,3)}(!Yi||Yi.length<2*h)&&(Yi=function(t){const n=2*t,i=new e.c1;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(h));const g=o.createIndexBuffer(Yi,!0),y=o.createVertexBuffer(f,e.c0.members,!0);for(const v of u){const n=On(t.transform);p.draw(o,l.TRIANGLES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,n,t.style.map.terrain&&t.style.map.terrain.getTerrainData(v.coord),null,i.id,y,g,e.aM.simpleSegment(0,2*v.circleOffset,v.circleArray.length,v.circleArray.length/2),null,t.transform.zoom,null,null,null)}y.destroy(),g.destroy()}const Ji=e.ag(new Float32Array(16));function $i(t,n,i,r,a,o){const{horizontalAlign:s,verticalAlign:l}=e.aH(t);return new e.P((-(s-.5)*n/a+r[0])*o,(-(l-.5)*i/a+r[1])*o)}function Qi(t,n,i,r,a,o){const s=n.tileAnchorPoint.add(new e.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let t=r.mult(o);i||(t=t.rotate(-a));const e=s.add(t);return Pt(e.x,e.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(i){const e=Ot(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(t),i=Math.atan(e.y/e.x)+(e.x<0?Math.PI:0);return t.add(r.rotate(i))}return t.add(r)}function tr(t,n,i,r,a,o,s,l,c,u,h,d){const p=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,g={};f.clear();for(let y=0;y<p.length;y++){const m=p.get(y),v=m.hidden||!m.crossTileID||t.allowVerticalPlacement&&!m.placedOrientation?null:r[m.crossTileID];if(v){const r=new e.P(m.anchorX,m.anchorY),p={getElevation:d,width:a.width,height:a.height,pitchedLabelPlaneMatrix:o,pitchWithMap:i,transform:a,tileAnchorPoint:r,translation:u,unwrappedTileID:h},y=i?Ut(r.x,r.y,p):Ot(r.x,r.y,p),_=It(a.cameraToCenterDistance,y.signedDistanceFromCamera);let b=e.ap(t.textSizeData,l,m)*_/e.aB;i&&(b*=t.tilePixelRatio/s);const{width:x,height:w,anchor:S,textOffset:M,textBoxScale:T}=v,A=$i(S,x,w,M,T,b),E=a.getPitchedTextCorrection(r.x+u[0],r.y+u[1],h),C=Qi(y.point,p,n,A,-a.bearingInRadians,E),P=t.allowVerticalPlacement&&m.placedOrientation===e.ao.vertical?Math.PI/2:0;for(let t=0;t<m.numGlyphs;t++)e.av(f,C,P);c&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:C,angle:P})}else Wt(m.numGlyphs,f)}if(c){m.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t);if(i.hidden)Wt(i.numGlyphs,m);else{const n=g[t];if(n)for(let t=0;t<i.numGlyphs;t++)e.av(m,n.shiftedAnchor,n.angle);else Wt(i.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function er(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nr(t,n,i,r,a,o,s,l,c,u,h,d,p){const f=t.context,m=f.gl,g=t.transform,y="map"===l,v="map"===c,_="viewport"!==l&&"point"!==i.layout.get("symbol-placement"),b=y&&!v&&!_,x=!i.layout.get("symbol-sort-key").isConstant();let w=!1;const S=t.getDepthModeForSublayer(0,Ve.ReadOnly),M=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=[],A=g.getCircleRadiusCorrection();for(const E of r){const r=n.getTile(E),l=r.getBucket(i);if(!l)continue;const c=a?l.text:l.icon;if(!c||!c.segments.get().length||!c.hasVisibleVertices)continue;const h=c.programConfigurations.get(i.id),d=a||l.sdfIcons,f=a?l.textSizeData:l.iconSizeData,S=v||0!==g.pitch,C=t.useProgram(er(d,a,l),h),P=e.an(f,g.zoom),I=t.style.map.terrain&&t.style.map.terrain.getTerrainData(E);let L,k,R,D,N=[0,0],z=null;if(a)k=r.glyphAtlasTexture,R=m.LINEAR,L=r.glyphAtlasTexture.size,l.iconsInText&&(N=r.imageAtlasTexture.size,z=r.imageAtlasTexture,D=S||t.options.rotating||t.options.zooming||"composite"===f.kind||"camera"===f.kind?m.LINEAR:m.NEAREST);else{const e=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;k=r.imageAtlasTexture,R=d||t.options.rotating||t.options.zooming||e||S?m.LINEAR:m.NEAREST,L=r.imageAtlasTexture.size}const F=e.aC(r,1,t.transform.zoom),O=At(y,t.transform,F),B=e.L();e.aq(B,O);const U=Et(v,y,t.transform,F),j=e.aD(g,r,o,s),V=g.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),H=M&&l.hasTextData(),G="none"!==i.layout.get("icon-text-fit")&&H&&l.hasIconData();if(_){const e=t.style.map.terrain?(e,n)=>t.style.map.terrain.getElevation(E,e,n):null,n="map"===i.layout.get("text-rotation-alignment");kt(l,t,a,O,B,v,u,n,E.toUnwrapped(),g.width,g.height,j,e)}const W=a&&M||G,q=_||W?Ji:v?O:t.transform.clipSpaceToPixelsMatrix,Z=d&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let X;X=d?l.iconsInText?ni(f.kind,P,b,v,_,W,t,q,U,j,L,N,A):ei(f.kind,P,b,v,_,W,t,q,U,j,a,L,0,A):ti(f.kind,P,b,v,_,W,t,q,U,j,a,L,A);const Y={program:C,buffers:c,uniformValues:X,projectionData:V,atlasTexture:k,atlasTextureIcon:z,atlasInterpolation:R,atlasInterpolationIcon:D,isSDF:d,hasHalo:Z};if(x&&l.canOverlap){w=!0;const t=c.segments.get();for(const n of t)T.push({segments:new e.aM([n]),sortKey:n.sortKey,state:Y,terrainData:I})}else T.push({segments:c.segments,sortKey:0,state:Y,terrainData:I})}w&&T.sort((t,e)=>t.sortKey-e.sortKey);for(const e of T){const n=e.state;if(f.activeTexture.set(m.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,m.CLAMP_TO_EDGE),n.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,ir(n.buffers,e.segments,i,t,n.program,S,h,d,r,n.projectionData,e.terrainData)),r.u_is_halo=0}ir(n.buffers,e.segments,i,t,n.program,S,h,d,n.uniformValues,n.projectionData,e.terrainData)}}function ir(t,e,n,i,r,a,o,s,l,c,u){const h=i.context;r.draw(h,h.gl.TRIANGLES,a,o,s,je.backCCW,l,u,c,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function rr(t,n,i,r,a){const o=t.context,s=o.gl,l=Ge.disabled,c=new Be([s.ONE,s.ONE],e.bf.transparent,[!0,!0,!0,!0]),u=n.getBucket(i);if(!u)return;const h=r.key;let d=i.heatmapFbos.get(h);d||(d=or(o,n.tileSize,n.tileSize),i.heatmapFbos.set(h,d)),o.bindFramebuffer.set(d.framebuffer),o.viewport.set([0,0,n.tileSize,n.tileSize]),o.clear({color:e.bf.transparent});const p=u.programConfigurations.get(i.id),f=t.useProgram("heatmap",p,!a),m=t.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g=t.style.map.terrain.getTerrainData(r);f.draw(o,s.TRIANGLES,Ve.disabled,l,c,je.disabled,Un(n,t.transform.zoom,i.paint.get("heatmap-intensity"),1),g,m,i.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,i.paint,t.transform.zoom,p)}function ar(t,e,n,i,r){const a=t.context,o=a.gl,s=t.transform;a.setColorMode(t.colorModeForRenderPass());const l=sr(a,e),c=n.key,u=e.heatmapFbos.get(c);if(!u)return;a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,u.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1),l.bind(o.LINEAR,o.CLAMP_TO_EDGE);const h=s.getProjectionData({overscaledTileID:n,applyTerrainMatrix:r,applyGlobeMatrix:!i});t.useProgram("heatmapTexture").draw(a,o.TRIANGLES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,jn(t,e,0,1),null,h,e.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments,e.paint,s.zoom),u.destroy(),e.heatmapFbos.delete(c)}function or(t,e,n){var i,r;const a=t.gl,o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);const s=null!==(i=t.HALF_FLOAT)&&void 0!==i?i:a.UNSIGNED_BYTE,l=null!==(r=t.RGBA16F)&&void 0!==r?r:a.RGBA;a.texImage2D(a.TEXTURE_2D,0,l,e,n,0,a.RGBA,s,null);const c=t.createFramebuffer(e,n,!1,!1);return c.colorAttachment.set(o),c}function sr(t,n){return n.colorRampTexture||(n.colorRampTexture=new e.T(t,n.colorRamp,t.gl.RGBA)),n.colorRampTexture}function lr(t,e,n,i,r){if(!n||!i||!i.imageAtlas)return;const a=i.imageAtlas.patternPositions;let o=a[n.to.toString()],s=a[n.from.toString()];if(!o&&s&&(o=s),!s&&o&&(s=o),!o||!s){const t=r.getPaintProperty(e);o=a[t],s=a[t]}o&&s&&t.setConstantPatternPositions(o,s)}function cr(t,n,i,r,a,o,s,l){const c=t.context.gl,u="fill-pattern",h=i.paint.get(u),d=h&&h.constantOr(1),p=i.getCrossfadeParameters();let f,m,g,y,v;const _=t.transform,b=i.paint.get("fill-translate"),x=i.paint.get("fill-translate-anchor");s?(m=d&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(m=d?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const S of r){const r=n.getTile(S);if(d&&!r.patternsLoaded())continue;const h=r.getBucket(i);if(!h)continue;const M=h.programConfigurations.get(i.id),T=t.useProgram(m,M),A=t.style.map.terrain&&t.style.map.terrain.getTerrainData(S);d&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),M.updatePaintBuffers(p)),lr(M,u,w,r,i);const E=_.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),C=e.aD(_,r,b,x);if(s){y=h.indexBuffer2,v=h.segments2;const e=[c.drawingBufferWidth,c.drawingBufferHeight];g="fillOutlinePattern"===m&&d?Nn(t,p,r,e,C):Dn(e,C)}else y=h.indexBuffer,v=h.segments,g=d?Rn(t,p,r,C):{u_fill_translate:C};const P=t.stencilModeForClipping(S);T.draw(t.context,f,a,P,o,je.backCCW,g,A,E,i.id,h.layoutVertexBuffer,y,v,i.paint,t.transform.zoom,M)}}function ur(t,n,i,r,a,o,s,l){const c=t.context,u=c.gl,h="fill-extrusion-pattern",d=i.paint.get(h),p=d.constantOr(1),f=i.getCrossfadeParameters(),m=i.paint.get("fill-extrusion-opacity"),g=d.constantOr(null),y=t.transform;for(const v of r){const r=n.getTile(v),d=r.getBucket(i);if(!d)continue;const _=t.style.map.terrain&&t.style.map.terrain.getTerrainData(v),b=d.programConfigurations.get(i.id),x=t.useProgram(p?"fillExtrusionPattern":"fillExtrusion",b);p&&(t.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),b.updatePaintBuffers(f));const w=y.getProjectionData({overscaledTileID:v,applyGlobeMatrix:!l,applyTerrainMatrix:!0});lr(b,h,g,r,i);const S=e.aD(y,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),M=i.paint.get("fill-extrusion-vertical-gradient"),T=p?kn(t,M,m,S,v,f,r):Ln(t,M,m,S);x.draw(c,c.gl.TRIANGLES,a,o,s,je.backCCW,T,_,w,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,b,t.style.map.terrain&&d.centroidVertexBuffer)}}function hr(t,e,n,i,r,a,o,s,l){var c;const u=t.style.projection,h=t.context,d=t.transform,p=h.gl,f=["#define NUM_ILLUMINATION_SOURCES ".concat(n.paint.get("hillshade-highlight-color").values.length)],m=t.useProgram("hillshade",null,!1,f),g=!t.options.moving;for(const y of i){const i=e.getTile(y),f=i.fbo;if(!f)continue;const v=u.getMeshFromTileID(h,y.canonical,s,!0,"raster"),_=null===(c=t.style.map.terrain)||void 0===c?void 0:c.getTerrainData(y);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get());const b=d.getProjectionData({overscaledTileID:y,aligned:g,applyGlobeMatrix:!l,applyTerrainMatrix:!0});m.draw(h,p.TRIANGLES,a,r[y.overscaledZ],o,je.backCCW,Vn(t,i,n),_,b,n.id,v.vertexBuffer,v.indexBuffer,v.segments)}}function dr(t,n,i,r,a,o,s,l,c){var u;const h=t.style.projection,d=t.context,p=t.transform,f=d.gl,m=t.useProgram("colorRelief"),g=!t.options.moving;let y=!0,v=0;for(const _ of r){const r=n.getTile(_),b=r.dem;if(y){const t=f.getParameter(f.MAX_TEXTURE_SIZE),{elevationTexture:e,colorTexture:n}=i.getColorRampTextures(d,t,b.getUnpackVector());d.activeTexture.set(f.TEXTURE1),e.bind(f.NEAREST,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE4),n.bind(f.LINEAR,f.CLAMP_TO_EDGE),y=!1,v=e.size[0]}if(!b||!b.data)continue;const x=b.stride,w=b.getPixels();if(d.activeTexture.set(f.TEXTURE0),d.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(x),r.demTexture){const t=r.demTexture;t.update(w,{premultiply:!1}),t.bind(f.LINEAR,f.CLAMP_TO_EDGE)}else r.demTexture=new e.T(d,w,f.RGBA,{premultiply:!1}),r.demTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=h.getMeshFromTileID(d,_.canonical,l,!0,"raster"),M=null===(u=t.style.map.terrain)||void 0===u?void 0:u.getTerrainData(_),T=p.getProjectionData({overscaledTileID:_,aligned:g,applyGlobeMatrix:!c,applyTerrainMatrix:!0});m.draw(d,f.TRIANGLES,o,a[_.overscaledZ],s,je.backCCW,Wn(i,r.dem,v),M,T,i.id,S.vertexBuffer,S.indexBuffer,S.segments)}}const pr=[new e.P(0,0),new e.P(e.$,0),new e.P(e.$,e.$),new e.P(0,e.$)];function fr(t,e,n,i,r,a,o,s){let l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const u=i[i.length-1].overscaledZ,h=t.context,d=h.gl,p=t.useProgram("raster"),f=t.transform,m=t.style.projection,g=t.colorModeForRenderPass(),y=!t.options.moving;for(const v of i){const i=t.getDepthModeForSublayer(v.overscaledZ-u,1===n.paint.get("raster-opacity")?Ve.ReadWrite:Ve.ReadOnly,d.LESS),_=e.getTile(v);_.registerFadeDuration(n.paint.get("raster-fade-duration"));const b=e.findLoadedParent(v,0),x=e.findLoadedSibling(v),w=mr(_,b||x||null,e,n,t.transform,t.style.map.terrain);let S,M;const T="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),_.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1),b?(b.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),S=Math.pow(2,b.tileID.overscaledZ-_.tileID.overscaledZ),M=[_.tileID.canonical.x*S%1,_.tileID.canonical.y*S%1]):_.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),_.texture.useMipmap&&h.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const A=t.style.map.terrain&&t.style.map.terrain.getTerrainData(v),E=f.getProjectionData({overscaledTileID:v,aligned:y,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),C=$n(M||[0,0],S||1,w,n,s),P=m.getMeshFromTileID(h,v.canonical,a,o,"raster");p.draw(h,d.TRIANGLES,i,r?r[v.overscaledZ]:Ge.disabled,g,l?je.frontCCW:je.backCCW,C,A,E,n.id,P.vertexBuffer,P.indexBuffer,P.segments)}}function mr(t,n,i,r,a,s){const l=r.paint.get("raster-fade-duration");if(!s&&l>0){const r=o.now(),s=(r-t.timeAdded)/l,c=n?(r-n.timeAdded)/l:-1,u=i.getSource(),h=yt(a,{tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),p=d&&t.refreshedUponExpiration?1:e.ah(d?s:1-c,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const gr=new e.bf(1,0,0,1),yr=new e.bf(0,1,0,1),vr=new e.bf(0,0,1,1),_r=new e.bf(1,0,1,1),br=new e.bf(0,1,1,1);function xr(t,e,n,i){Sr(t,0,e+n/2,t.transform.width,n,i)}function wr(t,e,n,i){Sr(t,e-n/2,0,n,t.transform.height,i)}function Sr(t,e,n,i,r,a){const o=t.context,s=o.gl;s.enable(s.SCISSOR_TEST),s.scissor(e*t.pixelRatio,n*t.pixelRatio,i*t.pixelRatio,r*t.pixelRatio),o.clear({color:a}),s.disable(s.SCISSOR_TEST)}function Mr(t,n,i){const r=t.context,a=r.gl,o=t.useProgram("debug"),s=Ve.disabled,l=Ge.disabled,c=t.colorModeForRenderPass(),u="$debug",h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(i);r.activeTexture.set(a.TEXTURE0);const d=n.getTileByID(i.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(i).tileSize,m=512/Math.min(f,512)*(i.overscaledZ/t.transform.zoom)*.5;let g=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(g+=" => ".concat(i.overscaledZ)),function(t,e){t.initDebugOverlayCanvas();const n=t.debugOverlayCanvas,i=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,"".concat(g," ").concat(p,"kB"));const y=t.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});o.draw(r,a.TRIANGLES,s,l,Be.alphaBlended,je.disabled,Bn(e.bf.transparent,m),null,y,u,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),o.draw(r,a.LINE_STRIP,s,l,c,je.disabled,Bn(e.bf.red),h,y,u,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}function Tr(t,e,n,i){const{isRenderingGlobe:r}=i,a=t.context,o=a.gl,s=t.transform,l=t.colorModeForRenderPass(),c=t.getDepthModeFor3D(),u=t.useProgram("terrain");a.bindFramebuffer.set(null),a.viewport.set([0,0,t.width,t.height]);for(const h of n){const n=e.getTerrainMesh(h.tileID),i=t.renderToTexture.getTexture(h),d=e.getTerrainData(h.tileID);a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,i.texture);const p=e.getMeshFrameDelta(s.zoom),f=s.calculateFogMatrix(h.tileID.toUnwrapped()),m=An(p,f,t.style.sky,s.pitch,r),g=s.getProjectionData({overscaledTileID:h.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(a,o.TRIANGLES,c,Ge.disabled,l,je.backCCW,m,d,g,"terrain",n.vertexBuffer,n.indexBuffer,n.segments)}}function Ar(t,n){if(!n.mesh){const i=new e.aL;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const r=new e.aN;r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),n.mesh=new we(t.createVertexBuffer(i,Se.members),t.createIndexBuffer(r),e.aM.simpleSegment(0,0,i.length,r.length))}return n.mesh}class Er{constructor(t,n){this.context=new Xi(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=bt.maxUnderzooming+bt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ve}resize(t,e,n){if(this.width=Math.floor(t*n),this.height=Math.floor(e*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style._order)this.style._layers[i].resize()}setup(){const t=this.context,n=new e.aL;n.emplaceBack(0,0),n.emplaceBack(e.$,0),n.emplaceBack(0,e.$),n.emplaceBack(e.$,e.$),this.tileExtentBuffer=t.createVertexBuffer(n,Se.members),this.tileExtentSegments=e.aM.simpleSegment(0,0,4,2);const i=new e.aL;i.emplaceBack(0,0),i.emplaceBack(e.$,0),i.emplaceBack(0,e.$),i.emplaceBack(e.$,e.$),this.debugBuffer=t.createVertexBuffer(i,Se.members),this.debugSegments=e.aM.simpleSegment(0,0,4,5);const r=new e.c6;r.emplaceBack(0,0,0,0),r.emplaceBack(e.$,0,e.$,0),r.emplaceBack(0,e.$,0,e.$),r.emplaceBack(e.$,e.$,e.$,e.$),this.rasterBoundsBuffer=t.createVertexBuffer(r,Mn.members),this.rasterBoundsSegments=e.aM.simpleSegment(0,0,4,2);const a=new e.aL;a.emplaceBack(0,0),a.emplaceBack(e.$,0),a.emplaceBack(0,e.$),a.emplaceBack(e.$,e.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(a,Se.members),this.rasterBoundsSegmentsPosOnly=e.aM.simpleSegment(0,0,4,5);const o=new e.aL;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,Se.members),this.viewportSegments=e.aM.simpleSegment(0,0,4,2);const s=new e.c7;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(s);const l=new e.aN;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Ge({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new we(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const i=e.L();e.bY(i,0,this.width,this.height,0,0,1),e.N(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const r={mainMatrix:i,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:i};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,Ve.disabled,this.stencilClearMode,Be.disabled,je.disabled,null,null,r,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source,this.nextStencilID+e.length>256&&this.clearStencil();const i=this.context;i.setColorMode(Be.disabled),i.setDepthMode(Ve.disabled);const r={};for(const a of e)r[a.key]=this.nextStencilID++;this._renderTileMasks(r,e,n,!0),this._renderTileMasks(r,e,n,!1),this._tileClippingMaskIDs=r}_renderTileMasks(t,e,n,i){const r=this.context,a=r.gl,o=this.style.projection,s=this.transform,l=this.useProgram("clippingMask");for(const c of e){const e=t[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=o.getMeshFromTileID(this.context,c.canonical,i,!0,"stencil"),d=s.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!n,applyTerrainMatrix:!0});l.draw(r,a.TRIANGLES,Ve.disabled,new Ge({func:a.ALWAYS,mask:0},e,255,a.KEEP,a.KEEP,a.REPLACE),Be.disabled,n?je.disabled:je.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const t=this.context,e=t.gl,n=this.style.projection,i=this.transform,r=this.useProgram("depth"),a=this.getDepthModeFor3D(),o=vt(i,{tileSize:i.tileSize});for(const s of o){const o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(s),l=n.getMeshFromTileID(this.context,s.canonical,!0,!0,"raster"),c=i.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});r.draw(t,e.TRIANGLES,a,Ge.disabled,Be.disabled,je.backCCW,null,o,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Ge({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Ge({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const e=this.context.gl,n=t.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const t={};for(let n=0;n<r;n++)t[n+i]=new Ge({func:e.GEQUAL,mask:255},n+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=r,[t,n]}return[{[i]:Ge.disabled},n]}stencilConfigForOverlapTwoPass(t){const e=this.context.gl,n=t.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(this.clearStencil(),r>1){const t={},a={};for(let n=0;n<r;n++)t[n+i]=new Ge({func:e.GREATER,mask:255},r+1+n,255,e.KEEP,e.KEEP,e.REPLACE),a[n+i]=new Ge({func:e.GREATER,mask:255},1+n,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID=2*r+1,[t,a,n]}return this.nextStencilID=3,[{[i]:new Ge({func:e.GREATER,mask:255},2,255,e.KEEP,e.KEEP,e.REPLACE)},{[i]:new Ge({func:e.GREATER,mask:255},1,255,e.KEEP,e.KEEP,e.REPLACE)},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new Be([t.CONSTANT_COLOR,t.ONE],new e.bf(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Be.unblended:Be.alphaBlended}getDepthModeForSublayer(t,e,n){if(!this.opaquePassEnabledForLayer())return Ve.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ve(n||this.context.gl.LEQUAL,e,[i,i])}getDepthModeFor3D(){return new Ve(this.context.gl.LEQUAL,Ve.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var i,r;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.now()),this.imageManager.beginFrame();const a=this.style._order,s=this.style.sourceCaches,l={},c={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(i=t.projection)||void 0===i?void 0:i.transitionState)>0};for(const e in s){const t=s[e];t.used&&t.prepare(this.context),l[e]=t.getVisibleCoordinates(!1),c[e]=l[e].slice().reverse(),u[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<a.length;e++)if(this.style._layers[a[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of a){const t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=c[t.source];("custom"===t.type||n.length)&&this.renderLayer(this,s[t.source],t,n,h)}if(null===(r=this.style.projection)||void 0===r||r.updateGPUdependent({context:this.context,useProgram:t=>this.useProgram(t)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?e.bf.black:e.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(t,e){const n=t.context,i=n.gl,r=((t,e,n)=>{const i=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),a=ut(e),o=e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:t.properties.get("sky-color"),u_horizon_color:t.properties.get("horizon-color"),u_horizon:[(e.width/2-a*r)*n,(e.height/2+a*i)*n],u_horizon_normal:[-r,i],u_sky_horizon_blend:t.properties.get("sky-horizon-blend")*e.height/2*n,u_sky_blend:o}})(e,t.style.map.transform,t.pixelRatio),a=new Ve(i.LEQUAL,Ve.ReadWrite,[0,1]),o=Ge.disabled,s=t.colorModeForRenderPass(),l=t.useProgram("sky"),c=Ar(n,e);l.draw(n,i.TRIANGLES,a,o,s,je.disabled,r,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[a[this.currentLayer]],e=s[t.source],n=l[t.source];this._renderTileClippingMasks(t,n,!1),this.renderLayer(this,e,t,n,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const t=this.style._layers[a[this.currentLayer]],e=s[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const n=("symbol"===t.type?u:c)[t.source];this._renderTileClippingMasks(t,l[t.source],!!this.renderToTexture),this.renderLayer(this,e,t,n,h)}if(h.isRenderingGlobe&&function(t,n,i){const r=t.context,a=r.gl,o=t.useProgram("atmosphere"),s=new Ve(a.LEQUAL,Ve.ReadOnly,[0,1]),l=t.transform,c=function(t,n){const i=t.properties.get("position"),r=[-i.x,-i.y,-i.z],a=e.ag(new Float64Array(16));return"map"===t.properties.get("anchor")&&(e.b6(a,a,n.rollInRadians),e.b7(a,a,-n.pitchInRadians),e.b6(a,a,n.bearingInRadians),e.b7(a,a,n.center.lat*Math.PI/180),e.bz(a,a,-n.center.lng*Math.PI/180)),e.c5(r,r,a),r}(i,t.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=n.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=rn(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,e.aw(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,e.aw(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const m=((t,e,n,i,r)=>({u_sun_pos:t,u_atmosphere_blend:e,u_globe_position:n,u_globe_radius:i,u_inv_proj_matrix:r}))(c,h,[f[0],f[1],f[2]],d,p),g=Ar(r,n);o.draw(r,a.TRIANGLES,s,Ge.disabled,Be.alphaBlended,je.disabled,m,null,null,"atmosphere",g.vertexBuffer,g.indexBuffer,g.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const t=function(t,e){let n=null;const i=Object.values(t._layers).flatMap(n=>n.source&&!n.isHidden(e)?[t.sourceCaches[n.source]]:[]),r=i.filter(t=>"vector"===t.getSource().type),a=i.filter(t=>"vector"!==t.getSource().type),o=t=>{(!n||n.getSource().maxzoom<t.getSource().maxzoom)&&(n=t)};return r.forEach(t=>o(t)),n||a.forEach(t=>o(t)),n}(this.style,this.transform.zoom);t&&function(t,e,n){for(let i=0;i<n.length;i++)Mr(t,e,n[i])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;xr(t,t.transform.height-(e.top||0),3,gr),xr(t,e.bottom||0,3,yr),wr(t,e.left||0,3,vr),wr(t,t.transform.width-(e.right||0),3,_r);const n=t.transform.centerPoint;!function(t,e,n,i){Sr(t,e-1,n-10,2,20,i),Sr(t,e-10,n-1,20,2,i)}(t,n.x,t.transform.height-n.y,br)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,i=this.transform.modelViewProjectionMatrix;let r=this.terrainFacilitator.dirty;r||(r=t?!e.c8(n,i):!e.c9(n,i)),r||(r=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),r&&(e.ca(n,i),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,n){const i=t.context,r=i.gl,a=t.transform,o=Be.unblended,s=new Ve(r.LEQUAL,Ve.ReadWrite,[0,1]),l=n.sourceCache.getRenderableTiles(),c=t.useProgram("terrainDepth");i.bindFramebuffer.set(n.getFramebuffer("depth").framebuffer),i.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),i.clear({color:e.bf.transparent,depth:1});for(const e of l){const t=n.getTerrainMesh(e.tileID),l=n.getTerrainData(e.tileID),u=a.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:n.getMeshFrameDelta(a.zoom)};c.draw(i,r.TRIANGLES,s,Ge.disabled,o,je.backCCW,h,l,u,"terrain",t.vertexBuffer,t.indexBuffer,t.segments)}i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,n){const i=t.context,r=i.gl,a=t.transform,o=Be.unblended,s=new Ve(r.LEQUAL,Ve.ReadWrite,[0,1]),l=n.getCoordsTexture(),c=n.sourceCache.getRenderableTiles(),u=t.useProgram("terrainCoords");i.bindFramebuffer.set(n.getFramebuffer("coords").framebuffer),i.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),i.clear({color:e.bf.transparent,depth:1}),n.coordsIndex=[];for(const e of c){const t=n.getTerrainMesh(e.tileID),c=n.getTerrainData(e.tileID);i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(a.zoom)},d=a.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(i,r.TRIANGLES,s,Ge.disabled,o,je.backCCW,h,c,d,"terrain",t.vertexBuffer,t.indexBuffer,t.segments),n.coordsIndex.push(e.tileID.key)}i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}renderLayer(t,n,i,r,a){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||(r||[]).length)&&(this.id=i.id,e.cb(i)?function(t,n,i,r,a,o){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:s}=o,l=Ge.disabled,c=t.colorModeForRenderPass();(i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(t,n,i,r,a,o,s,l,c){const u=n.transform,h=n.style.map.terrain,d="map"===a,p="map"===o;for(const f of t){const t=r.getTile(f),a=t.getBucket(i);if(!a||!a.text||!a.text.segments.get().length)continue;const o=e.an(a.textSizeData,u.zoom),m=e.aC(t,1,n.transform.zoom),g=At(d,n.transform,m),y="none"!==i.layout.get("icon-text-fit")&&a.hasIconData();if(o){const n=Math.pow(2,u.zoom-t.tileID.overscaledZ),i=h?(t,e)=>h.getElevation(f,t,e):null;tr(a,d,p,c,u,g,n,o,y,e.aD(u,t,s,l),f.toUnwrapped(),i)}}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),a),0!==i.paint.get("icon-opacity").constantOr(1)&&nr(t,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),l,c,s),0!==i.paint.get("text-opacity").constantOr(1)&&nr(t,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),l,c,s),n.map.showCollisionBoxes&&(Ki(t,n,i,r,!0),Ki(t,n,i,r,!1))}(t,n,i,r,this.style.placement.variableOffsets,a):e.cc(i)?function(t,n,i,r,a){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=a,s=i.paint.get("circle-opacity"),l=i.paint.get("circle-stroke-width"),c=i.paint.get("circle-stroke-opacity"),u=!i.layout.get("circle-sort-key").isConstant();if(0===s.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=t.context,d=h.gl,p=t.transform,f=t.getDepthModeForSublayer(0,Ve.ReadOnly),m=Ge.disabled,g=t.colorModeForRenderPass(),y=[],v=p.getCircleRadiusCorrection();for(let _=0;_<r.length;_++){const a=r[_],s=n.getTile(a),l=s.getBucket(i);if(!l)continue;const c=i.paint.get("circle-translate"),h=i.paint.get("circle-translate-anchor"),d=e.aD(p,s,c,h),f=l.programConfigurations.get(i.id),m=t.useProgram("circle",f),g=l.layoutVertexBuffer,b=l.indexBuffer,x=t.style.map.terrain&&t.style.map.terrain.getTerrainData(a),w={programConfiguration:f,program:m,layoutVertexBuffer:g,indexBuffer:b,uniformValues:zn(t,s,i,d,v),terrainData:x,projectionData:p.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!o,applyTerrainMatrix:!0})};if(u){const t=l.segments.get();for(const n of t)y.push({segments:new e.aM([n]),sortKey:n.sortKey,state:w})}else y.push({segments:l.segments,sortKey:0,state:w})}u&&y.sort((t,e)=>t.sortKey-e.sortKey);for(const e of y){const{programConfiguration:n,program:r,layoutVertexBuffer:a,indexBuffer:o,uniformValues:s,terrainData:l,projectionData:c}=e.state;r.draw(h,d.TRIANGLES,f,m,g,je.backCCW,s,l,c,i.id,a,o,e.segments,i.paint,t.transform.zoom,n)}}(t,n,i,r,a):e.cd(i)?function(t,n,i,r,a){if(0===i.paint.get("heatmap-opacity"))return;const o=t.context,{isRenderingToTexture:s,isRenderingGlobe:l}=a;if(t.style.map.terrain){for(const e of r){const r=n.getTile(e);n.hasRenderableParent(e)||("offscreen"===t.renderPass?rr(t,r,i,e,l):"translucent"===t.renderPass&&ar(t,i,e,s,l))}o.viewport.set([0,0,t.width,t.height])}else"offscreen"===t.renderPass?function(t,n,i,r){const a=t.context,o=a.gl,s=t.transform,l=Ge.disabled,c=new Be([o.ONE,o.ONE],e.bf.transparent,[!0,!0,!0,!0]);(function(t,n,i){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,n.width/4,n.height/4]);let a=i.heatmapFbos.get(e.c2);a?(r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)):(a=or(t,n.width/4,n.height/4),i.heatmapFbos.set(e.c2,a))})(a,t,i),a.clear({color:e.bf.transparent});for(let e=0;e<r.length;e++){const u=r[e];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(i);if(!d)continue;const p=d.programConfigurations.get(i.id),f=t.useProgram("heatmap",p),m=s.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),g=s.getCircleRadiusCorrection();f.draw(a,o.TRIANGLES,Ve.disabled,l,c,je.backCCW,Un(h,s.zoom,i.paint.get("heatmap-intensity"),g),null,m,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,s.zoom,p)}a.viewport.set([0,0,t.width,t.height])}(t,n,i,r):"translucent"===t.renderPass&&function(t,n){const i=t.context,r=i.gl;i.setColorMode(t.colorModeForRenderPass());const a=n.heatmapFbos.get(e.c2);a&&(i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1),sr(i,n).bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,r.TRIANGLES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,jn(t,n,0,1),null,null,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom))}(t,i)}(t,n,i,r,a):e.ce(i)?function(t,n,i,r,a){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=a,s=i.paint.get("line-opacity"),l=i.paint.get("line-width");if(0===s.constantOr(1)||0===l.constantOr(1))return;const c=t.getDepthModeForSublayer(0,Ve.ReadOnly),u=t.colorModeForRenderPass(),h=i.paint.get("line-dasharray"),d=i.paint.get("line-pattern"),p=d.constantOr(1),f=i.paint.get("line-gradient"),m=i.getCrossfadeParameters(),g=p?"linePattern":h?"lineSDF":f?"lineGradient":"line",y=t.context,v=y.gl,_=t.transform;let b=!0;for(const x of r){const r=n.getTile(x);if(p&&!r.patternsLoaded())continue;const a=r.getBucket(i);if(!a)continue;const s=a.programConfigurations.get(i.id),l=t.context.program.get(),w=t.useProgram(g,s),S=b||w.program!==l,M=t.style.map.terrain&&t.style.map.terrain.getTerrainData(x),T=d.constantOr(null);if(T&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[T.to.toString()],n=t.patternPositions[T.from.toString()];e&&n&&s.setConstantPatternPositions(e,n)}const A=_.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!o,applyTerrainMatrix:!0}),E=_.getPixelScale(),C=p?Xn(t,r,i,E,m):h?Yn(t,r,i,E,h,m):f?Zn(t,r,i,E,a.lineClipsArray.length):qn(t,r,i,E);if(p)y.activeTexture.set(v.TEXTURE0),r.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),s.updatePaintBuffers(m);else if(h&&(S||t.lineAtlas.dirty))y.activeTexture.set(v.TEXTURE0),t.lineAtlas.bind(y);else if(f){const r=a.gradients[i.id];let o=r.texture;if(i.gradientVersion!==r.version){let s=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=x.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-x.canonical.z):1;s=e.ah(e.c3(a.maxLineLength/e.$*1024*r),256,y.maxTextureSize)}r.gradient=e.c4({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:r.gradient||void 0,clips:a.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.T(y,r.gradient,v.RGBA),r.version=i.gradientVersion,o=r.texture}y.activeTexture.set(v.TEXTURE0),o.bind(i.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}const P=t.stencilModeForClipping(x);w.draw(y,v.TRIANGLES,c,P,u,je.disabled,C,M,A,i.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,i.paint,t.transform.zoom,s,a.layoutVertexBuffer2),b=!1}}(t,n,i,r,a):e.cf(i)?function(t,n,i,r,a){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const{isRenderingToTexture:l}=a,c=t.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),h=t.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(e.bf.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===h){const e=t.getDepthModeForSublayer(1,"opaque"===t.renderPass?Ve.ReadWrite:Ve.ReadOnly);cr(t,n,i,r,e,c,!1,l)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const e=t.getDepthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Ve.ReadOnly);cr(t,n,i,r,e,c,!0,l)}}(t,n,i,r,a):e.cg(i)?function(t,e,n,i,r){const a=n.paint.get("fill-extrusion-opacity");if(0===a)return;const{isRenderingToTexture:o}=r;if("translucent"===t.renderPass){const r=new Ve(t.context.gl.LEQUAL,Ve.ReadWrite,t.depthRangeFor3D);if(1!==a||n.paint.get("fill-extrusion-pattern").constantOr(1))ur(t,e,n,i,r,Ge.disabled,Be.disabled,o),ur(t,e,n,i,r,t.stencilModeFor3D(),t.colorModeForRenderPass(),o);else{const a=t.colorModeForRenderPass();ur(t,e,n,i,r,Ge.disabled,a,o)}}}(t,n,i,r,a):e.ch(i)?function(t,n,i,r,a){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=a,s=t.context,l=t.style.projection.useSubdivision,c=t.getDepthModeForSublayer(0,Ve.ReadOnly),u=t.colorModeForRenderPass();if("offscreen"===t.renderPass)!function(t,n,i,r,a,o,s){const l=t.context,c=l.gl;for(const u of i){const i=n.getTile(u),h=i.dem;if(!h||!h.data)continue;if(!i.needsHillshadePrepare)continue;const d=h.dim,p=h.stride,f=h.getPixels();if(l.activeTexture.set(c.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(p),i.demTexture){const t=i.demTexture;t.update(f,{premultiply:!1}),t.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else i.demTexture=new e.T(l,f,c.RGBA,{premultiply:!1}),i.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);l.activeTexture.set(c.TEXTURE0);let m=i.fbo;if(!m){const t=new e.T(l,{width:d,height:d,data:null},c.RGBA);t.bind(c.LINEAR,c.CLAMP_TO_EDGE),m=i.fbo=l.createFramebuffer(d,d,!0,!1),m.colorAttachment.set(t.texture)}l.bindFramebuffer.set(m.framebuffer),l.viewport.set([0,0,d,d]),t.useProgram("hillshadePrepare").draw(l,c.TRIANGLES,a,o,s,je.disabled,Hn(i.tileID,h),null,null,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}}(t,n,r,i,c,Ge.disabled,u),s.viewport.set([0,0,t.width,t.height]);else if("translucent"===t.renderPass)if(l){const[e,a,s]=t.stencilConfigForOverlapTwoPass(r);hr(t,n,i,s,e,c,u,!1,o),hr(t,n,i,s,a,c,u,!0,o)}else{const[e,a]=t.getStencilConfigForOverlapAndUpdateStencilID(r);hr(t,n,i,a,e,c,u,!1,o)}}(t,n,i,r,a):e.ci(i)?function(t,e,n,i,r){if("translucent"!==t.renderPass)return;if(!i.length)return;const{isRenderingToTexture:a}=r,o=t.style.projection.useSubdivision,s=t.getDepthModeForSublayer(0,Ve.ReadOnly),l=t.colorModeForRenderPass();if(o){const[r,o,c]=t.stencilConfigForOverlapTwoPass(i);dr(t,e,n,c,r,s,l,!1,a),dr(t,e,n,c,o,s,l,!0,a)}else{const[r,o]=t.getStencilConfigForOverlapAndUpdateStencilID(i);dr(t,e,n,o,r,s,l,!1,a)}}(t,n,i,r,a):e.cj(i)?function(t,e,n,i,r){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!i.length)return;const{isRenderingToTexture:a}=r,o=e.getSource(),s=t.style.projection.useSubdivision;if(o instanceof Y)fr(t,e,n,i,null,!1,!1,o.tileCoords,o.flippedWindingOrder,a);else if(s){const[r,o,s]=t.stencilConfigForOverlapTwoPass(i);fr(t,e,n,s,r,!1,!0,pr,!1,a),fr(t,e,n,s,o,!0,!0,pr,!1,a)}else{const[r,o]=t.getStencilConfigForOverlapAndUpdateStencilID(i);fr(t,e,n,o,r,!1,!0,pr,!1,a)}}(t,n,i,r,a):e.ck(i)?function(t,e,n,i,r){const a=n.paint.get("background-color"),o=n.paint.get("background-opacity");if(0===o)return;const{isRenderingToTexture:s}=r,l=t.context,c=l.gl,u=t.style.projection,h=t.transform,d=h.tileSize,p=n.paint.get("background-pattern");if(t.isPatternMissing(p))return;const f=!p&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==f)return;const m=Ge.disabled,g=t.getDepthModeForSublayer(0,"opaque"===f?Ve.ReadWrite:Ve.ReadOnly),y=t.colorModeForRenderPass(),v=t.useProgram(p?"backgroundPattern":"background"),_=i||vt(h,{tileSize:d,terrain:t.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),t.imageManager.bind(t.context));const b=n.getCrossfadeParameters();for(const x of _){const e=h.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),i=p?ri(o,t,p,{tileID:x,tileSize:d},b):ii(o,a),r=t.style.map.terrain&&t.style.map.terrain.getTerrainData(x),f=u.getMeshFromTileID(l,x.canonical,!1,!0,"raster");v.draw(l,c.TRIANGLES,g,m,y,je.backCCW,i,r,e,n.id,f.vertexBuffer,f.indexBuffer,f.segments)}}(t,0,i,r,a):e.cl(i)&&function(t,e,n,i){const{isRenderingGlobe:r}=i,a=t.context,o=n.implementation,s=t.style.projection,l=t.transform,c=l.getProjectionDataForCustomLayer(r),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:s.shaderVariantName,vertexShaderPrelude:"const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n".concat(s.shaderPreludeCode.vertexSource),define:s.shaderDefine},defaultProjectionData:c},h=o.renderingMode?o.renderingMode:"2d";if("offscreen"===t.renderPass){const e=o.prerender;e&&(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),e.call(o,a.gl,u),a.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(Ge.disabled);const e="3d"===h?t.getDepthModeFor3D():t.getDepthModeForSublayer(0,Ve.ReadOnly);a.setDepthMode(e),o.render(a.gl,u),a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}(t,0,i,a))}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n}useProgram(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.cache=this.cache||{};const r=!!this.style.map.terrain,a=this.style.projection,o=n?be.projectionMercator:a.shaderPreludeCode,s=n?Me:a.shaderDefine,l=t+(e?e.cacheKey:"")+"/".concat(n?Te:a.shaderVariantName)+(this._showOverdrawInspector?"/overdraw":"")+(r?"/terrain":"")+(i?"/".concat(i.join("/")):"");return this.cache[l]||(this.cache[l]=new Pn(this.context,be[t],e,oi[t],this._showOverdrawInspector,r,o,s,i)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}function Cr(t,e){var n=this;let i,r=!1,a=null,o=null;const s=()=>{a=null,r&&(t.apply(o,i),a=setTimeout(s,e),r=!1)};return function(){for(var t=arguments.length,e=new Array(t),l=0;l<t;l++)e[l]=arguments[l];return r=!0,o=n,i=e,a||s(),a}}class Pr{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map(t=>t.split("=")).forEach(t=>{t[0]===this._hashName&&(e=t)}),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(!this._isValidHash(t))return!1;const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,t)},this._removeHash=()=>{const t=this._getCurrentHash();if(0===t.length)return;const e=t.join("/");let n=e;n.split("&").length>0&&(n=n.split("&")[0]),this._hashName&&(n="".concat(this._hashName,"=").concat(e));let i=window.location.hash.replace(n,"");i.startsWith("#&")?i=i.slice(0,1)+i.slice(2):"#"===i&&(i="");let r=window.location.href.replace(/(#.+)?$/,i);r=r.replace("&&","&"),window.history.replaceState(window.history.state,null,r)},this._updateHash=Cr(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const e=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),a=Math.round(e.lng*r)/r,o=Math.round(e.lat*r)/r,s=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?"/".concat(a,"/").concat(o,"/").concat(n):"".concat(n,"/").concat(o,"/").concat(a),(s||l)&&(c+="/"+Math.round(10*s)/10),l&&(c+="/".concat(Math.round(l))),this._hashName){const t=this._hashName;let e=!1;const n=window.location.hash.slice(1).split("&").map(n=>{const i=n.split("=")[0];return i===t?(e=!0,"".concat(i,"=").concat(c)):n}).filter(t=>t);return e||n.push("".concat(t,"=").concat(c)),"#".concat(n.join("&"))}return"#".concat(c)}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new e.S(+t[2],+t[1])}catch(t){return!1}const n=+t[0],i=+(t[3]||0),r=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&i>=-180&&i<=180&&r>=this._map.getMinPitch()&&r<=this._map.getMaxPitch()}}const Ir={linearity:.3,easing:e.cm(0,0,.3,1)},Lr=e.e({deceleration:2500,maxSpeed:1400},Ir),kr=e.e({deceleration:20,maxSpeed:1400},Ir),Rr=e.e({deceleration:1e3,maxSpeed:360},Ir),Dr=e.e({deceleration:1e3,maxSpeed:90},Ir),Nr=e.e({deceleration:1e3,maxSpeed:360},Ir);class zr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=o.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,n.roll+=e.rollDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const a=Or(n.pan.mag(),i,e.e({},Lr,t||{})),o=n.pan.mult(a.amount/n.pan.mag()),s=this._map.cameraHelper.handlePanInertia(o,this._map.transform);r.center=s.easingCenter,r.offset=s.easingOffset,Fr(r,a)}if(n.zoom){const t=Or(n.zoom,i,kr);r.zoom=this._map.transform.zoom+t.amount,Fr(r,t)}if(n.bearing){const t=Or(n.bearing,i,Rr);r.bearing=this._map.transform.bearing+e.ah(t.amount,-179,179),Fr(r,t)}if(n.pitch){const t=Or(n.pitch,i,Dr);r.pitch=this._map.transform.pitch+t.amount,Fr(r,t)}if(n.roll){const t=Or(n.roll,i,Nr);r.roll=this._map.transform.roll+e.ah(t.amount,-179,179),Fr(r,t)}if(r.zoom||r.bearing){const t=void 0===n.pinchAround?n.around:n.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),e.e(r,{noMoveStart:!0})}}function Fr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Or(t,n,i){const{maxSpeed:r,linearity:a,deceleration:o}=i,s=e.ah(t*a/(n/1e3),-r,r),l=Math.abs(s)/(o*a);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}class Br extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i=i instanceof MouseEvent?i:new MouseEvent(t,i);const a=s.mousePos(n.getCanvas(),i),o=n.unproject(a);super(t,e.e({point:a,lngLat:o,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Ur extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,a=s.touchPos(n.getCanvasContainer(),r),o=a.map(t=>n.unproject(t)),l=a.reduce((t,e,n,i)=>t.add(e.div(i.length)),new e.P(0,0));super(t,{points:a,point:l,lngLats:o,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class jr extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}}class Vr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new jr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Br(t.type,this._map,t))}mouseup(t){this._map.fire(new Br(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Br(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Br(t.type,this._map,t))}mouseover(t){this._map.fire(new Br(t.type,this._map,t))}mouseout(t){this._map.fire(new Br(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ur(t.type,this._map,t))}touchmove(t){this._map.fire(new Ur(t.type,this._map,t))}touchend(t){this._map.fire(new Ur(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ur(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Br(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Br(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(e.P.convert(t),this._map.terrain)}}class Wr{constructor(t,e){this._map=t,this._tr=new Gr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(s.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const n=e;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=s.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(i.x,n.x),a=Math.max(i.x,n.x),o=Math.min(i.y,n.y),l=Math.max(i.y,n.y);s.setTransform(this._box,"translate(".concat(r,"px,").concat(o,"px)")),this._box.style.width=a-r+"px",this._box.style.height=l-o+"px"}mouseupWindow(t,n){if(!this._active)return;if(0!==t.button)return;const i=this._startPos,r=n;if(this.reset(),s.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.l("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(i,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.l(t,{originalEvent:n}))}}function qr(t,e){if(t.length!==e.length)throw new Error("The number of touches and points are not equal - touches ".concat(t.length,", points ").concat(e.length));const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class Zr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.P(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=qr(i,n)))}touchmove(t,e,n){if(this.aborted||!this.centroid)return;const i=qr(n,e);for(const r in this.touches){const t=i[r];(!t||t.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Xr{constructor(t){this.singleTap=new Zr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,n){this.singleTap.touchstart(t,e,n)}touchmove(t,e,n){this.singleTap.touchmove(t,e,n)}touchend(t,e,n){const i=this.singleTap.touchend(t,e,n);if(i){const e=t.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(e&&n||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Yr{constructor(t){this._tr=new Gr(t),this._zoomIn=new Xr({numTouches:1,numTaps:2}),this._zoomOut=new Xr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)}touchmove(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)}touchend(t,e,n){const i=this._zoomIn.touchend(t,e,n),r=this._zoomOut.touchend(t,e,n),a=this._tr;return i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(i)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(){const t=this._moveFunction(...arguments);if(t.bearingDelta||t.pitchDelta||t.rollDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(e)?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const i=Array.isArray(e)?e[0]:e;return!this._moved&&i.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=i,this._move(n,i))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&s.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jr=0,$r=2,Qr={[Jr]:1,[$r]:2};class ta{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=s.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const n=Qr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton)}isValidEndEvent(t){return s.mouseButton(t)===this._eventButton}}class ea{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class na{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ta({checkCorrectEvent:()=>!0}),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ea;this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=e}_executeRelevantHandler(t,e,n){return t instanceof MouseEvent?e(t):"undefined"!=typeof TouchEvent&&t instanceof TouchEvent?n(t):void 0}startMove(t){this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.startMove(t),t=>this.oneFingerTouchMoveStateManager.startMove(t))}endMove(t){this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.endMove(t),t=>this.oneFingerTouchMoveStateManager.endMove(t))}isValidStartEvent(t){return this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.isValidStartEvent(t),t=>this.oneFingerTouchMoveStateManager.isValidStartEvent(t))}isValidMoveEvent(t){return this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.isValidMoveEvent(t),t=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(t))}isValidEndEvent(t){return this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.isValidEndEvent(t),t=>this.oneFingerTouchMoveStateManager.isValidEndEvent(t))}}const ia=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=t=>{t.preventDefault()}};class ra{constructor(t,e){this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,e,n){return this._calculateTransform(t,e,n)}touchmove(t,e,n){if(this._active){if(!this._shouldBePrevented(n.length))return t.preventDefault(),this._calculateTransform(t,e,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,e,n){this._calculateTransform(t,e,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=qr(i,n),a=new e.P(0,0),o=new e.P(0,0);let s=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(a._add(t),o._add(t.sub(n)),s++,r[e]=t)}if(this._touches=r,this._shouldBePrevented(s)||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,n){if(!this._firstTwoTouches)return;t.preventDefault();const[i,r]=this._firstTwoTouches,a=oa(n,e,i),o=oa(n,e,r);if(!a||!o)return;const s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,t)}touchend(t,e,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,a=oa(n,e,i),o=oa(n,e,r);a&&o||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function oa(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function sa(t,e){return Math.log(t/e)/Math.LN2}class la extends aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(sa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sa(this._distance,n),pinchAround:e}}}function ca(t,e){return 180*t.angleWith(e)/Math.PI}class ua extends aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,n){const i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ca(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,n=ca(t,this._startVector);return Math.abs(n)<e}}function ha(t){return Math.abs(t.y)>Math.abs(t.x)}class da extends aa{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,n){super.touchstart(t,e,n),this._currentTouchCount=n.length}_start(t){this._lastPoints=t,ha(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const i=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,n){if(void 0!==this._valid)return this._valid;const i=t.mag()>=2,r=e.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const a=t.y>0==e.y>0;return ha(t)&&ha(e)&&a}}const pa={panStep:100,bearingStep:15,pitchStep:10};class fa{constructor(t){this._tr=new Gr(t);const e=pa;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,n=0,i=0,r=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:o=>{const s=this._tr;o.easeTo({duration:300,easeId:"keyboardHandler",easing:ma,zoom:e?Math.round(s.zoom)+e*(t.shiftKey?2:1):s.zoom,bearing:s.bearing+n*this._bearingStep,pitch:s.pitch+i*this._pitchStep,offset:[-r*this._panStep,-a*this._panStep],center:s.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ma(t){return t*(2-t)}const ga=4.000244140625,ya=1/450;class va{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new Gr(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ya}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=o.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==e&&e%ga==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=s.mousePos(this._map.getCanvas(),t),i=this._tr;this._aroundPoint=this._aroundCenter?i.transform.locationToScreenPoint(e.S.convert(i.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const e=t.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=e),"number"==typeof this._targetZoom&&(this._targetZoom+=e)}if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>ga?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);const r="number"!=typeof this._targetZoom?t.scale:e.af(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),e.ak(r*i)).zoom,"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"!=typeof this._targetZoom?t.zoom:this._targetZoom,i=this._startZoom,r=this._easing;let a,s=!1;if("wheel"===this._type&&i&&r){const t=o.now()-this._lastWheelEventTime,l=Math.min((t+5)/200,1),c=r(l);a=e.C.number(i,n,c),l<1?this._frameId||(this._frameId=!0):s=!0}else a=n,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=a,{noInertia:!0,needsRenderFrame:!s,zoomDelta:a-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.co;if(this._prevEase){const t=this._prevEase,i=(o.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),a=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=e.cm(a,s,.25,1)}return this._prevEase={start:o.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class _a{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ba{constructor(t){this._tr=new Gr(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa{constructor(){this._tap=new Xr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,n){if(!this._swipePoint)if(this._tapTime){const i=e[0],r=t.timeStamp-this._tapTime<500,a=this._tapPoint.dist(i)<30;r&&a?n.length>0&&(this._swipePoint=i,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(t,e,n)}touchmove(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=e[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,n)}touchend(t,e,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{const i=this._tap.touchend(t,e,n);i&&(this._tapTime=t.timeStamp,this._tapPoint=i)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa{constructor(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sa{constructor(t,e,n,i){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=e,this._mousePitch=n,this._mouseRoll=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ma{constructor(t,e,n,i){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ta{constructor(t,e){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=s.create("div","maplibregl-cooperative-gesture-screen",t);let e=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(e=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),i=document.createElement("div");i.className="maplibregl-desktop-message",i.textContent=e,this._container.appendChild(i);const r=document.createElement("div");r.className="maplibregl-mobile-message",r.textContent=n,this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(s.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new e.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Aa=t=>t.zoom||t.drag||t.roll||t.pitch||t.rotate;class Ea extends e.l{}function Ca(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta||t.rollDelta}class Pa{constructor(t,n){this.handleWindowEvent=t=>{this.handleEvent(t,"".concat(t.type,"Window"))},this.handleEvent=(t,n)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},a={},o={};for(const{handlerName:u,handler:h,allowed:d}of this._handlers){if(!h.isEnabled())continue;let l;if(this._blockedByActive(o,d,u))h.reset();else if(h[n||t.type]){if(e.cp(t,n||t.type)){const e=s.mousePos(this._map.getCanvas(),t);l=h[n||t.type](t,e)}else if(e.cq(t,n||t.type)){const e=this._getMapTouches(t.touches),i=s.touchPos(this._map.getCanvas(),e);l=h[n||t.type](t,i,e)}else e.cr(n||t.type)||(l=h[n||t.type](t));this.mergeHandlerResult(r,a,l,u,i),l&&l.needsRenderFrame&&this._triggerRenderFrame()}(l||h.isActive())&&(o[u]=h)}const l={};for(const e in this._previousActiveHandlers)o[e]||(l[e]=i);this._previousActiveHandlers=o,(Object.keys(l).length||Ca(r))&&(this._changes.push([r,a,l]),this._triggerRenderFrame()),(Object.keys(o).length||Ca(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=r;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zr(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,r,a]of this._listeners)s.addEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[t,e,n]of this._listeners)s.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new Vr(n,t));const r=n.boxZoom=new Wr(n,t);this._add("boxZoom",r),t.interactive&&t.boxZoom&&r.enable();const a=n.cooperativeGestures=new Ta(n,t.cooperativeGestures);this._add("cooperativeGestures",a),t.cooperativeGestures&&a.enable();const o=new Yr(n),l=new ba(n);n.doubleClickZoom=new _a(l,o),this._add("tapZoom",o),this._add("clickZoom",l),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const c=new xa;this._add("tapDragZoom",c);const u=n.touchPitch=new da(n);this._add("touchPitch",u),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const h=()=>n.project(n.getCenter()),d=function(t,n){let{enable:i,clickTolerance:r,aroundCenter:a=!0,minPixelCenterThreshold:o=100,rotateDegreesPerPixelMoved:l=.8}=t;const c=new ta({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)&&!t.ctrlKey});return new Kr({clickTolerance:r,move:(t,i)=>{const r=n();if(a&&Math.abs(r.y-t.y)>o)return{bearingDelta:e.cn(new e.P(t.x,i.y),i,r)};let s=(i.x-t.x)*l;return a&&i.y<r.y&&(s=-s),{bearingDelta:s}},moveStateManager:c,enable:i,assignEvents:ia})}(t,h),p=function(t){let{enable:e,clickTolerance:n,pitchDegreesPerPixelMoved:i=-.5}=t;const r=new ta({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)});return new Kr({clickTolerance:n,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:r,enable:e,assignEvents:ia})}(t),f=function(t,e){let{enable:n,clickTolerance:i,rollDegreesPerPixelMoved:r=.3}=t;const a=new ta({checkCorrectEvent:t=>2===s.mouseButton(t)&&t.ctrlKey});return new Kr({clickTolerance:i,move:(t,n)=>{const i=e();let a=(n.x-t.x)*r;return n.y<i.y&&(a=-a),{rollDelta:a}},moveStateManager:a,enable:n,assignEvents:ia})}(t,h);n.dragRotate=new Sa(t,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const m=function(t){let{enable:e,clickTolerance:n}=t;const i=new ta({checkCorrectEvent:t=>0===s.mouseButton(t)&&!t.ctrlKey});return new Kr({clickTolerance:n,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:i,enable:e,assignEvents:ia})}(t),g=new ra(t,n);n.dragPan=new wa(i,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const y=new ua,v=new la;n.touchZoomRotate=new Ma(i,v,y,c),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",v,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const _=n.scrollZoom=new va(n,()=>this._triggerRenderFrame());this._add("scrollZoom",_,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const b=n.keyboard=new fa(n);this._add("keyboard",b),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Hr(n))}_add(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Aa(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,n){for(const i in t)if(i!==n&&(!e||e.indexOf(i)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const n of t)this._el.contains(n.target)&&e.push(n);return e}mergeHandlerResult(t,n,i,r,a){if(!i)return;e.e(t,i);const o={handlerName:r,originalEvent:i.originalEvent||a};void 0!==i.zoomDelta&&(n.zoom=o),void 0!==i.panDelta&&(n.drag=o),void 0!==i.rollDelta&&(n.roll=o),void 0!==i.pitchDelta&&(n.pitch=o),void 0!==i.bearingDelta&&(n.rotate=o)}_applyChanges(){const t={},n={},i={};for(const[r,a,o]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),r.rollDelta&&(t.rollDelta=(t.rollDelta||0)+r.rollDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.e(n,a),e.e(i,o);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,e,n){const i=this._map,r=i._getTransformForUpdate(),a=i.terrain;if(!(Ca(t)||a&&this._terrainMovement))return this._fireEvents(e,n,!0);i._stop(!0);let{panDelta:o,zoomDelta:s,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=t;void 0!==d&&(h=d),h=h||i.transform.centerPoint,a&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const p={panDelta:o,zoomDelta:s,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const f=h.distSqr(r.centerPoint)<.01?r.center:r.screenPointToLocation(o?h.sub(o):h);a?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,r),this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(o))):this._map.cameraHelper.handleMapControlsPan(p,r,f):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(p,r,f))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,r),this._map.cameraHelper.handleMapControlsPan(p,r,f)),i._applyUpdatedTransform(r),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)}_fireEvents(t,n,i){const r=Aa(this._eventsInProgress),a=Aa(t),s={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(s["".concat(e,"start")]=n),this._eventsInProgress[e]=t[e]}!r&&a&&this._fireEvent("movestart",a.originalEvent);for(const e in s)this._fireEvent(e,s[e]);a&&this._fireEvent("move",a.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const l={};let c;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=n[t]||i,l["".concat(e,"end")]=c)}for(const e in l)this._fireEvent(e,l[e]);const u=Aa(this._eventsInProgress),h=(r||a)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const t=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&t.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(t)}if(i&&h){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!t||!t.essential&&o.prefersReducedMotion?(this._map.fire(new e.l("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ea("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Ia extends e.E{constructor(t,e,n){super(),this._renderFrameCallback=()=>{const t=Math.min((o.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.cameraHelper=e,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,e){t.apply(this.transform),this.transform=t,this.cameraHelper=e}getCenter(){return new e.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,e){return this.jumpTo({elevation:t},e),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.e({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,n,i){return this.easeTo(e.e({zoom:t},n),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new e.l("movestart",n)).fire(new e.l("move",n)).fire(new e.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,n,i){return this.easeTo(e.e({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}getRoll(){return this.transform.roll}setRoll(t,e){return this.jumpTo({roll:t},e),this}cameraForBounds(t,e){t=H.convert(t).adjustAntiMeridian();const n=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),n,e)}_cameraForBoxAndBearing(t,n,i,r){const a={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=e.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const t=r.padding;r.padding={top:t,bottom:t,right:t,left:t}}const o=e.e(a,r.padding);r.padding=o;const s=this.transform,l=new H(t,n);return this.cameraHelper.cameraForBoxAndBearing(r,o,l,i,s)}fitBounds(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)}fitScreenCoordinates(t,n,i,r,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(e.P.convert(t)),this.transform.screenPointToLocation(e.P.convert(n)),i,r),r,a)}_fitInternal(t,n,i){return t?(delete(n=e.e(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(t,n){this.stop();const i=this._getTransformForUpdate();let r=!1,a=!1,o=!1;const s=i.zoom;this.cameraHelper.handleJumpToCenterZoom(i,t);const l=i.zoom!==s;return"elevation"in t&&i.elevation!==+t.elevation&&i.setElevation(+t.elevation),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.setBearing(+t.bearing)),"pitch"in t&&i.pitch!==+t.pitch&&(a=!0,i.setPitch(+t.pitch)),"roll"in t&&i.roll!==+t.roll&&(o=!0,i.setRoll(+t.roll)),null==t.padding||i.isPaddingEqual(t.padding)||i.setPadding(t.padding),this._applyUpdatedTransform(i),this.fire(new e.l("movestart",n)).fire(new e.l("move",n)),l&&this.fire(new e.l("zoomstart",n)).fire(new e.l("zoom",n)).fire(new e.l("zoomend",n)),r&&this.fire(new e.l("rotatestart",n)).fire(new e.l("rotate",n)).fire(new e.l("rotateend",n)),a&&this.fire(new e.l("pitchstart",n)).fire(new e.l("pitch",n)).fire(new e.l("pitchend",n)),o&&this.fire(new e.l("rollstart",n)).fire(new e.l("roll",n)).fire(new e.l("rollend",n)),this.fire(new e.l("moveend",n))}calculateCameraOptionsFromTo(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=e.a1.fromLngLat(t,n),o=e.a1.fromLngLat(i,r),s=o.x-a.x,l=o.y-a.y,c=o.z-a.z,u=Math.hypot(s,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(s,l),d=e.ak(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(s,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:o.toLngLat(),elevation:r,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(t,e,n,i,r){const a=this.transform.calculateCenterFromCameraLngLatAlt(t,e,n,i);return{center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:n,pitch:i,roll:r}}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.co},t)).animate||!t.essential&&o.prefersReducedMotion)&&(t.duration=0);const i=this._getTransformForUpdate(),r=this.getBearing(),a=i.pitch,s=i.roll,l="bearing"in t?this._normalizeBearing(t.bearing,r):r,c="pitch"in t?+t.pitch:a,u="roll"in t?this._normalizeBearing(t.roll,s):s,h="padding"in t?t.padding:i.padding,d=e.P.convert(t.offset);let p,f;t.around&&(p=e.S.convert(t.around),f=i.locationToScreenPoint(p));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},g=this.cameraHelper.handleEaseTo(i,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||r!==l,this._pitching=this._pitching||c!==a,this._rolling=this._rolling||u!==s,this._padding=!i.isPaddingEqual(h),this._zooming=this._zooming||g.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,m),this.terrain&&this._prepareElevation(g.elevationCenter),this._ease(e=>{g.easeFunc(e),this.terrain&&!t.freezeElevation&&this._updateElevation(e),this._applyUpdatedTransform(i),this._fireMoveEvents(n)},e=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,e)},t),this}_prepareEase(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,n||i.moving||this.fire(new e.l("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.l("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.l("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.l("pitchstart",t)),this._rolling&&!i.rolling&&this.fire(new e.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(n-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(e.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const e=t.getCameraLngLat(),n=t.getCameraAltitude(),i=this.terrain?this.terrain.getElevationForLngLatZoom(e,t.zoom):0;if(n<i){const n=this.calculateCameraOptionsFromTo(e,i,t.center,t.elevation);return{pitch:n.pitch,zoom:n.zoom}}return{}}_applyUpdatedTransform(t){const e=[];if(e.push(t=>this._elevateCameraIfInsideTerrain(t)),this.transformCameraUpdate&&e.push(t=>this.transformCameraUpdate(t)),!e.length)return;const n=t.clone();for(const i of e){const t=n.clone(),{center:e,zoom:r,roll:a,pitch:o,bearing:s,elevation:l}=i(t);e&&t.setCenter(e),void 0!==l&&t.setElevation(l),void 0!==r&&t.setZoom(r),void 0!==a&&t.setRoll(a),void 0!==o&&t.setPitch(o),void 0!==s&&t.setBearing(s),n.apply(t)}this.transform.apply(n)}_fireMoveEvents(t){this.fire(new e.l("move",t)),this._zooming&&this.fire(new e.l("zoom",t)),this._rotating&&this.fire(new e.l("rotate",t)),this._pitching&&this.fire(new e.l("pitch",t)),this._rolling&&this.fire(new e.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const i=this._zooming,r=this._rotating,a=this._pitching,o=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,i&&this.fire(new e.l("zoomend",t)),r&&this.fire(new e.l("rotateend",t)),a&&this.fire(new e.l("pitchend",t)),o&&this.fire(new e.l("rollend",t)),this.fire(new e.l("moveend",t))}flyTo(t,n){if(!t.essential&&o.prefersReducedMotion){const i=e.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(i,n)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.co},t);const i=this._getTransformForUpdate(),r=i.bearing,a=i.pitch,s=i.roll,l=i.padding,c="bearing"in t?this._normalizeBearing(t.bearing,r):r,u="pitch"in t?+t.pitch:a,h="roll"in t?this._normalizeBearing(t.roll,s):s,d="padding"in t?t.padding:i.padding,p=e.P.convert(t.offset);let f=i.centerPoint.add(p);const m=i.screenPointToLocation(f),g=this.cameraHelper.handleFlyTo(i,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:m,offsetAsPoint:p,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let y=t.curve;const v=Math.max(i.width,i.height),_=v/g.scaleOfZoom,b=g.pixelPathLength;"number"==typeof g.scaleOfMinZoom&&(y=Math.sqrt(v/g.scaleOfMinZoom/b*2));const x=y*y;function w(t){const e=(_*_-v*v+(t?-1:1)*x*x*b*b)/(2*(t?_:v)*x*b);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}const T=w(!1);let A=function(t){return M(T)/M(T+y*t)},E=function(t){return v*((M(T)*(S(e=T+y*t)/M(e))-S(T))/x)/b;var e},C=(w(!0)-T)/y;if(Math.abs(b)<2e-6||!isFinite(C)){if(Math.abs(v-_)<1e-6)return this.easeTo(t,n);const e=_<v?-1:1;C=Math.abs(Math.log(_/v))/y,E=()=>0,A=t=>Math.exp(e*y*t)}return t.duration="duration"in t?+t.duration:1e3*C/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=r!==c,this._pitching=u!==a,this._rolling=h!==s,this._padding=!i.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(g.targetCenter),this._ease(o=>{const m=o*C,y=1/A(m),v=E(m);this._rotating&&i.setBearing(e.C.number(r,c,o)),this._pitching&&i.setPitch(e.C.number(a,u,o)),this._rolling&&i.setRoll(e.C.number(s,h,o)),this._padding&&(i.interpolatePadding(l,d,o),f=i.centerPoint.add(p)),g.easeFunc(o,y,v,f),this.terrain&&!t.freezeElevation&&this._updateElevation(o),this._applyUpdatedTransform(i),this._fireMoveEvents(n)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}return t||null===(n=this.handlers)||void 0===n||n.stop(!1),this}_ease(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this._easeStart=o.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=e.aO(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.S.convert(t),this.transform.tileZoom):null}}const La={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ka{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:La;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=s.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=s.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const n=this._map._getUIString("AttributionControl.".concat(e));t.title=n,t.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(t=>"string"!=typeof t?"":t)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const n=e[i];if(n.used||n.usedForTerrain){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter(t=>String(t).trim()),t.sort((t,e)=>t.length-e.length),t=t.filter((e,n)=>{for(let i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0});const n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=s.sanitize(n),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ra{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=s.create("div","maplibregl-ctrl");const e=s.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Da{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,n=e?this._queue.concat(e):this._queue;for(const i of n)if(i.id===t)return void(i.cancelled=!0)}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const n of e)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Na=e.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class za extends e.E{constructor(t){super(),this._lastTilesetChange=o.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const i={};for(const r of vt(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))i[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.terrainRttPosMatrix32f=new Float64Array(16),e.bY(r.terrainRttPosMatrix32f,0,e.$,e.$,0,0,1),this._tiles[r.key]=new rt(r,this.tileSize),this._lastTilesetChange=o.now());for(const e in this._tiles)i[e]||delete this._tiles[e]}freeRtt(t){for(const e in this._tiles){const n=this._tiles[e];(!t||n.tileID.equals(t)||n.tileID.isChildOf(t)||t.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,e){return e?this._getTerrainCoordsForTileRanges(t,e):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const i of this._renderableTilesKeys){const r=this._tiles[i].tileID,a=t.clone(),o=e.ba();if(r.canonical.equals(t.canonical))e.bY(o,0,e.$,e.$,0,0,1);else if(r.canonical.isChildOf(t.canonical)){const n=r.canonical.z-t.canonical.z,i=r.canonical.x-(r.canonical.x>>n<<n),a=r.canonical.y-(r.canonical.y>>n<<n),s=e.$>>n;e.bY(o,0,s,s,0,0,1),e.M(o,o,[-i*s,-a*s,0])}else{if(!t.canonical.isChildOf(r.canonical))continue;{const n=t.canonical.z-r.canonical.z,i=t.canonical.x-(t.canonical.x>>n<<n),a=t.canonical.y-(t.canonical.y>>n<<n),s=e.$>>n;e.bY(o,0,e.$,e.$,0,0,1),e.M(o,o,[i*s,a*s,0]),e.N(o,o,[1/2**n,1/2**n,0])}}a.terrainRttPosMatrix32f=new Float32Array(o),n[i]=a}return n}_getTerrainCoordsForTileRanges(t,n){const i={};for(const r of this._renderableTilesKeys){const a=this._tiles[r].tileID;if(!this._isWithinTileRanges(a,n))continue;const o=t.clone(),s=e.ba();if(a.canonical.z===t.canonical.z){const n=t.canonical.x-a.canonical.x,i=t.canonical.y-a.canonical.y;e.bY(s,0,e.$,e.$,0,0,1),e.M(s,s,[n*e.$,i*e.$,0])}else if(a.canonical.z>t.canonical.z){const n=a.canonical.z-t.canonical.z,i=a.canonical.x-(a.canonical.x>>n<<n),r=a.canonical.y-(a.canonical.y>>n<<n),o=t.canonical.x-(a.canonical.x>>n),l=t.canonical.y-(a.canonical.y>>n),c=e.$>>n;e.bY(s,0,c,c,0,0,1),e.M(s,s,[-i*c+o*e.$,-r*c+l*e.$,0])}else{const n=t.canonical.z-a.canonical.z,i=t.canonical.x-(t.canonical.x>>n<<n),r=t.canonical.y-(t.canonical.y>>n<<n),o=(t.canonical.x>>n)-a.canonical.x,l=(t.canonical.y>>n)-a.canonical.y,c=e.$<<n;e.bY(s,0,c,c,0,0,1),e.M(s,s,[i*e.$+o*c,r*e.$+l*c,0])}o.terrainRttPosMatrix32f=new Float32Array(s),i[r]=o}return i}getSourceTile(t,e){const n=this.sourceCache._source;let i=t.overscaledZ-this.deltaZoom;if(i>n.maxzoom&&(i=n.maxzoom),i<n.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(i).key);let r=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!r||!r.dem)&&e)for(;i>=n.minzoom&&(!r||!r.dem);)r=this.sourceCache.getTileByID(t.scaledTo(i--).key);return r}anyTilesAfterTime(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return this._lastTilesetChange>=t}_isWithinTileRanges(t,e){return e[t.canonical.z]&&t.canonical.x>=e[t.canonical.z].minTileX&&t.canonical.x<=e[t.canonical.z].maxTileX&&t.canonical.y>=e[t.canonical.z].minTileY&&t.canonical.y<=e[t.canonical.z].maxTileY}}class Fa{constructor(t,e,n){this._meshCache={},this.painter=t,this.sourceCache=new za(e),this.options=n,this.exaggeration="number"==typeof n.exaggeration?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.$;var a;if(!(n>=0&&n<r&&i>=0&&i<r))return 0;const o=this.getTerrainData(t),s=null===(a=o.tile)||void 0===a?void 0:a.dem;if(!s)return 0;const l=e.cs([],[n/r*e.$,i/r*e.$],o.u_terrain_matrix),c=[l[0]*s.dim,l[1]*s.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return s.get(u,h)*(1-d)*(1-p)+s.get(u+1,h)*d*(1-p)+s.get(u,h+1)*(1-d)*p+s.get(u+1,h+1)*d*p}getElevationForLngLatZoom(t,n){if(!e.ct(n,t.wrap()))return 0;const{tileID:i,mercatorX:r,mercatorY:a}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(i,r%e.$,a%e.$,e.$)}getElevation(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.$;return this.getDEMElevation(t,n,i,r)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const t=this.painter.context,n=new e.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new e.T(t,n,t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new e.T(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.ag([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const t=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new e.T(t,n.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),n.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const i=n&&n+n.tileID.key+t.key;if(i&&!this._demMatrixCache[i]){const i=this.sourceCache.sourceCache._source.maxzoom;let r=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=i?r=t.canonical.z-i:e.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const a=t.canonical.x-(t.canonical.x>>r<<r),o=t.canonical.y-(t.canonical.y>>r<<r),s=e.cu(new Float64Array(16),[1/(e.$<<r),1/(e.$<<r),0]);e.M(s,s,[a*e.$,o*e.$,0]),this._demMatrixCache[t.key]={matrix:s,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:i?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,i=n.width/devicePixelRatio,r=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new e.T(n.context,{width:i,height:r,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new e.T(n.context,{width:i,height:r,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,a=0;e<this._coordsTextureSize;e++)for(let t=0;t<this._coordsTextureSize;t++,a+=4)n[a+0]=255&t,n[a+1]=255&e,n[a+2]=t>>8<<4|e>>8,n[a+3]=0;const i=new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),r=new e.T(t,i,t.gl.RGBA,{premultiply:!1});return r.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),i=this.painter.context,r=i.gl,a=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),o=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),s=Math.round(this.painter.height/devicePixelRatio);i.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(a,s-o-1,1,1,r.RGBA,r.UNSIGNED_BYTE,n),i.bindFramebuffer.set(null);const l=n[0]+(n[2]>>4<<8),c=n[1]+((15&n[2])<<8),u=this.coordsIndex[255-n[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new e.a1((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(t){const e=new Uint8Array(4),n=this.painter.context,i=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),i.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,i.RGBA,i.UNSIGNED_BYTE,e),n.bindFramebuffer.set(null),(e[0]/16777216+e[1]/65536+e[2]/256+e[3])/256}getTerrainMesh(t){var n;const i=(null===(n=this.painter.style.projection)||void 0===n?void 0:n.transitionState)>0,r=i&&0===t.canonical.y,a=i&&t.canonical.y===(1<<t.canonical.z)-1,o="m_".concat(r?"n":"","_").concat(a?"s":"");if(this._meshCache[o])return this._meshCache[o];const s=this.painter.context,l=new e.cv,c=new e.aN,u=this.meshSize,h=e.$/u,d=u*u;for(let e=0;e<=u;e++)for(let t=0;t<=u;t++)l.emplaceBack(t*h,e*h,0);for(let e=0;e<d;e+=u+1)for(let t=0;t<u;t++)c.emplaceBack(t+e,u+t+e+1,u+t+e+2),c.emplaceBack(t+e,u+t+e+2,t+e+1);const p=l.length,f=p+(u+1),m=(u+1)*u,g=r?e.bh:0,y=r?0:1,v=a?e.bi:e.$,_=a?0:1;for(let e=0;e<=u;e++)l.emplaceBack(e*h,g,y);for(let e=0;e<=u;e++)l.emplaceBack(e*h,v,_);for(let e=0;e<u;e++)c.emplaceBack(m+e,f+e,f+e+1),c.emplaceBack(m+e,f+e+1,m+e+1),c.emplaceBack(0+e,p+e+1,p+e),c.emplaceBack(0+e,0+e+1,p+e+1);const b=l.length,x=b+2*(u+1);for(const S of[0,1])for(let t=0;t<=u;t++)for(const n of[0,1])l.emplaceBack(S*e.$,t*h,n);for(let e=0;e<2*u;e+=2)c.emplaceBack(b+e,b+e+1,b+e+3),c.emplaceBack(b+e,b+e+3,b+e+2),c.emplaceBack(x+e,x+e+3,x+e+1),c.emplaceBack(x+e,x+e+2,x+e+3);const w=new we(s.createVertexBuffer(l,Na.members),s.createIndexBuffer(c),e.aM.simpleSegment(0,0,l.length,c.length));return this._meshCache[o]=w,w}getMeshFrameDelta(t){return 2*Math.PI*e.bu/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,e){var n;const{tileID:i}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(n=this.getMinMaxElevation(i).minElevation)&&void 0!==n?n:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,n={minElevation:null,maxElevation:null};return e&&e.dem&&(n.minElevation=e.dem.min*this.exaggeration,n.maxElevation=e.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(t,n){const i=e.a1.fromLngLat(t.wrap()),r=(1<<n)*e.$,a=i.x*r,o=i.y*r,s=Math.floor(a/e.$),l=Math.floor(o/e.$);return{tileID:new e.Z(n,0,n,s,l),mercatorX:a,mercatorY:o}}}class Oa{constructor(t,e,n){this._context=t,this._size=e,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new e.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(i.texture),{id:t,fbo:n,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(e=>t.id!==e),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(t=>!t.inUse)}}const Ba={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ua{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new Oa(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(n=>!t._layers[n].isHidden(e)),this._coordsAscending={};for(const n in t.sourceCaches){this._coordsAscending[n]={};const e=t.sourceCaches[n].getVisibleCoordinates(),i=t.sourceCaches[n].getSource(),r=i instanceof Y?i.terrainTileRanges:null;for(const t of e){const e=this.terrain.sourceCache.getTerrainCoords(t,r);for(const t in e)this._coordsAscending[n][t]||(this._coordsAscending[n][t]=[]),this._coordsAscending[n][t].push(e[t])}}this._coordsAscendingStr={};for(const n of t._order){const e=t._layers[n],i=e.source;if(Ba[e.type]&&!this._coordsAscendingStr[i]){this._coordsAscendingStr[i]={};for(const t in this._coordsAscending[i])this._coordsAscendingStr[i][t]=this._coordsAscending[i][t].map(t=>t.key).sort().join()}}for(const n of this._renderableTiles)for(const t in this._coordsAscendingStr){const e=this._coordsAscendingStr[t][n.tileID.key];e&&e!==n.rttCoords[t]&&(n.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const i=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),r=t.type,a=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ba[r]&&(this._prevType&&Ba[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!o))return!0;if(Ba[this._prevType]||Ba[r]&&o){this._prevType=r;const t=this._stacks.length-1,n=this._stacks[t]||[];for(const r of this._renderableTiles){if(this.pool.isFull()&&(Tr(this.painter,this.terrain,this._rttTiles,i),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(r),r.rtt[t]){const e=this.pool.getObjectForId(r.rtt[t].id);if(e.stamp===r.rtt[t].stamp){this.pool.useObject(e);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),r.rtt[t]={id:o.id,stamp:o.stamp},a.context.bindFramebuffer.set(o.fbo.framebuffer),a.context.clear({color:e.bf.transparent,stencil:0}),a.currentStencilSource=void 0;for(let t=0;t<n.length;t++){const e=a.style._layers[n[t]],s=e.source?this._coordsAscending[e.source][r.tileID.key]:[r.tileID];a.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),a._renderTileClippingMasks(e,s,!0),a.renderLayer(a,a.style.sourceCaches[e.source],e,s,i),e.source&&(r.rttCoords[e.source]=this._coordsAscendingStr[e.source][r.tileID.key])}}return Tr(this.painter,this.terrain,this._rttTiles,i),this._rttTiles=[],this.pool.freeAllObjects(),Ba[r]}return!1}}const ja={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Va=n,Ha={hash:!1,interactive:!0,bearingSnap:7,attributionControl:La,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Ga={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Wa{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.mousedown=t=>{this.startMove(t,s.mousePos(this.element,t)),s.addEventListener(window,"mousemove",this.mousemove),s.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.move(t,s.mousePos(this.element,t))},this.mouseup=t=>{this._rotatePitchHandler.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.startMove(t,this._startPos),s.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.move(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const r=new na;this._rotatePitchHandler=new Kr({clickTolerance:3,move:(t,r)=>{const a=n.getBoundingClientRect(),o=new e.P((a.bottom-a.top)/2,(a.right-a.left)/2);return{bearingDelta:e.cn(new e.P(t.x,r.y),r,o),pitchDelta:i?-.5*(r.y-t.y):void 0}},moveStateManager:r,enable:!0,assignEvents:()=>{}}),this.map=t,s.addEventListener(n,"mousedown",this.mousedown),s.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(n,"touchcancel",this.reset)}startMove(t,e){this._rotatePitchHandler.dragStart(t,e),s.disableDrag()}move(t,e){const n=this.map,{bearingDelta:i,pitchDelta:r}=this._rotatePitchHandler.dragMove(t,e)||{};i&&n.setBearing(n.getBearing()+i),r&&n.setPitch(n.getPitch()+r)}off(){const t=this.element;s.removeEventListener(t,"mousedown",this.mousedown),s.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend),s.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(window,"mousemove",this.mousemove),s.removeEventListener(window,"mouseup",this.mouseup),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend)}}let qa;function Za(t,n,i){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return null==t?void 0:t.wrap();const r=new e.S(t.lng,t.lat);if(t=new e.S(t.lng,t.lat),n){const r=new e.S(t.lng-360,t.lat),a=new e.S(t.lng+360,t.lat),o=i.locationToScreenPoint(t).distSqr(n);i.locationToScreenPoint(r).distSqr(n)<o?t=r:i.locationToScreenPoint(a).distSqr(n)<o&&(t=a)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationToScreenPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t.lng!==r.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(t))?t:r}const Xa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ya(t,e,n){const i=t.classList;for(const r in Xa)i.remove("maplibregl-".concat(n,"-anchor-").concat(r));i.add("maplibregl-".concat(n,"-anchor-").concat(e))}class Ka extends e.E{constructor(t){if(super(),this._onKeyPress=t=>{const e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},this._update=t=>{if(!this._map)return;const e=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!e)&&this._map.once("render",this._update),this._lngLat=Za(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let n="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?n="rotateZ(".concat(this._rotation,"deg)"):"map"===this._rotationAlignment&&(n="rotateZ(".concat(this._rotation-this._map.getBearing(),"deg)"));let i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i="rotateX(".concat(this._map.getPitch(),"deg)")),this._subpixelPositioning||t&&"moveend"!==t.type||(this._pos=this._pos.round()),s.setTransform(this._element,"".concat(Xa[this._anchor]," translate(").concat(this._pos.x,"px, ").concat(this._pos.y,"px) ").concat(i," ").concat(n)),o.frameAsync(new AbortController).then(()=>{this._updateOpacity(t&&"moveend"===t.type)}).catch(()=>{})},this._onMove=t=>{if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.l("dragstart"))),this.fire(new e.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.l("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this.setOpacity(null==t?void 0:t.opacity,null==t?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div");const n=s.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","".concat(i,"px")),n.setAttributeNS(null,"width","".concat(r,"px")),n.setAttributeNS(null,"viewBox","0 0 ".concat(r," ").concat(i));const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=s.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=s.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),o.appendChild(l),o.appendChild(u),o.appendChild(d),o.appendChild(f),o.appendChild(m),n.appendChild(o),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()}),Ya(this._element,this._anchor,"marker"),t&&t.className)for(const e of t.className.split(" "))this._element.classList.add(e);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,n=13.5,i=Math.abs(n)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[i,-1*(e-n+i)],"bottom-right":[-i,-1*(e-n+i)],left:[n,-1*(e-n)],right:[-n,-1*(e-n)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var n,i;const r=null===(n=this._map)||void 0===n?void 0:n.terrain,a=this._map.transform.isLocationOccluded(this._lngLat);if(!r||a){const t=a?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==t&&(this._element.style.opacity=t))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const o=this._map,s=o.terrain.depthAtPoint(this._pos),l=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,l)-s<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/o.transform.pixelsPerMeter,u=Math.sin(o.getPitch()*Math.PI/180)*c,h=o.terrain.depthAtPoint(new e.P(this._pos.x,this._pos.y-this._offset.y)),d=o.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(i=this._popup)||void 0===i?void 0:i.isOpen())&&d&&this._popup.remove(),this._element.style.opacity=d?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,e){return(void 0===this._opacity||void 0===t&&void 0===e)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==t&&(this._opacity=t),void 0!==e&&(this._opacityWhenCovered=e),this._map&&this._updateOpacity(!0),this}}const Ja={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $a=0,Qa=!1;const to={maxWidth:100,unit:"metric"};function eo(t,e,n){const i=n&&n.maxWidth||100,r=t._container.clientHeight/2,a=t._container.clientWidth/2,o=t.unproject([a-i/2,r]),s=t.unproject([a+i/2,r]),l=Math.round(t.project(s).x-t.project(o).x),c=Math.min(i,l,t._container.clientWidth),u=o.distanceTo(s);if(n&&"imperial"===n.unit){const n=3.2808*u;n>5280?no(e,c,n/5280,t._getUIString("ScaleControl.Miles")):no(e,c,n,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?no(e,c,u/1852,t._getUIString("ScaleControl.NauticalMiles")):u>=1e3?no(e,c,u/1e3,t._getUIString("ScaleControl.Kilometers")):no(e,c,u,t._getUIString("ScaleControl.Meters"))}function no(t,e,n,i){const r=function(t){const e=Math.pow(10,"".concat(Math.floor(t)).length-1);let n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n),e*n}(n);t.style.width=e*(r/n)+"px",t.innerHTML="".concat(r,"&nbsp;").concat(i)}const io={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ro=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ao(t){if(t){if("number"==typeof t){const n=Math.round(Math.abs(t)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,t),"top-left":new e.P(n,n),"top-right":new e.P(-n,n),bottom:new e.P(0,-t),"bottom-left":new e.P(n,-n),"bottom-right":new e.P(-n,-n),left:new e.P(t,0),right:new e.P(-t,0)}}if(t instanceof e.P||Array.isArray(t)){const n=e.P.convert(t);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:e.P.convert(t.center||[0,0]),top:e.P.convert(t.top||[0,0]),"top-left":e.P.convert(t["top-left"]||[0,0]),"top-right":e.P.convert(t["top-right"]||[0,0]),bottom:e.P.convert(t.bottom||[0,0]),"bottom-left":e.P.convert(t["bottom-left"]||[0,0]),"bottom-right":e.P.convert(t["bottom-right"]||[0,0]),left:e.P.convert(t.left||[0,0]),right:e.P.convert(t.right||[0,0])}}return ao(new e.P(0,0))}const oo=n;t.AJAXError=e.cz,t.Event=e.l,t.Evented=e.E,t.LngLat=e.S,t.MercatorCoordinate=e.a1,t.Point=e.P,t.addProtocol=e.cA,t.config=e.a,t.removeProtocol=e.cB,t.AttributionControl=ka,t.BoxZoomHandler=Wr,t.CanvasSource=J,t.CooperativeGesturesHandler=Ta,t.DoubleClickZoomHandler=_a,t.DragPanHandler=wa,t.DragRotateHandler=Sa,t.EdgeInsets=Ee,t.FullscreenControl=class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._onFullscreenChange=()=>{var t;let e=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.fullscreenElement;)e=e.shadowRoot.fullscreenElement;e===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=s.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);s.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new e.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new e.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},t.GeoJSONSource=X,t.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new e.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new e.S(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),a=e.e({bearing:r},this.options.fitBoundsOptions),o=H.fromLngLat(n,i);this._map.fitBounds(o,a,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new e.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Qa)return;this.options.trackUserLocation&&this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new e.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=s.create("button","maplibregl-ctrl-geolocate",this._container),s.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ka({element:this._dotElement}),this._circleElement=s.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ka({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{const n=(null==t?void 0:t[0])instanceof ResizeObserverEntry;t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new e.l("trackuserlocationend")),this.fire(new e.l("userlocationlostfocus")))})}},this.options=e.e({},Ja,t)}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return e._(this,arguments,void 0,function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function*(){if(void 0!==qa&&!t)return qa;if(void 0===window.navigator.permissions)return qa=!!window.navigator.geolocation,qa;try{const t=yield window.navigator.permissions.query({name:"geolocation"});qa="denied"!==t.state}catch(t){qa=!!window.navigator.geolocation}return qa}()})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$a=0,Qa=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),n=t.getNorthEast(),i=e.distanceTo(n),r=Math.ceil(this._accuracy/(i/this._map._container.clientHeight)*2);this._circleElement.style.width="".concat(r,"px"),this._circleElement.style.height="".concat(r,"px")}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$a--,Qa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new e.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.l("trackuserlocationstart")),this.fire(new e.l("userlocationfocus"));break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$a++,$a>1?(t={maximumAge:6e5,timeout:0},Qa=!0):(t=this.options.positionOptions,Qa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},t.GlobeControl=class{constructor(){this._toggleProjection=()=>{var t;const e=null===(t=this._map.getProjection())||void 0===t?void 0:t.type;this._map.setProjection("mercator"!==e&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var t;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(t=this._map.getProjection())||void 0===t?void 0:t.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=s.create("button","maplibregl-ctrl-globe",this._container),s.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},t.Hash=Pr,t.ImageSource=Y,t.KeyboardHandler=fa,t.LngLatBounds=H,t.LogoControl=Ra,t.Map=class extends Ia{constructor(t){var n,i;e.cw.mark(e.cx.create);const r=Object.assign(Object.assign(Object.assign({},Ha),t),{canvasContextAttributes:Object.assign(Object.assign({},Ha.canvasContextAttributes),t.canvasContextAttributes)});if(null!=r.minZoom&&null!=r.maxZoom&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=r.minPitch&&null!=r.maxPitch&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=r.minPitch&&r.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=r.maxPitch&&r.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const a=new De,o=new Oe;if(void 0!==r.minZoom&&a.setMinZoom(r.minZoom),void 0!==r.maxZoom&&a.setMaxZoom(r.maxZoom),void 0!==r.minPitch&&a.setMinPitch(r.minPitch),void 0!==r.maxPitch&&a.setMaxPitch(r.maxPitch),void 0!==r.renderWorldCopies&&a.setRenderWorldCopies(r.renderWorldCopies),super(a,o,{bearingSnap:r.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Da,this._controls=[],this._mapId=e.a7(),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new e.l("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.l("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._maxTileCacheZoomLevels=r.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},r.canvasContextAttributes),this._trackResize=!0===r.trackResize,this._bearingSnap=r.bearingSnap,this._centerClampedToGround=r.centerClampedToGround,this._refreshExpiredTiles=!0===r.refreshExpiredTiles,this._fadeDuration=r.fadeDuration,this._crossSourceCollisions=!0===r.crossSourceCollisions,this._collectResourceTiming=!0===r.collectResourceTiming,this._locale=Object.assign(Object.assign({},ja),r.locale),this._clickTolerance=r.clickTolerance,this._overridePixelRatio=r.pixelRatio,this._maxCanvasSize=r.maxCanvasSize,this.transformCameraUpdate=r.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===r.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=f.addThrottleControl(()=>this.isMoving()),this._requestManager=new m(r.transformRequest),"string"==typeof r.container){if(this._container=document.getElementById(r.container),!this._container)throw new Error("Container '".concat(r.container,"' not found."))}else{if(!(r.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=Cr(t=>{this._trackResize&&!this._removed&&(this.resize(t),this.redraw())},50);this._resizeObserver=new ResizeObserver(n=>{t?e(n):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Pa(this,r),this._hash=r.hash&&new Pr("string"==typeof r.hash&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,elevation:r.elevation,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,roll:r.roll}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,e.e({},r.fitBoundsOptions,{duration:0}))));const s="string"==typeof r.style||!("globe"===(null===(i=null===(n=r.style)||void 0===n?void 0:n.projection)||void 0===i?void 0:i.type));this.resize(null,s),this._localIdeographFontFamily=r.localIdeographFontFamily,this._validateStyle=r.validateStyle,r.style&&this.setStyle(r.style,{localIdeographFontFamily:r.localIdeographFontFamily}),r.attributionControl&&this.addControl(new ka("boolean"==typeof r.attributionControl?void 0:r.attributionControl)),r.maplibreLogo&&this.addControl(new Ra,r.logoPosition),this.on("style.load",()=>{if(s||this._resizeTransform(),this.transform.unmodified){const t=e.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(t)}}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.l("".concat(t.dataType,"data"),t))}),this.on("dataloading",t=>{this.fire(new e.l("".concat(t.dataType,"dataloading"),t))}),this.on("dataabort",t=>{this.fire(new e.l("sourcedataabort",t))})}_getMapId(){return this._mapId}setGlobalStateProperty(t,e){return this.style.setGlobalStateProperty(t,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,n,i){return null==i&&this.terrain&&(i=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,n,i)}resize(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[i,r]=this._containerDimensions(),a=this._getClampedPixelRatio(i,r);if(this._resizeCanvas(i,r,a),this.painter.resize(i,r,a),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(i,r);this._resizeCanvas(i,r,e),this.painter.resize(i,r,e)}this._resizeTransform(n);const o=!this._moving;return o&&(this.stop(),this.fire(new e.l("movestart",t)).fire(new e.l("move",t))),this.fire(new e.l("resize",t)),o&&this.fire(new e.l("moveend",t)),this}_resizeTransform(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e;const[n,i]=this._containerDimensions();this.transform.resize(n,i,t),null===(e=this._requestedCameraState)||void 0===e||e.resize(n,i,t)}_getClampedPixelRatio(t,e){const{0:n,1:i}=this._maxCanvasSize,r=this.getPixelRatio(),a=t*r,o=e*r;return Math.min(a>n?n/a:1,o>i?i/o:1)*r}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(H.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.setMinZoom(t),this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.setMaxZoom(t),this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.setMinPitch(t),this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>180)throw new Error("maxPitch must be less than or equal to 180");if(t>=this.transform.minPitch)return this.transform.setMaxPitch(t),this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.setRenderWorldCopies(t),this._update()}project(t){return this.transform.locationToScreenPoint(e.S.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.screenPointToLocation(e.P.convert(t),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;const r=r=>{const a=e.filter(t=>this.getLayer(t)),o=0!==a.length?this.queryRenderedFeatures(r.point,{layers:a}):[];o.length?i||(i=!0,n.call(this,new Br(t,this,r.originalEvent,{features:o}))):i=!1};return{layers:e,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const r=r=>{const a=e.filter(t=>this.getLayer(t));(0!==a.length?this.queryRenderedFeatures(r.point,{layers:a}):[]).length?i=!0:i&&(i=!1,n.call(this,new Br(t,this,r.originalEvent)))},a=e=>{i&&(i=!1,n.call(this,new Br(t,this,e.originalEvent)))};return{layers:e,listener:n,delegates:{mousemove:r,mouseout:a}}}{const i=t=>{const i=e.filter(t=>this.getLayer(t)),r=0!==i.length?this.queryRenderedFeatures(t.point,{layers:i}):[];r.length&&(t.features=r,n.call(this,t),delete t.features)};return{layers:e,listener:n,delegates:{[t]:i}}}}_saveDelegatedListener(t,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(e)}_removeDelegatedListener(t,e,n){if(!this._delegatedListeners||!this._delegatedListeners[t])return;const i=this._delegatedListeners[t];for(let r=0;r<i.length;r++){const t=i[r];if(t.listener===n&&t.layers.length===e.length&&t.layers.every(t=>e.includes(t))){for(const e in t.delegates)this.off(e,t.delegates[e]);return void i.splice(r,1)}}}on(t,e,n){if(void 0===n)return super.on(t,e);const i="string"==typeof e?[e]:e,r=this._createDelegatedListener(t,i,n);this._saveDelegatedListener(t,r);for(const a in r.delegates)this.on(a,r.delegates[a]);return{unsubscribe:()=>{this._removeDelegatedListener(t,i,n)}}}once(t,e,n){var i=this;if(void 0===n)return super.once(t,e);const r="string"==typeof e?[e]:e,a=this._createDelegatedListener(t,r,n);for(const o in a.delegates){const e=a.delegates[o];a.delegates[o]=function(){i._removeDelegatedListener(t,r,n),e(...arguments)}}this._saveDelegatedListener(t,a);for(const o in a.delegates)this.once(o,a.delegates[o]);return this}off(t,e,n){return void 0===n?super.off(t,e):(this._removeDelegatedListener(t,"string"==typeof e?[e]:e,n),this)}queryRenderedFeatures(t,n){if(!this.style)return[];let i;const r=t instanceof e.P||Array.isArray(t),a=r?t:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(r?{}:t)||{},a instanceof e.P||"number"==typeof a[0])i=[e.P.convert(a)];else{const t=e.P.convert(a[0]),n=e.P.convert(a[1]);i=[t,new e.P(n.x,t.y),n,new e.P(t.x,n.y),t]}return this.style.queryRenderedFeatures(i,n,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(t,n){return!1!==(n=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(t,n))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error("Missing UI string '".concat(t,"'"));return e}_updateStyle(t,e){var n,i;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(t,e));const r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new Sn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,r):this.style.loadJSON(t,e,r),this):(null===(i=null===(n=this.style)||void 0===n?void 0:n.projection)||void 0===i||i.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,n){if("string"==typeof t){const i=this._requestManager.transformRequest(t,"Style");e.j(i,new AbortController).then(t=>{this._updateDiff(t.data,n)}).catch(t=>{t&&this.fire(new e.k(t))})}else"object"==typeof t&&this._updateDiff(t,n)}_updateDiff(t,n){try{this.style.setState(t,n)&&this._update(!0)}catch(i){e.w("Unable to perform style diff: ".concat(i.message||i.error||i,".  Rebuilding the style from scratch.")),this._updateStyle(t,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){const n=this.style&&this.style.sourceCaches[t];if(void 0!==n)return n.loaded();this.fire(new e.k(new Error("There is no source with ID '".concat(t,"'"))))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),t){const n=this.style.sourceCaches[t.source];if(!n)throw new Error("cannot load terrain, because there exists no source with ID: ".concat(t.source));null===this.terrain&&n.reload();for(const i in this.style._layers){const n=this.style._layers[i];"hillshade"===n.type&&n.source===t.source&&e.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===n.type&&n.source===t.source&&e.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Fa(this.painter,n,t),this.painter.renderToTexture=new Ua(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=e=>{var n;"style"===e.dataType?this.terrain.sourceCache.freeRtt():"source"===e.dataType&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(n=e.source)||void 0===n?void 0:n.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new e.l("terrain",{terrain:t})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const n=t[e]._tiles;for(const t in n){const e=n[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}setSourceTileLodParams(t,e,n){if(n){const i=this.getSource(n);if(!i)throw new Error('There is no source with ID "'.concat(n,'", cannot set LOD parameters'));i.calculateTileZoom=mt(Math.max(1,t),Math.max(1,e))}else for(const i in this.style.sourceCaches)this.style.sourceCaches[i].getSource().calculateTileZoom=mt(Math.max(1,t),Math.max(1,e));return this._update(!0),this}refreshTiles(t,n){const i=this.style.sourceCaches[t];if(!i)throw new Error('There is no source cache with ID "'.concat(t,'", cannot refresh tile'));void 0===n?i.reload(!0):i.refreshTiles(n.map(t=>new e.a4(t.z,t.x,t.y)))}addImage(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{pixelRatio:r=1,sdf:a=!1,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=i;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||e.b(n))){if(void 0===n.width||void 0===n.height)return this.fire(new e.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:i,height:o,data:d}=n,p=n;return this.style.addImage(t,{data:new e.R({width:i,height:o},new Uint8Array(d)),pixelRatio:r,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:a,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t),this}}{const{width:i,height:d,data:p}=o.getImageData(n);this.style.addImage(t,{data:new e.R({width:i,height:d},p),pixelRatio:r,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:a,version:0})}}updateImage(t,n){const i=this.style.getImage(t);if(!i)return this.fire(new e.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof HTMLImageElement||e.b(n)?o.getImageData(n):n,{width:a,height:s,data:l}=r;if(void 0===a||void 0===s)return this.fire(new e.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==i.data.width||s!==i.data.height)return this.fire(new e.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(n instanceof HTMLImageElement||e.b(n));return i.data.replace(l,c),this.style.updateImage(t,i),this}getImage(t){return this.style.getImage(t)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.k(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t){return f.getImage(this._requestManager.transformRequest(t,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)}setFilter(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.style.setFilter(t,e,n),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setPaintProperty(t,e,n,i),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setLayoutProperty(t,e,n,i),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,n,t=>{t||this._update(!0)}),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,t=>{t||this._update(!0)}),this}setLight(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSky(t,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=s.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=s.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),i=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],i);const r=this._controlContainer=s.create("div","maplibregl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{a[t]=s.create("div","maplibregl-ctrl-".concat(t," "),r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e,n){this._canvas.width=Math.floor(n*t),this._canvas.height=Math.floor(n*e),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(e,"px")}_setupPainter(){const t=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",n=>{e={requestedAttributes:t},n&&(e.statusMessage=n.statusMessage,e.type=n.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,t):this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t),!n){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new Er(n,this.transform),l.testSupport(n)}migrateProjection(t,n){super.migrateProjection(t,n),this.painter.transform=t,this.fire(new e.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){var n,i,r,a,s;const l=this._idleTriggered?this._fadeDuration:0,c=(null===(n=this.style.projection)||void 0===n?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=o.now();this.style.zoomHistory.update(t,n);const i=new e.F(t,{now:n,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(u=!0,this._crossFadingFactor=r),this.style.update(i)}const h=(null===(i=this.style.projection)||void 0===i?void 0:i.transitionState)>0!==c;null===(r=this.style.projection)||void 0===r||r.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(a=this.style.projection)||void 0===a?void 0:a.transitionState,null===(s=this.style.projection)||void 0===s?void 0:s.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new e.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.cw.mark(e.cx.load),this.fire(new e.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,e.cw.mark(e.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),f.removeThrottleControl(this._imageQueueHandle),null===(t=this._resizeObserver)||void 0===t||t.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==n?void 0:n.loseContext)&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),s.remove(this._canvasContainer),s.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),e.cw.clearMetrics(),this._removed=!0,this.fire(new e.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,o.frame(this._frameRequest,t=>{e.cw.frame(t),this._frameRequest=null;try{this._render(t)}catch(t){if(!e.cy(t)&&!function(t){return t.message===qi}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return Va}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(t){return this._lazyInitEmptyStyle(),this.style.setProjection(t),this._update(!0)}},t.MapMouseEvent=Br,t.MapTouchEvent=Ur,t.MapWheelEvent=jr,t.Marker=Ka,t.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5),") rotateZ(").concat(-this._map.transform.roll,"deg) rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(-this._map.transform.bearing,"deg)"):this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5),") rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(-this._map.transform.bearing,"deg)"):this.options.visualizeRoll?"rotate(".concat(-this._map.transform.bearing-this._map.transform.roll,"deg)"):"rotate(".concat(-this._map.transform.bearing,"deg)")},this._setButtonTitle=(t,e)=>{const n=this._map._getUIString("NavigationControl.".concat(e));t.title=n,t.setAttribute("aria-label",n)},this.options=e.e({},Ga,t),this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),s.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),s.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=s.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const n=s.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}},t.Popup=class extends e.E{constructor(t){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?"".concat(this.options.locationOccludedOpacity):"")},this.remove=()=>(this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new e.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=s.create("div","maplibregl-popup",this._map.getContainer()),this._tip=s.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Za(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const e=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let n=this.options.anchor;const i=ao(this.options.offset);if(!n){const t=this._container.offsetWidth,r=this._container.offsetHeight;let a;a=e.y+i.bottom.y<r?["top"]:e.y>this._map.transform.height-r?["bottom"]:[],e.x<t/2?a.push("left"):e.x>this._map.transform.width-t/2&&a.push("right"),n=0===a.length?"bottom":a.join("-")}let r=e.add(i[n]);this.options.subpixelPositioning||(r=r.round()),s.setTransform(this._container,"".concat(Xa[n]," translate(").concat(r.x,"px,").concat(r.y,"px)")),Ya(this._container,n,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(io),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new e.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.S.convert(t),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){return this._container&&this._container.classList.add(t),this}removeClassName(t){return this._container&&this._container.classList.remove(t),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}setSubpixelPositioning(t){this.options.subpixelPositioning=t}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(ro);t&&t.focus()}},t.RasterDEMTileSource=Z,t.RasterTileSource=q,t.ScaleControl=class{constructor(t){this._onMove=()=>{eo(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,eo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},to),t)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},t.ScrollZoomHandler=va,t.Style=Sn,t.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=t}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=s.create("button","maplibregl-ctrl-terrain",this._container),s.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){s.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},t.TwoFingersTouchPitchHandler=da,t.TwoFingersTouchRotateHandler=ua,t.TwoFingersTouchZoomHandler=la,t.TwoFingersTouchZoomRotateHandler=Ma,t.VectorTileSource=W,t.VideoSource=K,t.addSourceType=(t,n)=>e._(void 0,void 0,void 0,function*(){if(Q(t))throw new Error('A source type called "'.concat(t,'" already exists.'));((t,e)=>{$[t]=e})(t,n)}),t.clearPrewarmedResources=function(){const t=R;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(I),R=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.createTileMesh=Ye,t.getMaxParallelImageRequests=function(){return e.a.MAX_PARALLEL_IMAGE_REQUESTS},t.getRTLTextPluginStatus=function(){return it().getRTLTextPluginStatus()},t.getVersion=function(){return oo},t.getWorkerCount=function(){return L.workerCount},t.getWorkerUrl=function(){return e.a.WORKER_URL},t.importScriptInWorkers=function(t){return F().broadcast("IS",t)},t.prewarm=function(){N().acquire(I)},t.setMaxParallelImageRequests=function(t){e.a.MAX_PARALLEL_IMAGE_REQUESTS=t},t.setRTLTextPlugin=function(t,e){return it().setRTLTextPlugin(t,e)},t.setWorkerCount=function(t){L.workerCount=t},t.setWorkerUrl=function(t){e.a.WORKER_URL=t}}),t}()},3738:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},4202:(t,e)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}function v(){}function _(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},y.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},v.prototype=y.prototype;var b=_.prototype=new v;b.constructor=_,m(b,y.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function T(t,e,i){var r,a={},o=null,s=null;if(null!=e)for(r in void 0!==e.ref&&(s=e.ref),void 0!==e.key&&(o=""+e.key),e)w.call(e,r)&&!M.hasOwnProperty(r)&&(a[r]=e[r]);var l=arguments.length-2;if(1===l)a.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:n,type:t,key:o,ref:s,props:a,_owner:S.current}}function A(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var E=/\/+/g;function C(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function P(t,e,r,a,o){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var l=!1;if(null===t)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=t),t=""===a?"."+C(l,0):a,x(o)?(r="",null!=t&&(r=t.replace(E,"$&/")+"/"),P(o,e,r,"",function(t){return t})):null!=o&&(A(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+t)),e.push(o)),1;if(l=0,a=""===a?".":a+":",x(t))for(var c=0;c<t.length;c++){var u=a+C(s=t[c],c);l+=P(s,e,r,u,o)}else if(u=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=p&&t[p]||t["@@iterator"])?t:null}(t),"function"===typeof u)for(t=u.call(t),c=0;!(s=t.next()).done;)l+=P(s=s.value,e,r,u=a+C(s,c++),o);else if("object"===s)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function I(t,e,n){if(null==t)return t;var i=[],r=0;return P(t,i,"","",function(t){return e.call(n,t,r++)}),i}function L(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var k={current:null},R={transition:null},D={ReactCurrentDispatcher:k,ReactCurrentBatchConfig:R,ReactCurrentOwner:S};function N(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:I,forEach:function(t,e,n){I(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return I(t,function(){e++}),e},toArray:function(t){return I(t,function(t){return t})||[]},only:function(t){if(!A(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=y,e.Fragment=r,e.Profiler=o,e.PureComponent=_,e.StrictMode=a,e.Suspense=u,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,e.act=N,e.cloneElement=function(t,e,i){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),a=t.key,o=t.ref,s=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,s=S.current),void 0!==e.key&&(a=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)w.call(e,c)&&!M.hasOwnProperty(c)&&(r[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:t.type,key:a,ref:o,props:r,_owner:s}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:t},t.Consumer=t},e.createElement=T,e.createFactory=function(t){var e=T.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=A,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:L}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=R.transition;R.transition={};try{t()}finally{R.transition=e}},e.unstable_act=N,e.useCallback=function(t,e){return k.current.useCallback(t,e)},e.useContext=function(t){return k.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return k.current.useDeferredValue(t)},e.useEffect=function(t,e){return k.current.useEffect(t,e)},e.useId=function(){return k.current.useId()},e.useImperativeHandle=function(t,e,n){return k.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return k.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return k.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return k.current.useMemo(t,e)},e.useReducer=function(t,e,n){return k.current.useReducer(t,e,n)},e.useRef=function(t){return k.current.useRef(t)},e.useState=function(t){return k.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return k.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return k.current.useTransition()},e.version="18.3.1"},4391:(t,e,n)=>{"use strict";var i=n(7950);e.createRoot=i.createRoot,e.hydrateRoot=i.hydrateRoot},4612:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<a(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=t[s],c=s+1,u=t[c];if(0>a(l,n))c<r&&0>a(u,l)?(t[i]=u,t[c]=n,i=c):(t[i]=l,t[s]=n,i=s);else{if(!(c<r&&0>a(u,n)))break t;t[i]=u,t[c]=n,i=c}}}return e}function a(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function b(t){for(var e=i(u);null!==e;){if(null===e.callback)r(u);else{if(!(e.startTime<=t))break;r(u),e.sortIndex=e.expirationTime,n(c,e)}e=i(u)}}function x(t){if(g=!1,b(t),!m)if(null!==i(c))m=!0,R(w);else{var e=i(u);null!==e&&D(x,e.startTime-t)}}function w(t,n){m=!1,g&&(g=!1,v(A),A=-1),f=!0;var a=p;try{for(b(n),d=i(c);null!==d&&(!(d.expirationTime>n)||t&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?d.callback=s:d===i(c)&&r(c),b(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(x,h.startTime-n),l=!1}return l}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,A=-1,E=5,C=-1;function P(){return!(e.unstable_now()-C<E)}function I(){if(null!==T){var t=e.unstable_now();C=t;var n=!0;try{n=T(!0,t)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(I)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,k=L.port2;L.port1.onmessage=I,S=function(){k.postMessage(null)}}else S=function(){y(I,0)};function R(t){T=t,M||(M=!0,S())}function D(t,n){A=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,R(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return i(c)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,r,a){var o=e.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,t){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(t.sortIndex=a,n(u,t),null===i(c)&&t===i(u)&&(g?(v(A),A=-1):g=!0,D(x,a-o))):(t.sortIndex=s,n(c,t),m||f||(m=!0,R(w))),t},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},4980:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(2284);function r(t){var e=function(t,e){if("object"!=(0,i.A)(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=(0,i.A)(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==(0,i.A)(e)?e:e+""}function a(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},5043:(t,e,n)=>{"use strict";t.exports=n(4202)},6958:(t,e,n)=>{t.exports=function(t){var e={},i=n(5043),r=n(8853),a=Object.assign;function o(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),v=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var b=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var x=Symbol.iterator;function w(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=x&&t[x]||t["@@iterator"])?t:null}function S(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case y:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case f:return(t.displayName||"Context")+".Consumer";case p:return(t._context.displayName||"Context")+".Provider";case m:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case v:return null!==(e=t.displayName||null)?e:S(t.type)||"Memo";case _:e=t._payload,t=t._init;try{return S(t(e))}catch(n){}}return null}function M(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return S(e);case 8:return e===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function T(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function A(t){if(T(t)!==t)throw Error(o(188))}function E(t){var e=t.alternate;if(!e){if(null===(e=T(t)))throw Error(o(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return A(r),t;if(a===i)return A(r),e;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?t:e}function C(t){return null!==(t=E(t))?P(t):null}function P(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=P(t);if(null!==e)return e;t=t.sibling}return null}function I(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){if(4!==t.tag){var e=I(t);if(null!==e)return e}t=t.sibling}return null}var L,k=Array.isArray,R=t.getPublicInstance,D=t.getRootHostContext,N=t.getChildHostContext,z=t.prepareForCommit,F=t.resetAfterCommit,O=t.createInstance,B=t.appendInitialChild,U=t.finalizeInitialChildren,j=t.prepareUpdate,V=t.shouldSetTextContent,H=t.createTextInstance,G=t.scheduleTimeout,W=t.cancelTimeout,q=t.noTimeout,Z=t.isPrimaryRenderer,X=t.supportsMutation,Y=t.supportsPersistence,K=t.supportsHydration,J=t.getInstanceFromNode,$=t.preparePortalMount,Q=t.getCurrentEventPriority,tt=t.detachDeletedInstance,et=t.supportsMicrotasks,nt=t.scheduleMicrotask,it=t.supportsTestSelectors,rt=t.findFiberRoot,at=t.getBoundingRect,ot=t.getTextContent,st=t.isHiddenSubtree,lt=t.matchAccessibilityRole,ct=t.setFocusIfFocusable,ut=t.setupIntersectionObserver,ht=t.appendChild,dt=t.appendChildToContainer,pt=t.commitTextUpdate,ft=t.commitMount,mt=t.commitUpdate,gt=t.insertBefore,yt=t.insertInContainerBefore,vt=t.removeChild,_t=t.removeChildFromContainer,bt=t.resetTextContent,xt=t.hideInstance,wt=t.hideTextInstance,St=t.unhideInstance,Mt=t.unhideTextInstance,Tt=t.clearContainer,At=t.cloneInstance,Et=t.createContainerChildSet,Ct=t.appendChildToContainerChildSet,Pt=t.finalizeContainerChildren,It=t.replaceContainerChildren,Lt=t.cloneHiddenInstance,kt=t.cloneHiddenTextInstance,Rt=t.canHydrateInstance,Dt=t.canHydrateTextInstance,Nt=t.canHydrateSuspenseInstance,zt=t.isSuspenseInstancePending,Ft=t.isSuspenseInstanceFallback,Ot=t.registerSuspenseInstanceRetry,Bt=t.getNextHydratableSibling,Ut=t.getFirstHydratableChild,jt=t.getFirstHydratableChildWithinContainer,Vt=t.getFirstHydratableChildWithinSuspenseInstance,Ht=t.hydrateInstance,Gt=t.hydrateTextInstance,Wt=t.hydrateSuspenseInstance,qt=t.getNextHydratableInstanceAfterSuspenseInstance,Zt=t.commitHydratedContainer,Xt=t.commitHydratedSuspenseInstance,Yt=t.clearSuspenseBoundary,Kt=t.clearSuspenseBoundaryFromContainer,Jt=t.shouldDeleteUnhydratedTailInstances,$t=t.didNotMatchHydratedContainerTextInstance,Qt=t.didNotMatchHydratedTextInstance;function te(t){if(void 0===L)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);L=e&&e[1]||""}return"\n"+L+t}var ee=!1;function ne(t,e){if(!t||ee)return"";ee=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=s);break}}}finally{ee=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?te(t):""}var ie=Object.prototype.hasOwnProperty,re=[],ae=-1;function oe(t){return{current:t}}function se(t){0>ae||(t.current=re[ae],re[ae]=null,ae--)}function le(t,e){ae++,re[ae]=t.current,t.current=e}var ce={},ue=oe(ce),he=oe(!1),de=ce;function pe(t,e){var n=t.type.contextTypes;if(!n)return ce;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function fe(t){return null!==(t=t.childContextTypes)&&void 0!==t}function me(){se(he),se(ue)}function ge(t,e,n){if(ue.current!==ce)throw Error(o(168));le(ue,e),le(he,n)}function ye(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(o(108,M(t)||"Unknown",r));return a({},n,i)}function ve(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ce,de=ue.current,le(ue,t),le(he,he.current),!0}function _e(t,e,n){var i=t.stateNode;if(!i)throw Error(o(169));n?(t=ye(t,e,de),i.__reactInternalMemoizedMergedChildContext=t,se(he),se(ue),le(ue,t)):se(he),le(he,n)}var be=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(xe(t)/we|0)|0},xe=Math.log,we=Math.LN2;var Se=64,Me=4194304;function Te(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ae(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=Te(s):0!==(a&=o)&&(i=Te(a))}else 0!==(o=n&~r)?i=Te(o):0!==a&&(i=Te(a));if(0===i)return 0;if(0!==e&&e!==i&&0===(e&r)&&((r=i&-i)>=(a=e&-e)||16===r&&0!==(4194240&a)))return e;if(0!==(4&i)&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-be(e)),i|=t[n],e&=~r;return i}function Ee(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function Ce(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function Pe(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ie(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-be(e)]=n}function Le(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-be(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ke=0;function Re(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var De=r.unstable_scheduleCallback,Ne=r.unstable_cancelCallback,ze=r.unstable_shouldYield,Fe=r.unstable_requestPaint,Oe=r.unstable_now,Be=r.unstable_ImmediatePriority,Ue=r.unstable_UserBlockingPriority,je=r.unstable_NormalPriority,Ve=r.unstable_IdlePriority,He=null,Ge=null;var We="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e},qe=null,Ze=!1,Xe=!1;function Ye(t){null===qe?qe=[t]:qe.push(t)}function Ke(){if(!Xe&&null!==qe){Xe=!0;var t=0,e=ke;try{var n=qe;for(ke=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}qe=null,Ze=!1}catch(r){throw null!==qe&&(qe=qe.slice(t+1)),De(Be,Ke),r}finally{ke=e,Xe=!1}}return null}var Je=s.ReactCurrentBatchConfig;function $e(t,e){if(We(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!ie.call(e,r)||!We(t[r],e[r]))return!1}return!0}function Qe(t){switch(t.tag){case 5:return te(t.type);case 16:return te("Lazy");case 13:return te("Suspense");case 19:return te("SuspenseList");case 0:case 2:case 15:return t=ne(t.type,!1);case 11:return t=ne(t.type.render,!1);case 1:return t=ne(t.type,!0);default:return""}}function tn(t,e){if(t&&t.defaultProps){for(var n in e=a({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}var en=oe(null),nn=null,rn=null,an=null;function on(){an=rn=nn=null}function sn(t,e,n){Z?(le(en,e._currentValue),e._currentValue=n):(le(en,e._currentValue2),e._currentValue2=n)}function ln(t){var e=en.current;se(en),Z?t._currentValue=e:t._currentValue2=e}function cn(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function un(t,e){nn=t,an=rn=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(zr=!0),t.firstContext=null)}function hn(t){var e=Z?t._currentValue:t._currentValue2;if(an!==t)if(t={context:t,memoizedValue:e,next:null},null===rn){if(null===nn)throw Error(o(308));rn=t,nn.dependencies={lanes:0,firstContext:t}}else rn=rn.next=t;return e}var dn=null,pn=!1;function fn(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function yn(t,e){var n=t.updateQueue;null!==n&&(n=n.shared,null!==Xa&&0!==(1&t.mode)&&0===(2&Za)?(null===(t=n.interleaved)?(e.next=e,null===dn?dn=[n]:dn.push(n)):(e.next=t.next,t.next=e),n.interleaved=e):(null===(t=n.pending)?e.next=e:(e.next=t.next,t.next=e),n.pending=e))}function vn(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,Le(t,n)}}function _n(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=e:a=a.next=e}else r=a=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function bn(t,e,n,i){var r=t.updateQueue;pn=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var c=l,u=c.next;c.next=null,null===s?o=u:s.next=u,s=c;var h=t.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===l?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(null!==o){var d=r.baseState;for(s=0,h=u=c=null,l=o;;){var p=l.lane,f=l.eventTime;if((i&p)===p){null!==h&&(h=h.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});t:{var m=t,g=l;switch(p=e,f=n,g.tag){case 1:if("function"===typeof(m=g.payload)){d=m.call(f,d,p);break t}d=m;break t;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(p="function"===typeof(m=g.payload)?m.call(f,d,p):m)||void 0===p)break t;d=a({},d,p);break t;case 2:pn=!0}}null!==l.callback&&0!==l.lane&&(t.flags|=64,null===(p=r.effects)?r.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(u=h=f,c=d):h=h.next=f,s|=p;if(null===(l=l.next)){if(null===(l=r.shared.pending))break;l=(p=l).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}if(null===h&&(c=d),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=h,null!==(e=r.shared.interleaved)){r=e;do{s|=r.lane,r=r.next}while(r!==e)}else null===o&&(r.shared.lanes=0);eo|=s,t.lanes=s,t.memoizedState=d}}function xn(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var wn=(new i.Component).refs;function Sn(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:a({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var Mn={isMounted:function(t){return!!(t=t._reactInternals)&&T(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=xo(),r=wo(t),a=gn(i,r);a.payload=e,void 0!==n&&null!==n&&(a.callback=n),yn(t,a),null!==(e=So(t,r,i))&&vn(e,t,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=xo(),r=wo(t),a=gn(i,r);a.tag=1,a.payload=e,void 0!==n&&null!==n&&(a.callback=n),yn(t,a),null!==(e=So(t,r,i))&&vn(e,t,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=xo(),i=wo(t),r=gn(n,i);r.tag=2,void 0!==e&&null!==e&&(r.callback=e),yn(t,r),null!==(e=So(t,i,n))&&vn(e,t,i)}};function Tn(t,e,n,i,r,a,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,a,o):!e.prototype||!e.prototype.isPureReactComponent||(!$e(n,i)||!$e(r,a))}function An(t,e,n){var i=!1,r=ce,a=e.contextType;return"object"===typeof a&&null!==a?a=hn(a):(r=fe(e)?de:ue.current,a=(i=null!==(i=e.contextTypes)&&void 0!==i)?pe(t,r):ce),e=new e(n,a),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=Mn,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function En(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Mn.enqueueReplaceState(e,e.state,null)}function Cn(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=wn,fn(t);var a=e.contextType;"object"===typeof a&&null!==a?r.context=hn(a):(a=fe(e)?de:ue.current,r.context=pe(t,a)),r.state=t.memoizedState,"function"===typeof(a=e.getDerivedStateFromProps)&&(Sn(t,e,a,n),r.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(e=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&Mn.enqueueReplaceState(r,r.state,null),bn(t,n,r,i),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4194308)}var Pn=[],In=0,Ln=null,kn=0,Rn=[],Dn=0,Nn=null,zn=1,Fn="";function On(t,e){Pn[In++]=kn,Pn[In++]=Ln,Ln=t,kn=e}function Bn(t,e,n){Rn[Dn++]=zn,Rn[Dn++]=Fn,Rn[Dn++]=Nn,Nn=t;var i=zn;t=Fn;var r=32-be(i)-1;i&=~(1<<r),n+=1;var a=32-be(e)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,zn=1<<32-be(e)+r|n<<r|i,Fn=a+t}else zn=1<<a|n<<r|i,Fn=t}function Un(t){null!==t.return&&(On(t,1),Bn(t,1,0))}function jn(t){for(;t===Ln;)Ln=Pn[--In],Pn[In]=null,kn=Pn[--In],Pn[In]=null;for(;t===Nn;)Nn=Rn[--Dn],Rn[Dn]=null,Fn=Rn[--Dn],Rn[Dn]=null,zn=Rn[--Dn],Rn[Dn]=null}var Vn=null,Hn=null,Gn=!1,Wn=!1,qn=null;function Zn(t,e){var n=$o(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function Xn(t,e){switch(t.tag){case 5:return null!==(e=Rt(e,t.type,t.pendingProps))&&(t.stateNode=e,Vn=t,Hn=Ut(e),!0);case 6:return null!==(e=Dt(e,t.pendingProps))&&(t.stateNode=e,Vn=t,Hn=null,!0);case 13:if(null!==(e=Nt(e))){var n=null!==Nn?{id:zn,overflow:Fn}:null;return t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=$o(18,null,null,0)).stateNode=e,n.return=t,t.child=n,Vn=t,Hn=null,!0}return!1;default:return!1}}function Yn(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function Kn(t){if(Gn){var e=Hn;if(e){var n=e;if(!Xn(t,e)){if(Yn(t))throw Error(o(418));e=Bt(n);var i=Vn;e&&Xn(t,e)?Zn(i,n):(t.flags=-4097&t.flags|2,Gn=!1,Vn=t)}}else{if(Yn(t))throw Error(o(418));t.flags=-4097&t.flags|2,Gn=!1,Vn=t}}}function Jn(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Vn=t}function $n(t){if(!K||t!==Vn)return!1;if(!Gn)return Jn(t),Gn=!0,!1;if(3!==t.tag&&(5!==t.tag||Jt(t.type)&&!V(t.type,t.memoizedProps))){var e=Hn;if(e){if(Yn(t)){for(t=Hn;t;)t=Bt(t);throw Error(o(418))}for(;e;)Zn(t,e),e=Bt(e)}}if(Jn(t),13===t.tag){if(!K)throw Error(o(316));if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(o(317));Hn=qt(t)}else Hn=Vn?Bt(t.stateNode):null;return!0}function Qn(){K&&(Hn=Vn=null,Wn=Gn=!1)}function ti(t){null===qn?qn=[t]:qn.push(t)}function ei(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,t));var r=i,a=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===a?e.ref:(e=function(t){var e=r.refs;e===wn&&(e=r.refs={}),null===t?delete e[a]:e[a]=t},e._stringRef=a,e)}if("string"!==typeof t)throw Error(o(284));if(!n._owner)throw Error(o(290,t))}return t}function ni(t,e){throw t=Object.prototype.toString.call(e),Error(o(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ii(t){return(0,t._init)(t._payload)}function ri(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=ts(t,e)).index=0,t.sibling=null,t}function a(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function s(e){return t&&null===e.alternate&&(e.flags|=2),e}function h(t,e,n,i){return null===e||6!==e.tag?((e=rs(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n,i){var a=n.type;return a===u?f(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===_&&ii(a)===e.type)?((i=r(e,n.props)).ref=ei(t,e,n),i.return=t,i):((i=es(n.type,n.key,n.props,null,t.mode,i)).ref=ei(t,e,n),i.return=t,i)}function p(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=as(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function f(t,e,n,i,a){return null===e||7!==e.tag?((e=ns(n,t.mode,i,a)).return=t,e):((e=r(e,n)).return=t,e)}function m(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=rs(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case l:return(n=es(e.type,e.key,e.props,null,t.mode,n)).ref=ei(t,null,e),n.return=t,n;case c:return(e=as(e,t.mode,n)).return=t,e;case _:return m(t,(0,e._init)(e._payload),n)}if(k(e)||w(e))return(e=ns(e,t.mode,n,null)).return=t,e;ni(t,e)}return null}function g(t,e,n,i){var r=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:h(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===r?d(t,e,n,i):null;case c:return n.key===r?p(t,e,n,i):null;case _:return g(t,e,(r=n._init)(n._payload),i)}if(k(n)||w(n))return null!==r?null:f(t,e,n,i,null);ni(t,n)}return null}function y(t,e,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return h(e,t=t.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case l:return d(e,t=t.get(null===i.key?n:i.key)||null,i,r);case c:return p(e,t=t.get(null===i.key?n:i.key)||null,i,r);case _:return y(t,e,n,(0,i._init)(i._payload),r)}if(k(i)||w(i))return f(e,t=t.get(n)||null,i,r,null);ni(e,i)}return null}function v(r,o,s,l){for(var c=null,u=null,h=o,d=o=0,p=null;null!==h&&d<s.length;d++){h.index>d?(p=h,h=null):p=h.sibling;var f=g(r,h,s[d],l);if(null===f){null===h&&(h=p);break}t&&h&&null===f.alternate&&e(r,h),o=a(f,o,d),null===u?c=f:u.sibling=f,u=f,h=p}if(d===s.length)return n(r,h),Gn&&On(r,d),c;if(null===h){for(;d<s.length;d++)null!==(h=m(r,s[d],l))&&(o=a(h,o,d),null===u?c=h:u.sibling=h,u=h);return Gn&&On(r,d),c}for(h=i(r,h);d<s.length;d++)null!==(p=y(h,r,d,s[d],l))&&(t&&null!==p.alternate&&h.delete(null===p.key?d:p.key),o=a(p,o,d),null===u?c=p:u.sibling=p,u=p);return t&&h.forEach(function(t){return e(r,t)}),Gn&&On(r,d),c}function b(r,s,l,c){var u=w(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,d=s,p=s=0,f=null,v=l.next();null!==d&&!v.done;p++,v=l.next()){d.index>p?(f=d,d=null):f=d.sibling;var _=g(r,d,v.value,c);if(null===_){null===d&&(d=f);break}t&&d&&null===_.alternate&&e(r,d),s=a(_,s,p),null===h?u=_:h.sibling=_,h=_,d=f}if(v.done)return n(r,d),Gn&&On(r,p),u;if(null===d){for(;!v.done;p++,v=l.next())null!==(v=m(r,v.value,c))&&(s=a(v,s,p),null===h?u=v:h.sibling=v,h=v);return Gn&&On(r,p),u}for(d=i(r,d);!v.done;p++,v=l.next())null!==(v=y(d,r,p,v.value,c))&&(t&&null!==v.alternate&&d.delete(null===v.key?p:v.key),s=a(v,s,p),null===h?u=v:h.sibling=v,h=v);return t&&d.forEach(function(t){return e(r,t)}),Gn&&On(r,p),u}return function t(i,a,o,h){if("object"===typeof o&&null!==o&&o.type===u&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case l:t:{for(var d=o.key,p=a;null!==p;){if(p.key===d){if((d=o.type)===u){if(7===p.tag){n(i,p.sibling),(a=r(p,o.props.children)).return=i,i=a;break t}}else if(p.elementType===d||"object"===typeof d&&null!==d&&d.$$typeof===_&&ii(d)===p.type){n(i,p.sibling),(a=r(p,o.props)).ref=ei(i,p,o),a.return=i,i=a;break t}n(i,p);break}e(i,p),p=p.sibling}o.type===u?((a=ns(o.props.children,i.mode,h,o.key)).return=i,i=a):((h=es(o.type,o.key,o.props,null,i.mode,h)).ref=ei(i,a,o),h.return=i,i=h)}return s(i);case c:t:{for(p=o.key;null!==a;){if(a.key===p){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break t}n(i,a);break}e(i,a),a=a.sibling}(a=as(o,i.mode,h)).return=i,i=a}return s(i);case _:return t(i,a,(p=o._init)(o._payload),h)}if(k(o))return v(i,a,o,h);if(w(o))return b(i,a,o,h);ni(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=rs(o,i.mode,h)).return=i,i=a),s(i)):n(i,a)}}var ai=ri(!0),oi=ri(!1),si={},li=oe(si),ci=oe(si),ui=oe(si);function hi(t){if(t===si)throw Error(o(174));return t}function di(t,e){le(ui,e),le(ci,t),le(li,si),t=D(e),se(li),le(li,t)}function pi(){se(li),se(ci),se(ui)}function fi(t){var e=hi(ui.current),n=hi(li.current);n!==(e=N(n,t.type,e))&&(le(ci,t),le(li,e))}function mi(t){ci.current===t&&(se(li),se(ci))}var gi=oe(0);function yi(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||zt(n)||Ft(n)))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var vi=[];function _i(){for(var t=0;t<vi.length;t++){var e=vi[t];Z?e._workInProgressVersionPrimary=null:e._workInProgressVersionSecondary=null}vi.length=0}var bi=s.ReactCurrentDispatcher,xi=s.ReactCurrentBatchConfig,wi=0,Si=null,Mi=null,Ti=null,Ai=!1,Ei=!1,Ci=0,Pi=0;function Ii(){throw Error(o(321))}function Li(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!We(t[n],e[n]))return!1;return!0}function ki(t,e,n,i,r,a){if(wi=a,Si=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,bi.current=null===t||null===t.memoizedState?fr:mr,t=n(i,r),Ei){a=0;do{if(Ei=!1,Ci=0,25<=a)throw Error(o(301));a+=1,Ti=Mi=null,e.updateQueue=null,bi.current=gr,t=n(i,r)}while(Ei)}if(bi.current=pr,e=null!==Mi&&null!==Mi.next,wi=0,Ti=Mi=Si=null,Ai=!1,e)throw Error(o(300));return t}function Ri(){var t=0!==Ci;return Ci=0,t}function Di(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ti?Si.memoizedState=Ti=t:Ti=Ti.next=t,Ti}function Ni(){if(null===Mi){var t=Si.alternate;t=null!==t?t.memoizedState:null}else t=Mi.next;var e=null===Ti?Si.memoizedState:Ti.next;if(null!==e)Ti=e,Mi=t;else{if(null===t)throw Error(o(310));t={memoizedState:(Mi=t).memoizedState,baseState:Mi.baseState,baseQueue:Mi.baseQueue,queue:Mi.queue,next:null},null===Ti?Si.memoizedState=Ti=t:Ti=Ti.next=t}return Ti}function zi(t,e){return"function"===typeof e?e(t):e}function Fi(t){var e=Ni(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=Mi,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=s=null,c=null,u=a;do{var h=u.lane;if((wi&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,s=i):c=c.next=d,Si.lanes|=h,eo|=h}u=u.next}while(null!==u&&u!==a);null===c?s=i:c.next=l,We(i,e.memoizedState)||(zr=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=c,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{a=r.lane,Si.lanes|=a,eo|=a,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Oi(t){var e=Ni(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,a=e.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=t(a,s.action),s=s.next}while(s!==r);We(a,e.memoizedState)||(zr=!0),e.memoizedState=a,null===e.baseQueue&&(e.baseState=a),n.lastRenderedState=a}return[a,i]}function Bi(){}function Ui(t,e){var n=Si,i=Ni(),r=e(),a=!We(i.memoizedState,r);if(a&&(i.memoizedState=r,zr=!0),i=i.queue,Ji(Hi.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||null!==Ti&&1&Ti.memoizedState.tag){if(n.flags|=2048,qi(9,Vi.bind(null,n,i,r,e),void 0,null),null===Xa)throw Error(o(349));0!==(30&wi)||ji(n,e,r)}return r}function ji(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=Si.updateQueue)?(e={lastEffect:null,stores:null},Si.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Vi(t,e,n,i){e.value=n,e.getSnapshot=i,Gi(e)&&So(t,1,-1)}function Hi(t,e,n){return n(function(){Gi(e)&&So(t,1,-1)})}function Gi(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!We(t,n)}catch(i){return!0}}function Wi(t){var e=Di();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zi,lastRenderedState:t},e.queue=t,t=t.dispatch=lr.bind(null,Si,t),[e.memoizedState,t]}function qi(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=Si.updateQueue)?(e={lastEffect:null,stores:null},Si.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function Zi(){return Ni().memoizedState}function Xi(t,e,n,i){var r=Di();Si.flags|=t,r.memoizedState=qi(1|e,n,void 0,void 0===i?null:i)}function Yi(t,e,n,i){var r=Ni();i=void 0===i?null:i;var a=void 0;if(null!==Mi){var o=Mi.memoizedState;if(a=o.destroy,null!==i&&Li(i,o.deps))return void(r.memoizedState=qi(e,n,a,i))}Si.flags|=t,r.memoizedState=qi(1|e,n,a,i)}function Ki(t,e){return Xi(8390656,8,t,e)}function Ji(t,e){return Yi(2048,8,t,e)}function $i(t,e){return Yi(4,2,t,e)}function Qi(t,e){return Yi(4,4,t,e)}function tr(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function er(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Yi(4,4,tr.bind(null,e,t),n)}function nr(){}function ir(t,e){var n=Ni();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&Li(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function rr(t,e){var n=Ni();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&Li(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function ar(t,e){var n=ke;ke=0!==n&&4>n?n:4,t(!0);var i=xi.transition;xi.transition={};try{t(!1),e()}finally{ke=n,xi.transition=i}}function or(){return Ni().memoizedState}function sr(t,e,n){var i=wo(t);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},cr(t)?ur(e,n):(hr(t,e,n),null!==(t=So(t,i,n=xo()))&&dr(t,e,i))}function lr(t,e,n){var i=wo(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(cr(t))ur(e,r);else{hr(t,e,r);var a=t.alternate;if(0===t.lanes&&(null===a||0===a.lanes)&&null!==(a=e.lastRenderedReducer))try{var o=e.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,We(s,o))return}catch(l){}null!==(t=So(t,i,n=xo()))&&dr(t,e,i)}}function cr(t){var e=t.alternate;return t===Si||null!==e&&e===Si}function ur(t,e){Ei=Ai=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function hr(t,e,n){null!==Xa&&0!==(1&t.mode)&&0===(2&Za)?(null===(t=e.interleaved)?(n.next=n,null===dn?dn=[e]:dn.push(e)):(n.next=t.next,t.next=n),e.interleaved=n):(null===(t=e.pending)?n.next=n:(n.next=t.next,t.next=n),e.pending=n)}function dr(t,e,n){if(0!==(4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,Le(t,n)}}var pr={readContext:hn,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useInsertionEffect:Ii,useLayoutEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useMutableSource:Ii,useSyncExternalStore:Ii,useId:Ii,unstable_isNewReconciler:!1},fr={readContext:hn,useCallback:function(t,e){return Di().memoizedState=[t,void 0===e?null:e],t},useContext:hn,useEffect:Ki,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Xi(4194308,4,tr.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Xi(4194308,4,t,e)},useInsertionEffect:function(t,e){return Xi(4,2,t,e)},useMemo:function(t,e){var n=Di();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Di();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=sr.bind(null,Si,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},Di().memoizedState=t},useState:Wi,useDebugValue:nr,useDeferredValue:function(t){var e=Wi(t),n=e[0],i=e[1];return Ki(function(){var e=xi.transition;xi.transition={};try{i(t)}finally{xi.transition=e}},[t]),n},useTransition:function(){var t=Wi(!1),e=t[0];return t=ar.bind(null,t[1]),Di().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Si,r=Di();if(Gn){if(void 0===n)throw Error(o(407));n=n()}else{if(n=e(),null===Xa)throw Error(o(349));0!==(30&wi)||ji(i,e,n)}r.memoizedState=n;var a={value:n,getSnapshot:e};return r.queue=a,Ki(Hi.bind(null,i,a,t),[t]),i.flags|=2048,qi(9,Vi.bind(null,i,a,n,e),void 0,null),n},useId:function(){var t=Di(),e=Xa.identifierPrefix;if(Gn){var n=Fn;e=":"+e+"R"+(n=(zn&~(1<<32-be(zn)-1)).toString(32)+n),0<(n=Ci++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=Pi++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},mr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Ji,useImperativeHandle:er,useInsertionEffect:$i,useLayoutEffect:Qi,useMemo:rr,useReducer:Fi,useRef:Zi,useState:function(){return Fi(zi)},useDebugValue:nr,useDeferredValue:function(t){var e=Fi(zi),n=e[0],i=e[1];return Ji(function(){var e=xi.transition;xi.transition={};try{i(t)}finally{xi.transition=e}},[t]),n},useTransition:function(){return[Fi(zi)[0],Ni().memoizedState]},useMutableSource:Bi,useSyncExternalStore:Ui,useId:or,unstable_isNewReconciler:!1},gr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Ji,useImperativeHandle:er,useInsertionEffect:$i,useLayoutEffect:Qi,useMemo:rr,useReducer:Oi,useRef:Zi,useState:function(){return Oi(zi)},useDebugValue:nr,useDeferredValue:function(t){var e=Oi(zi),n=e[0],i=e[1];return Ji(function(){var e=xi.transition;xi.transition={};try{i(t)}finally{xi.transition=e}},[t]),n},useTransition:function(){return[Oi(zi)[0],Ni().memoizedState]},useMutableSource:Bi,useSyncExternalStore:Ui,useId:or,unstable_isNewReconciler:!1};function yr(t,e){try{var n="",i=e;do{n+=Qe(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:t,source:e,stack:r}}function vr(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var _r,br,xr,wr,Sr="function"===typeof WeakMap?WeakMap:Map;function Mr(t,e,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){uo||(uo=!0,ho=i),vr(0,e)},n}function Tr(t,e,n){(n=gn(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"===typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){vr(0,e)}}var a=t.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){vr(0,e),"function"!==typeof i&&(null===po?po=new Set([this]):po.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function Ar(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new Sr;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=qo.bind(null,t,e,n),e.then(t,t))}function Er(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function Cr(t,e,n,i,r){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=gn(-1,1)).tag=2,yn(n,e))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}function Pr(t){t.flags|=4}function Ir(t,e){if(null!==t&&t.child===e.child)return!0;if(0!==(16&e.flags))return!1;for(t=e.child;null!==t;){if(0!==(12854&t.flags)||0!==(12854&t.subtreeFlags))return!1;t=t.sibling}return!0}if(X)_r=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)B(t,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},br=function(){},xr=function(t,e,n,i,r){if((t=t.memoizedProps)!==i){var a=e.stateNode,o=hi(li.current);n=j(a,n,t,i,r,o),(e.updateQueue=n)&&Pr(e)}},wr=function(t,e,n,i){n!==i&&Pr(e)};else if(Y){_r=function(t,e,n,i){for(var r=e.child;null!==r;){if(5===r.tag){var a=r.stateNode;n&&i&&(a=Lt(a,r.type,r.memoizedProps,r)),B(t,a)}else if(6===r.tag)a=r.stateNode,n&&i&&(a=kt(a,r.memoizedProps,r)),B(t,a);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(a=r.child)&&(a.return=r),_r(t,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};var Lr=function(t,e,n,i){for(var r=e.child;null!==r;){if(5===r.tag){var a=r.stateNode;n&&i&&(a=Lt(a,r.type,r.memoizedProps,r)),Ct(t,a)}else if(6===r.tag)a=r.stateNode,n&&i&&(a=kt(a,r.memoizedProps,r)),Ct(t,a);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(a=r.child)&&(a.return=r),Lr(t,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};br=function(t,e){var n=e.stateNode;if(!Ir(t,e)){t=n.containerInfo;var i=Et(t);Lr(i,e,!1,!1),n.pendingChildren=i,Pr(e),Pt(t,i)}},xr=function(t,e,n,i,r){var a=t.stateNode,o=t.memoizedProps;if((t=Ir(t,e))&&o===i)e.stateNode=a;else{var s=e.stateNode,l=hi(li.current),c=null;o!==i&&(c=j(s,n,o,i,r,l)),t&&null===c?e.stateNode=a:(a=At(a,c,n,o,i,e,t,s),U(a,n,i,r,l)&&Pr(e),e.stateNode=a,t?Pr(e):_r(a,e,!1,!1))}},wr=function(t,e,n,i){n!==i?(t=hi(ui.current),n=hi(li.current),e.stateNode=H(i,t,n,e),Pr(e)):e.stateNode=t.stateNode}}else br=function(){},xr=function(){},wr=function(){};function kr(t,e){if(!Gn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Rr(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Dr(t,e,n){var i=e.pendingProps;switch(jn(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(e),null;case 1:case 17:return fe(e.type)&&me(),Rr(e),null;case 3:return i=e.stateNode,pi(),se(he),se(ue),_i(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||($n(e)?Pr(e):null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==qn&&(Co(qn),qn=null))),br(t,e),Rr(e),null;case 5:mi(e),n=hi(ui.current);var r=e.type;if(null!==t&&null!=e.stateNode)xr(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(o(166));return Rr(e),null}if(t=hi(li.current),$n(e)){if(!K)throw Error(o(175));t=Ht(e.stateNode,e.type,e.memoizedProps,n,t,e,!Wn),e.updateQueue=t,null!==t&&Pr(e)}else{var a=O(r,i,n,t,e);_r(a,e,!1,!1),e.stateNode=a,U(a,r,i,n,t)&&Pr(e)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Rr(e),null;case 6:if(t&&null!=e.stateNode)wr(t,e,t.memoizedProps,i);else{if("string"!==typeof i&&null===e.stateNode)throw Error(o(166));if(t=hi(ui.current),n=hi(li.current),$n(e)){if(!K)throw Error(o(176));if(t=e.stateNode,i=e.memoizedProps,(n=Gt(t,i,e,!Wn))&&null!==(r=Vn))switch(a=0!==(1&r.mode),r.tag){case 3:$t(r.stateNode.containerInfo,t,i,a);break;case 5:Qt(r.type,r.memoizedProps,r.stateNode,t,i,a)}n&&Pr(e)}else e.stateNode=H(i,t,n,e)}return Rr(e),null;case 13:if(se(gi),i=e.memoizedState,Gn&&null!==Hn&&0!==(1&e.mode)&&0===(128&e.flags)){for(t=Hn;t;)t=Bt(t);return Qn(),e.flags|=98560,e}if(null!==i&&null!==i.dehydrated){if(i=$n(e),null===t){if(!i)throw Error(o(318));if(!K)throw Error(o(344));if(!(t=null!==(t=e.memoizedState)?t.dehydrated:null))throw Error(o(317));Wt(t,e)}else Qn(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;return Rr(e),null}return null!==qn&&(Co(qn),qn=null),0!==(128&e.flags)?(e.lanes=n,e):(i=null!==i,n=!1,null===t?$n(e):n=null!==t.memoizedState,i&&!n&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&gi.current)?0===Qa&&(Qa=3):zo())),null!==e.updateQueue&&(e.flags|=4),Rr(e),null);case 4:return pi(),br(t,e),null===t&&$(e.stateNode.containerInfo),Rr(e),null;case 10:return ln(e.type._context),Rr(e),null;case 19:if(se(gi),null===(r=e.memoizedState))return Rr(e),null;if(i=0!==(128&e.flags),null===(a=r.rendering))if(i)kr(r,!1);else{if(0!==Qa||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(a=yi(t))){for(e.flags|=128,kr(r,!1),null!==(t=a.updateQueue)&&(e.updateQueue=t,e.flags|=4),e.subtreeFlags=0,t=n,i=e.child;null!==i;)r=t,(n=i).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,r=a.dependencies,n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),i=i.sibling;return le(gi,1&gi.current|2),e.child}t=t.sibling}null!==r.tail&&Oe()>so&&(e.flags|=128,i=!0,kr(r,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=yi(a))){if(e.flags|=128,i=!0,null!==(t=t.updateQueue)&&(e.updateQueue=t,e.flags|=4),kr(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!Gn)return Rr(e),null}else 2*Oe()-r.renderingStartTime>so&&1073741824!==n&&(e.flags|=128,i=!0,kr(r,!1),e.lanes=4194304);r.isBackwards?(a.sibling=e.child,e.child=a):(null!==(t=r.last)?t.sibling=a:e.child=a,r.last=a)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Oe(),e.sibling=null,t=gi.current,le(gi,i?1&t|2:1&t),e):(Rr(e),null);case 22:case 23:return ko(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&0!==(1&e.mode)?0!==(1073741824&Ja)&&(Rr(e),X&&6&e.subtreeFlags&&(e.flags|=8192)):Rr(e),null;case 24:case 25:return null}throw Error(o(156,e.tag))}var Nr=s.ReactCurrentOwner,zr=!1;function Fr(t,e,n,i){e.child=null===t?oi(e,null,n,i):ai(e,t.child,n,i)}function Or(t,e,n,i,r){n=n.render;var a=e.ref;return un(e,r),i=ki(t,e,n,i,a,r),n=Ri(),null===t||zr?(Gn&&n&&Un(e),e.flags|=1,Fr(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ra(t,e,r))}function Br(t,e,n,i,r){if(null===t){var a=n.type;return"function"!==typeof a||Qo(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=es(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=a,Ur(t,e,a,i,r))}if(a=t.child,0===(t.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:$e)(o,i)&&t.ref===e.ref)return ra(t,e,r)}return e.flags|=1,(t=ts(a,i)).ref=e.ref,t.return=e,e.child=t}function Ur(t,e,n,i,r){if(null!==t&&$e(t.memoizedProps,i)&&t.ref===e.ref){if(zr=!1,0===(t.lanes&r))return e.lanes=t.lanes,ra(t,e,r);0!==(131072&t.flags)&&(zr=!0)}return Hr(t,e,n,i,r)}function jr(t,e,n){var i=e.pendingProps,r=i.children,a=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null},le($a,Ja),Ja|=n;else{if(0===(1073741824&n))return t=null!==a?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null},e.updateQueue=null,le($a,Ja),Ja|=t,null;e.memoizedState={baseLanes:0,cachePool:null},i=null!==a?a.baseLanes:n,le($a,Ja),Ja|=i}else null!==a?(i=a.baseLanes|n,e.memoizedState=null):i=n,le($a,Ja),Ja|=i;return Fr(t,e,r,n),e.child}function Vr(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Hr(t,e,n,i,r){var a=fe(n)?de:ue.current;return a=pe(e,a),un(e,r),n=ki(t,e,n,i,a,r),i=Ri(),null===t||zr?(Gn&&i&&Un(e),e.flags|=1,Fr(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ra(t,e,r))}function Gr(t,e,n,i,r){if(fe(n)){var a=!0;ve(e)}else a=!1;if(un(e,r),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),An(e,n,i),Cn(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,s=e.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=hn(c):c=pe(e,c=fe(n)?de:ue.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==c)&&En(e,o,i,c),pn=!1;var d=e.memoizedState;o.state=d,bn(e,i,o,r),l=e.memoizedState,s!==i||d!==l||he.current||pn?("function"===typeof u&&(Sn(e,n,u,i),l=e.memoizedState),(s=pn||Tn(e,n,s,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4194308)):("function"===typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"===typeof o.componentDidMount&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,mn(t,e),s=e.memoizedProps,c=e.type===e.elementType?s:tn(e.type,s),o.props=c,h=e.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=hn(l):l=pe(e,l=fe(n)?de:ue.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&En(e,o,i,l),pn=!1,d=e.memoizedState,o.state=d,bn(e,i,o,r);var f=e.memoizedState;s!==h||d!==f||he.current||pn?("function"===typeof p&&(Sn(e,n,p,i),f=e.memoizedState),(c=pn||Tn(e,n,c,i,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Wr(t,e,n,i,a,r)}function Wr(t,e,n,i,r,a){Vr(t,e);var o=0!==(128&e.flags);if(!i&&!o)return r&&_e(e,n,!1),ra(t,e,a);i=e.stateNode,Nr.current=e;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=ai(e,t.child,null,a),e.child=ai(e,null,s,a)):Fr(t,e,s,a),e.memoizedState=i.state,r&&_e(e,n,!0),e.child}function qr(t){var e=t.stateNode;e.pendingContext?ge(0,e.pendingContext,e.pendingContext!==e.context):e.context&&ge(0,e.context,!1),di(t,e.containerInfo)}function Zr(t,e,n,i,r){return Qn(),ti(r),e.flags|=256,Fr(t,e,n,i),e.child}var Xr={dehydrated:null,treeContext:null,retryLane:0};function Yr(t){return{baseLanes:t,cachePool:null}}function Kr(t,e,n){var i,r=e.pendingProps,a=gi.current,s=!1,l=0!==(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&0!==(2&a)),i?(s=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(a|=1),le(gi,1&a),null===t)return Kn(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:Ft(t)?e.lanes=8:e.lanes=1073741824,null):(a=r.children,t=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=a):s=is(a,r,0,null),t=ns(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Yr(n),e.memoizedState=Xr,t):Jr(e,a));if(null!==(a=t.memoizedState)){if(null!==(i=a.dehydrated)){if(l)return 256&e.flags?(e.flags&=-257,ta(t,e,n,Error(o(422)))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(s=r.fallback,a=e.mode,r=is({mode:"visible",children:r.children},a,0,null),(s=ns(s,a,n,null)).flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,0!==(1&e.mode)&&ai(e,t.child,null,n),e.child.memoizedState=Yr(n),e.memoizedState=Xr,s);if(0===(1&e.mode))e=ta(t,e,n,null);else if(Ft(i))e=ta(t,e,n,Error(o(419)));else if(r=0!==(n&t.childLanes),zr||r){if(null!==(r=Xa)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(r=0!==(s&(r.suspendedLanes|n))?0:s)&&r!==a.retryLane&&(a.retryLane=r,So(t,r,-1))}zo(),e=ta(t,e,n,Error(o(421)))}else zt(i)?(e.flags|=128,e.child=t.child,e=Xo.bind(null,t),Ot(i,e),e=null):(n=a.treeContext,K&&(Hn=Vt(i),Vn=e,Gn=!0,qn=null,Wn=!1,null!==n&&(Rn[Dn++]=zn,Rn[Dn++]=Fn,Rn[Dn++]=Nn,zn=n.id,Fn=n.overflow,Nn=e)),(e=Jr(e,e.pendingProps.children)).flags|=4096);return e}return s?(r=Qr(t,e,r.children,r.fallback,n),s=e.child,a=t.child.memoizedState,s.memoizedState=null===a?Yr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=t.childLanes&~n,e.memoizedState=Xr,r):(n=$r(t,e,r.children,n),e.memoizedState=null,n)}return s?(r=Qr(t,e,r.children,r.fallback,n),s=e.child,a=t.child.memoizedState,s.memoizedState=null===a?Yr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=t.childLanes&~n,e.memoizedState=Xr,r):(n=$r(t,e,r.children,n),e.memoizedState=null,n)}function Jr(t,e){return(e=is({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function $r(t,e,n,i){var r=t.child;return t=r.sibling,n=ts(r,{mode:"visible",children:n}),0===(1&e.mode)&&(n.lanes=i),n.return=e,n.sibling=null,null!==t&&(null===(i=e.deletions)?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n}function Qr(t,e,n,i,r){var a=e.mode,o=(t=t.child).sibling,s={mode:"hidden",children:n};return 0===(1&a)&&e.child!==t?((n=e.child).childLanes=0,n.pendingProps=s,e.deletions=null):(n=ts(t,s)).subtreeFlags=14680064&t.subtreeFlags,null!==o?i=ts(o,i):(i=ns(i,a,r,null)).flags|=2,i.return=e,n.return=e,n.sibling=i,e.child=n,i}function ta(t,e,n,i){return null!==i&&ti(i),ai(e,t.child,null,n),(t=Jr(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function ea(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),cn(t.return,e,n)}function na(t,e,n,i,r){var a=t.memoizedState;null===a?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function ia(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(Fr(t,e,i.children,n),0!==(2&(i=gi.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&ea(t,n,e);else if(19===t.tag)ea(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(le(gi,i),0===(1&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===yi(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),na(e,!1,r,n,a);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===yi(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}na(e,!0,n,null,a);break;case"together":na(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ra(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),eo|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(o(153));if(null!==e.child){for(n=ts(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=ts(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function aa(t,e){switch(jn(e),e.tag){case 1:return fe(e.type)&&me(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return pi(),se(he),se(ue),_i(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return mi(e),null;case 13:if(se(gi),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(o(340));Qn()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return se(gi),null;case 4:return pi(),null;case 10:return ln(e.type._context),null;case 22:case 23:return ko(),null;default:return null}}var oa=!1,sa=!1,la="function"===typeof WeakSet?WeakSet:Set,ca=null;function ua(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Wo(t,e,i)}else n.current=null}function ha(t,e,n){try{n()}catch(i){Wo(t,e,i)}}var da=!1;function pa(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,void 0!==a&&ha(e,n,a)}r=r.next}while(r!==i)}}function fa(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function ma(t){var e=t.ref;if(null!==e){var n=t.stateNode;if(5===t.tag)t=R(n);else t=n;"function"===typeof e?e(t):e.current=t}}function ga(t,e,n){if(Ge&&"function"===typeof Ge.onCommitFiberUnmount)try{Ge.onCommitFiberUnmount(He,e)}catch(o){}switch(e.tag){case 0:case 11:case 14:case 15:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var i=t=t.next;do{var r=i,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&ha(e,n,a),i=i.next}while(i!==t)}break;case 1:if(ua(e,n),"function"===typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(o){Wo(e,n,o)}break;case 5:ua(e,n);break;case 4:X?Ma(t,e,n):Y&&Y&&(e=e.stateNode.containerInfo,n=Et(e),It(e,n))}}function ya(t,e,n){for(var i=e;;)if(ga(t,i,n),null===i.child||X&&4===i.tag){if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function va(t){var e=t.alternate;null!==e&&(t.alternate=null,va(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&tt(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _a(t){return 5===t.tag||3===t.tag||4===t.tag}function ba(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||_a(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function xa(t){if(X){t:{for(var e=t.return;null!==e;){if(_a(e))break t;e=e.return}throw Error(o(160))}var n=e;switch(n.tag){case 5:e=n.stateNode,32&n.flags&&(bt(e),n.flags&=-33),Sa(t,n=ba(t),e);break;case 3:case 4:e=n.stateNode.containerInfo,wa(t,n=ba(t),e);break;default:throw Error(o(161))}}}function wa(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?yt(n,t,e):dt(n,t);else if(4!==i&&null!==(t=t.child))for(wa(t,e,n),t=t.sibling;null!==t;)wa(t,e,n),t=t.sibling}function Sa(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?gt(n,t,e):ht(n,t);else if(4!==i&&null!==(t=t.child))for(Sa(t,e,n),t=t.sibling;null!==t;)Sa(t,e,n),t=t.sibling}function Ma(t,e,n){for(var i,r,a=e,s=!1;;){if(!s){s=a.return;t:for(;;){if(null===s)throw Error(o(160));switch(i=s.stateNode,s.tag){case 5:r=!1;break t;case 3:case 4:i=i.containerInfo,r=!0;break t}s=s.return}s=!0}if(5===a.tag||6===a.tag)ya(t,a,n),r?_t(i,a.stateNode):vt(i,a.stateNode);else if(18===a.tag)r?Kt(i,a.stateNode):Yt(i,a.stateNode);else if(4===a.tag){if(null!==a.child){i=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(ga(t,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===e)break;for(;null===a.sibling;){if(null===a.return||a.return===e)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function Ta(t,e){if(X){switch(e.tag){case 0:case 11:case 14:case 15:return pa(3,e,e.return),fa(3,e),void pa(5,e,e.return);case 1:case 12:case 17:return;case 5:var n=e.stateNode;if(null!=n){var i=e.memoizedProps;t=null!==t?t.memoizedProps:i;var r=e.type,a=e.updateQueue;e.updateQueue=null,null!==a&&mt(n,a,r,t,i,e)}return;case 6:if(null===e.stateNode)throw Error(o(162));return n=e.memoizedProps,void pt(e.stateNode,null!==t?t.memoizedProps:n,n);case 3:return void(K&&null!==t&&t.memoizedState.isDehydrated&&Zt(e.stateNode.containerInfo));case 13:case 19:return void Aa(e)}throw Error(o(163))}switch(e.tag){case 0:case 11:case 14:case 15:return pa(3,e,e.return),fa(3,e),void pa(5,e,e.return);case 12:case 22:case 23:return;case 13:case 19:return void Aa(e);case 3:K&&null!==t&&t.memoizedState.isDehydrated&&Zt(e.stateNode.containerInfo)}t:if(Y){switch(e.tag){case 1:case 5:case 6:break t;case 3:case 4:e=e.stateNode,It(e.containerInfo,e.pendingChildren);break t}throw Error(o(163))}}function Aa(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new la),e.forEach(function(e){var i=Yo.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))})}}function Ea(t,e,n){ca=t,Ca(t,e,n)}function Ca(t,e,n){for(var i=0!==(1&t.mode);null!==ca;){var r=ca,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||oa;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||sa;s=oa;var c=sa;if(oa=o,(sa=l)&&!c)for(ca=r;null!==ca;)l=(o=ca).child,22===o.tag&&null!==o.memoizedState?La(r):null!==l?(l.return=o,ca=l):La(r);for(;null!==a;)ca=a,Ca(a,e,n),a=a.sibling;ca=r,oa=s,sa=c}Pa(t)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,ca=a):Pa(t)}}function Pa(t){for(;null!==ca;){var e=ca;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:sa||fa(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!sa)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:tn(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;null!==a&&xn(e,a,i);break;case 3:var s=e.updateQueue;if(null!==s){if(n=null,null!==e.child)switch(e.child.tag){case 5:n=R(e.child.stateNode);break;case 1:n=e.child.stateNode}xn(e,s,n)}break;case 5:var l=e.stateNode;null===n&&4&e.flags&&ft(l,e.type,e.memoizedProps,e);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(K&&null===e.memoizedState){var c=e.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Xt(h)}}}break;default:throw Error(o(163))}sa||512&e.flags&&ma(e)}catch(d){Wo(e,e.return,d)}}if(e===t){ca=null;break}if(null!==(n=e.sibling)){n.return=e.return,ca=n;break}ca=e.return}}function Ia(t){for(;null!==ca;){var e=ca;if(e===t){ca=null;break}var n=e.sibling;if(null!==n){n.return=e.return,ca=n;break}ca=e.return}}function La(t){for(;null!==ca;){var e=ca;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fa(4,e)}catch(l){Wo(e,n,l)}break;case 1:var i=e.stateNode;if("function"===typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(l){Wo(e,r,l)}}var a=e.return;try{ma(e)}catch(l){Wo(e,a,l)}break;case 5:var o=e.return;try{ma(e)}catch(l){Wo(e,o,l)}}}catch(l){Wo(e,e.return,l)}if(e===t){ca=null;break}var s=e.sibling;if(null!==s){s.return=e.return,ca=s;break}ca=e.return}}var ka=0,Ra=1,Da=2,Na=3,za=4;if("function"===typeof Symbol&&Symbol.for){var Fa=Symbol.for;ka=Fa("selector.component"),Ra=Fa("selector.has_pseudo_class"),Da=Fa("selector.role"),Na=Fa("selector.test_id"),za=Fa("selector.text")}function Oa(t){var e=J(t);if(null!=e){if("string"!==typeof e.memoizedProps["data-testname"])throw Error(o(364));return e}if(null===(t=rt(t)))throw Error(o(362));return t.stateNode.current}function Ba(t,e){switch(e.$$typeof){case ka:if(t.type===e.value)return!0;break;case Ra:t:{e=e.value,t=[t,0];for(var n=0;n<t.length;){var i=t[n++],r=t[n++],a=e[r];if(5!==i.tag||!st(i)){for(;null!=a&&Ba(i,a);)a=e[++r];if(r===e.length){e=!0;break t}for(i=i.child;null!==i;)t.push(i,r),i=i.sibling}}e=!1}return e;case Da:if(5===t.tag&&lt(t.stateNode,e.value))return!0;break;case za:if((5===t.tag||6===t.tag)&&(null!==(t=ot(t))&&0<=t.indexOf(e.value)))return!0;break;case Na:if(5===t.tag&&("string"===typeof(t=t.memoizedProps["data-testname"])&&t.toLowerCase()===e.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Ua(t){switch(t.$$typeof){case ka:return"<"+(S(t.value)||"Unknown")+">";case Ra:return":has("+(Ua(t)||"")+")";case Da:return'[role="'+t.value+'"]';case za:return'"'+t.value+'"';case Na:return'[data-testname="'+t.value+'"]';default:throw Error(o(365))}}function ja(t,e){var n=[];t=[t,0];for(var i=0;i<t.length;){var r=t[i++],a=t[i++],o=e[a];if(5!==r.tag||!st(r)){for(;null!=o&&Ba(r,o);)o=e[++a];if(a===e.length)n.push(r);else for(r=r.child;null!==r;)t.push(r,a),r=r.sibling}}return n}function Va(t,e){if(!it)throw Error(o(363));t=ja(t=Oa(t),e),e=[],t=Array.from(t);for(var n=0;n<t.length;){var i=t[n++];if(5===i.tag)st(i)||e.push(i.stateNode);else for(i=i.child;null!==i;)t.push(i),i=i.sibling}return e}var Ha=Math.ceil,Ga=s.ReactCurrentDispatcher,Wa=s.ReactCurrentOwner,qa=s.ReactCurrentBatchConfig,Za=0,Xa=null,Ya=null,Ka=0,Ja=0,$a=oe(0),Qa=0,to=null,eo=0,no=0,io=0,ro=null,ao=null,oo=0,so=1/0;function lo(){so=Oe()+500}var co,uo=!1,ho=null,po=null,fo=!1,mo=null,go=0,yo=0,vo=null,_o=-1,bo=0;function xo(){return 0!==(6&Za)?Oe():-1!==_o?_o:_o=Oe()}function wo(t){return 0===(1&t.mode)?1:0!==(2&Za)&&0!==Ka?Ka&-Ka:null!==Je.transition?(0===bo&&(t=Se,0===(4194240&(Se<<=1))&&(Se=64),bo=t),bo):0!==(t=ke)?t:Q()}function So(t,e,n){if(50<yo)throw yo=0,vo=null,Error(o(185));var i=Mo(t,e);return null===i?null:(Ie(i,e,n),0!==(2&Za)&&i===Xa||(i===Xa&&(0===(2&Za)&&(no|=e),4===Qa&&Po(i,Ka)),To(i,n),1===e&&0===Za&&0===(1&t.mode)&&(lo(),Ze&&Ke())),i)}function Mo(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}function To(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-be(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=Ee(s,e)):l<=e&&(t.expiredLanes|=s),a&=~s}}(t,e);var i=Ae(t,t===Xa?Ka:0);if(0===i)null!==n&&Ne(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&Ne(n),1===e)0===t.tag?function(t){Ze=!0,Ye(t)}(Io.bind(null,t)):Ye(Io.bind(null,t)),et?nt(function(){0===Za&&Ke()}):De(Be,Ke),n=null;else{switch(Re(i)){case 1:n=Be;break;case 4:n=Ue;break;case 16:default:n=je;break;case 536870912:n=Ve}n=Ko(n,Ao.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Ao(t,e){if(_o=-1,bo=0,0!==(6&Za))throw Error(o(327));var n=t.callbackNode;if(Ho()&&t.callbackNode!==n)return null;var i=Ae(t,t===Xa?Ka:0);if(0===i)return null;if(0!==(30&i)||0!==(i&t.expiredLanes)||e)e=Fo(t,i);else{e=i;var r=Za;Za|=2;var a=No();for(Xa===t&&Ka===e||(lo(),Ro(t,e));;)try{Bo();break}catch(l){Do(t,l)}on(),Ga.current=a,Za=r,null!==Ya?e=0:(Xa=null,Ka=0,e=Qa)}if(0!==e){if(2===e&&(0!==(r=Ce(t))&&(i=r,e=Eo(t,r))),1===e)throw n=to,Ro(t,0),Po(t,i),To(t,Oe()),n;if(6===e)Po(t,i);else{if(r=t.current.alternate,0===(30&i)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!We(a(),r))return!1}catch(s){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)&&(2===(e=Fo(t,i))&&(0!==(a=Ce(t))&&(i=a,e=Eo(t,a))),1===e))throw n=to,Ro(t,0),Po(t,i),To(t,Oe()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(o(345));case 2:case 5:Vo(t,ao);break;case 3:if(Po(t,i),(130023424&i)===i&&10<(e=oo+500-Oe())){if(0!==Ae(t,0))break;if(((r=t.suspendedLanes)&i)!==i){xo(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=G(Vo.bind(null,t,ao),e);break}Vo(t,ao);break;case 4:if(Po(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var s=31-be(i);a=1<<s,(s=e[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Oe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ha(i/1960))-i)){t.timeoutHandle=G(Vo.bind(null,t,ao),i);break}Vo(t,ao);break;default:throw Error(o(329))}}}return To(t,Oe()),t.callbackNode===n?Ao.bind(null,t):null}function Eo(t,e){var n=ro;return t.current.memoizedState.isDehydrated&&(Ro(t,e).flags|=256),2!==(t=Fo(t,e))&&(e=ao,ao=n,null!==e&&Co(e)),t}function Co(t){null===ao?ao=t:ao.push.apply(ao,t)}function Po(t,e){for(e&=~io,e&=~no,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-be(e),i=1<<n;t[n]=-1,e&=~i}}function Io(t){if(0!==(6&Za))throw Error(o(327));Ho();var e=Ae(t,0);if(0===(1&e))return To(t,Oe()),null;var n=Fo(t,e);if(0!==t.tag&&2===n){var i=Ce(t);0!==i&&(e=i,n=Eo(t,i))}if(1===n)throw n=to,Ro(t,0),Po(t,e),To(t,Oe()),n;if(6===n)throw Error(o(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Vo(t,ao),To(t,Oe()),null}function Lo(t){null!==mo&&0===mo.tag&&0===(6&Za)&&Ho();var e=Za;Za|=1;var n=qa.transition,i=ke;try{if(qa.transition=null,ke=1,t)return t()}finally{ke=i,qa.transition=n,0===(6&(Za=e))&&Ke()}}function ko(){Ja=$a.current,se($a)}function Ro(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==q&&(t.timeoutHandle=q,W(n)),null!==Ya)for(n=Ya.return;null!==n;){var i=n;switch(jn(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&me();break;case 3:pi(),se(he),se(ue),_i();break;case 5:mi(i);break;case 4:pi();break;case 13:case 19:se(gi);break;case 10:ln(i.type._context);break;case 22:case 23:ko()}n=n.return}if(Xa=t,Ya=t=ts(t.current,null),Ka=Ja=e,Qa=0,to=null,io=no=eo=0,ao=ro=null,null!==dn){for(e=0;e<dn.length;e++)if(null!==(i=(n=dn[e]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}dn=null}return t}function Do(t,e){for(;;){var n=Ya;try{if(on(),bi.current=pr,Ai){for(var i=Si.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Ai=!1}if(wi=0,Ti=Mi=Si=null,Ei=!1,Ci=0,Wa.current=null,null===n||null===n.return){Qa=1,to=e,Ya=null;break}t:{var a=t,s=n.return,l=n,c=e;if(e=Ka,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=Er(s);if(null!==f){f.flags&=-257,Cr(f,s,l,0,e),1&f.mode&&Ar(a,u,e),c=u;var m=(e=f).updateQueue;if(null===m){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break t}if(0===(1&e)){Ar(a,u,e),zo();break t}c=Error(o(426))}else if(Gn&&1&l.mode){var y=Er(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),Cr(y,s,l,0,e),ti(c);break t}}a=c,4!==Qa&&(Qa=2),null===ro?ro=[a]:ro.push(a),c=yr(c,l),l=s;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e,_n(l,Mr(0,c,e));break t;case 1:a=c;var v=l.type,_=l.stateNode;if(0===(128&l.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===po||!po.has(_)))){l.flags|=65536,e&=-e,l.lanes|=e,_n(l,Tr(l,a,e));break t}}l=l.return}while(null!==l)}jo(n)}catch(b){e=b,Ya===n&&null!==n&&(Ya=n=n.return);continue}break}}function No(){var t=Ga.current;return Ga.current=pr,null===t?pr:t}function zo(){0!==Qa&&3!==Qa&&2!==Qa||(Qa=4),null===Xa||0===(268435455&eo)&&0===(268435455&no)||Po(Xa,Ka)}function Fo(t,e){var n=Za;Za|=2;var i=No();for(Xa===t&&Ka===e||Ro(t,e);;)try{Oo();break}catch(r){Do(t,r)}if(on(),Za=n,Ga.current=i,null!==Ya)throw Error(o(261));return Xa=null,Ka=0,Qa}function Oo(){for(;null!==Ya;)Uo(Ya)}function Bo(){for(;null!==Ya&&!ze();)Uo(Ya)}function Uo(t){var e=co(t.alternate,t,Ja);t.memoizedProps=t.pendingProps,null===e?jo(t):Ya=e,Wa.current=null}function jo(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=Dr(n,e,Ja)))return void(Ya=n)}else{if(null!==(n=aa(n,e)))return n.flags&=32767,void(Ya=n);if(null===t)return Qa=6,void(Ya=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Ya=e);Ya=e=t}while(null!==e);0===Qa&&(Qa=5)}function Vo(t,e){var n=ke,i=qa.transition;try{qa.transition=null,ke=1,function(t,e,n){do{Ho()}while(null!==mo);if(0!==(6&Za))throw Error(o(327));var i=t.finishedWork,r=t.finishedLanes;if(null===i)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(o(177));t.callbackNode=null,t.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-be(n),a=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~a}}(t,a),t===Xa&&(Ya=Xa=null,Ka=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||fo||(fo=!0,Ko(je,function(){return Ho(),null})),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=qa.transition,qa.transition=null;var s=ke;ke=1;var l=Za;Za|=4,Wa.current=null,function(t,e){for(z(t.containerInfo),ca=e;null!==ca;)if(e=(t=ca).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,ca=e;else for(;null!==ca;){t=ca;try{var n=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var i=n.memoizedProps,r=n.memoizedState,a=t.stateNode,s=a.getSnapshotBeforeUpdate(t.elementType===t.type?i:tn(t.type,i),r);a.__reactInternalSnapshotBeforeUpdate=s}break;case 3:X&&Tt(t.stateNode.containerInfo);break;default:throw Error(o(163))}}catch(l){Wo(t,t.return,l)}if(null!==(e=t.sibling)){e.return=t.return,ca=e;break}ca=t.return}n=da,da=!1}(t,i),function(t,e){for(ca=e;null!==ca;){var n=(e=ca).deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=t;X?Ma(a,r,e):ya(a,r,e);var o=r.alternate;null!==o&&(o.return=null),r.return=null}catch(x){Wo(r,e,x)}}if(n=e.child,0!==(12854&e.subtreeFlags)&&null!==n)n.return=e,ca=n;else for(;null!==ca;){e=ca;try{var s=e.flags;if(32&s&&X&&bt(e.stateNode),512&s){var l=e.alternate;if(null!==l){var c=l.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&s)switch(e.tag){case 13:if(null!==e.memoizedState){var u=e.alternate;null!==u&&null!==u.memoizedState||(oo=Oe())}break;case 22:var h=null!==e.memoizedState,d=e.alternate,p=null!==d&&null!==d.memoizedState;if(n=e,X)t:if(i=n,r=h,a=null,X)for(var f=i;;){if(5===f.tag){if(null===a){a=f;var m=f.stateNode;r?xt(m):St(f.stateNode,f.memoizedProps)}}else if(6===f.tag){if(null===a){var g=f.stateNode;r?wt(g):Mt(g,f.memoizedProps)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===i)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===i)break;for(;null===f.sibling;){if(null===f.return||f.return===i)break t;a===f&&(a=null),f=f.return}a===f&&(a=null),f.sibling.return=f.return,f=f.sibling}if(h&&!p&&0!==(1&n.mode)){ca=n;for(var y=n.child;null!==y;){for(n=ca=y;null!==ca;){var v=(i=ca).child;switch(i.tag){case 0:case 11:case 14:case 15:pa(4,i,i.return);break;case 1:ua(i,i.return);var _=i.stateNode;if("function"===typeof _.componentWillUnmount){var b=i.return;try{_.props=i.memoizedProps,_.state=i.memoizedState,_.componentWillUnmount()}catch(x){Wo(i,b,x)}}break;case 5:ua(i,i.return);break;case 22:if(null!==i.memoizedState){Ia(n);continue}}null!==v?(v.return=i,ca=v):Ia(n)}y=y.sibling}}}switch(4102&s){case 2:xa(e),e.flags&=-3;break;case 6:xa(e),e.flags&=-3,Ta(e.alternate,e);break;case 4096:e.flags&=-4097;break;case 4100:e.flags&=-4097,Ta(e.alternate,e);break;case 4:Ta(e.alternate,e)}}catch(x){Wo(e,e.return,x)}if(null!==(n=e.sibling)){n.return=e.return,ca=n;break}ca=e.return}}}(t,i),F(t.containerInfo),t.current=i,Ea(i,t,r),Fe(),Za=l,ke=s,qa.transition=a}else t.current=i;if(fo&&(fo=!1,mo=t,go=r),a=t.pendingLanes,0===a&&(po=null),function(t){if(Ge&&"function"===typeof Ge.onCommitFiberRoot)try{Ge.onCommitFiberRoot(He,t,void 0,128===(128&t.current.flags))}catch(e){}}(i.stateNode),To(t,Oe()),null!==e)for(n=t.onRecoverableError,i=0;i<e.length;i++)n(e[i]);if(uo)throw uo=!1,t=ho,ho=null,t;0!==(1&go)&&0!==t.tag&&Ho(),a=t.pendingLanes,0!==(1&a)?t===vo?yo++:(yo=0,vo=t):yo=0,Ke()}(t,e,n)}finally{qa.transition=i,ke=n}return null}function Ho(){if(null!==mo){var t=Re(go),e=qa.transition,n=ke;try{if(qa.transition=null,ke=16>t?16:t,null===mo)var i=!1;else{if(t=mo,mo=null,go=0,0!==(6&Za))throw Error(o(331));var r=Za;for(Za|=4,ca=t.current;null!==ca;){var a=ca,s=a.child;if(0!==(16&ca.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(ca=u;null!==ca;){var h=ca;switch(h.tag){case 0:case 11:case 15:pa(8,h,a)}var d=h.child;if(null!==d)d.return=h,ca=d;else for(;null!==ca;){var p=(h=ca).sibling,f=h.return;if(va(h),h===u){ca=null;break}if(null!==p){p.return=f,ca=p;break}ca=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}ca=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,ca=s;else t:for(;null!==ca;){if(0!==(2048&(a=ca).flags))switch(a.tag){case 0:case 11:case 15:pa(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,ca=v;break t}ca=a.return}}var _=t.current;for(ca=_;null!==ca;){var b=(s=ca).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,ca=b;else t:for(s=_;null!==ca;){if(0!==(2048&(l=ca).flags))try{switch(l.tag){case 0:case 11:case 15:fa(9,l)}}catch(w){Wo(l,l.return,w)}if(l===s){ca=null;break t}var x=l.sibling;if(null!==x){x.return=l.return,ca=x;break t}ca=l.return}}if(Za=r,Ke(),Ge&&"function"===typeof Ge.onPostCommitFiberRoot)try{Ge.onPostCommitFiberRoot(He,t)}catch(w){}i=!0}return i}finally{ke=n,qa.transition=e}}return!1}function Go(t,e,n){yn(t,e=Mr(0,e=yr(n,e),1)),e=xo(),null!==(t=Mo(t,1))&&(Ie(t,1,e),To(t,e))}function Wo(t,e,n){if(3===t.tag)Go(t,t,n);else for(;null!==e;){if(3===e.tag){Go(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===po||!po.has(i))){yn(e,t=Tr(e,t=yr(n,t),1)),t=xo(),null!==(e=Mo(e,1))&&(Ie(e,1,t),To(e,t));break}}e=e.return}}function qo(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=xo(),t.pingedLanes|=t.suspendedLanes&n,Xa===t&&(Ka&n)===n&&(4===Qa||3===Qa&&(130023424&Ka)===Ka&&500>Oe()-oo?Ro(t,0):io|=n),To(t,e)}function Zo(t,e){0===e&&(0===(1&t.mode)?e=1:(e=Me,0===(130023424&(Me<<=1))&&(Me=4194304)));var n=xo();null!==(t=Mo(t,e))&&(Ie(t,e,n),To(t,n))}function Xo(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Zo(t,n)}function Yo(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(e),Zo(t,n)}function Ko(t,e){return De(t,e)}function Jo(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $o(t,e,n,i){return new Jo(t,e,n,i)}function Qo(t){return!(!(t=t.prototype)||!t.isReactComponent)}function ts(t,e){var n=t.alternate;return null===n?((n=$o(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function es(t,e,n,i,r,a){var s=2;if(i=t,"function"===typeof t)Qo(t)&&(s=1);else if("string"===typeof t)s=5;else t:switch(t){case u:return ns(n.children,r,a,e);case h:s=8,r|=8;break;case d:return(t=$o(12,n,e,2|r)).elementType=d,t.lanes=a,t;case g:return(t=$o(13,n,e,r)).elementType=g,t.lanes=a,t;case y:return(t=$o(19,n,e,r)).elementType=y,t.lanes=a,t;case b:return is(n,r,a,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case p:s=10;break t;case f:s=9;break t;case m:s=11;break t;case v:s=14;break t;case _:s=16,i=null;break t}throw Error(o(130,null==t?t:typeof t,""))}return(e=$o(s,n,e,r)).elementType=t,e.type=i,e.lanes=a,e}function ns(t,e,n,i){return(t=$o(7,t,i,e)).lanes=n,t}function is(t,e,n,i){return(t=$o(22,t,i,e)).elementType=b,t.lanes=n,t.stateNode={},t}function rs(t,e,n){return(t=$o(6,t,null,e)).lanes=n,t}function as(t,e,n){return(e=$o(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function os(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=q,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pe(0),this.expirationTimes=Pe(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pe(0),this.identifierPrefix=i,this.onRecoverableError=r,K&&(this.mutableSourceEagerHydrationData=null)}function ss(t,e,n,i,r,a,o,s,l){return t=new os(t,e,n,s,l),1===e?(e=1,!0===a&&(e|=8)):e=0,a=$o(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null},fn(a),t}function ls(t){if(!t)return ce;t:{if(T(t=t._reactInternals)!==t||1!==t.tag)throw Error(o(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(fe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(o(171))}if(1===t.tag){var n=t.type;if(fe(n))return ye(t,n,e)}return e}function cs(t){var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(o(188));throw t=Object.keys(t).join(","),Error(o(268,t))}return null===(t=C(e))?null:t.stateNode}function us(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function hs(t,e){us(t,e),(t=t.alternate)&&us(t,e)}function ds(t){return null===(t=C(t))?null:t.stateNode}function ps(){return null}return co=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||he.current)zr=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return zr=!1,function(t,e,n){switch(e.tag){case 3:qr(e),Qn();break;case 5:fi(e);break;case 1:fe(e.type)&&ve(e);break;case 4:di(e,e.stateNode.containerInfo);break;case 10:sn(0,e.type._context,e.memoizedProps.value);break;case 13:var i=e.memoizedState;if(null!==i)return null!==i.dehydrated?(le(gi,1&gi.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Kr(t,e,n):(le(gi,1&gi.current),null!==(t=ra(t,e,n))?t.sibling:null);le(gi,1&gi.current);break;case 19:if(i=0!==(n&e.childLanes),0!==(128&t.flags)){if(i)return ia(t,e,n);e.flags|=128}var r=e.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),le(gi,gi.current),i)break;return null;case 22:case 23:return e.lanes=0,jr(t,e,n)}return ra(t,e,n)}(t,e,n);zr=0!==(131072&t.flags)}else zr=!1,Gn&&0!==(1048576&e.flags)&&Bn(e,kn,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps;var r=pe(e,ue.current);un(e,n),r=ki(null,e,i,t,r,n);var a=Ri();return e.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,fe(i)?(a=!0,ve(e)):a=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,fn(e),r.updater=Mn,e.stateNode=r,r._reactInternals=e,Cn(e,i,t,n),e=Wr(null,e,i,!0,a,n)):(e.tag=0,Gn&&a&&Un(e),Fr(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"===typeof t)return Qo(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===m)return 11;if(t===v)return 14}return 2}(i),t=tn(i,t),r){case 0:e=Hr(null,e,i,t,n);break t;case 1:e=Gr(null,e,i,t,n);break t;case 11:e=Or(null,e,i,t,n);break t;case 14:e=Br(null,e,i,tn(i.type,t),n);break t}throw Error(o(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,Hr(t,e,i,r=e.elementType===i?r:tn(i,r),n);case 1:return i=e.type,r=e.pendingProps,Gr(t,e,i,r=e.elementType===i?r:tn(i,r),n);case 3:t:{if(qr(e),null===t)throw Error(o(387));i=e.pendingProps,r=(a=e.memoizedState).element,mn(t,e),bn(e,i,null,n);var s=e.memoizedState;if(i=s.element,K&&a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,transitions:s.transitions},e.updateQueue.baseState=a,e.memoizedState=a,256&e.flags){e=Zr(t,e,i,n,r=Error(o(423)));break t}if(i!==r){e=Zr(t,e,i,n,r=Error(o(424)));break t}for(K&&(Hn=jt(e.stateNode.containerInfo),Vn=e,Gn=!0,qn=null,Wn=!1),n=oi(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Qn(),i===r){e=ra(t,e,n);break t}Fr(t,e,i,n)}e=e.child}return e;case 5:return fi(e),null===t&&Kn(e),i=e.type,r=e.pendingProps,a=null!==t?t.memoizedProps:null,s=r.children,V(i,r)?s=null:null!==a&&V(i,a)&&(e.flags|=32),Vr(t,e),Fr(t,e,s,n),e.child;case 6:return null===t&&Kn(e),null;case 13:return Kr(t,e,n);case 4:return di(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=ai(e,null,i,n):Fr(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,Or(t,e,i,r=e.elementType===i?r:tn(i,r),n);case 7:return Fr(t,e,e.pendingProps,n),e.child;case 8:case 12:return Fr(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,a=e.memoizedProps,sn(0,i,s=r.value),null!==a)if(We(a.value,s)){if(a.children===r.children&&!he.current){e=ra(t,e,n);break t}}else for(null!==(a=e.child)&&(a.return=e);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=gn(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),cn(a.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===e.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),cn(s,n,e),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===e){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}Fr(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,un(e,n),i=i(r=hn(r)),e.flags|=1,Fr(t,e,i,n),e.child;case 14:return r=tn(i=e.type,e.pendingProps),Br(t,e,i,r=tn(i.type,r),n);case 15:return Ur(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:tn(i,r),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,fe(i)?(t=!0,ve(e)):t=!1,un(e,n),An(e,i,r),Cn(e,i,r,n),Wr(null,e,i,!0,t,n);case 19:return ia(t,e,n);case 22:return jr(t,e,n)}throw Error(o(156,e.tag))},e.attemptContinuousHydration=function(t){13===t.tag&&(So(t,134217728,xo()),hs(t,134217728))},e.attemptHydrationAtCurrentPriority=function(t){if(13===t.tag){var e=xo(),n=wo(t);So(t,n,e),hs(t,n)}},e.attemptSynchronousHydration=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Te(e.pendingLanes);0!==n&&(Le(e,1|n),To(e,Oe()),0===(6&Za)&&(lo(),Ke()))}break;case 13:var i=xo();Lo(function(){return So(t,1,i)}),hs(t,1)}},e.batchedUpdates=function(t,e){var n=Za;Za|=1;try{return t(e)}finally{0===(Za=n)&&(lo(),Ze&&Ke())}},e.createComponentSelector=function(t){return{$$typeof:ka,value:t}},e.createContainer=function(t,e,n,i,r,a,o){return ss(t,e,!1,null,0,i,0,a,o)},e.createHasPseudoClassSelector=function(t){return{$$typeof:Ra,value:t}},e.createHydrationContainer=function(t,e,n,i,r,a,o,s,l){return(t=ss(n,i,!0,t,0,a,0,s,l)).context=ls(null),n=t.current,(a=gn(i=xo(),r=wo(n))).callback=void 0!==e&&null!==e?e:null,yn(n,a),t.current.lanes=r,Ie(t,r,i),To(t,i),t},e.createPortal=function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}},e.createRoleSelector=function(t){return{$$typeof:Da,value:t}},e.createTestNameSelector=function(t){return{$$typeof:Na,value:t}},e.createTextSelector=function(t){return{$$typeof:za,value:t}},e.deferredUpdates=function(t){var e=ke,n=qa.transition;try{return qa.transition=null,ke=16,t()}finally{ke=e,qa.transition=n}},e.discreteUpdates=function(t,e,n,i,r){var a=ke,o=qa.transition;try{return qa.transition=null,ke=1,t(e,n,i,r)}finally{ke=a,qa.transition=o,0===Za&&lo()}},e.findAllNodes=Va,e.findBoundingRects=function(t,e){if(!it)throw Error(o(363));e=Va(t,e),t=[];for(var n=0;n<e.length;n++)t.push(at(e[n]));for(e=t.length-1;0<e;e--)for(var i=(n=t[e]).x,r=i+n.width,a=n.y,s=a+n.height,l=e-1;0<=l;l--)if(e!==l){var c=t[l],u=c.x,h=u+c.width,d=c.y,p=d+c.height;if(i>=u&&a>=d&&r<=h&&s<=p){t.splice(e,1);break}if(!(i!==u||n.width!==c.width||p<a||d>s)){d>a&&(c.height+=d-a,c.y=a),p<s&&(c.height=s-d),t.splice(e,1);break}if(!(a!==d||n.height!==c.height||h<i||u>r)){u>i&&(c.width+=u-i,c.x=i),h<r&&(c.width=r-u),t.splice(e,1);break}}return t},e.findHostInstance=cs,e.findHostInstanceWithNoPortals=function(t){return null===(t=null!==(t=E(t))?I(t):null)?null:t.stateNode},e.findHostInstanceWithWarning=function(t){return cs(t)},e.flushControlled=function(t){var e=Za;Za|=1;var n=qa.transition,i=ke;try{qa.transition=null,ke=1,t()}finally{ke=i,qa.transition=n,0===(Za=e)&&(lo(),Ke())}},e.flushPassiveEffects=Ho,e.flushSync=Lo,e.focusWithin=function(t,e){if(!it)throw Error(o(363));for(e=ja(t=Oa(t),e),e=Array.from(e),t=0;t<e.length;){var n=e[t++];if(!st(n)){if(5===n.tag&&ct(n.stateNode))return!0;for(n=n.child;null!==n;)e.push(n),n=n.sibling}}return!1},e.getCurrentUpdatePriority=function(){return ke},e.getFindAllNodesFailureDescription=function(t,e){if(!it)throw Error(o(363));var n=0,i=[];t=[Oa(t),0];for(var r=0;r<t.length;){var a=t[r++],s=t[r++],l=e[s];if((5!==a.tag||!st(a))&&(Ba(a,l)&&(i.push(Ua(l)),++s>n&&(n=s)),s<e.length))for(a=a.child;null!==a;)t.push(a,s),a=a.sibling}if(n<e.length){for(t=[];n<e.length;n++)t.push(Ua(e[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+t.join(" > ")}return null},e.getPublicRootInstance=function(t){return(t=t.current).child?5===t.child.tag?R(t.child.stateNode):t.child.stateNode:null},e.injectIntoDevTools=function(t){if(t={bundleType:t.bundleType,version:t.version,rendererPackageName:t.rendererPackageName,rendererConfig:t.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:ds,findFiberByHostInstance:t.findFiberByHostInstance||ps,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)t=!1;else{var e=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(e.isDisabled||!e.supportsFiber)t=!0;else{try{He=e.inject(t),Ge=e}catch(n){}t=!!e.checkDCE}}return t},e.isAlreadyRendering=function(){return!1},e.observeVisibleRects=function(t,e,n,i){if(!it)throw Error(o(363));t=Va(t,e);var r=ut(t,n,i).disconnect;return{disconnect:function(){r()}}},e.registerMutableSourceForHydration=function(t,e){var n=e._getVersion;n=n(e._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[e,n]:t.mutableSourceEagerHydrationData.push(e,n)},e.runWithPriority=function(t,e){var n=ke;try{return ke=t,e()}finally{ke=n}},e.shouldError=function(){return null},e.shouldSuspend=function(){return!1},e.updateContainer=function(t,e,n,i){var r=e.current,a=xo(),o=wo(r);return n=ls(n),null===e.context?e.context=n:e.pendingContext=n,(e=gn(a,o)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),yn(r,e),null!==(t=So(r,o,a))&&vn(t,r,o),o},e}},7067:(t,e,n)=>{"use strict";t.exports=n(4612)},7205:(t,e,n)=>{"use strict";t.exports=n(7302)},7234:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<a(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=t[s],c=s+1,u=t[c];if(0>a(l,n))c<r&&0>a(u,l)?(t[i]=u,t[c]=n,i=c):(t[i]=l,t[s]=n,i=s);else{if(!(c<r&&0>a(u,n)))break t;t[i]=u,t[c]=n,i=c}}}return e}function a(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function b(t){for(var e=i(u);null!==e;){if(null===e.callback)r(u);else{if(!(e.startTime<=t))break;r(u),e.sortIndex=e.expirationTime,n(c,e)}e=i(u)}}function x(t){if(g=!1,b(t),!m)if(null!==i(c))m=!0,R(w);else{var e=i(u);null!==e&&D(x,e.startTime-t)}}function w(t,n){m=!1,g&&(g=!1,v(A),A=-1),f=!0;var a=p;try{for(b(n),d=i(c);null!==d&&(!(d.expirationTime>n)||t&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?d.callback=s:d===i(c)&&r(c),b(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(x,h.startTime-n),l=!1}return l}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,A=-1,E=5,C=-1;function P(){return!(e.unstable_now()-C<E)}function I(){if(null!==T){var t=e.unstable_now();C=t;var n=!0;try{n=T(!0,t)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(I)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,k=L.port2;L.port1.onmessage=I,S=function(){k.postMessage(null)}}else S=function(){y(I,0)};function R(t){T=t,M||(M=!0,S())}function D(t,n){A=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,R(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return i(c)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,r,a){var o=e.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,t){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(t.sortIndex=a,n(u,t),null===i(c)&&t===i(u)&&(g?(v(A),A=-1):g=!0,D(x,a-o))):(t.sortIndex=s,n(c,t),m||f||(m=!0,R(w))),t},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},7284:t=>{"use strict";var e,n="object"===typeof Reflect?Reflect:null,i=n&&"function"===typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var r=Number.isNaN||function(t){return t!==t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise(function(n,i){function r(n){t.removeListener(e,a),i(n)}function a(){"function"===typeof t.removeListener&&t.removeListener("error",r),n([].slice.call(arguments))}m(t,e,a,{once:!0}),"error"!==e&&function(t,e,n){"function"===typeof t.on&&m(t,"error",e,n)}(t,r,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function c(t,e,n,i){var r,a,o,c;if(s(n),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),o=a[e]),void 0===o)o=a[e]=n,++t._eventsCount;else if("function"===typeof o?o=a[e]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=l(t))>0&&o.length>r&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=o.length,c=u,console&&console.warn&&console.warn(c)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=u.bind(i);return r.listener=n,i.wrapFn=r,r}function d(t,e,n){var i=t._events;if(void 0===i)return[];var r=i[e];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):f(r,r.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function m(t,e,n,i){if("function"===typeof t.on)i.once?t.once(e,n):t.on(e,n);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function r(a){i.once&&t.removeEventListener(e,r),n(a)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!==typeof t||t<0||r(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||r(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=a[t];if(void 0===l)return!1;if("function"===typeof l)i(l,this,e);else{var c=l.length,u=f(l,c);for(n=0;n<c;++n)i(u[n],this,e)}return!0},a.prototype.addListener=function(t,e){return c(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return c(this,t,e,!0)},a.prototype.once=function(t,e){return s(e),this.on(t,h(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,h(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,i,r,a,o;if(s(e),void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0===--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!==typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,r),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,o||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},a.prototype.listeners=function(t){return d(this,t,!0)},a.prototype.rawListeners=function(t){return d(this,t,!1)},a.listenerCount=function(t,e){return"function"===typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},7302:(t,e)=>{"use strict";e.ConcurrentRoot=1,e.ContinuousEventPriority=4,e.DefaultEventPriority=16,e.DiscreteEventPriority=1},7736:(t,e,n)=>{var i=n(3738).default,r=n(9045);t.exports=function(t){var e=r(t,"string");return"symbol"==i(e)?e:e+""},t.exports.__esModule=!0,t.exports.default=t.exports},7950:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(2730)},8853:(t,e,n)=>{"use strict";t.exports=n(7234)},9045:(t,e,n)=>{var i=n(3738).default;t.exports=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,n),a.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var a=Object.create(null);n.r(a);var o={};t=t||[null,e({}),e([]),e(e)];for(var s=2&r&&i;("object"==typeof s||"function"==typeof s)&&!~t.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach(t=>o[t]=()=>i[t]);return o.default=()=>i,n.d(a,o),a}})(),n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce((e,i)=>(n.f[i](t,e),e),[])),n.u=t=>"static/js/"+t+"."+{239:"324cb237",455:"0af8248d",977:"a42e2769"}[t]+".chunk.js",n.miniCssF=t=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={},e="meteor-madness:";n.l=(i,r,a,o)=>{if(t[i])t[i].push(r);else{var s,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==e+a){s=h;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",e+a),s.src=i),t[i]=[r];var d=(e,n)=>{s.onerror=s.onload=null,clearTimeout(p);var r=t[i];if(delete t[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach(t=>t(n)),e)return e(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),n.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="/",(()=>{var t={792:0};n.f.j=(e,i)=>{var r=n.o(t,e)?t[e]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise((n,i)=>r=t[e]=[n,i]);i.push(r[2]=a);var o=n.p+n.u(e),s=new Error;n.l(o,i=>{if(n.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;s.message="Loading chunk "+e+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,r[1](s)}},"chunk-"+e,e)}};var e=(e,i)=>{var r,a,o=i[0],s=i[1],l=i[2],c=0;if(o.some(e=>0!==t[e])){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)l(n)}for(e&&e(i);c<o.length;c++)a=o[c],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0},i=self.webpackChunkmeteor_madness=self.webpackChunkmeteor_madness||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),(()=>{"use strict";var t={};n.r(t),n.d(t,{ACESFilmicToneMapping:()=>Ql,AddEquation:()=>vl,AddOperation:()=>Xl,AdditiveAnimationBlendMode:()=>zu,AdditiveBlending:()=>fl,AgXToneMapping:()=>ec,AlphaFormat:()=>Fc,AlwaysCompare:()=>bh,AlwaysDepth:()=>Bl,AlwaysStencilFunc:()=>dh,AmbientLight:()=>B_,AnimationAction:()=>Ib,AnimationClip:()=>s_,AnimationLoader:()=>g_,AnimationMixer:()=>kb,AnimationObjectGroup:()=>Pb,AnimationUtils:()=>Xv,ArcCurve:()=>vy,ArrayCamera:()=>ob,ArrowHelper:()=>Rx,AttachedBindMode:()=>ic,Audio:()=>fb,AudioAnalyser:()=>bb,AudioContext:()=>tb,AudioListener:()=>pb,AudioLoader:()=>eb,AxesHelper:()=>Dx,BackSide:()=>ul,BasicDepthPacking:()=>Uu,BasicShadowMap:()=>al,BatchedMesh:()=>Cg,Bone:()=>Bm,BooleanKeyframeTrack:()=>t_,Box2:()=>Yb,Box3:()=>Id,Box3Helper:()=>Cx,BoxGeometry:()=>Uf,BoxHelper:()=>Ex,BufferAttribute:()=>cf,BufferGeometry:()=>Af,BufferGeometryLoader:()=>q_,ByteType:()=>Tc,Cache:()=>c_,Camera:()=>qf,CameraHelper:()=>Mx,CanvasTexture:()=>ny,CapsuleGeometry:()=>ay,CatmullRomCurve3:()=>My,CineonToneMapping:()=>$l,CircleGeometry:()=>oy,ClampToEdgeWrapping:()=>dc,Clock:()=>sb,Color:()=>Yp,ColorKeyframeTrack:()=>e_,ColorManagement:()=>dd,CompressedArrayTexture:()=>ty,CompressedCubeTexture:()=>ey,CompressedTexture:()=>Qg,CompressedTextureLoader:()=>y_,ConeGeometry:()=>ly,ConstantAlphaFactor:()=>zl,ConstantColorFactor:()=>Dl,Controls:()=>zx,CubeCamera:()=>$f,CubeReflectionMapping:()=>oc,CubeRefractionMapping:()=>sc,CubeTexture:()=>Qf,CubeTextureLoader:()=>b_,CubeUVReflectionMapping:()=>uc,CubicBezierCurve:()=>Cy,CubicBezierCurve3:()=>Py,CubicInterpolant:()=>Kv,CullFaceBack:()=>nl,CullFaceFront:()=>il,CullFaceFrontBack:()=>rl,CullFaceNone:()=>el,Curve:()=>gy,CurvePath:()=>zy,CustomBlending:()=>yl,CustomToneMapping:()=>tc,CylinderGeometry:()=>sy,Cylindrical:()=>qb,Data3DTexture:()=>Cd,DataArrayTexture:()=>Ad,DataTexture:()=>Um,DataTextureLoader:()=>x_,DataUtils:()=>af,DecrementStencilOp:()=>eh,DecrementWrapStencilOp:()=>ih,DefaultLoadingManager:()=>h_,DepthFormat:()=>Uc,DepthStencilFormat:()=>jc,DepthTexture:()=>iy,DetachedBindMode:()=>rc,DirectionalLight:()=>O_,DirectionalLightHelper:()=>xx,DiscreteInterpolant:()=>$v,DodecahedronGeometry:()=>uy,DoubleSide:()=>hl,DstAlphaFactor:()=>Pl,DstColorFactor:()=>Ll,DynamicCopyUsage:()=>Ch,DynamicDrawUsage:()=>wh,DynamicReadUsage:()=>Th,EdgesGeometry:()=>my,EllipseCurve:()=>yy,EqualCompare:()=>mh,EqualDepth:()=>Vl,EqualStencilFunc:()=>sh,EquirectangularReflectionMapping:()=>lc,EquirectangularRefractionMapping:()=>cc,Euler:()=>pp,EventDispatcher:()=>Fh,ExternalTexture:()=>ry,ExtrudeGeometry:()=>mv,FileLoader:()=>m_,Float16BufferAttribute:()=>yf,Float32BufferAttribute:()=>vf,FloatType:()=>Ic,Fog:()=>am,FogExp2:()=>rm,FramebufferTexture:()=>$g,FrontSide:()=>cl,Frustum:()=>og,FrustumArray:()=>cg,GLBufferAttribute:()=>Ob,GLSL1:()=>Ih,GLSL3:()=>Lh,GreaterCompare:()=>yh,GreaterDepth:()=>Gl,GreaterEqualCompare:()=>_h,GreaterEqualDepth:()=>Hl,GreaterEqualStencilFunc:()=>hh,GreaterStencilFunc:()=>ch,GridHelper:()=>gx,Group:()=>em,HalfFloatType:()=>Lc,HemisphereLight:()=>M_,HemisphereLightHelper:()=>mx,IcosahedronGeometry:()=>yv,ImageBitmapLoader:()=>$_,ImageLoader:()=>__,ImageUtils:()=>gd,IncrementStencilOp:()=>th,IncrementWrapStencilOp:()=>nh,InstancedBufferAttribute:()=>Gm,InstancedBufferGeometry:()=>W_,InstancedInterleavedBuffer:()=>Fb,InstancedMesh:()=>$m,Int16BufferAttribute:()=>pf,Int32BufferAttribute:()=>mf,Int8BufferAttribute:()=>uf,IntType:()=>Cc,InterleavedBuffer:()=>sm,InterleavedBufferAttribute:()=>cm,Interpolant:()=>Yv,InterpolateDiscrete:()=>Pu,InterpolateLinear:()=>Iu,InterpolateSmooth:()=>Lu,InterpolationSamplingMode:()=>zh,InterpolationSamplingType:()=>Nh,InvertStencilOp:()=>rh,KeepStencilOp:()=>$u,KeyframeTrack:()=>Qv,LOD:()=>Cm,LatheGeometry:()=>vv,Layers:()=>fp,LessCompare:()=>fh,LessDepth:()=>Ul,LessEqualCompare:()=>gh,LessEqualDepth:()=>jl,LessEqualStencilFunc:()=>lh,LessStencilFunc:()=>oh,Light:()=>S_,LightProbe:()=>V_,Line:()=>Fg,Line3:()=>ix,LineBasicMaterial:()=>Pg,LineCurve:()=>Iy,LineCurve3:()=>Ly,LineDashedMaterial:()=>Vv,LineLoop:()=>Vg,LineSegments:()=>jg,LinearFilter:()=>_c,LinearInterpolant:()=>Jv,LinearMipMapLinearFilter:()=>Sc,LinearMipMapNearestFilter:()=>xc,LinearMipmapLinearFilter:()=>wc,LinearMipmapNearestFilter:()=>bc,LinearSRGBColorSpace:()=>Xu,LinearToneMapping:()=>Kl,LinearTransfer:()=>Yu,Loader:()=>d_,LoaderUtils:()=>G_,LoadingManager:()=>u_,LoopOnce:()=>Au,LoopPingPong:()=>Cu,LoopRepeat:()=>Eu,MOUSE:()=>Qs,Material:()=>$p,MaterialLoader:()=>H_,MathUtils:()=>Xh,Matrix2:()=>Zb,Matrix3:()=>td,Matrix4:()=>ip,MaxEquation:()=>wl,Mesh:()=>Of,MeshBasicMaterial:()=>Qp,MeshDepthMaterial:()=>Bv,MeshDistanceMaterial:()=>Uv,MeshLambertMaterial:()=>Ov,MeshMatcapMaterial:()=>jv,MeshNormalMaterial:()=>Fv,MeshPhongMaterial:()=>Nv,MeshPhysicalMaterial:()=>Dv,MeshStandardMaterial:()=>Rv,MeshToonMaterial:()=>zv,MinEquation:()=>xl,MirroredRepeatWrapping:()=>pc,MixOperation:()=>Zl,MultiplyBlending:()=>gl,MultiplyOperation:()=>ql,NearestFilter:()=>fc,NearestMipMapLinearFilter:()=>vc,NearestMipMapNearestFilter:()=>gc,NearestMipmapLinearFilter:()=>yc,NearestMipmapNearestFilter:()=>mc,NeutralToneMapping:()=>nc,NeverCompare:()=>ph,NeverDepth:()=>Ol,NeverStencilFunc:()=>ah,NoBlending:()=>dl,NoColorSpace:()=>qu,NoToneMapping:()=>Yl,NormalAnimationBlendMode:()=>Nu,NormalBlending:()=>pl,NotEqualCompare:()=>vh,NotEqualDepth:()=>Wl,NotEqualStencilFunc:()=>uh,NumberKeyframeTrack:()=>n_,Object3D:()=>Ip,ObjectLoader:()=>Z_,ObjectSpaceNormalMap:()=>Wu,OctahedronGeometry:()=>_v,OneFactor:()=>Ml,OneMinusConstantAlphaFactor:()=>Fl,OneMinusConstantColorFactor:()=>Nl,OneMinusDstAlphaFactor:()=>Il,OneMinusDstColorFactor:()=>kl,OneMinusSrcAlphaFactor:()=>Cl,OneMinusSrcColorFactor:()=>Al,OrthographicCamera:()=>z_,PCFShadowMap:()=>ol,PCFSoftShadowMap:()=>sl,PMREMGenerator:()=>hw,Path:()=>Fy,PerspectiveCamera:()=>Kf,Plane:()=>ng,PlaneGeometry:()=>bv,PlaneHelper:()=>Px,PointLight:()=>N_,PointLightHelper:()=>hx,Points:()=>Xg,PointsMaterial:()=>Hg,PolarGridHelper:()=>yx,PolyhedronGeometry:()=>cy,PositionalAudio:()=>_b,PropertyBinding:()=>Cb,PropertyMixer:()=>xb,QuadraticBezierCurve:()=>ky,QuadraticBezierCurve3:()=>Ry,Quaternion:()=>Kh,QuaternionKeyframeTrack:()=>r_,QuaternionLinearInterpolant:()=>i_,RED_GREEN_RGTC2_Format:()=>Mu,RED_RGTC1_Format:()=>wu,REVISION:()=>$s,RGBADepthPacking:()=>ju,RGBAFormat:()=>Bc,RGBAIntegerFormat:()=>Zc,RGBA_ASTC_10x10_Format:()=>gu,RGBA_ASTC_10x5_Format:()=>pu,RGBA_ASTC_10x6_Format:()=>fu,RGBA_ASTC_10x8_Format:()=>mu,RGBA_ASTC_12x10_Format:()=>yu,RGBA_ASTC_12x12_Format:()=>vu,RGBA_ASTC_4x4_Format:()=>au,RGBA_ASTC_5x4_Format:()=>ou,RGBA_ASTC_5x5_Format:()=>su,RGBA_ASTC_6x5_Format:()=>lu,RGBA_ASTC_6x6_Format:()=>cu,RGBA_ASTC_8x5_Format:()=>uu,RGBA_ASTC_8x6_Format:()=>hu,RGBA_ASTC_8x8_Format:()=>du,RGBA_BPTC_Format:()=>_u,RGBA_ETC2_EAC_Format:()=>ru,RGBA_PVRTC_2BPPV1_Format:()=>eu,RGBA_PVRTC_4BPPV1_Format:()=>tu,RGBA_S3TC_DXT1_Format:()=>Yc,RGBA_S3TC_DXT3_Format:()=>Kc,RGBA_S3TC_DXT5_Format:()=>Jc,RGBDepthPacking:()=>Vu,RGBFormat:()=>Oc,RGBIntegerFormat:()=>qc,RGB_BPTC_SIGNED_Format:()=>bu,RGB_BPTC_UNSIGNED_Format:()=>xu,RGB_ETC1_Format:()=>nu,RGB_ETC2_Format:()=>iu,RGB_PVRTC_2BPPV1_Format:()=>Qc,RGB_PVRTC_4BPPV1_Format:()=>$c,RGB_S3TC_DXT1_Format:()=>Xc,RGDepthPacking:()=>Hu,RGFormat:()=>Gc,RGIntegerFormat:()=>Wc,RawShaderMaterial:()=>kv,Ray:()=>np,Raycaster:()=>Ub,RectAreaLight:()=>U_,RedFormat:()=>Vc,RedIntegerFormat:()=>Hc,ReinhardToneMapping:()=>Jl,RenderTarget:()=>Md,RenderTarget3D:()=>Rb,RepeatWrapping:()=>hc,ReplaceStencilOp:()=>Qu,ReverseSubtractEquation:()=>bl,RingGeometry:()=>xv,SIGNED_RED_GREEN_RGTC2_Format:()=>Tu,SIGNED_RED_RGTC1_Format:()=>Su,SRGBColorSpace:()=>Zu,SRGBTransfer:()=>Ku,Scene:()=>om,ShaderChunk:()=>jx,ShaderLib:()=>Hx,ShaderMaterial:()=>Wf,ShadowMaterial:()=>Lv,Shape:()=>Oy,ShapeGeometry:()=>wv,ShapePath:()=>Nx,ShapeUtils:()=>dv,ShortType:()=>Ac,Skeleton:()=>Hm,SkeletonHelper:()=>cx,SkinnedMesh:()=>Om,Source:()=>vd,Sphere:()=>Xd,SphereGeometry:()=>Sv,Spherical:()=>Wb,SphericalHarmonics3:()=>j_,SplineCurve:()=>Dy,SpotLight:()=>I_,SpotLightHelper:()=>ax,Sprite:()=>Mm,SpriteMaterial:()=>um,SrcAlphaFactor:()=>El,SrcAlphaSaturateFactor:()=>Rl,SrcColorFactor:()=>Tl,StaticCopyUsage:()=>Eh,StaticDrawUsage:()=>xh,StaticReadUsage:()=>Mh,StereoCamera:()=>ab,StreamCopyUsage:()=>Ph,StreamDrawUsage:()=>Sh,StreamReadUsage:()=>Ah,StringKeyframeTrack:()=>a_,SubtractEquation:()=>_l,SubtractiveBlending:()=>ml,TOUCH:()=>tl,TangentSpaceNormalMap:()=>Gu,TetrahedronGeometry:()=>Mv,Texture:()=>wd,TextureLoader:()=>w_,TextureUtils:()=>Ox,Timer:()=>Hb,TimestampQuery:()=>Dh,TorusGeometry:()=>Tv,TorusKnotGeometry:()=>Av,Triangle:()=>Gp,TriangleFanDrawMode:()=>Bu,TriangleStripDrawMode:()=>Ou,TrianglesDrawMode:()=>Fu,TubeGeometry:()=>Ev,UVMapping:()=>ac,Uint16BufferAttribute:()=>ff,Uint32BufferAttribute:()=>gf,Uint8BufferAttribute:()=>hf,Uint8ClampedBufferAttribute:()=>df,Uniform:()=>Db,UniformsGroup:()=>zb,UniformsLib:()=>Vx,UniformsUtils:()=>Gf,UnsignedByteType:()=>Mc,UnsignedInt101111Type:()=>zc,UnsignedInt248Type:()=>Dc,UnsignedInt5999Type:()=>Nc,UnsignedIntType:()=>Pc,UnsignedShort4444Type:()=>kc,UnsignedShort5551Type:()=>Rc,UnsignedShortType:()=>Ec,VSMShadowMap:()=>ll,Vector2:()=>Yh,Vector3:()=>Jh,Vector4:()=>Sd,VectorKeyframeTrack:()=>o_,VideoFrameTexture:()=>Jg,VideoTexture:()=>Kg,WebGL3DRenderTarget:()=>Pd,WebGLArrayRenderTarget:()=>Ed,WebGLCoordinateSystem:()=>kh,WebGLCubeRenderTarget:()=>tm,WebGLRenderTarget:()=>Td,WebGLRenderer:()=>bM,WebGLUtils:()=>pM,WebGPUCoordinateSystem:()=>Rh,WebXRController:()=>im,WireframeGeometry:()=>Cv,WrapAroundEnding:()=>Du,ZeroCurvatureEnding:()=>ku,ZeroFactor:()=>Sl,ZeroSlopeEnding:()=>Ru,ZeroStencilOp:()=>Ju,createCanvasElement:()=>od});var e,i=n(5043),r=n.t(i,2),a=n(4391),o=n(7950),s=n.t(o,2);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},l.apply(this,arguments)}!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(e||(e={}));const c="popstate";function u(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}function h(t,e){if(!t){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(n){}}}function d(t,e){return{usr:t.state,key:t.key,idx:e}}function p(t,e,n,i){return void 0===n&&(n=null),l({pathname:"string"===typeof t?t:t.pathname,search:"",hash:""},"string"===typeof e?m(e):e,{state:n,key:e&&e.key||i||Math.random().toString(36).substr(2,8)})}function f(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&"?"!==n&&(e+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(e+="#"===i.charAt(0)?i:"#"+i),e}function m(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function g(t,n,i,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:o=!1}=r,s=a.history,h=e.Pop,m=null,g=y();function y(){return(s.state||{idx:null}).idx}function v(){h=e.Pop;let t=y(),n=null==t?null:t-g;g=t,m&&m({action:h,location:b.location,delta:n})}function _(t){let e="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof t?t:f(t);return n=n.replace(/ $/,"%20"),u(e,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,e)}null==g&&(g=0,s.replaceState(l({},s.state,{idx:g}),""));let b={get action(){return h},get location(){return t(a,s)},listen(t){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(c,v),m=t,()=>{a.removeEventListener(c,v),m=null}},createHref:t=>n(a,t),createURL:_,encodeLocation(t){let e=_(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,n){h=e.Push;let r=p(b.location,t,n);i&&i(r,t),g=y()+1;let l=d(r,g),c=b.createHref(r);try{s.pushState(l,"",c)}catch(uA){if(uA instanceof DOMException&&"DataCloneError"===uA.name)throw uA;a.location.assign(c)}o&&m&&m({action:h,location:b.location,delta:1})},replace:function(t,n){h=e.Replace;let r=p(b.location,t,n);i&&i(r,t),g=y();let a=d(r,g),l=b.createHref(r);s.replaceState(a,"",l),o&&m&&m({action:h,location:b.location,delta:0})},go:t=>s.go(t)};return b}var y;!function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(y||(y={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function v(t,e,n){return void 0===n&&(n="/"),_(t,e,n,!1)}function _(t,e,n,i){let r=R(("string"===typeof e?m(e):e).pathname||"/",n);if(null==r)return null;let a=b(t);!function(t){t.sort((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){let n=t.length===e.length&&t.slice(0,-1).every((t,n)=>t===e[n]);return n?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map(t=>t.childrenIndex),e.routesMeta.map(t=>t.childrenIndex)))}(a);let o=null;for(let s=0;null==o&&s<a.length;++s){let t=k(r);o=I(a[s],t,i)}return o}function b(t,e,n,i){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(t,r,a)=>{let o={relativePath:void 0===a?t.path||"":a,caseSensitive:!0===t.caseSensitive,childrenIndex:r,route:t};o.relativePath.startsWith("/")&&(u(o.relativePath.startsWith(i),'Absolute route path "'+o.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(i.length));let s=O([i,o.relativePath]),l=n.concat(o);t.children&&t.children.length>0&&(u(!0!==t.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),b(t.children,e,l,s)),(null!=t.path||t.index)&&e.push({path:s,score:P(s,t.index),routesMeta:l})};return t.forEach((t,e)=>{var n;if(""!==t.path&&null!=(n=t.path)&&n.includes("?"))for(let i of x(t.path))r(t,e,i);else r(t,e)}),e}function x(t){let e=t.split("/");if(0===e.length)return[];let[n,...i]=e,r=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===i.length)return r?[a,""]:[a];let o=x(i.join("/")),s=[];return s.push(...o.map(t=>""===t?a:[a,t].join("/"))),r&&s.push(...o),s.map(e=>t.startsWith("/")&&""===e?"/":e)}const w=/^:[\w-]+$/,S=3,M=2,T=1,A=10,E=-2,C=t=>"*"===t;function P(t,e){let n=t.split("/"),i=n.length;return n.some(C)&&(i+=E),e&&(i+=M),n.filter(t=>!C(t)).reduce((t,e)=>t+(w.test(e)?S:""===e?T:A),i)}function I(t,e,n){void 0===n&&(n=!1);let{routesMeta:i}=t,r={},a="/",o=[];for(let s=0;s<i.length;++s){let t=i[s],l=s===i.length-1,c="/"===a?e:e.slice(a.length)||"/",u=L({path:t.relativePath,caseSensitive:t.caseSensitive,end:l},c),h=t.route;if(!u&&l&&n&&!i[i.length-1].route.index&&(u=L({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},c)),!u)return null;Object.assign(r,u.params),o.push({params:r,pathname:O([a,u.pathname]),pathnameBase:B(O([a,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(a=O([a,u.pathnameBase]))}return o}function L(t,e){"string"===typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=function(t,e,n){void 0===e&&(e=!1);void 0===n&&(n=!0);h("*"===t||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were "'+t.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+t.replace(/\*$/,"/*")+'".');let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(t,e,n)=>(i.push({paramName:e,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));t.endsWith("*")?(i.push({paramName:"*"}),r+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==t&&"/"!==t&&(r+="(?:(?=\\/|$))");let a=new RegExp(r,e?void 0:"i");return[a,i]}(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let a=r[0],o=a.replace(/(.)\/+$/,"$1"),s=r.slice(1),l=i.reduce((t,e,n)=>{let{paramName:i,isOptional:r}=e;if("*"===i){let t=s[n]||"";o=a.slice(0,a.length-t.length).replace(/(.)\/+$/,"$1")}const l=s[n];return t[i]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),t},{});return{params:l,pathname:a,pathnameBase:o,pattern:t}}function k(t){try{return t.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(uA){return h(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+uA+")."),t}}function R(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&"/"!==i?null:t.slice(n)||"/"}function D(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified `to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function N(t){return t.filter((t,e)=>0===e||t.route.path&&t.route.path.length>0)}function z(t,e){let n=N(t);return e?n.map((t,e)=>e===n.length-1?t.pathname:t.pathnameBase):n.map(t=>t.pathnameBase)}function F(t,e,n,i){let r;void 0===i&&(i=!1),"string"===typeof t?r=m(t):(r=l({},t),u(!r.pathname||!r.pathname.includes("?"),D("?","pathname","search",r)),u(!r.pathname||!r.pathname.includes("#"),D("#","pathname","hash",r)),u(!r.search||!r.search.includes("#"),D("#","search","hash",r)));let a,o=""===t||""===r.pathname,s=o?"/":r.pathname;if(null==s)a=n;else{let t=e.length-1;if(!i&&s.startsWith("..")){let e=s.split("/");for(;".."===e[0];)e.shift(),t-=1;r.pathname=e.join("/")}a=t>=0?e[t]:"/"}let c=function(t,e){void 0===e&&(e="/");let{pathname:n,search:i="",hash:r=""}="string"===typeof t?m(t):t,a=n?n.startsWith("/")?n:function(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(t=>{".."===t?n.length>1&&n.pop():"."!==t&&n.push(t)}),n.length>1?n.join("/"):"/"}(n,e):e;return{pathname:a,search:U(i),hash:j(r)}}(r,a),h=s&&"/"!==s&&s.endsWith("/"),d=(o||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!h&&!d||(c.pathname+="/"),c}const O=t=>t.join("/").replace(/\/\/+/g,"/"),B=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),U=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",j=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"";Error;function V(t){return null!=t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"boolean"===typeof t.internal&&"data"in t}const H=["post","put","patch","delete"],G=(new Set(H),["get",...H]);new Set(G),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},W.apply(this,arguments)}const q=i.createContext(null);const Z=i.createContext(null);const X=i.createContext(null);const Y=i.createContext(null);const K=i.createContext({outlet:null,matches:[],isDataRoute:!1});const J=i.createContext(null);function $(){return null!=i.useContext(Y)}function Q(){return $()||u(!1),i.useContext(Y).location}function tt(t){i.useContext(X).static||i.useLayoutEffect(t)}function et(){let{isDataRoute:t}=i.useContext(K);return t?function(){let{router:t}=ht(ct.UseNavigateStable),e=pt(ut.UseNavigateStable),n=i.useRef(!1);tt(()=>{n.current=!0});let r=i.useCallback(function(i,r){void 0===r&&(r={}),n.current&&("number"===typeof i?t.navigate(i):t.navigate(i,W({fromRouteId:e},r)))},[t,e]);return r}():function(){$()||u(!1);let t=i.useContext(q),{basename:e,future:n,navigator:r}=i.useContext(X),{matches:a}=i.useContext(K),{pathname:o}=Q(),s=JSON.stringify(z(a,n.v7_relativeSplatPath)),l=i.useRef(!1);tt(()=>{l.current=!0});let c=i.useCallback(function(n,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof n)return void r.go(n);let a=F(n,JSON.parse(s),o,"path"===i.relative);null==t&&"/"!==e&&(a.pathname="/"===a.pathname?e:O([e,a.pathname])),(i.replace?r.replace:r.push)(a,i.state,i)},[e,r,s,o,t]);return c}()}function nt(t,e){let{relative:n}=void 0===e?{}:e,{future:r}=i.useContext(X),{matches:a}=i.useContext(K),{pathname:o}=Q(),s=JSON.stringify(z(a,r.v7_relativeSplatPath));return i.useMemo(()=>F(t,JSON.parse(s),o,"path"===n),[t,s,o,n])}function it(t,n,r,a){$()||u(!1);let{navigator:o}=i.useContext(X),{matches:s}=i.useContext(K),l=s[s.length-1],c=l?l.params:{},h=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let d,p=Q();if(n){var f;let t="string"===typeof n?m(n):n;"/"===h||(null==(f=t.pathname)?void 0:f.startsWith(h))||u(!1),d=t}else d=p;let g=d.pathname||"/",y=g;if("/"!==h){let t=h.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(t.length).join("/")}let _=v(t,{pathname:y});let b=lt(_&&_.map(t=>Object.assign({},t,{params:Object.assign({},c,t.params),pathname:O([h,o.encodeLocation?o.encodeLocation(t.pathname).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?h:O([h,o.encodeLocation?o.encodeLocation(t.pathnameBase).pathname:t.pathnameBase])})),s,r,a);return n&&b?i.createElement(Y.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:e.Pop}},b):b}function rt(){let t=function(){var t;let e=i.useContext(J),n=dt(ut.UseRouteError),r=pt(ut.UseRouteError);if(void 0!==e)return e;return null==(t=n.errors)?void 0:t[r]}(),e=V(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},e),n?i.createElement("pre",{style:a},n):null,null)}const at=i.createElement(rt,null);class ot extends i.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return void 0!==this.state.error?i.createElement(K.Provider,{value:this.props.routeContext},i.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function st(t){let{routeContext:e,match:n,children:r}=t,a=i.useContext(q);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement(K.Provider,{value:e},r)}function lt(t,e,n,r){var a;if(void 0===e&&(e=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==t){var o;if(!n)return null;if(n.errors)t=n.matches;else{if(!(null!=(o=r)&&o.v7_partialHydration&&0===e.length&&!n.initialized&&n.matches.length>0))return null;t=n.matches}}let s=t,l=null==(a=n)?void 0:a.errors;if(null!=l){let t=s.findIndex(t=>t.route.id&&void 0!==(null==l?void 0:l[t.route.id]));t>=0||u(!1),s=s.slice(0,Math.min(s.length,t+1))}let c=!1,h=-1;if(n&&r&&r.v7_partialHydration)for(let i=0;i<s.length;i++){let t=s[i];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(h=i),t.route.id){let{loaderData:e,errors:i}=n,r=t.route.loader&&void 0===e[t.route.id]&&(!i||void 0===i[t.route.id]);if(t.route.lazy||r){c=!0,s=h>=0?s.slice(0,h+1):[s[0]];break}}}return s.reduceRight((t,r,a)=>{let o,u=!1,d=null,p=null;var f;n&&(o=l&&r.route.id?l[r.route.id]:void 0,d=r.route.errorElement||at,c&&(h<0&&0===a?(f="route-fallback",!1||ft[f]||(ft[f]=!0),u=!0,p=null):h===a&&(u=!0,p=r.route.hydrateFallbackElement||null)));let m=e.concat(s.slice(0,a+1)),g=()=>{let e;return e=o?d:u?p:r.route.Component?i.createElement(r.route.Component,null):r.route.element?r.route.element:t,i.createElement(st,{match:r,routeContext:{outlet:t,matches:m,isDataRoute:null!=n},children:e})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===a)?i.createElement(ot,{location:n.location,revalidation:n.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var ct=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(ct||{}),ut=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ut||{});function ht(t){let e=i.useContext(q);return e||u(!1),e}function dt(t){let e=i.useContext(Z);return e||u(!1),e}function pt(t){let e=function(){let t=i.useContext(K);return t||u(!1),t}(),n=e.matches[e.matches.length-1];return n.route.id||u(!1),n.route.id}const ft={};function mt(t,e){null==t||t.v7_startTransition,void 0===(null==t?void 0:t.v7_relativeSplatPath)&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}r.startTransition;function gt(t){u(!1)}function yt(t){let{basename:n="/",children:r=null,location:a,navigationType:o=e.Pop,navigator:s,static:l=!1,future:c}=t;$()&&u(!1);let h=n.replace(/^\/*/,"/"),d=i.useMemo(()=>({basename:h,navigator:s,static:l,future:W({v7_relativeSplatPath:!1},c)}),[h,c,s,l]);"string"===typeof a&&(a=m(a));let{pathname:p="/",search:f="",hash:g="",state:y=null,key:v="default"}=a,_=i.useMemo(()=>{let t=R(p,h);return null==t?null:{location:{pathname:t,search:f,hash:g,state:y,key:v},navigationType:o}},[h,p,f,g,y,v,o]);return null==_?null:i.createElement(X.Provider,{value:d},i.createElement(Y.Provider,{children:r,value:_}))}function vt(t){let{children:e,location:n}=t;return it(_t(e),n)}new Promise(()=>{});i.Component;function _t(t,e){void 0===e&&(e=[]);let n=[];return i.Children.forEach(t,(t,r)=>{if(!i.isValidElement(t))return;let a=[...e,r];if(t.type===i.Fragment)return void n.push.apply(n,_t(t.props.children,a));t.type!==gt&&u(!1),t.props.index&&t.props.children&&u(!1);let o={id:t.props.id||a.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(o.children=_t(t.props.children,a)),n.push(o)}),n}function bt(){return bt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},bt.apply(this,arguments)}function xt(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const wt=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(rJ){}new Map;const St=r.startTransition;s.flushSync,r.useId;function Mt(t){let{basename:e,children:n,future:r,window:a}=t,o=i.useRef();var s;null==o.current&&(o.current=(void 0===(s={window:a,v5Compat:!0})&&(s={}),g(function(t,e){let{pathname:n,search:i,hash:r}=t.location;return p("",{pathname:n,search:i,hash:r},e.state&&e.state.usr||null,e.state&&e.state.key||"default")},function(t,e){return"string"===typeof e?e:f(e)},null,s)));let l=o.current,[c,u]=i.useState({action:l.action,location:l.location}),{v7_startTransition:h}=r||{},d=i.useCallback(t=>{h&&St?St(()=>u(t)):u(t)},[u,h]);return i.useLayoutEffect(()=>l.listen(d),[l,d]),i.useEffect(()=>mt(r),[r]),i.createElement(yt,{basename:e,children:n,location:c.location,navigationType:c.action,navigator:l,future:r})}const Tt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,At=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Et=i.forwardRef(function(t,e){let n,{onClick:r,relative:a,reloadDocument:o,replace:s,state:l,target:c,to:h,preventScrollReset:d,viewTransition:p}=t,m=xt(t,wt),{basename:g}=i.useContext(X),y=!1;if("string"===typeof h&&At.test(h)&&(n=h,Tt))try{let t=new URL(window.location.href),e=h.startsWith("//")?new URL(t.protocol+h):new URL(h),n=R(e.pathname,g);e.origin===t.origin&&null!=n?h=n+e.search+e.hash:y=!0}catch(rJ){}let v=function(t,e){let{relative:n}=void 0===e?{}:e;$()||u(!1);let{basename:r,navigator:a}=i.useContext(X),{hash:o,pathname:s,search:l}=nt(t,{relative:n}),c=s;return"/"!==r&&(c="/"===s?r:O([r,s])),a.createHref({pathname:c,search:l,hash:o})}(h,{relative:a}),_=function(t,e){let{target:n,replace:r,state:a,preventScrollReset:o,relative:s,viewTransition:l}=void 0===e?{}:e,c=et(),u=Q(),h=nt(t,{relative:s});return i.useCallback(e=>{if(function(t,e){return 0===t.button&&(!e||"_self"===e)&&!function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}(t)}(e,n)){e.preventDefault();let n=void 0!==r?r:f(u)===f(h);c(t,{replace:n,state:a,preventScrollReset:o,relative:s,viewTransition:l})}},[u,c,h,r,a,n,t,o,s,l])}(h,{replace:s,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:p});return i.createElement("a",bt({},m,{href:n||v,onClick:y||o?r:function(t){r&&r(t),t.defaultPrevented||_(t)},ref:e,target:c}))});var Ct,Pt;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Ct||(Ct={})),function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"}(Pt||(Pt={}));var It=n(4980);function Lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lt(Object(n),!0).forEach(function(e){(0,It.A)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Rt=n(579);const Dt=(0,i.createContext)(),Nt={impactArea:{lat:0,lng:0,location:""},asteroidData:[],selectedAsteroid:null,simulationParams:{diameter:250,velocity:19.3,angle:45,location:"Ocean (Pacific)",coordinates:{lat:0,lng:180}},simulationResults:null,threatLevel:"Medium",isLoading:!1,error:null,userPreferences:{units:"metric",notifications:!0},impactData:null};function zt(t,e){switch(e.type){case"SET_LOADING":return kt(kt({},t),{},{isLoading:e.payload});case"SET_ERROR":return kt(kt({},t),{},{error:e.payload,isLoading:!1});case"SET_ASTEROID_DATA":return kt(kt({},t),{},{asteroidData:e.payload,isLoading:!1});case"SELECT_ASTEROID":return kt(kt({},t),{},{selectedAsteroid:e.payload});case"UPDATE_SIMULATION_PARAMS":return kt(kt({},t),{},{simulationParams:kt(kt({},t.simulationParams),e.payload)});case"SET_SIMULATION_RESULTS":return kt(kt({},t),{},{simulationResults:e.payload});case"SET_THREAT_LEVEL":return kt(kt({},t),{},{threatLevel:e.payload});case"SET_IMPACT_DATA":return kt(kt({},t),{},{impactData:e.payload});case"UPDATE_USER_PREFERENCES":return kt(kt({},t),{},{userPreferences:kt(kt({},t.userPreferences),e.payload)});case"CLEAR_ERROR":return kt(kt({},t),{},{error:null});case"SET_IMPACT_AREA":return kt(kt({},t),{},{impactArea:kt(kt({},t.impactArea),e.payload)});default:return t}}function Ft(t){let{children:e}=t;const[n,r]=(0,i.useReducer)(zt,Nt);return(0,i.useEffect)(()=>{const t=localStorage.getItem("meteorMadnessPreferences");if(t)try{const e=JSON.parse(t);r({type:"UPDATE_USER_PREFERENCES",payload:e})}catch(uA){console.error("Error loading user preferences:",uA)}},[]),(0,i.useEffect)(()=>{localStorage.setItem("meteorMadnessPreferences",JSON.stringify(n.userPreferences))},[n.userPreferences]),(0,Rt.jsx)(Dt.Provider,{value:{state:n,dispatch:r},children:e})}function Ot(){const t=(0,i.useContext)(Dt);if(!t)throw new Error("useAppContext must be used within an AppProvider");return t}const Bt=function(){const t=Q(),[e,n]=(0,i.useState)(!1);return(0,Rt.jsx)("nav",{className:"navigation",children:(0,Rt.jsxs)("div",{className:"nav-container",children:[(0,Rt.jsxs)(Et,{to:"/",className:"nav-logo",children:[(0,Rt.jsx)("div",{className:"logo-icon",children:(0,Rt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,Rt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"})]}),(0,Rt.jsx)("div",{className:"nav-menu ".concat(e?"nav-menu--open":""),children:[{path:"/",label:"Home"},{path:"/story",label:"Story Mode"},{path:"/dashboard",label:"Dashboard"},{path:"/results",label:"Results"}].map(e=>(0,Rt.jsx)(Et,{to:e.path,className:"nav-link ".concat(t.pathname===e.path?"nav-link--active":""),onClick:()=>n(!1),children:e.label},e.path))}),(0,Rt.jsx)("div",{className:"nav-actions",children:(0,Rt.jsx)("button",{className:"nav-btn nav-btn--primary",children:"Explore Impact"})}),(0,Rt.jsxs)("button",{className:"nav-toggle",onClick:()=>n(!e),"aria-label":"Toggle navigation menu",children:[(0,Rt.jsx)("span",{}),(0,Rt.jsx)("span",{}),(0,Rt.jsx)("span",{})]})]})})},Ut=(0,i.createContext)({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),jt=(0,i.createContext)({}),Vt=(0,i.createContext)(null),Ht="undefined"!==typeof document,Gt=Ht?i.useLayoutEffect:i.useEffect,Wt=(0,i.createContext)({strict:!1}),qt=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Zt="data-"+qt("framerAppearId");function Xt(t){return t&&"object"===typeof t&&Object.prototype.hasOwnProperty.call(t,"current")}function Yt(t){return"string"===typeof t||Array.isArray(t)}function Kt(t){return null!==t&&"object"===typeof t&&"function"===typeof t.start}const Jt=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],$t=["initial",...Jt];function Qt(t){return Kt(t.animate)||$t.some(e=>Yt(t[e]))}function te(t){return Boolean(Qt(t)||t.variants)}function ee(t){const{initial:e,animate:n}=function(t,e){if(Qt(t)){const{initial:e,animate:n}=t;return{initial:!1===e||Yt(e)?e:void 0,animate:Yt(n)?n:void 0}}return!1!==t.inherit?e:{}}(t,(0,i.useContext)(jt));return(0,i.useMemo)(()=>({initial:e,animate:n}),[ne(e),ne(n)])}function ne(t){return Array.isArray(t)?t.join(" "):t}const ie={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},re={};for(const n in ie)re[n]={isEnabled:t=>ie[n].some(e=>!!t[e])};const ae=(0,i.createContext)({}),oe=(0,i.createContext)({}),se=Symbol.for("motionComponentSymbol");function le(t){let{preloadedFeatures:e,createVisualElement:n,useRender:r,useVisualState:a,Component:o}=t;e&&function(t){for(const e in t)re[e]=kt(kt({},re[e]),t[e])}(e);const s=(0,i.forwardRef)(function(t,s){let l;const c=kt(kt(kt({},(0,i.useContext)(Ut)),t),{},{layoutId:ce(t)}),{isStatic:u}=c,h=ee(t),d=a(t,u);if(!u&&Ht){h.visualElement=function(t,e,n,r){const{visualElement:a}=(0,i.useContext)(jt),o=(0,i.useContext)(Wt),s=(0,i.useContext)(Vt),l=(0,i.useContext)(Ut).reducedMotion,c=(0,i.useRef)();r=r||o.renderer,!c.current&&r&&(c.current=r(t,{visualState:e,parent:a,props:n,presenceContext:s,blockInitialAnimation:!!s&&!1===s.initial,reducedMotionConfig:l}));const u=c.current;(0,i.useInsertionEffect)(()=>{u&&u.update(n,s)});const h=(0,i.useRef)(Boolean(n[Zt]&&!window.HandoffComplete));return Gt(()=>{u&&(u.render(),h.current&&u.animationState&&u.animationState.animateChanges())}),(0,i.useEffect)(()=>{u&&(u.updateFeatures(),!h.current&&u.animationState&&u.animationState.animateChanges(),h.current&&(h.current=!1,window.HandoffComplete=!0))}),u}(o,d,c,n);const t=(0,i.useContext)(oe),r=(0,i.useContext)(Wt).strict;h.visualElement&&(l=h.visualElement.loadFeatures(c,r,e,t))}return i.createElement(jt.Provider,{value:h},l&&h.visualElement?i.createElement(l,kt({visualElement:h.visualElement},c)):null,r(o,t,function(t,e,n){return(0,i.useCallback)(i=>{i&&t.mount&&t.mount(i),e&&(i?e.mount(i):e.unmount()),n&&("function"===typeof n?n(i):Xt(n)&&(n.current=i))},[e])}(d,h.visualElement,s),d,u,h.visualElement))});return s[se]=o,s}function ce(t){let{layoutId:e}=t;const n=(0,i.useContext)(ae).id;return n&&void 0!==e?n+"-"+e:e}function ue(t){function e(e){return le(t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}if("undefined"===typeof Proxy)return e;const n=new Map;return new Proxy(e,{get:(t,i)=>(n.has(i)||n.set(i,e(i)),n.get(i))})}const he=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function de(t){return"string"===typeof t&&!t.includes("-")&&!!(he.indexOf(t)>-1||/[A-Z]/.test(t))}const pe={};const fe=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],me=new Set(fe);function ge(t,e){let{layout:n,layoutId:i}=e;return me.has(t)||t.startsWith("origin")||(n||void 0!==i)&&(!!pe[t]||"opacity"===t)}const ye=t=>Boolean(t&&t.getVelocity),ve={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},_e=fe.length;const be=t=>e=>"string"===typeof e&&e.startsWith(t),xe=be("--"),we=be("var(--"),Se=(t,e)=>e&&"number"===typeof t?e.transform(t):t,Me=(t,e,n)=>Math.min(Math.max(n,t),e),Te={test:t=>"number"===typeof t,parse:parseFloat,transform:t=>t},Ae=kt(kt({},Te),{},{transform:t=>Me(0,1,t)}),Ee=kt(kt({},Te),{},{default:1}),Ce=t=>Math.round(1e5*t)/1e5,Pe=/(-)?([\d]*\.?[\d])+/g,Ie=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Le=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function ke(t){return"string"===typeof t}const Re=t=>({test:e=>ke(e)&&e.endsWith(t)&&1===e.split(" ").length,parse:parseFloat,transform:e=>"".concat(e).concat(t)}),De=Re("deg"),Ne=Re("%"),ze=Re("px"),Fe=Re("vh"),Oe=Re("vw"),Be=kt(kt({},Ne),{},{parse:t=>Ne.parse(t)/100,transform:t=>Ne.transform(100*t)}),Ue=kt(kt({},Te),{},{transform:Math.round}),je={borderWidth:ze,borderTopWidth:ze,borderRightWidth:ze,borderBottomWidth:ze,borderLeftWidth:ze,borderRadius:ze,radius:ze,borderTopLeftRadius:ze,borderTopRightRadius:ze,borderBottomRightRadius:ze,borderBottomLeftRadius:ze,width:ze,maxWidth:ze,height:ze,maxHeight:ze,size:ze,top:ze,right:ze,bottom:ze,left:ze,padding:ze,paddingTop:ze,paddingRight:ze,paddingBottom:ze,paddingLeft:ze,margin:ze,marginTop:ze,marginRight:ze,marginBottom:ze,marginLeft:ze,rotate:De,rotateX:De,rotateY:De,rotateZ:De,scale:Ee,scaleX:Ee,scaleY:Ee,scaleZ:Ee,skew:De,skewX:De,skewY:De,distance:ze,translateX:ze,translateY:ze,translateZ:ze,x:ze,y:ze,z:ze,perspective:ze,transformPerspective:ze,opacity:Ae,originX:Be,originY:Be,originZ:ze,zIndex:Ue,fillOpacity:Ae,strokeOpacity:Ae,numOctaves:Ue};function Ve(t,e,n,i){const{style:r,vars:a,transform:o,transformOrigin:s}=t;let l=!1,c=!1,u=!0;for(const h in e){const t=e[h];if(xe(h)){a[h]=t;continue}const n=je[h],i=Se(t,n);if(me.has(h)){if(l=!0,o[h]=i,!u)continue;t!==(n.default||0)&&(u=!1)}else h.startsWith("origin")?(c=!0,s[h]=i):r[h]=i}if(e.transform||(l||i?r.transform=function(t,e,n,i){let{enableHardwareAcceleration:r=!0,allowTransformNone:a=!0}=e,o="";for(let s=0;s<_e;s++){const e=fe[s];void 0!==t[e]&&(o+="".concat(ve[e]||e,"(").concat(t[e],") "))}return r&&!t.z&&(o+="translateZ(0)"),o=o.trim(),i?o=i(t,n?"":o):a&&n&&(o="none"),o}(t.transform,n,u,i):r.transform&&(r.transform="none")),c){const{originX:t="50%",originY:e="50%",originZ:n=0}=s;r.transformOrigin="".concat(t," ").concat(e," ").concat(n)}}const He=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Ge(t,e,n){for(const i in e)ye(e[i])||ge(i,n)||(t[i]=e[i])}function We(t,e,n){const r={};return Ge(r,t.style||{},t),Object.assign(r,function(t,e,n){let{transformTemplate:r}=t;return(0,i.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return Ve(t,e,{enableHardwareAcceleration:!n},r),Object.assign({},t.vars,t.style)},[e])}(t,e,n)),t.transformValues?t.transformValues(r):r}function qe(t,e,n){const i={},r=We(t,e,n);return t.drag&&!1!==t.dragListener&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===t.drag?"none":"pan-".concat("x"===t.drag?"y":"x")),void 0===t.tabIndex&&(t.onTap||t.onTapStart||t.whileTap)&&(i.tabIndex=0),i.style=r,i}const Ze=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Xe(t){return t.startsWith("while")||t.startsWith("drag")&&"draggable"!==t||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Ze.has(t)}let Ye=t=>!Xe(t);try{(Ke=require("@emotion/is-prop-valid").default)&&(Ye=t=>t.startsWith("on")?!Xe(t):Ke(t))}catch($T){}var Ke;function Je(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(-1!==e.indexOf(i))continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function $e(t,e,n){return"string"===typeof t?t:ze.transform(e+n*t)}const Qe={offset:"stroke-dashoffset",array:"stroke-dasharray"},tn={offset:"strokeDashoffset",array:"strokeDasharray"};const en=["attrX","attrY","attrScale","originX","originY","pathLength","pathSpacing","pathOffset"];function nn(t,e,n,i,r){let{attrX:a,attrY:o,attrScale:s,originX:l,originY:c,pathLength:u,pathSpacing:h=1,pathOffset:d=0}=e;if(Ve(t,Je(e,en),n,r),i)return void(t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox));t.attrs=t.style,t.style={};const{attrs:p,style:f,dimensions:m}=t;p.transform&&(m&&(f.transform=p.transform),delete p.transform),m&&(void 0!==l||void 0!==c||f.transform)&&(f.transformOrigin=function(t,e,n){const i=$e(e,t.x,t.width),r=$e(n,t.y,t.height);return"".concat(i," ").concat(r)}(m,void 0!==l?l:.5,void 0!==c?c:.5)),void 0!==a&&(p.x=a),void 0!==o&&(p.y=o),void 0!==s&&(p.scale=s),void 0!==u&&function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.pathLength=1;const a=r?Qe:tn;t[a.offset]=ze.transform(-i);const o=ze.transform(e),s=ze.transform(n);t[a.array]="".concat(o," ").concat(s)}(p,u,h,d,!1)}const rn=()=>kt(kt({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}}),an=t=>"string"===typeof t&&"svg"===t.toLowerCase();function on(t,e,n,r){const a=(0,i.useMemo)(()=>{const n=rn();return nn(n,e,{enableHardwareAcceleration:!1},an(r),t.transformTemplate),kt(kt({},n.attrs),{},{style:kt({},n.style)})},[e]);if(t.style){const e={};Ge(e,t.style,t),a.style=kt(kt({},e),a.style)}return a}function sn(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(e,n,r,a,o)=>{let{latestValues:s}=a;const l=(de(e)?on:qe)(n,s,o,e),c=function(t,e,n){const i={};for(const r in t)"values"===r&&"object"===typeof t.values||(Ye(r)||!0===n&&Xe(r)||!e&&!Xe(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}(n,"string"===typeof e,t),u=kt(kt(kt({},c),l),{},{ref:r}),{children:h}=n,d=(0,i.useMemo)(()=>ye(h)?h.get():h,[h]);return(0,i.createElement)(e,kt(kt({},u),{},{children:d}))}}function ln(t,e,n,i){let{style:r,vars:a}=e;Object.assign(t.style,r,i&&i.getProjectionStyles(n));for(const o in a)t.style.setProperty(o,a[o])}const cn=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function un(t,e,n,i){ln(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(cn.has(r)?r:qt(r),e.attrs[r])}function hn(t,e){const{style:n}=t,i={};for(const r in n)(ye(n[r])||e.style&&ye(e.style[r])||ge(r,t))&&(i[r]=n[r]);return i}function dn(t,e){const n=hn(t,e);for(const i in t)if(ye(t[i])||ye(e[i])){n[-1!==fe.indexOf(i)?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i]=t[i]}return n}function pn(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return"function"===typeof e&&(e=e(void 0!==n?n:t.custom,i,r)),"string"===typeof e&&(e=t.variants&&t.variants[e]),"function"===typeof e&&(e=e(void 0!==n?n:t.custom,i,r)),e}const fn=t=>Array.isArray(t),mn=t=>fn(t)?t[t.length-1]||0:t;function gn(t){const e=ye(t)?t.get():t;return(t=>Boolean(t&&"object"===typeof t&&t.mix&&t.toValue))(e)?e.toValue():e}const yn=["transitionEnd","transition"];const vn=t=>(e,n)=>{const r=(0,i.useContext)(jt),a=(0,i.useContext)(Vt),o=()=>function(t,e,n,i){let{scrapeMotionValuesFromProps:r,createRenderState:a,onMount:o}=t;const s={latestValues:_n(e,n,i,r),renderState:a()};return o&&(s.mount=t=>o(e,t,s)),s}(t,e,r,a);return n?o():function(t){const e=(0,i.useRef)(null);return null===e.current&&(e.current=t()),e.current}(o)};function _n(t,e,n,i){const r={},a=i(t,{});for(const d in a)r[d]=gn(a[d]);let{initial:o,animate:s}=t;const l=Qt(t),c=te(t);e&&c&&!l&&!1!==t.inherit&&(void 0===o&&(o=e.initial),void 0===s&&(s=e.animate));let u=!!n&&!1===n.initial;u=u||!1===o;const h=u?s:o;if(h&&"boolean"!==typeof h&&!Kt(h)){(Array.isArray(h)?h:[h]).forEach(e=>{const n=pn(t,e);if(!n)return;const{transitionEnd:i,transition:a}=n,o=Je(n,yn);for(const t in o){let e=o[t];if(Array.isArray(e)){e=e[u?e.length-1:0]}null!==e&&(r[t]=e)}for(const t in i)r[t]=i[t]})}return r}const bn=t=>t;class xn{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const e=this.order.indexOf(t);-1!==e&&(this.order.splice(e,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}const wn=["prepare","read","update","preRender","render","postRender"];const{schedule:Sn,cancel:Mn,state:Tn,steps:An}=function(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=wn.reduce((t,e)=>(t[e]=function(t){let e=new xn,n=new xn,i=0,r=!1,a=!1;const o=new WeakSet,s={schedule:function(t){const a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r,s=a?e:n;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&o.add(t),s.add(t)&&a&&r&&(i=e.order.length),t},cancel:t=>{n.remove(t),o.delete(t)},process:l=>{if(r)a=!0;else{if(r=!0,[e,n]=[n,e],n.clear(),i=e.order.length,i)for(let n=0;n<i;n++){const i=e.order[n];i(l),o.has(i)&&(s.schedule(i),t())}r=!1,a&&(a=!1,s.process(l))}}};return s}(()=>n=!0),t),{}),o=t=>a[t].process(r),s=()=>{const a=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(a-r.timestamp,40),1),r.timestamp=a,r.isProcessing=!0,wn.forEach(o),r.isProcessing=!1,n&&e&&(i=!1,t(s))},l=wn.reduce((e,o)=>{const l=a[o];return e[o]=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,i=!0,r.isProcessing||t(s)),l.schedule(e,a,o)},e},{});return{schedule:l,cancel:t=>wn.forEach(e=>a[e].cancel(t)),state:r,steps:a}}("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:bn,!0),En={useVisualState:vn({scrapeMotionValuesFromProps:dn,createRenderState:rn,onMount:(t,e,n)=>{let{renderState:i,latestValues:r}=n;Sn.read(()=>{try{i.dimensions="function"===typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(rJ){i.dimensions={x:0,y:0,width:0,height:0}}}),Sn.render(()=>{nn(i,r,{enableHardwareAcceleration:!1},an(e.tagName),t.transformTemplate),un(e,i)})}})},Cn={useVisualState:vn({scrapeMotionValuesFromProps:hn,createRenderState:He})};function Pn(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}const In=t=>"mouse"===t.pointerType?"number"!==typeof t.button||t.button<=0:!1!==t.isPrimary;function Ln(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"page";return{point:{x:t[e+"X"],y:t[e+"Y"]}}}function kn(t,e,n,i){return Pn(t,e,(t=>e=>In(e)&&t(e,Ln(e)))(n),i)}const Rn=(t,e)=>n=>e(t(n)),Dn=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(Rn)};function Nn(t){let e=null;return()=>{const n=()=>{e=null};return null===e&&(e=t,n)}}const zn=Nn("dragHorizontal"),Fn=Nn("dragVertical");function On(t){let e=!1;if("y"===t)e=Fn();else if("x"===t)e=zn();else{const t=zn(),n=Fn();t&&n?e=()=>{t(),n()}:(t&&t(),n&&n())}return e}function Bn(){const t=On(!0);return!t||(t(),!1)}class Un{constructor(t){this.isMounted=!1,this.node=t}update(){}}function jn(t,e){const n="pointer"+(e?"enter":"leave"),i="onHover"+(e?"Start":"End");return kn(t.current,n,(n,r)=>{if("touch"===n.pointerType||Bn())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e),a[i]&&Sn.update(()=>a[i](n,r))},{passive:!t.getProps()[i]})}const Vn=(t,e)=>!!e&&(t===e||Vn(t,e.parentElement));function Hn(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,Ln(n))}const Gn=["root"],Wn=new WeakMap,qn=new WeakMap,Zn=t=>{const e=Wn.get(t.target);e&&e(t)},Xn=t=>{t.forEach(Zn)};function Yn(t,e,n){const i=function(t){let{root:e}=t,n=Je(t,Gn);const i=e||document;qn.has(i)||qn.set(i,{});const r=qn.get(i),a=JSON.stringify(n);return r[a]||(r[a]=new IntersectionObserver(Xn,kt({root:e},n))),r[a]}(e);return Wn.set(t,n),i.observe(t),()=>{Wn.delete(t),i.unobserve(t)}}const Kn={some:0,all:1};const Jn={inView:{Feature:class extends Un{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:e,margin:n,amount:i="some",once:r}=t,a={root:e?e.current:void 0,rootMargin:n,threshold:"number"===typeof i?i:Kn[i]};return Yn(this.node.current,a,t=>{const{isIntersecting:e}=t;if(this.isInView===e)return;if(this.isInView=e,r&&!e&&this.hasEnteredView)return;e&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",e);const{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),a=e?n:i;a&&a(t)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:t,prevProps:e}=this.node,n=["amount","margin","root"].some(function(t){let{viewport:e={}}=t,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=>e[t]!==n[t]}(t,e));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Un{constructor(){super(...arguments),this.removeStartListeners=bn,this.removeEndListeners=bn,this.removeAccessibleListeners=bn,this.startPointerPress=(t,e)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),i=kn(window,"pointerup",(t,e)=>{if(!this.checkPressEnd())return;const{onTap:n,onTapCancel:i,globalTapTarget:r}=this.node.getProps();Sn.update(()=>{r||Vn(this.node.current,t.target)?n&&n(t,e):i&&i(t,e)})},{passive:!(n.onTap||n.onPointerUp)}),r=kn(window,"pointercancel",(t,e)=>this.cancelPress(t,e),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Dn(i,r),this.startPress(t,e)},this.startAccessiblePress=()=>{const t=Pn(this.node.current,"keydown",t=>{if("Enter"!==t.key||this.isPressing)return;this.removeEndListeners(),this.removeEndListeners=Pn(this.node.current,"keyup",t=>{"Enter"===t.key&&this.checkPressEnd()&&Hn("up",(t,e)=>{const{onTap:n}=this.node.getProps();n&&Sn.update(()=>n(t,e))})}),Hn("down",(t,e)=>{this.startPress(t,e)})}),e=Pn(this.node.current,"blur",()=>{this.isPressing&&Hn("cancel",(t,e)=>this.cancelPress(t,e))});this.removeAccessibleListeners=Dn(t,e)}}startPress(t,e){this.isPressing=!0;const{onTapStart:n,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&Sn.update(()=>n(t,e))}checkPressEnd(){this.removeEndListeners(),this.isPressing=!1;return this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!Bn()}cancelPress(t,e){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&Sn.update(()=>n(t,e))}mount(){const t=this.node.getProps(),e=kn(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),n=Pn(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Dn(e,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends Un{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch(rJ){t=!0}t&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Dn(Pn(this.node.current,"focus",()=>this.onFocus()),Pn(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends Un{mount(){this.unmount=Dn(jn(this.node,!0),jn(this.node,!1))}unmount(){}}}};function $n(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Qn(t,e,n){const i=t.getProps();return pn(i,e,void 0!==n?n:i.custom,function(t){const e={};return t.values.forEach((t,n)=>e[n]=t.get()),e}(t),function(t){const e={};return t.values.forEach((t,n)=>e[n]=t.getVelocity()),e}(t))}let ti=bn,ei=bn;const ni=t=>1e3*t,ii=t=>t/1e3,ri=!1,ai=t=>Array.isArray(t)&&"number"===typeof t[0];function oi(t){return Boolean(!t||"string"===typeof t&&li[t]||ai(t)||Array.isArray(t)&&t.every(oi))}const si=t=>{let[e,n,i,r]=t;return"cubic-bezier(".concat(e,", ").concat(n,", ").concat(i,", ").concat(r,")")},li={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:si([0,.65,.55,1]),circOut:si([.55,0,1,.45]),backIn:si([.31,.01,.66,-.59]),backOut:si([.33,1.53,.69,.99])};function ci(t){if(t)return ai(t)?si(t):Array.isArray(t)?t.map(ci):li[t]}const ui=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t;function hi(t,e,n,i){if(t===e&&n===i)return bn;const r=e=>function(t,e,n,i,r){let a,o,s=0;do{o=e+(n-e)/2,a=ui(o,i,r)-t,a>0?n=o:e=o}while(Math.abs(a)>1e-7&&++s<12);return o}(e,0,1,t,n);return t=>0===t||1===t?t:ui(r(t),e,i)}const di=hi(.42,0,1,1),pi=hi(0,0,.58,1),fi=hi(.42,0,.58,1),mi=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,gi=t=>e=>1-t(1-e),yi=t=>1-Math.sin(Math.acos(t)),vi=gi(yi),_i=mi(yi),bi=hi(.33,1.53,.69,.99),xi=gi(bi),wi=mi(xi),Si={linear:bn,easeIn:di,easeInOut:fi,easeOut:pi,circIn:yi,circInOut:_i,circOut:vi,backIn:xi,backInOut:wi,backOut:bi,anticipate:t=>(t*=2)<1?.5*xi(t):.5*(2-Math.pow(2,-10*(t-1)))},Mi=t=>{if(Array.isArray(t)){ei(4===t.length,"Cubic bezier arrays must contain four numerical values.");const[e,n,i,r]=t;return hi(e,n,i,r)}return"string"===typeof t?(ei(void 0!==Si[t],"Invalid easing type '".concat(t,"'")),Si[t]):t},Ti=(t,e)=>n=>Boolean(ke(n)&&Le.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),Ai=(t,e,n)=>i=>{if(!ke(i))return i;const[r,a,o,s]=i.match(Pe);return{[t]:parseFloat(r),[e]:parseFloat(a),[n]:parseFloat(o),alpha:void 0!==s?parseFloat(s):1}},Ei=kt(kt({},Te),{},{transform:t=>Math.round((t=>Me(0,255,t))(t))}),Ci={test:Ti("rgb","red"),parse:Ai("red","green","blue"),transform:t=>{let{red:e,green:n,blue:i,alpha:r=1}=t;return"rgba("+Ei.transform(e)+", "+Ei.transform(n)+", "+Ei.transform(i)+", "+Ce(Ae.transform(r))+")"}};const Pi={test:Ti("#"),parse:function(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Ci.transform},Ii={test:Ti("hsl","hue"),parse:Ai("hue","saturation","lightness"),transform:t=>{let{hue:e,saturation:n,lightness:i,alpha:r=1}=t;return"hsla("+Math.round(e)+", "+Ne.transform(Ce(n))+", "+Ne.transform(Ce(i))+", "+Ce(Ae.transform(r))+")"}},Li={test:t=>Ci.test(t)||Pi.test(t)||Ii.test(t),parse:t=>Ci.test(t)?Ci.parse(t):Ii.test(t)?Ii.parse(t):Pi.parse(t),transform:t=>ke(t)?t:t.hasOwnProperty("red")?Ci.transform(t):Ii.transform(t)},ki=(t,e,n)=>-n*t+n*e+t;function Ri(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}const Di=(t,e,n)=>{const i=t*t;return Math.sqrt(Math.max(0,n*(e*e-i)+i))},Ni=[Pi,Ci,Ii];function zi(t){const e=(t=>Ni.find(e=>e.test(t)))(t);ei(Boolean(e),"'".concat(t,"' is not an animatable color. Use the equivalent color code instead."));let n=e.parse(t);return e===Ii&&(n=function(t){let{hue:e,saturation:n,lightness:i,alpha:r}=t;e/=360,n/=100,i/=100;let a=0,o=0,s=0;if(n){const t=i<.5?i*(1+n):i+n-i*n,r=2*i-t;a=Ri(r,t,e+1/3),o=Ri(r,t,e),s=Ri(r,t,e-1/3)}else a=o=s=i;return{red:Math.round(255*a),green:Math.round(255*o),blue:Math.round(255*s),alpha:r}}(n)),n}const Fi=(t,e)=>{const n=zi(t),i=zi(e),r=kt({},n);return t=>(r.red=Di(n.red,i.red,t),r.green=Di(n.green,i.green,t),r.blue=Di(n.blue,i.blue,t),r.alpha=ki(n.alpha,i.alpha,t),Ci.transform(r))};const Oi={regex:/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,countKey:"Vars",token:"${v}",parse:bn},Bi={regex:Ie,countKey:"Colors",token:"${c}",parse:Li.parse},Ui={regex:Pe,countKey:"Numbers",token:"${n}",parse:Te.parse};function ji(t,e){let{regex:n,countKey:i,token:r,parse:a}=e;const o=t.tokenised.match(n);o&&(t["num"+i]=o.length,t.tokenised=t.tokenised.replace(n,r),t.values.push(...o.map(a)))}function Vi(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&ji(n,Oi),ji(n,Bi),ji(n,Ui),n}function Hi(t){return Vi(t).values}function Gi(t){const{values:e,numColors:n,numVars:i,tokenised:r}=Vi(t),a=e.length;return t=>{let e=r;for(let r=0;r<a;r++)e=r<i?e.replace(Oi.token,t[r]):r<i+n?e.replace(Bi.token,Li.transform(t[r])):e.replace(Ui.token,Ce(t[r]));return e}}const Wi=t=>"number"===typeof t?0:t;const qi={test:function(t){var e,n;return isNaN(t)&&ke(t)&&((null===(e=t.match(Pe))||void 0===e?void 0:e.length)||0)+((null===(n=t.match(Ie))||void 0===n?void 0:n.length)||0)>0},parse:Hi,createTransformer:Gi,getAnimatableNone:function(t){const e=Hi(t);return Gi(t)(e.map(Wi))}},Zi=(t,e)=>n=>"".concat(n>0?e:t);function Xi(t,e){return"number"===typeof t?n=>ki(t,e,n):Li.test(t)?Fi(t,e):t.startsWith("var(")?Zi(t,e):Ji(t,e)}const Yi=(t,e)=>{const n=[...t],i=n.length,r=t.map((t,n)=>Xi(t,e[n]));return t=>{for(let e=0;e<i;e++)n[e]=r[e](t);return n}},Ki=(t,e)=>{const n=kt(kt({},t),e),i={};for(const r in n)void 0!==t[r]&&void 0!==e[r]&&(i[r]=Xi(t[r],e[r]));return t=>{for(const e in i)n[e]=i[e](t);return n}},Ji=(t,e)=>{const n=qi.createTransformer(e),i=Vi(t),r=Vi(e);return i.numVars===r.numVars&&i.numColors===r.numColors&&i.numNumbers>=r.numNumbers?Dn(Yi(i.values,r.values),n):(ti(!0,"Complex values '".concat(t,"' and '").concat(e,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.")),Zi(t,e))},$i=(t,e,n)=>{const i=e-t;return 0===i?1:(n-t)/i},Qi=(t,e)=>n=>ki(t,e,n);function tr(t,e,n){const i=[],r=n||function(t){return"number"===typeof t?Qi:"string"===typeof t?Li.test(t)?Fi:Ji:Array.isArray(t)?Yi:"object"===typeof t?Ki:Qi}(t[0]),a=t.length-1;for(let o=0;o<a;o++){let n=r(t[o],t[o+1]);if(e){const t=Array.isArray(e)?e[o]||bn:e;n=Dn(t,n)}i.push(n)}return i}function er(t,e){let{clamp:n=!0,ease:i,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=t.length;if(ei(a===e.length,"Both input and output ranges must be the same length"),1===a)return()=>e[0];t[0]>t[a-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=tr(e,i,r),s=o.length,l=e=>{let n=0;if(s>1)for(;n<t.length-2&&!(e<t[n+1]);n++);const i=$i(t[n],t[n+1],e);return o[n](i)};return n?e=>l(Me(t[0],t[a-1],e)):l}function nr(t){const e=[0];return function(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=$i(0,e,i);t.push(ki(n,1,r))}}(e,t.length-1),e}function ir(t){let{duration:e=300,keyframes:n,times:i,ease:r="easeInOut"}=t;const a=(t=>Array.isArray(t)&&"number"!==typeof t[0])(r)?r.map(Mi):Mi(r),o={done:!1,value:n[0]},s=function(t,e){return t.map(t=>t*e)}(i&&i.length===n.length?i:nr(n),e),l=er(s,n,{ease:Array.isArray(a)?a:(c=n,u=a,c.map(()=>u||fi).splice(0,c.length-1))});var c,u;return{calculatedDuration:e,next:t=>(o.value=l(t),o.done=t>=e,o)}}function rr(t,e){return e?t*(1e3/e):0}function ar(t,e,n){const i=Math.max(e-5,0);return rr(n-t(i),e-i)}const or=.001;function sr(t){let e,n,{duration:i=800,bounce:r=.25,velocity:a=0,mass:o=1}=t;ti(i<=ni(10),"Spring duration must be 10 seconds or less");let s=1-r;s=Me(.05,1,s),i=Me(.01,10,ii(i)),s<1?(e=t=>{const e=t*s,n=e*i,r=e-a,o=cr(t,s),l=Math.exp(-n);return or-r/o*l},n=t=>{const n=t*s*i,r=n*a+a,o=Math.pow(s,2)*Math.pow(t,2)*i,l=Math.exp(-n),c=cr(Math.pow(t,2),s);return(-e(t)+or>0?-1:1)*((r-o)*l)/c}):(e=t=>Math.exp(-t*i)*((t-a)*i+1)-.001,n=t=>Math.exp(-t*i)*(i*i*(a-t)));const l=function(t,e,n){let i=n;for(let r=1;r<lr;r++)i-=t(i)/e(i);return i}(e,n,5/i);if(i=ni(i),isNaN(l))return{stiffness:100,damping:10,duration:i};{const t=Math.pow(l,2)*o;return{stiffness:t,damping:2*s*Math.sqrt(o*t),duration:i}}}const lr=12;function cr(t,e){return t*Math.sqrt(1-e*e)}const ur=["keyframes","restDelta","restSpeed"],hr=["duration","bounce"],dr=["stiffness","damping","mass"];function pr(t,e){return e.some(e=>void 0!==t[e])}function fr(t){let{keyframes:e,restDelta:n,restSpeed:i}=t,r=Je(t,ur);const a=e[0],o=e[e.length-1],s={done:!1,value:a},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:p}=function(t){let e=kt({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},t);if(!pr(t,dr)&&pr(t,hr)){const n=sr(t);e=kt(kt(kt({},e),n),{},{mass:1}),e.isResolvedFromDuration=!0}return e}(kt(kt({},r),{},{velocity:-ii(r.velocity||0)})),f=d||0,m=c/(2*Math.sqrt(l*u)),g=o-a,y=ii(Math.sqrt(l/u)),v=Math.abs(g)<5;let _;if(i||(i=v?.01:2),n||(n=v?.005:.5),m<1){const t=cr(y,m);_=e=>{const n=Math.exp(-m*y*e);return o-n*((f+m*y*g)/t*Math.sin(t*e)+g*Math.cos(t*e))}}else if(1===m)_=t=>o-Math.exp(-y*t)*(g+(f+y*g)*t);else{const t=y*Math.sqrt(m*m-1);_=e=>{const n=Math.exp(-m*y*e),i=Math.min(t*e,300);return o-n*((f+m*y*g)*Math.sinh(i)+t*g*Math.cosh(i))/t}}return{calculatedDuration:p&&h||null,next:t=>{const e=_(t);if(p)s.done=t>=h;else{let r=f;0!==t&&(r=m<1?ar(_,t,e):0);const a=Math.abs(r)<=i,l=Math.abs(o-e)<=n;s.done=a&&l}return s.value=s.done?o:e,s}}}function mr(t){let{keyframes:e,velocity:n=0,power:i=.8,timeConstant:r=325,bounceDamping:a=10,bounceStiffness:o=500,modifyTarget:s,min:l,max:c,restDelta:u=.5,restSpeed:h}=t;const d=e[0],p={done:!1,value:d},f=t=>void 0===l?c:void 0===c||Math.abs(l-t)<Math.abs(c-t)?l:c;let m=i*n;const g=d+m,y=void 0===s?g:s(g);y!==g&&(m=y-d);const v=t=>-m*Math.exp(-t/r),_=t=>y+v(t),b=t=>{const e=v(t),n=_(t);p.done=Math.abs(e)<=u,p.value=p.done?y:n};let x,w;const S=t=>{(t=>void 0!==l&&t<l||void 0!==c&&t>c)(p.value)&&(x=t,w=fr({keyframes:[p.value,f(p.value)],velocity:ar(_,t,p.value),damping:a,stiffness:o,restDelta:u,restSpeed:h}))};return S(0),{calculatedDuration:null,next:t=>{let e=!1;return w||void 0!==x||(e=!0,b(t),S(t)),void 0!==x&&t>x?w.next(t-x):(!e&&b(t),p)}}}const gr=t=>{const e=e=>{let{timestamp:n}=e;return t(n)};return{start:()=>Sn.update(e,!0),stop:()=>Mn(e),now:()=>Tn.isProcessing?Tn.timestamp:performance.now()}};function yr(t){let e=0;let n=t.next(e);for(;!n.done&&e<2e4;)e+=50,n=t.next(e);return e>=2e4?1/0:e}const vr=["autoplay","delay","driver","keyframes","type","repeat","repeatDelay","repeatType","onPlay","onStop","onComplete","onUpdate"],_r={decay:mr,inertia:mr,tween:ir,keyframes:ir,spring:fr};function br(t){let e,n,{autoplay:i=!0,delay:r=0,driver:a=gr,keyframes:o,type:s="keyframes",repeat:l=0,repeatDelay:c=0,repeatType:u="loop",onPlay:h,onStop:d,onComplete:p,onUpdate:f}=t,m=Je(t,vr),g=1,y=!1;const v=()=>{n=new Promise(t=>{e=t})};let _;v();const b=_r[s]||ir;let x;b!==ir&&"number"!==typeof o[0]&&(x=er([0,100],o,{clamp:!1}),o=[0,100]);const w=b(kt(kt({},m),{},{keyframes:o}));let S;"mirror"===u&&(S=b(kt(kt({},m),{},{keyframes:[...o].reverse(),velocity:-(m.velocity||0)})));let M="idle",T=null,A=null,E=null;null===w.calculatedDuration&&l&&(w.calculatedDuration=yr(w));const{calculatedDuration:C}=w;let P=1/0,I=1/0;null!==C&&(P=C+c,I=P*(l+1)-c);let L=0;const k=t=>{if(null===A)return;g>0&&(A=Math.min(A,t)),g<0&&(A=Math.min(t-I/g,A)),L=null!==T?T:Math.round(t-A)*g;const e=L-r*(g>=0?1:-1),n=g>=0?e<0:e>I;L=Math.max(e,0),"finished"===M&&null===T&&(L=I);let i=L,a=w;if(l){const t=Math.min(L,I)/P;let e=Math.floor(t),n=t%1;!n&&t>=1&&(n=1),1===n&&e--,e=Math.min(e,l+1);Boolean(e%2)&&("reverse"===u?(n=1-n,c&&(n-=c/P)):"mirror"===u&&(a=S)),i=Me(0,1,n)*P}const s=n?{done:!1,value:o[0]}:a.next(i);x&&(s.value=x(s.value));let{done:h}=s;n||null===C||(h=g>=0?L>=I:L<=0);const d=null===T&&("finished"===M||"running"===M&&h);return f&&f(s.value),d&&N(),s},R=()=>{_&&_.stop(),_=void 0},D=()=>{M="idle",R(),e(),v(),A=E=null},N=()=>{M="finished",p&&p(),R(),e()},z=()=>{if(y)return;_||(_=a(k));const t=_.now();h&&h(),null!==T?A=t-T:A&&"finished"!==M||(A=t),"finished"===M&&v(),E=A,T=null,M="running",_.start()};i&&z();const F={then:(t,e)=>n.then(t,e),get time(){return ii(L)},set time(t){t=ni(t),L=t,null===T&&_&&0!==g?A=_.now()-t/g:T=t},get duration(){const t=null===w.calculatedDuration?yr(w):w.calculatedDuration;return ii(t)},get speed(){return g},set speed(t){t!==g&&_&&(g=t,F.time=ii(L))},get state(){return M},play:z,pause:()=>{M="paused",T=L},stop:()=>{y=!0,"idle"!==M&&(M="idle",d&&d(),D())},cancel:()=>{null!==E&&k(E),D()},complete:()=>{M="finished"},sample:t=>(A=0,k(t))};return F}const xr=["onUpdate","onComplete"],wr=function(t){let e;return()=>(void 0===e&&(e=t()),e)}(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Sr=new Set(["opacity","clipPath","filter","transform","backgroundColor"]);function Mr(t,e,n){let{onUpdate:i,onComplete:r}=n,a=Je(n,xr);if(!(wr()&&Sr.has(e)&&!a.repeatDelay&&"mirror"!==a.repeatType&&0!==a.damping&&"inertia"!==a.type))return!1;let o,s,l=!1,c=!1;const u=()=>{s=new Promise(t=>{o=t})};u();let{keyframes:h,duration:d=300,ease:p,times:f}=a;if(((t,e)=>"spring"===e.type||"backgroundColor"===t||!oi(e.ease))(e,a)){const t=br(kt(kt({},a),{},{repeat:0,delay:0}));let e={done:!1,value:h[0]};const n=[];let i=0;for(;!e.done&&i<2e4;)e=t.sample(i),n.push(e.value),i+=10;f=void 0,h=n,d=i-10,p="linear"}const m=function(t,e,n){let{delay:i=0,duration:r,repeat:a=0,repeatType:o="loop",ease:s,times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[e]:n};l&&(c.offset=l);const u=ci(s);return Array.isArray(u)&&(c.easing=u),t.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"})}(t.owner.current,e,h,kt(kt({},a),{},{duration:d,ease:p,times:f})),g=()=>{c=!1,m.cancel()},y=()=>{c=!0,Sn.update(g),o(),u()};m.onfinish=()=>{c||(t.set(function(t,e){let{repeat:n,repeatType:i="loop"}=e;return t[n&&"loop"!==i&&n%2===1?0:t.length-1]}(h,a)),r&&r(),y())};const v={then:(t,e)=>s.then(t,e),attachTimeline:t=>(m.timeline=t,m.onfinish=null,bn),get time(){return ii(m.currentTime||0)},set time(t){m.currentTime=ni(t)},get speed(){return m.playbackRate},set speed(t){m.playbackRate=t},get duration(){return ii(d)},play:()=>{l||(m.play(),Mn(g))},pause:()=>m.pause(),stop:()=>{if(l=!0,"idle"===m.playState)return;const{currentTime:e}=m;if(e){const n=br(kt(kt({},a),{},{autoplay:!1}));t.setWithVelocity(n.sample(e-10).value,n.sample(e).value,10)}y()},complete:()=>{c||m.finish()},cancel:y};return v}const Tr={type:"spring",stiffness:500,damping:25,restSpeed:10},Ar={type:"keyframes",duration:.8},Er={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Cr=(t,e)=>{let{keyframes:n}=e;return n.length>2?Ar:me.has(t)?t.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Tr:Er},Pr=(t,e)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!qi.test(e)&&"0"!==e||e.startsWith("url("))),Ir=new Set(["brightness","contrast","saturate","opacity"]);function Lr(t){const[e,n]=t.slice(0,-1).split("(");if("drop-shadow"===e)return t;const[i]=n.match(Pe)||[];if(!i)return t;const r=n.replace(i,"");let a=Ir.has(e)?1:0;return i!==n&&(a*=100),e+"("+a+r+")"}const kr=/([a-z-]*)\(.*?\)/g,Rr=kt(kt({},qi),{},{getAnimatableNone:t=>{const e=t.match(kr);return e?e.map(Lr).join(" "):t}}),Dr=kt(kt({},je),{},{color:Li,backgroundColor:Li,outlineColor:Li,fill:Li,stroke:Li,borderColor:Li,borderTopColor:Li,borderRightColor:Li,borderBottomColor:Li,borderLeftColor:Li,filter:Rr,WebkitFilter:Rr}),Nr=t=>Dr[t];function zr(t,e){let n=Nr(t);return n!==Rr&&(n=qi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const Fr=t=>/^0[^.\s]+$/.test(t);function Or(t){return"number"===typeof t?0===t:null!==t?"none"===t||"0"===t||Fr(t):void 0}const Br=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];function Ur(t,e){return t[e]||t.default||t}const jr=!1,Vr=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r=>{const a=Ur(i,t)||{},o=a.delay||i.delay||0;let{elapsed:s=0}=i;s-=ni(o);const l=function(t,e,n,i){const r=Pr(e,n);let a;a=Array.isArray(n)?[...n]:[null,n];const o=void 0!==i.from?i.from:t.get();let s;const l=[];for(let c=0;c<a.length;c++)null===a[c]&&(a[c]=0===c?o:a[c-1]),Or(a[c])&&l.push(c),"string"===typeof a[c]&&"none"!==a[c]&&"0"!==a[c]&&(s=a[c]);if(r&&l.length&&s)for(let c=0;c<l.length;c++)a[l[c]]=zr(e,s);return a}(e,t,n,a),c=l[0],u=l[l.length-1],h=Pr(t,c),d=Pr(t,u);ti(h===d,"You are trying to animate ".concat(t,' from "').concat(c,'" to "').concat(u,'". ').concat(c," is not an animatable value - to enable this animation set ").concat(c," to a value animatable to ").concat(u," via the `style` property."));let p=kt(kt({keyframes:l,velocity:e.getVelocity(),ease:"easeOut"},a),{},{delay:-s,onUpdate:t=>{e.set(t),a.onUpdate&&a.onUpdate(t)},onComplete:()=>{r(),a.onComplete&&a.onComplete()}});if(function(t){let{when:e,delay:n,delayChildren:i,staggerChildren:r,staggerDirection:a,repeat:o,repeatType:s,repeatDelay:l,from:c,elapsed:u}=t,h=Je(t,Br);return!!Object.keys(h).length}(a)||(p=kt(kt({},p),Cr(t,p))),p.duration&&(p.duration=ni(p.duration)),p.repeatDelay&&(p.repeatDelay=ni(p.repeatDelay)),!h||!d||ri||!1===a.type||jr)return function(t){let{keyframes:e,delay:n,onUpdate:i,onComplete:r}=t;const a=()=>(i&&i(e[e.length-1]),r&&r(),{time:0,speed:1,duration:0,play:bn,pause:bn,stop:bn,then:t=>(t(),Promise.resolve()),cancel:bn,complete:bn});return n?br({keyframes:[0,1],duration:0,delay:n,onComplete:a}):a()}(ri?kt(kt({},p),{},{delay:0}):p);if(!i.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const n=Mr(e,t,p);if(n)return n}return br(p)}};function Hr(t){return Boolean(ye(t)&&t.add)}const Gr=t=>/^\-?\d*\.?\d+$/.test(t);function Wr(t,e){-1===t.indexOf(e)&&t.push(e)}function qr(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Zr{constructor(){this.subscriptions=[]}add(t){return Wr(this.subscriptions,t),()=>qr(this.subscriptions,t)}notify(t,e,n){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](t,e,n);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(t,e,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Xr={current:void 0};class Yr{constructor(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.prev=e.current,e.current=t;const{delta:i,timestamp:r}=Tn;e.lastUpdated!==r&&(e.timeDelta=i,e.lastUpdated=r,Sn.postRender(e.scheduleVelocityCheck)),e.prev!==e.current&&e.events.change&&e.events.change.notify(e.current),e.events.velocityChange&&e.events.velocityChange.notify(e.getVelocity()),n&&e.events.renderRequest&&e.events.renderRequest.notify(e.current)},this.scheduleVelocityCheck=()=>Sn.postRender(this.velocityCheck),this.velocityCheck=t=>{let{timestamp:e}=t;e!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=(i=this.current,!isNaN(parseFloat(i))),this.owner=n.owner}onChange(t){return this.on("change",t)}on(t,e){this.events[t]||(this.events[t]=new Zr);const n=this.events[t].add(e);return"change"===t?()=>{n(),Sn.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t,e)}setWithVelocity(t,e,n){this.set(e),this.prev=t,this.timeDelta=n}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Xr.current&&Xr.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?rr(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Kr(t,e){return new Yr(t,e)}const Jr=t=>e=>e.test(t),$r=[Te,ze,Ne,De,Oe,Fe,{test:t=>"auto"===t,parse:t=>t}],Qr=t=>$r.find(Jr(t)),ta=[...$r,Li,qi],ea=t=>ta.find(Jr(t)),na=["transitionEnd","transition"];function ia(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Kr(n))}function ra(t,e){const n=Qn(t,e);let i=n?t.makeTargetAnimatable(n,!1):{},{transitionEnd:r={},transition:a={}}=i,o=Je(i,na);o=kt(kt({},o),r);for(const s in o){ia(t,s,mn(o[s]))}}function aa(t,e){if(!e)return;return(e[t]||e.default||e).from}const oa=["transition","transitionEnd"];function sa(t,e){let{protectedKeys:n,needsAnimating:i}=t;const r=n.hasOwnProperty(e)&&!0!==i[e];return i[e]=!1,r}function la(t,e){const n=t.get();if(!Array.isArray(e))return n!==e;for(let i=0;i<e.length;i++)if(e[i]!==n)return!0}function ca(t,e){let{delay:n=0,transitionOverride:i,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.makeTargetAnimatable(e),{transition:o=t.getDefaultTransition(),transitionEnd:s}=a,l=Je(a,oa);const c=t.getValue("willChange");i&&(o=i);const u=[],h=r&&t.animationState&&t.animationState.getState()[r];for(const d in l){const e=t.getValue(d),i=l[d];if(!e||void 0===i||h&&sa(h,d))continue;const r=kt({delay:n,elapsed:0},Ur(o||{},d));if(window.HandoffAppearAnimations){const n=t.getProps()[Zt];if(n){const t=window.HandoffAppearAnimations(n,d,e,Sn);null!==t&&(r.elapsed=t,r.isHandoff=!0)}}let a=!r.isHandoff&&!la(e,i);if("spring"===r.type&&(e.getVelocity()||r.velocity)&&(a=!1),e.animation&&(a=!1),a)continue;e.start(Vr(d,e,i,t.shouldReduceMotion&&me.has(d)?{type:!1}:r));const s=e.animation;Hr(c)&&(c.add(d),s.then(()=>c.remove(d))),u.push(s)}return s&&Promise.all(u).then(()=>{s&&ra(t,s)}),u}function ua(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=Qn(t,e,n.custom);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const a=i?()=>Promise.all(ca(t,i,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:a=0,staggerChildren:o,staggerDirection:s}=r;return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5?arguments[5]:void 0;const o=[],s=(t.variantChildren.size-1)*i,l=1===r?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i}:function(){return s-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i};return Array.from(t.variantChildren).sort(ha).forEach((t,i)=>{t.notify("AnimationStart",e),o.push(ua(t,e,kt(kt({},a),{},{delay:n+l(i)})).then(()=>t.notify("AnimationComplete",e)))}),Promise.all(o)}(t,e,a+i,o,s,n)}:()=>Promise.resolve(),{when:s}=r;if(s){const[t,e]="beforeChildren"===s?[a,o]:[o,a];return t().then(()=>e())}return Promise.all([a(),o(n.delay)])}function ha(t,e){return t.sortNodePosition(e)}const da=["transition","transitionEnd"],pa=[...Jt].reverse(),fa=Jt.length;function ma(t){return e=>Promise.all(e.map(e=>{let{animation:n,options:i}=e;return function(t,e){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t.notify("AnimationStart",e),Array.isArray(e)){const r=e.map(e=>ua(t,e,i));n=Promise.all(r)}else if("string"===typeof e)n=ua(t,e,i);else{const r="function"===typeof e?Qn(t,e,i.custom):e;n=Promise.all(ca(t,r,i))}return n.then(()=>t.notify("AnimationComplete",e))}(t,n,i)}))}function ga(t){let e=ma(t);const n={animate:va(!0),whileInView:va(),whileHover:va(),whileTap:va(),whileDrag:va(),whileFocus:va(),exit:va()};let i=!0;const r=(e,n)=>{const i=Qn(t,n);if(i){const{transition:t,transitionEnd:n}=i,r=Je(i,da);e=kt(kt(kt({},e),r),n)}return e};function a(a,o){const s=t.getProps(),l=t.getVariantContext(!0)||{},c=[],u=new Set;let h={},d=1/0;for(let e=0;e<fa;e++){const p=pa[e],f=n[p],m=void 0!==s[p]?s[p]:l[p],g=Yt(m),y=p===o?f.isActive:null;!1===y&&(d=e);let v=m===l[p]&&m!==s[p]&&g;if(v&&i&&t.manuallyAnimateOnMount&&(v=!1),f.protectedKeys=kt({},h),!f.isActive&&null===y||!m&&!f.prevProp||Kt(m)||"boolean"===typeof m)continue;let _=ya(f.prevProp,m)||p===o&&f.isActive&&!v&&g||e>d&&g,b=!1;const x=Array.isArray(m)?m:[m];let w=x.reduce(r,{});!1===y&&(w={});const{prevResolvedValues:S={}}=f,M=kt(kt({},S),w),T=t=>{_=!0,u.has(t)&&(b=!0,u.delete(t)),f.needsAnimating[t]=!0};for(const t in M){const e=w[t],n=S[t];if(h.hasOwnProperty(t))continue;let i=!1;i=fn(e)&&fn(n)?!$n(e,n):e!==n,i?void 0!==e?T(t):u.add(t):void 0!==e&&u.has(t)?T(t):f.protectedKeys[t]=!0}f.prevProp=m,f.prevResolvedValues=w,f.isActive&&(h=kt(kt({},h),w)),i&&t.blockInitialAnimation&&(_=!1),!_||v&&!b||c.push(...x.map(t=>({animation:t,options:kt({type:p},a)})))}if(u.size){const e={};u.forEach(n=>{const i=t.getBaseTarget(n);void 0!==i&&(e[n]=i)}),c.push({animation:e})}let p=Boolean(c.length);return!i||!1!==s.initial&&s.initial!==s.animate||t.manuallyAnimateOnMount||(p=!1),i=!1,p?e(c):Promise.resolve()}return{animateChanges:a,setActive:function(e,i,r){var o;if(n[e].isActive===i)return Promise.resolve();null===(o=t.variantChildren)||void 0===o||o.forEach(t=>{var n;return null===(n=t.animationState)||void 0===n?void 0:n.setActive(e,i)}),n[e].isActive=i;const s=a(r,e);for(const t in n)n[t].protectedKeys={};return s},setAnimateFunction:function(n){e=n(t)},getState:()=>n}}function ya(t,e){return"string"===typeof e?e!==t:!!Array.isArray(e)&&!$n(e,t)}function va(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}let _a=0;const ba={animation:{Feature:class extends Un{constructor(t){super(t),t.animationState||(t.animationState=ga(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),Kt(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:e}=this.node.prevProps||{};t!==e&&this.updateAnimationControlsSubscription()}unmount(){}}},exit:{Feature:class extends Un{constructor(){super(...arguments),this.id=_a++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:e,custom:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const r=this.node.animationState.setActive("exit",!t,{custom:null!==n&&void 0!==n?n:this.node.getProps().custom});e&&!t&&r.then(()=>e(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}}},xa=(t,e)=>Math.abs(t-e);class wa{constructor(t,e){let{transformPagePoint:n,contextWindow:i,dragSnapToOrigin:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const t=Ta(this.lastMoveEventInfo,this.history),e=null!==this.startEvent,n=function(t,e){const n=xa(t.x,e.x),i=xa(t.y,e.y);return Math.sqrt(n**2+i**2)}(t.offset,{x:0,y:0})>=3;if(!e&&!n)return;const{point:i}=t,{timestamp:r}=Tn;this.history.push(kt(kt({},i),{},{timestamp:r}));const{onStart:a,onMove:o}=this.handlers;e||(a&&a(this.lastMoveEvent,t),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,t)},this.handlePointerMove=(t,e)=>{this.lastMoveEvent=t,this.lastMoveEventInfo=Sa(e,this.transformPagePoint),Sn.update(this.updatePoint,!0)},this.handlePointerUp=(t,e)=>{this.end();const{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=Ta("pointercancel"===t.type?this.lastMoveEventInfo:Sa(e,this.transformPagePoint),this.history);this.startEvent&&n&&n(t,a),i&&i(t,a)},!In(t))return;this.dragSnapToOrigin=r,this.handlers=e,this.transformPagePoint=n,this.contextWindow=i||window;const a=Sa(Ln(t),this.transformPagePoint),{point:o}=a,{timestamp:s}=Tn;this.history=[kt(kt({},o),{},{timestamp:s})];const{onSessionStart:l}=e;l&&l(t,Ta(a,this.history)),this.removeListeners=Dn(kn(this.contextWindow,"pointermove",this.handlePointerMove),kn(this.contextWindow,"pointerup",this.handlePointerUp),kn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Mn(this.updatePoint)}}function Sa(t,e){return e?{point:e(t.point)}:t}function Ma(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Ta(t,e){let{point:n}=t;return{point:n,delta:Ma(n,Ea(e)),offset:Ma(n,Aa(e)),velocity:Ca(e,.1)}}function Aa(t){return t[0]}function Ea(t){return t[t.length-1]}function Ca(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Ea(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>ni(e)));)n--;if(!i)return{x:0,y:0};const a=ii(r.timestamp-i.timestamp);if(0===a)return{x:0,y:0};const o={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Pa(t){return t.max-t.min}function Ia(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return Math.abs(t-e)<=n}function La(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;t.origin=i,t.originPoint=ki(e.min,e.max,t.origin),t.scale=Pa(n)/Pa(e),(Ia(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=ki(n.min,n.max,t.origin)-t.originPoint,(Ia(t.translate)||isNaN(t.translate))&&(t.translate=0)}function ka(t,e,n,i){La(t.x,e.x,n.x,i?i.originX:void 0),La(t.y,e.y,n.y,i?i.originY:void 0)}function Ra(t,e,n){t.min=n.min+e.min,t.max=t.min+Pa(e)}function Da(t,e,n){t.min=e.min-n.min,t.max=t.min+Pa(e)}function Na(t,e,n){Da(t.x,e.x,n.x),Da(t.y,e.y,n.y)}function za(t,e,n){return{min:void 0!==e?t.min+e:void 0,max:void 0!==n?t.max+n-(t.max-t.min):void 0}}function Fa(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}const Oa=.35;function Ba(t,e,n){return{min:Ua(t,e),max:Ua(t,n)}}function Ua(t,e){return"number"===typeof t?t:t[e]||0}const ja=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Va(t){return[t("x"),t("y")]}function Ha(t){let{top:e,left:n,right:i,bottom:r}=t;return{x:{min:n,max:i},y:{min:e,max:r}}}function Ga(t){return void 0===t||1===t}function Wa(t){let{scale:e,scaleX:n,scaleY:i}=t;return!Ga(e)||!Ga(n)||!Ga(i)}function qa(t){return Wa(t)||Za(t)||t.z||t.rotate||t.rotateX||t.rotateY}function Za(t){return Xa(t.x)||Xa(t.y)}function Xa(t){return t&&"0%"!==t}function Ya(t,e,n){return n+e*(t-n)}function Ka(t,e,n,i,r){return void 0!==r&&(t=Ya(t,r,i)),Ya(t,n,i)+e}function Ja(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;t.min=Ka(t.min,e,n,i,r),t.max=Ka(t.max,e,n,i,r)}function $a(t,e){let{x:n,y:i}=e;Ja(t.x,n.translate,n.scale,n.originPoint),Ja(t.y,i.translate,i.scale,i.originPoint)}function Qa(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function to(t,e){t.min=t.min+e,t.max=t.max+e}function eo(t,e,n){let[i,r,a]=n;const o=void 0!==e[a]?e[a]:.5,s=ki(t.min,t.max,o);Ja(t,e[i],e[r],s,e.scale)}const no=["x","scaleX","originX"],io=["y","scaleY","originY"];function ro(t,e){eo(t.x,e,no),eo(t.y,e,io)}function ao(t,e){return Ha(function(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(t.getBoundingClientRect(),e))}const oo=t=>{let{current:e}=t;return e?e.ownerDocument.defaultView:null},so=new WeakMap;class lo{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=t}start(t){let{snapToCursor:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new wa(t,{onSessionStart:t=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),e&&this.snapToCursor(Ln(t,"page").point)},onStart:(t,e)=>{const{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=On(n),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Va(t=>{let e=this.getAxisMotionValue(t).get()||0;if(Ne.test(e)){const{projection:n}=this.visualElement;if(n&&n.layout){const i=n.layout.layoutBox[t];if(i){e=Pa(i)*(parseFloat(e)/100)}}}this.originPoint[t]=e}),r&&Sn.update(()=>r(t,e),!1,!0);const{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},onMove:(t,e)=>{const{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:a}=this.getProps();if(!n&&!this.openGlobalLock)return;const{offset:o}=e;if(i&&null===this.currentDirection)return this.currentDirection=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x");return n}(o),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",e.point,o),this.updateAxis("y",e.point,o),this.visualElement.render(),a&&a(t,e)},onSessionEnd:(t,e)=>this.stop(t,e),resumeAnimation:()=>Va(t=>{var e;return"paused"===this.getAnimationState(t)&&(null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:oo(this.visualElement)})}stop(t,e){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:i}=e;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Sn.update(()=>r(t,e))}cancel(){this.isDragging=!1;const{projection:t,animationState:e}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),e&&e.setActive("whileDrag",!1)}updateAxis(t,e,n){const{drag:i}=this.getProps();if(!n||!co(t,i,this.currentDirection))return;const r=this.getAxisMotionValue(t);let a=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(a=function(t,e,n){let{min:i,max:r}=e;return void 0!==i&&t<i?t=n?ki(i,t,n.min):Math.max(t,i):void 0!==r&&t>r&&(t=n?ki(r,t,n.max):Math.min(t,r)),t}(a,this.constraints[t],this.elastic[t])),r.set(a)}resolveConstraints(){var t;const{dragConstraints:e,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(t=this.visualElement.projection)||void 0===t?void 0:t.layout,r=this.constraints;e&&Xt(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!i)&&function(t,e){let{top:n,left:i,bottom:r,right:a}=e;return{x:za(t.x,i,a),y:za(t.y,n,r)}}(i.layoutBox,e),this.elastic=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oa;return!1===t?t=0:!0===t&&(t=Oa),{x:Ba(t,"left","right"),y:Ba(t,"top","bottom")}}(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Va(t=>{this.getAxisMotionValue(t)&&(this.constraints[t]=function(t,e){const n={};return void 0!==e.min&&(n.min=e.min-t.min),void 0!==e.max&&(n.max=e.max-t.min),n}(i.layoutBox[t],this.constraints[t]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:e}=this.getProps();if(!t||!Xt(t))return!1;const n=t.current;ei(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(t,e,n){const i=ao(t,n),{scroll:r}=e;return r&&(to(i.x,r.offset.x),to(i.y,r.offset.y)),i}(n,i.root,this.visualElement.getTransformPagePoint());let a=function(t,e){return{x:Fa(t.x,e.x),y:Fa(t.y,e.y)}}(i.layout.layoutBox,r);if(e){const t=e(function(t){let{x:e,y:n}=t;return{top:n.min,right:e.max,bottom:n.max,left:e.min}}(a));this.hasMutatedConstraints=!!t,t&&(a=Ha(t))}return a}startAnimation(t){const{drag:e,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},l=Va(o=>{if(!co(o,e,this.currentDirection))return;let l=s&&s[o]||{};a&&(l={min:0,max:0});const c=i?200:1e6,u=i?40:1e7,h=kt(kt({type:"inertia",velocity:n?t[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10},r),l);return this.startAxisValueAnimation(o,h)});return Promise.all(l).then(o)}startAxisValueAnimation(t,e){const n=this.getAxisMotionValue(t);return n.start(Vr(t,n,0,e))}stopAnimation(){Va(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Va(t=>{var e;return null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.pause()})}getAnimationState(t){var e;return null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.state}getAxisMotionValue(t){const e="_drag"+t.toUpperCase(),n=this.visualElement.getProps(),i=n[e];return i||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Va(e=>{const{drag:n}=this.getProps();if(!co(e,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(e);if(i&&i.layout){const{min:n,max:a}=i.layout.layoutBox[e];r.set(t[e]-ki(n,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:e}=this.getProps(),{projection:n}=this.visualElement;if(!Xt(e)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Va(t=>{const e=this.getAxisMotionValue(t);if(e){const n=e.get();i[t]=function(t,e){let n=.5;const i=Pa(t),r=Pa(e);return r>i?n=$i(e.min,e.max-i,t.min):i>r&&(n=$i(t.min,t.max-r,e.min)),Me(0,1,n)}({min:n,max:n},this.constraints[t])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Va(e=>{if(!co(e,t,null))return;const n=this.getAxisMotionValue(e),{min:r,max:a}=this.constraints[e];n.set(ki(r,a,i[e]))})}addListeners(){if(!this.visualElement.current)return;so.set(this.visualElement,this);const t=kn(this.visualElement.current,"pointerdown",t=>{const{drag:e,dragListener:n=!0}=this.getProps();e&&n&&this.start(t)}),e=()=>{const{dragConstraints:t}=this.getProps();Xt(t)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",e);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),e();const r=Pn(window,"resize",()=>this.scalePositionWithinConstraints()),a=n.addEventListener("didUpdate",t=>{let{delta:e,hasLayoutChanged:n}=t;this.isDragging&&n&&(Va(t=>{const n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{r(),t(),i(),a&&a()}}getProps(){const t=this.visualElement.getProps(),{drag:e=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=Oa,dragMomentum:o=!0}=t;return kt(kt({},t),{},{drag:e,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:o})}}function co(t,e,n){return(!0===e||e===t)&&(null===n||n===t)}const uo=t=>(e,n)=>{t&&Sn.update(()=>t(e,n))};const ho={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function po(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const fo={correct:(t,e)=>{if(!e.target)return t;if("string"===typeof t){if(!ze.test(t))return t;t=parseFloat(t)}const n=po(t,e.target.x),i=po(t,e.target.y);return"".concat(n,"% ").concat(i,"%")}},mo={correct:(t,e)=>{let{treeScale:n,projectionDelta:i}=e;const r=t,a=qi.parse(t);if(a.length>5)return r;const o=qi.createTransformer(t),s="number"!==typeof a[0]?1:0,l=i.x.scale*n.x,c=i.y.scale*n.y;a[0+s]/=l,a[1+s]/=c;const u=ki(l,c,.5);return"number"===typeof a[2+s]&&(a[2+s]/=u),"number"===typeof a[3+s]&&(a[3+s]/=u),o(a)}};class go extends i.Component{componentDidMount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=t;var a;a=vo,Object.assign(pe,a),r&&(e.group&&e.group.add(r),n&&n.register&&i&&n.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions(kt(kt({},r.options),{},{onExitComplete:()=>this.safeToRemove()}))),ho.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:e,visualElement:n,drag:i,isPresent:r}=this.props,a=n.projection;return a?(a.isPresent=r,i||t.layoutDependency!==e||void 0===e?a.willUpdate():this.safeToRemove(),t.isPresent!==r&&(r?a.promote():a.relegate()||Sn.postRender(()=>{const t=a.getStack();t&&t.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:n}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),e&&e.group&&e.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function yo(t){const[e,n]=function(){const t=(0,i.useContext)(Vt);if(null===t)return[!0,null];const{isPresent:e,onExitComplete:n,register:r}=t,a=(0,i.useId)();return(0,i.useEffect)(()=>r(a),[]),!e&&n?[!1,()=>n&&n(a)]:[!0]}(),r=(0,i.useContext)(ae);return i.createElement(go,kt(kt({},t),{},{layoutGroup:r,switchLayoutGroup:(0,i.useContext)(oe),isPresent:e,safeToRemove:n}))}const vo={borderRadius:kt(kt({},fo),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:fo,borderTopRightRadius:fo,borderBottomLeftRadius:fo,borderBottomRightRadius:fo,boxShadow:mo},_o=["TopLeft","TopRight","BottomLeft","BottomRight"],bo=_o.length,xo=t=>"string"===typeof t?parseFloat(t):t,wo=t=>"number"===typeof t||ze.test(t);function So(t,e){return void 0!==t[e]?t[e]:t.borderRadius}const Mo=Ao(0,.5,vi),To=Ao(.5,.95,bn);function Ao(t,e,n){return i=>i<t?0:i>e?1:n($i(t,e,i))}function Eo(t,e){t.min=e.min,t.max=e.max}function Co(t,e){Eo(t.x,e.x),Eo(t.y,e.y)}function Po(t,e,n,i,r){return t=Ya(t-=e,1/n,i),void 0!==r&&(t=Ya(t,1/r,i)),t}function Io(t,e,n,i,r){let[a,o,s]=n;!function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t;Ne.test(e)&&(e=parseFloat(e),e=ki(o.min,o.max,e/100)-o.min);if("number"!==typeof e)return;let s=ki(a.min,a.max,i);t===a&&(s-=e),t.min=Po(t.min,e,n,s,r),t.max=Po(t.max,e,n,s,r)}(t,e[a],e[o],e[s],e.scale,i,r)}const Lo=["x","scaleX","originX"],ko=["y","scaleY","originY"];function Ro(t,e,n,i){Io(t.x,e,Lo,n?n.x:void 0,i?i.x:void 0),Io(t.y,e,ko,n?n.y:void 0,i?i.y:void 0)}function Do(t){return 0===t.translate&&1===t.scale}function No(t){return Do(t.x)&&Do(t.y)}function zo(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function Fo(t){return Pa(t.x)/Pa(t.y)}class Oo{constructor(){this.members=[]}add(t){Wr(this.members,t),t.scheduleRender()}remove(t){if(qr(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(t){const e=this.members.findIndex(e=>t===e);if(0===e)return!1;let n;for(let i=e;i>=0;i--){const t=this.members[i];if(!1!==t.isPresent){n=t;break}}return!!n&&(this.promote(n),!0)}promote(t,e){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,e&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:e,resumingFrom:n}=t;e.onExitComplete&&e.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Bo(t,e,n){let i="";const r=t.x.translate/e.x,a=t.y.translate/e.y;if((r||a)&&(i="translate3d(".concat(r,"px, ").concat(a,"px, 0) ")),1===e.x&&1===e.y||(i+="scale(".concat(1/e.x,", ").concat(1/e.y,") ")),n){const{rotate:t,rotateX:e,rotateY:r}=n;t&&(i+="rotate(".concat(t,"deg) ")),e&&(i+="rotateX(".concat(e,"deg) ")),r&&(i+="rotateY(".concat(r,"deg) "))}const o=t.x.scale*e.x,s=t.y.scale*e.y;return 1===o&&1===s||(i+="scale(".concat(o,", ").concat(s,")")),i||"none"}const Uo=(t,e)=>t.depth-e.depth;class jo{constructor(){this.children=[],this.isDirty=!1}add(t){Wr(this.children,t),this.isDirty=!0}remove(t){qr(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Uo),this.isDirty=!1,this.children.forEach(t)}}const Vo=["","X","Y","Z"],Ho={visibility:"hidden"};let Go=0;const Wo={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function qo(t){let{attachResizeListener:e,defaultParent:n,measureScroll:i,checkIsScrollRoot:r,resetTransform:a}=t;return class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=Go++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Wo.totalNodes=Wo.resolvedTargetDeltas=Wo.recalculatedProjection=0,this.nodes.forEach(Yo),this.nodes.forEach(ns),this.nodes.forEach(is),this.nodes.forEach(Ko),function(t){window.MotionDebug&&window.MotionDebug.record(t)}(Wo)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=t,this.root=e?e.root||e:this,this.path=e?[...e.path,e]:[],this.parent=e,this.depth=e?e.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new jo)}addEventListener(t,e){return this.eventHandlers.has(t)||this.eventHandlers.set(t,new Zr),this.eventHandlers.get(t).add(e)}notifyListeners(t){const e=this.eventHandlers.get(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e&&e.notify(...i)}hasListeners(t){return this.eventHandlers.has(t)}mount(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var i;this.isSVG=(i=t)instanceof SVGElement&&"svg"!==i.tagName,this.instance=t;const{layoutId:r,layout:a,visualElement:o}=this.options;if(o&&!o.current&&o.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(a||r)&&(this.isLayoutDirty=!0),e){let n;const i=()=>this.root.updateBlockedByResize=!1;e(t,()=>{this.root.updateBlockedByResize=!0,n&&n(),n=function(t,e){const n=performance.now(),i=r=>{let{timestamp:a}=r;const o=a-n;o>=e&&(Mn(i),t(o-e))};return Sn.read(i,!0),()=>Mn(i)}(i,250),ho.hasAnimatedSinceResize&&(ho.hasAnimatedSinceResize=!1,this.nodes.forEach(es))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&o&&(r||a)&&this.addEventListener("didUpdate",t=>{let{delta:e,hasLayoutChanged:n,hasRelativeTargetChanged:i,layout:r}=t;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const a=this.options.transition||o.getDefaultTransition()||cs,{onLayoutAnimationStart:s,onLayoutAnimationComplete:l}=o.getProps(),c=!this.targetLayout||!zo(this.targetLayout,r)||i,u=!n&&i;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||u||n&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,u);const t=kt(kt({},Ur(a,"layout")),{},{onPlay:s,onComplete:l});(o.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else n||es(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const t=this.getStack();t&&t.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Mn(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(rs),this.animationId++)}getTransformTemplate(){const{visualElement:t}=this.options;return t&&t.getProps().transformTemplate}willUpdate(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const t=this.path[r];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}const{layoutId:e,layout:n}=this.options;if(void 0===e&&!n)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),t&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach($o);this.isUpdating||this.nodes.forEach(Qo),this.isUpdating=!1,this.nodes.forEach(ts),this.nodes.forEach(Zo),this.nodes.forEach(Xo),this.clearAllSnapshots();const t=performance.now();Tn.delta=Me(0,1e3/60,t-Tn.timestamp),Tn.timestamp=t,Tn.isProcessing=!0,An.update.process(Tn),An.preRender.process(Tn),An.render.process(Tn),Tn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Jo),this.sharedNodes.forEach(as)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Sn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Sn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const t=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:e}=this.options;e&&e.notify("LayoutMeasure",this.layout.layoutBox,t?t.layoutBox:void 0)}updateScroll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",e=Boolean(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===t&&(e=!1),e&&(this.scroll={animationId:this.root.animationId,phase:t,isRoot:r(this.instance),offset:i(this.instance)})}resetTransform(){if(!a)return;const t=this.isLayoutDirty||this.shouldResetTransform,e=this.projectionDelta&&!No(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,r=i!==this.prevTransformTemplateValue;t&&(e||qa(this.latestValues)||r)&&(a(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.measurePageBox();let n=this.removeElementScroll(e);var i;return t&&(n=this.removeTransform(n)),ds((i=n).x),ds(i.y),{animationId:this.root.animationId,measuredBox:e,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const e=t.measureViewportBox(),{scroll:n}=this.root;return n&&(to(e.x,n.offset.x),to(e.y,n.offset.y)),e}removeElementScroll(t){const e={x:{min:0,max:0},y:{min:0,max:0}};Co(e,t);for(let n=0;n<this.path.length;n++){const i=this.path[n],{scroll:r,options:a}=i;if(i!==this.root&&r&&a.layoutScroll){if(r.isRoot){Co(e,t);const{scroll:n}=this.root;n&&(to(e.x,-n.offset.x),to(e.y,-n.offset.y))}to(e.x,r.offset.x),to(e.y,r.offset.y)}}return e}applyTransform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};Co(n,t);for(let i=0;i<this.path.length;i++){const t=this.path[i];!e&&t.options.layoutScroll&&t.scroll&&t!==t.root&&ro(n,{x:-t.scroll.offset.x,y:-t.scroll.offset.y}),qa(t.latestValues)&&ro(n,t.latestValues)}return qa(this.latestValues)&&ro(n,this.latestValues),n}removeTransform(t){const e={x:{min:0,max:0},y:{min:0,max:0}};Co(e,t);for(let n=0;n<this.path.length;n++){const t=this.path[n];if(!t.instance)continue;if(!qa(t.latestValues))continue;Wa(t.latestValues)&&t.updateSnapshot();const i=ja();Co(i,t.measurePageBox()),Ro(e,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,i)}return qa(this.latestValues)&&Ro(e,this.latestValues),e}setTargetDelta(t){this.targetDelta=t,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(t){this.options=kt(kt(kt({},this.options),t),{},{crossfade:void 0===t.crossfade||t.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Tn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==n;if(!(t||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty)||this.attemptToResolveRelativeTarget))return;const{layout:r,layoutId:a}=this.options;if(this.layout&&(r||a)){if(this.resolvedRelativeTargetAt=Tn.timestamp,!this.targetDelta&&!this.relativeTarget){const t=this.getClosestProjectingParent();t&&t.layout&&1!==this.animationProgress?(this.relativeParent=t,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Na(this.relativeTargetOrigin,this.layout.layoutBox,t.layout.layoutBox),Co(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,s,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,s=this.relativeTarget,l=this.relativeParent.target,Ra(o.x,s.x,l.x),Ra(o.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Co(this.target,this.layout.layoutBox),$a(this.target,this.targetDelta)):Co(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const t=this.getClosestProjectingParent();t&&Boolean(t.resumingFrom)===Boolean(this.resumingFrom)&&!t.options.layoutScroll&&t.target&&1!==this.animationProgress?(this.relativeParent=t,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Na(this.relativeTargetOrigin,this.target,t.target),Co(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Wo.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Wa(this.parent.latestValues)&&!Za(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var t;const e=this.getLead(),n=Boolean(this.resumingFrom)||this!==e;let i=!0;if((this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty))&&(i=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===Tn.timestamp&&(i=!1),i)return;const{layout:r,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!a)return;Co(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,s=this.treeScale.y;!function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length;if(!r)return;let a,o;e.x=e.y=1;for(let s=0;s<r;s++){a=n[s],o=a.projectionDelta;const r=a.instance;r&&r.style&&"contents"===r.style.display||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&ro(t,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,$a(t,o)),i&&qa(a.latestValues)&&ro(t,a.latestValues))}e.x=Qa(e.x),e.y=Qa(e.y)}(this.layoutCorrected,this.treeScale,this.path,n),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox);const{target:l}=e;if(!l)return void(this.projectionTransform&&(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionTransform="none",this.scheduleRender()));this.projectionDelta||(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}});const c=this.projectionTransform;ka(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.projectionTransform=Bo(this.projectionDelta,this.treeScale),this.projectionTransform===c&&this.treeScale.x===o&&this.treeScale.y===s||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Wo.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.options.scheduleRender&&this.options.scheduleRender(),t){const t=this.getStack();t&&t.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,i=n?n.latestValues:{},r=kt({},this.latestValues),a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!e;const o={x:{min:0,max:0},y:{min:0,max:0}},s=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(ls));let h;this.animationProgress=0,this.mixTargetDelta=e=>{const n=e/1e3;os(a.x,t.x,n),os(a.y,t.y,n),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Na(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(t,e,n,i){ss(t.x,e.x,n.x,i),ss(t.y,e.y,n.y,i)}(this.relativeTarget,this.relativeTargetOrigin,o,n),h&&function(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}(this.relativeTarget,h)&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Co(h,this.relativeTarget)),s&&(this.animationValues=r,function(t,e,n,i,r,a){r?(t.opacity=ki(0,void 0!==n.opacity?n.opacity:1,Mo(i)),t.opacityExit=ki(void 0!==e.opacity?e.opacity:1,0,To(i))):a&&(t.opacity=ki(void 0!==e.opacity?e.opacity:1,void 0!==n.opacity?n.opacity:1,i));for(let o=0;o<bo;o++){const r="border".concat(_o[o],"Radius");let a=So(e,r),s=So(n,r);void 0===a&&void 0===s||(a||(a=0),s||(s=0),0===a||0===s||wo(a)===wo(s)?(t[r]=Math.max(ki(xo(a),xo(s),i),0),(Ne.test(s)||Ne.test(a))&&(t[r]+="%")):t[r]=s)}(e.rotate||n.rotate)&&(t.rotate=ki(e.rotate||0,n.rotate||0,i))}(r,i,this.latestValues,n,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(t){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Mn(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Sn.update(()=>{ho.hasAnimatedSinceResize=!0,this.currentAnimation=function(t,e,n){const i=ye(t)?t:Kr(t);return i.start(Vr("",i,e,n)),i.animation}(0,1e3,kt(kt({},t),{},{onUpdate:e=>{this.mixTargetDelta(e),t.onUpdate&&t.onUpdate(e)},onComplete:()=>{t.onComplete&&t.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const t=this.getStack();t&&t.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const t=this.getLead();let{targetWithTransforms:e,target:n,layout:i,latestValues:r}=t;if(e&&n&&i){if(this!==t&&this.layout&&i&&ps(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const e=Pa(this.layout.layoutBox.x);n.x.min=t.target.x.min,n.x.max=n.x.min+e;const i=Pa(this.layout.layoutBox.y);n.y.min=t.target.y.min,n.y.max=n.y.min+i}Co(e,n),ro(e,r),ka(this.projectionDeltaWithTransform,this.layoutCorrected,e,r)}}registerSharedNode(t,e){this.sharedNodes.has(t)||this.sharedNodes.set(t,new Oo);this.sharedNodes.get(t).add(e);const n=e.options.initialPromotionConfig;e.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(e):void 0})}isLead(){const t=this.getStack();return!t||t.lead===this}getLead(){var t;const{layoutId:e}=this.options;return e&&(null===(t=this.getStack())||void 0===t?void 0:t.lead)||this}getPrevLead(){var t;const{layoutId:e}=this.options;return e?null===(t=this.getStack())||void 0===t?void 0:t.prevLead:void 0}getStack(){const{layoutId:t}=this.options;if(t)return this.root.sharedNodes.get(t)}promote(){let{needsReset:t,transition:e,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this.getStack();i&&i.promote(this,n),t&&(this.projectionDelta=void 0,this.needsReset=!0),e&&this.setOptions({transition:e})}relegate(){const t=this.getStack();return!!t&&t.relegate(this)}resetRotation(){const{visualElement:t}=this.options;if(!t)return;let e=!1;const{latestValues:n}=t;if((n.rotate||n.rotateX||n.rotateY||n.rotateZ)&&(e=!0),!e)return;const i={};for(let r=0;r<Vo.length;r++){const e="rotate"+Vo[r];n[e]&&(i[e]=n[e],t.setStaticValue(e,0))}t.render();for(const r in i)t.setStaticValue(r,i[r]);t.scheduleRender()}getProjectionStyles(t){var e,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Ho;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=gn(null===t||void 0===t?void 0:t.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const e={};return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=gn(null===t||void 0===t?void 0:t.pointerEvents)||""),this.hasProjected&&!qa(this.latestValues)&&(e.transform=r?r({},""):"none",this.hasProjected=!1),e}const o=a.animationValues||a.latestValues;this.applyTransformsToTarget(),i.transform=Bo(this.projectionDeltaWithTransform,this.treeScale,o),r&&(i.transform=r(o,i.transform));const{x:s,y:l}=this.projectionDelta;i.transformOrigin="".concat(100*s.origin,"% ").concat(100*l.origin,"% 0"),a.animationValues?i.opacity=a===this?null!==(n=null!==(e=o.opacity)&&void 0!==e?e:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:i.opacity=a===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const c in pe){if(void 0===o[c])continue;const{correct:t,applyTo:e}=pe[c],n="none"===i.transform?o[c]:t(o[c],a);if(e){const t=e.length;for(let r=0;r<t;r++)i[e[r]]=n}else i[c]=n}return this.options.layoutId&&(i.pointerEvents=a===this?gn(null===t||void 0===t?void 0:t.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(t=>{var e;return null===(e=t.currentAnimation)||void 0===e?void 0:e.stop()}),this.root.nodes.forEach($o),this.root.sharedNodes.clear()}}}function Zo(t){t.updateLayout()}function Xo(t){var e;const n=(null===(e=t.resumeFrom)||void 0===e?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:e,measuredBox:i}=t.layout,{animationType:r}=t.options,a=n.source!==t.layout.source;"size"===r?Va(t=>{const i=a?n.measuredBox[t]:n.layoutBox[t],r=Pa(i);i.min=e[t].min,i.max=i.min+r}):ps(r,n.layoutBox,e)&&Va(i=>{const r=a?n.measuredBox[i]:n.layoutBox[i],o=Pa(e[i]);r.max=r.min+o,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[i].max=t.relativeTarget[i].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};ka(o,e,n.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?ka(s,t.applyTransform(i,!0),n.measuredBox):ka(s,e,n.layoutBox);const l=!No(o);let c=!1;if(!t.resumeFrom){const i=t.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:a}=i;if(r&&a){const o={x:{min:0,max:0},y:{min:0,max:0}};Na(o,n.layoutBox,r.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};Na(s,e,a.layoutBox),zo(o,s)||(c=!0),i.options.layoutRoot&&(t.relativeTarget=s,t.relativeTargetOrigin=o,t.relativeParent=i)}}}t.notifyListeners("didUpdate",{layout:e,snapshot:n,delta:s,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(t.isLead()){const{onExitComplete:e}=t.options;e&&e()}t.options.transition=void 0}function Yo(t){Wo.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=Boolean(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Ko(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Jo(t){t.clearSnapshot()}function $o(t){t.clearMeasurements()}function Qo(t){t.isLayoutDirty=!1}function ts(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function es(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function ns(t){t.resolveTargetDelta()}function is(t){t.calcProjection()}function rs(t){t.resetRotation()}function as(t){t.removeLeadSnapshot()}function os(t,e,n){t.translate=ki(e.translate,0,n),t.scale=ki(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function ss(t,e,n,i){t.min=ki(e.min,n.min,i),t.max=ki(e.max,n.max,i)}function ls(t){return t.animationValues&&void 0!==t.animationValues.opacityExit}const cs={duration:.45,ease:[.4,0,.1,1]},us=t=>"undefined"!==typeof navigator&&navigator.userAgent.toLowerCase().includes(t),hs=us("applewebkit/")&&!us("chrome/")?Math.round:bn;function ds(t){t.min=hs(t.min),t.max=hs(t.max)}function ps(t,e,n){return"position"===t||"preserve-aspect"===t&&!Ia(Fo(e),Fo(n),.2)}const fs=qo({attachResizeListener:(t,e)=>Pn(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ms={current:void 0},gs=qo({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ms.current){const t=new fs({});t.mount(window),t.setOptions({layoutScroll:!0}),ms.current=t}return ms.current},resetTransform:(t,e)=>{t.style.transform=void 0!==e?e:"none"},checkIsScrollRoot:t=>Boolean("fixed"===window.getComputedStyle(t).position)}),ys={pan:{Feature:class extends Un{constructor(){super(...arguments),this.removePointerDownListener=bn}onPointerDown(t){this.session=new wa(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:oo(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:e,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:uo(t),onStart:uo(e),onMove:n,onEnd:(t,e)=>{delete this.session,i&&Sn.update(()=>i(t,e))}}}mount(){this.removePointerDownListener=kn(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Un{constructor(t){super(t),this.removeGroupControls=bn,this.removeListeners=bn,this.controls=new lo(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||bn}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:gs,MeasureLayout:yo}};const vs=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function _s(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;ei(n<=4,'Max CSS variable fallback depth detected in property "'.concat(t,'". This may indicate a circular fallback dependency.'));const[i,r]=function(t){const e=vs.exec(t);if(!e)return[,];const[,n,i]=e;return[n,i]}(t);if(!i)return;const a=window.getComputedStyle(e).getPropertyValue(i);if(a){const t=a.trim();return Gr(t)?parseFloat(t):t}return we(r)?_s(r,e,n+1):r}function bs(t,e,n){let i=Object.assign({},(function(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(e),e));const r=t.current;if(!(r instanceof Element))return{target:i,transitionEnd:n};n&&(n=kt({},n)),t.values.forEach(t=>{const e=t.get();if(!we(e))return;const n=_s(e,r);n&&t.set(n)});for(const a in i){const t=i[a];if(!we(t))continue;const e=_s(t,r);e&&(i[a]=e,n||(n={}),void 0===n[a]&&(n[a]=t))}return{target:i,transitionEnd:n}}const xs=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),ws=t=>xs.has(t),Ss=t=>t===Te||t===ze,Ms=(t,e)=>parseFloat(t.split(", ")[e]),Ts=(t,e)=>(n,i)=>{let{transform:r}=i;if("none"===r||!r)return 0;const a=r.match(/^matrix3d\((.+)\)$/);if(a)return Ms(a[1],e);{const e=r.match(/^matrix\((.+)\)$/);return e?Ms(e[1],t):0}},As=new Set(["x","y","z"]),Es=fe.filter(t=>!As.has(t));const Cs={width:(t,e)=>{let{x:n}=t,{paddingLeft:i="0",paddingRight:r="0"}=e;return n.max-n.min-parseFloat(i)-parseFloat(r)},height:(t,e)=>{let{y:n}=t,{paddingTop:i="0",paddingBottom:r="0"}=e;return n.max-n.min-parseFloat(i)-parseFloat(r)},top:(t,e)=>{let{top:n}=e;return parseFloat(n)},left:(t,e)=>{let{left:n}=e;return parseFloat(n)},bottom:(t,e)=>{let{y:n}=t,{top:i}=e;return parseFloat(i)+(n.max-n.min)},right:(t,e)=>{let{x:n}=t,{left:i}=e;return parseFloat(i)+(n.max-n.min)},x:Ts(4,13),y:Ts(5,14)};Cs.translateX=Cs.x,Cs.translateY=Cs.y;const Ps=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=kt({},e),i=kt({},i);const r=Object.keys(e).filter(ws);let a=[],o=!1;const s=[];if(r.forEach(r=>{const l=t.getValue(r);if(!t.hasValue(r))return;let c=n[r],u=Qr(c);const h=e[r];let d;if(fn(h)){const t=h.length,e=null===h[0]?1:0;c=h[e],u=Qr(c);for(let n=e;n<t&&null!==h[n];n++)d?ei(Qr(h[n])===d,"All keyframes must be of the same type"):(d=Qr(h[n]),ei(d===u||Ss(u)&&Ss(d),"Keyframes must be of the same dimension as the current value"))}else d=Qr(h);if(u!==d)if(Ss(u)&&Ss(d)){const t=l.get();"string"===typeof t&&l.set(parseFloat(t)),"string"===typeof h?e[r]=parseFloat(h):Array.isArray(h)&&d===ze&&(e[r]=h.map(parseFloat))}else(null===u||void 0===u?void 0:u.transform)&&(null===d||void 0===d?void 0:d.transform)&&(0===c||0===h)?0===c?l.set(d.transform(c)):e[r]=u.transform(h):(o||(a=function(t){const e=[];return Es.forEach(n=>{const i=t.getValue(n);void 0!==i&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}(t),o=!0),s.push(r),i[r]=void 0!==i[r]?i[r]:e[r],l.jump(h))}),s.length){const n=s.indexOf("height")>=0?window.pageYOffset:null,r=((t,e,n)=>{const i=e.measureViewportBox(),r=e.current,a=getComputedStyle(r),{display:o}=a,s={};"none"===o&&e.setStaticValue("display",t.display||"block"),n.forEach(t=>{s[t]=Cs[t](i,a)}),e.render();const l=e.measureViewportBox();return n.forEach(n=>{const i=e.getValue(n);i&&i.jump(s[n]),t[n]=Cs[n](l,a)}),t})(e,t,s);return a.length&&a.forEach(e=>{let[n,i]=e;t.getValue(n).set(i)}),t.render(),Ht&&null!==n&&window.scrollTo({top:n}),{target:r,transitionEnd:i}}return{target:e,transitionEnd:i}};function Is(t,e,n,i){return(t=>Object.keys(t).some(ws))(e)?Ps(t,e,n,i):{target:e,transitionEnd:i}}const Ls={current:null},ks={current:!1};const Rs=new WeakMap,Ds=["willChange"],Ns=["children"],zs=Object.keys(re),Fs=zs.length,Os=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Bs=$t.length;class Us{constructor(t){let{parent:e,props:n,presenceContext:i,reducedMotionConfig:r,visualState:a}=t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Sn.render(this.render,!1,!0);const{latestValues:s,renderState:l}=a;this.latestValues=s,this.baseTarget=kt({},s),this.initialValues=n.initial?kt({},s):{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.isControllingVariants=Qt(n),this.isVariantNode=te(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const c=this.scrapeMotionValuesFromProps(n,{}),{willChange:u}=c,h=Je(c,Ds);for(const d in h){const t=h[d];void 0!==s[d]&&ye(t)&&(t.set(s[d],!1),Hr(u)&&u.add(d))}}scrapeMotionValuesFromProps(t,e){return{}}mount(t){this.current=t,Rs.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,e)=>this.bindToMotionValue(e,t)),ks.current||function(){if(ks.current=!0,Ht)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Ls.current=t.matches;t.addListener(e),e()}else Ls.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Ls.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Rs.delete(this.current),this.projection&&this.projection.unmount(),Mn(this.notifyUpdate),Mn(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,e){const n=me.has(t),i=e.on("change",e=>{this.latestValues[t]=e,this.props.onUpdate&&Sn.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),r=e.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{i(),r()})}sortNodePosition(t){return this.current&&this.sortInstanceNodePosition&&this.type===t.type?this.sortInstanceNodePosition(this.current,t.current):0}loadFeatures(t,e,n,i){let r,a,{children:o}=t,s=Je(t,Ns);for(let l=0;l<Fs;l++){const t=zs[l],{isEnabled:e,Feature:n,ProjectionNode:i,MeasureLayout:o}=re[t];i&&(r=i),e(s)&&(!this.features[t]&&n&&(this.features[t]=new n(this)),o&&(a=o))}if(("html"===this.type||"svg"===this.type)&&!this.projection&&r){this.projection=new r(this.latestValues,this.parent&&this.parent.projection);const{layoutId:t,layout:e,drag:n,dragConstraints:a,layoutScroll:o,layoutRoot:l}=s;this.projection.setOptions({layoutId:t,layout:e,alwaysMeasureLayout:Boolean(n)||a&&Xt(a),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:"string"===typeof e?e:"both",initialPromotionConfig:i,layoutScroll:o,layoutRoot:l})}return a}updateFeatures(){for(const t in this.features){const e=this.features[t];e.isMounted?e.update():(e.mount(),e.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,e){this.latestValues[t]=e}makeTargetAnimatable(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.makeTargetAnimatableFromInstance(t,this.props,e)}update(t,e){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=e;for(let n=0;n<Os.length;n++){const e=Os[n];this.propEventSubscriptions[e]&&(this.propEventSubscriptions[e](),delete this.propEventSubscriptions[e]);const i=t["on"+e];i&&(this.propEventSubscriptions[e]=this.on(e,i))}this.prevMotionValues=function(t,e,n){const{willChange:i}=e;for(const r in e){const a=e[r],o=n[r];if(ye(a))t.addValue(r,a),Hr(i)&&i.add(r);else if(ye(o))t.addValue(r,Kr(a,{owner:t})),Hr(i)&&i.remove(r);else if(o!==a)if(t.hasValue(r)){const e=t.getValue(r);!e.hasAnimated&&e.set(a)}else{const e=t.getStaticValue(r);t.addValue(r,Kr(void 0!==e?e:a,{owner:t}))}}for(const r in n)void 0===e[r]&&t.removeValue(r);return e}(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const t=this.parent&&this.parent.getVariantContext()||{};return void 0!==this.props.initial&&(t.initial=this.props.initial),t}const t={};for(let e=0;e<Bs;e++){const n=$t[e],i=this.props[n];(Yt(i)||!1===i)&&(t[n]=i)}return t}addVariantChild(t){const e=this.getClosestVariantNode();if(e)return e.variantChildren&&e.variantChildren.add(t),()=>e.variantChildren.delete(t)}addValue(t,e){e!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,e)),this.values.set(t,e),this.latestValues[t]=e.get()}removeValue(t){this.values.delete(t);const e=this.valueSubscriptions.get(t);e&&(e(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,e){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return void 0===n&&void 0!==e&&(n=Kr(e,{owner:this}),this.addValue(t,n)),n}readValue(t){var e;return void 0===this.latestValues[t]&&this.current?null!==(e=this.getBaseTargetFromProps(this.props,t))&&void 0!==e?e:this.readValueFromInstance(this.current,t,this.options):this.latestValues[t]}setBaseTarget(t,e){this.baseTarget[t]=e}getBaseTarget(t){var e;const{initial:n}=this.props,i="string"===typeof n||"object"===typeof n?null===(e=pn(this.props,n))||void 0===e?void 0:e[t]:void 0;if(n&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,t);return void 0===r||ye(r)?void 0!==this.initialValues[t]&&void 0===i?void 0:this.baseTarget[t]:r}on(t,e){return this.events[t]||(this.events[t]=new Zr),this.events[t].add(e)}notify(t){if(this.events[t]){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.events[t].notify(...n)}}}const js=["transition","transitionEnd"];class Vs extends Us{sortInstanceNodePosition(t,e){return 2&t.compareDocumentPosition(e)?1:-1}getBaseTargetFromProps(t,e){return t.style?t.style[e]:void 0}removeValueFromRenderState(t,e){let{vars:n,style:i}=e;delete n[t],delete i[t]}makeTargetAnimatableFromInstance(t,e,n){let{transition:i,transitionEnd:r}=t,a=Je(t,js),{transformValues:o}=e,s=function(t,e,n){const i={};for(const r in t){const t=aa(r,e);if(void 0!==t)i[r]=t;else{const t=n.getValue(r);t&&(i[r]=t.get())}}return i}(a,i||{},this);if(o&&(r&&(r=o(r)),a&&(a=o(a)),s&&(s=o(s))),n){!function(t,e,n){var i,r;const a=Object.keys(e).filter(e=>!t.hasValue(e)),o=a.length;if(o)for(let s=0;s<o;s++){const o=a[s],l=e[o];let c=null;Array.isArray(l)&&(c=l[0]),null===c&&(c=null!==(r=null!==(i=n[o])&&void 0!==i?i:t.readValue(o))&&void 0!==r?r:e[o]),void 0!==c&&null!==c&&("string"===typeof c&&(Gr(c)||Fr(c))?c=parseFloat(c):!ea(c)&&qi.test(l)&&(c=zr(o,l)),t.addValue(o,Kr(c,{owner:t})),void 0===n[o]&&(n[o]=c),null!==c&&t.setBaseTarget(o,c))}}(this,a,s);const t=((t,e,n,i)=>{const r=bs(t,e,i);return Is(t,e=r.target,n,i=r.transitionEnd)})(this,a,s,r);r=t.transitionEnd,a=t.target}return kt({transition:i,transitionEnd:r},a)}}class Hs extends Vs{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,e){if(me.has(e)){const t=Nr(e);return t&&t.default||0}{const i=(n=t,window.getComputedStyle(n)),r=(xe(e)?i.getPropertyValue(e):i[e])||0;return"string"===typeof r?r.trim():r}var n}measureInstanceViewportBox(t,e){let{transformPagePoint:n}=e;return ao(t,n)}build(t,e,n,i){Ve(t,e,n,i.transformTemplate)}scrapeMotionValuesFromProps(t,e){return hn(t,e)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ye(t)&&(this.childSubscription=t.on("change",t=>{this.current&&(this.current.textContent="".concat(t))}))}renderInstance(t,e,n,i){ln(t,e,n,i)}}class Gs extends Vs{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,e){return t[e]}readValueFromInstance(t,e){if(me.has(e)){const t=Nr(e);return t&&t.default||0}return e=cn.has(e)?e:qt(e),t.getAttribute(e)}measureInstanceViewportBox(){return{x:{min:0,max:0},y:{min:0,max:0}}}scrapeMotionValuesFromProps(t,e){return dn(t,e)}build(t,e,n,i){nn(t,e,n,this.isSVGTag,i.transformTemplate)}renderInstance(t,e,n,i){un(t,e,0,i)}mount(t){this.isSVGTag=an(t.tagName),super.mount(t)}}const Ws=(t,e)=>de(t)?new Gs(e,{enableHardwareAcceleration:!1}):new Hs(e,{enableHardwareAcceleration:!0}),qs={layout:{ProjectionNode:gs,MeasureLayout:yo}},Zs=kt(kt(kt(kt({},ba),Jn),ys),qs),Xs=ue((t,e)=>function(t,e,n,i){let{forwardMotionProps:r=!1}=e;return kt(kt({},de(t)?En:Cn),{},{preloadedFeatures:n,useRender:sn(r),createVisualElement:i,Component:t})}(t,e,Zs,Ws));const Ys=function(){return(0,Rt.jsxs)("div",{className:"story-mode-preview",children:[(0,Rt.jsxs)("div",{className:"story-header",children:[(0,Rt.jsxs)("h2",{className:"story-title",children:[(0,Rt.jsx)("span",{className:"story-mode-label",children:"Story Mode:"}),"Journey of an Asteroid"]}),(0,Rt.jsx)("p",{className:"story-description",children:"Follow the path of an asteroid from deep space to Earth impact in our immersive scroll-based storytelling experience. Witness the journey through scientifically accurate simulations."})]}),(0,Rt.jsxs)("div",{className:"story-features",children:[(0,Rt.jsxs)("div",{className:"feature-grid",children:[(0,Rt.jsxs)(Xs.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"feature-icon",children:(0,Rt.jsx)("span",{className:"icon-number",children:"1"})}),(0,Rt.jsx)("h4",{children:"Detection"}),(0,Rt.jsx)("p",{children:"Discover how astronomers detect and track potentially hazardous asteroids."})]}),(0,Rt.jsxs)(Xs.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"feature-icon",children:(0,Rt.jsx)("span",{className:"icon-number",children:"2"})}),(0,Rt.jsx)("h4",{children:"Trajectory"}),(0,Rt.jsx)("p",{children:"Follow the asteroid's path through space using gravitational physics models."})]}),(0,Rt.jsxs)(Xs.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"feature-icon",children:(0,Rt.jsx)("span",{className:"icon-number",children:"3"})}),(0,Rt.jsx)("h4",{children:"Approach"}),(0,Rt.jsx)("p",{children:"Experience the final approach as the asteroid enters Earth's atmosphere."})]}),(0,Rt.jsxs)(Xs.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"feature-icon",children:(0,Rt.jsx)("span",{className:"icon-number",children:"4"})}),(0,Rt.jsx)("h4",{children:"Impact"}),(0,Rt.jsx)("p",{children:"Witness the moment of impact and its immediate consequences on Earth."})]})]}),(0,Rt.jsx)("div",{className:"story-preview-visual",children:(0,Rt.jsxs)("div",{className:"preview-container",children:[(0,Rt.jsxs)("div",{className:"preview-step active",children:[(0,Rt.jsx)("h4",{children:"Step 2: Trajectory"}),(0,Rt.jsx)("p",{children:"The asteroid is put on a collision with prehchts using gravitational models."})]}),(0,Rt.jsxs)("div",{className:"preview-earth",children:[(0,Rt.jsx)("div",{className:"earth-globe"}),(0,Rt.jsx)("div",{className:"asteroid-trail"})]})]})})]}),(0,Rt.jsx)("div",{className:"story-action",children:(0,Rt.jsx)(Et,{to:"/story",className:"btn btn--primary btn--large",children:"Start Story Mode"})})]})};const Ks=function(){return(0,Rt.jsxs)("div",{className:"research-dashboard",children:[(0,Rt.jsxs)("div",{className:"dashboard-header",children:[(0,Rt.jsxs)("h2",{className:"dashboard-title",children:["Powerful Research ",(0,Rt.jsx)("span",{className:"text-gradient",children:"Dashboard"})]}),(0,Rt.jsx)("p",{className:"dashboard-description",children:"Access professional tools to simulate asteroid impacts with scientific accuracy. Analyze results and generate comprehensive reports."})]}),(0,Rt.jsxs)("div",{className:"dashboard-grid",children:[(0,Rt.jsxs)(Xs.div,{className:"dashboard-card",whileHover:{scale:1.02},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"card-icon card-icon--blue",children:(0,Rt.jsx)("span",{children:"\u25b6"})}),(0,Rt.jsx)("h3",{children:"Run Simulation"}),(0,Rt.jsx)("p",{children:"Set asteroid parameters like size, velocity, angle, and impact location to run scientifically accurate simulations."}),(0,Rt.jsxs)(Et,{to:"/dashboard",className:"card-action",children:["Start Dashboard",(0,Rt.jsx)("span",{className:"arrow",children:"\u2192"})]})]}),(0,Rt.jsxs)(Xs.div,{className:"dashboard-card",whileHover:{scale:1.02},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"card-icon card-icon--purple",children:(0,Rt.jsx)("span",{children:"\ud83d\udcca"})}),(0,Rt.jsx)("h3",{children:"View Results"}),(0,Rt.jsx)("p",{children:"Explore detailed impact results including blast radius, energy released, and effective population loss scenarios."}),(0,Rt.jsxs)(Et,{to:"/results",className:"card-action",children:["See Results",(0,Rt.jsx)("span",{className:"arrow",children:"\u2192"})]})]}),(0,Rt.jsxs)(Xs.div,{className:"dashboard-card",whileHover:{scale:1.02},transition:{duration:.3},children:[(0,Rt.jsx)("div",{className:"card-icon card-icon--orange",children:(0,Rt.jsx)("span",{children:"\ud83d\udce5"})}),(0,Rt.jsx)("h3",{children:"Download Report"}),(0,Rt.jsx)("p",{children:"Generate comprehensive reports with charts, graphs, and scientific data for research and educational purposes."}),(0,Rt.jsxs)("button",{className:"card-action",children:["Generate Report",(0,Rt.jsx)("span",{className:"arrow",children:"\u2192"})]})]})]}),(0,Rt.jsxs)("div",{className:"dashboard-stats",children:[(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("div",{className:"stat-number",children:"12.1 Mt"}),(0,Rt.jsx)("div",{className:"stat-label",children:"Energy Released"}),(0,Rt.jsx)("div",{className:"stat-bar stat-bar--blue"})]}),(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("div",{className:"stat-number",children:"243.2 km"}),(0,Rt.jsx)("div",{className:"stat-label",children:"Blast Radius"}),(0,Rt.jsx)("div",{className:"stat-bar stat-bar--purple"})]}),(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("div",{className:"stat-number",children:"320K"}),(0,Rt.jsx)("div",{className:"stat-label",children:"Population Affected"}),(0,Rt.jsx)("div",{className:"stat-bar stat-bar--orange"})]}),(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("div",{className:"stat-number",children:"86.3 m"}),(0,Rt.jsx)("div",{className:"stat-label",children:"Tsunami Height"}),(0,Rt.jsx)("div",{className:"stat-bar stat-bar--blue"})]})]})]})};function Js(t){let{open:e,onClose:n,videoId:r}=t;const a=(0,i.useRef)(null),s=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(e){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[e]),(0,i.useEffect)(()=>{if(!e)return;const t=t=>{"Escape"===t.key&&n()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,n]);if(!e)return null;const l="https://drive.google.com/file/d/".concat(r,"/preview");return(0,o.createPortal)((0,Rt.jsx)("div",{className:"trailer-modal__overlay",ref:a,onClick:t=>{t.target===a.current&&n()},role:"dialog","aria-modal":"true","aria-label":"Watch trailer",children:(0,Rt.jsxs)("div",{className:"trailer-modal__content",ref:s,children:[(0,Rt.jsx)("button",{className:"trailer-modal__close","aria-label":"Close trailer",onClick:n,children:"\xd7"}),(0,Rt.jsx)("div",{className:"trailer-modal__video",children:(0,Rt.jsx)("iframe",{src:l,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Movie Trailer"},e?"open":"closed")})]})}),document.body)}const $s="180",Qs={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},tl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},el=0,nl=1,il=2,rl=3,al=0,ol=1,sl=2,ll=3,cl=0,ul=1,hl=2,dl=0,pl=1,fl=2,ml=3,gl=4,yl=5,vl=100,_l=101,bl=102,xl=103,wl=104,Sl=200,Ml=201,Tl=202,Al=203,El=204,Cl=205,Pl=206,Il=207,Ll=208,kl=209,Rl=210,Dl=211,Nl=212,zl=213,Fl=214,Ol=0,Bl=1,Ul=2,jl=3,Vl=4,Hl=5,Gl=6,Wl=7,ql=0,Zl=1,Xl=2,Yl=0,Kl=1,Jl=2,$l=3,Ql=4,tc=5,ec=6,nc=7,ic="attached",rc="detached",ac=300,oc=301,sc=302,lc=303,cc=304,uc=306,hc=1e3,dc=1001,pc=1002,fc=1003,mc=1004,gc=1004,yc=1005,vc=1005,_c=1006,bc=1007,xc=1007,wc=1008,Sc=1008,Mc=1009,Tc=1010,Ac=1011,Ec=1012,Cc=1013,Pc=1014,Ic=1015,Lc=1016,kc=1017,Rc=1018,Dc=1020,Nc=35902,zc=35899,Fc=1021,Oc=1022,Bc=1023,Uc=1026,jc=1027,Vc=1028,Hc=1029,Gc=1030,Wc=1031,qc=1032,Zc=1033,Xc=33776,Yc=33777,Kc=33778,Jc=33779,$c=35840,Qc=35841,tu=35842,eu=35843,nu=36196,iu=37492,ru=37496,au=37808,ou=37809,su=37810,lu=37811,cu=37812,uu=37813,hu=37814,du=37815,pu=37816,fu=37817,mu=37818,gu=37819,yu=37820,vu=37821,_u=36492,bu=36494,xu=36495,wu=36283,Su=36284,Mu=36285,Tu=36286,Au=2200,Eu=2201,Cu=2202,Pu=2300,Iu=2301,Lu=2302,ku=2400,Ru=2401,Du=2402,Nu=2500,zu=2501,Fu=0,Ou=1,Bu=2,Uu=3200,ju=3201,Vu=3202,Hu=3203,Gu=0,Wu=1,qu="",Zu="srgb",Xu="srgb-linear",Yu="linear",Ku="srgb",Ju=0,$u=7680,Qu=7681,th=7682,eh=7683,nh=34055,ih=34056,rh=5386,ah=512,oh=513,sh=514,lh=515,ch=516,uh=517,hh=518,dh=519,ph=512,fh=513,mh=514,gh=515,yh=516,vh=517,_h=518,bh=519,xh=35044,wh=35048,Sh=35040,Mh=35045,Th=35049,Ah=35041,Eh=35046,Ch=35050,Ph=35042,Ih="100",Lh="300 es",kh=2e3,Rh=2001,Dh={COMPUTE:"compute",RENDER:"render"},Nh={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},zh={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class Fh{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return void 0!==n&&(void 0!==n[t]&&-1!==n[t].indexOf(e))}removeEventListener(t,e){const n=this._listeners;if(void 0===n)return;const i=n[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const n=e[t.type];if(void 0!==n){t.target=this;const e=n.slice(0);for(let n=0,i=e.length;n<i;n++)e[n].call(this,t);t.target=null}}}const Oh=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Bh=1234567;const Uh=Math.PI/180,jh=180/Math.PI;function Vh(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Oh[255&t]+Oh[t>>8&255]+Oh[t>>16&255]+Oh[t>>24&255]+"-"+Oh[255&e]+Oh[e>>8&255]+"-"+Oh[e>>16&15|64]+Oh[e>>24&255]+"-"+Oh[63&n|128]+Oh[n>>8&255]+"-"+Oh[n>>16&255]+Oh[n>>24&255]+Oh[255&i]+Oh[i>>8&255]+Oh[i>>16&255]+Oh[i>>24&255]).toLowerCase()}function Hh(t,e,n){return Math.max(e,Math.min(n,t))}function Gh(t,e){return(t%e+e)%e}function Wh(t,e,n){return(1-n)*t+n*e}function qh(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Zh(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Xh={DEG2RAD:Uh,RAD2DEG:jh,generateUUID:Vh,clamp:Hh,euclideanModulo:Gh,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Wh,damp:function(t,e,n,i){return Wh(t,e,1-Math.exp(-n*i))},pingpong:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(Gh(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(Bh=t);let e=Bh+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Uh},radToDeg:function(t){return t*jh},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),c=a((e+i)/2),u=o((e+i)/2),h=a((e-i)/2),d=o((e-i)/2),p=a((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":t.set(s*u,l*h,l*d,s*c);break;case"YZY":t.set(l*d,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*d,s*u,s*c);break;case"XZX":t.set(s*u,l*f,l*p,s*c);break;case"YXY":t.set(l*p,s*u,l*f,s*c);break;case"ZYZ":t.set(l*f,l*p,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Zh,denormalize:qh};class Yh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Yh.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Hh(this.x,t.x,e.x),this.y=Hh(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=Hh(this.x,t,e),this.y=Hh(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Hh(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Hh(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*n-a*i+t.x,this.y=r*i+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Kh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,a,o){let s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===o)return t[e+0]=s,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||s!==h||l!==d||c!==p){let t=1-o;const e=s*h+l*d+c*p+u*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,e*n);t=Math.sin(t*a)/r,o=Math.sin(o*a)/r}const r=o*n;if(s=s*t+h*r,l=l*t+d*r,c=c*t+p*r,u=u*t+f*r,t===1-o){const t=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=t,l*=t,c*=t,u*=t}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,r,a){const o=n[i],s=n[i+1],l=n[i+2],c=n[i+3],u=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return t[e]=o*p+c*u+s*d-l*h,t[e+1]=s*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-s*u,t[e+3]=c*p-o*u-s*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=t._x,i=t._y,r=t._z,a=t._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=s(n/2),d=s(i/2),p=s(r/2);switch(a){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],a=e[1],o=e[5],s=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-s)*t,this._y=(r-l)*t,this._z=(a-i)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-s)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(r+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(r-l)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(s+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(a-i)/t,this._x=(r+l)/t,this._y=(s+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-8?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Hh(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,a=t._w,o=e._x,s=e._y,l=e._z,c=e._w;return this._x=n*c+a*o+i*l-r*s,this._y=i*c+a*s+r*o-n*l,this._z=r*c+a*l+n*s-i*o,this._w=a*c-n*o-i*s-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,a=this._w;let o=a*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const s=1-o*o;if(s<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Jh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Jh.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Qh.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Qh.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,a=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z,s=t.w,l=2*(a*i-o*n),c=2*(o*e-r*i),u=2*(r*n-a*e);return this.x=e+s*l+a*u-o*c,this.y=n+s*c+o*l-r*u,this.z=i+s*u+r*c-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Hh(this.x,t.x,e.x),this.y=Hh(this.y,t.y,e.y),this.z=Hh(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=Hh(this.x,t,e),this.y=Hh(this.y,t,e),this.z=Hh(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Hh(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,a=e.x,o=e.y,s=e.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return $h.copy(this).projectOnVector(t),this.sub($h)}reflect(t){return this.sub($h.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Hh(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $h=new Jh,Qh=new Kh;class td{constructor(t,e,n,i,r,a,o,s,l){td.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,a,o,s,l)}set(t,e,n,i,r,a,o,s,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=r,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],y=i[1],v=i[4],_=i[7],b=i[2],x=i[5],w=i[8];return r[0]=a*f+o*y+s*b,r[3]=a*m+o*v+s*x,r[6]=a*g+o*_+s*w,r[1]=l*f+c*y+u*b,r[4]=l*m+c*v+u*x,r[7]=l*g+c*_+u*w,r[2]=h*f+d*y+p*b,r[5]=h*m+d*v+p*x,r[8]=h*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8];return e*a*c-e*o*l-n*r*c+n*o*s+i*r*l-i*a*s}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=c*a-o*l,h=o*s-c*r,d=l*r-a*s,p=e*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(i*l-c*n)*f,t[2]=(o*n-i*a)*f,t[3]=h*f,t[4]=(c*e-i*s)*f,t[5]=(i*r-o*e)*f,t[6]=d*f,t[7]=(n*s-l*e)*f,t[8]=(a*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,a,o){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+t,-i*l,i*s,-i*(-l*a+s*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(ed.makeScale(t,e)),this}rotate(t){return this.premultiply(ed.makeRotation(-t)),this}translate(t,e){return this.premultiply(ed.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const ed=new td;function nd(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const id={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function rd(t,e){return new id[t](e)}function ad(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function od(){const t=ad("canvas");return t.style.display="block",t}const sd={};function ld(t){t in sd||(sd[t]=!0,console.warn(t))}const cd=(new td).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),ud=(new td).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function hd(){const t={enabled:!0,workingColorSpace:Xu,spaces:{},convert:function(t,e,n){return!1!==this.enabled&&e!==n&&e&&n?(this.spaces[e].transfer===Ku&&(t.r=pd(t.r),t.g=pd(t.g),t.b=pd(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Ku&&(t.r=fd(t.r),t.g=fd(t.g),t.b=fd(t.b)),t):t},workingToColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},colorSpaceToWorking:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===qu?Yu:this.spaces[t].transfer},getToneMappingMode:function(t){return this.spaces[t].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[t].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(e,n){return ld("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(e,n)},toWorkingColorSpace:function(e,n){return ld("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(e,n)}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return t.define({[Xu]:{primaries:e,whitePoint:i,transfer:Yu,toXYZ:cd,fromXYZ:ud,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Zu},outputColorSpaceConfig:{drawingBufferColorSpace:Zu}},[Zu]:{primaries:e,whitePoint:i,transfer:Ku,toXYZ:cd,fromXYZ:ud,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Zu}}}),t}const dd=hd();function pd(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function fd(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let md;class gd{static getDataURL(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(t.src))return t.src;if("undefined"===typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===md&&(md=ad("canvas")),md.width=t.width,md.height=t.height;const n=md.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=md}return e.toDataURL(n)}static sRGBToLinear(t){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const e=ad("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*pd(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*pd(e[t]/255)):e[t]=pd(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let yd=0;class vd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:yd++}),this.uuid=Vh(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return"undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):null!==e?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(_d(i[e].image)):t.push(_d(i[e]))}else t=_d(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function _d(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?gd.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let bd=0;const xd=new Jh;class wd extends Fh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wd.DEFAULT_IMAGE,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wd.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dc,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dc,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_c,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:wc,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Bc,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Mc,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:wd.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:qu;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:bd++}),this.uuid=Vh(),this.name="",this.source=new vd(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Yh(0,0),this.repeat=new Yh(1,1),this.center=new Yh(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new td,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(xd).x}get height(){return this.source.getSize(xd).y}get depth(){return this.source.getSize(xd).z}get image(){return this.source.data}set image(t){void 0===t&&(t=null),this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Texture.setValues(): parameter '".concat(e,"' has value of undefined."));continue}const i=this[e];void 0!==i?i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[e]=n:console.warn("THREE.Texture.setValues(): property '".concat(e,"' does not exist."))}}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ac)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case hc:t.x=t.x-Math.floor(t.x);break;case dc:t.x=t.x<0?0:1;break;case pc:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case hc:t.y=t.y-Math.floor(t.y);break;case dc:t.y=t.y<0?0:1;break;case pc:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}wd.DEFAULT_IMAGE=null,wd.DEFAULT_MAPPING=ac,wd.DEFAULT_ANISOTROPY=1;class Sd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Sd.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*e+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*e+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*e+a[7]*n+a[11]*i+a[15]*r,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const a=.01,o=.1,s=t.elements,l=s[0],c=s[4],u=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(p-m)<a){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,s=(d+1)/2,y=(g+1)/2,v=(c+h)/4,_=(u+f)/4,b=(p+m)/4;return t>s&&t>y?t<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=v/n,r=_/n):s>y?s<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=v/i,r=b/i):y<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(y),n=_/r,i=b/r),this.set(n,i,r,e),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Hh(this.x,t.x,e.x),this.y=Hh(this.y,t.y,e.y),this.z=Hh(this.z,t.z,e.z),this.w=Hh(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=Hh(this.x,t,e),this.y=Hh(this.y,t,e),this.z=Hh(this.z,t,e),this.w=Hh(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Hh(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Md extends Fh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:_c,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=n.depth,this.scissor=new Sd(0,0,t,e),this.scissorTest=!1,this.viewport=new Sd(0,0,t,e);const i={width:t,height:e,depth:n.depth},r=new wd(i);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={minFilter:_c,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==t.mapping&&(e.mapping=t.mapping),void 0!==t.wrapS&&(e.wrapS=t.wrapS),void 0!==t.wrapT&&(e.wrapT=t.wrapT),void 0!==t.wrapR&&(e.wrapR=t.wrapR),void 0!==t.magFilter&&(e.magFilter=t.magFilter),void 0!==t.minFilter&&(e.minFilter=t.minFilter),void 0!==t.format&&(e.format=t.format),void 0!==t.type&&(e.type=t.type),void 0!==t.anisotropy&&(e.anisotropy=t.anisotropy),void 0!==t.colorSpace&&(e.colorSpace=t.colorSpace),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.generateMipmaps&&(e.generateMipmaps=t.generateMipmaps),void 0!==t.internalFormat&&(e.internalFormat=t.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(e)}}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==t&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const n=Object.assign({},t.textures[e].image);this.textures[e].source=new vd(n)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Td extends Md{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Ad extends wd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=fc,this.minFilter=fc,this.wrapR=dc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Ed extends Td{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,e,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Ad(null,t,e,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Cd extends wd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=fc,this.minFilter=fc,this.wrapR=dc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pd extends Td{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,e,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Cd(null,t,e,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Id{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(kd.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(kd.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=kd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,kd):kd.fromBufferAttribute(i,e),kd.applyMatrix4(t.matrixWorld),this.expandByPoint(kd);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Rd.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Rd.copy(n.boundingBox)),Rd.applyMatrix4(t.matrixWorld),this.union(Rd)}const i=t.children;for(let r=0,a=i.length;r<a;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,kd),kd.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ud),jd.subVectors(this.max,Ud),Dd.subVectors(t.a,Ud),Nd.subVectors(t.b,Ud),zd.subVectors(t.c,Ud),Fd.subVectors(Nd,Dd),Od.subVectors(zd,Nd),Bd.subVectors(Dd,zd);let e=[0,-Fd.z,Fd.y,0,-Od.z,Od.y,0,-Bd.z,Bd.y,Fd.z,0,-Fd.x,Od.z,0,-Od.x,Bd.z,0,-Bd.x,-Fd.y,Fd.x,0,-Od.y,Od.x,0,-Bd.y,Bd.x,0];return!!Gd(e,Dd,Nd,zd,jd)&&(e=[1,0,0,0,1,0,0,0,1],!!Gd(e,Dd,Nd,zd,jd)&&(Vd.crossVectors(Fd,Od),e=[Vd.x,Vd.y,Vd.z],Gd(e,Dd,Nd,zd,jd)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,kd).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(kd).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Ld[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ld[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ld[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ld[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ld[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ld[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ld[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ld[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ld)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const Ld=[new Jh,new Jh,new Jh,new Jh,new Jh,new Jh,new Jh,new Jh],kd=new Jh,Rd=new Id,Dd=new Jh,Nd=new Jh,zd=new Jh,Fd=new Jh,Od=new Jh,Bd=new Jh,Ud=new Jh,jd=new Jh,Vd=new Jh,Hd=new Jh;function Gd(t,e,n,i,r){for(let a=0,o=t.length-3;a<=o;a+=3){Hd.fromArray(t,a);const o=r.x*Math.abs(Hd.x)+r.y*Math.abs(Hd.y)+r.z*Math.abs(Hd.z),s=e.dot(Hd),l=n.dot(Hd),c=i.dot(Hd);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const Wd=new Id,qd=new Jh,Zd=new Jh;class Xd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Wd.setFromPoints(t).getCenter(n);let i=0;for(let r=0,a=t.length;r<a;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;qd.subVectors(t,this.center);const e=qd.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(qd,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Zd.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(qd.copy(t.center).add(Zd)),this.expandByPoint(qd.copy(t.center).sub(Zd))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const Yd=new Jh,Kd=new Jh,Jd=new Jh,$d=new Jh,Qd=new Jh,tp=new Jh,ep=new Jh;class np{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh(0,0,-1);this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Yd)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Yd.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Yd.copy(this.origin).addScaledVector(this.direction,e),Yd.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){Kd.copy(t).add(e).multiplyScalar(.5),Jd.copy(e).sub(t).normalize(),$d.copy(this.origin).sub(Kd);const r=.5*t.distanceTo(e),a=-this.direction.dot(Jd),o=$d.dot(this.direction),s=-$d.dot(Jd),l=$d.lengthSq(),c=Math.abs(1-a*a);let u,h,d,p;if(c>0)if(u=a*s-o,h=a*o-s,p=r*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+a*h+2*o)+h*(a*u+h+2*s)+l}else h=r,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;else h<=-p?(u=Math.max(0,-(-a*r+o)),h=u>0?-r:Math.min(Math.max(-r,-s),r),d=-u*u+h*(h+2*s)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-s),r),d=h*(h+2*s)+l):(u=Math.max(0,-(a*r+o)),h=u>0?r:Math.min(Math.max(-r,-s),r),d=-u*u+h*(h+2*s)+l);else h=a>0?-r:r,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Kd).addScaledVector(Jd,h),d}intersectSphere(t,e){Yd.subVectors(t.center,this.origin);const n=Yd.dot(this.direction),i=Yd.dot(Yd)-n*n,r=t.radius*t.radius;if(i>r)return null;const a=Math.sqrt(r-i),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,e):this.at(o,e)}intersectsSphere(t){return!(t.radius<0)&&this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,a=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,a=(t.min.y-h.y)*c),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),u>=0?(o=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,Yd)}intersectTriangle(t,e,n,i,r){Qd.subVectors(e,t),tp.subVectors(n,t),ep.crossVectors(Qd,tp);let a,o=this.direction.dot(ep);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}$d.subVectors(this.origin,t);const s=a*this.direction.dot(tp.crossVectors($d,tp));if(s<0)return null;const l=a*this.direction.dot(Qd.cross($d));if(l<0)return null;if(s+l>o)return null;const c=-a*$d.dot(ep);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ip{constructor(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m){ip.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m)}set(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ip).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/rp.setFromMatrixColumn(t,0).length(),r=1/rp.setFromMatrixColumn(t,1).length(),a=1/rp.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=a*c,n=a*u,i=o*c,r=o*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*s,e[2]=r-t*l,e[6]=i+n*l,e[10]=a*s}else if("YXZ"===t.order){const t=s*c,n=s*u,i=l*c,r=l*u;e[0]=t+r*o,e[4]=i*o-n,e[8]=a*l,e[1]=a*u,e[5]=a*c,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=a*s}else if("ZXY"===t.order){const t=s*c,n=s*u,i=l*c,r=l*u;e[0]=t-r*o,e[4]=-a*u,e[8]=i+n*o,e[1]=n+i*o,e[5]=a*c,e[9]=r-t*o,e[2]=-a*l,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){const t=a*c,n=a*u,i=o*c,r=o*u;e[0]=s*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=s*u,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){const t=a*s,n=a*l,i=o*s,r=o*l;e[0]=s*c,e[4]=r-t*u,e[8]=i*u+n,e[1]=u,e[5]=a*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+i,e[10]=t-r*u}else if("XZY"===t.order){const t=a*s,n=a*l,i=o*s,r=o*l;e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=a*c,e[9]=n*u-i,e[2]=i*u-n,e[6]=o*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(op,t,sp)}lookAt(t,e,n){const i=this.elements;return up.subVectors(t,e),0===up.lengthSq()&&(up.z=1),up.normalize(),lp.crossVectors(n,up),0===lp.lengthSq()&&(1===Math.abs(n.z)?up.x+=1e-4:up.z+=1e-4,up.normalize(),lp.crossVectors(n,up)),lp.normalize(),cp.crossVectors(up,lp),i[0]=lp.x,i[4]=cp.x,i[8]=up.x,i[1]=lp.y,i[5]=cp.y,i[9]=up.y,i[2]=lp.z,i[6]=cp.z,i[10]=up.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],b=n[15],x=i[0],w=i[4],S=i[8],M=i[12],T=i[1],A=i[5],E=i[9],C=i[13],P=i[2],I=i[6],L=i[10],k=i[14],R=i[3],D=i[7],N=i[11],z=i[15];return r[0]=a*x+o*T+s*P+l*R,r[4]=a*w+o*A+s*I+l*D,r[8]=a*S+o*E+s*L+l*N,r[12]=a*M+o*C+s*k+l*z,r[1]=c*x+u*T+h*P+d*R,r[5]=c*w+u*A+h*I+d*D,r[9]=c*S+u*E+h*L+d*N,r[13]=c*M+u*C+h*k+d*z,r[2]=p*x+f*T+m*P+g*R,r[6]=p*w+f*A+m*I+g*D,r[10]=p*S+f*E+m*L+g*N,r[14]=p*M+f*C+m*k+g*z,r[3]=y*x+v*T+_*P+b*R,r[7]=y*w+v*A+_*I+b*D,r[11]=y*S+v*E+_*L+b*N,r[15]=y*M+v*C+_*k+b*z,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],a=t[1],o=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+r*s*u-i*l*u-r*o*h+n*l*h+i*o*d-n*s*d)+t[7]*(+e*s*d-e*l*h+r*a*h-i*a*d+i*l*c-r*s*c)+t[11]*(+e*l*u-e*o*d-r*a*u+n*a*d+r*o*c-n*l*c)+t[15]*(-i*o*c-e*s*u+e*o*h+i*a*u-n*a*h+n*s*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=u*m*l-f*h*l+f*s*d-o*m*d-u*s*g+o*h*g,v=p*h*l-c*m*l-p*s*d+a*m*d+c*s*g-a*h*g,_=c*f*l-p*u*l+p*o*d-a*f*d-c*o*g+a*u*g,b=p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m,x=e*y+n*v+i*_+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=y*w,t[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,t[2]=(o*m*r-f*s*r+f*i*l-n*m*l-o*i*g+n*s*g)*w,t[3]=(u*s*r-o*h*r-u*i*l+n*h*l+o*i*d-n*s*d)*w,t[4]=v*w,t[5]=(c*m*r-p*h*r+p*i*d-e*m*d-c*i*g+e*h*g)*w,t[6]=(p*s*r-a*m*r-p*i*l+e*m*l+a*i*g-e*s*g)*w,t[7]=(a*h*r-c*s*r+c*i*l-e*h*l-a*i*d+e*s*d)*w,t[8]=_*w,t[9]=(p*u*r-c*f*r-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(a*f*r-p*o*r+p*n*l-e*f*l-a*n*g+e*o*g)*w,t[11]=(c*o*r-a*u*r-c*n*l+e*u*l+a*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*f*i-p*u*i+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*i-a*f*i-p*n*s+e*f*s+a*n*m-e*o*m)*w,t[15]=(a*u*i-c*o*i+c*n*s-e*u*s-a*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,a=t.x,o=t.y,s=t.z,l=r*a,c=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,c*o+n,c*s-i*a,0,l*s-i*o,c*s+i*a,r*s*s+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,a){return this.set(1,n,r,0,t,1,a,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,a=e._y,o=e._z,s=e._w,l=r+r,c=a+a,u=o+o,h=r*l,d=r*c,p=r*u,f=a*c,m=a*u,g=o*u,y=s*l,v=s*c,_=s*u,b=n.x,x=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+_)*b,i[2]=(p-v)*b,i[3]=0,i[4]=(d-_)*x,i[5]=(1-(h+g))*x,i[6]=(m+y)*x,i[7]=0,i[8]=(p+v)*w,i[9]=(m-y)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=rp.set(i[0],i[1],i[2]).length();const a=rp.set(i[4],i[5],i[6]).length(),o=rp.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],ap.copy(this);const s=1/r,l=1/a,c=1/o;return ap.elements[0]*=s,ap.elements[1]*=s,ap.elements[2]*=s,ap.elements[4]*=l,ap.elements[5]*=l,ap.elements[6]*=l,ap.elements[8]*=c,ap.elements[9]*=c,ap.elements[10]*=c,e.setFromRotationMatrix(ap),n.x=r,n.y=a,n.z=o,this}makePerspective(t,e,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:kh,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2*r/(e-t),u=2*r/(n-i),h=(e+t)/(e-t),d=(n+i)/(n-i);let p,f;if(s)p=r/(a-r),f=a*r/(a-r);else if(o===kh)p=-(a+r)/(a-r),f=-2*a*r/(a-r);else{if(o!==Rh)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-a/(a-r),f=-a*r/(a-r)}return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:kh,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2/(e-t),u=2/(n-i),h=-(e+t)/(e-t),d=-(n+i)/(n-i);let p,f;if(s)p=1/(a-r),f=a/(a-r);else if(o===kh)p=-2/(a-r),f=-(a+r)/(a-r);else{if(o!==Rh)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=-1/(a-r),f=-r/(a-r)}return l[0]=c,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const rp=new Jh,ap=new ip,op=new Jh(0,0,0),sp=new Jh(1,1,1),lp=new Jh,cp=new Jh,up=new Jh,hp=new ip,dp=new Kh;class pp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pp.DEFAULT_ORDER;this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=t.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(Hh(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Hh(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Hh(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Hh(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Hh(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Hh(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return hp.makeRotationFromQuaternion(t),this.setFromRotationMatrix(hp,e,n)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return dp.setFromEuler(this),this.setFromQuaternion(dp,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}pp.DEFAULT_ORDER="XYZ";class fp{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}}let mp=0;const gp=new Jh,yp=new Kh,vp=new ip,_p=new Jh,bp=new Jh,xp=new Jh,wp=new Kh,Sp=new Jh(1,0,0),Mp=new Jh(0,1,0),Tp=new Jh(0,0,1),Ap={type:"added"},Ep={type:"removed"},Cp={type:"childadded",child:null},Pp={type:"childremoved",child:null};class Ip extends Fh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:mp++}),this.uuid=Vh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ip.DEFAULT_UP.clone();const t=new Jh,e=new pp,n=new Kh,i=new Jh(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ip},normalMatrix:{value:new td}}),this.matrix=new ip,this.matrixWorld=new ip,this.matrixAutoUpdate=Ip.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ip.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new fp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return yp.setFromAxisAngle(t,e),this.quaternion.multiply(yp),this}rotateOnWorldAxis(t,e){return yp.setFromAxisAngle(t,e),this.quaternion.premultiply(yp),this}rotateX(t){return this.rotateOnAxis(Sp,t)}rotateY(t){return this.rotateOnAxis(Mp,t)}rotateZ(t){return this.rotateOnAxis(Tp,t)}translateOnAxis(t,e){return gp.copy(t).applyQuaternion(this.quaternion),this.position.add(gp.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Sp,t)}translateY(t){return this.translateOnAxis(Mp,t)}translateZ(t){return this.translateOnAxis(Tp,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(vp.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?_p.copy(t):_p.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),bp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vp.lookAt(bp,_p,this.up):vp.lookAt(_p,bp,this.up),this.quaternion.setFromRotationMatrix(vp),i&&(vp.extractRotation(i.matrixWorld),yp.setFromRotationMatrix(vp),this.quaternion.premultiply(yp.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Ap),Cp.child=t,this.dispatchEvent(Cp),Cp.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ep),Pp.child=t,this.dispatchEvent(Pp),Pp.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),vp.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),vp.multiply(t.parent.matrixWorld)),t.applyMatrix4(vp),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Ap),Cp.child=t,this.dispatchEvent(Cp),Cp.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[t]===e&&n.push(this);const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bp,t,xp),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bp,wp,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"===typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(t=>kt(kt({},t),{},{boundingBox:t.boundingBox?t.boundingBox.toJSON():void 0,boundingSphere:t.boundingSphere?t.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(t=>kt({},t)),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(t),i.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=a(t.geometries),i=a(t.materials),r=a(t.textures),o=a(t.images),s=a(t.shapes),l=a(t.skeletons),c=a(t.animations),u=a(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function a(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}Ip.DEFAULT_UP=new Jh(0,1,0),Ip.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ip.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Lp=new Jh,kp=new Jh,Rp=new Jh,Dp=new Jh,Np=new Jh,zp=new Jh,Fp=new Jh,Op=new Jh,Bp=new Jh,Up=new Jh,jp=new Sd,Vp=new Sd,Hp=new Sd;class Gp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Jh;this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Lp.subVectors(t,e),i.cross(Lp);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Lp.subVectors(i,e),kp.subVectors(n,e),Rp.subVectors(t,e);const a=Lp.dot(Lp),o=Lp.dot(kp),s=Lp.dot(Rp),l=kp.dot(kp),c=kp.dot(Rp),u=a*l-o*o;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*s-o*c)*h,p=(a*c-o*s)*h;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,Dp)&&(Dp.x>=0&&Dp.y>=0&&Dp.x+Dp.y<=1)}static getInterpolation(t,e,n,i,r,a,o,s){return null===this.getBarycoord(t,e,n,i,Dp)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(r,Dp.x),s.addScaledVector(a,Dp.y),s.addScaledVector(o,Dp.z),s)}static getInterpolatedAttribute(t,e,n,i,r,a){return jp.setScalar(0),Vp.setScalar(0),Hp.setScalar(0),jp.fromBufferAttribute(t,e),Vp.fromBufferAttribute(t,n),Hp.fromBufferAttribute(t,i),a.setScalar(0),a.addScaledVector(jp,r.x),a.addScaledVector(Vp,r.y),a.addScaledVector(Hp,r.z),a}static isFrontFacing(t,e,n,i){return Lp.subVectors(n,e),kp.subVectors(t,e),Lp.cross(kp).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Lp.subVectors(this.c,this.b),kp.subVectors(this.a,this.b),.5*Lp.cross(kp).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Gp.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Gp.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,r){return Gp.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return Gp.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Gp.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let a,o;Np.subVectors(i,n),zp.subVectors(r,n),Op.subVectors(t,n);const s=Np.dot(Op),l=zp.dot(Op);if(s<=0&&l<=0)return e.copy(n);Bp.subVectors(t,i);const c=Np.dot(Bp),u=zp.dot(Bp);if(c>=0&&u<=c)return e.copy(i);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return a=s/(s-c),e.copy(n).addScaledVector(Np,a);Up.subVectors(t,r);const d=Np.dot(Up),p=zp.dot(Up);if(p>=0&&d<=p)return e.copy(r);const f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(zp,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Fp.subVectors(r,i),o=(u-c)/(u-c+(d-p)),e.copy(i).addScaledVector(Fp,o);const g=1/(m+f+h);return a=f*g,o=h*g,e.copy(n).addScaledVector(Np,a).addScaledVector(zp,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Wp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qp={h:0,s:0,l:0},Zp={h:0,s:0,l:0};function Xp(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class Yp{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zu;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,dd.colorSpaceToWorking(this,e),this}setRGB(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dd.workingColorSpace;return this.r=t,this.g=e,this.b=n,dd.colorSpaceToWorking(this,i),this}setHSL(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dd.workingColorSpace;if(t=Gh(t,1),e=Hh(e,0,1),n=Hh(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Xp(r,i,t+1/3),this.g=Xp(r,i,t),this.b=Xp(r,i,t-1/3)}return dd.colorSpaceToWorking(this,i),this}setStyle(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zu;function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const a=e[1],o=e[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=e[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zu;const n=Wp[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=pd(t.r),this.g=pd(t.g),this.b=pd(t.b),this}copyLinearToSRGB(t){return this.r=fd(t.r),this.g=fd(t.g),this.b=fd(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zu;return dd.workingToColorSpace(Kp.copy(this),t),65536*Math.round(Hh(255*Kp.r,0,255))+256*Math.round(Hh(255*Kp.g,0,255))+Math.round(Hh(255*Kp.b,0,255))}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zu;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dd.workingColorSpace;dd.workingToColorSpace(Kp.copy(this),e);const n=Kp.r,i=Kp.g,r=Kp.b,a=Math.max(n,i,r),o=Math.min(n,i,r);let s,l;const c=(o+a)/2;if(o===a)s=0,l=0;else{const t=a-o;switch(l=c<=.5?t/(a+o):t/(2-a-o),a){case n:s=(i-r)/t+(i<r?6:0);break;case i:s=(r-n)/t+2;break;case r:s=(n-i)/t+4}s/=6}return t.h=s,t.s=l,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dd.workingColorSpace;return dd.workingToColorSpace(Kp.copy(this),e),t.r=Kp.r,t.g=Kp.g,t.b=Kp.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zu;dd.workingToColorSpace(Kp.copy(this),t);const e=Kp.r,n=Kp.g,i=Kp.b;return t!==Zu?"color(".concat(t," ").concat(e.toFixed(3)," ").concat(n.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*e),",").concat(Math.round(255*n),",").concat(Math.round(255*i),")")}offsetHSL(t,e,n){return this.getHSL(qp),this.setHSL(qp.h+t,qp.s+e,qp.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(qp),t.getHSL(Zp);const n=Wh(qp.h,Zp.h,e),i=Wh(qp.s,Zp.s,e),r=Wh(qp.l,Zp.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Kp=new Yp;Yp.NAMES=Wp;let Jp=0;class $p extends Fh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Jp++}),this.uuid=Vh(),this.name="",this.type="Material",this.blending=pl,this.side=cl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=El,this.blendDst=Cl,this.blendEquation=vl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Yp(0,0,0),this.blendAlpha=0,this.depthFunc=jl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$u,this.stencilZFail=$u,this.stencilZPass=$u,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!==t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: parameter '".concat(e,"' has value of undefined."));continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE.Material: '".concat(e,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(t){const e=void 0===t||"string"===typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==pl&&(n.blending=this.blending),this.side!==cl&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==El&&(n.blendSrc=this.blendSrc),this.blendDst!==Cl&&(n.blendDst=this.blendDst),this.blendEquation!==vl&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==jl&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==dh&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==$u&&(n.stencilFail=this.stencilFail),this.stencilZFail!==$u&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==$u&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Qp extends $p{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Yp(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pp,this.combine=ql,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const tf=ef();function ef(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const t=l-127;t<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):t<-14?(i[l]=1024>>-t-14,i[256|l]=1024>>-t-14|32768,r[l]=-t-1,r[256|l]=-t-1):t<=15?(i[l]=t+15<<10,i[256|l]=t+15<<10|32768,r[l]=13,r[256|l]=13):t<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let t=l<<13,e=0;for(;0===(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,a[l]=t|e}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(s[l]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:a,exponentTable:o,offsetTable:s}}function nf(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Hh(t,-65504,65504),tf.floatView[0]=t;const e=tf.uint32View[0],n=e>>23&511;return tf.baseTable[n]+((8388607&e)>>tf.shiftTable[n])}function rf(t){const e=t>>10;return tf.uint32View[0]=tf.mantissaTable[tf.offsetTable[e]+(1023&t)]+tf.exponentTable[e],tf.floatView[0]}class af{static toHalfFloat(t){return nf(t)}static fromHalfFloat(t){return rf(t)}}const of=new Jh,sf=new Yh;let lf=0;class cf{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:lf++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=xh,this.updateRanges=[],this.gpuType=Ic,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)sf.fromBufferAttribute(this,e),sf.applyMatrix3(t),this.setXY(e,sf.x,sf.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)of.fromBufferAttribute(this,e),of.applyMatrix3(t),this.setXYZ(e,of.x,of.y,of.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)of.fromBufferAttribute(this,e),of.applyMatrix4(t),this.setXYZ(e,of.x,of.y,of.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)of.fromBufferAttribute(this,e),of.applyNormalMatrix(t),this.setXYZ(e,of.x,of.y,of.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)of.fromBufferAttribute(this,e),of.transformDirection(t),this.setXYZ(e,of.x,of.y,of.z);return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=qh(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Zh(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=qh(e,this.array)),e}setX(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=qh(e,this.array)),e}setY(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=qh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=qh(e,this.array)),e}setW(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array),i=Zh(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array),i=Zh(i,this.array),r=Zh(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==xh&&(t.usage=this.usage),t}}class uf extends cf{constructor(t,e,n){super(new Int8Array(t),e,n)}}class hf extends cf{constructor(t,e,n){super(new Uint8Array(t),e,n)}}class df extends cf{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}}class pf extends cf{constructor(t,e,n){super(new Int16Array(t),e,n)}}class ff extends cf{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class mf extends cf{constructor(t,e,n){super(new Int32Array(t),e,n)}}class gf extends cf{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class yf extends cf{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=rf(this.array[t*this.itemSize]);return this.normalized&&(e=qh(e,this.array)),e}setX(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize]=nf(e),this}getY(t){let e=rf(this.array[t*this.itemSize+1]);return this.normalized&&(e=qh(e,this.array)),e}setY(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize+1]=nf(e),this}getZ(t){let e=rf(this.array[t*this.itemSize+2]);return this.normalized&&(e=qh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize+2]=nf(e),this}getW(t){let e=rf(this.array[t*this.itemSize+3]);return this.normalized&&(e=qh(e,this.array)),e}setW(t,e){return this.normalized&&(e=Zh(e,this.array)),this.array[t*this.itemSize+3]=nf(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array)),this.array[t+0]=nf(e),this.array[t+1]=nf(n),this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array),i=Zh(i,this.array)),this.array[t+0]=nf(e),this.array[t+1]=nf(n),this.array[t+2]=nf(i),this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array),i=Zh(i,this.array),r=Zh(r,this.array)),this.array[t+0]=nf(e),this.array[t+1]=nf(n),this.array[t+2]=nf(i),this.array[t+3]=nf(r),this}}class vf extends cf{constructor(t,e,n){super(new Float32Array(t),e,n)}}let _f=0;const bf=new ip,xf=new Ip,wf=new Jh,Sf=new Id,Mf=new Id,Tf=new Jh;class Af extends Fh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_f++}),this.uuid=Vh(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(nd(t)?gf:ff)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new td).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return bf.makeRotationFromQuaternion(t),this.applyMatrix4(bf),this}rotateX(t){return bf.makeRotationX(t),this.applyMatrix4(bf),this}rotateY(t){return bf.makeRotationY(t),this.applyMatrix4(bf),this}rotateZ(t){return bf.makeRotationZ(t),this.applyMatrix4(bf),this}translate(t,e,n){return bf.makeTranslation(t,e,n),this.applyMatrix4(bf),this}scale(t,e,n){return bf.makeScale(t,e,n),this.applyMatrix4(bf),this}lookAt(t){return xf.lookAt(t),xf.updateMatrix(),this.applyMatrix4(xf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wf).negate(),this.translate(wf.x,wf.y,wf.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new vf(e,3))}else{const n=Math.min(t.length,e.count);for(let i=0;i<n;i++){const n=t[i];e.setXYZ(i,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Id);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Jh(-1/0,-1/0,-1/0),new Jh(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const t=e[n];Sf.setFromBufferAttribute(t),this.morphTargetsRelative?(Tf.addVectors(this.boundingBox.min,Sf.min),this.boundingBox.expandByPoint(Tf),Tf.addVectors(this.boundingBox.max,Sf.max),this.boundingBox.expandByPoint(Tf)):(this.boundingBox.expandByPoint(Sf.min),this.boundingBox.expandByPoint(Sf.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Xd);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Jh,1/0);if(t){const n=this.boundingSphere.center;if(Sf.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const n=e[t];Mf.setFromBufferAttribute(n),this.morphTargetsRelative?(Tf.addVectors(Sf.min,Mf.min),Sf.expandByPoint(Tf),Tf.addVectors(Sf.max,Mf.max),Sf.expandByPoint(Tf)):(Sf.expandByPoint(Mf.min),Sf.expandByPoint(Mf.max))}Sf.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Tf.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Tf));if(e)for(let r=0,a=e.length;r<a;r++){const a=e[r],o=this.morphTargetsRelative;for(let e=0,r=a.count;e<r;e++)Tf.fromBufferAttribute(a,e),o&&(wf.fromBufferAttribute(t,e),Tf.add(wf)),i=Math.max(i,n.distanceToSquared(Tf))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,i=e.normal,r=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new cf(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let S=0;S<n.count;S++)o[S]=new Jh,s[S]=new Jh;const l=new Jh,c=new Jh,u=new Jh,h=new Yh,d=new Yh,p=new Yh,f=new Jh,m=new Jh;function g(t,e,i){l.fromBufferAttribute(n,t),c.fromBufferAttribute(n,e),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,t),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const a=1/(d.x*p.y-p.x*d.y);isFinite(a)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(a),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(a),o[t].add(f),o[e].add(f),o[i].add(f),s[t].add(m),s[e].add(m),s[i].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let S=0,M=y.length;S<M;++S){const e=y[S],n=e.start;for(let i=n,r=n+e.count;i<r;i+=3)g(t.getX(i+0),t.getX(i+1),t.getX(i+2))}const v=new Jh,_=new Jh,b=new Jh,x=new Jh;function w(t){b.fromBufferAttribute(i,t),x.copy(b);const e=o[t];v.copy(e),v.sub(b.multiplyScalar(b.dot(e))).normalize(),_.crossVectors(x,e);const n=_.dot(s[t])<0?-1:1;a.setXYZW(t,v.x,v.y,v.z,n)}for(let S=0,M=y.length;S<M;++S){const e=y[S],n=e.start;for(let i=n,r=n+e.count;i<r;i+=3)w(t.getX(i+0)),w(t.getX(i+1)),w(t.getX(i+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new cf(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Jh,r=new Jh,a=new Jh,o=new Jh,s=new Jh,l=new Jh,c=new Jh,u=new Jh;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),a.fromBufferAttribute(e,f),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),s.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),a.fromBufferAttribute(e,t+2),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Tf.fromBufferAttribute(t,e),Tf.normalize(),t.setXYZ(e,Tf.x,Tf.y,Tf.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,a=new n.constructor(e.length*i);let o=0,s=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*i;for(let t=0;t<i;t++)a[s++]=n[o++]}return new cf(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Af,n=this.index.array,i=this.attributes;for(const o in i){const r=t(i[o],n);e.setAttribute(o,r)}const r=this.morphAttributes;for(const o in r){const i=[],a=r[o];for(let e=0,r=a.length;e<r;e++){const r=t(a[e],n);i.push(r)}e.morphAttributes[o]=i}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const t=a[o];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const s in n){const e=n[s];t.data.attributes[s]=e.toJSON(t.data)}const i={};let r=!1;for(const s in this.morphAttributes){const e=this.morphAttributes[s],n=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];n.push(r.toJSON(t.data))}n.length>0&&(i[s]=n,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere=o.toJSON()),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone());const i=t.attributes;for(const l in i){const t=i[l];this.setAttribute(l,t.clone(e))}const r=t.morphAttributes;for(const l in r){const t=[],n=r[l];for(let i=0,r=n.length;i<r;i++)t.push(n[i].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,c=a.length;l<c;l++){const t=a[l];this.addGroup(t.start,t.count,t.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ef=new ip,Cf=new np,Pf=new Xd,If=new Jh,Lf=new Jh,kf=new Jh,Rf=new Jh,Df=new Jh,Nf=new Jh,zf=new Jh,Ff=new Jh;class Of extends Ip{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Af,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qp;super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(r&&o){Nf.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=o[n],s=r[n];0!==i&&(Df.fromBufferAttribute(s,t),a?Nf.addScaledVector(Df,i):Nf.addScaledVector(Df.sub(e),i))}e.add(Nf)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Pf.copy(n.boundingSphere),Pf.applyMatrix4(r),Cf.copy(t.ray).recast(t.near),!1===Pf.containsPoint(Cf.origin)){if(null===Cf.intersectSphere(Pf,If))return;if(Cf.origin.distanceToSquared(If)>(t.far-t.near)**2)return}Ef.copy(r).invert(),Cf.copy(t.ray).applyMatrix4(Ef),null!==n.boundingBox&&!1===Cf.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Cf)}}_computeIntersections(t,e,n){let i;const r=this.geometry,a=this.material,o=r.index,s=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const r=h[p],s=a[r.materialIndex];for(let a=Math.max(r.start,d.start),h=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));a<h;a+=3){i=Bf(this,s,t,n,l,c,u,o.getX(a),o.getX(a+1),o.getX(a+2)),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);r<s;r+=3){i=Bf(this,a,t,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}else if(void 0!==s)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const r=h[p],o=a[r.materialIndex];for(let a=Math.max(r.start,d.start),h=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));a<h;a+=3){i=Bf(this,o,t,n,l,c,u,a,a+1,a+2),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);r<o;r+=3){i=Bf(this,a,t,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}}}function Bf(t,e,n,i,r,a,o,s,l,c){t.getVertexPosition(s,Lf),t.getVertexPosition(l,kf),t.getVertexPosition(c,Rf);const u=function(t,e,n,i,r,a,o,s){let l;if(l=e.side===ul?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,e.side===cl,s),null===l)return null;Ff.copy(s),Ff.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Ff);return c<n.near||c>n.far?null:{distance:c,point:Ff.clone(),object:t}}(t,e,n,i,Lf,kf,Rf,zf);if(u){const t=new Jh;Gp.getBarycoord(zf,Lf,kf,Rf,t),r&&(u.uv=Gp.getInterpolatedAttribute(r,s,l,c,t,new Yh)),a&&(u.uv1=Gp.getInterpolatedAttribute(a,s,l,c,t,new Yh)),o&&(u.normal=Gp.getInterpolatedAttribute(o,s,l,c,t,new Jh),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a:s,b:l,c:c,normal:new Jh,materialIndex:0};Gp.getNormal(Lf,kf,Rf,e.normal),u.face=e,u.barycoord=t}return u}class Uf extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const o=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const s=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,n,i,r,a,p,f,m,g,y){const v=a/m,_=p/g,b=a/2,x=p/2,w=f/2,S=m+1,M=g+1;let T=0,A=0;const E=new Jh;for(let o=0;o<M;o++){const a=o*_-x;for(let s=0;s<S;s++){const h=s*v-b;E[t]=h*i,E[e]=a*r,E[n]=w,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[n]=f>0?1:-1,c.push(E.x,E.y,E.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let o=0;o<g;o++)for(let t=0;t<m;t++){const e=h+t+S*o,n=h+t+S*(o+1),i=h+(t+1)+S*(o+1),r=h+(t+1)+S*o;s.push(e,n,r),s.push(n,i,r),A+=6}o.addGroup(d,A,y),d+=A,h+=T}p("z","y","x",-1,-1,n,e,t,a,r,0),p("z","y","x",1,-1,n,e,-t,a,r,1),p("x","z","y",1,1,t,n,e,i,a,2),p("x","z","y",1,-1,t,n,-e,i,a,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new vf(l,3)),this.setAttribute("normal",new vf(c,3)),this.setAttribute("uv",new vf(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Uf(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function jf(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Vf(t){const e={};for(let n=0;n<t.length;n++){const i=jf(t[n]);for(const t in i)e[t]=i[t]}return e}function Hf(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:dd.workingColorSpace}const Gf={clone:jf,merge:Vf};class Wf extends $p{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=jf(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class qf extends Ip{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ip,this.projectionMatrix=new ip,this.projectionMatrixInverse=new ip,this.coordinateSystem=kh,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Zf=new Jh,Xf=new Yh,Yf=new Yh;class Kf extends qf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*jh*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Uh*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*jh*Math.atan(Math.tan(.5*Uh*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Zf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Zf.x,Zf.y).multiplyScalar(-t/Zf.z),Zf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Zf.x,Zf.y).multiplyScalar(-t/Zf.z)}getViewSize(t,e){return this.getViewBounds(t,Xf,Yf),e.subVectors(Yf,Xf)}setViewOffset(t,e,n,i,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Uh*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const t=a.fullWidth,o=a.fullHeight;r+=a.offsetX*i/t,e-=a.offsetY*n/o,i*=a.width/t,n*=a.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Jf=-90;class $f extends Ip{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Kf(Jf,1,t,e);i.layers=this.layers,this.add(i);const r=new Kf(Jf,1,t,e);r.layers=this.layers,this.add(r);const a=new Kf(Jf,1,t,e);a.layers=this.layers,this.add(a);const o=new Kf(Jf,1,t,e);o.layers=this.layers,this.add(o);const s=new Kf(Jf,1,t,e);s.layers=this.layers,this.add(s);const l=new Kf(Jf,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,a,o,s]=e;for(const l of e)this.remove(l);if(t===kh)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(t!==Rh)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,s,l,c]=this.children,u=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,a),t.setRenderTarget(n,2,i),t.render(e,o),t.setRenderTarget(n,3,i),t.render(e,s),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,i),t.render(e,c),t.setRenderTarget(u,h,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Qf extends wd{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:oc,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class tm extends Td{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new Qf(i),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Uf(5,5,5),o=new Wf({name:"CubemapFromEquirect",uniforms:jf(n),vertexShader:i,fragmentShader:r,side:ul,blending:dl});o.uniforms.tEquirect.value=e;const s=new Of(a,o),l=e.minFilter;e.minFilter===wc&&(e.minFilter=_c);return new $f(1,10,this).update(t,s),e.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,i);t.setRenderTarget(r)}}class em extends Ip{constructor(){super(),this.isGroup=!0,this.type="Group"}}const nm={type:"move"};class im{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new em,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new em,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Jh,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Jh),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new em,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Jh,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Jh),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){a=!0;for(const a of t.hand.values()){const t=e.getJointPose(a,n),i=this._getHandJoint(l,a);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=t.radius),i.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(nm)))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new em;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class rm{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new Yp(t),this.density=e}clone(){return new rm(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class am{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Yp(t),this.near=e,this.far=n}clone(){return new am(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class om extends Ip{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new pp,this.environmentIntensity=1,this.environmentRotation=new pp,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class sm{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=xh,this.updateRanges=[],this.version=0,this.uuid=Vh()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Vh()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Vh()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const lm=new Jh;class cm{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)lm.fromBufferAttribute(this,e),lm.applyMatrix4(t),this.setXYZ(e,lm.x,lm.y,lm.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)lm.fromBufferAttribute(this,e),lm.applyNormalMatrix(t),this.setXYZ(e,lm.x,lm.y,lm.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)lm.fromBufferAttribute(this,e),lm.transformDirection(t),this.setXYZ(e,lm.x,lm.y,lm.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=qh(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Zh(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=Zh(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Zh(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Zh(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Zh(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=qh(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=qh(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=qh(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=qh(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array),i=Zh(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Zh(e,this.array),n=Zh(n,this.array),i=Zh(i,this.array),r=Zh(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new cf(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new cm(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class um extends $p{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Yp(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let hm;const dm=new Jh,pm=new Jh,fm=new Jh,mm=new Yh,gm=new Yh,ym=new ip,vm=new Jh,_m=new Jh,bm=new Jh,xm=new Yh,wm=new Yh,Sm=new Yh;class Mm extends Ip{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new um;if(super(),this.isSprite=!0,this.type="Sprite",void 0===hm){hm=new Af;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new sm(t,5);hm.setIndex([0,1,2,0,2,3]),hm.setAttribute("position",new cm(e,3,0,!1)),hm.setAttribute("uv",new cm(e,2,3,!1))}this.geometry=hm,this.material=t,this.center=new Yh(.5,.5),this.count=1}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),pm.setFromMatrixScale(this.matrixWorld),ym.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),fm.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&pm.multiplyScalar(-fm.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const a=this.center;Tm(vm.set(-.5,-.5,0),fm,a,pm,i,r),Tm(_m.set(.5,-.5,0),fm,a,pm,i,r),Tm(bm.set(.5,.5,0),fm,a,pm,i,r),xm.set(0,0),wm.set(1,0),Sm.set(1,1);let o=t.ray.intersectTriangle(vm,_m,bm,!1,dm);if(null===o&&(Tm(_m.set(-.5,.5,0),fm,a,pm,i,r),wm.set(0,1),o=t.ray.intersectTriangle(vm,bm,_m,!1,dm),null===o))return;const s=t.ray.origin.distanceTo(dm);s<t.near||s>t.far||e.push({distance:s,point:dm.clone(),uv:Gp.getInterpolation(dm,vm,_m,bm,xm,wm,Sm,new Yh),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Tm(t,e,n,i,r,a){mm.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(gm.x=a*mm.x-r*mm.y,gm.y=r*mm.x+a*mm.y):gm.copy(mm),t.copy(e),t.x+=gm.x,t.y+=gm.y,t.applyMatrix4(ym)}const Am=new Jh,Em=new Jh;class Cm extends Ip{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let n=0,i=e.length;n<i;n++){const t=e[n];this.addLevel(t.object.clone(),t.distance,t.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e=Math.abs(e);const i=this.levels;let r;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}removeLevel(t){const e=this.levels;for(let n=0;n<e.length;n++)if(e[n].distance===t){const t=e.splice(n,1);return this.remove(t[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i;n++){let i=e[n].distance;if(e[n].object.visible&&(i-=i*e[n].hysteresis),t<i)break}return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Am.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Am);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Am.setFromMatrixPosition(t.matrixWorld),Em.setFromMatrixPosition(this.matrixWorld);const n=Am.distanceTo(Em)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r;i++){let t=e[i].distance;if(e[i].object.visible&&(t-=t*e[i].hysteresis),!(n>=t))break;e[i-1].object.visible=!1,e[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const t=n[i];e.object.levels.push({object:t.object.uuid,distance:t.distance,hysteresis:t.hysteresis})}return e}}const Pm=new Jh,Im=new Sd,Lm=new Sd,km=new Jh,Rm=new ip,Dm=new Jh,Nm=new Xd,zm=new ip,Fm=new np;class Om extends Of{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ic,this.bindMatrix=new ip,this.bindMatrixInverse=new ip,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Id),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,Dm),this.boundingBox.expandByPoint(Dm)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Xd),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,Dm),this.boundingSphere.expandByPoint(Dm)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Nm.copy(this.boundingSphere),Nm.applyMatrix4(i),!1!==t.ray.intersectsSphere(Nm)&&(zm.copy(i).invert(),Fm.copy(t.ray).applyMatrix4(zm),null!==this.boundingBox&&!1===Fm.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Fm)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Sd,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===ic?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===rc?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;Im.fromBufferAttribute(i.attributes.skinIndex,t),Lm.fromBufferAttribute(i.attributes.skinWeight,t),Pm.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const t=Lm.getComponent(r);if(0!==t){const i=Im.getComponent(r);Rm.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(km.copy(Pm).applyMatrix4(Rm),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Bm extends Ip{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Um extends wd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:fc,arguments.length>9&&void 0!==arguments[9]?arguments[9]:fc,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const jm=new ip,Vm=new ip;class Hm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Vh(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ip)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new ip;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,a=t.length;r<a;r++){const i=t[r]?t[r].matrixWorld:Vm;jm.multiplyMatrices(i,e[r]),jm.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Hm(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Um(e,t,t,Bc,Ic);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Bm),this.bones.push(r),this.boneInverses.push((new ip).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const a=n[i];t.boneInverses.push(a.toArray())}return t}}class Gm extends cf{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Wm=new ip,qm=new ip,Zm=[],Xm=new Id,Ym=new ip,Km=new Of,Jm=new Xd;class $m extends Of{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Gm(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Ym)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Id),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Wm),Xm.copy(t.boundingBox).applyMatrix4(Wm),this.boundingBox.union(Xm)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Xd),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Wm),Jm.copy(t.boundingSphere).applyMatrix4(Wm),this.boundingSphere.union(Jm)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,r=t*(n.length+1)+1;for(let a=0;a<n.length;a++)n[a]=i[r+a]}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Km.geometry=this.geometry,Km.material=this.material,void 0!==Km.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Jm.copy(this.boundingSphere),Jm.applyMatrix4(n),!1!==t.ray.intersectsSphere(Jm)))for(let r=0;r<i;r++){this.getMatrixAt(r,Wm),qm.multiplyMatrices(n,Wm),Km.matrixWorld=qm,Km.raycast(t,Zm);for(let t=0,n=Zm.length;t<n;t++){const n=Zm[t];n.instanceId=r,n.object=this,e.push(n)}Zm.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Gm(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new Um(new Float32Array(i*this.count),i,this.count,Vc,Ic));const r=this.morphTexture.source.data.data;let a=0;for(let l=0;l<n.length;l++)a+=n[l];const o=this.geometry.morphTargetsRelative?1:1-a,s=i*t;r[s]=o,r.set(n,s+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Qm=new Jh,tg=new Jh,eg=new td;class ng{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Qm.subVectors(n,e).cross(tg.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(Qm),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||eg.getNormalMatrix(t),i=this.coplanarPoint(Qm).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ig=new Xd,rg=new Yh(.5,.5),ag=new Jh;class og{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ng,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ng,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ng,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ng,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ng,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new ng;this.planes=[t,e,n,i,r,a]}set(t,e,n,i,r,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kh,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.planes,r=t.elements,a=r[0],o=r[1],s=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],p=r[8],f=r[9],m=r[10],g=r[11],y=r[12],v=r[13],_=r[14],b=r[15];if(i[0].setComponents(l-a,d-c,g-p,b-y).normalize(),i[1].setComponents(l+a,d+c,g+p,b+y).normalize(),i[2].setComponents(l+o,d+u,g+f,b+v).normalize(),i[3].setComponents(l-o,d-u,g-f,b-v).normalize(),n)i[4].setComponents(s,h,m,_).normalize(),i[5].setComponents(l-s,d-h,g-m,b-_).normalize();else if(i[4].setComponents(l-s,d-h,g-m,b-_).normalize(),e===kh)i[5].setComponents(l+s,d+h,g+m,b+_).normalize();else{if(e!==Rh)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(s,h,m,_).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),ig.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),ig.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(ig)}intersectsSprite(t){ig.center.set(0,0,0);const e=rg.distanceTo(t.center);return ig.radius=.7071067811865476+e,ig.applyMatrix4(t.matrixWorld),this.intersectsSphere(ig)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(ag.x=i.normal.x>0?t.max.x:t.min.x,ag.y=i.normal.y>0?t.max.y:t.min.y,ag.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(ag)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const sg=new ip,lg=new og;class cg{constructor(){this.coordinateSystem=kh}intersectsObject(t,e){if(!e.isArrayCamera||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(sg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),lg.setFromProjectionMatrix(sg,i.coordinateSystem,i.reversedDepth),lg.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(sg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),lg.setFromProjectionMatrix(sg,i.coordinateSystem,i.reversedDepth),lg.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(sg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),lg.setFromProjectionMatrix(sg,i.coordinateSystem,i.reversedDepth),lg.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(sg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),lg.setFromProjectionMatrix(sg,i.coordinateSystem,i.reversedDepth),lg.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(sg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),lg.setFromProjectionMatrix(sg,i.coordinateSystem,i.reversedDepth),lg.containsPoint(t))return!0}return!1}clone(){return new cg}}function ug(t,e){return t-e}function hg(t,e){return t.z-e.z}function dg(t,e){return e.z-t.z}class pg{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,n,i){const r=this.pool,a=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const o=r[this.index];a.push(o),this.index++,o.start=t,o.count=e,o.z=n,o.index=i}reset(){this.list.length=0,this.index=0}}const fg=new ip,mg=new Yp(1,1,1),gg=new og,yg=new cg,vg=new Id,_g=new Xd,bg=new Jh,xg=new Jh,wg=new Jh,Sg=new pg,Mg=new Of,Tg=[];function Ag(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let a=0;a<r;a++)for(let r=0;r<i;r++)e.setComponent(a+n,r,t.getComponent(a,r))}else e.array.set(t.array,n*i);e.needsUpdate=!0}function Eg(t,e){if(t.constructor!==e.constructor){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++)e[i]=t[i]}else{const n=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,n))}}class Cg extends Of{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*e,i=arguments.length>3?arguments[3]:void 0;super(new Af,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(4*this._maxInstanceCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new Um(e,t,t,Bc,Ic);this._matricesTexture=n}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),n=new Um(e,t,t,Hc,Pc);this._indirectTexture=n}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),n=new Um(e,t,t,Bc,Ic);n.colorSpace=dd.workingColorSpace,this._colorsTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const r=t.getAttribute(i),{array:a,itemSize:o,normalized:s}=r,l=new a.constructor(n*o),c=new cf(l,o,s);e.setAttribute(i,c)}if(null!==t.getIndex()){const t=n>65535?new Uint32Array(i):new Uint16Array(i);e.setIndex(new cf(t,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(!t.hasAttribute(n))throw new Error('THREE.BatchedMesh: Added geometry missing "'.concat(n,'". All geometries must have consistent attributes.'));const i=t.getAttribute(n),r=e.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error("THREE.BatchedMesh: Invalid instanceId ".concat(t,". Instance is either out of range or has been deleted."))}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error("THREE.BatchedMesh: Invalid geometryId ".concat(t,". Geometry is either out of range or has been deleted."))}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Id);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let n=0,i=e.length;n<i;n++){if(!1===e[n].active)continue;const i=e[n].geometryIndex;this.getMatrixAt(n,fg),this.getBoundingBoxAt(i,vg).applyMatrix4(fg),t.union(vg)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Xd);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let n=0,i=e.length;n<i;n++){if(!1===e[n].active)continue;const i=e[n].geometryIndex;this.getMatrixAt(n,fg),this.getBoundingSphereAt(i,_g).applyMatrix4(fg),t.union(_g)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const e={visible:!0,active:!0,geometryIndex:t};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ug),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=e):(n=this._instanceInfo.length,this._instanceInfo.push(e));const i=this._matricesTexture;fg.identity().toArray(i.image.data,16*n),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(mg.toArray(r.image.data,4*n),r.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(t),this._validateGeometry(t);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===e?t.getAttribute("position").count:e;const a=t.getIndex();if(null!==a&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===n?a.count:n),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ug),o=this._availableGeometryIds.shift(),r[o]=i):(o=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(o,t),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,o}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),a=e.getIndex(),o=this._geometryInfo[t];if(i&&a.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const s=o.vertexStart,l=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const c in n.attributes){const t=e.getAttribute(c),i=n.getAttribute(c);Ag(t,i,s);const r=t.itemSize;for(let e=t.count,n=l;e<n;e++){const t=s+e;for(let e=0;e<r;e++)i.setComponent(t,e,0)}i.needsUpdate=!0,i.addUpdateRange(s*r,l*r)}if(i){const t=o.indexStart,n=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let e=0;e<a.count;e++)r.setX(t+e,s+a.getX(e));for(let e=a.count,i=n;e<i;e++)r.setX(t+e,s);r.needsUpdate=!0,r.addUpdateRange(t,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,null!==e.boundingBox&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,null!==e.boundingSphere&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||!1===e[t].active)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===t&&this.deleteInstance(i);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const n=this._geometryInfo,i=n.map((t,e)=>e).sort((t,e)=>n[t].vertexStart-n[e].vertexStart),r=this.geometry;for(let a=0,o=n.length;a<o;a++){const o=i[a],s=n[o];if(!1!==s.active){if(null!==r.index){if(s.indexStart!==e){const{indexStart:n,vertexStart:i,reservedIndexCount:a}=s,o=r.index,l=o.array,c=t-i;for(let t=n;t<n+a;t++)l[t]=l[t]+c;o.array.copyWithin(e,n,n+a),o.addUpdateRange(e,a),s.indexStart=e}e+=s.reservedIndexCount}if(s.vertexStart!==t){const{vertexStart:e,reservedVertexCount:n}=s,i=r.attributes;for(const r in i){const a=i[r],{array:o,itemSize:s}=a;o.copyWithin(t*s,e*s,(e+n)*s),a.addUpdateRange(t*s,n*s)}s.vertexStart=t}t+=s.reservedVertexCount,s.start=r.index?s.indexStart:s.vertexStart,this._nextIndexStart=r.index?s.indexStart+s.reservedIndexCount:0,this._nextVertexStart=s.vertexStart+s.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[t];if(null===i.boundingBox){const t=new Id,e=n.index,r=n.attributes.position;for(let n=i.start,a=i.start+i.count;n<a;n++){let i=n;e&&(i=e.getX(i)),t.expandByPoint(bg.fromBufferAttribute(r,i))}i.boundingBox=t}return e.copy(i.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[t];if(null===i.boundingSphere){const e=new Xd;this.getBoundingBoxAt(t,vg),vg.getCenter(e.center);const r=n.index,a=n.attributes.position;let o=0;for(let t=i.start,n=i.start+i.count;t<n;t++){let n=t;r&&(n=r.getX(n)),bg.fromBufferAttribute(a,n),o=Math.max(o,e.center.distanceToSquared(bg))}e.radius=Math.sqrt(o),i.boundingSphere=e}return e.copy(i.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const n=this._matricesTexture,i=this._matricesTexture.image.data;return e.toArray(i,16*t),n.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,16*t)}setColorAt(t,e){return this.validateInstanceId(t),null===this._colorsTexture&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,4*t),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,4*t)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e||(this._instanceInfo[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(t);const n=this._geometryInfo[t];return e.vertexStart=n.vertexStart,e.vertexCount=n.vertexCount,e.reservedVertexCount=n.reservedVertexCount,e.indexStart=n.indexStart,e.indexCount=n.indexCount,e.reservedIndexCount=n.reservedIndexCount,e.start=n.start,e.count=n.count,e}setInstanceCount(t){const e=this._availableInstanceIds,n=this._instanceInfo;for(e.sort(ug);e[e.length-1]===n.length-1;)n.pop(),e.pop();if(t<n.length)throw new Error("BatchedMesh: Instance ids outside the range ".concat(t," are being used. Cannot shrink instance count."));const i=new Int32Array(t),r=new Int32Array(t);Eg(this._multiDrawCounts,i),Eg(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=t;const a=this._indirectTexture,o=this._matricesTexture,s=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Eg(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Eg(o.image.data,this._matricesTexture.image.data),s&&(s.dispose(),this._initColorsTexture(),Eg(s.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const n=[...this._geometryInfo].filter(t=>t.active);if(Math.max(...n.map(t=>t.vertexStart+t.reservedVertexCount))>t)throw new Error("BatchedMesh: Geometry vertex values are being used outside the range ".concat(e,". Cannot shrink further."));if(this.geometry.index){if(Math.max(...n.map(t=>t.indexStart+t.reservedIndexCount))>e)throw new Error("BatchedMesh: Geometry index values are being used outside the range ".concat(e,". Cannot shrink further."))}const i=this.geometry;i.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Af,this._initializeGeometry(i));const r=this.geometry;i.index&&Eg(i.index.array,r.index.array);for(const a in i.attributes)Eg(i.attributes[a].array,r.attributes[a].array)}raycast(t,e){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,a=this.geometry;Mg.material=this.material,Mg.geometry.index=a.index,Mg.geometry.attributes=a.attributes,null===Mg.geometry.boundingBox&&(Mg.geometry.boundingBox=new Id),null===Mg.geometry.boundingSphere&&(Mg.geometry.boundingSphere=new Xd);for(let o=0,s=n.length;o<s;o++){if(!n[o].visible||!n[o].active)continue;const a=n[o].geometryIndex,s=i[a];Mg.geometry.setDrawRange(s.start,s.count),this.getMatrixAt(o,Mg.matrixWorld).premultiply(r),this.getBoundingBoxAt(a,Mg.geometry.boundingBox),this.getBoundingSphereAt(a,Mg.geometry.boundingSphere),Mg.raycast(t,Tg);for(let t=0,n=Tg.length;t<n;t++){const n=Tg[t];n.object=this,n.batchId=o,e.push(n)}Tg.length=0}Mg.material=null,Mg.geometry.index=null,Mg.geometry.attributes={},Mg.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(t=>kt(kt({},t),{},{boundingBox:null!==t.boundingBox?t.boundingBox.clone():null,boundingSphere:null!==t.boundingSphere?t.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(t=>kt({},t)),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,e,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=null===a?1:a.array.BYTES_PER_ELEMENT,s=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data,f=n.isArrayCamera?yg:gg;h&&!n.isArrayCamera&&(fg.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),gg.setFromProjectionMatrix(fg,n.coordinateSystem,n.reversedDepth));let m=0;if(this.sortObjects){fg.copy(this.matrixWorld).invert(),bg.setFromMatrixPosition(n.matrixWorld).applyMatrix4(fg),xg.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(fg);for(let i=0,r=s.length;i<r;i++)if(s[i].visible&&s[i].active){const t=s[i].geometryIndex;this.getMatrixAt(i,fg),this.getBoundingSphereAt(t,_g).applyMatrix4(fg);let e=!1;if(h&&(e=!f.intersectsSphere(_g,n)),!e){const e=u[t],n=wg.subVectors(_g.center,bg).dot(xg);Sg.push(e.start,e.count,n,i)}}const t=Sg.list,e=this.customSort;null===e?t.sort(r.transparent?dg:hg):e.call(this,t,n);for(let n=0,i=t.length;n<i;n++){const e=t[n];l[m]=e.start*o,c[m]=e.count,p[m]=e.index,m++}Sg.reset()}else for(let g=0,y=s.length;g<y;g++)if(s[g].visible&&s[g].active){const t=s[g].geometryIndex;let e=!1;if(h&&(this.getMatrixAt(g,fg),this.getBoundingSphereAt(t,_g).applyMatrix4(fg),e=!f.intersectsSphere(_g,n)),!e){const e=u[t];l[m]=e.start*o,c[m]=e.count,p[m]=g,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(t,e,n,i,r,a){this.onBeforeRender(t,null,i,r,a)}}class Pg extends $p{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Yp(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Ig=new Jh,Lg=new Jh,kg=new ip,Rg=new np,Dg=new Xd,Ng=new Jh,zg=new Jh;class Fg extends Ip{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Af,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pg;super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Ig.fromBufferAttribute(e,t-1),Lg.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Ig.distanceTo(Lg);t.setAttribute("lineDistance",new vf(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Dg.copy(n.boundingSphere),Dg.applyMatrix4(i),Dg.radius+=r,!1===t.ray.intersectsSphere(Dg))return;kg.copy(i).invert(),Rg.copy(t.ray).applyMatrix4(kg);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);for(let r=n,a=i-1;r<a;r+=l){const n=c.getX(r),i=c.getX(r+1),a=Og(this,t,Rg,s,n,i,r);a&&e.push(a)}if(this.isLineLoop){const r=c.getX(i-1),a=c.getX(n),o=Og(this,t,Rg,s,r,a,i-1);o&&e.push(o)}}else{const n=Math.max(0,a.start),i=Math.min(u.count,a.start+a.count);for(let r=n,a=i-1;r<a;r+=l){const n=Og(this,t,Rg,s,r,r+1,r);n&&e.push(n)}if(this.isLineLoop){const r=Og(this,t,Rg,s,i-1,n,i-1);r&&e.push(r)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Og(t,e,n,i,r,a,o){const s=t.geometry.attributes.position;Ig.fromBufferAttribute(s,r),Lg.fromBufferAttribute(s,a);if(n.distanceSqToSegment(Ig,Lg,Ng,zg)>i)return;Ng.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(Ng);return l<e.near||l>e.far?void 0:{distance:l,point:zg.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}const Bg=new Jh,Ug=new Jh;class jg extends Fg{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Bg.fromBufferAttribute(e,t),Ug.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Bg.distanceTo(Ug);t.setAttribute("lineDistance",new vf(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Vg extends Fg{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Hg extends $p{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Yp(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Gg=new ip,Wg=new np,qg=new Xd,Zg=new Jh;class Xg extends Ip{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Af,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hg;super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),qg.copy(n.boundingSphere),qg.applyMatrix4(i),qg.radius+=r,!1===t.ray.intersectsSphere(qg))return;Gg.copy(i).invert(),Wg.copy(t.ray).applyMatrix4(Gg);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,a.start),r=Math.min(l.count,a.start+a.count);n<r;n++){const r=l.getX(n);Zg.fromBufferAttribute(c,r),Yg(Zg,r,s,i,t,e,this)}}else{for(let n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);n<r;n++)Zg.fromBufferAttribute(c,n),Yg(Zg,n,s,i,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Yg(t,e,n,i,r,a,o){const s=Wg.distanceSqToPoint(t);if(s<n){const n=new Jh;Wg.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Kg extends wd{constructor(t,e,n,i){super(t,e,n,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:_c,arguments.length>5&&void 0!==arguments[5]?arguments[5]:_c,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const r=this;"requestVideoFrameCallback"in t&&(this._requestVideoFrameCallbackId=t.requestVideoFrameCallback(function e(){r.needsUpdate=!0,r._requestVideoFrameCallbackId=t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class Jg extends Kg{constructor(t,e,n,i,r,a,o,s){super({},t,e,n,i,r,a,o,s),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class $g extends wd{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=fc,this.minFilter=fc,this.generateMipmaps=!1,this.needsUpdate=!0}}class Qg extends wd{constructor(t,e,n,i,r,a,o,s,l,c,u,h){super(null,a,o,s,l,c,i,r,u,h),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class ty extends Qg{constructor(t,e,n,i,r,a){super(t,e,n,r,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=dc,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class ey extends Qg{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,oc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class ny extends wd{constructor(t,e,n,i,r,a,o,s,l){super(t,e,n,i,r,a,o,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class iy extends wd{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pc,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:fc,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:fc,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Uc,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;if(c!==Uc&&c!==jc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:t,height:e,depth:u},i,r,a,o,s,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new vd(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class ry extends wd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.sourceTexture=t,this.isExternalTexture=!0}copy(t){return super.copy(t),this.sourceTexture=t.sourceTexture,this}}class ay extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:n,radialSegments:i,heightSegments:r},e=Math.max(0,e),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),r=Math.max(1,Math.floor(r));const a=[],o=[],s=[],l=[],c=e/2,u=Math.PI/2*t,h=e,d=2*u+h,p=2*n+r,f=i+1,m=new Jh,g=new Jh;for(let y=0;y<=p;y++){let v=0,_=0,b=0,x=0;if(y<=n){const e=y/n,i=e*Math.PI/2;_=-c-t*Math.cos(i),b=t*Math.sin(i),x=-t*Math.cos(i),v=e*u}else if(y<=n+r){const i=(y-n)/r;_=i*e-c,b=t,x=0,v=u+i*h}else{const e=(y-n-r)/n,i=e*Math.PI/2;_=c+t*Math.sin(i),b=t*Math.cos(i),x=t*Math.sin(i),v=u+h+e*u}const w=Math.max(0,Math.min(1,v/d));let S=0;0===y?S=.5/i:y===p&&(S=-.5/i);for(let t=0;t<=i;t++){const e=t/i,n=e*Math.PI*2,r=Math.sin(n),a=Math.cos(n);g.x=-b*a,g.y=_,g.z=b*r,o.push(g.x,g.y,g.z),m.set(-b*a,x,b*r),m.normalize(),s.push(m.x,m.y,m.z),l.push(e+S,w)}if(y>0){const t=(y-1)*f;for(let e=0;e<i;e++){const n=t+e,i=t+e+1,r=y*f+e,o=y*f+e+1;a.push(n,i,r),a.push(i,o,r)}}}this.setIndex(a),this.setAttribute("position",new vf(o,3)),this.setAttribute("normal",new vf(s,3)),this.setAttribute("uv",new vf(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ay(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class oy extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],a=[],o=[],s=[],l=new Jh,c=new Yh;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let u=0,h=3;u<=e;u++,h+=3){const r=n+u/e*i;l.x=t*Math.cos(r),l.y=t*Math.sin(r),a.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(a[h]/t+1)/2,c.y=(a[h+1]/t+1)/2,s.push(c.x,c.y)}for(let u=1;u<=e;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new vf(a,3)),this.setAttribute("normal",new vf(o,3)),this.setAttribute("uv",new vf(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new oy(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class sy extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const r=p,a=new Yh,f=new Jh;let y=0;const v=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=i;t++)u.push(0,m*_,0),h.push(0,_,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i*s+o,n=Math.cos(e),r=Math.sin(e);f.x=v*r,f.y=m*_,f.z=v*n,u.push(f.x,f.y,f.z),h.push(0,_,0),a.x=.5*n+.5,a.y=.5*r*_+.5,d.push(a.x,a.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const a=new Jh,y=new Jh;let v=0;const _=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*s+o,l=Math.sin(r),f=Math.cos(r);y.x=v*l,y.y=-g*n+m,y.z=v*f,u.push(y.x,y.y,y.z),a.set(l,_,f).normalize(),h.push(a.x,a.y,a.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let n=0;n<i;n++)for(let i=0;i<r;i++){const a=f[i][n],o=f[i+1][n],s=f[i+1][n+1],l=f[i][n+1];(t>0||0!==i)&&(c.push(a,o,l),v+=3),(e>0||i!==r-1)&&(c.push(o,s,l),v+=3)}l.addGroup(g,v,0),g+=v}(),!1===a&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new vf(u,3)),this.setAttribute("normal",new vf(h,3)),this.setAttribute("uv",new vf(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new sy(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ly extends sy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,t,e,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(t){return new ly(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class cy extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],a=[];function o(t,e,n,i){const r=i+1,a=[];for(let o=0;o<=r;o++){a[o]=[];const i=t.clone().lerp(n,o/r),s=e.clone().lerp(n,o/r),l=r-o;for(let t=0;t<=l;t++)a[o][t]=0===t&&o===r?i:i.clone().lerp(s,t/l)}for(let o=0;o<r;o++)for(let t=0;t<2*(r-o)-1;t++){const e=Math.floor(t/2);t%2===0?(s(a[o][e+1]),s(a[o+1][e]),s(a[o][e])):(s(a[o][e+1]),s(a[o+1][e+1]),s(a[o+1][e]))}}function s(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(a[e]=t.x-1),0===n.x&&0===n.z&&(a[e]=i/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){const n=new Jh,i=new Jh,r=new Jh;for(let a=0;a<e.length;a+=3)l(e[a+0],n),l(e[a+1],i),l(e[a+2],r),o(n,i,r,t)}(i),function(t){const e=new Jh;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Jh;for(let e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];const n=u(t)/2/Math.PI+.5,i=h(t)/Math.PI+.5;a.push(n,1-i)}(function(){const t=new Jh,e=new Jh,n=new Jh,i=new Jh,o=new Yh,s=new Yh,l=new Yh;for(let h=0,d=0;h<r.length;h+=9,d+=6){t.set(r[h+0],r[h+1],r[h+2]),e.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=u(i);c(o,d+0,t,p),c(s,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<a.length;t+=6){const e=a[t+0],n=a[t+2],i=a[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(a[t+0]+=1),n<.2&&(a[t+2]+=1),i<.2&&(a[t+4]+=1))}}()}(),this.setAttribute("position",new vf(r,3)),this.setAttribute("normal",new vf(r.slice(),3)),this.setAttribute("uv",new vf(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new cy(t.vertices,t.indices,t.radius,t.details)}}class uy extends cy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new uy(t.radius,t.detail)}}const hy=new Jh,dy=new Jh,py=new Jh,fy=new Gp;class my extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(Uh*e),a=t.getIndex(),o=t.getAttribute("position"),s=a?a.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let t=0;t<s;t+=3){a?(l[0]=a.getX(t),l[1]=a.getX(t+1),l[2]=a.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:s}=fy;if(e.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),s.fromBufferAttribute(o,l[2]),fy.getNormal(py),u[0]="".concat(Math.round(e.x*i),",").concat(Math.round(e.y*i),",").concat(Math.round(e.z*i)),u[1]="".concat(Math.round(n.x*i),",").concat(Math.round(n.y*i),",").concat(Math.round(n.z*i)),u[2]="".concat(Math.round(s.x*i),",").concat(Math.round(s.y*i),",").concat(Math.round(s.z*i)),u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=u[t],i=u[e],a=fy[c[t]],o=fy[c[e]],s="".concat(n,"_").concat(i),p="".concat(i,"_").concat(n);p in h&&h[p]?(py.dot(h[p].normal)<=r&&(d.push(a.x,a.y,a.z),d.push(o.x,o.y,o.z)),h[p]=null):s in h||(h[s]={index0:l[t],index1:l[e],normal:py.clone()})}}for(const t in h)if(h[t]){const{index0:e,index1:n}=h[t];hy.fromBufferAttribute(o,e),dy.fromBufferAttribute(o,n),d.push(hy.x,hy.y,hy.z),d.push(dy.x,dy.y,dy.z)}this.setAttribute("position",new vf(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class gy{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getLengths();let i=0;const r=n.length;let a;a=e||t*n[r-1];let o,s=0,l=r-1;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),o=n[i]-a,o<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===a)return i/(r-1);const c=n[i];return(i+(a-c)/(n[i+1]-c))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const a=this.getPoint(i),o=this.getPoint(r),s=e||(a.isVector2?new Yh:new Jh);return s.copy(o).sub(a).normalize(),s}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new Jh,i=[],r=[],a=[],o=new Jh,s=new ip;for(let d=0;d<=t;d++){const e=d/t;i[d]=this.getTangentAt(e,new Jh)}r[0]=new Jh,a[0]=new Jh;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),a[d]=a[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Hh(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(s.makeRotationAxis(o,t))}a[d].crossVectors(i[d],r[d])}if(!0===e){let e=Math.acos(Hh(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(s.makeRotationAxis(i[n],e*n)),a[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class yy extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const r=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);const a=this.aStartAngle+t*i;let o=this.aX+this.xRadius*Math.cos(a),s=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=s-this.aY;o=n*t-i*e+this.aX,s=n*e+i*t+this.aY}return e.set(o,s)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class vy extends yy{constructor(t,e,n,i,r,a){super(t,e,n,n,i,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function _y(){let t=0,e=0,n=0,i=0;function r(r,a,o,s){t=r,e=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(t,e,n,i,a){r(e,n,a*(n-t),a*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,a,o,s){let l=(e-t)/a-(n-t)/(a+o)+(n-e)/o,c=(n-e)/o-(i-e)/(o+s)+(i-n)/s;l*=o,c*=o,r(e,n,l,c)},calc:function(r){const a=r*r;return t+e*r+n*a+i*(a*r)}}}const by=new Jh,xy=new _y,wy=new _y,Sy=new _y;class My extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=this.points,i=n.length,r=(i-(this.closed?0:1))*t;let a,o,s=Math.floor(r),l=r-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/i)+1)*i:0===l&&s===i-1&&(s=i-2,l=1),this.closed||s>0?a=n[(s-1)%i]:(by.subVectors(n[0],n[1]).add(n[0]),a=by);const c=n[s%i],u=n[(s+1)%i];if(this.closed||s+2<i?o=n[(s+2)%i]:(by.subVectors(n[i-1],n[i-2]).add(n[i-1]),o=by),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),xy.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,n,i),wy.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,n,i),Sy.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(xy.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),wy.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),Sy.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return e.set(xy.calc(l),wy.calc(l),Sy.calc(l)),e}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Jh).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ty(t,e,n,i,r){const a=.5*(i-e),o=.5*(r-n),s=t*t;return(2*n-2*i+a+o)*(t*s)+(-3*n+3*i-2*a-o)*s+a*t+n}function Ay(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Ey(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class Cy extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yh,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Yh;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return e.set(Ey(t,n.x,i.x,r.x,a.x),Ey(t,n.y,i.y,r.y,a.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Py extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Jh,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Jh;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return e.set(Ey(t,n.x,i.x,r.x,a.x),Ey(t,n.y,i.y,r.y,a.y),Ey(t,n.z,i.z,r.z,a.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Iy extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh).subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ly extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh).subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ky extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yh;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh,n=this.v0,i=this.v1,r=this.v2;return e.set(Ay(t,n.x,i.x,r.x),Ay(t,n.y,i.y,r.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ry extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Jh;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=this.v0,i=this.v1,r=this.v2;return e.set(Ay(t,n.x,i.x,r.x),Ay(t,n.y,i.y,r.y),Ay(t,n.z,i.z,r.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Dy extends gy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh,n=this.points,i=(n.length-1)*t,r=Math.floor(i),a=i-r,o=n[0===r?r:r-1],s=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return e.set(Ty(a,o.x,s.x,l.x,c.x),Ty(a,o.y,s.y,l.y,c.y)),e}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Yh).fromArray(n))}return this}}var Ny=Object.freeze({__proto__:null,ArcCurve:vy,CatmullRomCurve3:My,CubicBezierCurve:Cy,CubicBezierCurve3:Py,EllipseCurve:yy,LineCurve:Iy,LineCurve3:Ly,QuadraticBezierCurve:ky,QuadraticBezierCurve3:Ry,SplineCurve:Dy});class zy extends gy{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ny[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,a=this.curves[r],o=a.getLength(),s=0===o?0:1-t/o;return a.getPointAt(s,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const a=r[i],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o);for(let t=0;t<s.length;t++){const i=s[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Ny[n.type]).fromJSON(n))}return this}}class Fy extends zy{constructor(t){super(),this.type="Path",this.currentPoint=new Yh,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new Iy(this.currentPoint.clone(),new Yh(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new ky(this.currentPoint.clone(),new Yh(t,e),new Yh(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,a){const o=new Cy(this.currentPoint.clone(),new Yh(t,e),new Yh(n,i),new Yh(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Dy(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+o,e+s,n,i,r,a),this}absarc(t,e,n,i,r,a){return this.absellipse(t,e,n,n,i,r,a),this}ellipse(t,e,n,i,r,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,a,o,s),this}absellipse(t,e,n,i,r,a,o,s){const l=new yy(t,e,n,i,r,a,o,s);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Oy extends Fy{constructor(t){super(t),this.uuid=Vh(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Fy).fromJSON(n))}return this}}function By(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=e&&e.length,r=i?e[0]*n:t.length;let a=Uy(t,0,r,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(i&&(a=function(t,e,n,i){const r=[];for(let a=0,o=e.length;a<o;a++){const n=Uy(t,e[a]*i,a<o-1?e[a+1]*i:t.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Jy(n))}r.sort(Zy);for(let a=0;a<r.length;a++)n=Xy(r[a],n);return n}(t,e,a,n)),t.length>80*n){s=1/0,l=1/0;let e=-1/0,i=-1/0;for(let a=n;a<r;a+=n){const n=t[a],r=t[a+1];n<s&&(s=n),r<l&&(l=r),n>e&&(e=n),r>i&&(i=r)}c=Math.max(e-s,i-l),c=0!==c?32767/c:0}return Vy(a,o,n,s,l,c,0),o}function Uy(t,e,n,i,r){let a;if(r===function(t,e,n,i){let r=0;for(let a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(let o=e;o<n;o+=i)a=lv(o/i|0,t[o],t[o+1],a);else for(let o=n-i;o>=e;o-=i)a=lv(o/i|0,t[o],t[o+1],a);return a&&nv(a,a.next)&&(cv(a),a=a.next),a}function jy(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!nv(i,i.next)&&0!==ev(i.prev,i,i.next))i=i.next;else{if(cv(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function Vy(t,e,n,i,r,a,o){if(!t)return;!o&&a&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=Ky(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n=1;do{let i,r=t;t=null;let a=null;for(e=0;r;){e++;let o=r,s=0;for(let t=0;t<n&&(s++,o=o.nextZ,o);t++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||r.z<=o.z)?(i=r,r=r.nextZ,s--):(i=o,o=o.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=o}a.nextZ=null,n*=2}while(e>1)}(r)}(t,i,r,a);let s=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(a?Gy(t,i,r,a):Hy(t))e.push(l.i,t.i,c.i),cv(t),t=c.next,s=c.next;else if((t=c)===s){o?1===o?Vy(t=Wy(jy(t),e),e,n,i,r,a,2):2===o&&qy(t,e,n,i,r,a):Vy(jy(t),e,n,i,r,a,1);break}}}function Hy(t){const e=t.prev,n=t,i=t.next;if(ev(e,n,i)>=0)return!1;const r=e.x,a=n.x,o=i.x,s=e.y,l=n.y,c=i.y,u=Math.min(r,a,o),h=Math.min(s,l,c),d=Math.max(r,a,o),p=Math.max(s,l,c);let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Qy(r,s,a,l,o,c,f.x,f.y)&&ev(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Gy(t,e,n,i){const r=t.prev,a=t,o=t.next;if(ev(r,a,o)>=0)return!1;const s=r.x,l=a.x,c=o.x,u=r.y,h=a.y,d=o.y,p=Math.min(s,l,c),f=Math.min(u,h,d),m=Math.max(s,l,c),g=Math.max(u,h,d),y=Ky(p,f,e,n,i),v=Ky(m,g,e,n,i);let _=t.prevZ,b=t.nextZ;for(;_&&_.z>=y&&b&&b.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&Qy(s,u,l,h,c,d,_.x,_.y)&&ev(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&Qy(s,u,l,h,c,d,b.x,b.y)&&ev(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&Qy(s,u,l,h,c,d,_.x,_.y)&&ev(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&Qy(s,u,l,h,c,d,b.x,b.y)&&ev(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Wy(t,e){let n=t;do{const i=n.prev,r=n.next.next;!nv(i,r)&&iv(i,n,n.next,r)&&ov(i,r)&&ov(r,i)&&(e.push(i.i,n.i,r.i),cv(n),cv(n.next),n=t=r),n=n.next}while(n!==t);return jy(n)}function qy(t,e,n,i,r,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&tv(o,t)){let s=sv(o,t);return o=jy(o,o.next),s=jy(s,s.next),Vy(o,e,n,i,r,a,0),void Vy(s,e,n,i,r,a,0)}t=t.next}o=o.next}while(o!==t)}function Zy(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function Xy(t,e){const n=function(t,e){let n=e;const i=t.x,r=t.y;let a,o=-1/0;if(nv(t,n))return n;do{if(nv(t,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o&&(o=t,a=n.x<n.next.x?n:n.next,t===i))return a}n=n.next}while(n!==e);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(i>=n.x&&n.x>=l&&i!==n.x&&$y(r<c?i:o,r,l,c,r<c?o:i,r,n.x,n.y)){const e=Math.abs(r-n.y)/(i-n.x);ov(n,t)&&(e<u||e===u&&(n.x>a.x||n.x===a.x&&Yy(a,n)))&&(a=n,u=e)}n=n.next}while(n!==s);return a}(t,e);if(!n)return e;const i=sv(n,t);return jy(i,i.next),jy(n,n.next)}function Yy(t,e){return ev(t.prev,t,e.prev)<0&&ev(e.next,t,t.next)<0}function Ky(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Jy(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function $y(t,e,n,i,r,a,o,s){return(r-o)*(e-s)>=(t-o)*(a-s)&&(t-o)*(i-s)>=(n-o)*(e-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function Qy(t,e,n,i,r,a,o,s){return!(t===o&&e===s)&&$y(t,e,n,i,r,a,o,s)}function tv(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&iv(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ov(t,e)&&ov(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(ev(t.prev,t,e.prev)||ev(t,e.prev,e))||nv(t,e)&&ev(t.prev,t,t.next)>0&&ev(e.prev,e,e.next)>0)}function ev(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function nv(t,e){return t.x===e.x&&t.y===e.y}function iv(t,e,n,i){const r=av(ev(t,e,n)),a=av(ev(t,e,i)),o=av(ev(n,i,t)),s=av(ev(n,i,e));return r!==a&&o!==s||(!(0!==r||!rv(t,n,e))||(!(0!==a||!rv(t,i,e))||(!(0!==o||!rv(n,t,i))||!(0!==s||!rv(n,e,i)))))}function rv(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function av(t){return t>0?1:t<0?-1:0}function ov(t,e){return ev(t.prev,t,t.next)<0?ev(t,e,t.next)>=0&&ev(t,t.prev,e)>=0:ev(t,e,t.prev)<0||ev(t,t.next,e)<0}function sv(t,e){const n=uv(t.i,t.x,t.y),i=uv(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function lv(t,e,n,i){const r=uv(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function cv(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function uv(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class hv{static triangulate(t,e){return By(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:2)}}class dv{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return dv.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];pv(t),fv(n,t);let a=t.length;e.forEach(pv);for(let s=0;s<e.length;s++)i.push(a),a+=e[s].length,fv(n,e[s]);const o=hv.triangulate(n,i);for(let s=0;s<o.length;s+=3)r.push(o.slice(s,s+3));return r}}function pv(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function fv(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class mv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oy([new Yh(.5,.5),new Yh(-.5,.5),new Yh(-.5,-.5),new Yh(.5,-.5)]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let o=0,s=t.length;o<s;o++){a(t[o])}function a(t){const a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:u-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:gv;let g,y,v,_,b,x=!1;f&&(g=f.getSpacedPoints(s),x=!0,c=!1,y=f.computeFrenetFrames(s,!1),v=new Jh,_=new Jh,b=new Jh),c||(p=0,u=0,h=0,d=0);const w=t.extractPoints(o);let S=w.shape;const M=w.holes;if(!dv.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];dv.isClockWise(e)&&(M[t]=e.reverse())}}function T(t){const e=1e-10*1e-10;let n=t[0];for(let i=1;i<=t.length;i++){const r=i%t.length,a=t[r],o=a.x-n.x,s=a.y-n.y,l=o*o+s*s,c=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(n.x),Math.abs(n.y));l<=e*c*c?(t.splice(r,1),i--):n=a}}T(S),M.forEach(T);const A=M.length,E=S;for(let e=0;e<A;e++){const t=M[e];S=S.concat(t)}function C(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n)}const P=S.length;function I(t,e,n){let i,r,a;const o=t.x-e.x,s=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-s/h,f=e.y+o/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-s*l);i=p+o*m-t.x,r=f+s*m-t.y;const g=i*i+r*r;if(g<=2)return new Yh(i,r);a=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(c)&&(t=!0),t?(i=-s,r=o,a=Math.sqrt(u)):(i=o,r=s,a=Math.sqrt(u/2))}return new Yh(i/a,r/a)}const L=[];for(let e=0,n=E.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[e]=I(E[e],E[i],E[r]);const k=[];let R,D,N=L.concat();for(let e=0,n=A;e<n;e++){const t=M[e];R=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),R[e]=I(t[e],t[i],t[r]);k.push(R),N=N.concat(R)}if(0===p)D=dv.triangulateShape(E,M);else{const t=[],e=[];for(let n=0;n<p;n++){const i=n/p,r=u*Math.cos(i*Math.PI/2),a=h*Math.sin(i*Math.PI/2)+d;for(let e=0,n=E.length;e<n;e++){const n=C(E[e],L[e],a);B(n.x,n.y,-r),0===i&&t.push(n)}for(let t=0,n=A;t<n;t++){const n=M[t];R=k[t];const o=[];for(let t=0,e=n.length;t<e;t++){const e=C(n[t],R[t],a);B(e.x,e.y,-r),0===i&&o.push(e)}0===i&&e.push(o)}}D=dv.triangulateShape(t,e)}const z=D.length,F=h+d;for(let e=0;e<P;e++){const t=c?C(S[e],N[e],F):S[e];x?(_.copy(y.normals[0]).multiplyScalar(t.x),v.copy(y.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(_).add(v),B(b.x,b.y,b.z)):B(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<P;t++){const n=c?C(S[t],N[t],F):S[t];x?(_.copy(y.normals[e]).multiplyScalar(n.x),v.copy(y.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(_).add(v),B(b.x,b.y,b.z)):B(n.x,n.y,l/s*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,r=E.length;e<r;e++){const t=C(E[e],L[e],i);B(t.x,t.y,l+n)}for(let e=0,r=M.length;e<r;e++){const t=M[e];R=k[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],R[e],i);x?B(r.x,r.y+g[s-1].y,g[s-1].x+n):B(r.x,r.y,l+n)}}}function O(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=s+2*p;t<n;t++){const n=P*t,a=P*(t+1);j(e+i+n,e+r+n,e+r+a,e+i+a)}}}function B(t,e,n){a.push(t),a.push(e),a.push(n)}function U(t,e,r){V(t),V(e),V(r);const a=i.length/3,o=m.generateTopUV(n,i,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[2])}function j(t,e,r,a){V(t),V(e),V(a),V(e),V(r),V(a);const o=i.length/3,s=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[3]),H(s[1]),H(s[2]),H(s[3])}function V(t){i.push(a[3*t+0]),i.push(a[3*t+1]),i.push(a[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=P*t;for(let n=0;n<z;n++){const t=D[n];U(t[2]+e,t[1]+e,t[0]+e)}t=s+2*p,e=P*t;for(let n=0;n<z;n++){const t=D[n];U(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<z;t++){const e=D[t];U(e[2],e[1],e[0])}for(let t=0;t<z;t++){const e=D[t];U(e[0]+P*s,e[1]+P*s,e[2]+P*s)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;O(E,e),e+=E.length;for(let n=0,i=M.length;n<i;n++){const t=M[n];O(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new vf(i,3)),this.setAttribute("uv",new vf(r,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,a=t.shapes.length;r<a;r++){const i=e[t.shapes[r]];n.push(i)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Ny[i.type]).fromJSON(i)),new mv(n,t.options)}}const gv={generateTopUV:function(t,e,n,i,r){const a=e[3*n],o=e[3*n+1],s=e[3*i],l=e[3*i+1],c=e[3*r],u=e[3*r+1];return[new Yh(a,o),new Yh(s,l),new Yh(c,u)]},generateSideWallUV:function(t,e,n,i,r,a){const o=e[3*n],s=e[3*n+1],l=e[3*n+2],c=e[3*i],u=e[3*i+1],h=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*a],g=e[3*a+1],y=e[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new Yh(o,1-l),new Yh(c,1-h),new Yh(d,1-f),new Yh(m,1-y)]:[new Yh(s,1-l),new Yh(u,1-h),new Yh(p,1-f),new Yh(g,1-y)]}};class yv extends cy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new yv(t.radius,t.detail)}}class vv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Yh(0,-.5),new Yh(.5,0),new Yh(0,.5)],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=Hh(i,0,2*Math.PI);const r=[],a=[],o=[],s=[],l=[],c=1/e,u=new Jh,h=new Yh,d=new Jh,p=new Jh,f=new Jh;let m=0,g=0;for(let y=0;y<=t.length-1;y++)switch(y){case 0:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),s.push(d.x,d.y,d.z);break;case t.length-1:s.push(f.x,f.y,f.z);break;default:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),s.push(d.x,d.y,d.z),f.copy(p)}for(let y=0;y<=e;y++){const r=n+y*c*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=t.length-1;n++){u.x=t[n].x*d,u.y=t[n].y,u.z=t[n].x*p,a.push(u.x,u.y,u.z),h.x=y/e,h.y=n/(t.length-1),o.push(h.x,h.y);const i=s[3*n+0]*d,r=s[3*n+1],c=s[3*n+0]*p;l.push(i,r,c)}}for(let y=0;y<e;y++)for(let e=0;e<t.length-1;e++){const n=e+y*t.length,i=n,a=n+t.length,o=n+t.length+1,s=n+1;r.push(i,a,s),r.push(o,s,a)}this.setIndex(r),this.setAttribute("position",new vf(a,3)),this.setAttribute("uv",new vf(o,2)),this.setAttribute("normal",new vf(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vv(t.points,t.segments,t.phiStart,t.phiLength)}}class _v extends cy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _v(t.radius,t.detail)}}class bv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,a=e/2,o=Math.floor(n),s=Math.floor(i),l=o+1,c=s+1,u=t/o,h=e/s,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const t=g*h-a;for(let e=0;e<l;e++){const n=e*u-r;p.push(n,-t,0),f.push(0,0,1),m.push(e/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let t=0;t<o;t++){const e=t+l*g,n=t+l*(g+1),i=t+1+l*(g+1),r=t+1+l*g;d.push(e,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new vf(p,3)),this.setAttribute("normal",new vf(f,3)),this.setAttribute("uv",new vf(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bv(t.width,t.height,t.widthSegments,t.heightSegments)}}class xv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const o=[],s=[],l=[],c=[];let u=t;const h=(e-t)/i,d=new Jh,p=new Yh;for(let f=0;f<=i;f++){for(let t=0;t<=n;t++){const i=r+t/n*a;d.x=u*Math.cos(i),d.y=u*Math.sin(i),s.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}u+=h}for(let f=0;f<i;f++){const t=f*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,a=i+n+1,s=i+n+2,l=i+1;o.push(r,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new vf(s,3)),this.setAttribute("normal",new vf(l,3)),this.setAttribute("uv",new vf(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xv(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class wv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oy([new Yh(0,.5),new Yh(-.5,-.5),new Yh(.5,-.5)]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],a=[];let o=0,s=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(o,s,c),o+=s,s=0;function l(t){const o=i.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===dv.isClockWise(c)&&(c=c.reverse());for(let e=0,n=u.length;e<n;e++){const t=u[e];!0===dv.isClockWise(t)&&(u[e]=t.reverse())}const h=dv.triangulateShape(c,u);for(let e=0,n=u.length;e<n;e++){const t=u[e];c=c.concat(t)}for(let e=0,n=c.length;e<n;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),a.push(t.x,t.y)}for(let e=0,i=h.length;e<i;e++){const t=h[e],i=t[0]+o,r=t[1]+o,a=t[2]+o;n.push(i,r,a),s+=3}}this.setIndex(n),this.setAttribute("position",new vf(i,3)),this.setAttribute("normal",new vf(r,3)),this.setAttribute("uv",new vf(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new wv(n,t.curveSegments)}}class Sv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new Jh,h=new Jh,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],y=g/n;let v=0;0===g&&0===a?v=.5/e:g===n&&s===Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const s=n/e;u.x=-t*Math.cos(i+s*r)*Math.sin(a+y*o),u.y=t*Math.cos(a+y*o),u.z=t*Math.sin(i+s*r)*Math.sin(a+y*o),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(s+v,1-y),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let t=0;t<e;t++){const e=c[g][t+1],i=c[g][t],r=c[g+1][t],o=c[g+1][t+1];(0!==g||a>0)&&d.push(e,i,o),(g!==n-1||s<Math.PI)&&d.push(i,r,o)}this.setIndex(d),this.setAttribute("position",new vf(p,3)),this.setAttribute("normal",new vf(f,3)),this.setAttribute("uv",new vf(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Sv(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Mv extends cy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Mv(t.radius,t.detail)}}class Tv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],s=[],l=[],c=new Jh,u=new Jh,h=new Jh;for(let d=0;d<=n;d++)for(let a=0;a<=i;a++){const p=a/i*r,f=d/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),s.push(h.x,h.y,h.z),l.push(a/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let t=1;t<=i;t++){const e=(i+1)*d+t-1,n=(i+1)*(d-1)+t-1,r=(i+1)*(d-1)+t,o=(i+1)*d+t;a.push(e,n,o),a.push(n,r,o)}this.setIndex(a),this.setAttribute("position",new vf(o,3)),this.setAttribute("normal",new vf(s,3)),this.setAttribute("uv",new vf(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Tv(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Av extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:a},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],l=[],c=[],u=new Jh,h=new Jh,d=new Jh,p=new Jh,f=new Jh,m=new Jh,g=new Jh;for(let v=0;v<=n;++v){const o=v/n*r*Math.PI*2;y(o,r,a,t,d),y(o+.01,r,a,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,a=-e*Math.cos(r),o=e*Math.sin(r);u.x=d.x+(a*g.x+o*f.x),u.y=d.y+(a*g.y+o*f.y),u.z=d.z+(a*g.z+o*f.z),s.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(v/n),c.push(t/i)}}for(let v=1;v<=n;v++)for(let t=1;t<=i;t++){const e=(i+1)*(v-1)+(t-1),n=(i+1)*v+(t-1),r=(i+1)*v+t,a=(i+1)*(v-1)+t;o.push(e,n,a),o.push(n,r,a)}function y(t,e,n,i,r){const a=Math.cos(t),o=Math.sin(t),s=n/e*t,l=Math.cos(s);r.x=i*(2+l)*.5*a,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(s)*.5}this.setIndex(o),this.setAttribute("position",new vf(s,3)),this.setAttribute("normal",new vf(l,3)),this.setAttribute("uv",new vf(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Av(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Ev extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ry(new Jh(-1,-1,0),new Jh(-1,1,0),new Jh(1,1,0)),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const a=t.computeFrenetFrames(e,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new Jh,s=new Jh,l=new Yh;let c=new Jh;const u=[],h=[],d=[],p=[];function f(r){c=t.getPointAt(r/e,c);const l=a.normals[r],d=a.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),a=-Math.cos(e);s.x=a*l.x+r*d.x,s.y=a*l.y+r*d.y,s.z=a*l.z+r*d.z,s.normalize(),h.push(s.x,s.y,s.z),o.x=c.x+n*s.x,o.y=c.y+n*s.y,o.z=c.z+n*s.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),a=(i+1)*t+e,o=(i+1)*(t-1)+e;p.push(n,r,o),p.push(r,a,o)}}()}(),this.setIndex(p),this.setAttribute("position",new vf(u,3)),this.setAttribute("normal",new vf(h,3)),this.setAttribute("uv",new vf(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Ev((new Ny[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Cv extends Af{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new Jh,r=new Jh;if(null!==t.index){const a=t.attributes.position,o=t.index;let s=t.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=s.length;t<l;++t){const l=s[t],c=l.start;for(let t=c,s=c+l.count;t<s;t+=3)for(let l=0;l<3;l++){const s=o.getX(t+l),c=o.getX(t+(l+1)%3);i.fromBufferAttribute(a,s),r.fromBufferAttribute(a,c),!0===Pv(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const a=t.attributes.position;for(let t=0,o=a.count/3;t<o;t++)for(let s=0;s<3;s++){const o=3*t+s,l=3*t+(s+1)%3;i.fromBufferAttribute(a,o),r.fromBufferAttribute(a,l),!0===Pv(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new vf(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Pv(t,e,n){const i="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z),r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z);return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Iv=Object.freeze({__proto__:null,BoxGeometry:Uf,CapsuleGeometry:ay,CircleGeometry:oy,ConeGeometry:ly,CylinderGeometry:sy,DodecahedronGeometry:uy,EdgesGeometry:my,ExtrudeGeometry:mv,IcosahedronGeometry:yv,LatheGeometry:vv,OctahedronGeometry:_v,PlaneGeometry:bv,PolyhedronGeometry:cy,RingGeometry:xv,ShapeGeometry:wv,SphereGeometry:Sv,TetrahedronGeometry:Mv,TorusGeometry:Tv,TorusKnotGeometry:Av,TubeGeometry:Ev,WireframeGeometry:Cv});class Lv extends $p{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Yp(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class kv extends Wf{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Rv extends $p{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Yp(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gu,this.normalScale=new Yh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pp,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Dv extends Rv{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Yh(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hh(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Yp(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Yp(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Yp(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!==t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!==t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!==t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!==t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!==t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!==t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Nv extends $p{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Yp(16777215),this.specular=new Yp(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gu,this.normalScale=new Yh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pp,this.combine=ql,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class zv extends $p{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Yp(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gu,this.normalScale=new Yh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Fv extends $p{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gu,this.normalScale=new Yh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Ov extends $p{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Yp(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gu,this.normalScale=new Yh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pp,this.combine=ql,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Bv extends $p{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Uu,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Uv extends $p{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class jv extends $p{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Yp(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gu,this.normalScale=new Yh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Vv extends Pg{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Hv(t,e){return t&&t.constructor!==e?"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function Gv(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wv(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(function(e,n){return t[e]-t[n]}),n}function qv(t,e,n){const i=t.length,r=new t.constructor(i);for(let a=0,o=0;o!==i;++a){const i=n[a]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r}function Zv(t,e,n,i){let r=1,a=t[0];for(;void 0!==a&&void 0===a[i];)a=t[r++];if(void 0===a)return;let o=a[i];if(void 0!==o)if(Array.isArray(o))do{o=a[i],void 0!==o&&(e.push(a.time),n.push(...o)),a=t[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[i],void 0!==o&&(e.push(a.time),o.toArray(n,n.length)),a=t[r++]}while(void 0!==a);else do{o=a[i],void 0!==o&&(e.push(a.time),n.push(o)),a=t[r++]}while(void 0!==a)}class Xv{static convertArray(t,e){return Hv(t,e)}static isTypedArray(t){return Gv(t)}static getKeyframeOrder(t){return Wv(t)}static sortedArray(t,e,n){return qv(t,e,n)}static flattenJSON(t,e,n,i){Zv(t,e,n,i)}static subclip(t,e,n,i){return function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const a=t.clone();a.name=e;const o=[];for(let l=0;l<a.tracks.length;++l){const t=a.tracks[l],e=t.getValueSize(),s=[],c=[];for(let a=0;a<t.times.length;++a){const o=t.times[a]*r;if(!(o<n||o>=i)){s.push(t.times[a]);for(let n=0;n<e;++n)c.push(t.values[a*e+n])}}0!==s.length&&(t.times=Hv(s,t.times.constructor),t.values=Hv(c,t.values.constructor),o.push(t))}a.tracks=o;let s=1/0;for(let l=0;l<a.tracks.length;++l)s>a.tracks[l].times[0]&&(s=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*s);return a.resetDuration(),a}(t,e,n,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:30)}static makeClipAdditive(t){return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);const r=n.tracks.length,a=e/i;for(let o=0;o<r;++o){const e=n.tracks[o],i=e.ValueTypeName;if("bool"===i||"string"===i)continue;const r=t.tracks.find(function(t){return t.name===e.name&&t.ValueTypeName===i});if(void 0===r)continue;let s=0;const l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=e.times.length-1;let d;if(a<=e.times[0]){const t=s,n=l-s;d=e.values.slice(t,n)}else if(a>=e.times[h]){const t=h*l+s,n=t+l-s;d=e.values.slice(t,n)}else{const t=e.createInterpolant(),n=s,i=l-s;t.evaluate(a),d=t.resultBuffer.slice(n,i)}"quaternion"===i&&(new Kh).fromArray(d).normalize().conjugate().toArray(d);const p=r.times.length;for(let t=0;t<p;++t){const e=t*u+c;if("quaternion"===i)Kh.multiplyQuaternionsFlat(r.values,e,d,0,r.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)r.values[e+n]-=d[n]}}}return t.blendMode=zu,t}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:30)}}class Yv{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let a;n:{i:if(!(t<i)){for(let a=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=i,i=e[++n],t<i)break e}a=e.length;break n}if(!(t>=r)){const o=e[1];t<o&&(n=2,r=o);for(let a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(i=r,r=e[--n-1],t>=r)break e}a=n,n=0;break n}break t}for(;n<a;){const i=n+a>>>1;t<e[i]?a=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let a=0;a!==i;++a)e[a]=n[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Kv extends Yv{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ku,endingEnd:ku}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,a=t+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case Ru:r=t,o=2*e-n;break;case Du:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Ru:a=t,s=2*n-e;break;case Du:a=1,s=n+i[1]-i[0];break;default:a=t-1,s=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(t,e,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==o;++b)r[b]=g*a[c+b]+y*a[l+b]+v*a[s+b]+_*a[u+b];return r}}class Jv extends Yv{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,c=(n-e)/(i-e),u=1-c;for(let h=0;h!==o;++h)r[h]=a[l+h]*u+a[s+h]*c;return r}}class $v extends Yv{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Qv{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Hv(e,this.TimeBufferType),this.values=Hv(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Hv(t.times,Array),values:Hv(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new $v(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Jv(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Kv(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Pu:e=this.InterpolantFactoryMethodDiscrete;break;case Iu:e=this.InterpolantFactoryMethodLinear;break;case Lu:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pu;case this.InterpolantFactoryMethodLinear:return Iu;case this.InterpolantFactoryMethodSmooth:return Lu}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,a=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==a&&n[a]>e;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);const t=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*t,a*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==r;o++){const e=n[o];if("number"===typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==a&&a>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,a),t=!1;break}a=e}if(void 0!==i&&Gv(i))for(let o=0,s=i.length;o!==s;++o){const e=i[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Lu,r=t.length-1;let a=1;for(let o=1;o<r;++o){let r=!1;const s=t[o];if(s!==t[o+1]&&(1!==o||s!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,a=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[a+o]){r=!0;break}}}if(r){if(o!==a){t[a]=t[o];const i=o*n,r=a*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++a}}if(r>0){t[a]=t[r];for(let t=r*n,i=a*n,o=0;o!==n;++o)e[i+o]=e[t+o];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=e.slice(0,a*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Qv.prototype.ValueTypeName="",Qv.prototype.TimeBufferType=Float32Array,Qv.prototype.ValueBufferType=Float32Array,Qv.prototype.DefaultInterpolation=Iu;class t_ extends Qv{constructor(t,e,n){super(t,e,n)}}t_.prototype.ValueTypeName="bool",t_.prototype.ValueBufferType=Array,t_.prototype.DefaultInterpolation=Pu,t_.prototype.InterpolantFactoryMethodLinear=void 0,t_.prototype.InterpolantFactoryMethodSmooth=void 0;class e_ extends Qv{constructor(t,e,n,i){super(t,e,n,i)}}e_.prototype.ValueTypeName="color";class n_ extends Qv{constructor(t,e,n,i){super(t,e,n,i)}}n_.prototype.ValueTypeName="number";class i_ extends Yv{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-e)/(i-e);let l=t*o;for(let c=l+o;l!==c;l+=4)Kh.slerpFlat(r,0,a,l-o,a,l,s);return r}}class r_ extends Qv{constructor(t,e,n,i){super(t,e,n,i)}InterpolantFactoryMethodLinear(t){return new i_(this.times,this.values,this.getValueSize(),t)}}r_.prototype.ValueTypeName="quaternion",r_.prototype.InterpolantFactoryMethodSmooth=void 0;class a_ extends Qv{constructor(t,e,n){super(t,e,n)}}a_.prototype.ValueTypeName="string",a_.prototype.ValueBufferType=Array,a_.prototype.DefaultInterpolation=Pu,a_.prototype.InterpolantFactoryMethodLinear=void 0,a_.prototype.InterpolantFactoryMethodSmooth=void 0;class o_ extends Qv{constructor(t,e,n,i){super(t,e,n,i)}}o_.prototype.ValueTypeName="vector";class s_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Nu;this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Vh(),this.userData={},this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let a=0,o=n.length;a!==o;++a)e.push(l_(n[a]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r.userData=JSON.parse(t.userData||"{}"),r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode,userData:JSON.stringify(t.userData)};for(let r=0,a=n.length;r!==a;++r)e.push(Qv.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,a=[];for(let o=0;o<r;o++){let t=[],s=[];t.push((o+r-1)%r,o,(o+1)%r),s.push(0,1,0);const l=Wv(t);t=qv(t,1,l),s=qv(s,1,l),i||0!==t[0]||(t.push(r),s.push(s[0])),a.push(new n_(".morphTargetInfluences["+e[o].name+"]",t,s).scale(1/n))}return new this(t,-1,a)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,s=t.length;o<s;o++){const e=t[o],n=e.name.match(r);if(n&&n.length>1){const t=n[1];let r=i[t];r||(i[t]=r=[]),r.push(e)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],e,n));return a}static parseAnimation(t,e){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const a=[],o=[];Zv(n,a,o,i),0!==a.length&&r.push(new t(e,a,o))}},i=[],r=t.name||"default",a=t.fps||30,o=t.blendMode;let s=t.length||-1;const l=t.hierarchy||[];for(let c=0;c<l.length;c++){const t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const r in e){const e=[],a=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),a.push(i.morphTarget===r?1:0)}i.push(new n_(".morphTargetInfluence["+r+"]",e,a))}s=e.length*a}else{const r=".bones["+e[c].name+"]";n(o_,r+".position",t,"pos",i),n(r_,r+".quaternion",t,"rot",i),n(o_,r+".scale",t,"scl",i)}}if(0===i.length)return null;return new this(r,s,i,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let n=0;n<this.tracks.length;n++)t.push(this.tracks[n].clone());const e=new this.constructor(this.name,this.duration,t,this.blendMode);return e.userData=JSON.parse(JSON.stringify(this.userData)),e}toJSON(){return this.constructor.toJSON(this)}}function l_(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return n_;case"vector":case"vector2":case"vector3":case"vector4":return o_;case"color":return e_;case"quaternion":return r_;case"bool":case"boolean":return t_;case"string":return a_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];Zv(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const c_={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class u_{constructor(t,e,n){const i=this;let r,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.abortController=new AbortController,this.itemStart=function(t){s++,!1===a&&void 0!==i.onStart&&i.onStart(t,o,s),a=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,s),o===s&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const h_=new u_;class d_{constructor(t){this.manager=void 0!==t?t:h_,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}d_.DEFAULT_MATERIAL_NAME="__DEFAULT";const p_={};class f_ extends Error{constructor(t,e){super(t),this.response=e}}class m_ extends d_{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=c_.get("file:".concat(t));if(void 0!==r)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(void 0!==p_[t])return void p_[t].push({onLoad:e,onProgress:n,onError:i});p_[t]=[],p_[t].push({onLoad:e,onProgress:n,onError:i});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,s=this.responseType;fetch(a).then(e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=p_[t],i=e.body.getReader(),r=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),a=r?parseInt(r):0,o=0!==a;let s=0;const l=new ReadableStream({start(t){!function e(){i.read().then(i=>{let{done:r,value:l}=i;if(r)t.close();else{s+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(l),e()}},e=>{t.error(e)})}()}});return new Response(l)}throw new f_('fetch for "'.concat(e.url,'" responded with ').concat(e.status,": ").concat(e.statusText),e)}).then(t=>{switch(s){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(t=>(new DOMParser).parseFromString(t,o));case"json":return t.json();default:if(""===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then(t=>i.decode(t))}}}).then(e=>{c_.add("file:".concat(t),e);const n=p_[t];delete p_[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}}).catch(e=>{const n=p_[t];if(void 0===n)throw this.manager.itemError(t),e;delete p_[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class g_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new m_(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(rJ){i?i(rJ):console.error(rJ),r.manager.itemError(t)}},n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=s_.parse(t[n]);e.push(i)}return e}}class y_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=[],o=new Qg,s=new m_(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials);let l=0;function c(c){s.load(t[c],function(t){const n=r.parse(t,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=_c),o.image=a,o.format=n.format,o.needsUpdate=!0,e&&e(o))},n,i)}if(Array.isArray(t))for(let u=0,h=t.length;u<h;++u)c(u);else s.load(t,function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){a[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)a[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),a[e].format=n.format,a[e].width=n.width,a[e].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=_c),o.format=n.format,o.needsUpdate=!0,e&&e(o)},n,i);return o}}const v_=new WeakMap;class __ extends d_{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=c_.get("image:".concat(t));if(void 0!==a){if(!0===a.complete)r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0);else{let t=v_.get(a);void 0===t&&(t=[],v_.set(a,t)),t.push({onLoad:e,onError:i})}return a}const o=ad("img");function s(){c(),e&&e(this);const n=v_.get(this)||[];for(let t=0;t<n.length;t++){const e=n[t];e.onLoad&&e.onLoad(this)}v_.delete(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),c_.remove("image:".concat(t));const n=v_.get(this)||[];for(let t=0;t<n.length;t++){const i=n[t];i.onError&&i.onError(e)}v_.delete(this),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),c_.add("image:".concat(t),o),r.manager.itemStart(t),o.src=t,o}}class b_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=new Qf;r.colorSpace=Zu;const a=new __(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(n){a.load(t[n],function(t){r.images[n]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let l=0;l<t.length;++l)s(l);return r}}class x_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new Um,o=new m_(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,function(t){let n;try{n=r.parse(t)}catch(uA){if(void 0===i)return void console.error(uA);i(uA)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:dc,a.wrapT=void 0!==n.wrapT?n.wrapT:dc,a.magFilter=void 0!==n.magFilter?n.magFilter:_c,a.minFilter=void 0!==n.minFilter?n.minFilter:_c,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=wc),1===n.mipmapCount&&(a.minFilter=_c),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,e&&e(a,n)},n,i),a}}class w_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=new wd,a=new __(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)},n,i),r}}class S_ extends Ip{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Yp(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class M_ extends S_{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ip.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Yp(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const T_=new ip,A_=new Jh,E_=new Jh;class C_{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Yh(512,512),this.mapType=Mc,this.map=null,this.mapPass=null,this.matrix=new ip,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new og,this._frameExtents=new Yh(1,1),this._viewportCount=1,this._viewports=[new Sd(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;A_.setFromMatrixPosition(t.matrixWorld),e.position.copy(A_),E_.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(E_),e.updateMatrixWorld(),T_.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(T_,e.coordinateSystem,e.reversedDepth),e.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(T_)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class P_ extends C_{constructor(){super(new Kf(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,n=2*jh*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class I_ extends S_{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ip.DEFAULT_UP),this.updateMatrix(),this.target=new Ip,this.distance=n,this.angle=i,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new P_}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const L_=new ip,k_=new Jh,R_=new Jh;class D_ extends C_{constructor(){super(new Kf(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Yh(4,2),this._viewportCount=6,this._viewports=[new Sd(2,1,1,1),new Sd(0,1,1,1),new Sd(3,1,1,1),new Sd(1,1,1,1),new Sd(3,0,1,1),new Sd(1,0,1,1)],this._cubeDirections=[new Jh(1,0,0),new Jh(-1,0,0),new Jh(0,0,1),new Jh(0,0,-1),new Jh(0,1,0),new Jh(0,-1,0)],this._cubeUps=[new Jh(0,1,0),new Jh(0,1,0),new Jh(0,1,0),new Jh(0,1,0),new Jh(0,0,1),new Jh(0,0,-1)]}updateMatrices(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),k_.setFromMatrixPosition(t.matrixWorld),n.position.copy(k_),R_.copy(n.position),R_.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(R_),n.updateMatrixWorld(),i.makeTranslation(-k_.x,-k_.y,-k_.z),L_.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(L_,n.coordinateSystem,n.reversedDepth)}}class N_ extends S_{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new D_}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class z_ extends qf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,a=n+t,o=i+e,s=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,a=r+t*this.view.width,o-=e*this.view.offsetY,s=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class F_ extends C_{constructor(){super(new z_(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class O_ extends S_{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ip.DEFAULT_UP),this.updateMatrix(),this.target=new Ip,this.shadow=new F_}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class B_ extends S_{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class U_ extends S_{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class j_{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Jh)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*i),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*n),e.addScaledVector(a[4],n*i*1.092548),e.addScaledVector(a[5],i*r*1.092548),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],n*r*1.092548),e.addScaledVector(a[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*i),e.addScaledVector(a[2],1.023328*r),e.addScaledVector(a[3],1.023328*n),e.addScaledVector(a[4],.858086*n*i),e.addScaledVector(a[5],.858086*i*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],.858086*n*r),e.addScaledVector(a[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}class V_ extends S_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new j_;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class H_ extends d_{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,a=new m_(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(rJ){i?i(rJ):console.error(rJ),r.manager.itemError(t)}},n,i)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=this.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Yp).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.dispersion&&(i.dispersion=t.dispersion),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"===typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const r in t.uniforms){const e=t.uniforms[r];switch(i.uniforms[r]={},e.type){case"t":i.uniforms[r].value=n(e.value);break;case"c":i.uniforms[r].value=(new Yp).setHex(e.value);break;case"v2":i.uniforms[r].value=(new Yh).fromArray(e.value);break;case"v3":i.uniforms[r].value=(new Jh).fromArray(e.value);break;case"v4":i.uniforms[r].value=(new Sd).fromArray(e.value);break;case"m3":i.uniforms[r].value=(new td).fromArray(e.value);break;case"m4":i.uniforms[r].value=(new ip).fromArray(e.value);break;default:i.uniforms[r].value=e.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const r in t.extensions)i.extensions[r]=t.extensions[r];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Yh).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapRotation&&i.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Yh).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=n(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return H_.createMaterialFromType(t)}static createMaterialFromType(t){return new{ShadowMaterial:Lv,SpriteMaterial:um,RawShaderMaterial:kv,ShaderMaterial:Wf,PointsMaterial:Hg,MeshPhysicalMaterial:Dv,MeshStandardMaterial:Rv,MeshPhongMaterial:Nv,MeshToonMaterial:zv,MeshNormalMaterial:Fv,MeshLambertMaterial:Ov,MeshDepthMaterial:Bv,MeshDistanceMaterial:Uv,MeshBasicMaterial:Qp,MeshMatcapMaterial:jv,LineDashedMaterial:Vv,LineBasicMaterial:Pg,Material:$p}[t]}}class G_{static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class W_ extends Af{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class q_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new m_(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(rJ){i?i(rJ):console.error(rJ),r.manager.itemError(t)}},n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],a=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers,r=i[e],a=new Uint32Array(r).buffer;return n[e]=a,a}(t,r.buffer),o=rd(r.type,a),s=new sm(o,r.stride);return s.uuid=r.uuid,e[i]=s,s}const r=t.isInstancedBufferGeometry?new W_:new Af,a=t.data.index;if(void 0!==a){const t=rd(a.type,a.array);r.setIndex(new cf(t,1))}const o=t.data.attributes;for(const u in o){const e=o[u];let n;if(e.isInterleavedBufferAttribute){const r=i(t.data,e.data);n=new cm(r,e.itemSize,e.offset,e.normalized)}else{const t=rd(e.type,e.array);n=new(e.isInstancedBufferAttribute?Gm:cf)(t,e.itemSize,e.normalized)}void 0!==e.name&&(n.name=e.name),void 0!==e.usage&&n.setUsage(e.usage),r.setAttribute(u,n)}const s=t.data.morphAttributes;if(s)for(const u in s){const e=s[u],n=[];for(let r=0,a=e.length;r<a;r++){const a=e[r];let o;if(a.isInterleavedBufferAttribute){const e=i(t.data,a.data);o=new cm(e,a.itemSize,a.offset,a.normalized)}else{const t=rd(a.type,a.array);o=new cf(t,a.itemSize,a.normalized)}void 0!==a.name&&(o.name=a.name),n.push(o)}r.morphAttributes[u]=n}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const t=l[u];r.addGroup(t.start,t.count,t.materialIndex)}const c=t.data.boundingSphere;return void 0!==c&&(r.boundingSphere=(new Xd).fromJSON(c)),t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}class Z_ extends d_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=""===this.path?G_.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new m_(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(n){let a=null;try{a=JSON.parse(n)}catch(uA){return void 0!==i&&i(uA),void console.error("THREE:ObjectLoader: Can't parse "+t+".",uA.message)}const o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);r.parse(a,e)},n,i)}async loadAsync(t,e){const n=""===this.path?G_.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const i=new m_(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(t,e),a=JSON.parse(r),o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(a)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),a=this.parseImages(t.images,function(){void 0!==e&&e(l)}),o=this.parseTextures(t.textures,a),s=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,r,s,o,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==e){let t=!1;for(const e in a)if(a[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,i,o,a,e),l=this.parseSkeletons(t.skeletons,s);return this.bindSkeletons(s,l),this.bindLightTargets(s),s}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new Oy).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse(function(t){t.isBone&&(i[t.uuid]=t)}),void 0!==t)for(let r=0,a=t.length;r<a;r++){const e=(new Hm).fromJSON(t[r],i);n[e.uuid]=e}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new q_;for(let r=0,a=t.length;r<a;r++){let a;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(o);break;default:o.type in Iv?a=Iv[o.type].fromJSON(o,e):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(o.type,'"'))}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new H_;r.setTextures(e);for(let e=0,a=t.length;e<a;e++){const a=t[e];void 0===n[a.uuid]&&(n[a.uuid]=r.parse(a)),i[a.uuid]=n[a.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=s_.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function a(t){if("string"===typeof t){const e=t;return function(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:rd(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new u_(e);r=new __(n),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const n=t[e],r=n.url;if(Array.isArray(r)){const t=[];for(let e=0,n=r.length;e<n;e++){const n=a(r[e]);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new Um(n.data,n.width,n.height)))}i[n.uuid]=new vd(t)}else{const t=a(n.url);i[n.uuid]=new vd(t)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(t){if("string"===typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await i.loadAsync(r)}return t.data?{data:rd(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new __(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],a=i.url;if(Array.isArray(a)){const t=[];for(let e=0,n=a.length;e<n;e++){const n=a[e],i=await r(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Um(i.data,i.width,i.height)))}n[i.uuid]=new vd(t)}else{const t=await r(i.url);n[i.uuid]=new vd(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"===typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,a=t.length;r<a;r++){const a=t[r];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const o=e[a.image],s=o.data;let l;Array.isArray(s)?(l=new Qf,6===s.length&&(l.needsUpdate=!0)):(l=s&&s.data?new Um:new wd,s&&(l.needsUpdate=!0)),l.source=o,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=n(a.mapping,X_)),void 0!==a.channel&&(l.channel=a.channel),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=n(a.wrap[0],Y_),l.wrapT=n(a.wrap[1],Y_)),void 0!==a.format&&(l.format=a.format),void 0!==a.internalFormat&&(l.internalFormat=a.internalFormat),void 0!==a.type&&(l.type=a.type),void 0!==a.colorSpace&&(l.colorSpace=a.colorSpace),void 0!==a.minFilter&&(l.minFilter=n(a.minFilter,K_)),void 0!==a.magFilter&&(l.magFilter=n(a.magFilter,K_)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),void 0!==a.generateMipmaps&&(l.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(l.compareFunction=a.compareFunction),void 0!==a.userData&&(l.userData=a.userData),i[a.uuid]=l}return i}parseObject(t,e,n,i,r){let a,o,s;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function u(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":a=new om,void 0!==t.background&&(Number.isInteger(t.background)?a.background=new Yp(t.background):a.background=u(t.background)),void 0!==t.environment&&(a.environment=u(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?a.fog=new am(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(a.fog=new rm(t.fog.color,t.fog.density)),""!==t.fog.name&&(a.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(a.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(a.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&a.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(a.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&a.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":a=new Kf(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(a.focus=t.focus),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.filmGauge&&(a.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(a.filmOffset=t.filmOffset),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new z_(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new B_(t.color,t.intensity);break;case"DirectionalLight":a=new O_(t.color,t.intensity),a.target=t.target||"";break;case"PointLight":a=new N_(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new U_(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new I_(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),a.target=t.target||"";break;case"HemisphereLight":a=new M_(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=(new V_).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),s=c(t.material),a=new Om(o,s),void 0!==t.bindMode&&(a.bindMode=t.bindMode),void 0!==t.bindMatrix&&a.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(a.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),s=c(t.material),a=new Of(o,s);break;case"InstancedMesh":o=l(t.geometry),s=c(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;a=new $m(o,s,e),a.instanceMatrix=new Gm(new Float32Array(n.array),16),void 0!==i&&(a.instanceColor=new Gm(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":o=l(t.geometry),s=c(t.material),a=new Cg(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,s),a.geometry=o,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._geometryInfo=t.geometryInfo.map(t=>{let e=null,n=null;return void 0!==t.boundingBox&&(e=(new Id).fromJSON(t.boundingBox)),void 0!==t.boundingSphere&&(n=(new Xd).fromJSON(t.boundingSphere)),kt(kt({},t),{},{boundingBox:e,boundingSphere:n})}),a._instanceInfo=t.instanceInfo,a._availableInstanceIds=t._availableInstanceIds,a._availableGeometryIds=t._availableGeometryIds,a._nextIndexStart=t.nextIndexStart,a._nextVertexStart=t.nextVertexStart,a._geometryCount=t.geometryCount,a._maxInstanceCount=t.maxInstanceCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._matricesTexture=u(t.matricesTexture.uuid),a._indirectTexture=u(t.indirectTexture.uuid),void 0!==t.colorsTexture&&(a._colorsTexture=u(t.colorsTexture.uuid)),void 0!==t.boundingSphere&&(a.boundingSphere=(new Xd).fromJSON(t.boundingSphere)),void 0!==t.boundingBox&&(a.boundingBox=(new Id).fromJSON(t.boundingBox));break;case"LOD":a=new Cm;break;case"Line":a=new Fg(l(t.geometry),c(t.material));break;case"LineLoop":a=new Vg(l(t.geometry),c(t.material));break;case"LineSegments":a=new jg(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":a=new Xg(l(t.geometry),c(t.material));break;case"Sprite":a=new Mm(c(t.material));break;case"Group":a=new em;break;case"Bone":a=new Bm;break;default:a=new Ip}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(a.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.quaternion&&a.quaternion.fromArray(t.quaternion),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.up&&a.up.fromArray(t.up),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.intensity&&(a.shadow.intensity=t.shadow.intensity),void 0!==t.shadow.bias&&(a.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(a.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(a.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&a.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(a.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.frustumCulled&&(a.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(a.renderOrder=t.renderOrder),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.layers&&(a.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)a.add(this.parseObject(o[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];a.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(a.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=a.getObjectByProperty("uuid",n.object);void 0!==i&&a.addLevel(i,n.distance,n.hysteresis)}}return a}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}})}bindLightTargets(t){t.traverse(function(e){if(e.isDirectionalLight||e.isSpotLight){const n=e.target,i=t.getObjectByProperty("uuid",n);e.target=void 0!==i?i:new Ip}})}}const X_={UVMapping:ac,CubeReflectionMapping:oc,CubeRefractionMapping:sc,EquirectangularReflectionMapping:lc,EquirectangularRefractionMapping:cc,CubeUVReflectionMapping:uc},Y_={RepeatWrapping:hc,ClampToEdgeWrapping:dc,MirroredRepeatWrapping:pc},K_={NearestFilter:fc,NearestMipmapNearestFilter:mc,NearestMipmapLinearFilter:yc,LinearFilter:_c,LinearMipmapNearestFilter:bc,LinearMipmapLinearFilter:wc},J_=new WeakMap;class $_ extends d_{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=c_.get("image-bitmap:".concat(t));if(void 0!==a)return r.manager.itemStart(t),a.then?void a.then(n=>{if(!0!==J_.has(a))return e&&e(n),r.manager.itemEnd(t),n;i&&i(J_.get(a)),r.manager.itemError(t),r.manager.itemEnd(t)}):(setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,o.signal="function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const s=fetch(t,o).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){return c_.add("image-bitmap:".concat(t),n),e&&e(n),r.manager.itemEnd(t),n}).catch(function(e){i&&i(e),J_.set(s,e),c_.remove("image-bitmap:".concat(t)),r.manager.itemError(t),r.manager.itemEnd(t)});c_.add("image-bitmap:".concat(t),s),r.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let Q_;class tb{static getContext(){return void 0===Q_&&(Q_=new(window.AudioContext||window.webkitAudioContext)),Q_}static setContext(t){Q_=t}}class eb extends d_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new m_(this.manager);function o(e){i?i(e):console.error(e),r.manager.itemError(t)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(t){try{const n=t.slice(0);tb.getContext().decodeAudioData(n,function(t){e(t)}).catch(o)}catch(rJ){o(rJ)}},n,i)}}const nb=new ip,ib=new ip,rb=new ip;class ab{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Kf,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Kf,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,rb.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(Uh*e.fov*.5)/e.zoom;let a,o;ib.elements[12]=-n,nb.elements[12]=n,a=-r*e.aspect+i,o=r*e.aspect+i,rb.elements[0]=2*e.near/(o-a),rb.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(rb),a=-r*e.aspect-i,o=r*e.aspect-i,rb.elements[0]=2*e.near/(o-a),rb.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(rb)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(ib),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(nb)}}class ob extends Kf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class sb{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const lb=new Jh,cb=new Kh,ub=new Jh,hb=new Jh,db=new Jh;class pb extends Ip{constructor(){super(),this.type="AudioListener",this.context=tb.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new sb}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(lb,cb,ub),hb.set(0,0,-1).applyQuaternion(cb),db.set(0,1,0).applyQuaternion(cb),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(lb.x,t),e.positionY.linearRampToValueAtTime(lb.y,t),e.positionZ.linearRampToValueAtTime(lb.z,t),e.forwardX.linearRampToValueAtTime(hb.x,t),e.forwardY.linearRampToValueAtTime(hb.y,t),e.forwardZ.linearRampToValueAtTime(hb.z,t),e.upX.linearRampToValueAtTime(db.x,t),e.upY.linearRampToValueAtTime(db.y,t),e.upZ.linearRampToValueAtTime(db.z,t)}else e.setPosition(lb.x,lb.y,lb.z),e.setOrientation(hb.x,hb.y,hb.z,db.x,db.y,db.z)}}class fb extends Ip{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,e){return super.copy(t,e),"buffer"!==t.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const mb=new Jh,gb=new Kh,yb=new Jh,vb=new Jh;class _b extends fb{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(mb,gb,yb),vb.set(0,0,1).applyQuaternion(gb);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(mb.x,t),e.positionY.linearRampToValueAtTime(mb.y,t),e.positionZ.linearRampToValueAtTime(mb.z,t),e.orientationX.linearRampToValueAtTime(vb.x,t),e.orientationY.linearRampToValueAtTime(vb.y,t),e.orientationZ.linearRampToValueAtTime(vb.z,t)}else e.setPosition(mb.x,mb.y,mb.z),e.setOrientation(vb.x,vb.y,vb.z)}}class bb{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class xb{constructor(t,e,n){let i,r,a;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let a=this.cumulativeWeight;if(0===a){for(let t=0;t!==i;++t)n[r+t]=n[t];a=e}else{a+=e;const t=e/a;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=a}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let s=e,l=e+e;s!==l;++s)if(n[s]!==n[s+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,a=i;r!==a;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let a=0;a!==r;++a)t[e+a]=t[n+a]}_slerp(t,e,n,i){Kh.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const a=this._workIndex*r;Kh.multiplyQuaternionsFlat(t,a,t,e,t,n),Kh.slerpFlat(t,e,t,e,t,a,i)}_lerp(t,e,n,i,r){const a=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*a+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]+t[n+a]*i}}}const wb="\\[\\]\\.:\\/",Sb=new RegExp("["+wb+"]","g"),Mb="[^"+wb+"]",Tb="[^"+wb.replace("\\.","")+"]",Ab=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Mb)+/(WCOD+)?/.source.replace("WCOD",Tb)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Mb)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Mb)+"$"),Eb=["material","materials","bones","map"];class Cb{constructor(t,e,n){this.path=e,this.parsedPath=n||Cb.parseTrackName(e),this.node=Cb.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Cb.Composite(t,e,n):new Cb(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Sb,"")}static parseTrackName(t){const e=Ab.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==Eb.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const a=n(r.children);if(a)return a}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=Cb.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const a=t[i];if(void 0===a){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?o=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Cb.Composite=class{constructor(t,e,n){const i=n||Cb.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Cb.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Cb.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Cb.prototype.GetterByBindingType=[Cb.prototype._getValue_direct,Cb.prototype._getValue_array,Cb.prototype._getValue_arrayElement,Cb.prototype._getValue_toArray],Cb.prototype.SetterByBindingTypeAndVersioning=[[Cb.prototype._setValue_direct,Cb.prototype._setValue_direct_setNeedsUpdate,Cb.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Cb.prototype._setValue_array,Cb.prototype._setValue_array_setNeedsUpdate,Cb.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Cb.prototype._setValue_arrayElement,Cb.prototype._setValue_arrayElement_setNeedsUpdate,Cb.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Cb.prototype._setValue_fromArray,Cb.prototype._setValue_fromArray_setNeedsUpdate,Cb.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Pb{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Vh(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length;let o,s=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=e[h];if(void 0===d){d=s++,e[h]=d,t.push(u);for(let t=0,e=a;t!==e;++t)r[t].push(new Cb(u,n[t],i[t]))}else if(d<l){o=t[d];const s=--l,c=t[s];e[c.uuid]=d,t[d]=c,e[h]=s,t[s]=u;for(let t=0,e=a;t!==e;++t){const e=r[t],a=e[s];let o=e[d];e[d]=a,void 0===o&&(o=new Cb(u,n[t],i[t])),e[s]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a],s=o.uuid,l=e[s];if(void 0!==l&&l>=r){const a=r++,c=t[a];e[c.uuid]=l,t[l]=c,e[s]=a,t[a]=o;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[a],r=e[l];e[l]=i,e[a]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,a=t.length;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o].uuid,l=e[s];if(void 0!==l)if(delete e[s],l<r){const o=--r,s=t[o],c=--a,u=t[c];e[s.uuid]=l,t[l]=s,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[c];e[l]=i,e[o]=r,e.pop()}}else{const r=--a,o=t[r];r>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[t]=i,a.push(t),o.push(e),r.push(u);for(let h=c,d=s.length;h!==d;++h){const n=s[h];u[h]=new Cb(n,t,e)}return u}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}class Ib{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.blendMode;this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,a=r.length,o=new Array(a),s={endingStart:ku,endingEnd:ku};for(let l=0;l!==a;++l){const t=r[l].createInterpolant(null);o[l]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Eu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.fadeOut(e),this.fadeIn(e),!0===n){const n=this._clip.duration,i=t._clip.duration,r=i/n,a=n/i;t.warp(1,r,e),this.warp(a,1,e)}return this}crossFadeTo(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const a=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===zu)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(a),e[n].accumulateAdditive(o);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(a),e[n].accumulate(i,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const a=n===Cu;if(0===t)return-1===r?i:a&&1===(1&r)?e-i:i;if(n===Au){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(a&&1===(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=Ru,i.endingEnd=Ru):(i.endingStart=t?this.zeroSlopeAtStart?Ru:ku:Du,i.endingEnd=e?this.zeroSlopeAtEnd?Ru:ku:Du)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=e,o[1]=r+t,s[1]=n,this}}const Lb=new Float32Array(1);class kb extends Fh{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,a=t._propertyBindings,o=t._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let u=0;u!==r;++u){const t=i[u],r=t.name;let l=c[r];if(void 0!==l)++l.referenceCount,a[u]=l;else{if(l=a[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,r));continue}const i=e&&e._propertyBindings[u].binding.parsedPath;l=new xb(Cb.create(n,r,i),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,r),a[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{const e=a.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),a.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let a=i[e];void 0===a&&(a={},i[e]=a),a[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new Jv(new Float32Array(2),new Float32Array(2),1,Lb),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let a="string"===typeof t?s_.findByName(i,t):t;const o=null!==a?a.uuid:t,s=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:Nu),void 0!==s){const t=s.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new Ib(this,a,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"===typeof t?s_.findByName(n,t):t,a=r?r.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1;for(let l=0;l!==n;++l){e[l]._update(i,t,r,a)}const o=this._bindings,s=this._nActiveBindings;for(let l=0;l!==s;++l)o[l].apply(a);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,a=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,a._cacheIndex=r,e[r]=a,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const r in n){const t=n[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const r in i){const t=i[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Rb extends Md{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,e,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Cd(null,t,e,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Db{constructor(t){this.value=t}clone(){return new Db(void 0===this.value.clone?this.value:this.value.clone())}}let Nb=0;class zb extends Fh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Nb++}),this.name="",this.usage=xh,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let n=0,i=e.length;n<i;n++){const t=Array.isArray(e[n])?e[n]:[e[n]];for(let e=0;e<t.length;e++)this.uniforms.push(t[e].clone())}return this}clone(){return(new this.constructor).copy(this)}}class Fb extends sm{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class Ob{constructor(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.normalized=a,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const Bb=new ip;class Ub{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new np(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new fp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Bb.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Bb),this}intersectObject(t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Vb(t,this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),e.sort(jb),e}intersectObjects(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=t.length;i<r;i++)Vb(t[i],this,n,e);return n.sort(jb),n}}function jb(t,e){return t.distance-e.distance}function Vb(t,e,n,i){let r=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,n)&&(r=!1)}if(!0===r&&!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)Vb(i[t],e,n,!0)}}class Hb{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(t){this._document=t,void 0!==t.hidden&&(this._pageVisibilityHandler=Gb.bind(this),t.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(t){return this._timescale=t,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(t){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==t?t:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function Gb(){!1===this._document.hidden&&this.reset()}class Wb{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.phi=e,this.theta=n}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Hh(this.phi,t,Math.PI-t),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Hh(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class qb{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.theta=e,this.y=n}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}}class Zb{constructor(t,e,n,i){Zb.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=t[n+e];return this}set(t,e,n,i){const r=this.elements;return r[0]=t,r[2]=e,r[1]=n,r[3]=i,this}}const Xb=new Yh;class Yb{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yh(1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yh(-1/0,-1/0);this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Xb.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Xb).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Kb=new Jh,Jb=new Jh,$b=new Jh,Qb=new Jh,tx=new Jh,ex=new Jh,nx=new Jh;class ix{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh;this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Kb.subVectors(t,this.start),Jb.subVectors(this.end,this.start);const n=Jb.dot(Jb);let i=Jb.dot(Kb)/n;return e&&(i=Hh(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ex,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nx;const i=1e-8*1e-8;let r,a;const o=this.start,s=t.start,l=this.end,c=t.end;$b.subVectors(l,o),Qb.subVectors(c,s),tx.subVectors(o,s);const u=$b.dot($b),h=Qb.dot(Qb),d=Qb.dot(tx);if(u<=i&&h<=i)return e.copy(o),n.copy(s),e.sub(n),e.dot(e);if(u<=i)r=0,a=d/h,a=Hh(a,0,1);else{const t=$b.dot(tx);if(h<=i)a=0,r=Hh(-t/u,0,1);else{const e=$b.dot(Qb),n=u*h-e*e;r=0!==n?Hh((e*d-t*h)/n,0,1):0,a=(e*r+d)/h,a<0?(a=0,r=Hh(-t/u,0,1)):a>1&&(a=1,r=Hh((e-t)/u,0,1))}}return e.copy(o).add($b.multiplyScalar(r)),n.copy(s).add(Qb.multiplyScalar(a)),e.sub(n),e.dot(e)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const rx=new Jh;class ax extends Ip{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new Af,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,s=32;a<s;a++,o++){const t=a/s*Math.PI*2,e=o/s*Math.PI*2;i.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}n.setAttribute("position",new vf(i,3));const r=new Pg({fog:!1,toneMapped:!1});this.cone=new jg(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),rx.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(rx),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ox=new Jh,sx=new ip,lx=new ip;class cx extends jg{constructor(t){const e=ux(t),n=new Af,i=[],r=[];for(let s=0;s<e.length;s++){const t=e[s];t.parent&&t.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new vf(i,3)),n.setAttribute("color",new vf(r,3));super(n,new Pg({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;const a=new Yp(255),o=new Yp(65280);this.setColors(a,o)}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");lx.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<e.length;r++){const t=e[r];t.parent&&t.parent.isBone&&(sx.multiplyMatrices(lx,t.matrixWorld),ox.setFromMatrixPosition(sx),i.setXYZ(a,ox.x,ox.y,ox.z),sx.multiplyMatrices(lx,t.parent.matrixWorld),ox.setFromMatrixPosition(sx),i.setXYZ(a+1,ox.x,ox.y,ox.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}setColors(t,e){const n=this.geometry.getAttribute("color");for(let i=0;i<n.count;i+=2)n.setXYZ(i,t.r,t.g,t.b),n.setXYZ(i+1,e.r,e.g,e.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function ux(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push(...ux(t.children[n]));return e}class hx extends Of{constructor(t,e,n){super(new Sv(e,4,2),new Qp({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const dx=new Jh,px=new Yp,fx=new Yp;class mx extends Ip{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new _v(e);i.rotateY(.5*Math.PI),this.material=new Qp({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),a=new Float32Array(3*r.count);i.setAttribute("color",new cf(a,3)),this.add(new Of(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");px.copy(this.light.color),fx.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?px:fx;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(dx.setFromMatrixPosition(this.light.matrixWorld).negate())}}class gx extends jg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new Yp(n),i=new Yp(i);const r=e/2,a=t/e,o=t/2,s=[],l=[];for(let u=0,h=0,d=-o;u<=e;u++,d+=a){s.push(-o,0,d,o,0,d),s.push(d,0,-o,d,0,o);const t=u===r?n:i;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}const c=new Af;c.setAttribute("position",new vf(s,3)),c.setAttribute("color",new vf(l,3));super(c,new Pg({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class yx extends jg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;r=new Yp(r),a=new Yp(a);const o=[],s=[];if(e>1)for(let c=0;c<e;c++){const n=c/e*(2*Math.PI),i=Math.sin(n)*t,l=Math.cos(n)*t;o.push(0,0,0),o.push(i,0,l);const u=1&c?r:a;s.push(u.r,u.g,u.b),s.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const e=1&c?r:a,l=t-t/n*c;for(let t=0;t<i;t++){let n=t/i*(2*Math.PI),r=Math.sin(n)*l,a=Math.cos(n)*l;o.push(r,0,a),s.push(e.r,e.g,e.b),n=(t+1)/i*(2*Math.PI),r=Math.sin(n)*l,a=Math.cos(n)*l,o.push(r,0,a),s.push(e.r,e.g,e.b)}}const l=new Af;l.setAttribute("position",new vf(o,3)),l.setAttribute("color",new vf(s,3));super(l,new Pg({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const vx=new Jh,_x=new Jh,bx=new Jh;class xx extends Ip{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===e&&(e=1);let i=new Af;i.setAttribute("position",new vf([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Pg({fog:!1,toneMapped:!1});this.lightPlane=new Fg(i,r),this.add(this.lightPlane),i=new Af,i.setAttribute("position",new vf([0,0,0,0,0,1],3)),this.targetLine=new Fg(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),vx.setFromMatrixPosition(this.light.matrixWorld),_x.setFromMatrixPosition(this.light.target.matrixWorld),bx.subVectors(_x,vx),this.lightPlane.lookAt(_x),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_x),this.targetLine.scale.z=bx.length()}}const wx=new Jh,Sx=new qf;class Mx extends jg{constructor(t){const e=new Af,n=new Pg({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],a={};function o(t,e){s(t),s(e)}function s(t){i.push(0,0,0),r.push(0,0,0),void 0===a[t]&&(a[t]=[]),a[t].push(i.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),e.setAttribute("position",new vf(i,3)),e.setAttribute("color",new vf(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new Yp(16755200),c=new Yp(16711680),u=new Yp(43775),h=new Yp(16777215),d=new Yp(3355443);this.setColors(l,c,u,h,d)}setColors(t,e,n,i,r){const a=this.geometry.getAttribute("color");return a.setXYZ(0,t.r,t.g,t.b),a.setXYZ(1,t.r,t.g,t.b),a.setXYZ(2,t.r,t.g,t.b),a.setXYZ(3,t.r,t.g,t.b),a.setXYZ(4,t.r,t.g,t.b),a.setXYZ(5,t.r,t.g,t.b),a.setXYZ(6,t.r,t.g,t.b),a.setXYZ(7,t.r,t.g,t.b),a.setXYZ(8,t.r,t.g,t.b),a.setXYZ(9,t.r,t.g,t.b),a.setXYZ(10,t.r,t.g,t.b),a.setXYZ(11,t.r,t.g,t.b),a.setXYZ(12,t.r,t.g,t.b),a.setXYZ(13,t.r,t.g,t.b),a.setXYZ(14,t.r,t.g,t.b),a.setXYZ(15,t.r,t.g,t.b),a.setXYZ(16,t.r,t.g,t.b),a.setXYZ(17,t.r,t.g,t.b),a.setXYZ(18,t.r,t.g,t.b),a.setXYZ(19,t.r,t.g,t.b),a.setXYZ(20,t.r,t.g,t.b),a.setXYZ(21,t.r,t.g,t.b),a.setXYZ(22,t.r,t.g,t.b),a.setXYZ(23,t.r,t.g,t.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0,this}update(){const t=this.geometry,e=this.pointMap;let n,i;if(Sx.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,i=0;else if(this.camera.coordinateSystem===kh)n=-1,i=1;else{if(this.camera.coordinateSystem!==Rh)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,i=1}Tx("c",e,t,Sx,0,0,n),Tx("t",e,t,Sx,0,0,i),Tx("n1",e,t,Sx,-1,-1,n),Tx("n2",e,t,Sx,1,-1,n),Tx("n3",e,t,Sx,-1,1,n),Tx("n4",e,t,Sx,1,1,n),Tx("f1",e,t,Sx,-1,-1,i),Tx("f2",e,t,Sx,1,-1,i),Tx("f3",e,t,Sx,-1,1,i),Tx("f4",e,t,Sx,1,1,i),Tx("u1",e,t,Sx,.7,1.1,n),Tx("u2",e,t,Sx,-.7,1.1,n),Tx("u3",e,t,Sx,0,2,n),Tx("cf1",e,t,Sx,-1,0,i),Tx("cf2",e,t,Sx,1,0,i),Tx("cf3",e,t,Sx,0,-1,i),Tx("cf4",e,t,Sx,0,1,i),Tx("cn1",e,t,Sx,-1,0,n),Tx("cn2",e,t,Sx,1,0,n),Tx("cn3",e,t,Sx,0,-1,n),Tx("cn4",e,t,Sx,0,1,n),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Tx(t,e,n,i,r,a,o){wx.set(r,a,o).unproject(i);const s=e[t];if(void 0!==s){const t=n.getAttribute("position");for(let e=0,n=s.length;e<n;e++)t.setXYZ(s[e],wx.x,wx.y,wx.z)}}const Ax=new Id;class Ex extends jg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Af;r.setIndex(new cf(n,1)),r.setAttribute("position",new cf(i,3)),super(r,new Pg({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Ax.setFromObject(this.object),Ax.isEmpty())return;const t=Ax.min,e=Ax.max,n=this.geometry.attributes.position,i=n.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=e.y,i[5]=e.z,i[6]=t.x,i[7]=t.y,i[8]=e.z,i[9]=e.x,i[10]=t.y,i[11]=e.z,i[12]=e.x,i[13]=e.y,i[14]=t.z,i[15]=t.x,i[16]=e.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=e.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Cx extends jg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Af;i.setIndex(new cf(n,1)),i.setAttribute("position",new vf([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Pg({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Px extends Fg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,i=new Af;i.setAttribute("position",new vf([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new Pg({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const r=new Af;r.setAttribute("position",new vf([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new Of(r,new Qp({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Ix=new Jh;let Lx,kx;class Rx extends Ip{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh(0,0,1),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*r;super(),this.type="ArrowHelper",void 0===Lx&&(Lx=new Af,Lx.setAttribute("position",new vf([0,0,0,0,1,0],3)),kx=new ly(.5,1,5,1),kx.translate(0,-.5,0)),this.position.copy(e),this.line=new Fg(Lx,new Pg({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Of(kx,new Qp({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Ix.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Ix,e)}}setLength(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*e;this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Dx extends jg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Af;n.setAttribute("position",new vf(e,3)),n.setAttribute("color",new vf([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Pg({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new Yp,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Nx{constructor(){this.type="ShapePath",this.color=new Yp,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Fy,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,a){return this.currentPath.bezierCurveTo(t,e,n,i,r,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let i=!1;for(let r=n-1,a=0;a<n;r=a++){let n=e[r],o=e[a],s=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[a],s=-s,o=e[r],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-s*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return i}const n=dv.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,a,o;const s=[];if(1===i.length)return a=i[0],o=new Oy,o.curves=a.curves,s.push(o),s;let l=!n(i[0].getPoints());l=t?!l:l;const c=[],u=[];let h,d,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)a=i[m],h=a.getPoints(),r=n(h),r=t?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new Oy,p:h},u[f].s.curves=a.curves,l&&f++,p[f]=[]):p[f].push({h:a,p:h[0]});if(!u[0])return function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new Oy;r.curves=i.curves,e.push(r)}return e}(i);if(u.length>1){let t=!1,n=0;for(let e=0,i=u.length;e<i;e++)c[e]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let a=0;a<r.length;a++){const o=r[a];let s=!0;for(let r=0;r<u.length;r++)e(o.p,u[r].p)&&(i!==r&&n++,s?(s=!1,c[r].push(o)):t=!0);s&&c[i].push(o)}}n>0&&!1===t&&(p=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,s.push(o),d=p[m];for(let t=0,e=d.length;t<e;t++)o.holes.push(d[t].h)}return s}}class zx extends Fh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){void 0!==t?(null!==this.domElement&&this.disconnect(),this.domElement=t):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function Fx(t,e,n,i){const r=function(t){switch(t){case Mc:case Tc:return{byteLength:1,components:1};case Ec:case Ac:case Lc:return{byteLength:2,components:1};case kc:case Rc:return{byteLength:2,components:4};case Pc:case Cc:case Ic:return{byteLength:4,components:1};case Nc:case zc:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(t,"."))}(i);switch(n){case Fc:return t*e;case Vc:case Hc:return t*e/r.components*r.byteLength;case Gc:case Wc:return t*e*2/r.components*r.byteLength;case Oc:return t*e*3/r.components*r.byteLength;case Bc:case Zc:return t*e*4/r.components*r.byteLength;case Xc:case Yc:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Kc:case Jc:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Qc:case eu:return Math.max(t,16)*Math.max(e,8)/4;case $c:case tu:return Math.max(t,8)*Math.max(e,8)/2;case nu:case iu:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case ru:case au:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case ou:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case su:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case lu:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case cu:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case uu:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case hu:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case du:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case pu:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case fu:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case mu:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case gu:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case yu:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case vu:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case _u:case bu:case xu:return Math.ceil(t/4)*Math.ceil(e/4)*16;case wu:case Su:return Math.ceil(t/4)*Math.ceil(e/4)*8;case Mu:case Tu:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}class Ox{static contain(t,e){return function(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}(t,e)}static cover(t,e){return function(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}(t,e)}static fill(t){return function(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}(t)}static getByteLength(t,e,n,i){return Fx(t,e,n,i)}}function Bx(){let t=null,e=!1,n=null,i=null;function r(e,a){n(e,a),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ux(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=e.get(n);i&&(t.deleteBuffer(i.buffer),e.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=e.get(n);if(void 0===r)e.set(n,function(e,n){const i=e.array,r=e.usage,a=i.byteLength,o=t.createBuffer();let s;if(t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback(),i instanceof Float32Array)s=t.FLOAT;else if("undefined"!==typeof Float16Array&&i instanceof Float16Array)s=t.HALF_FLOAT;else if(i instanceof Uint16Array)s=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(i instanceof Int16Array)s=t.SHORT;else if(i instanceof Uint32Array)s=t.UNSIGNED_INT;else if(i instanceof Int32Array)s=t.INT;else if(i instanceof Int8Array)s=t.BYTE;else if(i instanceof Uint8Array)s=t.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);s=t.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,size:a}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,i){const r=n.array,a=n.updateRanges;if(t.bindBuffer(i,e),0===a.length)t.bufferSubData(i,0,r);else{a.sort((t,e)=>t.start-e.start);let e=0;for(let t=1;t<a.length;t++){const n=a[e],i=a[t];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++e,a[e]=i)}a.length=e+1;for(let n=0,o=a.length;n<o;n++){const e=a[n];t.bufferSubData(i,e.start*r.BYTES_PER_ELEMENT,r,e.start,e.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:$s}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=$s);const jx={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow( sampler2D shadow, vec2 uv, float compare ) {\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare, distribution.x );\n\t\t#endif\n\t\tif ( hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Vx={common:{diffuse:{value:new Yp(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new td},alphaMap:{value:null},alphaMapTransform:{value:new td},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new td}},envmap:{envMap:{value:null},envMapRotation:{value:new td},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new td}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new td}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new td},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new td},normalScale:{value:new Yh(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new td},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new td}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new td}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new td}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yp(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Yp(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new td},alphaTest:{value:0},uvTransform:{value:new td}},sprite:{diffuse:{value:new Yp(16777215)},opacity:{value:1},center:{value:new Yh(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new td},alphaMap:{value:null},alphaMapTransform:{value:new td},alphaTest:{value:0}}},Hx={basic:{uniforms:Vf([Vx.common,Vx.specularmap,Vx.envmap,Vx.aomap,Vx.lightmap,Vx.fog]),vertexShader:jx.meshbasic_vert,fragmentShader:jx.meshbasic_frag},lambert:{uniforms:Vf([Vx.common,Vx.specularmap,Vx.envmap,Vx.aomap,Vx.lightmap,Vx.emissivemap,Vx.bumpmap,Vx.normalmap,Vx.displacementmap,Vx.fog,Vx.lights,{emissive:{value:new Yp(0)}}]),vertexShader:jx.meshlambert_vert,fragmentShader:jx.meshlambert_frag},phong:{uniforms:Vf([Vx.common,Vx.specularmap,Vx.envmap,Vx.aomap,Vx.lightmap,Vx.emissivemap,Vx.bumpmap,Vx.normalmap,Vx.displacementmap,Vx.fog,Vx.lights,{emissive:{value:new Yp(0)},specular:{value:new Yp(1118481)},shininess:{value:30}}]),vertexShader:jx.meshphong_vert,fragmentShader:jx.meshphong_frag},standard:{uniforms:Vf([Vx.common,Vx.envmap,Vx.aomap,Vx.lightmap,Vx.emissivemap,Vx.bumpmap,Vx.normalmap,Vx.displacementmap,Vx.roughnessmap,Vx.metalnessmap,Vx.fog,Vx.lights,{emissive:{value:new Yp(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jx.meshphysical_vert,fragmentShader:jx.meshphysical_frag},toon:{uniforms:Vf([Vx.common,Vx.aomap,Vx.lightmap,Vx.emissivemap,Vx.bumpmap,Vx.normalmap,Vx.displacementmap,Vx.gradientmap,Vx.fog,Vx.lights,{emissive:{value:new Yp(0)}}]),vertexShader:jx.meshtoon_vert,fragmentShader:jx.meshtoon_frag},matcap:{uniforms:Vf([Vx.common,Vx.bumpmap,Vx.normalmap,Vx.displacementmap,Vx.fog,{matcap:{value:null}}]),vertexShader:jx.meshmatcap_vert,fragmentShader:jx.meshmatcap_frag},points:{uniforms:Vf([Vx.points,Vx.fog]),vertexShader:jx.points_vert,fragmentShader:jx.points_frag},dashed:{uniforms:Vf([Vx.common,Vx.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jx.linedashed_vert,fragmentShader:jx.linedashed_frag},depth:{uniforms:Vf([Vx.common,Vx.displacementmap]),vertexShader:jx.depth_vert,fragmentShader:jx.depth_frag},normal:{uniforms:Vf([Vx.common,Vx.bumpmap,Vx.normalmap,Vx.displacementmap,{opacity:{value:1}}]),vertexShader:jx.meshnormal_vert,fragmentShader:jx.meshnormal_frag},sprite:{uniforms:Vf([Vx.sprite,Vx.fog]),vertexShader:jx.sprite_vert,fragmentShader:jx.sprite_frag},background:{uniforms:{uvTransform:{value:new td},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:jx.background_vert,fragmentShader:jx.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new td}},vertexShader:jx.backgroundCube_vert,fragmentShader:jx.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:jx.cube_vert,fragmentShader:jx.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jx.equirect_vert,fragmentShader:jx.equirect_frag},distanceRGBA:{uniforms:Vf([Vx.common,Vx.displacementmap,{referencePosition:{value:new Jh},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jx.distanceRGBA_vert,fragmentShader:jx.distanceRGBA_frag},shadow:{uniforms:Vf([Vx.lights,Vx.fog,{color:{value:new Yp(0)},opacity:{value:1}}]),vertexShader:jx.shadow_vert,fragmentShader:jx.shadow_frag}};Hx.physical={uniforms:Vf([Hx.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new td},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new td},clearcoatNormalScale:{value:new Yh(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new td},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new td},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new td},sheen:{value:0},sheenColor:{value:new Yp(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new td},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new td},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new td},transmissionSamplerSize:{value:new Yh},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new td},attenuationDistance:{value:0},attenuationColor:{value:new Yp(0)},specularColor:{value:new Yp(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new td},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new td},anisotropyVector:{value:new Yh},anisotropyMap:{value:null},anisotropyMapTransform:{value:new td}}]),vertexShader:jx.meshphysical_vert,fragmentShader:jx.meshphysical_frag};const Gx={r:0,b:0,g:0},Wx=new pp,qx=new ip;function Zx(t,e,n,i,r,a,o){const s=new Yp(0);let l,c,u=!0===a?0:1,h=null,d=0,p=null;function f(t){let i=!0===t.isScene?t.background:null;if(i&&i.isTexture){i=(t.backgroundBlurriness>0?n:e).get(i)}return i}function m(e,n){e.getRGB(Gx,Hf(t)),i.buffers.color.setClear(Gx.r,Gx.g,Gx.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(t),u=e,m(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,m(s,u)},render:function(e){let n=!1;const r=f(e);null===r?m(s,u):r&&r.isColor&&(m(r,1),n=!0);const a=t.xr.getEnvironmentBlendMode();"additive"===a?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&i.buffers.color.setClear(0,0,0,0,o),(t.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===uc)?(void 0===c&&(c=new Of(new Uf(1,1,1),new Wf({name:"BackgroundCubeMaterial",uniforms:jf(Hx.backgroundCube.uniforms),vertexShader:Hx.backgroundCube.vertexShader,fragmentShader:Hx.backgroundCube.fragmentShader,side:ul,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Wx.copy(n.backgroundRotation),Wx.x*=-1,Wx.y*=-1,Wx.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Wx.y*=-1,Wx.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(qx.makeRotationFromEuler(Wx)),c.material.toneMapped=dd.getTransfer(i.colorSpace)!==Ku,h===i&&d===i.version&&p===t.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,p=t.toneMapping),c.layers.enableAll(),e.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Of(new bv(2,2),new Wf({name:"BackgroundMaterial",uniforms:jf(Hx.background.uniforms),vertexShader:Hx.background.vertexShader,fragmentShader:Hx.background.fragmentShader,side:cl,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=dd.getTransfer(i.colorSpace)!==Ku,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&p===t.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function Xx(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=c(null);let a=r,o=!1;function s(e){return t.bindVertexArray(e)}function l(e){return t.deleteVertexArray(e)}function c(t){const e=[],i=[],r=[];for(let a=0;a<n;a++)e[a]=0,i[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function u(){const t=a.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function h(t){d(t,0)}function d(e,n){const i=a.newAttributes,r=a.enabledAttributes,o=a.attributeDivisors;i[e]=1,0===r[e]&&(t.enableVertexAttribArray(e),r[e]=1),o[e]!==n&&(t.vertexAttribDivisor(e,n),o[e]=n)}function p(){const e=a.newAttributes,n=a.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function f(e,n,i,r,a,o,s){!0===s?t.vertexAttribIPointer(e,n,i,a,o):t.vertexAttribPointer(e,n,i,r,a,o)}function m(){g(),o=!0,a!==r&&(a=r,s(a.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let y=!1;const v=function(e,n,r){const a=!0===r.wireframe;let o=i[e.id];void 0===o&&(o={},i[e.id]=o);let s=o[n.id];void 0===s&&(s={},o[n.id]=s);let l=s[a];void 0===l&&(l=c(t.createVertexArray()),s[a]=l);return l}(m,l,r);a!==v&&(a=v,s(a.object)),y=function(t,e,n,i){const r=a.attributes,o=e.attributes;let s=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){const e=r[a];let n=o[a];if(void 0===n&&("instanceMatrix"===a&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===a&&t.instanceColor&&(n=t.instanceColor)),void 0===e)return!0;if(e.attribute!==n)return!0;if(n&&e.data!==n.data)return!0;s++}}return a.attributesNum!==s||a.index!==i}(n,m,l,g),y&&function(t,e,n,i){const r={},o=e.attributes;let s=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){let e=o[a];void 0===e&&("instanceMatrix"===a&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===a&&t.instanceColor&&(e=t.instanceColor));const n={};n.attribute=e,e&&e.data&&(n.data=e.data),r[a]=n,s++}}a.attributes=r,a.attributesNum=s,a.index=i}(n,m,l,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(y||o)&&(o=!1,function(n,i,r,a){u();const o=a.attributes,s=r.getAttributes(),l=i.defaultAttributeValues;for(const c in s){const i=s[c];if(i.location>=0){let r=o[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const o=r.normalized,s=r.itemSize,l=e.get(r);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===t.INT||u===t.UNSIGNED_INT||r.gpuType===Cc;if(r.isInterleavedBufferAttribute){const e=r.data,l=e.stride,g=r.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)d(i.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<i.locationSize;t++)h(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<i.locationSize;t++)f(i.location+t,s/i.locationSize,u,o,l*p,(g+s/i.locationSize*t)*p,m)}else{if(r.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)d(i.location+t,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let t=0;t<i.locationSize;t++)h(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<i.locationSize;t++)f(i.location+t,s/i.locationSize,u,o,s*p,s/i.locationSize*t*p,m)}}else if(void 0!==l){const e=l[c];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(i.location,e);break;case 3:t.vertexAttrib3fv(i.location,e);break;case 4:t.vertexAttrib4fv(i.location,e);break;default:t.vertexAttrib1fv(i.location,e)}}}}p()}(n,r,l,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in i){const e=i[t];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete i[t]}},releaseStatesOfGeometry:function(t){if(void 0===i[t.id])return;const e=i[t.id];for(const n in e){const t=e[n];for(const e in t)l(t[e].object),delete t[e];delete e[n]}delete i[t.id]},releaseStatesOfProgram:function(t){for(const e in i){const n=i[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)l(r[t].object),delete r[t];delete n[t.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:p}}function Yx(t,e,n){let i;function r(e,r,a){0!==a&&(t.drawArraysInstanced(i,e,r,a),n.update(r,i,a))}this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(t,r,a){if(0===a)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,t,0,r,0,a);let o=0;for(let e=0;e<a;e++)o+=r[e];n.update(o,i,1)},this.renderMultiDrawInstances=function(t,a,o,s){if(0===o)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)r(t[e],a[e],s[e]);else{l.multiDrawArraysInstancedWEBGL(i,t,0,a,0,s,0,o);let e=0;for(let t=0;t<o;t++)e+=a[t]*s[t];n.update(e,i,1)}}}function Kx(t,e,n,i){let r;function a(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reversedDepthBuffer&&e.has("EXT_clip_control"),u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,textureFormatReadable:function(e){return e===Bc||i.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===Lc&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(n!==Mc&&i.convert(n)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Ic&&!r)},precision:o,logarithmicDepthBuffer:l,reversedDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function Jx(t){const e=this;let n=null,i=0,r=!1,a=!1;const o=new ng,s=new td,l={value:null,needsUpdate:!1};function c(t,n,i,r){const a=null!==t?t.length:0;let c=null;if(0!==a){if(c=l.value,!0!==r||null===c){const e=i+4*a,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,l=i;n!==a;++n,l+=4)o.copy(t[n]).applyMatrix4(r,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=a,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(t,e){n=c(t,e,0)},this.setState=function(o,s,u){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!r||null===h||0===h.length||a&&!p)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0}();else{const t=a?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=c(h,s,e,u);for(let i=0;i!==e;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function $x(t){let e=new WeakMap;function n(t,e){return e===lc?t.mapping=oc:e===cc&&(t.mapping=sc),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping;if(a===lc||a===cc){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const a=r.image;if(a&&a.height>0){const o=new tm(a.height);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}const Qx=[.125,.215,.35,.446,.526,.582],tw=20,ew=new z_,nw=new Yp;let iw=null,rw=0,aw=0,ow=!1;const sw=(1+Math.sqrt(5))/2,lw=1/sw,cw=[new Jh(-sw,lw,0),new Jh(sw,lw,0),new Jh(-lw,0,sw),new Jh(lw,0,sw),new Jh(0,sw,-lw),new Jh(0,sw,lw),new Jh(-1,1,-1),new Jh(1,1,-1),new Jh(-1,1,1),new Jh(1,1,1)],uw=new Jh;class hw{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:a=256,position:o=uw}=r;iw=this._renderer.getRenderTarget(),rw=this._renderer.getActiveCubeFace(),aw=this._renderer.getActiveMipmapLevel(),ow=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,n,i,s,o),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}fromCubemap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=mw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=fw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(iw,rw,aw),this._renderer.xr.enabled=ow,t.scissorTest=!1,pw(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===oc||t.mapping===sc?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),iw=this._renderer.getRenderTarget(),rw=this._renderer.getActiveCubeFace(),aw=this._renderer.getActiveMipmapLevel(),ow=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:_c,minFilter:_c,generateMipmaps:!1,type:Lc,format:Bc,colorSpace:Xu,depthBuffer:!1},i=dw(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=dw(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const a=t-4+1+Qx.length;for(let o=0;o<a;o++){const a=Math.pow(2,r);n.push(a);let s=1/a;o>t-4?s=Qx[o-t+4-1]:0===o&&(s=0),i.push(s);const l=1/(a-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,y=new Float32Array(f*p*d),v=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];y.set(i,f*p*t),v.set(h,m*p*t);const r=[t,t,t,t,t,t];_.set(r,g*p*t)}const b=new Af;b.setAttribute("position",new cf(y,f)),b.setAttribute("uv",new cf(v,m)),b.setAttribute("faceIndex",new cf(_,g)),e.push(b),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(tw),r=new Jh(0,1,0),a=new Wf({name:"SphericalGaussianBlur",defines:{n:tw,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(t,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:dl,depthTest:!1,depthWrite:!1});return a}(i,t,e)}return i}_compileMaterial(t){const e=new Of(this._lodPlanes[0],t);this._renderer.compile(e,ew)}_sceneToCubeUV(t,e,n,i,r){const a=new Kf(90,1,e,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(nw),l.toneMapping=Yl,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(i),l.clearDepth(),l.setRenderTarget(null));const h=new Qp({name:"PMREM.Background",side:ul,depthWrite:!1,depthTest:!1}),d=new Of(new Uf,h);let p=!1;const f=t.background;f?f.isColor&&(h.color.copy(f),t.background=null,p=!0):(h.color.copy(nw),p=!0);for(let m=0;m<6;m++){const e=m%3;0===e?(a.up.set(0,o[m],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x+s[m],r.y,r.z)):1===e?(a.up.set(0,0,o[m]),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y+s[m],r.z)):(a.up.set(0,o[m],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y,r.z+s[m]));const n=this._cubeSize;pw(i,e*n,m>2?n:0,n,n),l.setRenderTarget(i),p&&l.render(d,a),l.render(t,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=c,t.background=f}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===oc||t.mapping===sc;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=mw()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=fw());const r=i?this._cubemapMaterial:this._equirectMaterial,a=new Of(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;pw(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(a,ew)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const e=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=cw[(i-r-1)%cw.length];this._blur(t,r-1,r,e,n)}e.autoClear=n}_blur(t,e,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,n,i,"latitudinal",r),this._halfBlur(a,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Of(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):tw;f>tw&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(tw));const m=[];let g=0;for(let _=0;_<tw;++_){const t=_/p,e=Math.exp(-t*t/2);m.push(e),0===_?g+=e:_<f&&(g+=2*e)}for(let _=0;_<m.length;_++)m[_]=m[_]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);const{_lodMax:y}=this;u.dTheta.value=d,u.mipInt.value=y-n;const v=this._sizeLods[i];pw(e,3*v*(i>y-4?i-y+4:0),4*(this._cubeSize-v),3*v,2*v),s.setRenderTarget(e),s.render(c,ew)}}function dw(t,e,n){const i=new Td(t,e,n);return i.texture.mapping=uc,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function pw(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function fw(){return new Wf({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:dl,depthTest:!1,depthWrite:!1})}function mw(){return new Wf({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:dl,depthTest:!1,depthWrite:!1})}function gw(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping,o=a===lc||a===cc,s=a===oc||a===sc;if(o||s){let a=e.get(r);const l=void 0!==a?a.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new hw(t)),a=o?n.fromEquirectangular(r,a):n.fromCubemap(r,a),a.texture.pmremVersion=r.pmremVersion,e.set(r,a),a.texture;if(void 0!==a)return a.texture;{const l=r.image;return o&&l&&l.height>0||s&&l&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(l)?(null===n&&(n=new hw(t)),a=o?n.fromEquirectangular(r):n.fromCubemap(r),a.texture.pmremVersion=r.pmremVersion,e.set(r,a),r.addEventListener("dispose",i),a.texture):null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function yw(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&ld("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function vw(t,e,n,i){const r={},a=new WeakMap;function o(t){const s=t.target;null!==s.index&&e.remove(s.index);for(const n in s.attributes)e.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete r[s.id];const l=a.get(s);l&&(e.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],a=t[e+2];n.push(i,r,r,a,a,i)}}else{if(void 0===r)return;{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const s=new(nd(n)?gf:ff)(n,1);s.version=o;const l=a.get(t);l&&e.remove(l),a.set(t,s)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const r in i)e.update(i[r],t.ARRAY_BUFFER)},getWireframeAttribute:function(t){const e=a.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return a.get(t)}}}function _w(t,e,n){let i,r,a;function o(e,o,s){0!==s&&(t.drawElementsInstanced(i,o,r,e*a,s),n.update(o,i,s))}this.setMode=function(t){i=t},this.setIndex=function(t){r=t.type,a=t.bytesPerElement},this.render=function(e,o){t.drawElements(i,o,r,e*a),n.update(o,i,1)},this.renderInstances=o,this.renderMultiDraw=function(t,a,o){if(0===o)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,a,0,r,t,0,o);let s=0;for(let e=0;e<o;e++)s+=a[e];n.update(s,i,1)},this.renderMultiDrawInstances=function(t,s,l,c){if(0===l)return;const u=e.get("WEBGL_multi_draw");if(null===u)for(let e=0;e<t.length;e++)o(t[e]/a,s[e],c[e]);else{u.multiDrawElementsInstancedWEBGL(i,s,0,r,t,0,c,0,l);let e=0;for(let t=0;t<l;t++)e+=s[t]*c[t];n.update(e,i,1)}}}function bw(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function xw(t,e,n){const i=new WeakMap,r=new Sd;return{update:function(a,o,s){const l=a.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(o);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let v=0;!0===d&&(v=1),!0===p&&(v=2),!0===f&&(v=3);let _=o.attributes.position.count*v,b=1;_>e.maxTextureSize&&(b=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const x=new Float32Array(_*b*4*u),w=new Ad(x,_,b,u);w.type=Ic,w.needsUpdate=!0;const S=4*v;for(let T=0;T<u;T++){const A=m[T],E=g[T],C=y[T],P=_*b*4*T;for(let I=0;I<A.count;I++){const L=I*S;!0===d&&(r.fromBufferAttribute(A,I),x[P+L+0]=r.x,x[P+L+1]=r.y,x[P+L+2]=r.z,x[P+L+3]=0),!0===p&&(r.fromBufferAttribute(E,I),x[P+L+4]=r.x,x[P+L+5]=r.y,x[P+L+6]=r.z,x[P+L+7]=0),!0===f&&(r.fromBufferAttribute(C,I),x[P+L+8]=r.x,x[P+L+9]=r.y,x[P+L+10]=r.z,x[P+L+11]=4===C.itemSize?r.w:1)}}function M(){w.dispose(),i.delete(o),o.removeEventListener("dispose",M)}h={count:u,texture:w,size:new Yh(_,b)},i.set(o,h),o.addEventListener("dispose",M)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)s.getUniforms().setValue(t,"morphTexture",a.morphTexture,n);else{let k=0;for(let D=0;D<l.length;D++)k+=l[D];const R=o.morphTargetsRelative?1:1-k;s.getUniforms().setValue(t,"morphTargetBaseInfluence",R),s.getUniforms().setValue(t,"morphTargetInfluences",l)}s.getUniforms().setValue(t,"morphTargetsTexture",h.texture,n),s.getUniforms().setValue(t,"morphTargetsTextureSize",h.size)}}}function ww(t,e,n,i){let r=new WeakMap;function a(t){const e=t.target;e.removeEventListener("dispose",a),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(o){const s=i.render.frame,l=o.geometry,c=e.get(o,l);if(r.get(c)!==s&&(e.update(c),r.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),r.get(o)!==s&&(n.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,t.ARRAY_BUFFER),r.set(o,s))),o.isSkinnedMesh){const t=o.skeleton;r.get(t)!==s&&(t.update(),r.set(t,s))}return c},dispose:function(){r=new WeakMap}}}const Sw=new wd,Mw=new iy(1,1),Tw=new Ad,Aw=new Cd,Ew=new Qf,Cw=[],Pw=[],Iw=new Float32Array(16),Lw=new Float32Array(9),kw=new Float32Array(4);function Rw(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let a=Cw[r];if(void 0===a&&(a=new Float32Array(r),Cw[r]=a),0!==e){i.toArray(a,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(a,r)}return a}function Dw(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Nw(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function zw(t,e){let n=Pw[e];void 0===n&&(n=new Int32Array(e),Pw[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Fw(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Ow(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Dw(n,e))return;t.uniform2fv(this.addr,e),Nw(n,e)}}function Bw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Dw(n,e))return;t.uniform3fv(this.addr,e),Nw(n,e)}}function Uw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Dw(n,e))return;t.uniform4fv(this.addr,e),Nw(n,e)}}function jw(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Dw(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Nw(n,e)}else{if(Dw(n,i))return;kw.set(i),t.uniformMatrix2fv(this.addr,!1,kw),Nw(n,i)}}function Vw(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Dw(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Nw(n,e)}else{if(Dw(n,i))return;Lw.set(i),t.uniformMatrix3fv(this.addr,!1,Lw),Nw(n,i)}}function Hw(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Dw(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Nw(n,e)}else{if(Dw(n,i))return;Iw.set(i),t.uniformMatrix4fv(this.addr,!1,Iw),Nw(n,i)}}function Gw(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ww(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Dw(n,e))return;t.uniform2iv(this.addr,e),Nw(n,e)}}function qw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Dw(n,e))return;t.uniform3iv(this.addr,e),Nw(n,e)}}function Zw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Dw(n,e))return;t.uniform4iv(this.addr,e),Nw(n,e)}}function Xw(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Yw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Dw(n,e))return;t.uniform2uiv(this.addr,e),Nw(n,e)}}function Kw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Dw(n,e))return;t.uniform3uiv(this.addr,e),Nw(n,e)}}function Jw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Dw(n,e))return;t.uniform4uiv(this.addr,e),Nw(n,e)}}function $w(t,e,n){const i=this.cache,r=n.allocateTextureUnit();let a;i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),this.type===t.SAMPLER_2D_SHADOW?(Mw.compareFunction=gh,a=Mw):a=Sw,n.setTexture2D(e||a,r)}function Qw(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Aw,r)}function tS(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Ew,r)}function eS(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Tw,r)}function nS(t,e){t.uniform1fv(this.addr,e)}function iS(t,e){const n=Rw(e,this.size,2);t.uniform2fv(this.addr,n)}function rS(t,e){const n=Rw(e,this.size,3);t.uniform3fv(this.addr,n)}function aS(t,e){const n=Rw(e,this.size,4);t.uniform4fv(this.addr,n)}function oS(t,e){const n=Rw(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function sS(t,e){const n=Rw(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function lS(t,e){const n=Rw(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function cS(t,e){t.uniform1iv(this.addr,e)}function uS(t,e){t.uniform2iv(this.addr,e)}function hS(t,e){t.uniform3iv(this.addr,e)}function dS(t,e){t.uniform4iv(this.addr,e)}function pS(t,e){t.uniform1uiv(this.addr,e)}function fS(t,e){t.uniform2uiv(this.addr,e)}function mS(t,e){t.uniform3uiv(this.addr,e)}function gS(t,e){t.uniform4uiv(this.addr,e)}function yS(t,e,n){const i=this.cache,r=e.length,a=zw(n,r);Dw(i,a)||(t.uniform1iv(this.addr,a),Nw(i,a));for(let o=0;o!==r;++o)n.setTexture2D(e[o]||Sw,a[o])}function vS(t,e,n){const i=this.cache,r=e.length,a=zw(n,r);Dw(i,a)||(t.uniform1iv(this.addr,a),Nw(i,a));for(let o=0;o!==r;++o)n.setTexture3D(e[o]||Aw,a[o])}function _S(t,e,n){const i=this.cache,r=e.length,a=zw(n,r);Dw(i,a)||(t.uniform1iv(this.addr,a),Nw(i,a));for(let o=0;o!==r;++o)n.setTextureCube(e[o]||Ew,a[o])}function bS(t,e,n){const i=this.cache,r=e.length,a=zw(n,r);Dw(i,a)||(t.uniform1iv(this.addr,a),Nw(i,a));for(let o=0;o!==r;++o)n.setTexture2DArray(e[o]||Tw,a[o])}class xS{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return Fw;case 35664:return Ow;case 35665:return Bw;case 35666:return Uw;case 35674:return jw;case 35675:return Vw;case 35676:return Hw;case 5124:case 35670:return Gw;case 35667:case 35671:return Ww;case 35668:case 35672:return qw;case 35669:case 35673:return Zw;case 5125:return Xw;case 36294:return Yw;case 36295:return Kw;case 36296:return Jw;case 35678:case 36198:case 36298:case 36306:case 35682:return $w;case 35679:case 36299:case 36307:return Qw;case 35680:case 36300:case 36308:case 36293:return tS;case 36289:case 36303:case 36311:case 36292:return eS}}(e.type)}}class wS{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return nS;case 35664:return iS;case 35665:return rS;case 35666:return aS;case 35674:return oS;case 35675:return sS;case 35676:return lS;case 5124:case 35670:return cS;case 35667:case 35671:return uS;case 35668:case 35672:return hS;case 35669:case 35673:return dS;case 5125:return pS;case 36294:return fS;case 36295:return mS;case 36296:return gS;case 35678:case 36198:case 36298:case 36306:case 35682:return yS;case 35679:case 36299:case 36307:return vS;case 35680:case 36300:case 36308:case 36293:return _S;case 36289:case 36303:case 36311:case 36292:return bS}}(e.type)}}class SS{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const a=i[r];a.setValue(t,e[a.id],n)}}}const MS=/(\w+)(\])?(\[|\.)?/g;function TS(t,e){t.seq.push(e),t.map[e.id]=e}function AS(t,e,n){const i=t.name,r=i.length;for(MS.lastIndex=0;;){const a=MS.exec(i),o=MS.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){TS(n,void 0===c?new xS(s,t,e):new wS(s,t,e));break}{let t=n.map[s];void 0===t&&(t=new SS(s),TS(n,t)),n=t}}}class ES{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);AS(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,a=e.length;r!==a;++r){const a=e[r],o=n[a.id];!1!==o.needsUpdate&&a.setValue(t,o.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function CS(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let PS=0;const IS=new td;function LS(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=(t.getShaderInfoLog(e)||"").trim();if(i&&""===r)return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const i=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),a=Math.min(e+6,n.length);for(let o=r;o<a;o++){const t=o+1;i.push("".concat(t===e?">":" "," ").concat(t,": ").concat(n[o]))}return i.join("\n")}(t.getShaderSource(e),i)}return r}function kS(t,e){const n=function(t){dd._getMatrix(IS,dd.workingColorSpace,t);const e="mat3( ".concat(IS.elements.map(t=>t.toFixed(4))," )");switch(dd.getTransfer(t)){case Yu:return[e,"LinearTransferOETF"];case Ku:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}(e);return["vec4 ".concat(t,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}function RS(t,e){let n;switch(e){case Kl:n="Linear";break;case Jl:n="Reinhard";break;case $l:n="Cineon";break;case Ql:n="ACESFilmic";break;case ec:n="AgX";break;case nc:n="Neutral";break;case tc:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const DS=new Jh;function NS(){dd.getLuminanceCoefficients(DS);const t=DS.x.toFixed(4),e=DS.y.toFixed(4),n=DS.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(t,", ").concat(e,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function zS(t){return""!==t}function FS(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function OS(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const BS=/^[ \t]*#include +<([\w\d./]+)>/gm;function US(t){return t.replace(BS,VS)}const jS=new Map;function VS(t,e){let n=jx[e];if(void 0===n){const t=jS.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=jx[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return US(n)}const HS=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function GS(t){return t.replace(HS,WS)}function WS(t,e,n,i){let r="";for(let a=parseInt(e);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function qS(t){let e="precision ".concat(t.precision," float;\n\tprecision ").concat(t.precision," int;\n\tprecision ").concat(t.precision," sampler2D;\n\tprecision ").concat(t.precision," samplerCube;\n\tprecision ").concat(t.precision," sampler3D;\n\tprecision ").concat(t.precision," sampler2DArray;\n\tprecision ").concat(t.precision," sampler2DShadow;\n\tprecision ").concat(t.precision," samplerCubeShadow;\n\tprecision ").concat(t.precision," sampler2DArrayShadow;\n\tprecision ").concat(t.precision," isampler2D;\n\tprecision ").concat(t.precision," isampler3D;\n\tprecision ").concat(t.precision," isamplerCube;\n\tprecision ").concat(t.precision," isampler2DArray;\n\tprecision ").concat(t.precision," usampler2D;\n\tprecision ").concat(t.precision," usampler3D;\n\tprecision ").concat(t.precision," usamplerCube;\n\tprecision ").concat(t.precision," usampler2DArray;\n\t");return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ZS(t,e,n,i){const r=t.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===ol?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===sl?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===ll&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case oc:case sc:e="ENVMAP_TYPE_CUBE";break;case uc:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===sc&&(e="ENVMAP_MODE_REFRACTION");return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case ql:e="ENVMAP_BLENDING_MULTIPLY";break;case Zl:e="ENVMAP_BLENDING_MIX";break;case Xl:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(zS).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(a),m=r.createProgram();let g,y,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(zS).join("\n"),g.length>0&&(g+="\n"),y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(zS).join("\n"),y.length>0&&(y+="\n")):(g=[qS(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(zS).join("\n"),y=[qS(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Yl?"#define TONE_MAPPING":"",n.toneMapping!==Yl?jx.tonemapping_pars_fragment:"",n.toneMapping!==Yl?RS("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",jx.colorspace_pars_fragment,kS("linearToOutputTexel",n.outputColorSpace),NS(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(zS).join("\n")),o=US(o),o=FS(o,n),o=OS(o,n),s=US(s),s=FS(s,n),s=OS(s,n),o=GS(o),s=GS(s),!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in",n.glslVersion===Lh?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Lh?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const _=v+g+o,b=v+y+s,x=CS(r,r.VERTEX_SHADER,_),w=CS(r,r.FRAGMENT_SHADER,b);function S(e){if(t.debug.checkShaderErrors){const n=r.getProgramInfoLog(m)||"",i=r.getShaderInfoLog(x)||"",a=r.getShaderInfoLog(w)||"",o=n.trim(),s=i.trim(),l=a.trim();let c=!0,u=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(c=!1,"function"===typeof t.debug.onShaderError)t.debug.onShaderError(r,m,x,w);else{const t=LS(r,x,"vertex"),n=LS(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+o+"\n"+t+"\n"+n)}else""!==o?console.warn("THREE.WebGLProgram: Program Info Log:",o):""!==s&&""!==l||(u=!1);u&&(e.diagnostics={runnable:c,programLog:o,vertexShader:{log:s,prefix:g},fragmentShader:{log:l,prefix:y}})}r.deleteShader(x),r.deleteShader(w),M=new ES(r,m),T=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),a=i.name;let o=1;i.type===t.FLOAT_MAT2&&(o=2),i.type===t.FLOAT_MAT3&&(o=3),i.type===t.FLOAT_MAT4&&(o=4),n[a]={type:i.type,location:t.getAttribLocation(e,a),locationSize:o}}return n}(r,m)}let M,T;r.attachShader(m,x),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===M&&S(this),M},this.getAttributes=function(){return void 0===T&&S(this),T};let A=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===A&&(A=r.getProgramParameter(m,37297)),A},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=PS++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let XS=0;class YS{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(t);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new KS(t),e.set(t,n)),n}}class KS{constructor(t){this.id=XS++,this.code=t,this.usedTimes=0}}function JS(t,e,n,i,r,a,o){const s=new fp,l=new YS,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return c.add(t),0===t?"uv":"uv".concat(t)}return{getParameters:function(a,s,u,g,y){const v=g.fog,_=y.geometry,b=a.isMeshStandardMaterial?g.environment:null,x=(a.isMeshStandardMaterial?n:e).get(a.envMap||b),w=x&&x.mapping===uc?x.image.height:null,S=f[a.type];null!==a.precision&&(p=r.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));const M=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,T=void 0!==M?M.length:0;let A,E,C,P,I=0;if(void 0!==_.morphAttributes.position&&(I=1),void 0!==_.morphAttributes.normal&&(I=2),void 0!==_.morphAttributes.color&&(I=3),S){const t=Hx[S];A=t.vertexShader,E=t.fragmentShader}else A=a.vertexShader,E=a.fragmentShader,l.update(a),C=l.getVertexShaderID(a),P=l.getFragmentShaderID(a);const L=t.getRenderTarget(),k=t.state.buffers.depth.getReversed(),R=!0===y.isInstancedMesh,D=!0===y.isBatchedMesh,N=!!a.map,z=!!a.matcap,F=!!x,O=!!a.aoMap,B=!!a.lightMap,U=!!a.bumpMap,j=!!a.normalMap,V=!!a.displacementMap,H=!!a.emissiveMap,G=!!a.metalnessMap,W=!!a.roughnessMap,q=a.anisotropy>0,Z=a.clearcoat>0,X=a.dispersion>0,Y=a.iridescence>0,K=a.sheen>0,J=a.transmission>0,$=q&&!!a.anisotropyMap,Q=Z&&!!a.clearcoatMap,tt=Z&&!!a.clearcoatNormalMap,et=Z&&!!a.clearcoatRoughnessMap,nt=Y&&!!a.iridescenceMap,it=Y&&!!a.iridescenceThicknessMap,rt=K&&!!a.sheenColorMap,at=K&&!!a.sheenRoughnessMap,ot=!!a.specularMap,st=!!a.specularColorMap,lt=!!a.specularIntensityMap,ct=J&&!!a.transmissionMap,ut=J&&!!a.thicknessMap,ht=!!a.gradientMap,dt=!!a.alphaMap,pt=a.alphaTest>0,ft=!!a.alphaHash,mt=!!a.extensions;let gt=Yl;a.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(gt=t.toneMapping));const yt={shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:A,fragmentShader:E,defines:a.defines,customVertexShaderID:C,customFragmentShaderID:P,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:D,batchingColor:D&&null!==y._colorsTexture,instancing:R,instancingColor:R&&null!==y.instanceColor,instancingMorph:R&&null!==y.morphTexture,supportsVertexTextures:d,outputColorSpace:null===L?t.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Xu,alphaToCoverage:!!a.alphaToCoverage,map:N,matcap:z,envMap:F,envMapMode:F&&x.mapping,envMapCubeUVHeight:w,aoMap:O,lightMap:B,bumpMap:U,normalMap:j,displacementMap:d&&V,emissiveMap:H,normalMapObjectSpace:j&&a.normalMapType===Wu,normalMapTangentSpace:j&&a.normalMapType===Gu,metalnessMap:G,roughnessMap:W,anisotropy:q,anisotropyMap:$,clearcoat:Z,clearcoatMap:Q,clearcoatNormalMap:tt,clearcoatRoughnessMap:et,dispersion:X,iridescence:Y,iridescenceMap:nt,iridescenceThicknessMap:it,sheen:K,sheenColorMap:rt,sheenRoughnessMap:at,specularMap:ot,specularColorMap:st,specularIntensityMap:lt,transmission:J,transmissionMap:ct,thicknessMap:ut,gradientMap:ht,opaque:!1===a.transparent&&a.blending===pl&&!1===a.alphaToCoverage,alphaMap:dt,alphaTest:pt,alphaHash:ft,combine:a.combine,mapUv:N&&m(a.map.channel),aoMapUv:O&&m(a.aoMap.channel),lightMapUv:B&&m(a.lightMap.channel),bumpMapUv:U&&m(a.bumpMap.channel),normalMapUv:j&&m(a.normalMap.channel),displacementMapUv:V&&m(a.displacementMap.channel),emissiveMapUv:H&&m(a.emissiveMap.channel),metalnessMapUv:G&&m(a.metalnessMap.channel),roughnessMapUv:W&&m(a.roughnessMap.channel),anisotropyMapUv:$&&m(a.anisotropyMap.channel),clearcoatMapUv:Q&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:tt&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:nt&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:it&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:at&&m(a.sheenRoughnessMap.channel),specularMapUv:ot&&m(a.specularMap.channel),specularColorMapUv:st&&m(a.specularColorMap.channel),specularIntensityMapUv:lt&&m(a.specularIntensityMap.channel),transmissionMapUv:ct&&m(a.transmissionMap.channel),thicknessMapUv:ut&&m(a.thicknessMap.channel),alphaMapUv:dt&&m(a.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(j||q),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!_.attributes.uv&&(N||dt),fog:!!v,useFog:!0===a.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===a.flatShading&&!1===a.wireframe,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reversedDepthBuffer:k,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:T,morphTextureStride:I,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:t.shadowMap.enabled&&u.length>0,shadowMapType:t.shadowMap.type,toneMapping:gt,decodeVideoTexture:N&&!0===a.map.isVideoTexture&&dd.getTransfer(a.map.colorSpace)===Ku,decodeVideoTextureEmissive:H&&!0===a.emissiveMap.isVideoTexture&&dd.getTransfer(a.emissiveMap.colorSpace)===Ku,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===hl,flipSided:a.side===ul,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:mt&&!0===a.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(mt&&!0===a.extensions.multiDraw||D)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return yt.vertexUv1s=c.has(1),yt.vertexUv2s=c.has(2),yt.vertexUv3s=c.has(3),c.clear(),yt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){s.disableAll(),e.supportsVertexTextures&&s.enable(0);e.instancing&&s.enable(1);e.instancingColor&&s.enable(2);e.instancingMorph&&s.enable(3);e.matcap&&s.enable(4);e.envMap&&s.enable(5);e.normalMapObjectSpace&&s.enable(6);e.normalMapTangentSpace&&s.enable(7);e.clearcoat&&s.enable(8);e.iridescence&&s.enable(9);e.alphaTest&&s.enable(10);e.vertexColors&&s.enable(11);e.vertexAlphas&&s.enable(12);e.vertexUv1s&&s.enable(13);e.vertexUv2s&&s.enable(14);e.vertexUv3s&&s.enable(15);e.vertexTangents&&s.enable(16);e.anisotropy&&s.enable(17);e.alphaHash&&s.enable(18);e.batching&&s.enable(19);e.dispersion&&s.enable(20);e.batchingColor&&s.enable(21);e.gradientMap&&s.enable(22);t.push(s.mask),s.disableAll(),e.fog&&s.enable(0);e.useFog&&s.enable(1);e.flatShading&&s.enable(2);e.logarithmicDepthBuffer&&s.enable(3);e.reversedDepthBuffer&&s.enable(4);e.skinning&&s.enable(5);e.morphTargets&&s.enable(6);e.morphNormals&&s.enable(7);e.morphColors&&s.enable(8);e.premultipliedAlpha&&s.enable(9);e.shadowMapEnabled&&s.enable(10);e.doubleSided&&s.enable(11);e.flipSided&&s.enable(12);e.useDepthPacking&&s.enable(13);e.dithering&&s.enable(14);e.transmission&&s.enable(15);e.sheen&&s.enable(16);e.opaque&&s.enable(17);e.pointsUvs&&s.enable(18);e.decodeVideoTexture&&s.enable(19);e.decodeVideoTextureEmissive&&s.enable(20);e.alphaToCoverage&&s.enable(21);t.push(s.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=Hx[e];n=Gf.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,r=u.length;t<r;t++){const e=u[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new ZS(t,n,e,a),u.push(i)),i},releaseProgram:function(t){if(0===--t.usedTimes){const e=u.indexOf(t);u[e]=u[u.length-1],u.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:u,dispose:function(){l.dispose()}}}function $S(){let t=new WeakMap;return{has:function(e){return t.has(e)},get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function QS(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function tM(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function eM(){const t=[];let e=0;const n=[],i=[],r=[];function a(n,i,r,a,o,s){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,o,s,l,c){const u=a(t,e,o,s,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(t,e,o,s,l,c){const u=a(t,e,o,s,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||QS),i.length>1&&i.sort(e||tM),r.length>1&&r.sort(e||tM)}}}function nM(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new eM,t.set(e,[r])):n>=i.length?(r=new eM,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function iM(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Jh,color:new Yp};break;case"SpotLight":n={position:new Jh,direction:new Jh,color:new Yp,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Jh,color:new Yp,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Jh,skyColor:new Yp,groundColor:new Yp};break;case"RectAreaLight":n={color:new Yp,position:new Jh,halfWidth:new Jh,halfHeight:new Jh}}return t[e.id]=n,n}}}let rM=0;function aM(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function oM(t){const e=new iM,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yh};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yh,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let s=0;s<9;s++)i.probe.push(new Jh);const r=new Jh,a=new ip,o=new ip;return{setup:function(r){let a=0,o=0,s=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0;r.sort(aM);for(let t=0,b=r.length;t<b;t++){const _=r[t],b=_.color,x=_.intensity,w=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)a+=b.r*x,o+=b.g*x,s+=b.b*x;else if(_.isLightProbe){for(let t=0;t<9;t++)i.probe[t].addScaledVector(_.sh.coefficients[t],x);v++}else if(_.isDirectionalLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,i.directionalShadow[l]=e,i.directionalShadowMap[l]=S,i.directionalShadowMatrix[l]=_.shadow.matrix,p++}i.directional[l]=t,l++}else if(_.isSpotLight){const t=e.get(_);t.position.setFromMatrixPosition(_.matrixWorld),t.color.copy(b).multiplyScalar(x),t.distance=w,t.coneCos=Math.cos(_.angle),t.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),t.decay=_.decay,i.spot[u]=t;const r=_.shadow;if(_.map&&(i.spotLightMap[g]=_.map,g++,r.updateMatrices(_),_.castShadow&&y++),i.spotLightMatrix[u]=r.matrix,_.castShadow){const t=n.get(_);t.shadowIntensity=r.intensity,t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,i.spotShadow[u]=t,i.spotShadowMap[u]=S,m++}u++}else if(_.isRectAreaLight){const t=e.get(_);t.color.copy(b).multiplyScalar(x),t.halfWidth.set(.5*_.width,0,0),t.halfHeight.set(0,.5*_.height,0),i.rectArea[h]=t,h++}else if(_.isPointLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),t.distance=_.distance,t.decay=_.decay,_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,i.pointShadow[c]=e,i.pointShadowMap[c]=S,i.pointShadowMatrix[c]=_.shadow.matrix,f++}i.point[c]=t,c++}else if(_.isHemisphereLight){const t=e.get(_);t.skyColor.copy(_.color).multiplyScalar(x),t.groundColor.copy(_.groundColor).multiplyScalar(x),i.hemi[d]=t,d++}}h>0&&(!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Vx.LTC_FLOAT_1,i.rectAreaLTC2=Vx.LTC_FLOAT_2):(i.rectAreaLTC1=Vx.LTC_HALF_1,i.rectAreaLTC2=Vx.LTC_HALF_2)),i.ambient[0]=a,i.ambient[1]=o,i.ambient[2]=s;const _=i.hash;_.directionalLength===l&&_.pointLength===c&&_.spotLength===u&&_.rectAreaLength===h&&_.hemiLength===d&&_.numDirectionalShadows===p&&_.numPointShadows===f&&_.numSpotShadows===m&&_.numSpotMaps===g&&_.numLightProbes===v||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-y,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=y,i.numLightProbes=v,_.directionalLength=l,_.pointLength=c,_.spotLength=u,_.rectAreaLength=h,_.hemiLength=d,_.numDirectionalShadows=p,_.numPointShadows=f,_.numSpotShadows=m,_.numSpotMaps=g,_.numLightProbes=v,i.version=rM++)},setupView:function(t,e){let n=0,s=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){const e=t[d];if(e.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),r.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(h),n++}else if(e.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(e.matrixWorld),r.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(h),l++}else if(e.isRectAreaLight){const t=i.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),o.identity(),a.copy(e.matrixWorld),a.premultiply(h),o.extractRotation(a),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(e.isPointLight){const t=i.point[s];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),s++}else if(e.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(h),u++}}},state:i}}function sM(t){const e=new oM(t),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){r.camera=t,n.length=0,i.length=0},state:r,setupLights:function(){e.setup(n)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){i.push(t)}}}function lM(t){let e=new WeakMap;return{get:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.get(n);let a;return void 0===r?(a=new sM(t),e.set(n,[a])):i>=r.length?(a=new sM(t),r.push(a)):a=r[i],a},dispose:function(){e=new WeakMap}}}function cM(t,e,n){let i=new og;const r=new Yh,a=new Yh,o=new Sd,s=new Bv({depthPacking:ju}),l=new Uv,c={},u=n.maxTextureSize,h={[cl]:ul,[ul]:cl,[hl]:hl},d=new Wf({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Yh},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Af;f.setAttribute("position",new cf(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Of(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ol;let y=this.type;function v(n,i){const a=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Td(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,a,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,a,p,m,null)}function _(e,n,i,r){let a=null;const o=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?l:s,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const t=a.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=a.clone(),i[e]=r,n.addEventListener("dispose",x)),a=r}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=r===ll?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],a.alphaMap=n.alphaMap,a.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){t.properties.get(a).light=i}return a}function b(n,r,a,o,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===ll)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=e.update(n),l=n.material;if(Array.isArray(l)){const e=i.groups;for(let c=0,u=e.length;c<u;c++){const u=e[c],h=l[u.materialIndex];if(h&&h.visible){const e=_(n,h,o,s);n.onBeforeShadow(t,n,r,a,i,e,u),t.renderBufferDirect(a,null,i,e,n,u),n.onAfterShadow(t,n,r,a,i,e,u)}}}else if(l.visible){const e=_(n,l,o,s);n.onBeforeShadow(t,n,r,a,i,e,null),t.renderBufferDirect(a,null,i,e,n,null),n.onAfterShadow(t,n,r,a,i,e,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],r,a,o,s)}function x(t){t.target.removeEventListener("dispose",x);for(const e in c){const n=c[e],i=t.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(e,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(dl),!0===d.buffers.depth.getReversed()?d.buffers.color.setClear(0,0,0,0):d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=y!==ll&&this.type===ll,f=y===ll&&this.type!==ll;for(let m=0,g=e.length;m<g;m++){const l=e[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),a.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/h.x),r.x=a.x*h.x,c.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/h.y),r.y=a.y*h.y,c.mapSize.y=a.y)),null===c.map||!0===p||!0===f){const t=this.type!==ll?{minFilter:fc,magFilter:fc}:{};null!==c.map&&c.map.dispose(),c.map=new Td(r.x,r.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const g=c.getViewportCount();for(let t=0;t<g;t++){const e=c.getViewport(t);o.set(a.x*e.x,a.y*e.y,a.x*e.z,a.y*e.w),d.viewport(o),c.updateMatrices(l,t),i=c.getFrustum(),b(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===ll&&v(c,s),c.needsUpdate=!1}y=this.type,g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}const uM={[Ol]:Bl,[Ul]:Gl,[Vl]:Wl,[jl]:Hl,[Bl]:Ol,[Gl]:Ul,[Wl]:Vl,[Hl]:jl};function hM(t,e){const n=new function(){let e=!1;const n=new Sd;let i=null;const r=new Sd(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,a,o,s){!0===s&&(e*=o,i*=o,a*=o),n.set(e,i,a,o),!1===r.equals(n)&&(t.clearColor(e,i,a,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,a=null,o=null;return{setReversed:function(t){if(i!==t){const n=e.get("EXT_clip_control");t?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),i=t;const r=o;o=null,this.setClear(r)}},getReversed:function(){return i},setTest:function(e){e?U(t.DEPTH_TEST):j(t.DEPTH_TEST)},setMask:function(e){r===e||n||(t.depthMask(e),r=e)},setFunc:function(e){if(i&&(e=uM[e]),a!==e){switch(e){case Ol:t.depthFunc(t.NEVER);break;case Bl:t.depthFunc(t.ALWAYS);break;case Ul:t.depthFunc(t.LESS);break;case jl:t.depthFunc(t.LEQUAL);break;case Vl:t.depthFunc(t.EQUAL);break;case Hl:t.depthFunc(t.GEQUAL);break;case Gl:t.depthFunc(t.GREATER);break;case Wl:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}a=e}},setLocked:function(t){n=t},setClear:function(e){o!==e&&(i&&(e=1-e),t.clearDepth(e),o=e)},reset:function(){n=!1,r=null,a=null,o=null,i=!1}}},r=new function(){let e=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){e||(n?U(t.STENCIL_TEST):j(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&a===o||(t.stencilFunc(e,n,o),i=e,r=n,a=o)},setOp:function(e,n,i){o===e&&s===n&&l===i||(t.stencilOp(e,n,i),o=e,s=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null}}},a=new WeakMap,o=new WeakMap;let s={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,b=new Yp(0,0,0),x=0,w=!1,S=null,M=null,T=null,A=null,E=null;const C=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let P=!1,I=0;const L=t.getParameter(t.VERSION);-1!==L.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(L)[1]),P=I>=1):-1!==L.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),P=I>=2);let k=null,R={};const D=t.getParameter(t.SCISSOR_BOX),N=t.getParameter(t.VIEWPORT),z=(new Sd).fromArray(D),F=(new Sd).fromArray(N);function O(e,n,i,r){const a=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let s=0;s<i;s++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,a):t.texImage2D(n+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a);return o}const B={};function U(e){!0!==s[e]&&(t.enable(e),s[e]=!0)}function j(e){!1!==s[e]&&(t.disable(e),s[e]=!1)}B[t.TEXTURE_2D]=O(t.TEXTURE_2D,t.TEXTURE_2D,1),B[t.TEXTURE_CUBE_MAP]=O(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),B[t.TEXTURE_2D_ARRAY]=O(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),B[t.TEXTURE_3D]=O(t.TEXTURE_3D,t.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),U(t.DEPTH_TEST),i.setFunc(jl),W(!1),q(nl),U(t.CULL_FACE),G(dl);const V={[vl]:t.FUNC_ADD,[_l]:t.FUNC_SUBTRACT,[bl]:t.FUNC_REVERSE_SUBTRACT};V[xl]=t.MIN,V[wl]=t.MAX;const H={[Sl]:t.ZERO,[Ml]:t.ONE,[Tl]:t.SRC_COLOR,[El]:t.SRC_ALPHA,[Rl]:t.SRC_ALPHA_SATURATE,[Ll]:t.DST_COLOR,[Pl]:t.DST_ALPHA,[Al]:t.ONE_MINUS_SRC_COLOR,[Cl]:t.ONE_MINUS_SRC_ALPHA,[kl]:t.ONE_MINUS_DST_COLOR,[Il]:t.ONE_MINUS_DST_ALPHA,[Dl]:t.CONSTANT_COLOR,[Nl]:t.ONE_MINUS_CONSTANT_COLOR,[zl]:t.CONSTANT_ALPHA,[Fl]:t.ONE_MINUS_CONSTANT_ALPHA};function G(e,n,i,r,a,o,s,l,c,u){if(e!==dl){if(!1===d&&(U(t.BLEND),d=!0),e===yl)a=a||n,o=o||i,s=s||r,n===f&&a===y||(t.blendEquationSeparate(V[n],V[a]),f=n,y=a),i===m&&r===g&&o===v&&s===_||(t.blendFuncSeparate(H[i],H[r],H[o],H[s]),m=i,g=r,v=o,_=s),!1!==l.equals(b)&&c===x||(t.blendColor(l.r,l.g,l.b,c),b.copy(l),x=c),p=e,w=!1;else if(e!==p||u!==w){if(f===vl&&y===vl||(t.blendEquation(t.FUNC_ADD),f=vl,y=vl),u)switch(e){case pl:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case fl:t.blendFunc(t.ONE,t.ONE);break;case ml:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case gl:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case pl:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case fl:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case ml:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case gl:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,v=null,_=null,b.set(0,0,0),x=0,p=e,w=u}}else!0===d&&(j(t.BLEND),d=!1)}function W(e){S!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),S=e)}function q(e){e!==el?(U(t.CULL_FACE),e!==M&&(e===nl?t.cullFace(t.BACK):e===il?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):j(t.CULL_FACE),M=e}function Z(e,n,i){e?(U(t.POLYGON_OFFSET_FILL),A===n&&E===i||(t.polygonOffset(n,i),A=n,E=i)):j(t.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:U,disable:j,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,e===t.DRAW_FRAMEBUFFER&&(l[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(l[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let i=u,r=!1;if(e){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const a=e.textures;if(i.length!==a.length||i[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=a.length;e<n;e++)i[e]=t.COLOR_ATTACHMENT0+e;i.length=a.length,r=!0}}else i[0]!==t.BACK&&(i[0]=t.BACK,r=!0);r&&t.drawBuffers(i)},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:G,setMaterial:function(e,a){e.side===hl?j(t.CULL_FACE):U(t.CULL_FACE);let o=e.side===ul;a&&(o=!o),W(o),e.blending===pl&&!1===e.transparent?G(dl):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),n.setMask(e.colorWrite);const s=e.stencilWrite;r.setTest(s),s&&(r.setMask(e.stencilWriteMask),r.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),r.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?U(t.SAMPLE_ALPHA_TO_COVERAGE):j(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:q,setLineWidth:function(e){e!==T&&(P&&t.lineWidth(e),T=e)},setPolygonOffset:Z,setScissorTest:function(e){e?U(t.SCISSOR_TEST):j(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+C-1),k!==e&&(t.activeTexture(e),k=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===k?t.TEXTURE0+C-1:k);let r=R[i];void 0===r&&(r={type:void 0,texture:void 0},R[i]=r),r.type===e&&r.texture===n||(k!==i&&(t.activeTexture(i),k=i),t.bindTexture(e,n||B[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=R[k];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},compressedTexImage3D:function(){try{t.compressedTexImage3D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},texImage2D:function(){try{t.texImage2D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},texImage3D:function(){try{t.texImage3D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},updateUBOMapping:function(e,n){let i=o.get(n);void 0===i&&(i=new WeakMap,o.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=o.get(n).get(e);a.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),a.set(n,i))},texStorage2D:function(){try{t.texStorage2D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},texStorage3D:function(){try{t.texStorage3D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},texSubImage2D:function(){try{t.texSubImage2D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},texSubImage3D:function(){try{t.texSubImage3D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D(...arguments)}catch(uA){console.error("THREE.WebGLState:",uA)}},scissor:function(e){!1===z.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),z.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),i.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),s={},k=null,R={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,b=new Yp(0,0,0),x=0,w=!1,S=null,M=null,T=null,A=null,E=null,z.set(0,0,t.canvas.width,t.canvas.height),F.set(0,0,t.canvas.width,t.canvas.height),n.reset(),i.reset(),r.reset()}}}function dM(t,e,n,i,r,a,o){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new Yh,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function f(t,e){return p?new OffscreenCanvas(t,e):ad("canvas")}function m(t,e,n){let i=1;const r=H(t);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(i*r.width),a=Math.floor(i*r.height);void 0===h&&(h=f(n,a));const o=e?f(n,a):h;o.width=n,o.height=a;return o.getContext("2d").drawImage(t,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),t}return t}function g(t){return t.generateMipmaps}function y(e){t.generateMipmap(e)}function v(e){return e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:e.isWebGL3DRenderTarget?t.TEXTURE_3D:e.isWebGLArrayRenderTarget||e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function _(n,i,r,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=i;if(i===t.RED&&(r===t.FLOAT&&(s=t.R32F),r===t.HALF_FLOAT&&(s=t.R16F),r===t.UNSIGNED_BYTE&&(s=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.R8UI),r===t.UNSIGNED_SHORT&&(s=t.R16UI),r===t.UNSIGNED_INT&&(s=t.R32UI),r===t.BYTE&&(s=t.R8I),r===t.SHORT&&(s=t.R16I),r===t.INT&&(s=t.R32I)),i===t.RG&&(r===t.FLOAT&&(s=t.RG32F),r===t.HALF_FLOAT&&(s=t.RG16F),r===t.UNSIGNED_BYTE&&(s=t.RG8)),i===t.RG_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.RG8UI),r===t.UNSIGNED_SHORT&&(s=t.RG16UI),r===t.UNSIGNED_INT&&(s=t.RG32UI),r===t.BYTE&&(s=t.RG8I),r===t.SHORT&&(s=t.RG16I),r===t.INT&&(s=t.RG32I)),i===t.RGB_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.RGB8UI),r===t.UNSIGNED_SHORT&&(s=t.RGB16UI),r===t.UNSIGNED_INT&&(s=t.RGB32UI),r===t.BYTE&&(s=t.RGB8I),r===t.SHORT&&(s=t.RGB16I),r===t.INT&&(s=t.RGB32I)),i===t.RGBA_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.RGBA8UI),r===t.UNSIGNED_SHORT&&(s=t.RGBA16UI),r===t.UNSIGNED_INT&&(s=t.RGBA32UI),r===t.BYTE&&(s=t.RGBA8I),r===t.SHORT&&(s=t.RGBA16I),r===t.INT&&(s=t.RGBA32I)),i===t.RGB&&(r===t.UNSIGNED_INT_5_9_9_9_REV&&(s=t.RGB9_E5),r===t.UNSIGNED_INT_10F_11F_11F_REV&&(s=t.R11F_G11F_B10F)),i===t.RGBA){const e=o?Yu:dd.getTransfer(a);r===t.FLOAT&&(s=t.RGBA32F),r===t.HALF_FLOAT&&(s=t.RGBA16F),r===t.UNSIGNED_BYTE&&(s=e===Ku?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(s=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(s=t.RGB5_A1)}return s!==t.R16F&&s!==t.R32F&&s!==t.RG16F&&s!==t.RG32F&&s!==t.RGBA16F&&s!==t.RGBA32F||e.get("EXT_color_buffer_float"),s}function b(e,n){let i;return e?null===n||n===Pc||n===Dc?i=t.DEPTH24_STENCIL8:n===Ic?i=t.DEPTH32F_STENCIL8:n===Ec&&(i=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Pc||n===Dc?i=t.DEPTH_COMPONENT24:n===Ic?i=t.DEPTH_COMPONENT32F:n===Ec&&(i=t.DEPTH_COMPONENT16),i}function x(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==fc&&t.minFilter!==_c?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function w(t){const e=t.target;e.removeEventListener("dispose",w),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=d.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(t),0===Object.keys(r).length&&d.delete(n)}i.remove(t)}(e),e.isVideoTexture&&u.delete(e)}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=i.get(e);e.depthTexture&&(e.depthTexture.dispose(),i.remove(e.depthTexture));if(e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let e=0;e<n.__webglFramebuffer[i].length;e++)t.deleteFramebuffer(n.__webglFramebuffer[i][e]);else t.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=e.textures;for(let a=0,s=r.length;a<s;a++){const e=i.get(r[a]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),o.memory.textures--),i.remove(r[a])}i.remove(e)}(n)}function M(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete d.get(r)[n.__cacheKey],o.memory.textures--}let T=0;function A(e,r){const a=i.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;u.get(t)!==e&&(u.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&!0!==e.isExternalTexture&&e.version>0&&a.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void R(a,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}else e.isExternalTexture&&(a.__webglTexture=e.sourceTexture?e.sourceTexture:null);n.bindTexture(t.TEXTURE_2D,a.__webglTexture,t.TEXTURE0+r)}const E={[hc]:t.REPEAT,[dc]:t.CLAMP_TO_EDGE,[pc]:t.MIRRORED_REPEAT},C={[fc]:t.NEAREST,[mc]:t.NEAREST_MIPMAP_NEAREST,[yc]:t.NEAREST_MIPMAP_LINEAR,[_c]:t.LINEAR,[bc]:t.LINEAR_MIPMAP_NEAREST,[wc]:t.LINEAR_MIPMAP_LINEAR},P={[ph]:t.NEVER,[bh]:t.ALWAYS,[fh]:t.LESS,[gh]:t.LEQUAL,[mh]:t.EQUAL,[_h]:t.GEQUAL,[yh]:t.GREATER,[vh]:t.NOTEQUAL};function I(n,a){if(a.type!==Ic||!1!==e.has("OES_texture_float_linear")||a.magFilter!==_c&&a.magFilter!==bc&&a.magFilter!==yc&&a.magFilter!==wc&&a.minFilter!==_c&&a.minFilter!==bc&&a.minFilter!==yc&&a.minFilter!==wc||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,E[a.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,E[a.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,E[a.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,C[a.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,C[a.minFilter]),a.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,P[a.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(a.magFilter===fc)return;if(a.minFilter!==yc&&a.minFilter!==wc)return;if(a.type===Ic&&!1===e.has("OES_texture_float_linear"))return;if(a.anisotropy>1||i.get(a).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy}}}function L(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w));const r=n.source;let a=d.get(r);void 0===a&&(a={},d.set(r,a));const s=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(s!==e.__cacheKey){void 0===a[s]&&(a[s]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),a[s].usedTimes++;const r=a[e.__cacheKey];void 0!==r&&(a[e.__cacheKey].usedTimes--,0===r.usedTimes&&M(n)),e.__cacheKey=s,e.__webglTexture=a[s].texture}return i}function k(t,e,n){return Math.floor(Math.floor(t/n)/e)}function R(e,o,s){let l=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=t.TEXTURE_3D);const c=L(e,o),u=o.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+s);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(t.TEXTURE0+s);const e=dd.getPrimaries(dd.workingColorSpace),i=o.colorSpace===qu?null:dd.getPrimaries(o.colorSpace),d=o.colorSpace===qu||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(o.image,!1,r.maxTextureSize);p=V(o,p);const f=a.convert(o.format,o.colorSpace),v=a.convert(o.type);let w,S=_(o.internalFormat,f,v,o.colorSpace,o.isVideoTexture);I(l,o);const M=o.mipmaps,T=!0!==o.isVideoTexture,A=void 0===h.__version||!0===c,E=u.dataReady,C=x(o,p);if(o.isDepthTexture)S=b(o.format===jc,o.type),A&&(T?n.texStorage2D(t.TEXTURE_2D,1,S,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,v,null));else if(o.isDataTexture)if(M.length>0){T&&A&&n.texStorage2D(t.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let e=0,i=M.length;e<i;e++)w=M[e],T?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,v,w.data):n.texImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,f,v,w.data);o.generateMipmaps=!1}else T?(A&&n.texStorage2D(t.TEXTURE_2D,C,S,p.width,p.height),E&&function(e,i,r,a){const o=e.updateRanges;if(0===o.length)n.texSubImage2D(t.TEXTURE_2D,0,0,0,i.width,i.height,r,a,i.data);else{o.sort((t,e)=>t.start-e.start);let s=0;for(let t=1;t<o.length;t++){const e=o[s],n=o[t],r=e.start+e.count,a=k(n.start,i.width,4),l=k(e.start,i.width,4);n.start<=r+1&&a===l&&k(n.start+n.count-1,i.width,4)===a?e.count=Math.max(e.count,n.start+n.count-e.start):(++s,o[s]=n)}o.length=s+1;const l=t.getParameter(t.UNPACK_ROW_LENGTH),c=t.getParameter(t.UNPACK_SKIP_PIXELS),u=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,i.width);for(let e=0,h=o.length;e<h;e++){const s=o[e],l=Math.floor(s.start/4),c=Math.ceil(s.count/4),u=l%i.width,h=Math.floor(l/i.width),d=c,p=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,u),t.pixelStorei(t.UNPACK_SKIP_ROWS,h),n.texSubImage2D(t.TEXTURE_2D,0,u,h,d,p,r,a,i.data)}e.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,l),t.pixelStorei(t.UNPACK_SKIP_PIXELS,c),t.pixelStorei(t.UNPACK_SKIP_ROWS,u)}}(o,p,f,v)):n.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,v,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){T&&A&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,S,M[0].width,M[0].height,p.depth);for(let e=0,i=M.length;e<i;e++)if(w=M[e],o.format!==Bc)if(null!==f)if(T){if(E)if(o.layerUpdates.size>0){const i=Fx(w.width,w.height,o.format,o.type);for(const r of o.layerUpdates){const a=w.data.subarray(r*i/w.data.BYTES_PER_ELEMENT,(r+1)*i/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,r,w.width,w.height,1,f,a)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,w.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,S,w.width,w.height,p.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?E&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,v,w.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,S,w.width,w.height,p.depth,0,f,v,w.data)}else{T&&A&&n.texStorage2D(t.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let e=0,i=M.length;e<i;e++)w=M[e],o.format!==Bc?null!==f?T?E&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,w.data):n.compressedTexImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,v,w.data):n.texImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,f,v,w.data)}else if(o.isDataArrayTexture)if(T){if(A&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,S,p.width,p.height,p.depth),E)if(o.layerUpdates.size>0){const e=Fx(p.width,p.height,o.format,o.type);for(const i of o.layerUpdates){const r=p.data.subarray(i*e/p.data.BYTES_PER_ELEMENT,(i+1)*e/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,v,r)}o.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,v,p.data);else if(o.isData3DTexture)T?(A&&n.texStorage3D(t.TEXTURE_3D,C,S,p.width,p.height,p.depth),E&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)):n.texImage3D(t.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,v,p.data);else if(o.isFramebufferTexture){if(A)if(T)n.texStorage2D(t.TEXTURE_2D,C,S,p.width,p.height);else{let e=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(t.TEXTURE_2D,r,S,e,i,0,f,v,null),e>>=1,i>>=1}}else if(M.length>0){if(T&&A){const e=H(M[0]);n.texStorage2D(t.TEXTURE_2D,C,S,e.width,e.height)}for(let e=0,i=M.length;e<i;e++)w=M[e],T?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,v,w):n.texImage2D(t.TEXTURE_2D,e,S,f,v,w);o.generateMipmaps=!1}else if(T){if(A){const e=H(p);n.texStorage2D(t.TEXTURE_2D,C,S,e.width,e.height)}E&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,v,p)}else n.texImage2D(t.TEXTURE_2D,0,S,f,v,p);g(o)&&y(l),h.__version=u.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function D(e,r,o,l,c,u){const h=a.convert(o.format,o.colorSpace),d=a.convert(o.type),p=_(o.internalFormat,h,d,o.colorSpace),f=i.get(r),m=i.get(o);if(m.__renderTarget=r,!f.__hasExternalTextures){const e=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,e,i,r.depth,0,h,d,null):n.texImage2D(c,u,p,e,i,0,h,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),j(r)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,c,m.__webglTexture,0,U(r)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(t.FRAMEBUFFER,null)}function N(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer){const r=n.depthTexture,a=r&&r.isDepthTexture?r.type:null,o=b(n.stencilBuffer,a),l=n.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,c=U(n);j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,c,o,n.width,n.height):i?t.renderbufferStorageMultisample(t.RENDERBUFFER,c,o,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,o,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,e)}else{const e=n.textures;for(let r=0;r<e.length;r++){const o=e[r],l=a.convert(o.format,o.colorSpace),c=a.convert(o.type),u=_(o.internalFormat,l,c,o.colorSpace),h=U(n);i&&!1===j(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,h,u,n.width,n.height):j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,h,u,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,u,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function z(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const a=i.get(r.depthTexture);a.__renderTarget=r,a.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),A(r.depthTexture,0);const o=a.__webglTexture,l=U(r);if(r.depthTexture.format===Uc)j(r)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==jc)throw new Error("Unknown depthTexture format");j(r)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}function F(e){const r=i.get(e),a=!0===e.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==e.depthTexture){const t=e.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),t){const e=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,t.removeEventListener("dispose",e)};t.addEventListener("dispose",e),r.__depthDisposeCallback=e}r.__boundDepthTexture=t}if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");const t=e.texture.mipmaps;t&&t.length>0?z(r.__webglFramebuffer[0],e):z(r.__webglFramebuffer,e)}else if(a){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=t.createRenderbuffer(),N(r.__webglDepthbuffer[i],e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,a=r.__webglDepthbuffer[i];t.bindRenderbuffer(t.RENDERBUFFER,a),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,a)}}else{const i=e.texture.mipmaps;if(i&&i.length>0?n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=t.createRenderbuffer(),N(r.__webglDepthbuffer,e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,i),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,i)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}const O=[],B=[];function U(t){return Math.min(r.maxSamples,t.samples)}function j(t){const n=i.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(t,e){const n=t.colorSpace,i=t.format,r=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==Xu&&n!==qu&&(dd.getTransfer(n)===Ku?i===Bc&&r===Mc||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function H(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement?(c.width=t.naturalWidth||t.width,c.height=t.naturalHeight||t.height):"undefined"!==typeof VideoFrame&&t instanceof VideoFrame?(c.width=t.displayWidth,c.height=t.displayHeight):(c.width=t.width,c.height=t.height),c}this.allocateTextureUnit=function(){const t=T;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=A,this.setTexture2DArray=function(e,r){const a=i.get(e);!1===e.isRenderTargetTexture&&e.version>0&&a.__version!==e.version?R(a,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,a.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const a=i.get(e);!1===e.isRenderTargetTexture&&e.version>0&&a.__version!==e.version?R(a,e,r):n.bindTexture(t.TEXTURE_3D,a.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,o){const s=i.get(e);e.version>0&&s.__version!==e.version?function(e,o,s){if(6!==o.image.length)return;const l=L(e,o),c=o.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+s);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(t.TEXTURE0+s);const e=dd.getPrimaries(dd.workingColorSpace),i=o.colorSpace===qu?null:dd.getPrimaries(o.colorSpace),h=o.colorSpace===qu||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?o.image[t].image:o.image[t]:m(o.image[t],!0,r.maxCubemapSize),f[t]=V(o,f[t]);const v=f[0],b=a.convert(o.format,o.colorSpace),w=a.convert(o.type),S=_(o.internalFormat,b,w,o.colorSpace),M=!0!==o.isVideoTexture,T=void 0===u.__version||!0===l,A=c.dataReady;let E,C=x(o,v);if(I(t.TEXTURE_CUBE_MAP,o),d){M&&T&&n.texStorage2D(t.TEXTURE_CUBE_MAP,C,S,v.width,v.height);for(let e=0;e<6;e++){E=f[e].mipmaps;for(let i=0;i<E.length;i++){const r=E[i];o.format!==Bc?null!==b?M?A&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,b,r.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,S,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,b,w,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,S,r.width,r.height,0,b,w,r.data)}}}else{if(E=o.mipmaps,M&&T){E.length>0&&C++;const e=H(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,C,S,e.width,e.height)}for(let e=0;e<6;e++)if(p){M?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,b,w,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,f[e].width,f[e].height,0,b,w,f[e].data);for(let i=0;i<E.length;i++){const r=E[i].image[e].image;M?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,b,w,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,S,r.width,r.height,0,b,w,r.data)}}else{M?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,b,w,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,b,w,f[e]);for(let i=0;i<E.length;i++){const r=E[i];M?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,b,w,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,S,b,w,r.image[e])}}}g(o)&&y(t.TEXTURE_CUBE_MAP),u.__version=c.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(s,e,o):n.bindTexture(t.TEXTURE_CUBE_MAP,s.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,n,r){const a=i.get(e);void 0!==n&&D(a.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&F(e)},this.setupRenderTarget=function(e){const r=e.texture,s=i.get(e),l=i.get(r);e.addEventListener("dispose",S);const c=e.textures,u=!0===e.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=t.createTexture()),l.__version=r.version,o.memory.textures++),u){s.__webglFramebuffer=[];for(let e=0;e<6;e++)if(r.mipmaps&&r.mipmaps.length>0){s.__webglFramebuffer[e]=[];for(let n=0;n<r.mipmaps.length;n++)s.__webglFramebuffer[e][n]=t.createFramebuffer()}else s.__webglFramebuffer[e]=t.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){s.__webglFramebuffer=[];for(let e=0;e<r.mipmaps.length;e++)s.__webglFramebuffer[e]=t.createFramebuffer()}else s.__webglFramebuffer=t.createFramebuffer();if(h)for(let e=0,n=c.length;e<n;e++){const n=i.get(c[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===j(e)){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];s.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const r=a.convert(i.format,i.colorSpace),o=a.convert(i.type),l=_(i.internalFormat,r,o,i.colorSpace,!0===e.isXRRenderTarget),u=U(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,s.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),N(s.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(u){n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),I(t.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)D(s.__webglFramebuffer[n][i],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else D(s.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&y(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,a=c.length;r<a;r++){const a=c[r],o=i.get(a);let l=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(l=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(l,o.__webglTexture),I(l,a),D(s.__webglFramebuffer,e,a,t.COLOR_ATTACHMENT0+r,l,0),g(a)&&y(l)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),I(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)D(s.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,i,n);else D(s.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0,i,0);g(r)&&y(i),n.unbindTexture()}e.depthBuffer&&F(e)},this.updateRenderTargetMipmap=function(t){const e=t.textures;for(let r=0,a=e.length;r<a;r++){const a=e[r];if(g(a)){const e=v(t),r=i.get(a).__webglTexture;n.bindTexture(e,r),y(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===j(e)){const r=e.textures,a=e.width,o=e.height;let s=t.COLOR_BUFFER_BIT;const c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=i.get(e),h=r.length>1;if(h)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const d=e.texture.mipmaps;d&&d.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(s|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(s|=t.STENCIL_BUFFER_BIT)),h){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,a,o,0,0,a,o,s,t.NEAREST),!0===l&&(O.length=0,B.length=0,O.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&!1===e.resolveDepthBuffer&&(O.push(c),B.push(c),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,B)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,O))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),h)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,u.__webglColorRenderbuffer[e]);const a=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,a,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&l){const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=D,this.useMultisampledRTT=j}function pM(t,e){return{convert:function(n){let i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qu;const a=dd.getTransfer(r);if(n===Mc)return t.UNSIGNED_BYTE;if(n===kc)return t.UNSIGNED_SHORT_4_4_4_4;if(n===Rc)return t.UNSIGNED_SHORT_5_5_5_1;if(n===Nc)return t.UNSIGNED_INT_5_9_9_9_REV;if(n===zc)return t.UNSIGNED_INT_10F_11F_11F_REV;if(n===Tc)return t.BYTE;if(n===Ac)return t.SHORT;if(n===Ec)return t.UNSIGNED_SHORT;if(n===Cc)return t.INT;if(n===Pc)return t.UNSIGNED_INT;if(n===Ic)return t.FLOAT;if(n===Lc)return t.HALF_FLOAT;if(n===Fc)return t.ALPHA;if(n===Oc)return t.RGB;if(n===Bc)return t.RGBA;if(n===Uc)return t.DEPTH_COMPONENT;if(n===jc)return t.DEPTH_STENCIL;if(n===Vc)return t.RED;if(n===Hc)return t.RED_INTEGER;if(n===Gc)return t.RG;if(n===Wc)return t.RG_INTEGER;if(n===Zc)return t.RGBA_INTEGER;if(n===Xc||n===Yc||n===Kc||n===Jc)if(a===Ku){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Xc)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Yc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Kc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Jc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Xc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Yc)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Kc)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Jc)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===$c||n===Qc||n===tu||n===eu){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===$c)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Qc)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===tu)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===eu)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===nu||n===iu||n===ru){if(i=e.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===nu||n===iu)return a===Ku?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===ru)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===au||n===ou||n===su||n===lu||n===cu||n===uu||n===hu||n===du||n===pu||n===fu||n===mu||n===gu||n===yu||n===vu){if(i=e.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===au)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ou)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===su)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===lu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===cu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===uu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===hu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===du)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===pu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===fu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===mu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===gu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===yu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===vu)return a===Ku?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===_u||n===bu||n===xu){if(i=e.get("EXT_texture_compression_bptc"),null===i)return null;if(n===_u)return a===Ku?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===bu)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===xu)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===wu||n===Su||n===Mu||n===Tu){if(i=e.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===wu)return i.COMPRESSED_RED_RGTC1_EXT;if(n===Su)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Mu)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Tu)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Dc?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class fM{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e){if(null===this.texture){const n=new ry(t.texture);t.depthNear===e.depthNear&&t.depthFar===e.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,n=new Wf({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new Of(new bv(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class mM extends Fh{constructor(t,e){super();const n=this;let i=null,r=1,a=null,o="local-floor",s=1,l=null,c=null,u=null,h=null,d=null,p=null;const f="undefined"!==typeof XRWebGLBinding,m=new fM,g={},y=e.getContextAttributes();let v=null,_=null;const b=[],x=[],w=new Yh;let S=null;const M=new Kf;M.viewport=new Sd;const T=new Kf;T.viewport=new Sd;const A=[M,T],E=new ob;let C=null,P=null;function I(t){const e=x.indexOf(t.inputSource);if(-1===e)return;const n=b[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||a),n.dispatchEvent({type:t.type,data:t.inputSource}))}function L(){i.removeEventListener("select",I),i.removeEventListener("selectstart",I),i.removeEventListener("selectend",I),i.removeEventListener("squeeze",I),i.removeEventListener("squeezestart",I),i.removeEventListener("squeezeend",I),i.removeEventListener("end",L),i.removeEventListener("inputsourceschange",k);for(let t=0;t<b.length;t++){const e=x[t];null!==e&&(x[t]=null,b[t].disconnect(e))}C=null,P=null,m.reset();for(const t in g)delete g[t];t.setRenderTarget(v),d=null,h=null,u=null,i=null,_=null,F.stop(),n.isPresenting=!1,t.setPixelRatio(S),t.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}function k(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=x.indexOf(n);i>=0&&(x[i]=null,b[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=x.indexOf(n);if(-1===i){for(let t=0;t<b.length;t++){if(t>=x.length){x.push(n),i=t;break}if(null===x[t]){x[t]=n,i=t;break}}if(-1===i)break}const r=b[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=b[t];return void 0===e&&(e=new im,b[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=b[t];return void 0===e&&(e=new im,b[t]=e),e.getGripSpace()},this.getHand=function(t){let e=b[t];return void 0===e&&(e=new im,b[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return null===u&&f&&(u=new XRWebGLBinding(i,e)),u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){v=t.getRenderTarget(),i.addEventListener("select",I),i.addEventListener("selectstart",I),i.addEventListener("selectend",I),i.addEventListener("squeeze",I),i.addEventListener("squeezestart",I),i.addEventListener("squeezeend",I),i.addEventListener("end",L),i.addEventListener("inputsourceschange",k),!0!==y.xrCompatible&&await e.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(w);if(f&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,a=null,o=null;y.depth&&(o=y.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=y.stencil?jc:Uc,a=y.stencil?Dc:Pc);const s={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:r};u=this.getBinding(),h=u.createProjectionLayer(s),i.updateRenderState({layers:[h]}),t.setPixelRatio(1),t.setSize(h.textureWidth,h.textureHeight,!1),_=new Td(h.textureWidth,h.textureHeight,{format:Bc,type:Mc,depthTexture:new iy(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:y.stencil,colorSpace:t.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),_=new Td(d.framebufferWidth,d.framebufferHeight,{format:Bc,type:Mc,colorSpace:t.outputColorSpace,stencilBuffer:y.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}_.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await i.requestReferenceSpace(o),F.setContext(i),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const R=new Jh,D=new Jh;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;let e=t.near,n=t.far;null!==m.texture&&(m.depthNear>0&&(e=m.depthNear),m.depthFar>0&&(n=m.depthFar)),E.near=T.near=M.near=e,E.far=T.far=M.far=n,C===E.near&&P===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,P=E.far),E.layers.mask=6|t.layers.mask,M.layers.mask=3&E.layers.mask,T.layers.mask=5&E.layers.mask;const r=t.parent,a=E.cameras;N(E,r);for(let i=0;i<a.length;i++)N(a[i],r);2===a.length?function(t,e,n){R.setFromMatrixPosition(e.matrixWorld),D.setFromMatrixPosition(n.matrixWorld);const i=R.distanceTo(D),r=e.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===r[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,n=s+f,r=d-m,a=p+(i-m),u=l*s/n*e,h=c*s/n*e;t.projectionMatrix.makePerspective(r,a,u,h,e,n),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(E,M,T):E.projectionMatrix.copy(M.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*jh*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,E,r)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==h||null!==d)return s},this.setFoveation=function(t){s=t,null!==h&&(h.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(E)},this.getCameraTexture=function(t){return g[t]};let z=null;const F=new Bx;F.setAnimationLoop(function(e,r){if(c=r.getViewerPose(l||a),p=r,null!==c){const e=c.views;null!==d&&(t.setRenderTargetFramebuffer(_,d.framebuffer),t.setRenderTarget(_));let r=!1;e.length!==E.cameras.length&&(E.cameras.length=0,r=!0);for(let n=0;n<e.length;n++){const i=e[n];let a=null;if(null!==d)a=d.getViewport(i);else{const e=u.getViewSubImage(h,i);a=e.viewport,0===n&&(t.setRenderTargetTextures(_,e.colorTexture,e.depthStencilTexture),t.setRenderTarget(_))}let o=A[n];void 0===o&&(o=new Kf,o.layers.enable(n),o.viewport=new Sd,A[n]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===n&&(E.matrix.copy(o.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===r&&E.cameras.push(o)}const a=i.enabledFeatures;if(a&&a.includes("depth-sensing")&&"gpu-optimized"==i.depthUsage&&f){u=n.getBinding();const t=u.getDepthInformation(e[0]);t&&t.isValid&&t.texture&&m.init(t,i.renderState)}if(a&&a.includes("camera-access")&&f){t.state.unbindTexture(),u=n.getBinding();for(let t=0;t<e.length;t++){const n=e[t].camera;if(n){let t=g[n];t||(t=new ry,g[n]=t);const e=u.getCameraImage(n);t.sourceTexture=e}}}}for(let t=0;t<b.length;t++){const e=x[t],n=b[t];null!==e&&void 0!==n&&n.update(e,r,l||a)}z&&z(e,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null}),this.setAnimationLoop=function(t){z=t},this.dispose=function(){}}}const gM=new pp,yM=new ip;function vM(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map,n(i.map,t.mapTransform)),i.alphaMap&&(t.alphaMap.value=i.alphaMap,n(i.alphaMap,t.alphaMapTransform)),i.bumpMap&&(t.bumpMap.value=i.bumpMap,n(i.bumpMap,t.bumpMapTransform),t.bumpScale.value=i.bumpScale,i.side===ul&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,n(i.normalMap,t.normalMapTransform),t.normalScale.value.copy(i.normalScale),i.side===ul&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,n(i.displacementMap,t.displacementMapTransform),t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,t.emissiveMapTransform)),i.specularMap&&(t.specularMap.value=i.specularMap,n(i.specularMap,t.specularMapTransform)),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const r=e.get(i),a=r.envMap,o=r.envMapRotation;a&&(t.envMap.value=a,gM.copy(o),gM.x*=-1,gM.y*=-1,gM.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(gM.y*=-1,gM.z*=-1),t.envMapRotation.value.setFromMatrix4(yM.makeRotationFromEuler(gM)),t.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,t.lightMapTransform)),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,Hf(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,a,o,s){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===ul&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,s)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,a,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function _M(t,e,n,i){let r={},a={},o=[];const s=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(t,e,n,i){const r=t.value,a=e+"_"+n;if(void 0===i[a])return i[a]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const t=i[a];if("number"===typeof r||"boolean"===typeof r){if(t!==r)return i[a]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function c(t){const e={boundary:0,storage:0};return"number"===typeof t||"boolean"===typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function u(e){const n=e.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;for(let a=0,o=e.length;a<o;a++){const t=Array.isArray(e[a])?e[a]:[e[a]];for(let e=0,r=t.length;e<r;e++){const r=t[e],a=Array.isArray(r.value)?r.value:[r.value];for(let t=0,e=a.length;t<e;t++){const e=c(a[t]),o=n%i,s=o%e.boundary,l=o+s;n+=s,0!==l&&i-l<e.storage&&(n+=i-l),r.__data=new Float32Array(e.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=e.storage}}}const r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<s;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,a=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,a),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=e.render.frame;a[n.id]!==f&&(!function(e){const n=r[e.id],i=e.uniforms,a=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let r=0,o=i.length;r<o;r++){const e=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=e.length;n<i;n++){const i=e[n];if(!0===l(i,r,n,a)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let a=0;a<n.length;a++){const o=n[a],s=c(o);"number"===typeof o||"boolean"===typeof o?(i.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+r,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=0,i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=0,i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=0):(o.toArray(i.__data,r),r+=s.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);o=[],r={},a={}}}}class bM{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:e=od(),context:n=null,depth:i=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:h=!1}=t;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=a;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const y=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Yl,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const _=this;let b=!1;this._outputColorSpace=Zu;let x=0,w=0,S=null,M=-1,T=null;const A=new Sd,E=new Sd;let C=null;const P=new Yp(0);let I=0,L=e.width,k=e.height,R=1,D=null,N=null;const z=new Sd(0,0,L,k),F=new Sd(0,0,L,k);let O=!1;const B=new og;let U=!1,j=!1;const V=new ip,H=new Jh,G=new Sd,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function Z(){return null===S?R:1}let X,Y,K,J,$,Q,tt,et,nt,it,rt,at,ot,st,lt,ct,ut,ht,dt,pt,ft,mt,gt,yt,vt=n;function _t(t,n){return e.getContext(t,n)}try{const t={alpha:!0,depth:i,stencil:r,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r".concat($s)),e.addEventListener("webglcontextlost",wt,!1),e.addEventListener("webglcontextrestored",St,!1),e.addEventListener("webglcontextcreationerror",Mt,!1),null===vt){const e="webgl2";if(vt=_t(e,t),null===vt)throw _t(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(uA){throw console.error("THREE.WebGLRenderer: "+uA.message),uA}function bt(){X=new yw(vt),X.init(),mt=new pM(vt,X),Y=new Kx(vt,X,t,mt),K=new hM(vt,X),Y.reversedDepthBuffer&&h&&K.buffers.depth.setReversed(!0),J=new bw(vt),$=new $S,Q=new dM(vt,X,K,$,Y,mt,J),tt=new $x(_),et=new gw(_),nt=new Ux(vt),gt=new Xx(vt,nt),it=new vw(vt,nt,J,gt),rt=new ww(vt,it,nt,J),dt=new xw(vt,Y,Q),ct=new Jx($),at=new JS(_,tt,et,X,Y,gt,ct),ot=new vM(_,$),st=new nM,lt=new lM(X),ht=new Zx(_,tt,et,K,rt,d,s),ut=new cM(_,rt,Y),yt=new _M(vt,J,Y,K),pt=new Yx(vt,X,J),ft=new _w(vt,X,J),J.programs=at.programs,_.capabilities=Y,_.extensions=X,_.properties=$,_.renderLists=st,_.shadowMap=ut,_.state=K,_.info=J}bt();const xt=new mM(_,vt);function wt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const t=J.autoReset,e=ut.enabled,n=ut.autoUpdate,i=ut.needsUpdate,r=ut.type;bt(),J.autoReset=t,ut.enabled=e,ut.autoUpdate=n,ut.needsUpdate=i,ut.type=r}function Mt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Tt(t){const e=t.target;e.removeEventListener("dispose",Tt),function(t){(function(t){const e=$.get(t).programs;void 0!==e&&(e.forEach(function(t){at.releaseProgram(t)}),t.isShaderMaterial&&at.releaseShaderCache(t))})(t),$.remove(t)}(e)}function At(t,e,n){!0===t.transparent&&t.side===hl&&!1===t.forceSinglePass?(t.side=ul,t.needsUpdate=!0,zt(t,e,n),t.side=cl,t.needsUpdate=!0,zt(t,e,n),t.side=hl):zt(t,e,n)}this.xr=xt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(t){void 0!==t&&(R=t,this.setSize(L,k,!1))},this.getSize=function(t){return t.set(L,k)},this.setSize=function(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];xt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=t,k=n,e.width=Math.floor(t*R),e.height=Math.floor(n*R),!0===i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(L*R,k*R).floor()},this.setDrawingBufferSize=function(t,n,i){L=t,k=n,R=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(z)},this.setViewport=function(t,e,n,i){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,n,i),K.viewport(A.copy(z).multiplyScalar(R).round())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,n,i){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,n,i),K.scissor(E.copy(F).multiplyScalar(R).round())},this.getScissorTest=function(){return O},this.setScissorTest=function(t){K.setScissorTest(O=t)},this.setOpaqueSort=function(t){D=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return t.copy(ht.getClearColor())},this.setClearColor=function(){ht.setClearColor(...arguments)},this.getClearAlpha=function(){return ht.getClearAlpha()},this.setClearAlpha=function(){ht.setClearAlpha(...arguments)},this.clear=function(){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let t=!1;if(null!==S){const e=S.texture.format;t=e===Zc||e===Wc||e===Hc}if(t){const t=S.texture.type,e=t===Mc||t===Pc||t===Ec||t===Dc||t===kc||t===Rc,n=ht.getClearColor(),i=ht.getClearAlpha(),r=n.r,a=n.g,o=n.b;e?(p[0]=r,p[1]=a,p[2]=o,p[3]=i,vt.clearBufferuiv(vt.COLOR,0,p)):(f[0]=r,f[1]=a,f[2]=o,f[3]=i,vt.clearBufferiv(vt.COLOR,0,f))}else n|=vt.COLOR_BUFFER_BIT}t&&(n|=vt.DEPTH_BUFFER_BIT),e&&(n|=vt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),vt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",wt,!1),e.removeEventListener("webglcontextrestored",St,!1),e.removeEventListener("webglcontextcreationerror",Mt,!1),ht.dispose(),st.dispose(),lt.dispose(),$.dispose(),tt.dispose(),et.dispose(),rt.dispose(),gt.dispose(),yt.dispose(),at.dispose(),xt.dispose(),xt.removeEventListener("sessionstart",Ct),xt.removeEventListener("sessionend",Pt),It.stop()},this.renderBufferDirect=function(t,e,n,i,r,a){null===e&&(e=W);const o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(t,e,n,i,r){!0!==e.isScene&&(e=W);Q.resetTextureUnits();const a=e.fog,o=i.isMeshStandardMaterial?e.environment:null,s=null===S?_.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:Xu,l=(i.isMeshStandardMaterial?et:tt).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=Yl;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=_.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==m?m.length:0,v=$.get(i),b=g.state.lights;if(!0===U&&(!0===j||t!==T)){const e=t===T&&i.id===M;ct.setState(i,t,e)}let x=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==b.state.version||v.outputColorSpace!==s||r.isBatchedMesh&&!1===v.batching?x=!0:r.isBatchedMesh||!0!==v.batching?r.isBatchedMesh&&!0===v.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===v.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===v.instancing?x=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?x=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===v.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===v.instancingMorph&&null!==r.morphTexture||v.envMap!==l||!0===i.fog&&v.fog!==a?x=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===ct.numPlanes&&v.numIntersection===ct.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==y)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,v.__version=i.version);let w=v.currentProgram;!0===x&&(w=zt(i,e,r));let A=!1,E=!1,C=!1;const P=w.getUniforms(),I=v.uniforms;K.useProgram(w.program)&&(A=!0,E=!0,C=!0);i.id!==M&&(M=i.id,E=!0);if(A||T!==t){K.buffers.depth.getReversed()&&!0!==t.reversedDepth&&(t._reversedDepth=!0,t.updateProjectionMatrix()),P.setValue(vt,"projectionMatrix",t.projectionMatrix),P.setValue(vt,"viewMatrix",t.matrixWorldInverse);const e=P.map.cameraPosition;void 0!==e&&e.setValue(vt,H.setFromMatrixPosition(t.matrixWorld)),Y.logarithmicDepthBuffer&&P.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,E=!0,C=!0)}if(r.isSkinnedMesh){P.setOptional(vt,r,"bindMatrix"),P.setOptional(vt,r,"bindMatrixInverse");const t=r.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(vt,"boneTexture",t.boneTexture,Q))}r.isBatchedMesh&&(P.setOptional(vt,r,"batchingTexture"),P.setValue(vt,"batchingTexture",r._matricesTexture,Q),P.setOptional(vt,r,"batchingIdTexture"),P.setValue(vt,"batchingIdTexture",r._indirectTexture,Q),P.setOptional(vt,r,"batchingColorTexture"),null!==r._colorsTexture&&P.setValue(vt,"batchingColorTexture",r._colorsTexture,Q));const L=n.morphAttributes;void 0===L.position&&void 0===L.normal&&void 0===L.color||dt.update(r,n,w);(E||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,P.setValue(vt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==e.environment&&(I.envMapIntensity.value=e.environmentIntensity);E&&(P.setValue(vt,"toneMappingExposure",_.toneMappingExposure),v.needsLights&&(N=C,(D=I).ambientLightColor.needsUpdate=N,D.lightProbe.needsUpdate=N,D.directionalLights.needsUpdate=N,D.directionalLightShadows.needsUpdate=N,D.pointLights.needsUpdate=N,D.pointLightShadows.needsUpdate=N,D.spotLights.needsUpdate=N,D.spotLightShadows.needsUpdate=N,D.rectAreaLights.needsUpdate=N,D.hemisphereLights.needsUpdate=N),a&&!0===i.fog&&ot.refreshFogUniforms(I,a),ot.refreshMaterialUniforms(I,i,R,k,g.state.transmissionRenderTarget[t.id]),ES.upload(vt,Ft(v),I,Q));var D,N;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ES.upload(vt,Ft(v),I,Q),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&P.setValue(vt,"center",r.center);if(P.setValue(vt,"modelViewMatrix",r.modelViewMatrix),P.setValue(vt,"normalMatrix",r.normalMatrix),P.setValue(vt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];yt.update(n,w),yt.bind(n,w)}}return w}(t,e,n,i,r);K.setMaterial(i,o);let l=n.index,c=1;if(!0===i.wireframe){if(l=it.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==a&&(d=Math.max(d,a.start*c),p=Math.min(p,(a.start+a.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;gt.setup(r,i,s,n,l);let y=pt;if(null!==l&&(m=nt.get(l),y=ft,y.setIndex(m)),r.isMesh)!0===i.wireframe?(K.setLineWidth(i.wireframeLinewidth*Z()),y.setMode(vt.LINES)):y.setMode(vt.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),K.setLineWidth(t*Z()),r.isLineSegments?y.setMode(vt.LINES):r.isLineLoop?y.setMode(vt.LINE_LOOP):y.setMode(vt.LINE_STRIP)}else r.isPoints?y.setMode(vt.POINTS):r.isSprite&&y.setMode(vt.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)ld("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),y.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(X.get("WEBGL_multi_draw"))y.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const t=r._multiDrawStarts,e=r._multiDrawCounts,n=r._multiDrawCount,a=l?nt.get(l).bytesPerElement:1,o=$.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)o.setValue(vt,"_gl_DrawID",i),y.render(t[i]/a,e[i])}else if(r.isInstancedMesh)y.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);y.renderInstances(d,f,e)}else y.render(d,f)},this.compile=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=t),g=lt.get(n),g.init(e),v.push(g),n.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))}),t!==n&&t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))}),g.setupLights();const i=new Set;return t.traverse(function(t){if(!(t.isMesh||t.isPoints||t.isLine||t.isSprite))return;const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const a=e[r];At(a,n,t),i.add(a)}else At(e,n,t),i.add(e)}),g=v.pop(),i},this.compileAsync=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.compile(t,e,n);return new Promise(e=>{function n(){i.forEach(function(t){$.get(t).currentProgram.isReady()&&i.delete(t)}),0!==i.size?setTimeout(n,10):e(t)}null!==X.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Et=null;function Ct(){It.stop()}function Pt(){It.start()}const It=new Bx;function Lt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)g.pushLight(t),t.castShadow&&g.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=rt.update(t),r=t.material;r.visible&&m.push(t,e,r,n,G.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||B.intersectsObject(t))){const e=rt.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)),G.applyMatrix4(t.matrixWorld).applyMatrix4(V)),Array.isArray(r)){const i=e.groups;for(let a=0,o=i.length;a<o;a++){const o=i[a],s=r[o.materialIndex];s&&s.visible&&m.push(t,e,s,n,G.z,o)}}else r.visible&&m.push(t,e,r,n,G.z,null)}const r=t.children;for(let a=0,o=r.length;a<o;a++)Lt(r[a],e,n,i)}function kt(t,e,n,i){const r=t.opaque,a=t.transmissive,o=t.transparent;g.setupLightsView(n),!0===U&&ct.setGlobalState(_.clippingPlanes,n),i&&K.viewport(A.copy(i)),r.length>0&&Dt(r,e,n),a.length>0&&Dt(a,e,n),o.length>0&&Dt(o,e,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Rt(t,e,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[i.id]&&(g.state.transmissionRenderTarget[i.id]=new Td(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")||X.has("EXT_color_buffer_float")?Lc:Mc,minFilter:wc,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:dd.workingColorSpace}));const a=g.state.transmissionRenderTarget[i.id],o=i.viewport||A;a.setSize(o.z*_.transmissionResolutionScale,o.w*_.transmissionResolutionScale);const s=_.getRenderTarget(),l=_.getActiveCubeFace(),c=_.getActiveMipmapLevel();_.setRenderTarget(a),_.getClearColor(P),I=_.getClearAlpha(),I<1&&_.setClearColor(16777215,.5),_.clear(),q&&ht.render(n);const u=_.toneMapping;_.toneMapping=Yl;const h=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),g.setupLightsView(i),!0===U&&ct.setGlobalState(_.clippingPlanes,i),Dt(t,n,i),Q.updateMultisampleRenderTarget(a),Q.updateRenderTargetMipmap(a),!1===X.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let r=0,a=e.length;r<a;r++){const a=e[r],o=a.object,s=a.geometry,l=a.material,c=a.group;if(l.side===hl&&o.layers.test(i.layers)){const e=l.side;l.side=ul,l.needsUpdate=!0,Nt(o,n,i,s,l,c),l.side=e,l.needsUpdate=!0,t=!0}}!0===t&&(Q.updateMultisampleRenderTarget(a),Q.updateRenderTargetMipmap(a))}_.setRenderTarget(s,l,c),_.setClearColor(P,I),void 0!==h&&(i.viewport=h),_.toneMapping=u}function Dt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,a=t.length;r<a;r++){const a=t[r],o=a.object,s=a.geometry,l=a.group;let c=a.material;!0===c.allowOverride&&null!==i&&(c=i),o.layers.test(n.layers)&&Nt(o,e,n,s,c,l)}}function Nt(t,e,n,i,r,a){t.onBeforeRender(_,e,n,i,r,a),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(_,e,n,i,t,a),!0===r.transparent&&r.side===hl&&!1===r.forceSinglePass?(r.side=ul,r.needsUpdate=!0,_.renderBufferDirect(n,e,i,r,t,a),r.side=cl,r.needsUpdate=!0,_.renderBufferDirect(n,e,i,r,t,a),r.side=hl):_.renderBufferDirect(n,e,i,r,t,a),t.onAfterRender(_,e,n,i,r,a)}function zt(t,e,n){!0!==e.isScene&&(e=W);const i=$.get(t),r=g.state.lights,a=g.state.shadowsArray,o=r.state.version,s=at.getParameters(t,r.state,a,e,n),l=at.getProgramCacheKey(s);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?et:tt).get(t.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===c&&(t.addEventListener("dispose",Tt),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ot(t,s),u}else s.uniforms=at.getUniforms(t),t.onBeforeCompile(s,_),u=at.acquireProgram(s,l),c.set(l,u),i.uniforms=s.uniforms;const h=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=ct.uniform),Ot(t,s),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Ft(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=ES.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Ot(t,e){const n=$.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.batchingColor=e.batchingColor,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}It.setAnimationLoop(function(t){Et&&Et(t)}),"undefined"!==typeof self&&It.setContext(self),this.setAnimationLoop=function(t){Et=t,xt.setAnimationLoop(t),null===t?It.stop():It.start()},xt.addEventListener("sessionstart",Ct),xt.addEventListener("sessionend",Pt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===xt.enabled&&!0===xt.isPresenting&&(!0===xt.cameraAutoUpdate&&xt.updateCamera(e),e=xt.getCamera()),!0===t.isScene&&t.onBeforeRender(_,t,e,S),g=lt.get(t,v.length),g.init(e),v.push(g),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),B.setFromProjectionMatrix(V,kh,e.reversedDepth),j=this.localClippingEnabled,U=ct.init(this.clippingPlanes,j),m=st.get(t,y.length),m.init(),y.push(m),!0===xt.enabled&&!0===xt.isPresenting){const t=_.xr.getDepthSensingMesh();null!==t&&Lt(t,e,-1/0,_.sortObjects)}Lt(t,e,0,_.sortObjects),m.finish(),!0===_.sortObjects&&m.sort(D,N),q=!1===xt.enabled||!1===xt.isPresenting||!1===xt.hasDepthSensing(),q&&ht.addToRenderList(m,t),this.info.render.frame++,!0===U&&ct.beginShadows();const n=g.state.shadowsArray;ut.render(n,t,e),!0===U&&ct.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=m.opaque,r=m.transmissive;if(g.setupLights(),e.isArrayCamera){const n=e.cameras;if(r.length>0)for(let e=0,a=n.length;e<a;e++){Rt(i,r,t,n[e])}q&&ht.render(t);for(let e=0,i=n.length;e<i;e++){const i=n[e];kt(m,t,i,i.viewport)}}else r.length>0&&Rt(i,r,t,e),q&&ht.render(t),kt(m,t,e);null!==S&&0===w&&(Q.updateMultisampleRenderTarget(S),Q.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(_,t,e),gt.resetDefaultState(),M=-1,T=null,v.pop(),v.length>0?(g=v[v.length-1],!0===U&&ct.setGlobalState(_.clippingPlanes,g.state.camera)):g=null,y.pop(),m=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,n){const i=$.get(t);i.__autoAllocateDepthBuffer=!1===t.resolveDepthBuffer,!1===i.__autoAllocateDepthBuffer&&(i.__useRenderToTexture=!1),$.get(t.texture).__webglTexture=e,$.get(t.depthTexture).__webglTexture=i.__autoAllocateDepthBuffer?void 0:n,i.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(t,e){const n=$.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e};const Bt=vt.createFramebuffer();this.setRenderTarget=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S=t,x=e,w=n;let i=!0,r=null,a=!1,o=!1;if(t){const s=$.get(t);if(void 0!==s.__useDefaultFramebuffer)K.bindFramebuffer(vt.FRAMEBUFFER,null),i=!1;else if(void 0===s.__webglFramebuffer)Q.setupRenderTarget(t);else if(s.__hasExternalTextures)Q.rebindTextures(t,$.get(t.texture).__webglTexture,$.get(t.depthTexture).__webglTexture);else if(t.depthBuffer){const e=t.depthTexture;if(s.__boundDepthTexture!==e){if(null!==e&&$.has(e)&&(t.width!==e.image.width||t.height!==e.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Q.setupDepthRenderbuffer(t)}}const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=$.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(c[e])?c[e][n]:c[e],a=!0):r=t.samples>0&&!1===Q.useMultisampledRTT(t)?$.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,A.copy(t.viewport),E.copy(t.scissor),C=t.scissorTest}else A.copy(z).multiplyScalar(R).floor(),E.copy(F).multiplyScalar(R).floor(),C=O;0!==n&&(r=Bt);if(K.bindFramebuffer(vt.FRAMEBUFFER,r)&&i&&K.drawBuffers(t,r),K.viewport(A),K.scissor(E),K.setScissorTest(C),a){const i=$.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(o){const i=e;for(let e=0;e<t.textures.length;e++){const r=$.get(t.textures[e]);vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0+e,r.__webglTexture,n,i)}}else if(null!==t&&0!==n){const e=$.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_2D,e.__webglTexture,n)}M=-1},this.readRenderTargetPixels=function(t,e,n,i,r,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=$.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){K.bindFramebuffer(vt.FRAMEBUFFER,l);try{const o=t.textures[s],l=o.format,c=o.type;if(!Y.textureFormatReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&(t.textures.length>1&&vt.readBuffer(vt.COLOR_ATTACHMENT0+s),vt.readPixels(e,n,i,r,mt.convert(l),mt.convert(c),a))}finally{const t=null!==S?$.get(S).__webglFramebuffer:null;K.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,n,i,r,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=$.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){if(e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r){K.bindFramebuffer(vt.FRAMEBUFFER,l);const o=t.textures[s],c=o.format,u=o.type;if(!Y.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=vt.createBuffer();vt.bindBuffer(vt.PIXEL_PACK_BUFFER,h),vt.bufferData(vt.PIXEL_PACK_BUFFER,a.byteLength,vt.STREAM_READ),t.textures.length>1&&vt.readBuffer(vt.COLOR_ATTACHMENT0+s),vt.readPixels(e,n,i,r,mt.convert(c),mt.convert(u),0);const d=null!==S?$.get(S).__webglFramebuffer:null;K.bindFramebuffer(vt.FRAMEBUFFER,d);const p=vt.fenceSync(vt.SYNC_GPU_COMMANDS_COMPLETE,0);return vt.flush(),await function(t,e,n){return new Promise(function(i,r){setTimeout(function a(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:i()}},n)})}(vt,p,4),vt.bindBuffer(vt.PIXEL_PACK_BUFFER,h),vt.getBufferSubData(vt.PIXEL_PACK_BUFFER,0,a),vt.deleteBuffer(h),vt.deleteSync(p),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i),o=null!==e?e.x:0,s=null!==e?e.y:0;Q.setTexture2D(t,0),vt.copyTexSubImage2D(vt.TEXTURE_2D,n,0,0,o,s,r,a),K.unbindTexture()};const Ut=vt.createFramebuffer(),jt=vt.createFramebuffer();this.copyTextureToTexture=function(t,e){let n,i,r,a,o,s,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===f&&(0!==p?(ld("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),f=p,p=0):f=0);const m=t.isCompressedTexture?t.mipmaps[f]:t.image;if(null!==h)n=h.max.x-h.min.x,i=h.max.y-h.min.y,r=h.isBox3?h.max.z-h.min.z:1,a=h.min.x,o=h.min.y,s=h.isBox3?h.min.z:0;else{const e=Math.pow(2,-p);n=Math.floor(m.width*e),i=Math.floor(m.height*e),r=t.isDataArrayTexture?m.depth:t.isData3DTexture?Math.floor(m.depth*e):1,a=0,o=0,s=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const g=mt.convert(e.format),y=mt.convert(e.type);let v;e.isData3DTexture?(Q.setTexture3D(e,0),v=vt.TEXTURE_3D):e.isDataArrayTexture||e.isCompressedArrayTexture?(Q.setTexture2DArray(e,0),v=vt.TEXTURE_2D_ARRAY):(Q.setTexture2D(e,0),v=vt.TEXTURE_2D),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,e.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,e.unpackAlignment);const _=vt.getParameter(vt.UNPACK_ROW_LENGTH),b=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),x=vt.getParameter(vt.UNPACK_SKIP_PIXELS),w=vt.getParameter(vt.UNPACK_SKIP_ROWS),S=vt.getParameter(vt.UNPACK_SKIP_IMAGES);vt.pixelStorei(vt.UNPACK_ROW_LENGTH,m.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,m.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,a),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,o),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,s);const M=t.isDataArrayTexture||t.isData3DTexture,T=e.isDataArrayTexture||e.isData3DTexture;if(t.isDepthTexture){const h=$.get(t),d=$.get(e),m=$.get(h.__renderTarget),g=$.get(d.__renderTarget);K.bindFramebuffer(vt.READ_FRAMEBUFFER,m.__webglFramebuffer),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let y=0;y<r;y++)M&&(vt.framebufferTextureLayer(vt.READ_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,$.get(t).__webglTexture,p,s+y),vt.framebufferTextureLayer(vt.DRAW_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,$.get(e).__webglTexture,f,u+y)),vt.blitFramebuffer(a,o,n,i,l,c,n,i,vt.DEPTH_BUFFER_BIT,vt.NEAREST);K.bindFramebuffer(vt.READ_FRAMEBUFFER,null),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,null)}else if(0!==p||t.isRenderTargetTexture||$.has(t)){const h=$.get(t),d=$.get(e);K.bindFramebuffer(vt.READ_FRAMEBUFFER,Ut),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,jt);for(let t=0;t<r;t++)M?vt.framebufferTextureLayer(vt.READ_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,h.__webglTexture,p,s+t):vt.framebufferTexture2D(vt.READ_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_2D,h.__webglTexture,p),T?vt.framebufferTextureLayer(vt.DRAW_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,d.__webglTexture,f,u+t):vt.framebufferTexture2D(vt.DRAW_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_2D,d.__webglTexture,f),0!==p?vt.blitFramebuffer(a,o,n,i,l,c,n,i,vt.COLOR_BUFFER_BIT,vt.NEAREST):T?vt.copyTexSubImage3D(v,f,l,c,u+t,a,o,n,i):vt.copyTexSubImage2D(v,f,l,c,a,o,n,i);K.bindFramebuffer(vt.READ_FRAMEBUFFER,null),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,null)}else T?t.isDataTexture||t.isData3DTexture?vt.texSubImage3D(v,f,l,c,u,n,i,r,g,y,m.data):e.isCompressedArrayTexture?vt.compressedTexSubImage3D(v,f,l,c,u,n,i,r,g,m.data):vt.texSubImage3D(v,f,l,c,u,n,i,r,g,y,m):t.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,f,l,c,n,i,g,y,m.data):t.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,f,l,c,m.width,m.height,g,m.data):vt.texSubImage2D(vt.TEXTURE_2D,f,l,c,n,i,g,y,m);vt.pixelStorei(vt.UNPACK_ROW_LENGTH,_),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,b),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,x),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,w),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,S),0===f&&e.generateMipmaps&&vt.generateMipmap(v),K.unbindTexture()},this.initRenderTarget=function(t){void 0===$.get(t).__webglFramebuffer&&Q.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?Q.setTextureCube(t,0):t.isData3DTexture?Q.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?Q.setTexture2DArray(t,0):Q.setTexture2D(t,0),K.unbindTexture()},this.resetState=function(){x=0,w=0,S=null,K.reset(),gt.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return kh}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=dd._getDrawingBufferColorSpace(t),e.unpackColorSpace=dd._getUnpackColorSpace()}}var xM=n(7205);function wM(t){let e;const n=new Set,i=(t,i)=>{const r="function"===typeof t?t(e):t;if(r!==e){const t=e;e=i?r:Object.assign({},e,r),n.forEach(n=>n(e,t))}},r=()=>e,a={setState:i,getState:r,subscribe:(t,i,a)=>i||a?function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let o=i(e);function s(){const n=i(e);if(!a(o,n)){const e=o;t(o=n,e)}}return n.add(s),()=>n.delete(s)}(t,i,a):(n.add(t),()=>n.delete(t)),destroy:()=>n.clear()};return e=t(i,r,a),a}const SM="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function MM(t){const e="function"===typeof t?wM(t):t,n=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,i.useReducer)(t=>t+1,0),a=e.getState(),o=(0,i.useRef)(a),s=(0,i.useRef)(t),l=(0,i.useRef)(n),c=(0,i.useRef)(!1),u=(0,i.useRef)();let h;void 0===u.current&&(u.current=t(a));let d=!1;(o.current!==a||s.current!==t||l.current!==n||c.current)&&(h=t(a),d=!n(u.current,h)),SM(()=>{d&&(u.current=h),o.current=a,s.current=t,l.current=n,c.current=!1});const p=(0,i.useRef)(a);SM(()=>{const t=()=>{try{const t=e.getState(),n=s.current(t);l.current(u.current,n)||(o.current=t,u.current=n,r())}catch(uA){c.current=!0,r()}},n=e.subscribe(t);return e.getState()!==p.current&&t(),n},[]);const f=d?h:u.current;return(0,i.useDebugValue)(f),f};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const t=[n,e];return{next(){const e=t.length<=0;return{value:t.shift(),done:e}}}},n}const TM=[];function AM(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t===e;if(t===e)return!0;if(!t||!e)return!1;const i=t.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!n(t[r],e[r]))return!1;return!0}function EM(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===e&&(e=[t]);for(const o of TM)if(AM(e,o.keys,o.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return i.lifespan&&i.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,i.lifespan)),o.response;if(!n)throw o.promise}const r={keys:e,equal:i.equal,remove:()=>{const t=TM.indexOf(r);-1!==t&&TM.splice(t,1)},promise:(a=t,"object"===typeof a&&"function"===typeof a.then?t:t(...e)).then(t=>{r.response=t,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(t=>r.error=t)};var a;if(TM.push(r),!n)throw r.promise}var CM=n(2016),PM=n.n(CM),IM=n(8853);const LM=["args","attach"],kM=["args","children"],RM=["args","children"],DM=["children","key","ref"],NM=["children","key","ref"],zM=["params"],FM=["events","size"];const OM={};var BM,UM;const jM=t=>"colorSpace"in t||"outputColorSpace"in t,VM=()=>{var t;return null!=(t=OM.ColorManagement)?t:null},HM=t=>t&&t.isOrthographicCamera,GM="undefined"!==typeof window&&(null!=(BM=window.document)&&BM.createElement||"ReactNative"===(null==(UM=window.navigator)?void 0:UM.product))?i.useLayoutEffect:i.useEffect;function WM(t){const e=i.useRef(t);return GM(()=>{e.current=t},[t]),e}function qM(t){let{set:e}=t;return GM(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ZM extends i.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ZM.getDerivedStateFromError=()=>({error:!0});const XM="__default",YM=new Map,KM=t=>t&&!!t.memoized&&!!t.changes;function JM(t){var e;const n="undefined"!==typeof window?null!=(e=window.devicePixelRatio)?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const $M=t=>{var e;return null==(e=t.__r3f)?void 0:e.root.getState()};function QM(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const tT={obj:t=>t===Object(t)&&!tT.arr(t)&&"function"!==typeof t,fun:t=>"function"===typeof t,str:t=>"string"===typeof t,num:t=>"number"===typeof t,boo:t=>"boolean"===typeof t,und:t=>void 0===t,arr:t=>Array.isArray(t),equ(t,e){let{arrays:n="shallow",objects:i="reference",strict:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof t!==typeof e||!!t!==!!e)return!1;if(tT.str(t)||tT.num(t)||tT.boo(t))return t===e;const a=tT.obj(t);if(a&&"reference"===i)return t===e;const o=tT.arr(t);if(o&&"reference"===n)return t===e;if((o||a)&&t===e)return!0;let s;for(s in t)if(!(s in e))return!1;if(a&&"shallow"===n&&"shallow"===i){for(s in r?e:t)if(!tT.equ(t[s],e[s],{strict:r,objects:"reference"}))return!1}else for(s in r?e:t)if(t[s]!==e[s])return!1;if(tT.und(s)){if(o&&0===t.length&&0===e.length)return!0;if(a&&0===Object.keys(t).length&&0===Object.keys(e).length)return!0;if(t!==e)return!1}return!0}};function eT(t){const e={nodes:{},materials:{}};return t&&t.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function nT(t,e){return t.__r3f=kt({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},e),t}function iT(t,e){let n=t;if(e.includes("-")){const i=e.split("-"),r=i.pop();return n=i.reduce((t,e)=>t[e],t),{target:n,key:r}}return{target:n,key:e}}const rT=/-\d+$/;function aT(t,e,n){if(tT.str(n)){if(rT.test(n)){const e=n.replace(rT,""),{target:i,key:r}=iT(t,e);Array.isArray(i[r])||(i[r]=[])}const{target:i,key:r}=iT(t,n);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=n(t,e)}function oT(t,e,n){var i,r;if(tT.str(n)){const{target:i,key:r}=iT(t,n),a=e.__r3f.previousAttach;void 0===a?delete i[r]:i[r]=a}else null==(i=e.__r3f)||null==i.previousAttach||i.previousAttach(t,e);null==(r=e.__r3f)||delete r.previousAttach}function sT(t,e){let{children:n,key:i,ref:r}=e,a=Je(e,DM),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{children:s,key:l,ref:c}=o,u=Je(o,NM),h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=t.__r3f,p=Object.entries(a),f=[];if(h){const t=Object.keys(u);for(let e=0;e<t.length;e++)a.hasOwnProperty(t[e])||p.unshift([t[e],XM+"remove"])}p.forEach(e=>{let[n,i]=e;var r;if(null!=(r=t.__r3f)&&r.primitive&&"object"===n)return;if(tT.equ(i,u[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return f.push([n,i,!0,[]]);let o=[];n.includes("-")&&(o=n.split("-")),f.push([n,i,!1,o]);for(const t in a){const e=a[t];t.startsWith("".concat(n,"-"))&&f.push([t,e,!1,t.split("-")])}});const m=kt({},a);return null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.args&&(m.args=d.memoizedProps.args),null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.attach&&(m.attach=d.memoizedProps.attach),{memoized:m,changes:f}}const lT="undefined"!==typeof process&&!1;function cT(t,e){var n;const i=t.__r3f,r=null==i?void 0:i.root,a=null==r||null==r.getState?void 0:r.getState(),{memoized:o,changes:s}=KM(e)?e:sT(t,e),l=null==i?void 0:i.eventCount;t.__r3f&&(t.__r3f.memoizedProps=o);for(let h=0;h<s.length;h++){let[e,n,r,o]=s[h];if(jM(t)){const t=3001,i="srgb",r="srgb-linear";"encoding"===e?(e="colorSpace",n=n===t?i:r):"outputEncoding"===e&&(e="outputColorSpace",n=n===t?i:r)}let l=t,d=l[e];if(o.length&&(d=o.reduce((t,e)=>t[e],t),!d||!d.set)){const[n,...i]=o.reverse();l=i.reverse().reduce((t,e)=>t[e],t),e=n}if(n===XM+"remove")if(l.constructor){let t=YM.get(l.constructor);t||(t=new l.constructor,YM.set(l.constructor,t)),n=t[e]}else n=0;if(r&&i)n?i.handlers[e]=n:delete i.handlers[e],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof fp)){if(Array.isArray(n))d.fromArray?d.fromArray(n):d.set(...n);else if(d.copy&&n&&n.constructor&&(lT?d.constructor.name===n.constructor.name:d.constructor===n.constructor))d.copy(n);else if(void 0!==n){var c;const t=null==(c=d)?void 0:c.isColor;!t&&d.setScalar?d.setScalar(n):d instanceof fp&&n instanceof fp?d.mask=n.mask:d.set(n),!VM()&&a&&!a.linear&&t&&d.convertSRGBToLinear()}}else{var u;if(l[e]=n,null!=(u=l[e])&&u.isTexture&&l[e].format===Bc&&l[e].type===Mc&&a){const t=l[e];jM(t)&&jM(a.gl)?t.colorSpace=a.gl.outputColorSpace:t.encoding=a.gl.outputEncoding}}uT(t)}if(i&&i.parent&&t.raycast&&l!==i.eventCount){const e=QM(t).getState().internal,n=e.interaction.indexOf(t);n>-1&&e.interaction.splice(n,1),i.eventCount&&e.interaction.push(t)}return!(1===s.length&&"onUpdate"===s[0][0])&&s.length&&null!=(n=t.__r3f)&&n.parent&&hT(t),t}function uT(t){var e,n;const i=null==(e=t.__r3f)||null==(n=e.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function hT(t){null==t.onUpdate||t.onUpdate(t)}function dT(t,e){t.manual||(HM(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function pT(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function fT(t,e,n,i){const r=n.get(e);r&&(n.delete(e),0===n.size&&(t.delete(i),r.target.releasePointerCapture(i)))}function mT(t){function e(t){return t.filter(t=>["Move","Over","Enter","Out","Leave"].some(e=>{var n;return null==(n=t.__r3f)?void 0:n.handlers["onPointer"+e]}))}function n(e){const{internal:n}=t.getState();for(const t of n.hovered.values())if(!e.length||!e.find(e=>e.object===t.object&&e.index===t.index&&e.instanceId===t.instanceId)){const i=t.eventObject.__r3f,r=null==i?void 0:i.handlers;if(n.hovered.delete(pT(t)),null!=i&&i.eventCount){const n=kt(kt({},t),{},{intersections:e});null==r.onPointerOut||r.onPointerOut(n),null==r.onPointerLeave||r.onPointerLeave(n)}}}function i(t,e){for(let n=0;n<e.length;n++){const i=e[n].__r3f;null==i||null==i.handlers.onPointerMissed||i.handlers.onPointerMissed(t)}}return{handlePointer:function(r){switch(r){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return e=>{const{internal:i}=t.getState();"pointerId"in e&&i.capturedMap.has(e.pointerId)&&requestAnimationFrame(()=>{i.capturedMap.has(e.pointerId)&&(i.capturedMap.delete(e.pointerId),n([]))})}}return function(a){const{onPointerMissed:o,internal:s}=t.getState();s.lastEvent.current=a;const l="onPointerMove"===r,c="onClick"===r||"onContextMenu"===r||"onDoubleClick"===r,u=function(e,n){const i=t.getState(),r=new Set,a=[],o=n?n(i.internal.interaction):i.internal.interaction;for(let t=0;t<o.length;t++){const e=$M(o[t]);e&&(e.raycaster.camera=void 0)}i.previousRoot||null==i.events.compute||i.events.compute(e,i);let s=o.flatMap(function(t){const n=$M(t);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(e,n,null==(i=n.previousRoot)?void 0:i.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(t,!0):[]):[];var i}).sort((t,e)=>{const n=$M(t.object),i=$M(e.object);return n&&i&&i.events.priority-n.events.priority||t.distance-e.distance}).filter(t=>{const e=pT(t);return!r.has(e)&&(r.add(e),!0)});i.events.filter&&(s=i.events.filter(s,i));for(const t of s){let e=t.object;for(;e;){var l;null!=(l=e.__r3f)&&l.eventCount&&a.push(kt(kt({},t),{},{eventObject:e})),e=e.parent}}if("pointerId"in e&&i.internal.capturedMap.has(e.pointerId))for(let t of i.internal.capturedMap.get(e.pointerId).values())r.has(pT(t.intersection))||a.push(t.intersection);return a}(a,l?e:void 0),h=c?function(e){const{internal:n}=t.getState(),i=e.offsetX-n.initialClick[0],r=e.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(a):0;"onPointerDown"===r&&(s.initialClick=[a.offsetX,a.offsetY],s.initialHits=u.map(t=>t.eventObject)),c&&!u.length&&h<=2&&(i(a,s.interaction),o&&o(a)),l&&n(u),function(e,i,r,a){const o=t.getState();if(e.length){const t={stopped:!1};for(const s of e){const l=$M(s.object)||o,{raycaster:c,pointer:u,camera:h,internal:d}=l,p=new Jh(u.x,u.y,0).unproject(h),f=t=>{var e,n;return null!=(e=null==(n=d.capturedMap.get(t))?void 0:n.has(s.eventObject))&&e},m=t=>{const e={intersection:s,target:i.target};d.capturedMap.has(t)?d.capturedMap.get(t).set(s.eventObject,e):d.capturedMap.set(t,new Map([[s.eventObject,e]])),i.target.setPointerCapture(t)},g=t=>{const e=d.capturedMap.get(t);e&&fT(d.capturedMap,s.eventObject,e,t)};let y={};for(let t in i){let e=i[t];"function"!==typeof e&&(y[t]=e)}let v=kt(kt(kt({},s),y),{},{pointer:u,intersections:e,stopped:t.stopped,delta:r,unprojectedPoint:p,ray:c.ray,camera:h,stopPropagation(){const r="pointerId"in i&&d.capturedMap.get(i.pointerId);(!r||r.has(s.eventObject))&&(v.stopped=t.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(t=>t.eventObject===s.eventObject))&&n([...e.slice(0,e.indexOf(s)),s])},target:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},currentTarget:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},nativeEvent:i});if(a(v),!0===t.stopped)break}}}(u,a,h,function(t){const e=t.eventObject,n=e.__r3f,o=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){const e=pT(t),n=s.hovered.get(e);n?n.stopped&&t.stopPropagation():(s.hovered.set(e,t),null==o.onPointerOver||o.onPointerOver(t),null==o.onPointerEnter||o.onPointerEnter(t))}null==o.onPointerMove||o.onPointerMove(t)}else{const n=o[r];n?c&&!s.initialHits.includes(e)||(i(a,s.interaction.filter(t=>!s.initialHits.includes(t))),n(t)):c&&s.initialHits.includes(e)&&i(a,s.interaction.filter(t=>!s.initialHits.includes(t)))}})}}}}const gT=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],yT=t=>!(null==t||!t.render),vT=i.createContext(null);let _T,bT=new Set,xT=new Set,wT=new Set;function ST(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function MT(t,e){switch(t){case"before":return ST(bT,e);case"after":return ST(xT,e);case"tail":return ST(wT,e)}}let TT,AT;function ET(t,e,n){let i=e.clock.getDelta();for("never"===e.frameloop&&"number"===typeof t&&(i=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),TT=e.internal.subscribers,_T=0;_T<TT.length;_T++)AT=TT[_T],AT.ref.current(AT.store.getState(),i,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),"always"===e.frameloop?1:e.internal.frames}function CT(){const t=i.useContext(vT);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function PT(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>t,e=arguments.length>1?arguments[1]:void 0;return CT()(t,e)}function IT(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=CT(),i=n.getState().internal.subscribe,r=WM(t);return GM(()=>i(r,e,n),[e,i,n]),null}const LT=new WeakMap;function kT(t,e){return function(n){let i=LT.get(n);i||(i=new n,LT.set(n,i)),t&&t(i);for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return Promise.all(a.map(t=>new Promise((n,r)=>i.load(t,t=>{t.scene&&Object.assign(t,eT(t.scene)),n(t)},e,e=>r(new Error("Could not load ".concat(t,": ").concat(null==e?void 0:e.message)))))))}}function RT(t,e,n,i){const r=Array.isArray(e)?e:[e],a=((t,e,n)=>EM(t,e,!1,n))(kT(n,i),[t,...r],{equal:tT.equ});return Array.isArray(e)?a:a[0]}RT.preload=function(t,e,n){const i=Array.isArray(e)?e:[e];return((t,e,n)=>{EM(t,e,!0,n)})(kT(n),[t,...i])},RT.clear=function(t,e){return(t=>{if(void 0===t||0===t.length)TM.splice(0,TM.length);else{const e=TM.find(e=>AM(t,e.keys,e.equal));e&&e.remove()}})([t,...Array.isArray(e)?e:[e]])};const DT=new Map,{invalidate:NT,advance:zT}=function(t){let e,n,i,r=!1,a=!1;function o(s){n=requestAnimationFrame(o),r=!0,e=0,MT("before",s),a=!0;for(const n of t.values()){var l;i=n.store.getState(),!i.internal.active||!("always"===i.frameloop||i.internal.frames>0)||null!=(l=i.gl.xr)&&l.isPresenting||(e+=ET(s,i))}if(a=!1,MT("after",s),0===e)return MT("tail",s),r=!1,cancelAnimationFrame(n)}return{loop:o,invalidate:function e(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var s;if(!n)return t.forEach(t=>e(t.store.getState(),i));null!=(s=n.gl.xr)&&s.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=i>1?Math.min(60,n.internal.frames+i):a?2:1,r||(r=!0,requestAnimationFrame(o)))},advance:function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n&&MT("before",e),i)ET(e,i,r);else for(const a of t.values())ET(e,a.store.getState());n&&MT("after",e)}}}(DT),{reconciler:FT,applyProps:OT}=function(t,e){function n(t,e,n){let i,{args:r=[],attach:a}=e,o=Je(e,LM),s="".concat(t[0].toUpperCase()).concat(t.slice(1));if("primitive"===t){if(void 0===o.object)throw new Error("R3F: Primitives without 'object' are invalid!");i=nT(o.object,{type:t,root:n,attach:a,primitive:!0})}else{const e=OM[s];if(!e)throw new Error("R3F: ".concat(s," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");i=nT(new e(...r),{type:t,root:n,attach:a,memoizedProps:{args:r}})}return void 0===i.__r3f.attach&&(i.isBufferGeometry?i.__r3f.attach="geometry":i.isMaterial&&(i.__r3f.attach="material")),"inject"!==s&&cT(i,o),i}function i(t,e){let n=!1;var i,r;e&&(null!=(i=e.__r3f)&&i.attach?aT(t,e,e.__r3f.attach):e.isObject3D&&t.isObject3D&&(t.add(e),n=!0),n||null==(r=t.__r3f)||r.objects.push(e),e.__r3f||nT(e,{}),e.__r3f.parent=t,hT(e),uT(e))}function r(t,e,n){let i=!1;if(e){var r,a;if(null!=(r=e.__r3f)&&r.attach)aT(t,e,e.__r3f.attach);else if(e.isObject3D&&t.isObject3D){e.parent=t,e.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:e});const r=t.children.filter(t=>t!==e),a=r.indexOf(n);t.children=[...r.slice(0,a),e,...r.slice(a)],i=!0}i||null==(a=t.__r3f)||a.objects.push(e),e.__r3f||nT(e,{}),e.__r3f.parent=t,hT(e),uT(e)}}function a(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&[...t].forEach(t=>o(e,t,n))}function o(t,e,n){if(e){var i,r,o;if(e.__r3f&&(e.__r3f.parent=null),null!=(i=t.__r3f)&&i.objects&&(t.__r3f.objects=t.__r3f.objects.filter(t=>t!==e)),null!=(r=e.__r3f)&&r.attach)oT(t,e,e.__r3f.attach);else if(e.isObject3D&&t.isObject3D){var s;t.remove(e),null!=(s=e.__r3f)&&s.root&&function(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(t=>t!==e),n.initialHits=n.initialHits.filter(t=>t!==e),n.hovered.forEach((t,i)=>{t.eventObject!==e&&t.object!==e||n.hovered.delete(i)}),n.capturedMap.forEach((t,i)=>{fT(n.capturedMap,e,t,i)})}(QM(e),e)}const c=null==(o=e.__r3f)?void 0:o.primitive,u=!c&&(void 0===n?null!==e.dispose:n);var l;if(!c)a(null==(l=e.__r3f)?void 0:l.objects,e,u),a(e.children,e,u);if(delete e.__r3f,u&&e.dispose&&"Scene"!==e.type){const t=()=>{try{e.dispose()}catch(rJ){}};"undefined"===typeof IS_REACT_ACT_ENVIRONMENT?(0,IM.unstable_scheduleCallback)(IM.unstable_IdlePriority,t):t()}uT(t)}}const s=()=>{},l=PM()({createInstance:n,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,e)=>{if(!e)return;const n=t.getState().scene;n.__r3f&&(n.__r3f.root=t,i(n,e))},removeChildFromContainer:(t,e)=>{e&&o(t.getState().scene,e)},insertInContainerBefore:(t,e,n)=>{if(!e||!n)return;const i=t.getState().scene;i.__r3f&&r(i,e,n)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var e;const n=null!=(e=null==t?void 0:t.__r3f)?e:{};return Boolean(n.handlers)},prepareUpdate(t,e,n,i){var r;if((null!=(r=null==t?void 0:t.__r3f)?r:{}).primitive&&i.object&&i.object!==t)return[!0];{const{args:e=[],children:r}=i,a=Je(i,kM),{args:o=[],children:s}=n,l=Je(n,RM);if(!Array.isArray(e))throw new Error("R3F: the args prop must be an array!");if(e.some((t,e)=>t!==o[e]))return[!0];const c=sT(t,a,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(t,e,r,a,s,l){let[c,u]=e;c?function(t,e,r,a){var s;const l=null==(s=t.__r3f)?void 0:s.parent;if(!l)return;const c=n(e,r,t.__r3f.root);if(t.children){for(const e of t.children)e.__r3f&&i(c,e);t.children=t.children.filter(t=>!t.__r3f)}t.__r3f.objects.forEach(t=>i(c,t)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||o(l,t),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),i(l,c),c.raycast&&c.__r3f.eventCount&&QM(c).getState().internal.interaction.push(c);[a,a.alternate].forEach(t=>{null!==t&&(t.stateNode=c,t.ref&&("function"===typeof t.ref?t.ref(c):t.ref.current=c))})}(t,r,s,l):cT(t,u)},commitMount(t,e,n,i){var r;const a=null!=(r=t.__r3f)?r:{};t.raycast&&a.handlers&&a.eventCount&&QM(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>nT(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var e;const{attach:n,parent:i}=null!=(e=t.__r3f)?e:{};n&&i&&oT(i,t,n),t.isObject3D&&(t.visible=!1),uT(t)},unhideInstance(t,e){var n;const{attach:i,parent:r}=null!=(n=t.__r3f)?n:{};i&&r&&aT(r,t,i),(t.isObject3D&&null==e.visible||e.visible)&&(t.visible=!0),uT(t)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>e?e():xM.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!==typeof performance&&tT.fun(performance.now)?performance.now:tT.fun(Date.now)?Date.now:()=>0,scheduleTimeout:tT.fun(setTimeout)?setTimeout:void 0,cancelTimeout:tT.fun(clearTimeout)?clearTimeout:void 0});return{reconciler:l,applyProps:cT}}(0,function(){var t;const e="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!e)return xM.DefaultEventPriority;switch(null==(t=e.event)?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return xM.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return xM.ContinuousEventPriority;default:return xM.DefaultEventPriority}}),BT={objects:"shallow",strict:!1},UT=(t,e)=>{const n="function"===typeof t?t(e):t;return yT(n)?n:new bM(kt({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0},t))};function jT(t){const e=DT.get(t),n=null==e?void 0:e.fiber,r=null==e?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const a="function"===typeof reportError?reportError:console.error,o=r||((t,e)=>{const n=MM((n,r)=>{const a=new Jh,o=new Jh,s=new Jh;function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:i,height:l,top:c,left:u}=n,h=i/l;e.isVector3?s.copy(e):s.set(...e);const d=t.getWorldPosition(a).distanceTo(s);if(HM(t))return{width:i/t.zoom,height:l/t.zoom,top:c,left:u,factor:1,distance:d,aspect:h};{const e=t.fov*Math.PI/180,n=2*Math.tan(e/2)*d,r=n*(i/l);return{width:r,height:n,top:c,left:u,factor:i/r,distance:d,aspect:h}}}let c;const u=t=>n(e=>({performance:kt(kt({},e.performance),{},{current:t})})),h=new Yh,d={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return t(r(),e)},advance:(t,n)=>e(t,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new sb,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const t=r();c&&clearTimeout(c),t.performance.current!==t.performance.min&&u(t.performance.min),c=setTimeout(()=>u(r().performance.max),t.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:t=>n(e=>kt(kt({},e),{},{events:kt(kt({},e.events),t)})),setSize:(t,e,i,a,s)=>{const c=r().camera,u={width:t,height:e,top:a||0,left:s||0,updateStyle:i};n(t=>({size:u,viewport:kt(kt({},t.viewport),l(c,o,u))}))},setDpr:t=>n(e=>{const n=JM(t);return{viewport:kt(kt({},e.viewport),{},{dpr:n,initialDpr:e.viewport.initialDpr||n})}}),setFrameloop:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const e=r().clock;e.stop(),e.elapsedTime=0,"never"!==t&&(e.start(),e.elapsedTime=0),n(()=>({frameloop:t}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(t,e,n)=>{const i=r().internal;return i.priority=i.priority+(e>0?1:0),i.subscribers.push({ref:t,priority:e,store:n}),i.subscribers=i.subscribers.sort((t,e)=>t.priority-e.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(e>0?1:0),n.subscribers=n.subscribers.filter(e=>e.ref!==t))}}}};return d}),r=n.getState();let a=r.size,o=r.viewport.dpr,s=r.camera;return n.subscribe(()=>{const{camera:t,size:e,viewport:i,gl:r,set:l}=n.getState();if(e.width!==a.width||e.height!==a.height||i.dpr!==o){var c;a=e,o=i.dpr,dT(t,e),r.setPixelRatio(i.dpr);const n=null!=(c=e.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&r.domElement instanceof HTMLCanvasElement;r.setSize(e.width,e.height,n)}t!==s&&(s=t,l(e=>({viewport:kt(kt({},e.viewport),e.viewport.getCurrentViewport(t))})))}),n.subscribe(e=>t(e)),n})(NT,zT),s=n||FT.createContainer(o,xM.ConcurrentRoot,null,!1,null,"",a,null);let l;e||DT.set(t,{fiber:s,store:o});let c,u=!1;return{configure(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:i,scene:r,events:a,onCreated:s,shadows:h=!1,linear:d=!1,flat:p=!1,legacy:f=!1,orthographic:m=!1,frameloop:g="always",dpr:y=[1,2],performance:v,raycaster:_,camera:b,onPointerMissed:x}=e,w=o.getState(),S=w.gl;w.gl||w.set({gl:S=UT(n,t)});let M=w.raycaster;M||w.set({raycaster:M=new Ub});const T=_||{},{params:A}=T,E=Je(T,zM);if(tT.equ(E,M,BT)||OT(M,kt({},E)),tT.equ(A,M.params,BT)||OT(M,{params:kt(kt({},M.params),A)}),!w.camera||w.camera===c&&!tT.equ(c,b,BT)){c=b;const t=b instanceof qf,e=t?b:m?new z_(0,0,0,0,.1,1e3):new Kf(75,0,.1,1e3);t||(e.position.z=5,b&&(OT(e,b),("aspect"in b||"left"in b||"right"in b||"bottom"in b||"top"in b)&&(e.manual=!0,e.updateProjectionMatrix())),w.camera||null!=b&&b.rotation||e.lookAt(0,0,0)),w.set({camera:e}),M.camera=e}if(!w.scene){let t;null!=r&&r.isScene?t=r:(t=new om,r&&OT(t,r)),w.set({scene:nT(t)})}if(!w.xr){var C;const t=(t,e)=>{const n=o.getState();"never"!==n.frameloop&&zT(t,!0,n,e)},e=()=>{const e=o.getState();e.gl.xr.enabled=e.gl.xr.isPresenting,e.gl.xr.setAnimationLoop(e.gl.xr.isPresenting?t:null),e.gl.xr.isPresenting||NT(e)},n={connect(){const t=o.getState().gl;t.xr.addEventListener("sessionstart",e),t.xr.addEventListener("sessionend",e)},disconnect(){const t=o.getState().gl;t.xr.removeEventListener("sessionstart",e),t.xr.removeEventListener("sessionend",e)}};"function"===typeof(null==(C=S.xr)?void 0:C.addEventListener)&&n.connect(),w.set({xr:n})}if(S.shadowMap){const t=S.shadowMap.enabled,e=S.shadowMap.type;if(S.shadowMap.enabled=!!h,tT.boo(h))S.shadowMap.type=sl;else if(tT.str(h)){var P;const t={basic:al,percentage:ol,soft:sl,variance:ll};S.shadowMap.type=null!=(P=t[h])?P:sl}else tT.obj(h)&&Object.assign(S.shadowMap,h);t===S.shadowMap.enabled&&e===S.shadowMap.type||(S.shadowMap.needsUpdate=!0)}const I=VM();if(I&&("enabled"in I?I.enabled=!f:"legacyMode"in I&&(I.legacyMode=f)),!u){OT(S,{outputEncoding:d?3e3:3001,toneMapping:p?Yl:Ql})}w.legacy!==f&&w.set(()=>({legacy:f})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==p&&w.set(()=>({flat:p})),!n||tT.fun(n)||yT(n)||tT.equ(n,S,BT)||OT(S,n),a&&!w.events.handlers&&w.set({events:a(o)});const L=function(t,e){const n="undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement;if(e){const{width:t,height:i,top:r,left:a,updateStyle:o=n}=e;return{width:t,height:i,top:r,left:a,updateStyle:o}}if("undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:e,height:i,top:r,left:a}=t.parentElement.getBoundingClientRect();return{width:e,height:i,top:r,left:a,updateStyle:n}}return"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas?{width:t.width,height:t.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(t,i);return tT.equ(L,w.size,BT)||w.setSize(L.width,L.height,L.updateStyle,L.top,L.left),y&&w.viewport.dpr!==JM(y)&&w.setDpr(y),w.frameloop!==g&&w.setFrameloop(g),w.onPointerMissed||w.set({onPointerMissed:x}),v&&!tT.equ(v,w.performance,BT)&&w.set(t=>({performance:kt(kt({},t.performance),v)})),l=s,u=!0,this},render(e){return u||this.configure(),FT.updateContainer((0,Rt.jsx)(VT,{store:o,children:e,onCreated:l,rootElement:t}),s,null,()=>{}),o},unmount(){HT(t)}}}function VT(t){let{store:e,children:n,onCreated:i,rootElement:r}=t;return GM(()=>{const t=e.getState();t.set(t=>({internal:kt(kt({},t.internal),{},{active:!0})})),i&&i(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)},[]),(0,Rt.jsx)(vT.Provider,{value:e,children:n})}function HT(t,e){const n=DT.get(t),i=null==n?void 0:n.fiber;if(i){const r=null==n?void 0:n.store.getState();r&&(r.internal.active=!1),FT.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var n,i,a,o;null==r.events.disconnect||r.events.disconnect(),null==(n=r.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(a=r.gl)||null==a.forceContextLoss||a.forceContextLoss(),null!=(o=r.gl)&&o.xr&&r.xr.disconnect(),function(t){t.dispose&&"Scene"!==t.type&&t.dispose();for(const e in t)null==e.dispose||e.dispose(),delete t[e]}(r),DT.delete(t),e&&e(t)}catch(rJ){}},500)})}}function GT(t){let{state:e={},children:n,container:r}=t;const{events:a,size:o}=e,s=Je(e,FM),l=CT(),[c]=i.useState(()=>new Ub),[u]=i.useState(()=>new Yh),h=i.useCallback((t,e)=>{const n=kt({},t);let i;if(Object.keys(t).forEach(i=>{(gT.includes(i)||t[i]!==e[i]&&e[i])&&delete n[i]}),e&&o){const n=e.camera;i=t.viewport.getCurrentViewport(n,new Jh,o),n!==t.camera&&dT(n,o)}return kt(kt({},n),{},{scene:r,raycaster:c,pointer:u,mouse:u,previousRoot:l,events:kt(kt(kt({},t.events),null==e?void 0:e.events),a),size:kt(kt({},t.size),o),viewport:kt(kt({},t.viewport),i)},s)},[e]),[d]=i.useState(()=>{const t=l.getState(),e=MM((e,n)=>kt(kt(kt({},t),{},{scene:r,raycaster:c,pointer:u,mouse:u,previousRoot:l,events:kt(kt({},t.events),a),size:kt(kt({},t.size),o)},s),{},{set:e,get:n,setEvents:t=>e(e=>kt(kt({},e),{},{events:kt(kt({},e.events),t)}))}));return e});return i.useEffect(()=>{const t=l.subscribe(t=>d.setState(e=>h(t,e)));return()=>{t()}},[h]),i.useEffect(()=>{d.setState(t=>h(l.getState(),t))},[h]),i.useEffect(()=>()=>{d.destroy()},[]),(0,Rt.jsx)(Rt.Fragment,{children:FT.createPortal((0,Rt.jsx)(vT.Provider,{value:d,children:n}),d,null)})}FT.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:i.version});i.unstable_act;const WT={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function qT(t){const{handlePointer:e}=mT(t);return{priority:1,enabled:!0,compute(t,e,n){e.pointer.set(t.offsetX/e.size.width*2-1,-t.offsetY/e.size.height*2+1),e.raycaster.setFromCamera(e.pointer,e.camera)},connected:void 0,handlers:Object.keys(WT).reduce((t,n)=>kt(kt({},t),{},{[n]:e(n)}),{}),update:()=>{var e;const{events:n,internal:i}=t.getState();null!=(e=i.lastEvent)&&e.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:e=>{var n;const{set:i,events:r}=t.getState();null==r.disconnect||r.disconnect(),i(t=>({events:kt(kt({},t.events),{},{connected:e})})),Object.entries(null!=(n=r.handlers)?n:[]).forEach(t=>{let[n,i]=t;const[r,a]=WT[n];e.addEventListener(r,i,{passive:a})})},disconnect:()=>{const{set:e,events:n}=t.getState();var i;n.connected&&(Object.entries(null!=(i=n.handlers)?i:[]).forEach(t=>{let[e,i]=t;if(n&&n.connected instanceof HTMLElement){const[t]=WT[e];n.connected.removeEventListener(t,i)}}),e(t=>({events:kt(kt({},t.events),{},{connected:void 0})})))}}}function ZT(t,e){let n;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function XT(){let{debounce:t,scroll:e,polyfill:n,offsetSize:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debounce:0,scroll:!1,offsetSize:!1};const a=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,s]=(0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),c=t?"number"==typeof t?t:t.scroll:null,u=t?"number"==typeof t?t:t.resize:null,h=(0,i.useRef)(!1);(0,i.useEffect)(()=>(h.current=!0,()=>{h.current=!1}));const[d,p,f]=(0,i.useMemo)(()=>{const t=()=>{if(!l.current.element)return;const{left:t,top:e,width:n,height:i,bottom:a,right:o,x:c,y:u}=l.current.element.getBoundingClientRect(),d={left:t,top:e,width:n,height:i,bottom:a,right:o,x:c,y:u};l.current.element instanceof HTMLElement&&r&&(d.height=l.current.element.offsetHeight,d.width=l.current.element.offsetWidth),Object.freeze(d),h.current&&!JT(l.current.lastBounds,d)&&s(l.current.lastBounds=d)};return[t,u?ZT(t,u):t,c?ZT(t,c):t]},[s,r,c,u]);function m(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(t=>t.removeEventListener("scroll",f,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null),l.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",l.current.orientationHandler))}function g(){l.current.element&&(l.current.resizeObserver=new a(f),l.current.resizeObserver.observe(l.current.element),e&&l.current.scrollContainers&&l.current.scrollContainers.forEach(t=>t.addEventListener("scroll",f,{capture:!0,passive:!0})),l.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",l.current.orientationHandler))}return function(t,e){(0,i.useEffect)(()=>{if(e){const e=t;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}},[t,e])}(f,!!e),function(t){(0,i.useEffect)(()=>{const e=t;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[t])}(p),(0,i.useEffect)(()=>{m(),g()},[e,f,p]),(0,i.useEffect)(()=>m,[]),[t=>{!t||t===l.current.element||(m(),l.current.element=t,l.current.scrollContainers=YT(t),g())},o,d]}function YT(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:i,overflowY:r}=window.getComputedStyle(t);return[n,i,r].some(t=>"auto"===t||"scroll"===t)&&e.push(t),[...e,...YT(t.parentElement)]}const KT=["x","y","top","bottom","left","right","width","height"],JT=(t,e)=>KT.every(n=>t[n]===e[n]);var $T,QT,tA=Object.defineProperty,eA=Object.defineProperties,nA=Object.getOwnPropertyDescriptors,iA=Object.getOwnPropertySymbols,rA=Object.prototype.hasOwnProperty,aA=Object.prototype.propertyIsEnumerable,oA=(t,e,n)=>e in t?tA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sA=(t,e)=>{for(var n in e||(e={}))rA.call(e,n)&&oA(t,n,e[n]);if(iA)for(var n of iA(e))aA.call(e,n)&&oA(t,n,e[n]);return t};"undefined"===typeof window||!(null==($T=window.document)?void 0:$T.createElement)&&"ReactNative"!==(null==(QT=window.navigator)?void 0:QT.product)?i.useEffect:i.useLayoutEffect;function lA(t,e,n){if(!t)return;if(!0===n(t))return t;let i=e?t.return:t.child;for(;i;){const t=lA(i,e,n);if(t)return t;i=e?null:i.sibling}}function cA(t){try{return Object.defineProperties(t,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(lV){return t}}const uA=console.error;console.error=function(){const t=[...arguments].join("");if(!(null==t?void 0:t.startsWith("Warning:"))||!t.includes("useContext"))return uA.apply(this,arguments);console.error=uA};const hA=cA(i.createContext(null));class dA extends i.Component{render(){return i.createElement(hA.Provider,{value:this._reactInternals},this.props.children)}}function pA(){const t=i.useContext(hA);if(null===t)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=i.useId();return i.useMemo(()=>{for(const n of[t,null==t?void 0:t.alternate]){if(!n)continue;const t=lA(n,!1,t=>{let n=t.memoizedState;for(;n;){if(n.memoizedState===e)return!0;n=n.next}});if(t)return t}},[t,e])}function fA(){const t=function(){const t=pA(),[e]=i.useState(()=>new Map);e.clear();let n=t;for(;n;){if(n.type&&"object"===typeof n.type){const t=void 0===n.type._context&&n.type.Provider===n.type?n.type:n.type._context;t&&t!==hA&&!e.has(t)&&e.set(t,i.useContext(cA(t)))}n=n.return}return e}();return i.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>i.createElement(e,null,i.createElement(n.Provider,((t,e)=>eA(t,nA(e)))(sA({},r),{value:t.get(n)}))),t=>i.createElement(dA,sA({},t))),[t])}const mA=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","scene","onPointerMissed","onCreated"],gA=i.forwardRef(function(e,n){let{children:r,fallback:a,resize:o,style:s,gl:l,events:c=qT,eventSource:u,eventPrefix:h,shadows:d,linear:p,flat:f,legacy:m,orthographic:g,frameloop:y,dpr:v,performance:_,raycaster:b,camera:x,scene:w,onPointerMissed:S,onCreated:M}=e,T=Je(e,mA);i.useMemo(()=>{return e=t,void Object.assign(OM,e);var e},[]);const A=fA(),[E,C]=XT(kt({scroll:!0,debounce:{scroll:50,resize:0}},o)),P=i.useRef(null),I=i.useRef(null);i.useImperativeHandle(n,()=>P.current);const L=WM(S),[k,R]=i.useState(!1),[D,N]=i.useState(!1);if(k)throw k;if(D)throw D;const z=i.useRef(null);GM(()=>{const t=P.current;C.width>0&&C.height>0&&t&&(z.current||(z.current=jT(t)),z.current.configure({gl:l,events:c,shadows:d,linear:p,flat:f,legacy:m,orthographic:g,frameloop:y,dpr:v,performance:_,raycaster:b,camera:x,scene:w,size:C,onPointerMissed:function(){return null==L.current?void 0:L.current(...arguments)},onCreated:t=>{var e;null==t.events.connect||t.events.connect(u?(e=u)&&e.hasOwnProperty("current")?u.current:u:I.current),h&&t.setEvents({compute:(t,e)=>{const n=t[h+"X"],i=t[h+"Y"];e.pointer.set(n/e.size.width*2-1,-i/e.size.height*2+1),e.raycaster.setFromCamera(e.pointer,e.camera)}}),null==M||M(t)}}),z.current.render((0,Rt.jsx)(A,{children:(0,Rt.jsx)(ZM,{set:N,children:(0,Rt.jsx)(i.Suspense,{fallback:(0,Rt.jsx)(qM,{set:R}),children:null!=r?r:null})})})))}),i.useEffect(()=>{const t=P.current;if(t)return()=>HT(t)},[]);const F=u?"none":"auto";return(0,Rt.jsx)("div",kt(kt({ref:I,style:kt({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:F},s)},T),{},{children:(0,Rt.jsx)("div",{ref:E,style:{width:"100%",height:"100%"},children:(0,Rt.jsx)("canvas",{ref:P,style:{display:"block"},children:a})})}))}),yA=i.forwardRef(function(t,e){return(0,Rt.jsx)(dA,{children:(0,Rt.jsx)(gA,kt(kt({},t),{},{ref:e}))})});function vA(){return vA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},vA.apply(null,arguments)}const _A=["args","children"];function bA(t,e){const n=t+"Geometry";return i.forwardRef((t,r)=>{let{args:a,children:o}=t,s=Je(t,_A);const l=i.useRef(null);return i.useImperativeHandle(r,()=>l.current),i.useLayoutEffect(()=>{null==e||e(l.current)}),i.createElement("mesh",vA({ref:l},s),i.createElement(n,{attach:"geometry",args:a}),o)})}const xA=bA("sphere");var wA=Object.defineProperty,SA=(t,e,n)=>(((t,e,n)=>{e in t?wA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!==typeof e?e+"":e,n),n);function MA(t,e,n,i,r){let a;if(t=t.subarray||t.slice?t:t.buffer,n=n.subarray||n.slice?n:n.buffer,t=e?t.subarray?t.subarray(e,r&&e+r):t.slice(e,r&&e+r):t,n.set)n.set(t,i);else for(a=0;a<t.length;a++)n[a+i]=t[a];return n}class TA extends Af{constructor(){super(),SA(this,"type","MeshLine"),SA(this,"isMeshLine",!0),SA(this,"positions",[]),SA(this,"previous",[]),SA(this,"next",[]),SA(this,"side",[]),SA(this,"width",[]),SA(this,"indices_array",[]),SA(this,"uvs",[]),SA(this,"counters",[]),SA(this,"widthCallback",null),SA(this,"_attributes"),SA(this,"_points",[]),SA(this,"points"),SA(this,"matrixWorld",new ip),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(t){this.setPoints(t,this.widthCallback)}}})}setMatrixWorld(t){this.matrixWorld=t}setPoints(t,e){if(t=function(t){return t instanceof Float32Array?t:t instanceof Af?t.getAttribute("position").array:t.map(t=>{const e=Array.isArray(t);return t instanceof Jh?[t.x,t.y,t.z]:t instanceof Yh?[t.x,t.y,0]:e&&3===t.length?[t[0],t[1],t[2]]:e&&2===t.length?[t[0],t[1],0]:t}).flat()}(t),this._points=t,this.widthCallback=null!=e?e:null,this.positions=[],this.counters=[],t.length&&t[0]instanceof Jh)for(let n=0;n<t.length;n++){const e=t[n],i=n/(t.length-1);this.positions.push(e.x,e.y,e.z),this.positions.push(e.x,e.y,e.z),this.counters.push(i),this.counters.push(i)}else for(let n=0;n<t.length;n+=3){const e=n/(t.length-1);this.positions.push(t[n],t[n+1],t[n+2]),this.positions.push(t[n],t[n+1],t[n+2]),this.counters.push(e),this.counters.push(e)}this.process()}compareV3(t,e){const n=6*t,i=6*e;return this.positions[n]===this.positions[i]&&this.positions[n+1]===this.positions[i+1]&&this.positions[n+2]===this.positions[i+2]}copyV3(t){const e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]}process(){const t=this.positions.length/6;let e,n;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],n=this.compareV3(0,t-1)?this.copyV3(t-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let i=0;i<t;i++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(t-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(t-1),0),this.uvs.push(i/(t-1),1),i<t-1){n=this.copyV3(i),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const t=2*i;this.indices_array.push(t,t+1,t+2),this.indices_array.push(t+2,t+1,t+3)}i>0&&(n=this.copyV3(i),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}n=this.compareV3(t-1,0)?this.copyV3(1):this.copyV3(t-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new cf(new Float32Array(this.positions),3),previous:new cf(new Float32Array(this.previous),3),next:new cf(new Float32Array(this.next),3),side:new cf(new Float32Array(this.side),1),width:new cf(new Float32Array(this.width),1),uv:new cf(new Float32Array(this.uvs),2),index:new cf(new Uint16Array(this.indices_array),1),counters:new cf(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance(t){let{x:e,y:n,z:i}=t;const r=this._attributes.position.array,a=this._attributes.previous.array,o=this._attributes.next.array,s=r.length;MA(r,0,a,0,s),MA(r,6,r,0,s-6),r[s-6]=e,r[s-5]=n,r[s-4]=i,r[s-3]=e,r[s-2]=n,r[s-1]=i,MA(r,6,o,0,s-6),o[s-6]=e,o[s-5]=n,o[s-4]=i,o[s-3]=e,o[s-2]=n,o[s-1]=i,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const AA="\n  #include <fog_pars_fragment>\n  #include <logdepthbuf_pars_fragment>\n  #include <clipping_planes_pars_fragment>\n  \n  uniform sampler2D map;\n  uniform sampler2D alphaMap;\n  uniform float useGradient;\n  uniform float useMap;\n  uniform float useAlphaMap;\n  uniform float useDash;\n  uniform float dashArray;\n  uniform float dashOffset;\n  uniform float dashRatio;\n  uniform float visibility;\n  uniform float alphaTest;\n  uniform vec2 repeat;\n  uniform vec3 gradient[2];\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  void main() {\n    #include <logdepthbuf_fragment>\n    vec4 diffuseColor = vColor;\n    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);\n    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);\n    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;\n    if (diffuseColor.a < alphaTest) discard;\n    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));\n    diffuseColor.a *= step(vCounters, visibility);\n    #include <clipping_planes_fragment>\n    gl_FragColor = diffuseColor;     \n    #include <fog_fragment>\n    #include <tonemapping_fragment>\n    #include <".concat((()=>parseInt($s.replace(/\D+/g,"")))()>=154?"colorspace_fragment":"encodings_fragment",">\n  }\n");class EA extends Wf{constructor(t){super({uniforms:kt(kt({},Vx.fog),{},{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new Yp(16777215)},gradient:{value:[new Yp(16711680),new Yp(65280)]},opacity:{value:1},resolution:{value:new Yh(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Yh(1,1)}}),vertexShader:"\n  #include <common>\n  #include <logdepthbuf_pars_vertex>\n  #include <fog_pars_vertex>\n  #include <clipping_planes_pars_vertex>\n\n  attribute vec3 previous;\n  attribute vec3 next;\n  attribute float side;\n  attribute float width;\n  attribute float counters;\n  \n  uniform vec2 resolution;\n  uniform float lineWidth;\n  uniform vec3 color;\n  uniform float opacity;\n  uniform float sizeAttenuation;\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  vec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n  }\n  \n  void main() {\n    float aspect = resolution.x / resolution.y;\n    vColor = vec4(color, opacity);\n    vUV = uv;\n    vCounters = counters;\n  \n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4(position, 1.0) * aspect;\n    vec4 prevPos = m * vec4(previous, 1.0);\n    vec4 nextPos = m * vec4(next, 1.0);\n  \n    vec2 currentP = fix(finalPosition, aspect);\n    vec2 prevP = fix(prevPos, aspect);\n    vec2 nextP = fix(nextPos, aspect);\n  \n    float w = lineWidth * width;\n  \n    vec2 dir;\n    if (nextP == currentP) dir = normalize(currentP - prevP);\n    else if (prevP == currentP) dir = normalize(nextP - currentP);\n    else {\n      vec2 dir1 = normalize(currentP - prevP);\n      vec2 dir2 = normalize(nextP - currentP);\n      dir = normalize(dir1 + dir2);\n  \n      vec2 perp = vec2(-dir1.y, dir1.x);\n      vec2 miter = vec2(-dir.y, dir.x);\n      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);\n    }\n  \n    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;\n    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);\n    normal.xy *= .5 * w;\n    //normal *= projectionMatrix;\n    if (sizeAttenuation == 0.) {\n      normal.xy *= finalPosition.w;\n      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;\n    }\n  \n    finalPosition.xy += normal.xy * side;\n    gl_Position = finalPosition;\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    #include <clipping_planes_vertex>\n    #include <fog_vertex>\n  }\n",fragmentShader:AA}),SA(this,"lineWidth"),SA(this,"map"),SA(this,"useMap"),SA(this,"alphaMap"),SA(this,"useAlphaMap"),SA(this,"color"),SA(this,"gradient"),SA(this,"resolution"),SA(this,"sizeAttenuation"),SA(this,"dashArray"),SA(this,"dashOffset"),SA(this,"dashRatio"),SA(this,"useDash"),SA(this,"useGradient"),SA(this,"visibility"),SA(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(t){this.uniforms.color.value=t}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(t){this.uniforms.gradient.value=t}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(t){this.uniforms.useDash.value=t}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(t){this.uniforms.useGradient.value=t}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(t)}copy(t){return super.copy(t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.gradient=t.gradient,this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray=t.dashArray,this.dashOffset=t.dashOffset,this.dashRatio=t.dashRatio,this.useDash=t.useDash,this.useGradient=t.useGradient,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this}}const CA={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},PA=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.set(t.subarray(e)),t.fill(-1/0,-e),t};const IA=i.forwardRef((t,e)=>{const{children:n}=t,{width:r,length:a,decay:o,local:s,stride:l,interval:c}=kt(kt({},CA),t),{color:u="hotpink",attenuation:h,target:d}=t,p=PT(t=>t.size),f=PT(t=>t.scene),m=i.useRef(null),[g,y]=i.useState(null),v=function(t,e){const{length:n,local:r,decay:a,interval:o,stride:s}=kt(kt({},CA),e),l=i.useRef(),[c]=i.useState(()=>new Jh);i.useLayoutEffect(()=>{t&&(l.current=Float32Array.from({length:10*n*3},(e,n)=>t.position.getComponent(n%3)))},[n,t]);const u=i.useRef(new Jh),h=i.useRef(0);return IT(()=>{if(t&&l.current){if(0===h.current){let e;r?e=t.position:(t.getWorldPosition(c),e=c);const n=1*a;for(let t=0;t<n;t++)e.distanceTo(u.current)<s||(PA(l.current,3),l.current.set(e.toArray(),l.current.length-3));u.current.copy(e)}h.current++,h.current=h.current%o}}),l}(g,{length:a,decay:o,local:s,stride:l,interval:c});i.useEffect(()=>{const t=(null==d?void 0:d.current)||m.current.children.find(t=>t instanceof Ip);t&&y(t)},[v,d]);const _=i.useMemo(()=>new TA,[]),b=i.useMemo(()=>{var t;const e=new EA({lineWidth:.1*r,color:u,sizeAttenuation:1,resolution:new Yh(p.width,p.height)});let i;if(n)if(Array.isArray(n))i=n.find(t=>{const e=t;return"string"===typeof e.type&&"meshLineMaterial"===e.type});else{const t=n;"string"===typeof t.type&&"meshLineMaterial"===t.type&&(i=t)}return"object"===typeof(null==(t=i)?void 0:t.props)&&e.setValues(i.props),e},[r,u,p,n]);return i.useEffect(()=>{b.uniforms.resolution.value.set(p.width,p.height)},[p]),IT(()=>{v.current&&_.setPoints(v.current,h)}),i.createElement("group",null,function(t,e,n){return(0,Rt.jsx)(GT,{children:t,container:e,state:n},e.uuid)}(i.createElement("mesh",{ref:e,geometry:_,material:b}),f),i.createElement("group",{ref:m},n))});function LA(t){let{pixelated:e}=t;const n=PT(t=>t.gl),r=PT(t=>t.internal.active),a=PT(t=>t.performance.current),o=PT(t=>t.viewport.initialDpr),s=PT(t=>t.setDpr);return i.useEffect(()=>{const t=n.domElement;return()=>{r&&s(o),e&&t&&(t.style.imageRendering="auto")}},[]),i.useEffect(()=>{s(a*o),e&&n.domElement&&(n.domElement.style.imageRendering=1===a?"auto":"pixelated")},[a]),null}function kA(){const t=(0,i.useRef)(),e=(0,i.useMemo)(()=>{const t=[];for(let e=0;e<2e3;e++){const e=150+150*Math.random(),n=Math.random()*Math.PI*2,i=Math.acos(2*Math.random()-1),r=e*Math.sin(i)*Math.cos(n),a=e*Math.sin(i)*Math.sin(n),o=e*Math.cos(i);t.push(r,a,o)}return new Float32Array(t)},[]);return IT(()=>{t.current&&(t.current.rotation.y+=15e-5)}),(0,Rt.jsxs)("points",{ref:t,frustumCulled:!0,children:[(0,Rt.jsx)("bufferGeometry",{children:(0,Rt.jsx)("bufferAttribute",{attachObject:["attributes","position"],count:e.length/3,array:e,itemSize:3})}),(0,Rt.jsx)("pointsMaterial",{size:.6,sizeAttenuation:!0,color:"#ffffff",transparent:!0,opacity:.85})]})}function RA(){const t=(0,i.useRef)(),e=(0,i.useRef)(),n=(0,i.useRef)(),r=(0,i.useMemo)(()=>{const t=1024,e=document.createElement("canvas");e.width=2048,e.height=t;const n=e.getContext("2d"),i=n.createLinearGradient(0,0,0,t);i.addColorStop(0,"#0a1a3f"),i.addColorStop(1,"#09203f"),n.fillStyle=i,n.fillRect(0,0,2048,t),n.fillStyle="#2e8b57";const r=(t,e,i,r)=>{n.beginPath(),n.ellipse(t,e,i,r,0,0,2*Math.PI),n.fill()};return r(600,420,240,160),r(520,540,120,140),r(800,700,120,220),r(1100,380,150,90),r(1200,580,160,240),r(1400,450,260,180),r(1640,780,120,80),n.fillStyle="#c2a36b",r(1180,520,120,70),r(1320,520,140,80),new ny(e)},[]),a=(0,i.useMemo)(()=>{const t=document.createElement("canvas");t.width=2048,t.height=1024;const e=t.getContext("2d");e.clearRect(0,0,2048,1024);const n=(t,n,i,r)=>{const a=e.createRadialGradient(t,n,0,t,n,i);a.addColorStop(0,"rgba(255, 230, 180, ".concat(r,")")),a.addColorStop(1,"rgba(255, 230, 180, 0)"),e.fillStyle=a,e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fill()};for(let i=0;i<1800;i++){n(380+440*Math.random(),350+300*Math.random(),.8+1.8*Math.random(),.25+.6*Math.random())}return new ny(t)},[]),o=(0,i.useMemo)(()=>{const t=1024,e=document.createElement("canvas");e.width=t,e.height=512;const n=e.getContext("2d");n.clearRect(0,0,t,512),n.fillStyle="rgba(255,255,255,0.65)";for(let i=0;i<120;i++){const e=Math.random()*t,i=512*Math.random(),r=20+80*Math.random(),a=10+40*Math.random();n.beginPath(),n.ellipse(e,i,r,a,Math.random()*Math.PI,0,2*Math.PI),n.fill()}return new ny(e)},[]);return IT(()=>{t.current&&(t.current.rotation.y+=8e-4),e.current&&(e.current.rotation.y+=.001)}),(0,Rt.jsxs)("group",{position:[-2.2,-.2,0],rotation:[.15,-1.2,0],children:[(0,Rt.jsx)(xA,{ref:t,args:[2.4,96,96],children:(0,Rt.jsx)("meshStandardMaterial",{map:r,emissiveMap:a,emissive:"#ffd9a8",emissiveIntensity:.9,roughness:1,metalness:0})}),(0,Rt.jsx)(xA,{ref:e,args:[2.46,64,64],children:(0,Rt.jsx)("meshLambertMaterial",{map:o,transparent:!0,opacity:.55,depthWrite:!1})}),(0,Rt.jsx)(xA,{ref:n,args:[2.6,64,64],children:(0,Rt.jsx)("meshBasicMaterial",{color:"#6fb7ff",transparent:!0,opacity:.12,side:ul,depthWrite:!1})})]})}function DA(t){let{position:e,onDone:n,duration:r=.6}=t;const a=(0,i.useRef)(),o=(0,i.useMemo)(()=>{const t=256,e=document.createElement("canvas");e.width=t,e.height=t;const n=e.getContext("2d"),i=n.createRadialGradient(128,128,10,128,128,128);return i.addColorStop(0,"rgba(255,240,200,1)"),i.addColorStop(.3,"rgba(255,180,60,0.95)"),i.addColorStop(.6,"rgba(255,90,0,0.6)"),i.addColorStop(1,"rgba(255,0,0,0)"),n.fillStyle=i,n.beginPath(),n.arc(128,128,128,0,2*Math.PI),n.fill(),new ny(e)},[]),s=(0,i.useRef)(null);return IT(t=>{let{clock:e}=t;const i=e.getElapsedTime();null===s.current&&(s.current=i);const o=Math.min((i-s.current)/r,1),l=.4+3.5*o,c=1-o;a.current&&(a.current.scale.setScalar(l),a.current.material.opacity=c),o>=1&&n&&n()}),(0,Rt.jsx)("sprite",{ref:a,position:e,children:(0,Rt.jsx)("spriteMaterial",{map:o,color:"#ffd9a8",blending:fl,transparent:!0,depthWrite:!1})})}function NA(){const t=(0,i.useRef)(),e=(0,i.useRef)(),n=(0,i.useRef)(),r=(0,i.useRef)(),[a,o]=(0,i.useState)(null),s=(0,i.useMemo)(()=>{const t=256,e=document.createElement("canvas");e.width=t,e.height=t;const n=e.getContext("2d"),i=n.createRadialGradient(128,128,10,128,128,128);i.addColorStop(0,"rgba(255,200,50,1)"),i.addColorStop(.3,"rgba(255,120,20,0.9)"),i.addColorStop(.6,"rgba(255,80,0,0.6)"),i.addColorStop(1,"rgba(255,0,0,0)"),n.fillStyle=i,n.beginPath(),n.arc(128,128,128,0,2*Math.PI),n.fill();const r=new ny(e);return r.needsUpdate=!0,r.wrapS=r.wrapT=dc,r},[]),l=(0,i.useMemo)(()=>{const t=new Float32Array(1200);for(let e=0;e<400;e++)t[3*e+0]=2*-Math.random(),t[3*e+1]=.6*(Math.random()-.5),t[3*e+2]=.6*(Math.random()-.5);return t},[]),c=(0,i.useRef)(0),u=new Jh(6.5,2.6,-1.4),h=new Jh(-2.2,-.2,0),d=h.clone();return IT((i,r)=>{if(a)return;c.current+=.08*r;const s=Math.min(c.current,1),l=(new Jh).lerpVectors(u,d,s);if(t.current){t.current.visible=!0,t.current.position.copy(l),t.current.rotation.x+=.01,t.current.rotation.y+=.02;const e=(new Jh).subVectors(d,u).normalize();t.current.lookAt(l.clone().add(e))}const p=i.clock.getElapsedTime();e.current&&(e.current.material.opacity=.5+.25*Math.sin(20*p)),n.current&&(n.current.material.opacity=.35+.2*Math.cos(17*p));(l.distanceTo(h)<=2.548||s>=1)&&(t.current&&(t.current.visible=!1),o({position:l.clone()}))}),(0,Rt.jsxs)("group",{children:[(0,Rt.jsxs)("group",{ref:t,children:[(0,Rt.jsx)(IA,{width:2.2,length:12,color:"#ff7a18",attenuation:t=>t,children:(0,Rt.jsxs)("mesh",{castShadow:!0,children:[(0,Rt.jsx)("icosahedronGeometry",{args:[.32,1]}),(0,Rt.jsx)("meshStandardMaterial",{color:"#5a5a5a",roughness:.9,metalness:.1,emissive:"#ff6a00",emissiveIntensity:.15})]})}),(0,Rt.jsx)("sprite",{ref:e,position:[-.35,0,0],children:(0,Rt.jsx)("spriteMaterial",{map:s,color:"#ff7a18",blending:fl,transparent:!0,depthWrite:!1})}),(0,Rt.jsx)("sprite",{ref:n,position:[-.6,.05,0],children:(0,Rt.jsx)("spriteMaterial",{map:s,color:"#ff3d00",blending:fl,transparent:!0,depthWrite:!1})}),(0,Rt.jsxs)("points",{ref:r,position:[-.6,0,0],children:[(0,Rt.jsx)("bufferGeometry",{children:(0,Rt.jsx)("bufferAttribute",{attachObject:["attributes","position"],count:l.length/3,array:l,itemSize:3})}),(0,Rt.jsx)("pointsMaterial",{size:.05,color:"#ffa366",blending:fl,transparent:!0})]})]}),a&&(0,Rt.jsx)(DA,{position:a.position,onDone:()=>{o(null),c.current=0,t.current&&(t.current.visible=!0,t.current.position.copy(u))}})]})}function zA(t){let{intensity:e=.12}=t;const{mouse:n,camera:i}=PT();return IT(()=>{i.position.x=4+(n.x||0)*e,i.position.y=2+(n.y||0)*e,i.lookAt(0,0,0)}),null}function FA(){return(0,Rt.jsx)("div",{className:"hero-bg-canvas",style:{position:"absolute",inset:0},children:(0,Rt.jsxs)(yA,{camera:{position:[8,4,8],fov:50},dpr:[1,1.75],gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},children:[(0,Rt.jsxs)("mesh",{children:[(0,Rt.jsx)("sphereGeometry",{args:[300,32,32]}),(0,Rt.jsx)("meshBasicMaterial",{color:"#000005",side:ul})]}),(0,Rt.jsx)(kA,{}),(0,Rt.jsx)("ambientLight",{intensity:.12,color:"#404080"}),(0,Rt.jsx)("directionalLight",{position:[10,2,5],intensity:1.35,color:"#ffffff"}),(0,Rt.jsx)("pointLight",{position:[-10,-10,-10],intensity:.35,color:"#4050ff"}),(0,Rt.jsx)(RA,{}),(0,Rt.jsx)(NA,{}),(0,Rt.jsx)(zA,{}),(0,Rt.jsx)(LA,{pixelated:!0})]})})}const OA=function(){const{dispatch:t}=Ot(),[e,n]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{const e=["Low","Medium","High","Critical"],n=e[Math.floor(Math.random()*e.length)];t({type:"SET_THREAT_LEVEL",payload:n})},[t]),(0,Rt.jsxs)("div",{className:"home",children:[(0,Rt.jsxs)("section",{className:"hero",children:[(0,Rt.jsx)(FA,{}),(0,Rt.jsxs)("div",{className:"hero-content",children:[(0,Rt.jsxs)("div",{className:"hero-text",children:[(0,Rt.jsxs)(Xs.h1,{className:"hero-title",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:["Impact Explorer",(0,Rt.jsx)("span",{className:"hero-year",children:"2025"})]}),(0,Rt.jsx)(Xs.p,{className:"hero-description",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},children:"Simulate asteroid impacts on Earth using real NASA data. Visualize trajectories, analyze impact zones, and explore the science behind planetary defense."}),(0,Rt.jsxs)(Xs.div,{className:"hero-actions",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},children:[(0,Rt.jsx)(Et,{to:"/dashboard",className:"btn btn--primary btn--large",children:"Explore the Impact"}),(0,Rt.jsxs)("button",{type:"button",className:"btn btn--secondary btn--large",onClick:()=>n(!0),children:[(0,Rt.jsx)("span",{children:"\u25b6"}),"Watch Trailer"]})]})]}),(0,Rt.jsxs)("div",{className:"hero-visualization",children:[(0,Rt.jsx)(i.Suspense,{fallback:(0,Rt.jsx)("div",{className:"loading-spinner"})}),(0,Rt.jsxs)("div",{className:"asteroid-stats",children:[(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("span",{className:"stat-label",children:"ASTEROID SIZE"}),(0,Rt.jsx)("span",{className:"stat-value",children:"247 km"})]}),(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("span",{className:"stat-label",children:"VELOCITY"}),(0,Rt.jsx)("span",{className:"stat-value",children:"19.3 km/s"})]}),(0,Rt.jsxs)("div",{className:"stat-item",children:[(0,Rt.jsx)("span",{className:"stat-label",children:"DISTANCE"}),(0,Rt.jsx)("span",{className:"stat-value",children:"1.94 km"})]}),(0,Rt.jsxs)("div",{className:"stat-item stat-item--danger",children:[(0,Rt.jsx)("span",{className:"stat-label",children:"POTENTIAL RISK"}),(0,Rt.jsx)("span",{className:"stat-value danger-indicator",children:"\u25cf"})]})]})]})]})]}),(0,Rt.jsx)(Js,{open:e,onClose:()=>n(!1),videoId:"1s6l1YfI3IQqRPfe0TQS-iASqJC11OkTS"}),(0,Rt.jsx)("section",{className:"story-preview",children:(0,Rt.jsx)("div",{className:"container",children:(0,Rt.jsx)(Ys,{})})}),(0,Rt.jsx)("section",{className:"research-preview",children:(0,Rt.jsx)("div",{className:"container",children:(0,Rt.jsx)(Ks,{})})}),(0,Rt.jsx)("footer",{className:"home-footer",children:(0,Rt.jsxs)("div",{className:"container",children:[(0,Rt.jsxs)("div",{className:"footer-content",children:[(0,Rt.jsxs)("div",{className:"footer-logo",children:[(0,Rt.jsx)("div",{className:"logo-icon",children:(0,Rt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,Rt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,Rt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,Rt.jsxs)("div",{className:"footer-nav",children:[(0,Rt.jsx)("h4",{children:"Navigation"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)(Et,{to:"/",children:"Home"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)(Et,{to:"/story",children:"Story Mode"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)(Et,{to:"/dashboard",children:"Simulation Dashboard"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)(Et,{to:"/results",children:"Impact Results"})})]})]}),(0,Rt.jsxs)("div",{className:"footer-sources",children:[(0,Rt.jsx)("h4",{children:"Data Sources"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,Rt.jsxs)("div",{className:"footer-bottom",children:[(0,Rt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,Rt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})})]})};const BA=function(){const[t,e]=(0,i.useState)(0),n=[{id:1,title:"The Beginning of the Journey",subtitle:"Step 1: Detection",description:"An asteroid is detected by NASA's Near-Earth Object Observation Program. Scientists calculate its trajectory and determine it is on a collision course.",content:"Learn More"},{id:2,title:"Path Through the Solar System",subtitle:"Step 2: Trajectory",description:"The asteroid point through space, its path determined by gravitational forces. We can now predict exactly where and when it will impact.",content:"Learn More"},{id:3,title:"Entering Earth's Vicinity",subtitle:"Step 3: Approach",description:"As the asteroid approaches Earth, it begins to heat up from atmospheric friction. The space object has a fragile ground.",content:"Learn More"},{id:4,title:"Breaking Through the Atmosphere",subtitle:"Step 4: Entry",description:"The asteroid breaks through Earth's atmosphere, creating a brilliant fireball. Air pressure causes the object to break apart into smaller fragments.",content:"Learn More"},{id:5,title:"The Moment of Collision",subtitle:"Step 5: Impact",description:"Impact occurs with devastating force, released enormous energy that creates craters, triggers seismic activity, and causes widespread damage to the immediate area.",content:"00:45-43:49"}];return(0,i.useEffect)(()=>{const t=()=>{const t=window.scrollY,i=window.innerHeight,r=Math.floor(t/i);e(Math.min(r,n.length-1))};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[n.length]),(0,Rt.jsxs)("div",{className:"story-mode",children:[(0,Rt.jsx)("nav",{className:"story-nav","aria-label":"Story steps",children:n.map((e,n)=>(0,Rt.jsx)("button",{type:"button","aria-label":"Go to step ".concat(e.id,": ").concat(e.title),className:"nav-step ".concat(n===t?"active":""),onClick:()=>{window.scrollTo({top:n*window.innerHeight,behavior:"smooth"})},children:(0,Rt.jsx)("span",{className:"step-index",children:e.id})},e.id))}),n.map((t,e)=>(0,Rt.jsx)("section",{className:"story-section",children:(0,Rt.jsxs)("div",{className:"story-content",children:[(0,Rt.jsxs)("div",{className:"story-text",children:[(0,Rt.jsxs)(Xs.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},transition:{duration:.8,delay:.2},viewport:{once:!0},className:"step-badge",children:[(0,Rt.jsx)("span",{className:"step-number",children:t.id}),(0,Rt.jsx)("span",{className:"step-label",children:t.subtitle})]}),(0,Rt.jsx)(Xs.h1,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.4},viewport:{once:!0},className:"story-title",children:t.title}),(0,Rt.jsx)(Xs.p,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.6},viewport:{once:!0},className:"story-description",children:t.description}),(0,Rt.jsx)(Xs.button,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.8},viewport:{once:!0},className:"story-cta",children:t.content})]}),(0,Rt.jsxs)("div",{className:"story-visual",children:[(0,Rt.jsxs)(Xs.div,{initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},transition:{duration:1,delay:.3},viewport:{once:!0},className:"earth-visual",children:[(0,Rt.jsxs)("div",{className:"earth-globe",children:[(0,Rt.jsx)("div",{className:"earth-surface"}),(0,Rt.jsx)("div",{className:"earth-clouds"})]}),(0,Rt.jsx)("div",{className:"asteroid-trail step-".concat(t.id),children:(0,Rt.jsx)("div",{className:"asteroid"})}),5===t.id&&(0,Rt.jsxs)("div",{className:"impact-effect",children:[(0,Rt.jsx)("div",{className:"impact-flash"}),(0,Rt.jsx)("div",{className:"impact-waves"})]})]}),(0,Rt.jsxs)("div",{className:"visual-label",children:[(0,Rt.jsx)("span",{className:"visual-title",children:"Impact Zone"}),(0,Rt.jsx)("span",{className:"visual-coords",children:"43\xb0N 67\xb0W"})]})]})]})},t.id)),(0,Rt.jsxs)("footer",{className:"story-footer",children:[(0,Rt.jsxs)("div",{className:"footer-container",children:[(0,Rt.jsxs)("div",{className:"footer-logo",children:[(0,Rt.jsx)("div",{className:"logo-icon",children:(0,Rt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,Rt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,Rt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,Rt.jsxs)("div",{className:"footer-nav",children:[(0,Rt.jsx)("h4",{children:"Navigation"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/",children:"Home"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/story",children:"Story Mode"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/dashboard",children:"Simulation Dashboard"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/results",children:"Impact Results"})})]})]}),(0,Rt.jsxs)("div",{className:"footer-sources",children:[(0,Rt.jsx)("h4",{children:"Data Sources"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,Rt.jsxs)("div",{className:"footer-bottom",children:[(0,Rt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,Rt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})]})},UA=JSON.parse('{"Pacific Ocean":{"type":"ocean","centroid":{"lat":-0.703107,"lon":-120.9375},"boundingbox":[-60,66,100,-70],"note":"Huge \u2014 use polygon/bbox, or Nominatim for exact matched node","population":0,"density":0},"Atlantic Ocean":{"type":"ocean","centroid":{"lat":0,"lon":-30},"boundingbox":[-60,70,-90,20],"population":0,"density":0},"Indian Ocean":{"type":"ocean","centroid":{"lat":-20,"lon":80},"boundingbox":[-60,30,20,120],"population":0,"density":0},"Dhaka, Bangladesh":{"type":"city","centroid":{"lat":23.810332,"lon":90.412518},"population":9000000,"density":23000,"note":"Major urban center"},"New York, USA":{"type":"city","centroid":{"lat":40.7128,"lon":-74.006},"population":8400000,"density":10000,"note":"Major urban center"},"Tokyo, Japan":{"type":"city","centroid":{"lat":35.6762,"lon":139.6503},"population":37400000,"density":6000,"note":"Major urban center"},"London, UK":{"type":"city","centroid":{"lat":51.5074,"lon":-0.1278},"population":9300000,"density":5700,"note":"Major urban center"},"Cairo, Egypt":{"type":"city","centroid":{"lat":30.0444,"lon":31.2357},"population":20900000,"density":7400,"note":"Major urban center"},"Rural Bangladesh":{"type":"rural","centroid":{"lat":24,"lon":90.5},"population":500000,"density":1200,"note":"Rural agricultural area"},"Australian Outback":{"type":"rural","centroid":{"lat":-25,"lon":133},"population":50000,"density":0.1,"note":"Sparsely populated desert"},"Amazon Rainforest":{"type":"rural","centroid":{"lat":-3.4653,"lon":-62.2159},"population":100000,"density":0.4,"note":"Dense forest, low population"}}');const jA=function(t){let{impactData:e}=t;const{state:n}=Ot(),{isLoading:i}=n;return i?(0,Rt.jsxs)("div",{className:"preliminary-results preliminary-results--loading",children:[(0,Rt.jsx)("h3",{children:"Preliminary Results"}),(0,Rt.jsxs)("div",{className:"loading-container",children:[(0,Rt.jsx)("div",{className:"loading-spinner"}),(0,Rt.jsx)("p",{children:"Calculating impact parameters..."})]})]}):(0,Rt.jsxs)("div",{className:"preliminary-results",children:[(0,Rt.jsx)("h3",{children:"Preliminary Results"}),(0,Rt.jsxs)("div",{className:"results-list",children:[(0,Rt.jsxs)("div",{className:"result-item",children:[(0,Rt.jsx)("span",{className:"result-label",children:"Asteroid Diameter:"}),(0,Rt.jsxs)("span",{className:"result-value",children:[e?e.asteroidDiameter:"2.5"," km"]})]}),(0,Rt.jsxs)("div",{className:"result-item",children:[(0,Rt.jsx)("span",{className:"result-label",children:"Impact Energy:"}),(0,Rt.jsxs)("span",{className:"result-value result-value--energy",children:[e?e.energy:"12,100"," Megatons"]})]}),(0,Rt.jsxs)("div",{className:"result-item",children:[(0,Rt.jsx)("span",{className:"result-label",children:"Blast Radius:"}),(0,Rt.jsxs)("span",{className:"result-value result-value--blast",children:[e?e.blastRadius:"243.2"," km"]})]}),(0,Rt.jsxs)("div",{className:"result-item",children:[(0,Rt.jsx)("span",{className:"result-label",children:"Affected Population:"}),(0,Rt.jsx)("span",{className:"result-value",children:e?e.affectedPopulation:"2,500,000"})]}),(0,Rt.jsxs)("div",{className:"result-item",children:[(0,Rt.jsx)("span",{className:"result-label",children:"Estimated Casualties:"}),(0,Rt.jsx)("span",{className:"result-value result-value--tsunami",children:e?e.casualties:"250,000"})]})]}),(0,Rt.jsxs)("button",{className:"download-report-btn",children:[(0,Rt.jsx)("span",{className:"btn-icon",children:"\ud83d\udce5"}),"Download Full Report"]})]})};function VA(t){return t+.5|0}const HA=(t,e,n)=>Math.max(Math.min(t,n),e);function GA(t){return HA(VA(2.55*t),0,255)}function WA(t){return HA(VA(255*t),0,255)}function qA(t){return HA(VA(t/2.55)/100,0,1)}function ZA(t){return HA(VA(100*t),0,100)}const XA={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},YA=[..."0123456789ABCDEF"],KA=t=>YA[15&t],JA=t=>YA[(240&t)>>4]+YA[15&t],$A=t=>(240&t)>>4===(15&t);function QA(t){var e=(t=>$A(t.r)&&$A(t.g)&&$A(t.b)&&$A(t.a))(t)?KA:JA;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const tE=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function eE(t,e,n){const i=e*Math.min(n,1-n),r=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+t/30)%12;return n-i*Math.max(Math.min(r-3,9-r,1),-1)};return[r(0),r(8),r(4)]}function nE(t,e,n){const i=function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(i+t/60)%6;return n-n*e*Math.max(Math.min(r,4-r,1),0)};return[i(5),i(3),i(1)]}function iE(t,e,n){const i=eE(t,1,.5);let r;for(e+n>1&&(r=1/(e+n),e*=r,n*=r),r=0;r<3;r++)i[r]*=1-e-n,i[r]+=e;return i}function rE(t){const e=t.r/255,n=t.g/255,i=t.b/255,r=Math.max(e,n,i),a=Math.min(e,n,i),o=(r+a)/2;let s,l,c;return r!==a&&(c=r-a,l=o>.5?c/(2-r-a):c/(r+a),s=function(t,e,n,i,r){return t===r?(e-n)/i+(e<n?6:0):e===r?(n-t)/i+2:(t-e)/i+4}(e,n,i,c,r),s=60*s+.5),[0|s,l||0,o]}function aE(t,e,n,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,i)).map(WA)}function oE(t,e,n){return aE(eE,t,e,n)}function sE(t){return(t%360+360)%360}function lE(t){const e=tE.exec(t);let n,i=255;if(!e)return;e[5]!==n&&(i=e[6]?GA(+e[5]):WA(+e[5]));const r=sE(+e[2]),a=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return aE(iE,t,e,n)}(r,a,o):"hsv"===e[1]?function(t,e,n){return aE(nE,t,e,n)}(r,a,o):oE(r,a,o),{r:n[0],g:n[1],b:n[2],a:i}}const cE={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},uE={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let hE;function dE(t){hE||(hE=function(){const t={},e=Object.keys(uE),n=Object.keys(cE);let i,r,a,o,s;for(i=0;i<e.length;i++){for(o=s=e[i],r=0;r<n.length;r++)a=n[r],s=s.replace(a,cE[a]);a=parseInt(uE[o],16),t[s]=[a>>16&255,a>>8&255,255&a]}return t}(),hE.transparent=[0,0,0,0]);const e=hE[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const pE=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const fE=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,mE=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function gE(t,e,n){if(t){let i=rE(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*n,0===e?360:1)),i=oE(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function yE(t,e){return t?Object.assign(e||{},t):t}function vE(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=WA(t[3]))):(e=yE(t,{r:0,g:0,b:0,a:1})).a=WA(e.a),e}function _E(t){return"r"===t.charAt(0)?function(t){const e=pE.exec(t);let n,i,r,a=255;if(e){if(e[7]!==n){const t=+e[7];a=e[8]?GA(t):HA(255*t,0,255)}return n=+e[1],i=+e[3],r=+e[5],n=255&(e[2]?GA(n):HA(n,0,255)),i=255&(e[4]?GA(i):HA(i,0,255)),r=255&(e[6]?GA(r):HA(r,0,255)),{r:n,g:i,b:r,a:a}}}(t):lE(t)}class bE{constructor(t){if(t instanceof bE)return t;const e=typeof t;let n;"object"===e?n=vE(t):"string"===e&&(n=function(t){var e,n=t.length;return"#"===t[0]&&(4===n||5===n?e={r:255&17*XA[t[1]],g:255&17*XA[t[2]],b:255&17*XA[t[3]],a:5===n?17*XA[t[4]]:255}:7!==n&&9!==n||(e={r:XA[t[1]]<<4|XA[t[2]],g:XA[t[3]]<<4|XA[t[4]],b:XA[t[5]]<<4|XA[t[6]],a:9===n?XA[t[7]]<<4|XA[t[8]]:255})),e}(t)||dE(t)||_E(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=yE(this._rgb);return t&&(t.a=qA(t.a)),t}set rgb(t){this._rgb=vE(t)}rgbString(){return this._valid?function(t){return t&&(t.a<255?"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(qA(t.a),")"):"rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")"))}(this._rgb):void 0}hexString(){return this._valid?QA(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=rE(t),n=e[0],i=ZA(e[1]),r=ZA(e[2]);return t.a<255?"hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(qA(t.a),")"):"hsl(".concat(n,", ").concat(i,"%, ").concat(r,"%)")}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,i=t.rgb;let r;const a=e===r?.5:e,o=2*a-1,s=n.a-i.a,l=((o*s===-1?o:(o+s)/(1+o*s))+1)/2;r=1-l,n.r=255&l*n.r+r*i.r+.5,n.g=255&l*n.g+r*i.g+.5,n.b=255&l*n.b+r*i.b+.5,n.a=a*n.a+(1-a)*i.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const i=mE(qA(t.r)),r=mE(qA(t.g)),a=mE(qA(t.b));return{r:WA(fE(i+n*(mE(qA(e.r))-i))),g:WA(fE(r+n*(mE(qA(e.g))-r))),b:WA(fE(a+n*(mE(qA(e.b))-a))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new bE(this.rgb)}alpha(t){return this._rgb.a=WA(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=VA(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return gE(this._rgb,2,t),this}darken(t){return gE(this._rgb,2,-t),this}saturate(t){return gE(this._rgb,1,t),this}desaturate(t){return gE(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=rE(t);n[0]=sE(n[0]+e),n=oE(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}function xE(){}const wE=(()=>{let t=0;return()=>t++})();function SE(t){return null===t||void 0===t}function ME(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function TE(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function AE(t){return("number"===typeof t||t instanceof Number)&&isFinite(+t)}function EE(t,e){return AE(t)?t:e}function CE(t,e){return"undefined"===typeof t?e:t}const PE=(t,e)=>"string"===typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function IE(t,e,n){if(t&&"function"===typeof t.call)return t.apply(n,e)}function LE(t,e,n,i){let r,a,o;if(ME(t))if(a=t.length,i)for(r=a-1;r>=0;r--)e.call(n,t[r],r);else for(r=0;r<a;r++)e.call(n,t[r],r);else if(TE(t))for(o=Object.keys(t),a=o.length,r=0;r<a;r++)e.call(n,t[o[r]],o[r])}function kE(t,e){let n,i,r,a;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(r=t[n],a=e[n],r.datasetIndex!==a.datasetIndex||r.index!==a.index)return!1;return!0}function RE(t){if(ME(t))return t.map(RE);if(TE(t)){const e=Object.create(null),n=Object.keys(t),i=n.length;let r=0;for(;r<i;++r)e[n[r]]=RE(t[n[r]]);return e}return t}function DE(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function NE(t,e,n,i){if(!DE(t))return;const r=e[t],a=n[t];TE(r)&&TE(a)?zE(r,a,i):e[t]=RE(a)}function zE(t,e,n){const i=ME(e)?e:[e],r=i.length;if(!TE(t))return t;const a=(n=n||{}).merger||NE;let o;for(let s=0;s<r;++s){if(o=i[s],!TE(o))continue;const e=Object.keys(o);for(let i=0,r=e.length;i<r;++i)a(e[i],t,o,n)}return t}function FE(t,e){return zE(t,e,{merger:OE})}function OE(t,e,n){if(!DE(t))return;const i=e[t],r=n[t];TE(i)&&TE(r)?FE(i,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=RE(r))}const BE={"":t=>t,x:t=>t.x,y:t=>t.y};function UE(t,e){const n=BE[e]||(BE[e]=function(t){const e=function(t){const e=t.split("."),n=[];let i="";for(const r of e)i+=r,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(t);return t=>{for(const n of e){if(""===n)break;t=t&&t[n]}return t}}(e));return n(t)}function jE(t){return t.charAt(0).toUpperCase()+t.slice(1)}const VE=t=>"undefined"!==typeof t,HE=t=>"function"===typeof t,GE=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};const WE=Math.PI,qE=2*WE,ZE=qE+WE,XE=Number.POSITIVE_INFINITY,YE=WE/180,KE=WE/2,JE=WE/4,$E=2*WE/3,QE=Math.log10,tC=Math.sign;function eC(t,e,n){return Math.abs(t-e)<n}function nC(t){const e=Math.round(t);t=eC(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(QE(t))),i=t/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function iC(t){return!function(t){return"symbol"===typeof t||"object"===typeof t&&null!==t&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function rC(t,e,n){let i,r,a;for(i=0,r=t.length;i<r;i++)a=t[i][n],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function aC(t){return t*(WE/180)}function oC(t){return t*(180/WE)}function sC(t){if(!AE(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function lC(t,e){const n=e.x-t.x,i=e.y-t.y,r=Math.sqrt(n*n+i*i);let a=Math.atan2(i,n);return a<-.5*WE&&(a+=qE),{angle:a,distance:r}}function cC(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function uC(t,e){return(t-e+ZE)%qE-WE}function hC(t){return(t%qE+qE)%qE}function dC(t,e,n,i){const r=hC(t),a=hC(e),o=hC(n),s=hC(a-r),l=hC(o-r),c=hC(r-a),u=hC(r-o);return r===a||r===o||i&&a===o||s>l&&c<u}function pC(t,e,n){return Math.max(e,Math.min(n,t))}function fC(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return t>=Math.min(e,n)-i&&t<=Math.max(e,n)+i}function mC(t,e,n){n=n||(n=>t[n]<e);let i,r=t.length-1,a=0;for(;r-a>1;)i=a+r>>1,n(i)?a=i:r=i;return{lo:a,hi:r}}const gC=(t,e,n,i)=>mC(t,n,i?i=>{const r=t[i][e];return r<n||r===n&&t[i+1][e]===n}:i=>t[i][e]<n),yC=(t,e,n)=>mC(t,n,i=>t[i][e]>=n);const vC=["push","pop","shift","splice","unshift"];function _C(t,e){const n=t._chartjs;if(!n)return;const i=n.listeners,r=i.indexOf(e);-1!==r&&i.splice(r,1),i.length>0||(vC.forEach(e=>{delete t[e]}),delete t._chartjs)}function bC(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const xC="undefined"===typeof window?function(t){return t()}:window.requestAnimationFrame;function wC(t,e){let n=[],i=!1;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];n=a,i||(i=!0,xC.call(window,()=>{i=!1,t.apply(e,n)}))}}const SC=t=>"start"===t?"left":"end"===t?"right":"center",MC=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function TC(t,e,n){const i=e.length;let r=0,a=i;if(t._sorted){const{iScale:o,vScale:s,_parsed:l}=t,c=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,u=o.axis,{min:h,max:d,minDefined:p,maxDefined:f}=o.getUserBounds();if(p){if(r=Math.min(gC(l,u,h).lo,n?i:gC(e,u,o.getPixelForValue(h)).lo),c){const t=l.slice(0,r+1).reverse().findIndex(t=>!SE(t[s.axis]));r-=Math.max(0,t)}r=pC(r,0,i-1)}if(f){let t=Math.max(gC(l,o.axis,d,!0).hi+1,n?0:gC(e,u,o.getPixelForValue(d),!0).hi+1);if(c){const e=l.slice(t-1).findIndex(t=>!SE(t[s.axis]));t+=Math.max(0,e)}a=pC(t,r,i)-r}else a=i-r}return{start:r,count:a}}function AC(t){const{xScale:e,yScale:n,_scaleRanges:i}=t,r={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!i)return t._scaleRanges=r,!0;const a=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,r),a}const EC=t=>0===t||1===t,CC=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*qE/n),PC=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*qE/n)+1,IC={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*KE),easeOutSine:t=>Math.sin(t*KE),easeInOutSine:t=>-.5*(Math.cos(WE*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>EC(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>EC(t)?t:CC(t,.075,.3),easeOutElastic:t=>EC(t)?t:PC(t,.075,.3),easeInOutElastic(t){const e=.1125;return EC(t)?t:t<.5?.5*CC(2*t,e,.45):.5+.5*PC(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-IC.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?.5*IC.easeInBounce(2*t):.5*IC.easeOutBounce(2*t-1)+.5};function LC(t){if(t&&"object"===typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function kC(t){return LC(t)?t:new bE(t)}function RC(t){return LC(t)?t:new bE(t).saturate(.5).darken(.1).hexString()}const DC=["x","y","borderWidth","radius","tension"],NC=["color","borderColor","backgroundColor"];const zC=new Map;function FC(t,e,n){return function(t,e){e=e||{};const n=t+JSON.stringify(e);let i=zC.get(n);return i||(i=new Intl.NumberFormat(t,e),zC.set(n,i)),i}(e,n).format(t)}const OC={values:t=>ME(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const i=this.chart.options.locale;let r,a=t;if(n.length>1){const e=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(e<1e-4||e>1e15)&&(r="scientific"),a=function(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t));return n}(t,n)}const o=QE(Math.abs(a)),s=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:r,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(l,this.options.ticks.format),FC(t,i,l)},logarithmic(t,e,n){if(0===t)return"0";const i=n[e].significand||t/Math.pow(10,Math.floor(QE(t)));return[1,2,3,5,10,15].includes(i)||e>.8*n.length?OC.numeric.call(this,t,e,n):""}};var BC={formatters:OC};const UC=Object.create(null),jC=Object.create(null);function VC(t,e){if(!e)return t;const n=e.split(".");for(let i=0,r=n.length;i<r;++i){const e=n[i];t=t[e]||(t[e]=Object.create(null))}return t}function HC(t,e,n){return"string"===typeof e?zE(VC(t,e),n):zE(VC(t,""),e)}class GC{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>RC(e.backgroundColor),this.hoverBorderColor=(t,e)=>RC(e.borderColor),this.hoverColor=(t,e)=>RC(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return HC(this,t,e)}get(t){return VC(this,t)}describe(t,e){return HC(jC,t,e)}override(t,e){return HC(UC,t,e)}route(t,e,n,i){const r=VC(this,t),a=VC(this,n),o="_"+e;Object.defineProperties(r,{[o]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=a[i];return TE(t)?Object.assign({},e,t):CE(t,e)},set(t){this[o]=t}}})}apply(t){t.forEach(t=>t(this))}}var WC=new GC({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),t.set("animations",{colors:{type:"color",properties:NC},numbers:{type:"number",properties:DC}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}})},function(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:BC.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t&&"dash"!==t}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t})}]);function qC(t,e,n,i,r){let a=e[r];return a||(a=e[r]=t.measureText(r).width,n.push(r)),a>i&&(i=a),i}function ZC(t,e,n,i){let r=(i=i||{}).data=i.data||{},a=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(r=i.data={},a=i.garbageCollect=[],i.font=e),t.save(),t.font=e;let o=0;const s=n.length;let l,c,u,h,d;for(l=0;l<s;l++)if(h=n[l],void 0===h||null===h||ME(h)){if(ME(h))for(c=0,u=h.length;c<u;c++)d=h[c],void 0===d||null===d||ME(d)||(o=qC(t,r,a,o,d))}else o=qC(t,r,a,o,h);t.restore();const p=a.length/2;if(p>n.length){for(l=0;l<p;l++)delete r[a[l]];a.splice(0,p)}return o}function XC(t,e,n){const i=t.currentDevicePixelRatio,r=0!==n?Math.max(n/2,.5):0;return Math.round((e-r)*i)/i+r}function YC(t,e){(e||t)&&((e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function KC(t,e,n,i){JC(t,e,n,i,null)}function JC(t,e,n,i,r){let a,o,s,l,c,u,h,d;const p=e.pointStyle,f=e.rotation,m=e.radius;let g=(f||0)*YE;if(p&&"object"===typeof p&&(a=p.toString(),"[object HTMLImageElement]"===a||"[object HTMLCanvasElement]"===a))return t.save(),t.translate(n,i),t.rotate(g),t.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void t.restore();if(!(isNaN(m)||m<=0)){switch(t.beginPath(),p){default:r?t.ellipse(n,i,r/2,m,0,0,qE):t.arc(n,i,m,0,qE),t.closePath();break;case"triangle":u=r?r/2:m,t.moveTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=$E,t.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=$E,t.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),t.closePath();break;case"rectRounded":c=.516*m,l=m-c,o=Math.cos(g+JE)*l,h=Math.cos(g+JE)*(r?r/2-c:l),s=Math.sin(g+JE)*l,d=Math.sin(g+JE)*(r?r/2-c:l),t.arc(n-h,i-s,c,g-WE,g-KE),t.arc(n+d,i-o,c,g-KE,g),t.arc(n+h,i+s,c,g,g+KE),t.arc(n-d,i+o,c,g+KE,g+WE),t.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,u=r?r/2:l,t.rect(n-u,i-l,2*u,2*l);break}g+=JE;case"rectRot":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+d,i-o),t.lineTo(n+h,i+s),t.lineTo(n-d,i+o),t.closePath();break;case"crossRot":g+=JE;case"cross":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+h,i+s),t.moveTo(n+d,i-o),t.lineTo(n-d,i+o);break;case"star":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+h,i+s),t.moveTo(n+d,i-o),t.lineTo(n-d,i+o),g+=JE,h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+h,i+s),t.moveTo(n+d,i-o),t.lineTo(n-d,i+o);break;case"line":o=r?r/2:Math.cos(g)*m,s=Math.sin(g)*m,t.moveTo(n-o,i-s),t.lineTo(n+o,i+s);break;case"dash":t.moveTo(n,i),t.lineTo(n+Math.cos(g)*(r?r/2:m),i+Math.sin(g)*m);break;case!1:t.closePath()}t.fill(),e.borderWidth>0&&t.stroke()}}function $C(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function QC(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function tP(t){t.restore()}function eP(t,e,n,i,r){if(!e)return t.lineTo(n.x,n.y);if("middle"===r){const i=(e.x+n.x)/2;t.lineTo(i,e.y),t.lineTo(i,n.y)}else"after"===r!==!!i?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function nP(t,e,n,i){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function iP(t,e,n,i,r){if(r.strikethrough||r.underline){const a=t.measureText(i),o=e-a.actualBoundingBoxLeft,s=e+a.actualBoundingBoxRight,l=n-a.actualBoundingBoxAscent,c=n+a.actualBoundingBoxDescent,u=r.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(o,u),t.lineTo(s,u),t.stroke()}}function rP(t,e){const n=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=n}function aP(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=ME(e)?e:[e],s=a.strokeWidth>0&&""!==a.strokeColor;let l,c;for(t.save(),t.font=r.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),SE(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,a),l=0;l<o.length;++l)c=o[l],a.backdrop&&rP(t,a.backdrop),s&&(a.strokeColor&&(t.strokeStyle=a.strokeColor),SE(a.strokeWidth)||(t.lineWidth=a.strokeWidth),t.strokeText(c,n,i,a.maxWidth)),t.fillText(c,n,i,a.maxWidth),iP(t,n,i,c,a),i+=Number(r.lineHeight);t.restore()}function oP(t,e){const{x:n,y:i,w:r,h:a,radius:o}=e;t.arc(n+o.topLeft,i+o.topLeft,o.topLeft,1.5*WE,WE,!0),t.lineTo(n,i+a-o.bottomLeft),t.arc(n+o.bottomLeft,i+a-o.bottomLeft,o.bottomLeft,WE,KE,!0),t.lineTo(n+r-o.bottomRight,i+a),t.arc(n+r-o.bottomRight,i+a-o.bottomRight,o.bottomRight,KE,0,!0),t.lineTo(n+r,i+o.topRight),t.arc(n+r-o.topRight,i+o.topRight,o.topRight,0,-KE,!0),t.lineTo(n+o.topLeft,i)}const sP=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,lP=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function cP(t,e){const n=(""+t).match(sP);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}const uP=t=>+t||0;function hP(t,e){const n={},i=TE(e),r=i?Object.keys(e):e,a=TE(t)?i?n=>CE(t[n],t[e[n]]):e=>t[e]:()=>t;for(const o of r)n[o]=uP(a(o));return n}function dP(t){return hP(t,{top:"y",right:"x",bottom:"y",left:"x"})}function pP(t){return hP(t,["topLeft","topRight","bottomLeft","bottomRight"])}function fP(t){const e=dP(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function mP(t,e){t=t||{},e=e||WC.font;let n=CE(t.size,e.size);"string"===typeof n&&(n=parseInt(n,10));let i=CE(t.style,e.style);i&&!(""+i).match(lP)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const r={family:CE(t.family,e.family),lineHeight:cP(CE(t.lineHeight,e.lineHeight),n),size:n,style:i,weight:CE(t.weight,e.weight),string:""};return r.string=function(t){return!t||SE(t.size)||SE(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(r),r}function gP(t,e,n,i){let r,a,o,s=!0;for(r=0,a=t.length;r<a;++r)if(o=t[r],void 0!==o&&(void 0!==e&&"function"===typeof o&&(o=o(e),s=!1),void 0!==n&&ME(o)&&(o=o[n%o.length],s=!1),void 0!==o))return i&&!s&&(i.cacheable=!1),o}function yP(t,e){return Object.assign(Object.create(t),e)}function vP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>t[0];const r=(arguments.length>2?arguments[2]:void 0)||t;"undefined"===typeof n&&(n=PP("_fallback",t));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:r,_fallback:n,_getTarget:i,override:i=>vP([i,...t],e,r,n)};return new Proxy(a,{deleteProperty:(e,n)=>(delete e[n],delete e._keys,delete t[0][n],!0),get:(n,i)=>SP(n,i,()=>function(t,e,n,i){let r;for(const a of e)if(r=PP(xP(a,t),n),"undefined"!==typeof r)return wP(t,r)?EP(n,i,t,r):r}(i,e,t,n)),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>IP(t).includes(e),ownKeys:t=>IP(t),set(t,e,n){const r=t._storage||(t._storage=i());return t[e]=r[e]=n,delete t._keys,!0}})}function _P(t,e,n,i){const r={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:bP(t,i),setContext:e=>_P(t,e,n,i),override:r=>_P(t.override(r),e,n,i)};return new Proxy(r,{deleteProperty:(e,n)=>(delete e[n],delete t[n],!0),get:(t,e,n)=>SP(t,e,()=>function(t,e,n){const{_proxy:i,_context:r,_subProxy:a,_descriptors:o}=t;let s=i[e];HE(s)&&o.isScriptable(e)&&(s=function(t,e,n,i){const{_proxy:r,_context:a,_subProxy:o,_stack:s}=n;if(s.has(t))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+t);s.add(t);let l=e(a,o||i);s.delete(t),wP(t,l)&&(l=EP(r._scopes,r,t,l));return l}(e,s,t,n));ME(s)&&s.length&&(s=function(t,e,n,i){const{_proxy:r,_context:a,_subProxy:o,_descriptors:s}=n;if("undefined"!==typeof a.index&&i(t))return e[a.index%e.length];if(TE(e[0])){const n=e,i=r._scopes.filter(t=>t!==n);e=[];for(const l of n){const n=EP(i,r,t,l);e.push(_P(n,a,o&&o[t],s))}}return e}(e,s,t,o.isIndexable));wP(e,s)&&(s=_P(s,r,a&&a[e],o));return s}(t,e,n)),getOwnPropertyDescriptor:(e,n)=>e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,n)=>Reflect.has(t,n),ownKeys:()=>Reflect.ownKeys(t),set:(e,n,i)=>(t[n]=i,delete e[n],!0)})}function bP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:n=e.scriptable,_indexable:i=e.indexable,_allKeys:r=e.allKeys}=t;return{allKeys:r,scriptable:n,indexable:i,isScriptable:HE(n)?n:()=>n,isIndexable:HE(i)?i:()=>i}}const xP=(t,e)=>t?t+jE(e):e,wP=(t,e)=>TE(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function SP(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e)||"constructor"===e)return t[e];const i=n();return t[e]=i,i}function MP(t,e,n){return HE(t)?t(e,n):t}const TP=(t,e)=>!0===t?e:"string"===typeof t?UE(e,t):void 0;function AP(t,e,n,i,r){for(const a of e){const e=TP(n,a);if(e){t.add(e);const a=MP(e._fallback,n,r);if("undefined"!==typeof a&&a!==n&&a!==i)return a}else if(!1===e&&"undefined"!==typeof i&&n!==i)return null}return!1}function EP(t,e,n,i){const r=e._rootScopes,a=MP(e._fallback,n,i),o=[...t,...r],s=new Set;s.add(i);let l=CP(s,o,n,a||n,i);return null!==l&&(("undefined"===typeof a||a===n||(l=CP(s,o,a,l,i),null!==l))&&vP(Array.from(s),[""],r,a,()=>function(t,e,n){const i=t._getTarget();e in i||(i[e]={});const r=i[e];if(ME(r)&&TE(n))return n;return r||{}}(e,n,i)))}function CP(t,e,n,i,r){for(;n;)n=AP(t,e,n,i,r);return n}function PP(t,e){for(const n of e){if(!n)continue;const e=n[t];if("undefined"!==typeof e)return e}}function IP(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const n of t)for(const t of Object.keys(n).filter(t=>!t.startsWith("_")))e.add(t);return Array.from(e)}(t._scopes)),e}function LP(t,e,n,i){const{iScale:r}=t,{key:a="r"}=this._parsing,o=new Array(i);let s,l,c,u;for(s=0,l=i;s<l;++s)c=s+n,u=e[c],o[s]={r:r.parse(UE(u,a),c)};return o}const kP=Number.EPSILON||1e-14,RP=(t,e)=>e<t.length&&!t[e].skip&&t[e],DP=t=>"x"===t?"y":"x";function NP(t,e,n,i){const r=t.skip?e:t,a=e,o=n.skip?e:n,s=cC(a,r),l=cC(o,a);let c=s/(s+l),u=l/(s+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=i*c,d=i*u;return{previous:{x:a.x-h*(o.x-r.x),y:a.y-h*(o.y-r.y)},next:{x:a.x+d*(o.x-r.x),y:a.y+d*(o.y-r.y)}}}function zP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const n=DP(e),i=t.length,r=Array(i).fill(0),a=Array(i);let o,s,l,c=RP(t,0);for(o=0;o<i;++o)if(s=l,l=c,c=RP(t,o+1),l){if(c){const t=c[e]-l[e];r[o]=0!==t?(c[n]-l[n])/t:0}a[o]=s?c?tC(r[o-1])!==tC(r[o])?0:(r[o-1]+r[o])/2:r[o-1]:r[o]}!function(t,e,n){const i=t.length;let r,a,o,s,l,c=RP(t,0);for(let u=0;u<i-1;++u)l=c,c=RP(t,u+1),l&&c&&(eC(e[u],0,kP)?n[u]=n[u+1]=0:(r=n[u]/e[u],a=n[u+1]/e[u],s=Math.pow(r,2)+Math.pow(a,2),s<=9||(o=3/Math.sqrt(s),n[u]=r*o*e[u],n[u+1]=a*o*e[u])))}(t,r,a),function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const i=DP(n),r=t.length;let a,o,s,l=RP(t,0);for(let c=0;c<r;++c){if(o=s,s=l,l=RP(t,c+1),!s)continue;const r=s[n],u=s[i];o&&(a=(r-o[n])/3,s["cp1".concat(n)]=r-a,s["cp1".concat(i)]=u-a*e[c]),l&&(a=(l[n]-r)/3,s["cp2".concat(n)]=r+a,s["cp2".concat(i)]=u+a*e[c])}}(t,a,e)}function FP(t,e,n){return Math.max(Math.min(t,n),e)}function OP(t,e,n,i,r){let a,o,s,l;if(e.spanGaps&&(t=t.filter(t=>!t.skip)),"monotone"===e.cubicInterpolationMode)zP(t,r);else{let n=i?t[t.length-1]:t[0];for(a=0,o=t.length;a<o;++a)s=t[a],l=NP(n,s,t[Math.min(a+1,o-(i?0:1))%o],e.tension),s.cp1x=l.previous.x,s.cp1y=l.previous.y,s.cp2x=l.next.x,s.cp2y=l.next.y,n=s}e.capBezierPoints&&function(t,e){let n,i,r,a,o,s=$C(t[0],e);for(n=0,i=t.length;n<i;++n)o=a,a=s,s=n<i-1&&$C(t[n+1],e),a&&(r=t[n],o&&(r.cp1x=FP(r.cp1x,e.left,e.right),r.cp1y=FP(r.cp1y,e.top,e.bottom)),s&&(r.cp2x=FP(r.cp2x,e.left,e.right),r.cp2y=FP(r.cp2y,e.top,e.bottom)))}(t,n)}function BP(){return"undefined"!==typeof window&&"undefined"!==typeof document}function UP(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function jP(t,e,n){let i;return"string"===typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[n])):i=t,i}const VP=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);const HP=["top","right","bottom","left"];function GP(t,e,n){const i={};n=n?"-"+n:"";for(let r=0;r<4;r++){const a=HP[r];i[a]=parseFloat(t[e+"-"+a+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function WP(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:i}=e,r=VP(n),a="border-box"===r.boxSizing,o=GP(r,"padding"),s=GP(r,"border","width"),{x:l,y:c,box:u}=function(t,e){const n=t.touches,i=n&&n.length?n[0]:t,{offsetX:r,offsetY:a}=i;let o,s,l=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(r,a,t.target))o=r,s=a;else{const t=e.getBoundingClientRect();o=i.clientX-t.left,s=i.clientY-t.top,l=!0}return{x:o,y:s,box:l}}(t,n),h=o.left+(u&&s.left),d=o.top+(u&&s.top);let{width:p,height:f}=e;return a&&(p-=o.width+s.width,f-=o.height+s.height),{x:Math.round((l-h)/p*n.width/i),y:Math.round((c-d)/f*n.height/i)}}const qP=t=>Math.round(10*t)/10;function ZP(t,e,n,i){const r=VP(t),a=GP(r,"margin"),o=jP(r.maxWidth,t,"clientWidth")||XE,s=jP(r.maxHeight,t,"clientHeight")||XE,l=function(t,e,n){let i,r;if(void 0===e||void 0===n){const a=t&&UP(t);if(a){const t=a.getBoundingClientRect(),o=VP(a),s=GP(o,"border","width"),l=GP(o,"padding");e=t.width-l.width-s.width,n=t.height-l.height-s.height,i=jP(o.maxWidth,a,"clientWidth"),r=jP(o.maxHeight,a,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:i||XE,maxHeight:r||XE}}(t,e,n);let{width:c,height:u}=l;if("content-box"===r.boxSizing){const t=GP(r,"border","width"),e=GP(r,"padding");c-=e.width+t.width,u-=e.height+t.height}c=Math.max(0,c-a.width),u=Math.max(0,i?c/i:u-a.height),c=qP(Math.min(c,o,l.maxWidth)),u=qP(Math.min(u,s,l.maxHeight)),c&&!u&&(u=qP(c/2));return(void 0!==e||void 0!==n)&&i&&l.height&&u>l.height&&(u=l.height,c=qP(Math.floor(u*i))),{width:c,height:u}}function XP(t,e,n){const i=e||1,r=Math.floor(t.height*i),a=Math.floor(t.width*i);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height="".concat(t.height,"px"),o.style.width="".concat(t.width,"px")),(t.currentDevicePixelRatio!==i||o.height!==r||o.width!==a)&&(t.currentDevicePixelRatio=i,o.height=r,o.width=a,t.ctx.setTransform(i,0,0,i,0,0),!0)}const YP=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};BP()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch(rJ){}return t}();function KP(t,e){const n=function(t,e){return VP(t).getPropertyValue(e)}(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function JP(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function $P(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:"middle"===i?n<.5?t.y:e.y:"after"===i?n<1?t.y:e.y:n>0?e.y:t.y}}function QP(t,e,n,i){const r={x:t.cp2x,y:t.cp2y},a={x:e.cp1x,y:e.cp1y},o=JP(t,r,n),s=JP(r,a,n),l=JP(a,e,n),c=JP(o,s,n),u=JP(s,l,n);return JP(c,u,n)}function tI(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function eI(t,e){let n,i;"ltr"!==e&&"rtl"!==e||(n=t.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=i)}function nI(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function iI(t){return"angle"===t?{between:dC,compare:uC,normalize:hC}:{between:fC,compare:(t,e)=>t-e,normalize:t=>t}}function rI(t){let{start:e,end:n,count:i,loop:r,style:a}=t;return{start:e%i,end:n%i,loop:r&&(n-e+1)%i===0,style:a}}function aI(t,e,n){if(!n)return[t];const{property:i,start:r,end:a}=n,o=e.length,{compare:s,between:l,normalize:c}=iI(i),{start:u,end:h,loop:d,style:p}=function(t,e,n){const{property:i,start:r,end:a}=n,{between:o,normalize:s}=iI(i),l=e.length;let c,u,{start:h,end:d,loop:p}=t;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&o(s(e[h%l][i]),r,a);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:t.style}}(t,e,n),f=[];let m,g,y,v=!1,_=null;const b=()=>v||l(r,y,m)&&0!==s(r,y),x=()=>!v||0===s(a,m)||l(a,y,m);for(let w=u,S=u;w<=h;++w)g=e[w%o],g.skip||(m=c(g[i]),m!==y&&(v=l(m,r,a),null===_&&b()&&(_=0===s(m,r)?w:S),null!==_&&x()&&(f.push(rI({start:_,end:w,loop:d,count:o,style:p})),_=null),S=w,y=m));return null!==_&&f.push(rI({start:_,end:h,loop:d,count:o,style:p})),f}function oI(t,e){const n=[],i=t.segments;for(let r=0;r<i.length;r++){const a=aI(i[r],t.points,e);a.length&&n.push(...a)}return n}function sI(t,e,n,i){return i&&i.setContext&&n?function(t,e,n,i){const r=t._chart.getContext(),a=lI(t.options),{_datasetIndex:o,options:{spanGaps:s}}=t,l=n.length,c=[];let u=a,h=e[0].start,d=h;function p(t,e,i,r){const a=s?-1:1;if(t!==e){for(t+=l;n[t%l].skip;)t-=a;for(;n[e%l].skip;)e+=a;t%l!==e%l&&(c.push({start:t%l,end:e%l,loop:i,style:r}),u=r,h=e%l)}}for(const f of e){h=s?h:f.start;let t,e=n[h%l];for(d=h+1;d<=f.end;d++){const a=n[d%l];t=lI(i.setContext(yP(r,{type:"segment",p0:e,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),cI(t,u)&&p(h,d-1,f.loop,u),e=a,u=t}h<d-1&&p(h,d-1,f.loop,u)}return c}(t,e,n,i):e}function lI(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function cI(t,e){if(!e)return!1;const n=[],i=function(t,e){return LC(e)?(n.includes(e)||n.push(e),n.indexOf(e)):e};return JSON.stringify(t,i)!==JSON.stringify(e,i)}function uI(t,e,n){return t.options.clip?t[n]:e[n]}function hI(t,e){const n=e._clip;if(n.disabled)return!1;const i=function(t,e){const{xScale:n,yScale:i}=t;return n&&i?{left:uI(n,e,"left"),right:uI(n,e,"right"),top:uI(i,e,"top"),bottom:uI(i,e,"bottom")}:e}(e,t.chartArea);return{left:!1===n.left?0:i.left-(!0===n.left?0:n.left),right:!1===n.right?t.width:i.right+(!0===n.right?0:n.right),top:!1===n.top?0:i.top-(!0===n.top?0:n.top),bottom:!1===n.bottom?t.height:i.bottom+(!0===n.bottom?0:n.bottom)}}class dI{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,n,i){const r=e.listeners[i],a=e.duration;r.forEach(i=>i({chart:t,initial:e.initial,numSteps:a,currentStep:Math.min(n-e.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=xC.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),e=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;const r=n.items;let a,o=r.length-1,s=!1;for(;o>=0;--o)a=r[o],a._active?(a._total>n.duration&&(n.duration=a._total),a.tick(t),s=!0):(r[o]=r[r.length-1],r.pop());s&&(i.draw(),this._notify(i,n,t,"progress")),r.length||(n.running=!1,this._notify(i,n,t,"complete"),n.initial=!1),e+=r.length}),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}listen(t,e,n){this._getAnims(t).listeners[e].push(n)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((t,e)=>Math.max(t,e._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const n=e.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var pI=new dI;const fI="transparent",mI={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const i=kC(t||fI),r=i.valid&&kC(e||fI);return r&&r.valid?r.mix(i,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class gI{constructor(t,e,n,i){const r=e[n];i=gP([t.to,i,r,t.from]);const a=gP([t.from,r,i]);this._active=!0,this._fn=t.fn||mI[t.type||typeof a],this._easing=IC[t.easing]||IC.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=n,this._from=a,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,n){if(this._active){this._notify(!1);const i=this._target[this._prop],r=n-this._start,a=this._duration-r;this._start=n,this._duration=Math.floor(Math.max(a,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=gP([t.to,e,i,t.from]),this._from=gP([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,n=this._duration,i=this._prop,r=this._from,a=this._loop,o=this._to;let s;if(this._active=r!==o&&(a||e<n),!this._active)return this._target[i]=o,void this._notify(!0);e<0?this._target[i]=r:(s=e/n%2,s=a&&s>1?2-s:s,s=this._easing(Math.min(1,Math.max(0,s))),this._target[i]=this._fn(r,o,s))}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,n)=>{t.push({res:e,rej:n})})}_notify(t){const e=t?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][e]()}}class yI{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!TE(t))return;const e=Object.keys(WC.animation),n=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const r=t[i];if(!TE(r))return;const a={};for(const t of e)a[t]=r[t];(ME(r.properties)&&r.properties||[i]).forEach(t=>{t!==i&&n.has(t)||n.set(t,a)})})}_animateOptions(t,e){const n=e.options,i=function(t,e){if(!e)return;let n=t.options;if(!n)return void(t.options=e);n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(t,n);if(!i)return[];const r=this._createAnimations(i,n);return n.$shared&&function(t,e){const n=[],i=Object.keys(e);for(let r=0;r<i.length;r++){const e=t[i[r]];e&&e.active()&&n.push(e.wait())}return Promise.all(n)}(t.options.$animations,n).then(()=>{t.options=n},()=>{}),r}_createAnimations(t,e){const n=this._properties,i=[],r=t.$animations||(t.$animations={}),a=Object.keys(e),o=Date.now();let s;for(s=a.length-1;s>=0;--s){const l=a[s];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(t,e));continue}const c=e[l];let u=r[l];const h=n.get(l);if(u){if(h&&u.active()){u.update(h,c,o);continue}u.cancel()}h&&h.duration?(r[l]=u=new gI(h,t,l,c),i.push(u)):t[l]=c}return i}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const n=this._createAnimations(t,e);return n.length?(pI.add(this._chart,n),!0):void 0}}function vI(t,e){const n=t&&t.options||{},i=n.reverse,r=void 0===n.min?e:0,a=void 0===n.max?e:0;return{start:i?a:r,end:i?r:a}}function _I(t,e){const n=[],i=t._getSortedDatasetMetas(e);let r,a;for(r=0,a=i.length;r<a;++r)n.push(i[r].index);return n}function bI(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=t.keys,a="single"===i.mode;let o,s,l,c;if(null===e)return;let u=!1;for(o=0,s=r.length;o<s;++o){if(l=+r[o],l===n){if(u=!0,i.all)continue;break}c=t.values[l],AE(c)&&(a||0===e||tC(e)===tC(c))&&(e+=c)}return u||i.all?e:0}function xI(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function wI(t,e,n){const i=t[e]||(t[e]={});return i[n]||(i[n]={})}function SI(t,e,n,i){for(const r of e.getMatchingVisibleMetas(i).reverse()){const e=t[r.index];if(n&&e>0||!n&&e<0)return r.index}return null}function MI(t,e){const{chart:n,_cachedMeta:i}=t,r=n._stacks||(n._stacks={}),{iScale:a,vScale:o,index:s}=i,l=a.axis,c=o.axis,u=function(t,e,n){return"".concat(t.id,".").concat(e.id,".").concat(n.stack||n.type)}(a,o,i),h=e.length;let d;for(let p=0;p<h;++p){const t=e[p],{[l]:n,[c]:a}=t;d=(t._stacks||(t._stacks={}))[c]=wI(r,u,n),d[s]=a,d._top=SI(d,o,!0,i.type),d._bottom=SI(d,o,!1,i.type);(d._visualValues||(d._visualValues={}))[s]=a}}function TI(t,e){const n=t.scales;return Object.keys(n).filter(t=>n[t].axis===e).shift()}function AI(t,e){const n=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[i]||void 0===e[i][n])return;delete e[i][n],void 0!==e[i]._visualValues&&void 0!==e[i]._visualValues[n]&&delete e[i]._visualValues[n]}}}const EI=t=>"reset"===t||"none"===t,CI=(t,e)=>e?t:Object.assign({},t);class PI{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=xI(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&AI(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,n=this.getDataset(),i=(t,e,n,i)=>"x"===t?e:"r"===t?i:n,r=e.xAxisID=CE(n.xAxisID,TI(t,"x")),a=e.yAxisID=CE(n.yAxisID,TI(t,"y")),o=e.rAxisID=CE(n.rAxisID,TI(t,"r")),s=e.indexAxis,l=e.iAxisID=i(s,r,a,o),c=e.vAxisID=i(s,a,r,o);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(a),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&_C(this._data,this),t._stacked&&AI(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),n=this._data;if(TE(e)){const t=this._cachedMeta;this._data=function(t,e){const{iScale:n,vScale:i}=e,r="x"===n.axis?"x":"y",a="x"===i.axis?"x":"y",o=Object.keys(t),s=new Array(o.length);let l,c,u;for(l=0,c=o.length;l<c;++l)u=o[l],s[l]={[r]:u,[a]:t[u]};return s}(e,t)}else if(n!==e){if(n){_C(n,this);const t=this._cachedMeta;AI(t),t._parsed=[]}e&&Object.isExtensible(e)&&(r=this,(i=e)._chartjs?i._chartjs.listeners.push(r):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),vC.forEach(t=>{const e="_onData"+jE(t),n=i[t];Object.defineProperty(i,t,{configurable:!0,enumerable:!1,value(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];const o=n.apply(this,r);return i._chartjs.listeners.forEach(t=>{"function"===typeof t[e]&&t[e](...r)}),o}})}))),this._syncList=[],this._data=e}var i,r}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=xI(e.vScale,e),e.stack!==n.stack&&(i=!0,AI(e),e.stack=n.stack),this._resyncElements(t),(i||r!==e._stacked)&&(MI(this,e._parsed),e._stacked=xI(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:n,_data:i}=this,{iScale:r,_stacked:a}=n,o=r.axis;let s,l,c,u=0===t&&e===i.length||n._sorted,h=t>0&&n._parsed[t-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,c=i;else{c=ME(i[t])?this.parseArrayData(n,i,t,e):TE(i[t])?this.parseObjectData(n,i,t,e):this.parsePrimitiveData(n,i,t,e);const r=()=>null===l[o]||h&&l[o]<h[o];for(s=0;s<e;++s)n._parsed[s+t]=l=c[s],u&&(r()&&(u=!1),h=l);n._sorted=u}a&&MI(this,c)}parsePrimitiveData(t,e,n,i){const{iScale:r,vScale:a}=t,o=r.axis,s=a.axis,l=r.getLabels(),c=r===a,u=new Array(i);let h,d,p;for(h=0,d=i;h<d;++h)p=h+n,u[h]={[o]:c||r.parse(l[p],p),[s]:a.parse(e[p],p)};return u}parseArrayData(t,e,n,i){const{xScale:r,yScale:a}=t,o=new Array(i);let s,l,c,u;for(s=0,l=i;s<l;++s)c=s+n,u=e[c],o[s]={x:r.parse(u[0],c),y:a.parse(u[1],c)};return o}parseObjectData(t,e,n,i){const{xScale:r,yScale:a}=t,{xAxisKey:o="x",yAxisKey:s="y"}=this._parsing,l=new Array(i);let c,u,h,d;for(c=0,u=i;c<u;++c)h=c+n,d=e[h],l[c]={x:r.parse(UE(d,o),h),y:a.parse(UE(d,s),h)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,n){const i=this.chart,r=this._cachedMeta,a=e[t.axis];return bI({keys:_I(i,!0),values:e._stacks[t.axis]._visualValues},a,r.index,{mode:n})}updateRangeFromParsed(t,e,n,i){const r=n[e.axis];let a=null===r?NaN:r;const o=i&&n._stacks[e.axis];i&&o&&(i.values=o,a=bI(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,a),t.max=Math.max(t.max,a)}getMinMax(t,e){const n=this._cachedMeta,i=n._parsed,r=n._sorted&&t===n.iScale,a=i.length,o=this._getOtherScale(t),s=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:_I(n,!0),values:null})(e,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(t){const{min:e,max:n,minDefined:i,maxDefined:r}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:r?n:Number.POSITIVE_INFINITY}}(o);let h,d;function p(){d=i[h];const e=d[o.axis];return!AE(d[t.axis])||c>e||u<e}for(h=0;h<a&&(p()||(this.updateRangeFromParsed(l,t,d,s),!r));++h);if(r)for(h=a-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,t,d,s);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,n=[];let i,r,a;for(i=0,r=e.length;i<r;++i)a=e[i][t.axis],AE(a)&&n.push(a);return n}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,n=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:n?""+n.getLabelForValue(r[n.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,n,i,r;return TE(t)?(e=t.top,n=t.right,i=t.bottom,r=t.left):e=n=i=r=t,{top:e,right:n,bottom:i,left:r,disabled:!1===t}}(CE(this.options.clip,function(t,e,n){if(!1===n)return!1;const i=vI(t,n),r=vI(e,n);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,n=this._cachedMeta,i=n.data||[],r=e.chartArea,a=[],o=this._drawStart||0,s=this._drawCount||i.length-o,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(t,r,o,s),c=o;c<o+s;++c){const e=i[c];e.hidden||(e.active&&l?a.push(e):e.draw(t,r))}for(c=0;c<a.length;++c)a[c].draw(t,r)}getStyle(t,e){const n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}getContext(t,e,n){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];r=e.$context||(e.$context=function(t,e,n){return yP(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=function(t,e){return yP(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=n,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2?arguments[2]:void 0;const i="active"===e,r=this._cachedDataOpts,a=t+"-"+e,o=r[a],s=this.enableOptionSharing&&VE(n);if(o)return CI(o,s);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),u=i?["".concat(t,"Hover"),"hover",t,""]:[t,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(WC.elements[t]),p=l.resolveNamedOptions(h,d,()=>this.getContext(n,i,e),u);return p.$shared&&(p.$shared=s,r[a]=Object.freeze(CI(p,s))),p}_resolveAnimations(t,e,n){const i=this.chart,r=this._cachedDataOpts,a="animation-".concat(e),o=r[a];if(o)return o;let s;if(!1!==i.options.animation){const i=this.chart.config,r=i.datasetAnimationScopeKeys(this._type,e),a=i.getOptionScopes(this.getDataset(),r);s=i.createResolver(a,this.getContext(t,n,e))}const l=new yI(i,s&&s.animations);return s&&s._cacheable&&(r[a]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||EI(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const n=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(n),a=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,n),{sharedOptions:r,includeOptions:a}}updateElement(t,e,n,i){EI(i)?Object.assign(t,n):this._resolveAnimations(e,i).update(t,n)}updateSharedOptions(t,e,n){t&&!EI(e)&&this._resolveAnimations(void 0,e).update(t,n)}_setStyle(t,e,n,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,n,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,n){this._setStyle(t,n,"active",!1)}setHoverStyle(t,e,n){this._setStyle(t,n,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,n=this._cachedMeta.data;for(const[o,s,l]of this._syncList)this[o](s,l);this._syncList=[];const i=n.length,r=e.length,a=Math.min(r,i);a&&this.parse(0,a),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this._cachedMeta,r=i.data,a=t+e;let o;const s=t=>{for(t.length+=e,o=t.length-1;o>=a;o--)t[o]=t[o-e]};for(s(r),o=t;o<a;++o)r[o]=new this.dataElementType;this._parsing&&s(i._parsed),this.parse(t,e),n&&this.updateElements(r,t,e,"reset")}updateElements(t,e,n,i){}_removeElements(t,e){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(t,e);n._stacked&&AI(n,i)}n.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,n,i]=t;this[e](n,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function II(t){const e=t.iScale,n=function(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let i=[];for(let e=0,r=n.length;e<r;e++)i=i.concat(n[e].controller.getAllParsedValues(t));t._cache.$bar=bC(i.sort((t,e)=>t-e))}return t._cache.$bar}(e,t.type);let i,r,a,o,s=e._length;const l=()=>{32767!==a&&-32768!==a&&(VE(o)&&(s=Math.min(s,Math.abs(a-o)||s)),o=a)};for(i=0,r=n.length;i<r;++i)a=e.getPixelForValue(n[i]),l();for(o=void 0,i=0,r=e.ticks.length;i<r;++i)a=e.getPixelForTick(i),l();return s}function LI(t,e,n,i){return ME(t)?function(t,e,n,i){const r=n.parse(t[0],i),a=n.parse(t[1],i),o=Math.min(r,a),s=Math.max(r,a);let l=o,c=s;Math.abs(o)>Math.abs(s)&&(l=s,c=o),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:r,end:a,min:o,max:s}}(t,e,n,i):e[n.axis]=n.parse(t,i),e}function kI(t,e,n,i){const r=t.iScale,a=t.vScale,o=r.getLabels(),s=r===a,l=[];let c,u,h,d;for(c=n,u=n+i;c<u;++c)d=e[c],h={},h[r.axis]=s||r.parse(o[c],c),l.push(LI(d,h,a,c));return l}function RI(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function DI(t,e,n,i){let r=e.borderSkipped;const a={};if(!r)return void(t.borderSkipped=a);if(!0===r)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:s,reverse:l,top:c,bottom:u}=function(t){let e,n,i,r,a;return t.horizontal?(e=t.base>t.x,n="left",i="right"):(e=t.base<t.y,n="bottom",i="top"),e?(r="end",a="start"):(r="start",a="end"),{start:n,end:i,reverse:e,top:r,bottom:a}}(t);"middle"===r&&n&&(t.enableBorderRadius=!0,(n._top||0)===i?r=c:(n._bottom||0)===i?r=u:(a[NI(u,o,s,l)]=!0,r=c)),a[NI(r,o,s,l)]=!0,t.borderSkipped=a}function NI(t,e,n,i){var r,a,o;return i?(o=n,t=zI(t=(r=t)===(a=e)?o:r===o?a:r,n,e)):t=zI(t,e,n),t}function zI(t,e,n){return"start"===t?e:"end"===t?n:t}function FI(t,e,n){let{inflateAmount:i}=e;t.inflateAmount="auto"===i?1===n?.33:0:i}(0,It.A)(PI,"defaults",{}),(0,It.A)(PI,"datasetElementType",null),(0,It.A)(PI,"dataElementType",null);class OI extends PI{parsePrimitiveData(t,e,n,i){return kI(t,e,n,i)}parseArrayData(t,e,n,i){return kI(t,e,n,i)}parseObjectData(t,e,n,i){const{iScale:r,vScale:a}=t,{xAxisKey:o="x",yAxisKey:s="y"}=this._parsing,l="x"===r.axis?o:s,c="x"===a.axis?o:s,u=[];let h,d,p,f;for(h=n,d=n+i;h<d;++h)f=e[h],p={},p[r.axis]=r.parse(UE(f,l),h),u.push(LI(UE(f,c),p,a,h));return u}updateRangeFromParsed(t,e,n,i){super.updateRangeFromParsed(t,e,n,i);const r=n._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:n,vScale:i}=e,r=this.getParsed(t),a=r._custom,o=RI(a)?"["+a.start+", "+a.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+n.getLabelForValue(r[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,i){const r="reset"===i,{index:a,_cachedMeta:{vScale:o}}=this,s=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,i);for(let d=e;d<e+n;d++){const e=this.getParsed(d),n=r||SE(e[o.axis])?{base:s,head:s}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(e._stacks||{})[o.axis],m={horizontal:l,base:n.base,enableBorderRadius:!f||RI(e._custom)||a===f._top||a===f._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,t[d].active?"active":i));const g=m.options||t[d].options;DI(m,g,f,a),FI(m,g,c.ratio),this.updateElement(t[d],d,m,i)}}_getStacks(t,e){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter(t=>t.controller.options.grouped),r=n.options.stacked,a=[],o=this._cachedMeta.controller.getParsed(e),s=o&&o[n.axis],l=t=>{const e=t._parsed.find(t=>t[n.axis]===s),i=e&&e[t.vScale.axis];if(SE(i)||isNaN(i))return!0};for(const c of i)if((void 0===e||!l(c))&&((!1===r||-1===a.indexOf(c.stack)||void 0===r&&void 0===c.stack)&&a.push(c.stack),c.index===t))break;return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(n=>t[n].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const n of this.chart.data.datasets)t[CE("x"===this.chart.options.indexAxis?n.xAxisID:n.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,n){const i=this._getStacks(t,n),r=void 0!==e?i.indexOf(e):-1;return-1===r?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,n=e.iScale,i=[];let r,a;for(r=0,a=e.data.length;r<a;++r)i.push(n.getPixelForValue(this.getParsed(r)[n.axis],r));const o=t.barThickness;return{min:o||II(e),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:n,index:i},options:{base:r,minBarLength:a}}=this,o=r||0,s=this.getParsed(t),l=s._custom,c=RI(l);let u,h,d=s[e.axis],p=0,f=n?this.applyStack(e,s,n):d;f!==d&&(p=f-d,f=d),c&&(d=l.barStart,f=l.barEnd-l.barStart,0!==d&&tC(d)!==tC(l.barEnd)&&(p=0),p+=d);const m=SE(r)||c?p:r;let g=e.getPixelForValue(m);if(u=this.chart.getDataVisibility(t)?e.getPixelForValue(p+f):g,h=u-g,Math.abs(h)<a){h=function(t,e,n){return 0!==t?tC(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(h,e,o)*a,d===o&&(g-=h/2);const t=e.getPixelForDecimal(0),r=e.getPixelForDecimal(1),l=Math.min(t,r),p=Math.max(t,r);g=Math.max(Math.min(g,p),l),u=g+h,n&&!c&&(s._stacks[e.axis]._visualValues[i]=e.getValueForPixel(u)-e.getValueForPixel(g))}if(g===e.getPixelForValue(o)){const t=tC(h)*e.getLineWidthForValue(o)/2;g+=t,h-=t}return{size:h,base:g,head:u,center:u+h/2}}_calculateBarIndexPixels(t,e){const n=e.scale,i=this.options,r=i.skipNull,a=CE(i.maxBarThickness,1/0);let o,s;const l=this._getAxisCount();if(e.grouped){const n=r?this._getStackCount(t):e.stackCount,c="flex"===i.barThickness?function(t,e,n,i){const r=e.pixels,a=r[t];let o=t>0?r[t-1]:null,s=t<r.length-1?r[t+1]:null;const l=n.categoryPercentage;null===o&&(o=a-(null===s?e.end-e.start:s-a)),null===s&&(s=a+a-o);const c=a-(a-Math.min(o,s))/2*l;return{chunk:Math.abs(s-o)/2*l/i,ratio:n.barPercentage,start:c}}(t,e,i,n*l):function(t,e,n,i){const r=n.barThickness;let a,o;return SE(r)?(a=e.min*n.categoryPercentage,o=n.barPercentage):(a=r*i,o=1),{chunk:a/i,ratio:o,start:e.pixels[t]-a/2}}(t,e,i,n*l),u="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,h=this._getAxis().indexOf(CE(u,this.getFirstScaleIdForIndexAxis())),d=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+h;o=c.start+c.chunk*d+c.chunk/2,s=Math.min(a,c.chunk*c.ratio)}else o=n.getPixelForValue(this.getParsed(t)[n.axis],t),s=Math.min(a,e.min*e.ratio);return{base:o-s/2,head:o+s/2,center:o,size:s}}draw(){const t=this._cachedMeta,e=t.vScale,n=t.data,i=n.length;let r=0;for(;r<i;++r)null===this.getParsed(r)[e.axis]||n[r].hidden||n[r].draw(this._ctx)}}(0,It.A)(OI,"id","bar"),(0,It.A)(OI,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),(0,It.A)(OI,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class BI extends PI{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,n,i){const r=super.parsePrimitiveData(t,e,n,i);for(let a=0;a<r.length;a++)r[a]._custom=this.resolveDataElementOptions(a+n).radius;return r}parseArrayData(t,e,n,i){const r=super.parseArrayData(t,e,n,i);for(let a=0;a<r.length;a++){const t=e[n+a];r[a]._custom=CE(t[2],this.resolveDataElementOptions(a+n).radius)}return r}parseObjectData(t,e,n,i){const r=super.parseObjectData(t,e,n,i);for(let a=0;a<r.length;a++){const t=e[n+a];r[a]._custom=CE(t&&t.r&&+t.r,this.resolveDataElementOptions(a+n).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=e,a=this.getParsed(t),o=i.getLabelForValue(a.x),s=r.getLabelForValue(a.y),l=a._custom;return{label:n[t]||"",value:"("+o+", "+s+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,n,i){const r="reset"===i,{iScale:a,vScale:o}=this._cachedMeta,{sharedOptions:s,includeOptions:l}=this._getSharedOptions(e,i),c=a.axis,u=o.axis;for(let h=e;h<e+n;h++){const e=t[h],n=!r&&this.getParsed(h),d={},p=d[c]=r?a.getPixelForDecimal(.5):a.getPixelForValue(n[c]),f=d[u]=r?o.getBasePixel():o.getPixelForValue(n[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=s||this.resolveDataElementOptions(h,e.active?"active":i),r&&(d.options.radius=0)),this.updateElement(e,h,d,i)}}resolveDataElementOptions(t,e){const n=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return"active"!==e&&(i.radius=0),i.radius+=CE(n&&n._custom,r),i}}(0,It.A)(BI,"id","bubble"),(0,It.A)(BI,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),(0,It.A)(BI,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class UI extends PI{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{let r,a,o=t=>+n[t];if(TE(n[t])){const{key:t="value"}=this._parsing;o=e=>+UE(n[e],t)}for(r=t,a=t+e;r<a;++r)i._parsed[r]=o(r)}}_getRotation(){return aC(this.options.rotation-90)}_getCircumference(){return aC(this.options.circumference)}_getRotationExtents(){let t=qE,e=-qE;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const i=this.chart.getDatasetMeta(n).controller,r=i._getRotation(),a=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+a)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:n}=e,i=this._cachedMeta,r=i.data,a=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-a)/2,0),s=Math.min((l=this.options.cutout,c=o,"string"===typeof l&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(t,e,n){let i=1,r=1,a=0,o=0;if(e<qE){const s=t,l=s+e,c=Math.cos(s),u=Math.sin(s),h=Math.cos(l),d=Math.sin(l),p=(t,e,i)=>dC(t,s,l,!0)?1:Math.max(e,e*n,i,i*n),f=(t,e,i)=>dC(t,s,l,!0)?-1:Math.min(e,e*n,i,i*n),m=p(0,c,h),g=p(KE,u,d),y=f(WE,c,h),v=f(WE+KE,u,d);i=(m-y)/2,r=(g-v)/2,a=-(m+y)/2,o=-(g+v)/2}return{ratioX:i,ratioY:r,offsetX:a,offsetY:o}}(d,h,s),y=(n.width-a)/p,v=(n.height-a)/f,_=Math.max(Math.min(y,v)/2,0),b=PE(this.options.radius,_),x=(b-Math.max(b*s,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*b,this.offsetY=g*b,i.total=this.calculateTotal(),this.outerRadius=b-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*u,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const n=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===i._parsed[t]||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/qE)}updateElements(t,e,n,i){const r="reset"===i,a=this.chart,o=a.chartArea,s=a.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=r&&s.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,i);let m,g=this._getRotation();for(m=0;m<e;++m)g+=this._circumference(m,r);for(m=e;m<e+n;++m){const e=this._circumference(m,r),n=t[m],a={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+e,circumference:e,outerRadius:d,innerRadius:h};f&&(a.options=p||this.resolveDataElementOptions(m,n.active?"active":i)),g+=e,this.updateElement(n,m,a,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let n,i=0;for(n=0;n<e.length;n++){const r=t._parsed[n];null===r||isNaN(r)||!this.chart.getDataVisibility(n)||e[n].hidden||(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?qE*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=FC(e._parsed[t],n.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const n=this.chart;let i,r,a,o,s;if(!t)for(i=0,r=n.data.datasets.length;i<r;++i)if(n.isDatasetVisible(i)){a=n.getDatasetMeta(i),t=a.data,o=a.controller;break}if(!t)return 0;for(i=0,r=t.length;i<r;++i)s=o.resolveDataElementOptions(i),"inner"!==s.borderAlign&&(e=Math.max(e,s.borderWidth||0,s.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let n=0,i=t.length;n<i;++n){const t=this.resolveDataElementOptions(n);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}_getRingWeight(t){return Math.max(CE(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}(0,It.A)(UI,"id","doughnut"),(0,It.A)(UI,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),(0,It.A)(UI,"descriptors",{_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),(0,It.A)(UI,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n,color:i}}=t.legend.options;return e.labels.map((e,r)=>{const a=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,fontColor:i,lineWidth:a.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}}}});class jI extends PI{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:n,data:i=[],_dataset:r}=e,a=this.chart._animationsDisabled;let{start:o,count:s}=TC(e,i,a);this._drawStart=o,this._drawCount=s,AC(e)&&(o=0,s=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!r._decimated,n.points=i;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!a,options:l},t),this.updateElements(i,o,s,t)}updateElements(t,e,n,i){const r="reset"===i,{iScale:a,vScale:o,_stacked:s,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(e,i),h=a.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,m=iC(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===i,y=e+n,v=t.length;let _=e>0&&this.getParsed(e-1);for(let b=0;b<v;++b){const n=t[b],p=g?n:{};if(b<e||b>=y){p.skip=!0;continue}const v=this.getParsed(b),x=SE(v[d]),w=p[h]=a.getPixelForValue(v[h],b),S=p[d]=r||x?o.getBasePixel():o.getPixelForValue(s?this.applyStack(o,v,s):v[d],b);p.skip=isNaN(w)||isNaN(S)||x,p.stop=b>0&&Math.abs(v[h]-_[h])>m,f&&(p.parsed=v,p.raw=l.data[b]),u&&(p.options=c||this.resolveDataElementOptions(b,n.active?"active":i)),g||this.updateElement(n,b,p,i),_=v}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return n;const r=i[0].size(this.resolveDataElementOptions(0)),a=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,r,a)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}(0,It.A)(jI,"id","line"),(0,It.A)(jI,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),(0,It.A)(jI,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class VI extends PI{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=FC(e._parsed[t].r,n.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,n,i){return LP.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((t,n)=>{const i=this.getParsed(n).r;!isNaN(i)&&this.chart.getDataVisibility(n)&&(i<e.min&&(e.min=i),i>e.max&&(e.max=i))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,n=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),a=(r-Math.max(n.cutoutPercentage?r/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,n,i){const r="reset"===i,a=this.chart,o=a.options.animation,s=this._cachedMeta.rScale,l=s.xCenter,c=s.yCenter,u=s.getIndexAngle(0)-.5*WE;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<e;++h)d+=this._computeAngle(h,i,p);for(h=e;h<e+n;h++){const e=t[h];let n=d,f=d+this._computeAngle(h,i,p),m=a.getDataVisibility(h)?s.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,r&&(o.animateScale&&(m=0),o.animateRotate&&(n=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:n,endAngle:f,options:this.resolveDataElementOptions(h,e.active?"active":i)};this.updateElement(e,h,g,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((t,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,n){return this.chart.getDataVisibility(t)?aC(this.resolveDataElementOptions(t,e).angle||n):0}}(0,It.A)(VI,"id","polarArea"),(0,It.A)(VI,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),(0,It.A)(VI,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n,color:i}}=t.legend.options;return e.labels.map((e,r)=>{const a=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,fontColor:i,lineWidth:a.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class HI extends UI{}(0,It.A)(HI,"id","pie"),(0,It.A)(HI,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class GI extends PI{getLabelAndValue(t){const e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}parseObjectData(t,e,n,i){return LP.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta,n=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(n.points=i,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===i.length,options:e};this.updateElement(n,void 0,a,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,n,i){const r=this._cachedMeta.rScale,a="reset"===i;for(let o=e;o<e+n;o++){const e=t[o],n=this.resolveDataElementOptions(o,e.active?"active":i),s=r.getPointPositionForValue(o,this.getParsed(o).r),l=a?r.xCenter:s.x,c=a?r.yCenter:s.y,u={x:l,y:c,angle:s.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(e,o,u,i)}}}(0,It.A)(GI,"id","radar"),(0,It.A)(GI,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),(0,It.A)(GI,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class WI extends PI{getLabelAndValue(t){const e=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=e,a=this.getParsed(t),o=i.getLabelForValue(a.x),s=r.getLabelForValue(a.y);return{label:n[t]||"",value:"("+o+", "+s+")"}}update(t){const e=this._cachedMeta,{data:n=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:a}=TC(e,n,i);if(this._drawStart=r,this._drawCount=a,AC(e)&&(r=0,a=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:a}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!a._decimated,r.points=n;const o=this.resolveDatasetElementOptions(t);o.segment=this.options.segment,this.updateElement(r,void 0,{animated:!i,options:o},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(n,r,a,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,n,i){const r="reset"===i,{iScale:a,vScale:o,_stacked:s,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(e,i),u=this.getSharedOptions(c),h=this.includeOptions(i,u),d=a.axis,p=o.axis,{spanGaps:f,segment:m}=this.options,g=iC(f)?f:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||"none"===i;let v=e>0&&this.getParsed(e-1);for(let _=e;_<e+n;++_){const e=t[_],n=this.getParsed(_),c=y?e:{},f=SE(n[p]),b=c[d]=a.getPixelForValue(n[d],_),x=c[p]=r||f?o.getBasePixel():o.getPixelForValue(s?this.applyStack(o,n,s):n[p],_);c.skip=isNaN(b)||isNaN(x)||f,c.stop=_>0&&Math.abs(n[d]-v[d])>g,m&&(c.parsed=n,c.raw=l.data[_]),h&&(c.options=u||this.resolveDataElementOptions(_,e.active?"active":i)),y||this.updateElement(e,_,c,i),v=n}this.updateSharedOptions(u,i,c)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}const n=t.dataset,i=n.options&&n.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),a=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,a)/2}}(0,It.A)(WI,"id","scatter"),(0,It.A)(WI,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),(0,It.A)(WI,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});function qI(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class ZI{static override(t){Object.assign(ZI.prototype,t)}constructor(t){(0,It.A)(this,"options",void 0),this.options=t||{}}init(){}formats(){return qI()}parse(){return qI()}format(){return qI()}add(){return qI()}diff(){return qI()}startOf(){return qI()}endOf(){return qI()}}var XI=ZI;function YI(t,e,n,i){const{controller:r,data:a,_sorted:o}=t,s=r._cachedMeta.iScale,l=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(s&&e===s.axis&&"r"!==e&&o&&a.length){const o=s._reversePixels?yC:gC;if(!i){const i=o(a,e,n);if(l){const{vScale:e}=r._cachedMeta,{_parsed:n}=t,a=n.slice(0,i.lo+1).reverse().findIndex(t=>!SE(t[e.axis]));i.lo-=Math.max(0,a);const o=n.slice(i.hi).findIndex(t=>!SE(t[e.axis]));i.hi+=Math.max(0,o)}return i}if(r._sharedOptions){const t=a[0],i="function"===typeof t.getRange&&t.getRange(e);if(i){const t=o(a,e,n-i),r=o(a,e,n+i);return{lo:t.lo,hi:r.hi}}}}return{lo:0,hi:a.length-1}}function KI(t,e,n,i,r){const a=t.getSortedVisibleDatasetMetas(),o=n[e];for(let s=0,l=a.length;s<l;++s){const{index:t,data:n}=a[s],{lo:l,hi:c}=YI(a[s],e,o,r);for(let e=l;e<=c;++e){const r=n[e];r.skip||i(r,t,e)}}}function JI(t,e,n,i,r){const a=[];if(!r&&!t.isPointInArea(e))return a;return KI(t,n,e,function(n,o,s){(r||$C(n,t.chartArea,0))&&n.inRange(e.x,e.y,i)&&a.push({element:n,datasetIndex:o,index:s})},!0),a}function $I(t,e,n,i,r,a){let o=[];const s=function(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,i){const r=e?Math.abs(t.x-i.x):0,a=n?Math.abs(t.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(a,2))}}(n);let l=Number.POSITIVE_INFINITY;return KI(t,n,e,function(n,c,u){const h=n.inRange(e.x,e.y,r);if(i&&!h)return;const d=n.getCenterPoint(r);if(!(!!a||t.isPointInArea(d))&&!h)return;const p=s(e,d);p<l?(o=[{element:n,datasetIndex:c,index:u}],l=p):p===l&&o.push({element:n,datasetIndex:c,index:u})}),o}function QI(t,e,n,i,r,a){return a||t.isPointInArea(e)?"r"!==n||i?$I(t,e,n,i,r,a):function(t,e,n,i){let r=[];return KI(t,n,e,function(t,n,a){const{startAngle:o,endAngle:s}=t.getProps(["startAngle","endAngle"],i),{angle:l}=lC(t,{x:e.x,y:e.y});dC(l,o,s)&&r.push({element:t,datasetIndex:n,index:a})}),r}(t,e,n,r):[]}function tL(t,e,n,i,r){const a=[],o="x"===n?"inXRange":"inYRange";let s=!1;return KI(t,n,e,(t,i,l)=>{t[o]&&t[o](e[n],r)&&(a.push({element:t,datasetIndex:i,index:l}),s=s||t.inRange(e.x,e.y,r))}),i&&!s?[]:a}var eL={evaluateInteractionItems:KI,modes:{index(t,e,n,i){const r=WP(e,t),a=n.axis||"x",o=n.includeInvisible||!1,s=n.intersect?JI(t,r,a,i,o):QI(t,r,a,!1,i,o),l=[];return s.length?(t.getSortedVisibleDatasetMetas().forEach(t=>{const e=s[0].index,n=t.data[e];n&&!n.skip&&l.push({element:n,datasetIndex:t.index,index:e})}),l):[]},dataset(t,e,n,i){const r=WP(e,t),a=n.axis||"xy",o=n.includeInvisible||!1;let s=n.intersect?JI(t,r,a,i,o):QI(t,r,a,!1,i,o);if(s.length>0){const e=s[0].datasetIndex,n=t.getDatasetMeta(e).data;s=[];for(let t=0;t<n.length;++t)s.push({element:n[t],datasetIndex:e,index:t})}return s},point:(t,e,n,i)=>JI(t,WP(e,t),n.axis||"xy",i,n.includeInvisible||!1),nearest(t,e,n,i){const r=WP(e,t),a=n.axis||"xy",o=n.includeInvisible||!1;return QI(t,r,a,n.intersect,i,o)},x:(t,e,n,i)=>tL(t,WP(e,t),"x",n.intersect,i),y:(t,e,n,i)=>tL(t,WP(e,t),"y",n.intersect,i)}};const nL=["left","top","right","bottom"];function iL(t,e){return t.filter(t=>t.pos===e)}function rL(t,e){return t.filter(t=>-1===nL.indexOf(t.pos)&&t.box.axis===e)}function aL(t,e){return t.sort((t,n)=>{const i=e?n:t,r=e?t:n;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function oL(t,e){const n=function(t){const e={};for(const n of t){const{stack:t,pos:i,stackWeight:r}=n;if(!t||!nL.includes(i))continue;const a=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=r}return e}(t),{vBoxMaxWidth:i,hBoxMaxHeight:r}=e;let a,o,s;for(a=0,o=t.length;a<o;++a){s=t[a];const{fullSize:o}=s.box,l=n[s.stack],c=l&&s.stackWeight/l.weight;s.horizontal?(s.width=c?c*i:o&&e.availableWidth,s.height=r):(s.width=i,s.height=c?c*r:o&&e.availableHeight)}return n}function sL(t,e,n,i){return Math.max(t[n],e[n])+Math.max(t[i],e[i])}function lL(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function cL(t,e,n,i){const{pos:r,box:a}=n,o=t.maxPadding;if(!TE(r)){n.size&&(t[r]-=n.size);const e=i[n.stack]||{size:0,count:1};e.size=Math.max(e.size,n.horizontal?a.height:a.width),n.size=e.size/e.count,t[r]+=n.size}a.getPadding&&lL(o,a.getPadding());const s=Math.max(0,e.outerWidth-sL(o,t,"left","right")),l=Math.max(0,e.outerHeight-sL(o,t,"top","bottom")),c=s!==t.w,u=l!==t.h;return t.w=s,t.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function uL(t,e){const n=e.maxPadding;function i(t){const i={left:0,top:0,right:0,bottom:0};return t.forEach(t=>{i[t]=Math.max(e[t],n[t])}),i}return i(t?["left","right"]:["top","bottom"])}function hL(t,e,n,i){const r=[];let a,o,s,l,c,u;for(a=0,o=t.length,c=0;a<o;++a){s=t[a],l=s.box,l.update(s.width||e.w,s.height||e.h,uL(s.horizontal,e));const{same:o,other:h}=cL(e,n,s,i);c|=o&&r.length,u=u||h,l.fullSize||r.push(s)}return c&&hL(r,e,n,i)||u}function dL(t,e,n,i,r){t.top=n,t.left=e,t.right=e+i,t.bottom=n+r,t.width=i,t.height=r}function pL(t,e,n,i){const r=n.padding;let{x:a,y:o}=e;for(const s of t){const t=s.box,l=i[s.stack]||{count:1,placed:0,weight:1},c=s.stackWeight/l.weight||1;if(s.horizontal){const i=e.w*c,a=l.size||t.height;VE(l.start)&&(o=l.start),t.fullSize?dL(t,r.left,o,n.outerWidth-r.right-r.left,a):dL(t,e.left+l.placed,o,i,a),l.start=o,l.placed+=i,o=t.bottom}else{const i=e.h*c,o=l.size||t.width;VE(l.start)&&(a=l.start),t.fullSize?dL(t,a,r.top,o,n.outerHeight-r.bottom-r.top):dL(t,a,e.top+l.placed,o,i),l.start=a,l.placed+=i,a=t.right}}e.x=a,e.y=o}var fL={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,i){if(!t)return;const r=fP(t.options.layout.padding),a=Math.max(e-r.width,0),o=Math.max(n-r.height,0),s=function(t){const e=function(t){const e=[];let n,i,r,a,o,s;for(n=0,i=(t||[]).length;n<i;++n)r=t[n],({position:a,options:{stack:o,stackWeight:s=1}}=r),e.push({index:n,box:r,pos:a,horizontal:r.isHorizontal(),weight:r.weight,stack:o&&a+o,stackWeight:s});return e}(t),n=aL(e.filter(t=>t.box.fullSize),!0),i=aL(iL(e,"left"),!0),r=aL(iL(e,"right")),a=aL(iL(e,"top"),!0),o=aL(iL(e,"bottom")),s=rL(e,"x"),l=rL(e,"y");return{fullSize:n,leftAndTop:i.concat(a),rightAndBottom:r.concat(l).concat(o).concat(s),chartArea:iL(e,"chartArea"),vertical:i.concat(r).concat(l),horizontal:a.concat(o).concat(s)}}(t.boxes),l=s.vertical,c=s.horizontal;LE(t.boxes,t=>{"function"===typeof t.beforeLayout&&t.beforeLayout()});const u=l.reduce((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:r,availableWidth:a,availableHeight:o,vBoxMaxWidth:a/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},r);lL(d,fP(i));const p=Object.assign({maxPadding:d,w:a,h:o,x:r.left,y:r.top},r),f=oL(l.concat(c),h);hL(s.fullSize,p,h,f),hL(l,p,h,f),hL(c,p,h,f)&&hL(l,p,h,f),function(t){const e=t.maxPadding;function n(n){const i=Math.max(e[n]-t[n],0);return t[n]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(p),pL(s.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,pL(s.rightAndBottom,p,h,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},LE(s.chartArea,e=>{const n=e.box;Object.assign(n,t.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class mL{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,n){}removeEventListener(t,e,n){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,n,i){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):n)}}isAttached(t){return!0}updateConfig(t){}}class gL extends mL{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const yL="$chartjs",vL={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},_L=t=>null===t||""===t;const bL=!!YP&&{passive:!0};function xL(t,e,n){t&&t.canvas&&t.canvas.removeEventListener(e,n,bL)}function wL(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function SL(t,e,n){const i=t.canvas,r=new MutationObserver(t=>{let e=!1;for(const n of t)e=e||wL(n.addedNodes,i),e=e&&!wL(n.removedNodes,i);e&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}function ML(t,e,n){const i=t.canvas,r=new MutationObserver(t=>{let e=!1;for(const n of t)e=e||wL(n.removedNodes,i),e=e&&!wL(n.addedNodes,i);e&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}const TL=new Map;let AL=0;function EL(){const t=window.devicePixelRatio;t!==AL&&(AL=t,TL.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function CL(t,e,n){const i=t.canvas,r=i&&UP(i);if(!r)return;const a=wC((t,e)=>{const i=r.clientWidth;n(t,e),i<r.clientWidth&&n()},window),o=new ResizeObserver(t=>{const e=t[0],n=e.contentRect.width,i=e.contentRect.height;0===n&&0===i||a(n,i)});return o.observe(r),function(t,e){TL.size||window.addEventListener("resize",EL),TL.set(t,e)}(t,a),o}function PL(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){TL.delete(t),TL.size||window.removeEventListener("resize",EL)}(t)}function IL(t,e,n){const i=t.canvas,r=wC(e=>{null!==t.ctx&&n(function(t,e){const n=vL[t.type]||t.type,{x:i,y:r}=WP(t,e);return{type:n,chart:e,native:t,x:void 0!==i?i:null,y:void 0!==r?r:null}}(e,t))},t);return function(t,e,n){t&&t.addEventListener(e,n,bL)}(i,e,r),r}class LL extends mL{acquireContext(t,e){const n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){const n=t.style,i=t.getAttribute("height"),r=t.getAttribute("width");if(t[yL]={initial:{height:i,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",_L(r)){const e=KP(t,"width");void 0!==e&&(t.width=e)}if(_L(i))if(""===t.style.height)t.height=t.width/(e||2);else{const e=KP(t,"height");void 0!==e&&(t.height=e)}}(t,e),n):null}releaseContext(t){const e=t.canvas;if(!e[yL])return!1;const n=e[yL].initial;["height","width"].forEach(t=>{const i=n[t];SE(i)?e.removeAttribute(t):e.setAttribute(t,i)});const i=n.style||{};return Object.keys(i).forEach(t=>{e.style[t]=i[t]}),e.width=e.width,delete e[yL],!0}addEventListener(t,e,n){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),r={attach:SL,detach:ML,resize:CL}[e]||IL;i[e]=r(t,e,n)}removeEventListener(t,e){const n=t.$proxies||(t.$proxies={}),i=n[e];if(!i)return;({attach:PL,detach:PL,resize:PL}[e]||xL)(t,e,i),n[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,n,i){return ZP(t,e,n,i)}isAttached(t){const e=t&&UP(t);return!(!e||!e.isConnected)}}class kL{constructor(){(0,It.A)(this,"x",void 0),(0,It.A)(this,"y",void 0),(0,It.A)(this,"active",!1),(0,It.A)(this,"options",void 0),(0,It.A)(this,"$animations",void 0)}tooltipPosition(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}hasValue(){return iC(this.x)&&iC(this.y)}getProps(t,e){const n=this.$animations;if(!e||!n)return this;const i={};return t.forEach(t=>{i[t]=n[t]&&n[t].active()?n[t]._to:this[t]}),i}}function RL(t,e){const n=t.options.ticks,i=function(t){const e=t.options.offset,n=t._tickSize(),i=t._length/n+(e?0:1),r=t._maxLength/n;return Math.floor(Math.min(i,r))}(t),r=Math.min(n.maxTicksLimit||i,i),a=n.major.enabled?function(t){const e=[];let n,i;for(n=0,i=t.length;n<i;n++)t[n].major&&e.push(n);return e}(e):[],o=a.length,s=a[0],l=a[o-1],c=[];if(o>r)return function(t,e,n,i){let r,a=0,o=n[0];for(i=Math.ceil(i),r=0;r<t.length;r++)r===o&&(e.push(t[r]),a++,o=n[a*i])}(e,c,a,o/r),c;const u=function(t,e,n){const i=function(t){const e=t.length;let n,i;if(e<2)return!1;for(i=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==i)return!1;return i}(t),r=e.length/n;if(!i)return Math.max(r,1);const a=function(t){const e=[],n=Math.sqrt(t);let i;for(i=1;i<n;i++)t%i===0&&(e.push(i),e.push(t/i));return n===(0|n)&&e.push(n),e.sort((t,e)=>t-e).pop(),e}(i);for(let o=0,s=a.length-1;o<s;o++){const t=a[o];if(t>r)return t}return Math.max(r,1)}(a,e,r);if(o>0){let t,n;const i=o>1?Math.round((l-s)/(o-1)):null;for(DL(e,c,u,SE(i)?0:s-i,s),t=0,n=o-1;t<n;t++)DL(e,c,u,a[t],a[t+1]);return DL(e,c,u,l,SE(i)?e.length:l+i),c}return DL(e,c,u),c}function DL(t,e,n,i,r){const a=CE(i,0),o=Math.min(CE(r,t.length),t.length);let s,l,c,u=0;for(n=Math.ceil(n),r&&(s=r-i,n=s/Math.floor(s/n)),c=a;c<0;)u++,c=Math.round(a+u*n);for(l=Math.max(a,0);l<o;l++)l===c&&(e.push(t[l]),u++,c=Math.round(a+u*n))}(0,It.A)(kL,"defaults",{}),(0,It.A)(kL,"defaultRoutes",void 0);const NL=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n,zL=(t,e)=>Math.min(e||t,t);function FL(t,e){const n=[],i=t.length/e,r=t.length;let a=0;for(;a<r;a+=i)n.push(t[Math.floor(a)]);return n}function OL(t,e,n){const i=t.ticks.length,r=Math.min(e,i-1),a=t._startPixel,o=t._endPixel,s=1e-6;let l,c=t.getPixelForTick(r);if(!(n&&(l=1===i?Math.max(c-a,o-c):0===e?(t.getPixelForTick(1)-c)/2:(c-t.getPixelForTick(r-1))/2,c+=r<e?l:-l,c<a-s||c>o+s)))return c}function BL(t){return t.drawTicks?t.tickLength:0}function UL(t,e){if(!t.display)return 0;const n=mP(t.font,e),i=fP(t.padding);return(ME(t.text)?t.text.length:1)*n.lineHeight+i.height}function jL(t,e,n){let i=SC(t);return(n&&"right"!==e||!n&&"right"===e)&&(i=(t=>"left"===t?"right":"right"===t?"left":t)(i)),i}class VL extends kL{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:n,_suggestedMax:i}=this;return t=EE(t,Number.POSITIVE_INFINITY),e=EE(e,Number.NEGATIVE_INFINITY),n=EE(n,Number.POSITIVE_INFINITY),i=EE(i,Number.NEGATIVE_INFINITY),{min:EE(t,n),max:EE(e,i),minDefined:AE(t),maxDefined:AE(e)}}getMinMax(t){let e,{min:n,max:i,minDefined:r,maxDefined:a}=this.getUserBounds();if(r&&a)return{min:n,max:i};const o=this.getMatchingVisibleMetas();for(let s=0,l=o.length;s<l;++s)e=o[s].controller.getMinMax(this,t),r||(n=Math.min(n,e.min)),a||(i=Math.max(i,e.max));return n=a&&n>i?i:n,i=r&&n>i?n:i,{min:EE(n,EE(i,n)),max:EE(i,EE(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){IE(this.options.beforeUpdate,[this])}update(t,e,n){const{beginAtZero:i,grace:r,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){const{min:i,max:r}=t,a=PE(e,(r-i)/2),o=(t,e)=>n&&0===t?0:t+e;return{min:o(i,-Math.abs(a)),max:o(r,a)}}(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const s=o<this.ticks.length;this._convertTicksToLabels(s?FL(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||"auto"===a.source)&&(this.ticks=RL(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),s&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){IE(this.options.afterUpdate,[this])}beforeSetDimensions(){IE(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){IE(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),IE(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){IE(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let n,i,r;for(n=0,i=t.length;n<i;n++)r=t[n],r.label=IE(e.callback,[r.value,n,t],this)}afterTickToLabelConversion(){IE(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){IE(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,n=zL(this.ticks.length,t.ticks.maxTicksLimit),i=e.minRotation||0,r=e.maxRotation;let a,o,s,l=i;if(!this._isVisible()||!e.display||i>=r||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=pC(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/n:d/(n-1),u+6>a&&(a=d/(n-(t.offset?.5:1)),o=this.maxHeight-BL(t.grid)-e.padding-UL(t.title,this.chart.options.font),s=Math.sqrt(u*u+h*h),l=oC(Math.min(Math.asin(pC((c.highest.height+6)/a,-1,1)),Math.asin(pC(o/s,-1,1))-Math.asin(pC(h/s,-1,1)))),l=Math.max(i,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){IE(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){IE(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:n,title:i,grid:r}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const a=UL(i,e.options.font);if(o?(t.width=this.maxWidth,t.height=BL(r)+a):(t.height=this.maxHeight,t.width=BL(r)+a),n.display&&this.ticks.length){const{first:e,last:i,widest:r,highest:a}=this._getLabelSizes(),s=2*n.padding,l=aC(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const e=n.mirror?0:u*r.width+c*a.height;t.height=Math.min(this.maxHeight,t.height+e+s)}else{const e=n.mirror?0:c*r.width+u*a.height;t.width=Math.min(this.maxWidth,t.width+e+s)}this._calculatePadding(e,i,u,c)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,n,i){const{ticks:{align:r,padding:a},position:o}=this.options,s=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;s?l?(u=i*t.width,h=n*e.height):(u=n*t.height,h=i*e.width):"start"===r?h=e.width:"end"===r?u=t.width:"inner"!==r&&(u=t.width/2,h=e.width/2),this.paddingLeft=Math.max((u-o+a)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-c+a)*this.width/(this.width-c),0)}else{let n=e.height/2,i=t.height/2;"start"===r?(n=0,i=t.height):"end"===r&&(n=e.height,i=0),this.paddingTop=n+a,this.paddingBottom=i+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){IE(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)SE(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let n=this.ticks;e<n.length&&(n=FL(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,n){const{ctx:i,_longestTextCache:r}=this,a=[],o=[],s=Math.floor(e/zL(e,n));let l,c,u,h,d,p,f,m,g,y,v,_=0,b=0;for(l=0;l<e;l+=s){if(h=t[l].label,d=this._resolveTickFontOptions(l),i.font=p=d.string,f=r[p]=r[p]||{data:{},gc:[]},m=d.lineHeight,g=y=0,SE(h)||ME(h)){if(ME(h))for(c=0,u=h.length;c<u;++c)v=h[c],SE(v)||ME(v)||(g=qC(i,f.data,f.gc,g,v),y+=m)}else g=qC(i,f.data,f.gc,g,h),y=m;a.push(g),o.push(y),_=Math.max(g,_),b=Math.max(y,b)}!function(t,e){LE(t,t=>{const n=t.gc,i=n.length/2;let r;if(i>e){for(r=0;r<i;++r)delete t.data[n[r]];n.splice(0,i)}})}(r,e);const x=a.indexOf(_),w=o.indexOf(b),S=t=>({width:a[t]||0,height:o[t]||0});return{first:S(0),last:S(e-1),widest:S(x),highest:S(w),widths:a,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return pC(this._alignToPixels?XC(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const n=e[t];return n.$context||(n.$context=function(t,e,n){return yP(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=function(t,e){return yP(t,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=aC(this.labelRotation),n=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),a=t.autoSkipPadding||0,o=r?r.widest.width+a:0,s=r?r.highest.height+a:0;return this.isHorizontal()?s*n>o*i?o/n:s/i:s*i<o*n?s/n:o/i}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,n=this.chart,i=this.options,{grid:r,position:a,border:o}=i,s=r.offset,l=this.isHorizontal(),c=this.ticks.length+(s?1:0),u=BL(r),h=[],d=o.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,m=function(t){return XC(n,t,p)};let g,y,v,_,b,x,w,S,M,T,A,E;if("top"===a)g=m(this.bottom),x=this.bottom-u,S=g-f,T=m(t.top)+f,E=t.bottom;else if("bottom"===a)g=m(this.top),T=t.top,E=m(t.bottom)-f,x=g+f,S=this.top+u;else if("left"===a)g=m(this.right),b=this.right-u,w=g-f,M=m(t.left)+f,A=t.right;else if("right"===a)g=m(this.left),M=t.left,A=m(t.right)-f,b=g+f,w=this.left+u;else if("x"===e){if("center"===a)g=m((t.top+t.bottom)/2+.5);else if(TE(a)){const t=Object.keys(a)[0],e=a[t];g=m(this.chart.scales[t].getPixelForValue(e))}T=t.top,E=t.bottom,x=g+f,S=x+u}else if("y"===e){if("center"===a)g=m((t.left+t.right)/2);else if(TE(a)){const t=Object.keys(a)[0],e=a[t];g=m(this.chart.scales[t].getPixelForValue(e))}b=g-f,w=b-u,M=t.left,A=t.right}const C=CE(i.ticks.maxTicksLimit,c),P=Math.max(1,Math.ceil(c/C));for(y=0;y<c;y+=P){const t=this.getContext(y),e=r.setContext(t),i=o.setContext(t),a=e.lineWidth,c=e.color,u=i.dash||[],d=i.dashOffset,p=e.tickWidth,f=e.tickColor,m=e.tickBorderDash||[],g=e.tickBorderDashOffset;v=OL(this,y,s),void 0!==v&&(_=XC(n,v,a),l?b=w=M=A=_:x=S=T=E=_,h.push({tx1:b,ty1:x,tx2:w,ty2:S,x1:M,y1:T,x2:A,y2:E,width:a,color:c,borderDash:u,borderDashOffset:d,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,h}_computeLabelItems(t){const e=this.axis,n=this.options,{position:i,ticks:r}=n,a=this.isHorizontal(),o=this.ticks,{align:s,crossAlign:l,padding:c,mirror:u}=r,h=BL(n.grid),d=h+c,p=u?-c:d,f=-aC(this.labelRotation),m=[];let g,y,v,_,b,x,w,S,M,T,A,E,C="middle";if("top"===i)x=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===i)x=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===i){const t=this._getYAxisLabelAlignment(h);w=t.textAlign,b=t.x}else if("right"===i){const t=this._getYAxisLabelAlignment(h);w=t.textAlign,b=t.x}else if("x"===e){if("center"===i)x=(t.top+t.bottom)/2+d;else if(TE(i)){const t=Object.keys(i)[0],e=i[t];x=this.chart.scales[t].getPixelForValue(e)+d}w=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===i)b=(t.left+t.right)/2-d;else if(TE(i)){const t=Object.keys(i)[0],e=i[t];b=this.chart.scales[t].getPixelForValue(e)}w=this._getYAxisLabelAlignment(h).textAlign}"y"===e&&("start"===s?C="top":"end"===s&&(C="bottom"));const P=this._getLabelSizes();for(g=0,y=o.length;g<y;++g){v=o[g],_=v.label;const t=r.setContext(this.getContext(g));S=this.getPixelForTick(g)+r.labelOffset,M=this._resolveTickFontOptions(g),T=M.lineHeight,A=ME(_)?_.length:1;const e=A/2,n=t.color,s=t.textStrokeColor,c=t.textStrokeWidth;let h,d=w;if(a?(b=S,"inner"===w&&(d=g===y-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),E="top"===i?"near"===l||0!==f?-A*T+T/2:"center"===l?-P.highest.height/2-e*T+T:-P.highest.height+T/2:"near"===l||0!==f?T/2:"center"===l?P.highest.height/2-e*T:P.highest.height-A*T,u&&(E*=-1),0===f||t.showLabelBackdrop||(b+=T/2*Math.sin(f))):(x=S,E=(1-A)*T/2),t.showLabelBackdrop){const e=fP(t.backdropPadding),n=P.heights[g],i=P.widths[g];let r=E-e.top,a=0-e.left;switch(C){case"middle":r-=n/2;break;case"bottom":r-=n}switch(w){case"center":a-=i/2;break;case"right":a-=i;break;case"inner":g===y-1?a-=i:g>0&&(a-=i/2)}h={left:a,top:r,width:i+e.width,height:n+e.height,color:t.backdropColor}}m.push({label:_,font:M,textOffset:E,options:{rotation:f,color:n,strokeColor:s,strokeWidth:c,textAlign:d,textBaseline:C,translation:[b,x],backdrop:h}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-aC(this.labelRotation))return"top"===t?"left":"right";let n="center";return"start"===e.align?n="left":"end"===e.align?n="right":"inner"===e.align&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:n,mirror:i,padding:r}}=this.options,a=t+r,o=this._getLabelSizes().widest.width;let s,l;return"left"===e?i?(l=this.right+r,"near"===n?s="left":"center"===n?(s="center",l+=o/2):(s="right",l+=o)):(l=this.right-a,"near"===n?s="right":"center"===n?(s="center",l-=o/2):(s="left",l=this.left)):"right"===e?i?(l=this.left+r,"near"===n?s="right":"center"===n?(s="center",l-=o/2):(s="left",l-=o)):(l=this.left+a,"near"===n?s="left":"center"===n?(s="center",l+=o/2):(s="right",l=this.right)):s="right",{textAlign:s,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:n,top:i,width:r,height:a}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(n,i,r,a),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(e=>e.value===t);if(n>=0){return e.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,a;const o=(t,e,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.restore())};if(e.display)for(r=0,a=i.length;r<a;++r){const t=i[r];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:n,grid:i}}=this,r=n.setContext(this.getContext()),a=n.display?r.width:0;if(!a)return;const o=i.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let l,c,u,h;this.isHorizontal()?(l=XC(t,this.left,a)-a/2,c=XC(t,this.right,o)+o/2,u=h=s):(u=XC(t,this.top,a)-a/2,h=XC(t,this.bottom,o)+o/2,l=c=s),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(l,u),e.lineTo(c,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,n=this._computeLabelArea();n&&QC(e,n);const i=this.getLabelItems(t);for(const r of i){const t=r.options,n=r.font;aP(e,r.label,0,r.textOffset,n,t)}n&&tP(e)}drawTitle(){const{ctx:t,options:{position:e,title:n,reverse:i}}=this;if(!n.display)return;const r=mP(n.font),a=fP(n.padding),o=n.align;let s=r.lineHeight/2;"bottom"===e||"center"===e||TE(e)?(s+=a.bottom,ME(n.text)&&(s+=r.lineHeight*(n.text.length-1))):s+=a.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(t,e,n,i){const{top:r,left:a,bottom:o,right:s,chart:l}=t,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=o-r,g=s-a;if(t.isHorizontal()){if(d=MC(i,a,s),TE(n)){const t=Object.keys(n)[0],i=n[t];p=u[t].getPixelForValue(i)+m-e}else p="center"===n?(c.bottom+c.top)/2+m-e:NL(t,n,e);h=s-a}else{if(TE(n)){const t=Object.keys(n)[0],i=n[t];d=u[t].getPixelForValue(i)-g+e}else d="center"===n?(c.left+c.right)/2-g+e:NL(t,n,e);p=MC(i,o,r),f="left"===n?-KE:KE}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,s,e,o);aP(t,n.text,0,0,r,{color:n.color,maxWidth:u,rotation:h,textAlign:jL(o,e,i),textBaseline:"middle",translation:[l,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,n=CE(t.grid&&t.grid.z,-1),i=CE(t.border&&t.border.z,0);return this._isVisible()&&this.draw===VL.prototype.draw?[{z:n,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let r,a;for(r=0,a=e.length;r<a;++r){const a=e[r];a[n]!==this.id||t&&a.type!==t||i.push(a)}return i}_resolveTickFontOptions(t){return mP(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class HL{constructor(t,e,n){this.type=t,this.scope=e,this.override=n,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let n;(function(t){return"id"in t&&"defaults"in t})(e)&&(n=this.register(e));const i=this.items,r=t.id,a=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,function(t,e,n){const i=zE(Object.create(null),[n?WC.get(n):{},WC.get(e),t.defaults]);WC.set(e,i),t.defaultRoutes&&function(t,e){Object.keys(e).forEach(n=>{const i=n.split("."),r=i.pop(),a=[t].concat(i).join("."),o=e[n].split("."),s=o.pop(),l=o.join(".");WC.route(a,r,l,s)})}(e,t.defaultRoutes);t.descriptors&&WC.describe(e,t.descriptors)}(t,a,n),this.override&&WC.override(t.id,t.overrides)),a}get(t){return this.items[t]}unregister(t){const e=this.items,n=t.id,i=this.scope;n in e&&delete e[n],i&&n in WC[i]&&(delete WC[i][n],this.override&&delete UC[n])}}class GL{constructor(){this.controllers=new HL(PI,"datasets",!0),this.elements=new HL(kL,"elements"),this.plugins=new HL(Object,"plugins"),this.scales=new HL(VL,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e)}remove(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e)}addControllers(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.controllers)}addElements(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.elements)}addPlugins(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.plugins)}addScales(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.controllers)}removeElements(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.elements)}removePlugins(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.plugins)}removeScales(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.scales)}_each(t,e,n){[...e].forEach(e=>{const i=n||this._getRegistryForType(e);n||i.isForType(e)||i===this.plugins&&e.id?this._exec(t,i,e):LE(e,e=>{const i=n||this._getRegistryForType(e);this._exec(t,i,e)})})}_exec(t,e,n){const i=jE(t);IE(n["before"+i],[],n),e[t](n),IE(n["after"+i],[],n)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}_get(t,e,n){const i=e.get(t);if(void 0===i)throw new Error('"'+t+'" is not a registered '+n+".");return i}}var WL=new GL;class qL{constructor(){this._init=[]}notify(t,e,n,i){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const r=i?this._descriptors(t).filter(i):this._descriptors(t),a=this._notify(r,t,e,n);return"afterDestroy"===e&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),a}_notify(t,e,n,i){i=i||{};for(const r of t){const t=r.plugin;if(!1===IE(t[n],[e,i,r.options],t)&&i.cancelable)return!1}return!0}invalidate(){SE(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const n=t&&t.config,i=CE(n.options&&n.options.plugins,{}),r=function(t){const e={},n=[],i=Object.keys(WL.plugins.items);for(let a=0;a<i.length;a++)n.push(WL.getPlugin(i[a]));const r=t.plugins||[];for(let a=0;a<r.length;a++){const t=r[a];-1===n.indexOf(t)&&(n.push(t),e[t.id]=!0)}return{plugins:n,localIds:e}}(n);return!1!==i||e?function(t,e,n,i){let{plugins:r,localIds:a}=e;const o=[],s=t.getContext();for(const l of r){const e=l.id,r=ZL(n[e],i);null!==r&&o.push({plugin:l,options:XL(t.config,{plugin:l,local:a[e]},r,s)})}return o}(t,r,i,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],n=this._cache,i=(t,e)=>t.filter(t=>!e.some(e=>t.plugin.id===e.plugin.id));this._notify(i(e,n),t,"stop"),this._notify(i(n,e),t,"start")}}function ZL(t,e){return e||!1!==t?!0===t?{}:t:null}function XL(t,e,n,i){let{plugin:r,local:a}=e;const o=t.pluginScopeKeys(r),s=t.getOptionScopes(n,o);return a&&r.defaults&&s.push(r.defaults),t.createResolver(s,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function YL(t,e){const n=WC.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function KL(t){if("x"===t||"y"===t||"r"===t)return t}function JL(t){return"top"===t||"bottom"===t?"x":"left"===t||"right"===t?"y":void 0}function $L(t){if(KL(t))return t;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n){const e=r.axis||JL(r.position)||t.length>1&&KL(t[0].toLowerCase());if(e)return e}throw new Error("Cannot determine type of '".concat(t,"' axis. Please provide 'axis' or 'position' option."))}function QL(t,e,n){if(n[e+"AxisID"]===t)return{axis:e}}function tk(t,e){const n=UC[t.type]||{scales:{}},i=e.scales||{},r=YL(t.type,e),a=Object.create(null);return Object.keys(i).forEach(e=>{const o=i[e];if(!TE(o))return console.error("Invalid scale configuration for scale: ".concat(e));if(o._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(e));const s=$L(e,o,function(t,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(e=>e.xAxisID===t||e.yAxisID===t);if(n.length)return QL(t,"x",n[0])||QL(t,"y",n[0])}return{}}(e,t),WC.scales[o.type]),l=function(t,e){return t===e?"_index_":"_value_"}(s,r),c=n.scales||{};a[e]=FE(Object.create(null),[{axis:s},o,c[s],c[l]])}),t.data.datasets.forEach(n=>{const r=n.type||t.type,o=n.indexAxis||YL(r,e),s=(UC[r]||{}).scales||{};Object.keys(s).forEach(t=>{const e=function(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,o),r=n[e+"AxisID"]||e;a[r]=a[r]||Object.create(null),FE(a[r],[{axis:e},i[r],s[t]])})}),Object.keys(a).forEach(t=>{const e=a[t];FE(e,[WC.scales[e.type],WC.scale])}),a}function ek(t){const e=t.options||(t.options={});e.plugins=CE(e.plugins,{}),e.scales=tk(t,e)}function nk(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const ik=new Map,rk=new Set;function ak(t,e){let n=ik.get(t);return n||(n=e(),ik.set(t,n),rk.add(n)),n}const ok=(t,e,n)=>{const i=UE(e,n);void 0!==i&&t.add(i)};class sk{constructor(t){this._config=function(t){return(t=t||{}).data=nk(t.data),ek(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=nk(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ek(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return ak(t,()=>[["datasets.".concat(t),""]])}datasetAnimationScopeKeys(t,e){return ak("".concat(t,".transition.").concat(e),()=>[["datasets.".concat(t,".transitions.").concat(e),"transitions.".concat(e)],["datasets.".concat(t),""]])}datasetElementScopeKeys(t,e){return ak("".concat(t,"-").concat(e),()=>[["datasets.".concat(t,".elements.").concat(e),"datasets.".concat(t),"elements.".concat(e),""]])}pluginScopeKeys(t){const e=t.id,n=this.type;return ak("".concat(n,"-plugin-").concat(e),()=>[["plugins.".concat(e),...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const n=this._scopeCache;let i=n.get(t);return i&&!e||(i=new Map,n.set(t,i)),i}getOptionScopes(t,e,n){const{options:i,type:r}=this,a=this._cachedScopes(t,n),o=a.get(e);if(o)return o;const s=new Set;e.forEach(e=>{t&&(s.add(t),e.forEach(e=>ok(s,t,e))),e.forEach(t=>ok(s,i,t)),e.forEach(t=>ok(s,UC[r]||{},t)),e.forEach(t=>ok(s,WC,t)),e.forEach(t=>ok(s,jC,t))});const l=Array.from(s);return 0===l.length&&l.push(Object.create(null)),rk.has(e)&&a.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,UC[e]||{},WC.datasets[e]||{},{type:e},WC,jC]}resolveNamedOptions(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const r={$shared:!0},{resolver:a,subPrefixes:o}=lk(this._resolverCache,t,i);let s=a;if(function(t,e){const{isScriptable:n,isIndexable:i}=bP(t);for(const r of e){const e=n(r),a=i(r),o=(a||e)&&t[r];if(e&&(HE(o)||ck(o))||a&&ME(o))return!0}return!1}(a,e)){r.$shared=!1;s=_P(a,n=HE(n)?n():n,this.createResolver(t,n,o))}for(const l of e)r[l]=s[l];return r}createResolver(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],i=arguments.length>3?arguments[3]:void 0;const{resolver:r}=lk(this._resolverCache,t,n);return TE(e)?_P(r,e,void 0,i):r}}function lk(t,e,n){let i=t.get(e);i||(i=new Map,t.set(e,i));const r=n.join();let a=i.get(r);if(!a){a={resolver:vP(e,n),subPrefixes:n.filter(t=>!t.toLowerCase().includes("hover"))},i.set(r,a)}return a}const ck=t=>TE(t)&&Object.getOwnPropertyNames(t).some(e=>HE(t[e]));const uk=["top","bottom","left","right","chartArea"];function hk(t,e){return"top"===t||"bottom"===t||-1===uk.indexOf(t)&&"x"===e}function dk(t,e){return function(n,i){return n[t]===i[t]?n[e]-i[e]:n[t]-i[t]}}function pk(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),IE(n&&n.onComplete,[t],e)}function fk(t){const e=t.chart,n=e.options.animation;IE(n&&n.onProgress,[t],e)}function mk(t){return BP()&&"string"===typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const gk={},yk=t=>{const e=mk(t);return Object.values(gk).filter(t=>t.canvas===e).pop()};function vk(t,e,n){const i=Object.keys(t);for(const r of i){const i=+r;if(i>=e){const a=t[r];delete t[r],(n>0||i>e)&&(t[i+n]=a)}}}class _k{static register(){WL.add(...arguments),bk()}static unregister(){WL.remove(...arguments),bk()}constructor(t,e){const n=this.config=new sk(e),i=mk(t),r=yk(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const a=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(t){return!BP()||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas?gL:LL}(i)),this.platform.updateConfig(n);const o=this.platform.acquireContext(i,a.aspectRatio),s=o&&o.canvas,l=s&&s.height,c=s&&s.width;this.id=wE(),this.ctx=o,this.canvas=s,this.width=c,this.height=l,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new qL,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let n;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}(t=>this.update(t),a.resizeDelay||0),this._dataChanges=[],gk[this.id]=this,o&&s?(pI.listen(this,"complete",pk),pI.listen(this,"progress",fk),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:n,height:i,_aspectRatio:r}=this;return SE(t)?e&&r?r:i?n/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return WL}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():XP(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return YC(this.canvas,this.ctx),this}stop(){return pI.stop(this),this}resize(t,e){pI.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const n=this.options,i=this.canvas,r=n.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(i,t,e,r),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,XP(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),IE(n.onResize,[this,a],this),this.attached&&this._doResize(s)&&this.render())}ensureScalesHaveIDs(){LE(this.options.scales||{},(t,e)=>{t.id=e})}buildOrUpdateScales(){const t=this.options,e=t.scales,n=this.scales,i=Object.keys(n).reduce((t,e)=>(t[e]=!1,t),{});let r=[];e&&(r=r.concat(Object.keys(e).map(t=>{const n=e[t],i=$L(t,n),r="r"===i,a="x"===i;return{options:n,dposition:r?"chartArea":a?"bottom":"left",dtype:r?"radialLinear":a?"category":"linear"}}))),LE(r,e=>{const r=e.options,a=r.id,o=$L(a,r),s=CE(r.type,e.dtype);void 0!==r.position&&hk(r.position,o)===hk(e.dposition)||(r.position=e.dposition),i[a]=!0;let l=null;if(a in n&&n[a].type===s)l=n[a];else{l=new(WL.getScale(s))({id:a,type:s,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(r,t)}),LE(i,(t,e)=>{t||delete n[e]}),LE(n,t=>{fL.configure(this,t,t.options),fL.addBox(this,t)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort((t,e)=>t.index-e.index),n>e){for(let t=e;t<n;++t)this._destroyDatasetMeta(t);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(dk("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((t,n)=>{0===e.filter(e=>e===t._dataset).length&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=e.length;n<i;n++){const i=e[n];let r=this.getDatasetMeta(n);const a=i.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(n),r=this.getDatasetMeta(n)),r.type=a,r.indexAxis=i.indexAxis||YL(a,this.options),r.order=i.order||0,r.index=n,r.label=""+i.label,r.visible=this.isDatasetVisible(n),r.controller)r.controller.updateIndex(n),r.controller.linkScales();else{const e=WL.getController(a),{datasetElementType:i,dataElementType:o}=WC.datasets[a];Object.assign(e,{dataElementType:WL.getElement(o),datasetElementType:i&&WL.getElement(i)}),r.controller=new e(this,n),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){LE(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:t}=this.getDatasetMeta(l),e=!i&&-1===r.indexOf(t);t.buildOrUpdateElements(e),a=Math.max(+t.getMaxOverflow(),a)}a=this._minPadding=n.layout.autoPadding?a:0,this._updateLayout(a),i||LE(r,t=>{t.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(dk("z","_idx"));const{_active:o,_lastEvent:s}=this;s?this._eventHandler(s,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){LE(this.scales,t=>{fL.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);GE(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:r}of e){vk(t,i,"_removeElements"===n?-r:r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,n=e=>new Set(t.filter(t=>t[0]===e).map((t,e)=>e+","+t.splice(1).join(","))),i=n(0);for(let r=1;r<e;r++)if(!GE(i,n(r)))return;return Array.from(i).map(t=>t.split(",")).map(t=>({method:t[1],start:+t[2],count:+t[3]}))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;fL.update(this,this.width,this.height,t);const e=this.chartArea,n=e.width<=0||e.height<=0;this._layers=[],LE(this.boxes,t=>{n&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,e)=>{t._idx=e}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,n=this.data.datasets.length;e<n;++e)this._updateDataset(e,HE(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const n=this.getDatasetMeta(t),i={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(pI.has(this)?this.attached&&!pI.running(this)&&pI.start(this):(this.draw(),pk({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(t,e)}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,n=[];let i,r;for(i=0,r=e.length;i<r;++i){const r=e[i];t&&!r.visible||n.push(r)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,n={meta:t,index:t.index,cancelable:!0},i=hI(this,t);!1!==this.notifyPlugins("beforeDatasetDraw",n)&&(i&&QC(e,i),t.controller.draw(),i&&tP(e),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(t){return $C(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,n,i){const r=eL.modes[e];return"function"===typeof r?r(this,t,n,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],n=this._metasets;let i=n.filter(t=>t&&t._dataset===e).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=yP(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const n=this.getDatasetMeta(t);return"boolean"===typeof n.hidden?!n.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,n){const i=n?"show":"hide",r=this.getDatasetMeta(t),a=r.controller._resolveAnimations(void 0,i);VE(e)?(r.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),a.update(r,{visible:n}),this.update(e=>e.datasetIndex===t?i:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),pI.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),YC(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete gk[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(t,e,n)=>{t.offsetX=e,t.offsetY=n,this._eventHandler(t)};LE(this.options.events,t=>n(t,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(n,i)=>{t[n]&&(e.removeEventListener(this,n,i),delete t[n])},r=(t,e)=>{this.canvas&&this.resize(t,e)};let a;const o=()=>{i("attach",o),this.attached=!0,this.resize(),n("resize",r),n("detach",a)};a=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),n("attach",o)},e.isAttached(this.canvas)?o():a()}unbindEvents(){LE(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},LE(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,n){const i=n?"set":"remove";let r,a,o,s;for("dataset"===e&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),o=0,s=t.length;o<s;++o){a=t[o];const e=a&&this.getDatasetMeta(a.datasetIndex).controller;e&&e[i+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],n=t.map(t=>{let{datasetIndex:e,index:n}=t;const i=this.getDatasetMeta(e);if(!i)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:i.data[n],index:n}});!kE(n,e)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,e))}notifyPlugins(t,e,n){return this._plugins.notify(this,t,e,n)}isPluginEnabled(t){return 1===this._plugins._cache.filter(e=>e.plugin.id===t).length}_updateHoverStyles(t,e,n){const i=this.options.hover,r=(t,e)=>t.filter(t=>!e.some(e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)),a=r(e,t),o=n?t:r(t,e);a.length&&this.updateHoverStyle(a,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(t,e){const n={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const r=this._handleEvent(t,e,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(r||n.changed)&&this.render(),this}_handleEvent(t,e,n){const{_active:i=[],options:r}=this,a=e,o=this._getActiveElements(t,i,n,a),s=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,n,i){return n&&"mouseout"!==t.type?i?e:t:null}(t,this._lastEvent,n,s);n&&(this._lastEvent=null,IE(r.onHover,[t,o,this],this),s&&IE(r.onClick,[t,o,this],this));const c=!kE(o,i);return(c||e)&&(this._active=o,this._updateHoverStyles(o,i,e)),this._lastEvent=l,c}_getActiveElements(t,e,n,i){if("mouseout"===t.type)return[];if(!n)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}function bk(){return LE(_k.instances,t=>t._plugins.invalidate())}function xk(t,e,n,i){const r=hP(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const a=(n-e)/2,o=Math.min(a,i*e/2),s=t=>{const e=(n-Math.min(a,t))*i/2;return pC(t,0,Math.min(a,e))};return{outerStart:s(r.outerStart),outerEnd:s(r.outerEnd),innerStart:pC(r.innerStart,0,o),innerEnd:pC(r.innerEnd,0,o)}}function wk(t,e,n,i){return{x:n+t*Math.cos(e),y:i+t*Math.sin(e)}}function Sk(t,e,n,i,r,a){const{x:o,y:s,startAngle:l,pixelMargin:c,innerRadius:u}=e,h=Math.max(e.outerRadius+i+n-c,0),d=u>0?u+i+n+c:0;let p=0;const f=r-l;if(i){const t=((u>0?u-i:0)+(h>0?h-i:0))/2;p=(f-(0!==t?f*t/(t+i):f))/2}const m=(f-Math.max(.001,f*h-n/WE)/h)/2,g=l+m+p,y=r-m-p,{outerStart:v,outerEnd:_,innerStart:b,innerEnd:x}=xk(e,d,h,y-g),w=h-v,S=h-_,M=g+v/w,T=y-_/S,A=d+b,E=d+x,C=g+b/A,P=y-x/E;if(t.beginPath(),a){const e=(M+T)/2;if(t.arc(o,s,h,M,e),t.arc(o,s,h,e,T),_>0){const e=wk(S,T,o,s);t.arc(e.x,e.y,_,T,y+KE)}const n=wk(E,y,o,s);if(t.lineTo(n.x,n.y),x>0){const e=wk(E,P,o,s);t.arc(e.x,e.y,x,y+KE,P+Math.PI)}const i=(y-x/d+(g+b/d))/2;if(t.arc(o,s,d,y-x/d,i,!0),t.arc(o,s,d,i,g+b/d,!0),b>0){const e=wk(A,C,o,s);t.arc(e.x,e.y,b,C+Math.PI,g-KE)}const r=wk(w,g,o,s);if(t.lineTo(r.x,r.y),v>0){const e=wk(w,M,o,s);t.arc(e.x,e.y,v,g-KE,M)}}else{t.moveTo(o,s);const e=Math.cos(M)*h+o,n=Math.sin(M)*h+s;t.lineTo(e,n);const i=Math.cos(T)*h+o,r=Math.sin(T)*h+s;t.lineTo(i,r)}t.closePath()}function Mk(t,e,n,i,r){const{fullCircles:a,startAngle:o,circumference:s,options:l}=e,{borderWidth:c,borderJoinStyle:u,borderDash:h,borderDashOffset:d,borderRadius:p}=l,f="inner"===l.borderAlign;if(!c)return;t.setLineDash(h||[]),t.lineDashOffset=d,f?(t.lineWidth=2*c,t.lineJoin=u||"round"):(t.lineWidth=c,t.lineJoin=u||"bevel");let m=e.endAngle;if(a){Sk(t,e,n,i,m,r);for(let e=0;e<a;++e)t.stroke();isNaN(s)||(m=o+(s%qE||qE))}f&&function(t,e,n){const{startAngle:i,pixelMargin:r,x:a,y:o,outerRadius:s,innerRadius:l}=e;let c=r/s;t.beginPath(),t.arc(a,o,s,i-c,n+c),l>r?(c=r/l,t.arc(a,o,l,n+c,i-c,!0)):t.arc(a,o,r,n+KE,i-KE),t.closePath(),t.clip()}(t,e,m),l.selfJoin&&m-o>=WE&&0===p&&"miter"!==u&&function(t,e,n){const{startAngle:i,x:r,y:a,outerRadius:o,innerRadius:s,options:l}=e,{borderWidth:c,borderJoinStyle:u}=l,h=Math.min(c/o,hC(i-n));if(t.beginPath(),t.arc(r,a,o-c/2,i+h/2,n-h/2),s>0){const e=Math.min(c/s,hC(i-n));t.arc(r,a,s+c/2,n-e/2,i+e/2,!0)}else{const e=Math.min(c/2,o*hC(i-n));if("round"===u)t.arc(r,a,e,n-WE/2,i+WE/2,!0);else if("bevel"===u){const o=2*e*e,s=-o*Math.cos(n+WE/2)+r,l=-o*Math.sin(n+WE/2)+a,c=o*Math.cos(i+WE/2)+r,u=o*Math.sin(i+WE/2)+a;t.lineTo(s,l),t.lineTo(c,u)}}t.closePath(),t.moveTo(0,0),t.rect(0,0,t.canvas.width,t.canvas.height),t.clip("evenodd")}(t,e,m),a||(Sk(t,e,n,i,m,r),t.stroke())}(0,It.A)(_k,"defaults",WC),(0,It.A)(_k,"instances",gk),(0,It.A)(_k,"overrides",UC),(0,It.A)(_k,"registry",WL),(0,It.A)(_k,"version","4.5.0"),(0,It.A)(_k,"getChart",yk);class Tk extends kL{constructor(t){super(),(0,It.A)(this,"circumference",void 0),(0,It.A)(this,"endAngle",void 0),(0,It.A)(this,"fullCircles",void 0),(0,It.A)(this,"innerRadius",void 0),(0,It.A)(this,"outerRadius",void 0),(0,It.A)(this,"pixelMargin",void 0),(0,It.A)(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.getProps(["x","y"],n),{angle:r,distance:a}=lC(i,{x:t,y:e}),{startAngle:o,endAngle:s,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),h=(this.options.spacing+this.options.borderWidth)/2,d=CE(u,s-o),p=dC(r,o,s)&&o!==s,f=d>=qE||p,m=fC(a,l+h,c+h);return f&&m}getCenterPoint(t){const{x:e,y:n,startAngle:i,endAngle:r,innerRadius:a,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:s,spacing:l}=this.options,c=(i+r)/2,u=(a+o+l+s)/2;return{x:e+Math.cos(c)*u,y:n+Math.sin(c)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:n}=this,i=(e.offset||0)/4,r=(e.spacing||0)/2,a=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>qE?Math.floor(n/qE):0,0===n||this.innerRadius<0||this.outerRadius<0)return;t.save();const o=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(o)*i,Math.sin(o)*i);const s=i*(1-Math.sin(Math.min(WE,n||0)));t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,function(t,e,n,i,r){const{fullCircles:a,startAngle:o,circumference:s}=e;let l=e.endAngle;if(a){Sk(t,e,n,i,l,r);for(let e=0;e<a;++e)t.fill();isNaN(s)||(l=o+(s%qE||qE))}Sk(t,e,n,i,l,r),t.fill()}(t,this,s,r,a),Mk(t,this,s,r,a),t.restore()}}function Ak(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;t.lineCap=CE(n.borderCapStyle,e.borderCapStyle),t.setLineDash(CE(n.borderDash,e.borderDash)),t.lineDashOffset=CE(n.borderDashOffset,e.borderDashOffset),t.lineJoin=CE(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=CE(n.borderWidth,e.borderWidth),t.strokeStyle=CE(n.borderColor,e.borderColor)}function Ek(t,e,n){t.lineTo(n.x,n.y)}function Ck(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.length,{start:r=0,end:a=i-1}=n,{start:o,end:s}=e,l=Math.max(r,o),c=Math.min(a,s),u=r<o&&a<o||r>s&&a>s;return{count:i,start:l,loop:e.loop,ilen:c<l&&!u?i+c-l:c-l}}function Pk(t,e,n,i){const{points:r,options:a}=e,{count:o,start:s,loop:l,ilen:c}=Ck(r,n,i),u=function(t){return t.stepped?eP:t.tension||"monotone"===t.cubicInterpolationMode?nP:Ek}(a);let h,d,p,{move:f=!0,reverse:m}=i||{};for(h=0;h<=c;++h)d=r[(s+(m?c-h:h))%o],d.skip||(f?(t.moveTo(d.x,d.y),f=!1):u(t,p,d,m,a.stepped),p=d);return l&&(d=r[(s+(m?c:0))%o],u(t,p,d,m,a.stepped)),!!l}function Ik(t,e,n,i){const r=e.points,{count:a,start:o,ilen:s}=Ck(r,n,i),{move:l=!0,reverse:c}=i||{};let u,h,d,p,f,m,g=0,y=0;const v=t=>(o+(c?s-t:t))%a,_=()=>{p!==f&&(t.lineTo(g,f),t.lineTo(g,p),t.lineTo(g,m))};for(l&&(h=r[v(0)],t.moveTo(h.x,h.y)),u=0;u<=s;++u){if(h=r[v(u)],h.skip)continue;const e=h.x,n=h.y,i=0|e;i===d?(n<p?p=n:n>f&&(f=n),g=(y*g+e)/++y):(_(),t.lineTo(e,n),d=i,y=0,p=f=n),m=n}_()}function Lk(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&"monotone"!==e.cubicInterpolationMode&&!e.stepped&&!n?Ik:Pk}(0,It.A)(Tk,"id","arc"),(0,It.A)(Tk,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),(0,It.A)(Tk,"defaultRoutes",{backgroundColor:"backgroundColor"}),(0,It.A)(Tk,"descriptors",{_scriptable:!0,_indexable:t=>"borderDash"!==t});const kk="function"===typeof Path2D;function Rk(t,e,n,i){kk&&!e.options.segment?function(t,e,n,i){let r=e._path;r||(r=e._path=new Path2D,e.path(r,n,i)&&r.closePath()),Ak(t,e.options),t.stroke(r)}(t,e,n,i):function(t,e,n,i){const{segments:r,options:a}=e,o=Lk(e);for(const s of r)Ak(t,a,s.style),t.beginPath(),o(t,e,s,{start:n,end:n+i-1})&&t.closePath(),t.stroke()}(t,e,n,i)}class Dk extends kL{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;OP(this._points,n,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const n=t.points,i=t.options.spanGaps,r=n.length;if(!r)return[];const a=!!t._loop,{start:o,end:s}=function(t,e,n,i){let r=0,a=e-1;if(n&&!i)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,n&&(a+=r);a>r&&t[a%e].skip;)a--;return a%=e,{start:r,end:a}}(n,r,a,i);return sI(t,!0===i?[{start:o,end:s,loop:a}]:function(t,e,n,i){const r=t.length,a=[];let o,s=e,l=t[e];for(o=e+1;o<=n;++o){const n=t[o%r];n.skip||n.stop?l.skip||(i=!1,a.push({start:e%r,end:(o-1)%r,loop:i}),e=s=n.stop?o:null):(s=o,l.skip&&(e=o)),l=n}return null!==s&&a.push({start:e%r,end:s%r,loop:i}),a}(n,o,s<o?s+r:s,!!t._fullLoop&&0===o&&s===r-1),n,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}interpolate(t,e){const n=this.options,i=t[e],r=this.points,a=oI(this,{property:e,start:i,end:i});if(!a.length)return;const o=[],s=function(t){return t.stepped?$P:t.tension||"monotone"===t.cubicInterpolationMode?QP:JP}(n);let l,c;for(l=0,c=a.length;l<c;++l){const{start:c,end:u}=a[l],h=r[c],d=r[u];if(h===d){o.push(h);continue}const p=s(h,d,Math.abs((i-h[e])/(d[e]-h[e])),n.stepped);p[e]=t[e],o.push(p)}return 1===o.length?o[0]:o}pathSegment(t,e,n){return Lk(this)(t,this,e,n)}path(t,e,n){const i=this.segments,r=Lk(this);let a=this._loop;e=e||0,n=n||this.points.length-e;for(const o of i)a&=r(t,this,o,{start:e,end:e+n-1});return!!a}draw(t,e,n,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),Rk(t,this,n,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Nk(t,e,n,i){const r=t.options,{[n]:a}=t.getProps([n],i);return Math.abs(e-a)<r.radius+r.hitRadius}(0,It.A)(Dk,"id","line"),(0,It.A)(Dk,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),(0,It.A)(Dk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),(0,It.A)(Dk,"descriptors",{_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t});class zk extends kL{constructor(t){super(),(0,It.A)(this,"parsed",void 0),(0,It.A)(this,"skip",void 0),(0,It.A)(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.options,{x:r,y:a}=this.getProps(["x","y"],n);return Math.pow(t-r,2)+Math.pow(e-a,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,e){return Nk(this,t,"x",e)}inYRange(t,e){return Nk(this,t,"y",e)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const n=this.options;this.skip||n.radius<.1||!$C(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,KC(t,n,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function Fk(t,e){const{x:n,y:i,base:r,width:a,height:o}=t.getProps(["x","y","base","width","height"],e);let s,l,c,u,h;return t.horizontal?(h=o/2,s=Math.min(n,r),l=Math.max(n,r),c=i-h,u=i+h):(h=a/2,s=n-h,l=n+h,c=Math.min(i,r),u=Math.max(i,r)),{left:s,top:c,right:l,bottom:u}}function Ok(t,e,n,i){return t?0:pC(e,n,i)}function Bk(t){const e=Fk(t),n=e.right-e.left,i=e.bottom-e.top,r=function(t,e,n){const i=t.options.borderWidth,r=t.borderSkipped,a=dP(i);return{t:Ok(r.top,a.top,0,n),r:Ok(r.right,a.right,0,e),b:Ok(r.bottom,a.bottom,0,n),l:Ok(r.left,a.left,0,e)}}(t,n/2,i/2),a=function(t,e,n){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),r=t.options.borderRadius,a=pP(r),o=Math.min(e,n),s=t.borderSkipped,l=i||TE(r);return{topLeft:Ok(!l||s.top||s.left,a.topLeft,0,o),topRight:Ok(!l||s.top||s.right,a.topRight,0,o),bottomLeft:Ok(!l||s.bottom||s.left,a.bottomLeft,0,o),bottomRight:Ok(!l||s.bottom||s.right,a.bottomRight,0,o)}}(t,n/2,i/2);return{outer:{x:e.left,y:e.top,w:n,h:i,radius:a},inner:{x:e.left+r.l,y:e.top+r.t,w:n-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,a.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(r.b,r.r))}}}}function Uk(t,e,n,i){const r=null===e,a=null===n,o=t&&!(r&&a)&&Fk(t,i);return o&&(r||fC(e,o.left,o.right))&&(a||fC(n,o.top,o.bottom))}function jk(t,e){t.rect(e.x,e.y,e.w,e.h)}function Vk(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.x!==n.x?-e:0,r=t.y!==n.y?-e:0,a=(t.x+t.w!==n.x+n.w?e:0)-i,o=(t.y+t.h!==n.y+n.h?e:0)-r;return{x:t.x+i,y:t.y+r,w:t.w+a,h:t.h+o,radius:t.radius}}(0,It.A)(zk,"id","point"),(0,It.A)(zk,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),(0,It.A)(zk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class Hk extends kL{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:n,backgroundColor:i}}=this,{inner:r,outer:a}=Bk(this),o=(s=a.radius).topLeft||s.topRight||s.bottomLeft||s.bottomRight?oP:jk;var s;t.save(),a.w===r.w&&a.h===r.h||(t.beginPath(),o(t,Vk(a,e,r)),t.clip(),o(t,Vk(r,-e,a)),t.fillStyle=n,t.fill("evenodd")),t.beginPath(),o(t,Vk(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,n){return Uk(this,t,e,n)}inXRange(t,e){return Uk(this,t,null,e)}inYRange(t,e){return Uk(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?n:(n+i)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}(0,It.A)(Hk,"id","bar"),(0,It.A)(Hk,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),(0,It.A)(Hk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Gk(t,e,n,i){if(i)return;let r=e[t],a=n[t];return"angle"===t&&(r=hC(r),a=hC(a)),{property:t,start:r,end:a}}function Wk(t,e,n){for(;e>t;e--){const t=n[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function qk(t,e,n,i){return t&&e?i(t[n],e[n]):t?t[n]:e?e[n]:0}function Zk(t,e){let n=[],i=!1;return ME(t)?(i=!0,n=t):n=function(t,e){const{x:n=null,y:i=null}=t||{},r=e.points,a=[];return e.segments.forEach(t=>{let{start:e,end:o}=t;o=Wk(e,o,r);const s=r[e],l=r[o];null!==i?(a.push({x:s.x,y:i}),a.push({x:l.x,y:i})):null!==n&&(a.push({x:n,y:s.y}),a.push({x:n,y:l.y}))}),a}(t,e),n.length?new Dk({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function Xk(t){return t&&!1!==t.fill}function Yk(t,e,n){let i=t[e].fill;const r=[e];let a;if(!n)return i;for(;!1!==i&&-1===r.indexOf(i);){if(!AE(i))return i;if(a=t[i],!a)return!1;if(a.visible)return i;r.push(i),i=a.fill}return!1}function Kk(t,e,n){const i=function(t){const e=t.options,n=e.fill;let i=CE(n&&n.target,n);void 0===i&&(i=!!e.backgroundColor);if(!1===i||null===i)return!1;if(!0===i)return"origin";return i}(t);if(TE(i))return!isNaN(i.value)&&i;let r=parseFloat(i);return AE(r)&&Math.floor(r)===r?function(t,e,n,i){"-"!==t&&"+"!==t||(n=e+n);if(n===e||n<0||n>=i)return!1;return n}(i[0],e,r,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Jk(t,e,n){const i=[];for(let r=0;r<n.length;r++){const a=n[r],{first:o,last:s,point:l}=$k(a,e,"x");if(!(!l||o&&s))if(o)i.unshift(l);else if(t.push(l),!s)break}t.push(...i)}function $k(t,e,n){const i=t.interpolate(e,n);if(!i)return{};const r=i[n],a=t.segments,o=t.points;let s=!1,l=!1;for(let c=0;c<a.length;c++){const t=a[c],e=o[t.start][n],i=o[t.end][n];if(fC(r,e,i)){s=r===e,l=r===i;break}}return{first:s,last:l,point:i}}class Qk{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,n){const{x:i,y:r,radius:a}=this;return e=e||{start:0,end:qE},t.arc(i,r,a,e.end,e.start,!0),!n.bounds}interpolate(t){const{x:e,y:n,radius:i}=this,r=t.angle;return{x:e+Math.cos(r)*i,y:n+Math.sin(r)*i,angle:r}}}function tR(t){const{chart:e,fill:n,line:i}=t;if(AE(n))return function(t,e){const n=t.getDatasetMeta(e),i=n&&t.isDatasetVisible(e);return i?n.dataset:null}(e,n);if("stack"===n)return function(t){const{scale:e,index:n,line:i}=t,r=[],a=i.segments,o=i.points,s=function(t,e){const n=[],i=t.getMatchingVisibleMetas("line");for(let r=0;r<i.length;r++){const t=i[r];if(t.index===e)break;t.hidden||n.unshift(t.dataset)}return n}(e,n);s.push(Zk({x:null,y:e.bottom},i));for(let l=0;l<a.length;l++){const t=a[l];for(let e=t.start;e<=t.end;e++)Jk(r,o[e],s)}return new Dk({points:r,options:{}})}(t);if("shape"===n)return!0;const r=function(t){const e=t.scale||{};if(e.getPointPositionForValue)return function(t){const{scale:e,fill:n}=t,i=e.options,r=e.getLabels().length,a=i.reverse?e.max:e.min,o=function(t,e,n){let i;return i="start"===t?n:"end"===t?e.options.reverse?e.min:e.max:TE(t)?t.value:e.getBaseValue(),i}(n,e,a),s=[];if(i.grid.circular){const t=e.getPointPositionForValue(0,a);return new Qk({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(o)})}for(let l=0;l<r;++l)s.push(e.getPointPositionForValue(l,o));return s}(t);return function(t){const{scale:e={},fill:n}=t,i=function(t,e){let n=null;return"start"===t?n=e.bottom:"end"===t?n=e.top:TE(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}(n,e);if(AE(i)){const t=e.isHorizontal();return{x:t?i:null,y:t?null:i}}return null}(t)}(t);return r instanceof Qk?r:Zk(r,i)}function eR(t,e,n){const i=tR(e),{chart:r,index:a,line:o,scale:s,axis:l}=e,c=o.options,u=c.fill,h=c.backgroundColor,{above:d=h,below:p=h}=u||{},f=r.getDatasetMeta(a),m=hI(r,f);i&&o.points.length&&(QC(t,n),function(t,e){const{line:n,target:i,above:r,below:a,area:o,scale:s,clip:l}=e,c=n._loop?"angle":e.axis;t.save();let u=a;a!==r&&("x"===c?(nR(t,i,o.top),rR(t,{line:n,target:i,color:r,scale:s,property:c,clip:l}),t.restore(),t.save(),nR(t,i,o.bottom)):"y"===c&&(iR(t,i,o.left),rR(t,{line:n,target:i,color:a,scale:s,property:c,clip:l}),t.restore(),t.save(),iR(t,i,o.right),u=r));rR(t,{line:n,target:i,color:u,scale:s,property:c,clip:l}),t.restore()}(t,{line:o,target:i,above:d,below:p,area:n,scale:s,axis:l,clip:m}),tP(t))}function nR(t,e,n){const{segments:i,points:r}=e;let a=!0,o=!1;t.beginPath();for(const s of i){const{start:i,end:l}=s,c=r[i],u=r[Wk(i,l,r)];a?(t.moveTo(c.x,c.y),a=!1):(t.lineTo(c.x,n),t.lineTo(c.x,c.y)),o=!!e.pathSegment(t,s,{move:o}),o?t.closePath():t.lineTo(u.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function iR(t,e,n){const{segments:i,points:r}=e;let a=!0,o=!1;t.beginPath();for(const s of i){const{start:i,end:l}=s,c=r[i],u=r[Wk(i,l,r)];a?(t.moveTo(c.x,c.y),a=!1):(t.lineTo(n,c.y),t.lineTo(c.x,c.y)),o=!!e.pathSegment(t,s,{move:o}),o?t.closePath():t.lineTo(n,u.y)}t.lineTo(n,e.first().y),t.closePath(),t.clip()}function rR(t,e){const{line:n,target:i,property:r,color:a,scale:o,clip:s}=e,l=function(t,e,n){const i=t.segments,r=t.points,a=e.points,o=[];for(const s of i){let{start:t,end:i}=s;i=Wk(t,i,r);const l=Gk(n,r[t],r[i],s.loop);if(!e.segments){o.push({source:s,target:l,start:r[t],end:r[i]});continue}const c=oI(e,l);for(const e of c){const t=Gk(n,a[e.start],a[e.end],e.loop),i=aI(s,r,t);for(const r of i)o.push({source:r,target:e,start:{[n]:qk(l,t,"start",Math.max)},end:{[n]:qk(l,t,"end",Math.min)}})}}return o}(n,i,r);for(const{source:c,target:u,start:h,end:d}of l){const{style:{backgroundColor:e=a}={}}=c,l=!0!==i;t.save(),t.fillStyle=e,aR(t,o,s,l&&Gk(r,h,d)),t.beginPath();const p=!!n.pathSegment(t,c);let f;if(l){p?t.closePath():oR(t,i,d,r);const e=!!i.pathSegment(t,u,{move:p,reverse:!0});f=p&&e,f||oR(t,i,h,r)}t.closePath(),t.fill(f?"evenodd":"nonzero"),t.restore()}}function aR(t,e,n,i){const r=e.chart.chartArea,{property:a,start:o,end:s}=i||{};if("x"===a||"y"===a){let e,i,l,c;"x"===a?(e=o,i=r.top,l=s,c=r.bottom):(e=r.left,i=o,l=r.right,c=s),t.beginPath(),n&&(e=Math.max(e,n.left),l=Math.min(l,n.right),i=Math.max(i,n.top),c=Math.min(c,n.bottom)),t.rect(e,i,l-e,c-i),t.clip()}}function oR(t,e,n,i){const r=e.interpolate(n,i);r&&t.lineTo(r.x,r.y)}var sR={id:"filler",afterDatasetsUpdate(t,e,n){const i=(t.data.datasets||[]).length,r=[];let a,o,s,l;for(o=0;o<i;++o)a=t.getDatasetMeta(o),s=a.dataset,l=null,s&&s.options&&s instanceof Dk&&(l={visible:t.isDatasetVisible(o),index:o,fill:Kk(s,o,i),chart:t,axis:a.controller.options.indexAxis,scale:a.vScale,line:s}),a.$filler=l,r.push(l);for(o=0;o<i;++o)l=r[o],l&&!1!==l.fill&&(l.fill=Yk(r,o,n.propagate))},beforeDraw(t,e,n){const i="beforeDraw"===n.drawTime,r=t.getSortedVisibleDatasetMetas(),a=t.chartArea;for(let o=r.length-1;o>=0;--o){const e=r[o].$filler;e&&(e.line.updateControlPoints(a,e.axis),i&&e.fill&&eR(t.ctx,e,a))}},beforeDatasetsDraw(t,e,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=t.getSortedVisibleDatasetMetas();for(let r=i.length-1;r>=0;--r){const e=i[r].$filler;Xk(e)&&eR(t.ctx,e,t.chartArea)}},beforeDatasetDraw(t,e,n){const i=e.meta.$filler;Xk(i)&&"beforeDatasetDraw"===n.drawTime&&eR(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const lR=(t,e)=>{let{boxHeight:n=e,boxWidth:i=e}=t;return t.usePointStyle&&(n=Math.min(n,e),i=t.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(e,n)}};class cR extends kL{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=IE(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(e=>t.filter(e,this.chart.data))),t.sort&&(e=e.sort((e,n)=>t.sort(e,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const n=t.labels,i=mP(n.font),r=i.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:s}=lR(n,r);let l,c;e.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(a,r,o,s)+10):(c=this.maxHeight,l=this._fitCols(a,i,o,s)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(c,t.maxHeight||this.maxHeight)}_fitRows(t,e,n,i){const{ctx:r,maxWidth:a,options:{labels:{padding:o}}}=this,s=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+o;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach((t,p)=>{const f=n+e/2+r.measureText(t.text).width;(0===p||l[l.length-1]+f+2*o>a)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),s[p]={left:0,top:d,row:h,width:f,height:i},l[l.length-1]+=f+o}),u}_fitCols(t,e,n,i){const{ctx:r,maxHeight:a,options:{labels:{padding:o}}}=this,s=this.legendHitBoxes=[],l=this.columnSizes=[],c=a-t;let u=o,h=0,d=0,p=0,f=0;return this.legendItems.forEach((t,a)=>{const{itemWidth:m,itemHeight:g}=function(t,e,n,i,r){const a=function(t,e,n,i){let r=t.text;r&&"string"!==typeof r&&(r=r.reduce((t,e)=>t.length>e.length?t:e));return e+n.size/2+i.measureText(r).width}(i,t,e,n),o=function(t,e,n){let i=t;"string"!==typeof e.text&&(i=uR(e,n));return i}(r,i,e.lineHeight);return{itemWidth:a,itemHeight:o}}(n,e,r,t,i);a>0&&d+g+2*o>c&&(u+=h+o,l.push({width:h,height:d}),p+=h+o,f++,h=d=0),s[a]={left:p,top:d,col:f,width:m,height:g},h=Math.max(h,m),d+=g+o}),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:n,labels:{padding:i},rtl:r}}=this,a=tI(r,this.left,this.width);if(this.isHorizontal()){let r=0,o=MC(n,this.left+i,this.right-this.lineWidths[r]);for(const s of e)r!==s.row&&(r=s.row,o=MC(n,this.left+i,this.right-this.lineWidths[r])),s.top+=this.top+t+i,s.left=a.leftForLtr(a.x(o),s.width),o+=s.width+i}else{let r=0,o=MC(n,this.top+t+i,this.bottom-this.columnSizes[r].height);for(const s of e)s.col!==r&&(r=s.col,o=MC(n,this.top+t+i,this.bottom-this.columnSizes[r].height)),s.top=o,s.left+=this.left+i,s.left=a.leftForLtr(a.x(s.left),s.width),o+=s.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;QC(t,this),this._draw(),tP(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:n,ctx:i}=this,{align:r,labels:a}=t,o=WC.color,s=tI(t.rtl,this.left,this.width),l=mP(a.font),{padding:c}=a,u=l.size,h=u/2;let d;this.drawTitle(),i.textAlign=s.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=lR(a,u),g=this.isHorizontal(),y=this._computeTitleHeight();d=g?{x:MC(r,this.left+c,this.right-n[0]),y:this.top+c+y,line:0}:{x:this.left+c,y:MC(r,this.top+y+c,this.bottom-e[0].height),line:0},eI(this.ctx,t.textDirection);const v=m+c;this.legendItems.forEach((_,b)=>{i.strokeStyle=_.fontColor,i.fillStyle=_.fontColor;const x=i.measureText(_.text).width,w=s.textAlign(_.textAlign||(_.textAlign=a.textAlign)),S=p+h+x;let M=d.x,T=d.y;s.setWidth(this.width),g?b>0&&M+S+c>this.right&&(T=d.y+=v,d.line++,M=d.x=MC(r,this.left+c,this.right-n[d.line])):b>0&&T+v>this.bottom&&(M=d.x=M+e[d.line].width+c,d.line++,T=d.y=MC(r,this.top+y+c,this.bottom-e[d.line].height));if(function(t,e,n){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;i.save();const r=CE(n.lineWidth,1);if(i.fillStyle=CE(n.fillStyle,o),i.lineCap=CE(n.lineCap,"butt"),i.lineDashOffset=CE(n.lineDashOffset,0),i.lineJoin=CE(n.lineJoin,"miter"),i.lineWidth=r,i.strokeStyle=CE(n.strokeStyle,o),i.setLineDash(CE(n.lineDash,[])),a.usePointStyle){const o={radius:f*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:r},l=s.xPlus(t,p/2);JC(i,o,l,e+h,a.pointStyleWidth&&p)}else{const a=e+Math.max((u-f)/2,0),o=s.leftForLtr(t,p),l=pP(n.borderRadius);i.beginPath(),Object.values(l).some(t=>0!==t)?oP(i,{x:o,y:a,w:p,h:f,radius:l}):i.rect(o,a,p,f),i.fill(),0!==r&&i.stroke()}i.restore()}(s.x(M),T,_),M=((t,e,n,i)=>t===(i?"left":"right")?n:"center"===t?(e+n)/2:e)(w,M+p+h,g?M+S:this.right,t.rtl),function(t,e,n){aP(i,n.text,t,e+m/2,l,{strikethrough:n.hidden,textAlign:s.textAlign(n.textAlign)})}(s.x(M),T,_),g)d.x+=S+c;else if("string"!==typeof _.text){const t=l.lineHeight;d.y+=uR(_,t)+c}else d.y+=v}),nI(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,n=mP(e.font),i=fP(e.padding);if(!e.display)return;const r=tI(t.rtl,this.left,this.width),a=this.ctx,o=e.position,s=n.size/2,l=i.top+s;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=MC(t.align,u,this.right-h);else{const e=this.columnSizes.reduce((t,e)=>Math.max(t,e.height),0);c=l+MC(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=MC(o,u,u+h);a.textAlign=r.textAlign(SC(o)),a.textBaseline="middle",a.strokeStyle=e.color,a.fillStyle=e.color,a.font=n.string,aP(a,e.text,d,c,n)}_computeTitleHeight(){const t=this.options.title,e=mP(t.font),n=fP(t.padding);return t.display?e.lineHeight+n.height:0}_getLegendItemAt(t,e){let n,i,r;if(fC(t,this.left,this.right)&&fC(e,this.top,this.bottom))for(r=this.legendHitBoxes,n=0;n<r.length;++n)if(i=r[n],fC(t,i.left,i.left+i.width)&&fC(e,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(t){const e=this.options;if(!function(t,e){if(("mousemove"===t||"mouseout"===t)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const n=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const i=this._hoveredItem,r=((t,e)=>null!==t&&null!==e&&t.datasetIndex===e.datasetIndex&&t.index===e.index)(i,n);i&&!r&&IE(e.onLeave,[t,i,this],this),this._hoveredItem=n,n&&!r&&IE(e.onHover,[t,n,this],this)}else n&&IE(e.onClick,[t,n,this],this)}}function uR(t,e){return e*(t.text?t.text.length:0)}var hR={id:"legend",_element:cR,start(t,e,n){const i=t.legend=new cR({ctx:t.ctx,options:n,chart:t});fL.configure(t,i,n),fL.addBox(t,i)},stop(t){fL.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const i=t.legend;fL.configure(t,i,n),i.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const i=e.datasetIndex,r=n.chart;r.isDatasetVisible(i)?(r.hide(i),e.hidden=!0):(r.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:r,color:a,useBorderRadius:o,borderRadius:s}}=t.legend.options;return t._getSortedDatasetMetas().map(t=>{const l=t.controller.getStyle(n?0:void 0),c=fP(l.borderWidth);return{text:e[t.index].label,fillStyle:l.backgroundColor,fontColor:a,hidden:!t.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:o&&(s||l.borderRadius),datasetIndex:t.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class dR extends kL{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const i=ME(n.text)?n.text.length:1;this._padding=fP(n.padding);const r=i*mP(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:n,bottom:i,right:r,options:a}=this,o=a.align;let s,l,c,u=0;return this.isHorizontal()?(l=MC(o,n,r),c=e+t,s=r-n):("left"===a.position?(l=n+t,c=MC(o,i,e),u=-.5*WE):(l=r-t,c=MC(o,e,i),u=.5*WE),s=i-e),{titleX:l,titleY:c,maxWidth:s,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const n=mP(e.font),i=n.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:o,rotation:s}=this._drawArgs(i);aP(t,e.text,0,0,n,{color:e.color,maxWidth:o,rotation:s,textAlign:SC(e.align),textBaseline:"middle",translation:[r,a]})}}var pR={id:"title",_element:dR,start(t,e,n){!function(t,e){const n=new dR({ctx:t.ctx,options:e,chart:t});fL.configure(t,n,e),fL.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){const e=t.titleBlock;fL.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const i=t.titleBlock;fL.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;const fR={average(t){if(!t.length)return!1;let e,n,i=new Set,r=0,a=0;for(e=0,n=t.length;e<n;++e){const n=t[e].element;if(n&&n.hasValue()){const t=n.tooltipPosition();i.add(t.x),r+=t.y,++a}}if(0===a||0===i.size)return!1;const o=[...i].reduce((t,e)=>t+e)/i.size;return{x:o,y:r/a}},nearest(t,e){if(!t.length)return!1;let n,i,r,a=e.x,o=e.y,s=Number.POSITIVE_INFINITY;for(n=0,i=t.length;n<i;++n){const i=t[n].element;if(i&&i.hasValue()){const t=cC(e,i.getCenterPoint());t<s&&(s=t,r=i)}}if(r){const t=r.tooltipPosition();a=t.x,o=t.y}return{x:a,y:o}}};function mR(t,e){return e&&(ME(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function gR(t){return("string"===typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function yR(t,e){const{element:n,datasetIndex:i,index:r}=e,a=t.getDatasetMeta(i).controller,{label:o,value:s}=a.getLabelAndValue(r);return{chart:t,label:o,parsed:a.getParsed(r),raw:t.data.datasets[i].data[r],formattedValue:s,dataset:a.getDataset(),dataIndex:r,datasetIndex:i,element:n}}function vR(t,e){const n=t.chart.ctx,{body:i,footer:r,title:a}=t,{boxWidth:o,boxHeight:s}=e,l=mP(e.bodyFont),c=mP(e.titleFont),u=mP(e.footerFont),h=a.length,d=r.length,p=i.length,f=fP(e.padding);let m=f.height,g=0,y=i.reduce((t,e)=>t+e.before.length+e.lines.length+e.after.length,0);if(y+=t.beforeBody.length+t.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),y){m+=p*(e.displayColors?Math.max(s,l.lineHeight):l.lineHeight)+(y-p)*l.lineHeight+(y-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let v=0;const _=function(t){g=Math.max(g,n.measureText(t).width+v)};return n.save(),n.font=c.string,LE(t.title,_),n.font=l.string,LE(t.beforeBody.concat(t.afterBody),_),v=e.displayColors?o+2+e.boxPadding:0,LE(i,t=>{LE(t.before,_),LE(t.lines,_),LE(t.after,_)}),v=0,n.font=u.string,LE(t.footer,_),n.restore(),g+=f.width,{width:g,height:m}}function _R(t,e,n,i){const{x:r,width:a}=n,{width:o,chartArea:{left:s,right:l}}=t;let c="center";return"center"===i?c=r<=(s+l)/2?"left":"right":r<=a/2?c="left":r>=o-a/2&&(c="right"),function(t,e,n,i){const{x:r,width:a}=i,o=n.caretSize+n.caretPadding;return"left"===t&&r+a+o>e.width||"right"===t&&r-a-o<0||void 0}(c,t,e,n)&&(c="center"),c}function bR(t,e,n){const i=n.yAlign||e.yAlign||function(t,e){const{y:n,height:i}=e;return n<i/2?"top":n>t.height-i/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||_R(t,e,n,i),yAlign:i}}function xR(t,e,n,i){const{caretSize:r,caretPadding:a,cornerRadius:o}=t,{xAlign:s,yAlign:l}=n,c=r+a,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=pP(o);let f=function(t,e){let{x:n,width:i}=t;return"right"===e?n-=i:"center"===e&&(n-=i/2),n}(e,s);const m=function(t,e,n){let{y:i,height:r}=t;return"top"===e?i+=n:i-="bottom"===e?r+n:r/2,i}(e,l,c);return"center"===l?"left"===s?f+=c:"right"===s&&(f-=c):"left"===s?f-=Math.max(u,d)+r:"right"===s&&(f+=Math.max(h,p)+r),{x:pC(f,0,i.width-e.width),y:pC(m,0,i.height-e.height)}}function wR(t,e,n){const i=fP(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-i.right:t.x+i.left}function SR(t){return mR([],gR(t))}function MR(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}const TR={beforeTitle:xE,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return n[e.dataIndex]}return""},afterTitle:xE,beforeBody:xE,beforeLabel:xE,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return SE(n)||(e+=n),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:xE,afterBody:xE,beforeFooter:xE,footer:xE,afterFooter:xE};function AR(t,e,n,i){const r=t[e].call(n,i);return"undefined"===typeof r?TR[e].call(n,i):r}class ER extends kL{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&e.options.animation&&n.animations,r=new yI(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,n=this._tooltipItems,yP(t,{tooltip:e,tooltipItems:n,type:"tooltip"})));var t,e,n}getTitle(t,e){const{callbacks:n}=e,i=AR(n,"beforeTitle",this,t),r=AR(n,"title",this,t),a=AR(n,"afterTitle",this,t);let o=[];return o=mR(o,gR(i)),o=mR(o,gR(r)),o=mR(o,gR(a)),o}getBeforeBody(t,e){return SR(AR(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:n}=e,i=[];return LE(t,t=>{const e={before:[],lines:[],after:[]},r=MR(n,t);mR(e.before,gR(AR(r,"beforeLabel",this,t))),mR(e.lines,AR(r,"label",this,t)),mR(e.after,gR(AR(r,"afterLabel",this,t))),i.push(e)}),i}getAfterBody(t,e){return SR(AR(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:n}=e,i=AR(n,"beforeFooter",this,t),r=AR(n,"footer",this,t),a=AR(n,"afterFooter",this,t);let o=[];return o=mR(o,gR(i)),o=mR(o,gR(r)),o=mR(o,gR(a)),o}_createItems(t){const e=this._active,n=this.chart.data,i=[],r=[],a=[];let o,s,l=[];for(o=0,s=e.length;o<s;++o)l.push(yR(this.chart,e[o]));return t.filter&&(l=l.filter((e,i,r)=>t.filter(e,i,r,n))),t.itemSort&&(l=l.sort((e,i)=>t.itemSort(e,i,n))),LE(l,e=>{const n=MR(t.callbacks,e);i.push(AR(n,"labelColor",this,e)),r.push(AR(n,"labelPointStyle",this,e)),a.push(AR(n,"labelTextColor",this,e))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=a,this.dataPoints=l,l}update(t,e){const n=this.options.setContext(this.getContext()),i=this._active;let r,a=[];if(i.length){const t=fR[n.position].call(this,i,this._eventPosition);a=this._createItems(n),this.title=this.getTitle(a,n),this.beforeBody=this.getBeforeBody(a,n),this.body=this.getBody(a,n),this.afterBody=this.getAfterBody(a,n),this.footer=this.getFooter(a,n);const e=this._size=vR(this,n),o=Object.assign({},t,e),s=bR(this.chart,n,o),l=xR(n,o,s,this.chart);this.xAlign=s.xAlign,this.yAlign=s.yAlign,r={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=a,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,n,i){const r=this.getCaretPosition(t,n,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,n){const{xAlign:i,yAlign:r}=this,{caretSize:a,cornerRadius:o}=n,{topLeft:s,topRight:l,bottomLeft:c,bottomRight:u}=pP(o),{x:h,y:d}=t,{width:p,height:f}=e;let m,g,y,v,_,b;return"center"===r?(_=d+f/2,"left"===i?(m=h,g=m-a,v=_+a,b=_-a):(m=h+p,g=m+a,v=_-a,b=_+a),y=m):(g="left"===i?h+Math.max(s,c)+a:"right"===i?h+p-Math.max(l,u)-a:this.caretX,"top"===r?(v=d,_=v-a,m=g-a,y=g+a):(v=d+f,_=v+a,m=g+a,y=g-a),b=v),{x1:m,x2:g,x3:y,y1:v,y2:_,y3:b}}drawTitle(t,e,n){const i=this.title,r=i.length;let a,o,s;if(r){const l=tI(n.rtl,this.x,this.width);for(t.x=wR(this,n.titleAlign,n),e.textAlign=l.textAlign(n.titleAlign),e.textBaseline="middle",a=mP(n.titleFont),o=n.titleSpacing,e.fillStyle=n.titleColor,e.font=a.string,s=0;s<r;++s)e.fillText(i[s],l.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+o,s+1===r&&(t.y+=n.titleMarginBottom-o)}}_drawColorBox(t,e,n,i,r){const a=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:s,boxWidth:l}=r,c=mP(r.bodyFont),u=wR(this,"left",r),h=i.x(u),d=s<c.lineHeight?(c.lineHeight-s)/2:0,p=e.y+d;if(r.usePointStyle){const e={radius:Math.min(l,s)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=i.leftForLtr(h,l)+l/2,c=p+s/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,KC(t,e,n,c),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,KC(t,e,n,c)}else{t.lineWidth=TE(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const e=i.leftForLtr(h,l),n=i.leftForLtr(i.xPlus(h,1),l-2),o=pP(a.borderRadius);Object.values(o).some(t=>0!==t)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,oP(t,{x:e,y:p,w:l,h:s,radius:o}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),oP(t,{x:n,y:p+1,w:l-2,h:s-2,radius:o}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(e,p,l,s),t.strokeRect(e,p,l,s),t.fillStyle=a.backgroundColor,t.fillRect(n,p+1,l-2,s-2))}t.fillStyle=this.labelTextColors[n]}drawBody(t,e,n){const{body:i}=this,{bodySpacing:r,bodyAlign:a,displayColors:o,boxHeight:s,boxWidth:l,boxPadding:c}=n,u=mP(n.bodyFont);let h=u.lineHeight,d=0;const p=tI(n.rtl,this.x,this.width),f=function(n){e.fillText(n,p.x(t.x+d),t.y+h/2),t.y+=h+r},m=p.textAlign(a);let g,y,v,_,b,x,w;for(e.textAlign=a,e.textBaseline="middle",e.font=u.string,t.x=wR(this,m,n),e.fillStyle=n.bodyColor,LE(this.beforeBody,f),d=o&&"right"!==m?"center"===a?l/2+c:l+2+c:0,_=0,x=i.length;_<x;++_){for(g=i[_],y=this.labelTextColors[_],e.fillStyle=y,LE(g.before,f),v=g.lines,o&&v.length&&(this._drawColorBox(e,t,_,p,n),h=Math.max(u.lineHeight,s)),b=0,w=v.length;b<w;++b)f(v[b]),h=u.lineHeight;LE(g.after,f)}d=0,h=u.lineHeight,LE(this.afterBody,f),t.y-=r}drawFooter(t,e,n){const i=this.footer,r=i.length;let a,o;if(r){const s=tI(n.rtl,this.x,this.width);for(t.x=wR(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=s.textAlign(n.footerAlign),e.textBaseline="middle",a=mP(n.footerFont),e.fillStyle=n.footerColor,e.font=a.string,o=0;o<r;++o)e.fillText(i[o],s.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+n.footerSpacing}}drawBackground(t,e,n,i){const{xAlign:r,yAlign:a}=this,{x:o,y:s}=t,{width:l,height:c}=n,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=pP(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(o+u,s),"top"===a&&this.drawCaret(t,e,n,i),e.lineTo(o+l-h,s),e.quadraticCurveTo(o+l,s,o+l,s+h),"center"===a&&"right"===r&&this.drawCaret(t,e,n,i),e.lineTo(o+l,s+c-p),e.quadraticCurveTo(o+l,s+c,o+l-p,s+c),"bottom"===a&&this.drawCaret(t,e,n,i),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),"center"===a&&"left"===r&&this.drawCaret(t,e,n,i),e.lineTo(o,s+u),e.quadraticCurveTo(o,s,o+u,s),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,n=this.$animations,i=n&&n.x,r=n&&n.y;if(i||r){const n=fR[t.position].call(this,this._active,this._eventPosition);if(!n)return;const a=this._size=vR(this,t),o=Object.assign({},n,this._size),s=bR(e,t,o),l=xR(t,o,s,e);i._to===l.x&&r._to===l.y||(this.xAlign=s.xAlign,this.yAlign=s.yAlign,this.width=a.width,this.height=a.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const a=fP(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(r,t,i,e),eI(t,e.textDirection),r.y+=a.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),nI(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const n=this._active,i=t.map(t=>{let{datasetIndex:e,index:n}=t;const i=this.chart.getDatasetMeta(e);if(!i)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:i.data[n],index:n}}),r=!kE(n,i),a=this._positionChanged(i,e);(r||a)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],a=this._getActiveElements(t,r,e,n),o=this._positionChanged(a,t),s=e||!kE(a,r)||o;return s&&(this._active=a,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),s}_getActiveElements(t,e,n,i){const r=this.options;if("mouseout"===t.type)return[];if(!i)return e.filter(t=>this.chart.data.datasets[t.datasetIndex]&&void 0!==this.chart.getDatasetMeta(t.datasetIndex).controller.getParsed(t.index));const a=this.chart.getElementsAtEventForMode(t,r.mode,r,n);return r.reverse&&a.reverse(),a}_positionChanged(t,e){const{caretX:n,caretY:i,options:r}=this,a=fR[r.position].call(this,t,e);return!1!==a&&(n!==a.x||i!==a.y)}}(0,It.A)(ER,"positioners",fR);var CR={id:"tooltip",_element:ER,positioners:fR,afterInit(t,e,n){n&&(t.tooltip=new ER({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",kt(kt({},n),{},{cancelable:!0})))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:TR},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function PR(t,e,n,i){const r=t.indexOf(e);if(-1===r)return((t,e,n,i)=>("string"===typeof e?(n=t.push(e)-1,i.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,i);return r!==t.lastIndexOf(e)?n:r}function IR(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class LR extends VL{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:n,label:i}of e)t[n]===i&&t.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(SE(t))return null;const n=this.getLabels();return((t,e)=>null===t?null:pC(Math.round(t),0,e))(e=isFinite(e)&&n[e]===t?e:PR(n,t,CE(e,t),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(n=0),e||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const t=this.min,e=this.max,n=this.options.offset,i=[];let r=this.getLabels();r=0===t&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let a=t;a<=e;a++)i.push({value:a});return i}getLabelForValue(t){return IR.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!==typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function kR(t,e){const n=[],{bounds:i,step:r,min:a,max:o,precision:s,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=t,d=r||1,p=c-1,{min:f,max:m}=e,g=!SE(a),y=!SE(o),v=!SE(l),_=(m-f)/(u+1);let b,x,w,S,M=nC((m-f)/p/d)*d;if(M<1e-14&&!g&&!y)return[{value:f},{value:m}];S=Math.ceil(m/M)-Math.floor(f/M),S>p&&(M=nC(S*M/p/d)*d),SE(s)||(b=Math.pow(10,s),M=Math.ceil(M*b)/b),"ticks"===i?(x=Math.floor(f/M)*M,w=Math.ceil(m/M)*M):(x=f,w=m),g&&y&&r&&function(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((o-a)/r,M/1e3)?(S=Math.round(Math.min((o-a)/M,c)),M=(o-a)/S,x=a,w=o):v?(x=g?a:x,w=y?o:w,S=l-1,M=(w-x)/S):(S=(w-x)/M,S=eC(S,Math.round(S),M/1e3)?Math.round(S):Math.ceil(S));const T=Math.max(sC(M),sC(x));b=Math.pow(10,SE(s)?T:s),x=Math.round(x*b)/b,w=Math.round(w*b)/b;let A=0;for(g&&(h&&x!==a?(n.push({value:a}),x<a&&A++,eC(Math.round((x+A*M)*b)/b,a,RR(a,_,t))&&A++):x<a&&A++);A<S;++A){const t=Math.round((x+A*M)*b)/b;if(y&&t>o)break;n.push({value:t})}return y&&h&&w!==o?n.length&&eC(n[n.length-1].value,o,RR(o,_,t))?n[n.length-1].value=o:n.push({value:o}):y&&w!==o||n.push({value:w}),n}function RR(t,e,n){let{horizontal:i,minRotation:r}=n;const a=aC(r),o=(i?Math.sin(a):Math.cos(a))||.001,s=.75*e*(""+t).length;return Math.min(e/o,s)}(0,It.A)(LR,"id","category"),(0,It.A)(LR,"defaults",{ticks:{callback:IR}});class DR extends VL{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return SE(t)||("number"===typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:i,max:r}=this;const a=t=>i=e?i:t,o=t=>r=n?r:t;if(t){const t=tC(i),e=tC(r);t<0&&e<0?o(0):t>0&&e>0&&a(0)}if(i===r){let e=0===r?1:Math.abs(.05*r);o(r+e),t||a(i-e)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:n,stepSize:i}=t;return i?(e=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,e>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(e," ticks. Limiting to 1000.")),e=1e3)):(e=this.computeTickLimit(),n=n||11),n&&(e=Math.min(n,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=kR({maxTicks:n,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&rC(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const t=this.ticks;let e=this.min,n=this.max;if(super.configure(),this.options.offset&&t.length){const i=(n-e)/Math.max(t.length-1,1)/2;e-=i,n+=i}this._startValue=e,this._endValue=n,this._valueRange=n-e}getLabelForValue(t){return FC(t,this.chart.options.locale,this.options.ticks.format)}}class NR extends DR{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=AE(t)?t:0,this.max=AE(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,n=aC(this.options.ticks.minRotation),i=(t?Math.sin(n):Math.cos(n))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}(0,It.A)(NR,"id","linear"),(0,It.A)(NR,"defaults",{ticks:{callback:BC.formatters.numeric}});const zR=t=>Math.floor(QE(t)),FR=(t,e)=>Math.pow(10,zR(t)+e);function OR(t){return 1===t/Math.pow(10,zR(t))}function BR(t,e,n){const i=Math.pow(10,n),r=Math.floor(t/i);return Math.ceil(e/i)-r}function UR(t,e){let{min:n,max:i}=e;n=EE(t.min,n);const r=[],a=zR(n);let o=function(t,e){let n=zR(e-t);for(;BR(t,e,n)>10;)n++;for(;BR(t,e,n)<10;)n--;return Math.min(n,zR(t))}(n,i),s=o<0?Math.pow(10,Math.abs(o)):1;const l=Math.pow(10,o),c=a>o?Math.pow(10,a):0,u=Math.round((n-c)*s)/s,h=Math.floor((n-c)/l/10)*l*10;let d=Math.floor((u-h)/Math.pow(10,o)),p=EE(t.min,Math.round((c+h+d*Math.pow(10,o))*s)/s);for(;p<i;)r.push({value:p,major:OR(p),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(o++,d=2,s=o>=0?1:s),p=Math.round((c+h+d*Math.pow(10,o))*s)/s;const f=EE(t.max,p);return r.push({value:f,major:OR(f),significand:d}),r}class jR extends VL{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const n=DR.prototype.parse.apply(this,[t,e]);if(0!==n)return AE(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=AE(t)?Math.max(0,t):null,this.max=AE(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!AE(this._userMin)&&(this.min=t===FR(this.min,0)?FR(this.min,-1):FR(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let n=this.min,i=this.max;const r=e=>n=t?n:e,a=t=>i=e?i:t;n===i&&(n<=0?(r(1),a(10)):(r(FR(n,-1)),a(FR(i,1)))),n<=0&&r(FR(i,-1)),i<=0&&a(FR(n,1)),this.min=n,this.max=i}buildTicks(){const t=this.options,e=UR({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&rC(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":FC(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=QE(t),this._valueRange=QE(this.max)-QE(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(QE(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function VR(t){const e=t.ticks;if(e.display&&t.display){const t=fP(e.backdropPadding);return CE(e.font&&e.font.size,WC.font.size)+t.height}return 0}function HR(t,e,n){return n=ME(n)?n:[n],{w:ZC(t,e.string,n),h:n.length*e.lineHeight}}function GR(t,e,n,i,r){return t===i||t===r?{start:e-n/2,end:e+n/2}:t<i||t>r?{start:e-n,end:e}:{start:e,end:e+n}}function WR(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),i=[],r=[],a=t._pointLabels.length,o=t.options.pointLabels,s=o.centerPointLabels?WE/a:0;for(let l=0;l<a;l++){const a=o.setContext(t.getPointLabelContext(l));r[l]=a.padding;const c=t.getPointPosition(l,t.drawingArea+r[l],s),u=mP(a.font),h=HR(t.ctx,u,t._pointLabels[l]);i[l]=h;const d=hC(t.getIndexAngle(l)+s),p=Math.round(oC(d));qR(n,e,d,GR(p,c.x,h.w,0,180),GR(p,c.y,h.h,90,270))}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function(t,e,n){const i=[],r=t._pointLabels.length,a=t.options,{centerPointLabels:o,display:s}=a.pointLabels,l={extra:VR(a)/2,additionalAngle:o?WE/r:0};let c;for(let u=0;u<r;u++){l.padding=n[u],l.size=e[u];const r=ZR(t,u,l);i.push(r),"auto"===s&&(r.visible=XR(r,c),r.visible&&(c=r))}return i}(t,i,r)}function qR(t,e,n,i,r){const a=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let s=0,l=0;i.start<e.l?(s=(e.l-i.start)/a,t.l=Math.min(t.l,e.l-s)):i.end>e.r&&(s=(i.end-e.r)/a,t.r=Math.max(t.r,e.r+s)),r.start<e.t?(l=(e.t-r.start)/o,t.t=Math.min(t.t,e.t-l)):r.end>e.b&&(l=(r.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function ZR(t,e,n){const i=t.drawingArea,{extra:r,additionalAngle:a,padding:o,size:s}=n,l=t.getPointPosition(e,i+r+o,a),c=Math.round(oC(hC(l.angle+KE))),u=function(t,e,n){90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e);return t}(l.y,s.h,c),h=function(t){if(0===t||180===t)return"center";if(t<180)return"left";return"right"}(c),d=function(t,e,n){"right"===n?t-=e:"center"===n&&(t-=e/2);return t}(l.x,s.w,h);return{visible:!0,x:l.x,y:u,textAlign:h,left:d,top:u,right:d+s.w,bottom:u+s.h}}function XR(t,e){if(!e)return!0;const{left:n,top:i,right:r,bottom:a}=t;return!($C({x:n,y:i},e)||$C({x:n,y:a},e)||$C({x:r,y:i},e)||$C({x:r,y:a},e))}function YR(t,e,n){const{left:i,top:r,right:a,bottom:o}=n,{backdropColor:s}=e;if(!SE(s)){const n=pP(e.borderRadius),l=fP(e.backdropPadding);t.fillStyle=s;const c=i-l.left,u=r-l.top,h=a-i+l.width,d=o-r+l.height;Object.values(n).some(t=>0!==t)?(t.beginPath(),oP(t,{x:c,y:u,w:h,h:d,radius:n}),t.fill()):t.fillRect(c,u,h,d)}}function KR(t,e,n,i){const{ctx:r}=t;if(n)r.arc(t.xCenter,t.yCenter,e,0,qE);else{let n=t.getPointPosition(0,e);r.moveTo(n.x,n.y);for(let a=1;a<i;a++)n=t.getPointPosition(a,e),r.lineTo(n.x,n.y)}}(0,It.A)(jR,"id","logarithmic"),(0,It.A)(jR,"defaults",{ticks:{callback:BC.formatters.logarithmic,major:{enabled:!0}}});class JR extends DR{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=fP(VR(this.options)/2),e=this.width=this.maxWidth-t.width,n=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+n/2+t.top),this.drawingArea=Math.floor(Math.min(e,n)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=AE(t)&&!isNaN(t)?t:0,this.max=AE(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/VR(this.options))}generateTickLabels(t){DR.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((t,e)=>{const n=IE(this.options.pointLabels.callback,[t,e],this);return n||0===n?n:""}).filter((t,e)=>this.chart.getDataVisibility(e))}fit(){const t=this.options;t.display&&t.pointLabels.display?WR(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,n,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,n,i))}getIndexAngle(t){return hC(t*(qE/(this._pointLabels.length||1))+aC(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(SE(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(SE(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const n=e[t];return function(t,e,n){return yP(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}getPointPosition(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.getIndexAngle(t)-KE+n;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:n,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:n,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const n=this.ctx;n.save(),n.beginPath(),KR(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),n.closePath(),n.fillStyle=t,n.fill(),n.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:n,grid:i,border:r}=e,a=this._pointLabels.length;let o,s,l;if(e.pointLabels.display&&function(t,e){const{ctx:n,options:{pointLabels:i}}=t;for(let r=e-1;r>=0;r--){const e=t._pointLabelItems[r];if(!e.visible)continue;const a=i.setContext(t.getPointLabelContext(r));YR(n,a,e);const o=mP(a.font),{x:s,y:l,textAlign:c}=e;aP(n,t._pointLabels[r],s,l+o.lineHeight/2,o,{color:a.color,textAlign:c,textBaseline:"middle"})}}(this,a),i.display&&this.ticks.forEach((t,e)=>{if(0!==e||0===e&&this.min<0){s=this.getDistanceFromCenterForValue(t.value);const n=this.getContext(e),o=i.setContext(n),l=r.setContext(n);!function(t,e,n,i,r){const a=t.ctx,o=e.circular,{color:s,lineWidth:l}=e;!o&&!i||!s||!l||n<0||(a.save(),a.strokeStyle=s,a.lineWidth=l,a.setLineDash(r.dash||[]),a.lineDashOffset=r.dashOffset,a.beginPath(),KR(t,n,o,i),a.closePath(),a.stroke(),a.restore())}(this,o,s,a,l)}}),n.display){for(t.save(),o=a-1;o>=0;o--){const i=n.setContext(this.getPointLabelContext(o)),{color:r,lineWidth:a}=i;a&&r&&(t.lineWidth=a,t.strokeStyle=r,t.setLineDash(i.borderDash),t.lineDashOffset=i.borderDashOffset,s=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),l=this.getPointPosition(o,s),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,n=e.ticks;if(!n.display)return;const i=this.getIndexAngle(0);let r,a;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((i,o)=>{if(0===o&&this.min>=0&&!e.reverse)return;const s=n.setContext(this.getContext(o)),l=mP(s.font);if(r=this.getDistanceFromCenterForValue(this.ticks[o].value),s.showLabelBackdrop){t.font=l.string,a=t.measureText(i.label).width,t.fillStyle=s.backdropColor;const e=fP(s.backdropPadding);t.fillRect(-a/2-e.left,-r-l.size/2-e.top,a+e.width,l.size+e.height)}aP(t,i.label,0,-r,l,{color:s.color,strokeColor:s.textStrokeColor,strokeWidth:s.textStrokeWidth})}),t.restore()}drawTitle(){}}(0,It.A)(JR,"id","radialLinear"),(0,It.A)(JR,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:BC.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}}),(0,It.A)(JR,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),(0,It.A)(JR,"descriptors",{angleLines:{_fallback:"grid"}});const $R={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},QR=Object.keys($R);function tD(t,e){return t-e}function eD(t,e){if(SE(e))return null;const n=t._adapter,{parser:i,round:r,isoWeekday:a}=t._parseOpts;let o=e;return"function"===typeof i&&(o=i(o)),AE(o)||(o="string"===typeof i?n.parse(o,i):n.parse(o)),null===o?null:(r&&(o="week"!==r||!iC(a)&&!0!==a?n.startOf(o,r):n.startOf(o,"isoWeek",a)),+o)}function nD(t,e,n,i){const r=QR.length;for(let a=QR.indexOf(t);a<r-1;++a){const t=$R[QR[a]],r=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((n-e)/(r*t.size))<=i)return QR[a]}return QR[r-1]}function iD(t,e,n){if(n){if(n.length){const{lo:i,hi:r}=mC(n,e);t[n[i]>=e?n[i]:n[r]]=!0}}else t[e]=!0}function rD(t,e,n){const i=[],r={},a=e.length;let o,s;for(o=0;o<a;++o)s=e[o],r[s]=o,i.push({value:s,major:!1});return 0!==a&&n?function(t,e,n,i){const r=t._adapter,a=+r.startOf(e[0].value,i),o=e[e.length-1].value;let s,l;for(s=a;s<=o;s=+r.add(s,1,i))l=n[s],l>=0&&(e[l].major=!0);return e}(t,i,r,n):i}class aD extends VL{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.time||(t.time={}),i=this._adapter=new XI(t.adapters.date);i.init(e),FE(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:eD(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,n=t.time.unit||"day";let{min:i,max:r,minDefined:a,maxDefined:o}=this.getUserBounds();function s(t){a||isNaN(t.min)||(i=Math.min(i,t.min)),o||isNaN(t.max)||(r=Math.max(r,t.max))}a&&o||(s(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||s(this.getMinMax(!1))),i=AE(i)&&!isNaN(i)?i:+e.startOf(Date.now(),n),r=AE(r)&&!isNaN(r)?r:+e.endOf(Date.now(),n)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}buildTicks(){const t=this.options,e=t.time,n=t.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,a=function(t,e,n){let i=0,r=t.length;for(;i<r&&t[i]<e;)i++;for(;r>i&&t[r-1]>n;)r--;return i>0||r<t.length?t.slice(i,r):t}(i,r,this.max);return this._unit=e.unit||(n.autoSkip?nD(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(t,e,n,i,r){for(let a=QR.length-1;a>=QR.indexOf(n);a--){const n=QR[a];if($R[n].common&&t._adapter.diff(r,i,n)>=e-1)return n}return QR[n?QR.indexOf(n):0]}(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(let e=QR.indexOf(t)+1,n=QR.length;e<n;++e)if($R[QR[e]].common)return QR[e]}(this._unit):void 0,this.initOffsets(i),t.reverse&&a.reverse(),rD(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(){let t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=0,r=0;this.options.offset&&n.length&&(t=this.getDecimalForValue(n[0]),i=1===n.length?1-t:(this.getDecimalForValue(n[1])-t)/2,e=this.getDecimalForValue(n[n.length-1]),r=1===n.length?e:(e-this.getDecimalForValue(n[n.length-2]))/2);const a=n.length<3?.5:.25;i=pC(i,0,a),r=pC(r,0,a),this._offsets={start:i,end:r,factor:1/(i+1+r)}}_generate(){const t=this._adapter,e=this.min,n=this.max,i=this.options,r=i.time,a=r.unit||nD(r.minUnit,e,n,this._getLabelCapacity(e)),o=CE(i.ticks.stepSize,1),s="week"===a&&r.isoWeekday,l=iC(s)||!0===s,c={};let u,h,d=e;if(l&&(d=+t.startOf(d,"isoWeek",s)),d=+t.startOf(d,l?"day":a),t.diff(n,e,a)>1e5*o)throw new Error(e+" and "+n+" are too far apart with stepSize of "+o+" "+a);const p="data"===i.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<n;u=+t.add(u,o,a),h++)iD(c,u,p);return u!==n&&"ticks"!==i.bounds&&1!==h||iD(c,u,p),Object.keys(c).sort(tD).map(t=>+t)}getLabelForValue(t){const e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,i=this._unit,r=e||n[i];return this._adapter.format(t,r)}_tickFormatFunction(t,e,n,i){const r=this.options,a=r.ticks.callback;if(a)return IE(a,[t,e,n],this);const o=r.time.displayFormats,s=this._unit,l=this._majorUnit,c=s&&o[s],u=l&&o[l],h=n[e],d=l&&u&&h&&h.major;return this._adapter.format(t,i||(d?u:c))}generateTickLabels(t){let e,n,i;for(e=0,n=t.length;e<n;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,n=this.ctx.measureText(t).width,i=aC(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),a=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:n*r+o*a,h:n*a+o*r}}_getLabelCapacity(t){const e=this.options.time,n=e.displayFormats,i=n[e.unit]||n.millisecond,r=this._tickFormatFunction(t,0,rD(this,[t],this._majorUnit),i),a=this._getLabelSize(r),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,e=i.length;t<e;++t)n=n.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const t=this._cache.labels||[];let e,n;if(t.length)return t;const i=this.getLabels();for(e=0,n=i.length;e<n;++e)t.push(eD(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return bC(t.sort(tD))}}function oD(t,e,n){let i,r,a,o,s=0,l=t.length-1;n?(e>=t[s].pos&&e<=t[l].pos&&({lo:s,hi:l}=gC(t,"pos",e)),({pos:i,time:a}=t[s]),({pos:r,time:o}=t[l])):(e>=t[s].time&&e<=t[l].time&&({lo:s,hi:l}=gC(t,"time",e)),({time:i,pos:a}=t[s]),({time:r,pos:o}=t[l]));const c=r-i;return c?a+(o-a)*(e-i)/c:a}(0,It.A)(aD,"id","time"),(0,It.A)(aD,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class sD extends aD{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=oD(e,this.min),this._tableRange=oD(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:n}=this,i=[],r=[];let a,o,s,l,c;for(a=0,o=t.length;a<o;++a)l=t[a],l>=e&&l<=n&&i.push(l);if(i.length<2)return[{time:e,pos:0},{time:n,pos:1}];for(a=0,o=i.length;a<o;++a)c=i[a+1],s=i[a-1],l=i[a],Math.round((c+s)/2)!==l&&r.push({time:l,pos:a/(o-1)});return r}_generate(){const t=this.min,e=this.max;let n=super.getDataTimestamps();return n.includes(t)&&n.length||n.splice(0,0,t),n.includes(e)&&1!==n.length||n.push(e),n.sort((t,e)=>t-e)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t,t}getDecimalForValue(t){return(oD(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return oD(this._table,n*this._tableRange+this._minPos,!0)}}(0,It.A)(sD,"id","timeseries"),(0,It.A)(sD,"defaults",aD.defaults);const lD=["height","width","redraw","datasetIdKey","type","data","options","plugins","fallbackContent","updateMode"],cD="label";function uD(t,e){"function"===typeof t?t(e):t&&(t.current=e)}function hD(t,e){t.labels=e}function dD(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cD;const i=[];t.datasets=e.map(e=>{const r=t.datasets.find(t=>t[n]===e[n]);return r&&e.data&&!i.includes(r)?(i.push(r),Object.assign(r,e),r):kt({},e)})}function pD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cD;const n={labels:[],datasets:[]};return hD(n,t.labels),dD(n,t.datasets,e),n}function fD(t,e){const{height:n=150,width:r=300,redraw:a=!1,datasetIdKey:o,type:s,data:l,options:c,plugins:u=[],fallbackContent:h,updateMode:d}=t,p=Je(t,lD),f=(0,i.useRef)(null),m=(0,i.useRef)(null),g=()=>{f.current&&(m.current=new _k(f.current,{type:s,data:pD(l,o),options:c&&kt({},c),plugins:u}),uD(e,m.current))},y=()=>{uD(e,null),m.current&&(m.current.destroy(),m.current=null)};return(0,i.useEffect)(()=>{!a&&m.current&&c&&function(t,e){const n=t.options;n&&e&&Object.assign(n,e)}(m.current,c)},[a,c]),(0,i.useEffect)(()=>{!a&&m.current&&hD(m.current.config.data,l.labels)},[a,l.labels]),(0,i.useEffect)(()=>{!a&&m.current&&l.datasets&&dD(m.current.config.data,l.datasets,o)},[a,l.datasets]),(0,i.useEffect)(()=>{m.current&&(a?(y(),setTimeout(g)):m.current.update(d))},[a,c,l.labels,l.datasets,d]),(0,i.useEffect)(()=>{m.current&&(y(),setTimeout(g))},[s]),(0,i.useEffect)(()=>(g(),()=>y()),[]),i.createElement("canvas",kt({ref:f,role:"img",height:n,width:r},p),h)}const mD=(0,i.forwardRef)(fD);function gD(t,e){return _k.register(e),(0,i.forwardRef)((e,n)=>i.createElement(mD,kt(kt({},e),{},{ref:n,type:t})))}const yD=gD("line",jI),vD=gD("doughnut",UI);_k.register(Tk,CR,hR);const _D=function(t){var e,n,i,r;let{impactData:a}=t;const o=(null===a||void 0===a||null===(e=a.populationBreakdown)||void 0===e?void 0:e.directImpact)||85e3,s=(null===a||void 0===a||null===(n=a.populationBreakdown)||void 0===n?void 0:n.secondary)||15e4,l=(null===a||void 0===a||null===(i=a.populationBreakdown)||void 0===i?void 0:i.longTerm)||85e3,c=(null===a||void 0===a||null===(r=a.populationBreakdown)||void 0===r?void 0:r.totalAffected)||32e4,u={labels:["Direct Impact (25%)","Secondary (47%)","Long-term Effects (28%)"],datasets:[{data:[o,s,l],backgroundColor:["#ff6b35","#00d4ff","#8b5cf6"],borderColor:["#ff6b35","#00d4ff","#8b5cf6"],borderWidth:2,cutout:"60%"}]};return(0,Rt.jsxs)("div",{className:"population-impact",children:[(0,Rt.jsxs)("div",{className:"impact-header",children:[(0,Rt.jsx)("div",{className:"header-icon",children:"\ud83d\udc65"}),(0,Rt.jsx)("h3",{children:"Population Impact"})]}),(0,Rt.jsxs)("div",{className:"impact-chart",children:[(0,Rt.jsxs)("div",{className:"chart-container",children:[(0,Rt.jsx)(vD,{data:u,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,callbacks:{label:function(t){return"".concat(t.label,": ").concat(t.parsed.toLocaleString())}}}}}}),(0,Rt.jsxs)("div",{className:"chart-center",children:[(0,Rt.jsx)("div",{className:"total-affected",children:c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(0)+"K":c.toLocaleString()}),(0,Rt.jsx)("div",{className:"total-label",children:"Affected"})]})]}),(0,Rt.jsxs)("div",{className:"impact-legend",children:[(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--orange"}),(0,Rt.jsx)("span",{className:"legend-label",children:"Direct Impact"}),(0,Rt.jsx)("span",{className:"legend-value",children:o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(0)+"K":o.toLocaleString()})]}),(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--blue"}),(0,Rt.jsx)("span",{className:"legend-label",children:"Secondary"}),(0,Rt.jsx)("span",{className:"legend-value",children:s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toLocaleString()})]}),(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--purple"}),(0,Rt.jsx)("span",{className:"legend-label",children:"Long-term"}),(0,Rt.jsx)("span",{className:"legend-value",children:l>=1e6?(l/1e6).toFixed(1)+"M":l>=1e3?(l/1e3).toFixed(0)+"K":l.toLocaleString()})]})]})]})]})};const bD=function(t){let{impactData:e,simulationParams:n,selectedLocation:i}=t;const r=(()=>{if(!e||!n)return[{label:"Atmospheric Dust",level:"Low",severity:"low",progress:20},{label:"Temperature Change",level:"Low",severity:"low",progress:15},{label:"Tsunami Height",level:"Low",severity:"low",progress:10},{label:"Long-term Effects",level:"Low",severity:"low",progress:25}];const t=n.diameter,r=n.velocity,a=e.energy,o=(t=>t?"string"===typeof t?t:t.display_name?t.display_name:t.name?t.name:"":"")(i),s=t/1e3*r;let l,c,u,h,d,p,f,m,g;if(s<5?(l="Low",c=25,u="low"):s<15?(l="Medium",c=55,u="medium"):s<30?(l="High",c=80,u="high"):(l="Extreme",c=95,u="critical"),a<1?(h="Minimal",d=15,p="low"):a<10?(h="Low",d=35,p="low"):a<100?(h="Medium",d=60,p="medium"):a<1e3?(h="High",d=80,p="high"):(h="Catastrophic",d=95,p="critical"),o.toLowerCase().includes("ocean")||o.toLowerCase().includes("sea")){const e=Math.sqrt(a)*(t/1e3);e<2?(f="Low",m=30,g="medium"):e<5?(f="High",m=70,g="high"):(f="Extreme",m=95,g="critical")}else f="None",m=5,g="low";const y=(c+d+m)/3;let v,_,b;return y<30?(v="Minimal",_=20,b="low"):y<50?(v="Moderate",_=45,b="medium"):y<75?(v="Severe",_=70,b="high"):(v="Catastrophic",_=90,b="critical"),[{label:"Atmospheric Dust",level:l,severity:u,progress:c},{label:"Temperature Change",level:h,severity:p,progress:d},{label:"Tsunami Height",level:f,severity:g,progress:m},{label:"Long-term Effects",level:v,severity:b,progress:_}]})();return(0,Rt.jsxs)("div",{className:"environmental-impact",children:[(0,Rt.jsxs)("div",{className:"impact-header",children:[(0,Rt.jsx)("div",{className:"header-icon",children:"\ud83c\udf0d"}),(0,Rt.jsx)("h3",{children:"Environmental Impact"})]}),(0,Rt.jsx)("div",{className:"impacts-list",children:r.map((t,e)=>(0,Rt.jsxs)("div",{className:"impact-item",children:[(0,Rt.jsxs)("div",{className:"impact-info",children:[(0,Rt.jsx)("span",{className:"impact-label",children:t.label}),(0,Rt.jsx)("span",{className:"impact-level impact-level--".concat(t.severity),children:t.level})]}),(0,Rt.jsxs)("div",{className:"impact-progress",children:[(0,Rt.jsx)("div",{className:"progress-bar",children:(0,Rt.jsx)("div",{className:"progress-fill progress-fill--".concat(t.severity),style:{width:"".concat(t.progress,"%")}})}),(0,Rt.jsxs)("span",{className:"progress-value",children:[t.progress,"%"]})]})]},e))})]})},xD=JSON.parse('[{"name":"22 Kalliope (A852 WA)","a":2.909,"e":0.0989,"i":13.7,"om":65.97,"w":358.24,"q":2.622,"ad":3.2,"per_y":4.96,"data_arc":62578,"condition_code":0,"n_obs_used":12405,"H":6.79,"diameter_km":166.2,"mass_kg":4400000000000000000,"impact_energy_mt":920000,"hazard_level":"moderate"},{"name":"31 Euphrosyne (A854 RA)","a":3.162,"e":0.2159,"i":26.31,"om":30.8,"w":61.97,"q":2.479,"ad":3.84,"per_y":5.62,"data_arc":60186,"condition_code":0,"n_obs_used":3972,"H":6.81,"diameter_km":255.9,"mass_kg":15900000000000000000,"impact_energy_mt":3340000,"hazard_level":"high"},{"name":"243 Ida (A884 SB)","a":2.863,"e":0.0455,"i":1.13,"om":323.55,"w":113.79,"q":2.732,"ad":2.99,"per_y":4.84,"data_arc":51340,"condition_code":0,"n_obs_used":12512,"H":10.08,"diameter_km":31.4,"mass_kg":42000000000000000,"impact_energy_mt":88200,"hazard_level":"low"},{"name":"1862 Apollo (1932 HA)","a":1.471,"e":0.5599,"i":6.35,"om":35.54,"w":286.05,"q":0.647,"ad":2.29,"per_y":1.78,"data_arc":34421,"condition_code":0,"n_obs_used":3473,"H":16.08,"diameter_km":1.7,"mass_kg":4900000000000,"impact_energy_mt":103,"hazard_level":"extreme"},{"name":"3122 Florence (1981 ET3)","a":1.769,"e":0.4232,"i":22.14,"om":336.04,"w":27.88,"q":1.02,"ad":2.52,"per_y":2.35,"data_arc":16876,"condition_code":0,"n_obs_used":9972,"H":14.08,"diameter_km":4.9,"mass_kg":125000000000000,"impact_energy_mt":2625,"hazard_level":"very_high"},{"name":"65803 Didymos (1996 GT)","a":1.643,"e":0.3832,"i":3.41,"om":72.98,"w":319.59,"q":1.013,"ad":2.27,"per_y":2.11,"data_arc":722,"condition_code":0,"n_obs_used":1647,"H":18.11,"diameter_km":0.78,"mass_kg":530000000000,"impact_energy_mt":11.1,"hazard_level":"very_high"},{"name":"99942 Apophis (2004 MN4)","a":0.922,"e":0.191,"i":3.33,"om":204.4,"w":126.4,"q":0.746,"ad":1.099,"per_y":0.886,"data_arc":6000,"condition_code":0,"n_obs_used":1000,"H":19.7,"diameter_km":0.34,"mass_kg":61000000000,"impact_energy_mt":1.28,"hazard_level":"extreme"},{"name":"2022 AP7","a":1.067,"e":0.415,"i":31.1,"om":204.3,"w":46.7,"q":0.624,"ad":1.51,"per_y":1.1,"data_arc":365,"condition_code":7,"n_obs_used":50,"H":17.8,"diameter_km":1.1,"mass_kg":1400000000000,"impact_energy_mt":29.4,"hazard_level":"extreme"},{"name":"2023 DW","a":2.05,"e":0.38,"i":3.1,"om":142.3,"w":85.2,"q":1.27,"ad":2.83,"per_y":2.93,"data_arc":200,"condition_code":6,"n_obs_used":85,"H":18.2,"diameter_km":0.67,"mass_kg":310000000000,"impact_energy_mt":6.5,"hazard_level":"high"},{"name":"Bennu (101955)","a":1.126,"e":0.204,"i":6.03,"om":2.06,"w":66.22,"q":0.897,"ad":1.356,"per_y":1.2,"data_arc":15000,"condition_code":0,"n_obs_used":2000,"H":20.9,"diameter_km":0.49,"mass_kg":73000000000,"impact_energy_mt":1.53,"hazard_level":"moderate"}]');const wD=function(t){let{handleReset:e,onRunSimulation:n,onLocationChange:r,searchQuery:a,setSearchQuery:o,searchResults:s,searchLoading:l}=t;const[c,u]=(0,i.useState)(250),[h,d]=(0,i.useState)(19.3),[p,f]=(0,i.useState)(45),[m,g]=(0,i.useState)("Ocean (Pacific)"),y=(0,i.useMemo)(()=>{const t=c/1e3;return xD.reduce((e,n)=>{const i=Math.abs(e.diameter_km-t);return Math.abs(n.diameter_km-t)<i?n:e})},[c]);return(0,i.useEffect)(()=>{r&&m&&r(m)},[r,m]),(0,Rt.jsxs)("div",{className:"simulation-parameters",children:[(0,Rt.jsxs)("div",{className:"parameters-header",children:[(0,Rt.jsx)("div",{className:"header-icon",children:"\u2699\ufe0f"}),(0,Rt.jsx)("h3",{children:"Simulation Parameters"})]}),(0,Rt.jsxs)("div",{className:"parameter-group",children:[(0,Rt.jsxs)("div",{className:"parameter-label",children:[(0,Rt.jsx)("span",{children:"Asteroid Diameter"}),(0,Rt.jsxs)("span",{className:"parameter-value",children:[c," m"]})]}),(0,Rt.jsxs)("div",{className:"slider-container",children:[(0,Rt.jsx)("button",{className:"slider-btn",onClick:()=>u(Math.max(10,c-10)),children:"\u2212"}),(0,Rt.jsx)("input",{type:"range",min:"10",max:"2000",step:"10",value:c,onChange:t=>u(parseInt(t.target.value)),className:"parameter-slider"}),(0,Rt.jsx)("button",{className:"slider-btn",onClick:()=>u(Math.min(2e3,c+10)),children:"+"})]})]}),(0,Rt.jsxs)("div",{className:"parameter-group",children:[(0,Rt.jsxs)("div",{className:"parameter-label",children:[(0,Rt.jsx)("span",{children:"Velocity"}),(0,Rt.jsxs)("span",{className:"parameter-value",children:[h," km/s"]})]}),(0,Rt.jsxs)("div",{className:"slider-container",children:[(0,Rt.jsx)("button",{className:"slider-btn",onClick:()=>d(Math.max(5,h-.1)),children:"\u2212"}),(0,Rt.jsx)("input",{type:"range",min:"5",max:"50",step:"0.1",value:h,onChange:t=>d(parseFloat(t.target.value)),className:"parameter-slider"}),(0,Rt.jsx)("button",{className:"slider-btn",onClick:()=>d(Math.min(50,h+.1)),children:"+"})]})]}),(0,Rt.jsxs)("div",{className:"parameter-group",children:[(0,Rt.jsxs)("div",{className:"parameter-label",children:[(0,Rt.jsx)("span",{children:"Entry Angle"}),(0,Rt.jsxs)("span",{className:"parameter-value",children:[p,"\xb0"]})]}),(0,Rt.jsxs)("div",{className:"slider-container",children:[(0,Rt.jsx)("button",{className:"slider-btn",onClick:()=>f(Math.max(0,p-5)),children:"\u2212"}),(0,Rt.jsx)("input",{type:"range",min:"0",max:"360",step:"5",value:p,onChange:t=>f(parseInt(t.target.value)),className:"parameter-slider"}),(0,Rt.jsx)("button",{className:"slider-btn",onClick:()=>f(Math.min(360,p+5)),children:"+"})]})]}),(0,Rt.jsxs)("div",{className:"parameter-group",children:[(0,Rt.jsx)("div",{className:"parameter-label",children:(0,Rt.jsx)("span",{children:"Impact Location"})}),(0,Rt.jsx)("select",{value:m,onChange:t=>{g(t.target.value),null===r||void 0===r||r(t.target.value)},className:"location-select",children:Object.keys(UA).map(t=>(0,Rt.jsx)("option",{value:t,children:t},t))})]}),(0,Rt.jsxs)("div",{className:"parameter-group",children:[(0,Rt.jsx)("div",{className:"parameter-label",children:(0,Rt.jsx)("span",{children:"Search Custom Location"})}),(0,Rt.jsxs)("div",{className:"search-container",children:[(0,Rt.jsx)("input",{type:"text",value:a,onChange:t=>o(t.target.value),placeholder:"Search for a city or address...",className:"location-search-input"}),l&&(0,Rt.jsx)("div",{className:"search-loading",children:"Searching..."}),s.length>0&&(0,Rt.jsx)("div",{className:"search-results",children:s.map((t,e)=>(0,Rt.jsx)("div",{className:"search-result-item",onClick:()=>{const e=kt(kt({},t),{},{centroid:{lat:parseFloat(t.lat),lon:parseFloat(t.lon)}});console.log("Selected search location:",e),null===r||void 0===r||r(e),o("")},children:t.display_name},e))})]})]}),y&&(0,Rt.jsxs)("div",{className:"asteroid-info",children:[(0,Rt.jsxs)("div",{className:"asteroid-name",children:["Auto-selected: ",y.name]}),(0,Rt.jsxs)("div",{className:"asteroid-details",children:[(0,Rt.jsxs)("span",{children:["Diameter: ",y.diameter_km," km"]}),(0,Rt.jsxs)("span",{children:["Risk: ",y.hazard_level]})]})]}),(0,Rt.jsxs)("div",{className:"simulation-actions",children:[(0,Rt.jsxs)("button",{className:"run-simulation-btn",onClick:()=>{null===n||void 0===n||n({diameter:c,velocity:h,entryAngle:p,impactLocation:m,selectedAsteroid:y})},children:[(0,Rt.jsx)("span",{className:"btn-icon",children:"\u25b6"}),"Run Simulation"]}),(0,Rt.jsx)("button",{className:"reset-btn",onClick:e,children:(0,Rt.jsx)("span",{className:"btn-icon",children:"\u21bb"})})]})]})};var SD=n(2284);function MD(t,e){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},MD(t,e)}function TD(){TD=function(t,e){return new n(t,void 0,e)};var t=RegExp.prototype,e=new WeakMap;function n(t,i,r){var a=RegExp(t,i);return e.set(a,r||e.get(t)),MD(a,n.prototype)}function i(t,n){var i=e.get(n);return Object.keys(i).reduce(function(e,n){var r=i[n];if("number"==typeof r)e[n]=t[r];else{for(var a=0;void 0===t[r[a]]&&a+1<r.length;)a++;e[n]=t[r[a]]}return e},Object.create(null))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&MD(t,e)}(n,RegExp),n.prototype.exec=function(e){var n=t.exec.call(this,e);if(n){n.groups=i(n,this);var r=n.indices;r&&(r.groups=i(r,this))}return n},n.prototype[Symbol.replace]=function(n,r){if("string"==typeof r){var a=e.get(this);return t[Symbol.replace].call(this,n,r.replace(/\$<([^>]+)(>|$)/g,function(t,e,n){if(""===n)return t;var i=a[e];return Array.isArray(i)?"$"+i.join("$"):"number"==typeof i?"$"+i:""}))}if("function"==typeof r){var o=this;return t[Symbol.replace].call(this,n,function(){var t=arguments;return"object"!=(0,SD.A)(t[t.length-1])&&(t=[].slice.call(t)).push(i(t,o)),r.apply(this,t)})}return t[Symbol.replace].call(this,n,r)},TD.apply(this,arguments)}var AD=n(3719);Map,Symbol.iterator,Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");const ED=new class{constructor(){this._apiKey="",this._fetch="undefined"!==typeof self?fetch.bind(self):"undefined"!==typeof global&&global.fetch?global.fetch:null,this.tileCacheSize=200}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}},CD=kt(kt({},{AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}}),{ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}});function PD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CD;for(const n of Object.values(e))if(n.code===t)return n;return null}function ID(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CD;for(const n of Object.values(e))if(n.flag===t)return n;return null}function LD(t){return null!==t&&"object"===typeof t&&"code"in t&&"flag"in t&&"name"in t&&"latin"in t&&"isMode"in t&&"geocoding"in t&&("string"===typeof t.code||null===t.code)&&"string"===typeof t.flag&&"string"===typeof t.name&&"boolean"===typeof t.latin&&"boolean"===typeof t.isMode&&"boolean"===typeof t.geocoding}function kD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CD;return LD(t)?ID(t.flag,e):"string"!==typeof t?null:function(t){return t in(arguments.length>1&&void 0!==arguments[1]?arguments[1]:CD)?t[t]:null}(t,e)||PD(t,e)||ID(t,e)||null}async function RD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===ED.fetch)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(""===new URL(t).searchParams.get("key").trim())throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return ED.fetch(t,e)}const DD={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(DD);class ND extends Error{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super("Call to enpoint ".concat(t.url," failed with the status code ").concat(t.status,". ").concat(e)),this.res=t}}const zD={403:"Key is missing, invalid or restricted"};const FD={info:async function(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=new URL("geolocation/ip.json",DD.maptilerApiURL);n.searchParams.set("key",null!==(t=e.apiKey)&&void 0!==t?t:ED.apiKey),"elevation"in e&&n.searchParams.set("elevation",e.elevation?"true":"false");const i=n.toString(),r=await RD(i);if(!r.ok)throw new ND(r,r.status in zD?zD[r.status]:"");return await r.json()}};function OD(t){let e;const n=t.trim();let i;return i=n.startsWith("http://")||n.startsWith("https://")?n:null!==(e=/^maptiler:\/\/(.*)/.exec(n))?"https://api.maptiler.com/maps/".concat(e[1],"/style.json"):"https://api.maptiler.com/maps/".concat(n,"/style.json"),i}class BD{constructor(t,e,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.name=t,this.variantType=e,this.id=n,this.referenceStyle=i,this.description=r,this.imageURL=a,this.deprecated=o}getName(){return this.name}getFullName(){return"".concat(this.referenceStyle.getName()," ").concat(this.name)}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){const e=this.referenceStyle.getVariant(t);return this.warnIfDeprecated(e),e}getVariants(){return this.referenceStyle.getVariants().filter(t=>t!==this).map(t=>(this.warnIfDeprecated(t),t))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return OD(this.getId())}warnIfDeprecated(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if(!t.deprecated)return t;const e=t.getFullName();return console.warn('Style "'.concat(e,'" is deprecated and will be removed in a future version.')),t}}class UD{constructor(t,e){this.name=t,this.id=e,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const jD=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function VD(t){return new Proxy(t,{get(e,n,i){if(e.hasVariant(n))return e.getVariant(n);if(n.toString().toUpperCase()===n)return t.getDefaultVariant();return Reflect.get(e,n,i)}})}const HD=function(){const t={};for(let e=0;e<jD.length;e+=1){const n=jD[e],i=VD(new UD(n.name,n.referenceStyleID));for(let t=0;t<n.variants.length;t+=1){const e=n.variants[t],r=new BD(e.name,e.variantType,e.id,i,e.description,e.imageURL,e.deprecated);i.addVariant(r)}t[n.referenceStyleID]=i}return t}();const GD=6371008.8;Math.PI;var WD=n(7284);const qD={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ZD;const XD=new Uint8Array(16);const YD=[];for(let n=0;n<256;++n)YD.push((n+256).toString(16).slice(1));function KD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(YD[t[e+0]]+YD[t[e+1]]+YD[t[e+2]]+YD[t[e+3]]+"-"+YD[t[e+4]]+YD[t[e+5]]+"-"+YD[t[e+6]]+YD[t[e+7]]+"-"+YD[t[e+8]]+YD[t[e+9]]+"-"+YD[t[e+10]]+YD[t[e+11]]+YD[t[e+12]]+YD[t[e+13]]+YD[t[e+14]]+YD[t[e+15]]).toLowerCase()}const JD=function(t,e,n){var i,r,a,o;if(qD.randomUUID&&!e&&!t)return qD.randomUUID();const s=null!==(i=null!==(r=(t=t||{}).random)&&void 0!==r?r:null===(a=(o=t).rng)||void 0===a?void 0:a.call(o))&&void 0!==i?i:function(){if(!ZD){if("undefined"===typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ZD=crypto.getRandomValues.bind(crypto)}return ZD(XD)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){if((n=n||0)<0||n+16>e.length)throw new RangeError("UUID byte range ".concat(n,":").concat(n+15," is out of buffer bounds"));for(let t=0;t<16;++t)e[n+t]=s[t];return e}return KD(s)},$D="function"===typeof Buffer,QD=("function"===typeof TextDecoder&&new TextDecoder,"function"===typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),tN=(t=>{let e={};return t.forEach((t,n)=>e[t]=n),e})(QD),eN=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,nN=String.fromCharCode.bind(String),iN=("function"===typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),t=>t.replace(/=/g,"").replace(/[+\/]/g,t=>"+"==t?"-":"_")),rN=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),aN=t=>{let e,n,i,r,a="";const o=t.length%3;for(let s=0;s<t.length;){if((n=t.charCodeAt(s++))>255||(i=t.charCodeAt(s++))>255||(r=t.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=n<<16|i<<8|r,a+=QD[e>>18&63]+QD[e>>12&63]+QD[e>>6&63]+QD[63&e]}return o?a.slice(0,o-3)+"===".substring(o):a},oN="function"===typeof btoa?t=>btoa(t):$D?t=>Buffer.from(t,"binary").toString("base64"):aN,sN=$D?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let n=0,i=t.length;n<i;n+=4096)e.push(nN.apply(null,t.subarray(n,n+4096)));return oN(e.join(""))},lN=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?iN(sN(t)):sN(t)},cN=t=>{if(t=t.replace(/\s+/g,""),!eN.test(t))throw new TypeError("malformed base64.");let e,n,i;t+="==".slice(2-(3&t.length));let r=[];for(let a=0;a<t.length;)e=tN[t.charAt(a++)]<<18|tN[t.charAt(a++)]<<12|(n=tN[t.charAt(a++)])<<6|(i=tN[t.charAt(a++)]),64===n?r.push(nN(e>>16&255)):64===i?r.push(nN(e>>16&255,e>>8&255)):r.push(nN(e>>16&255,e>>8&255,255&e));return r.join("")},uN=lN;var hN=Object.defineProperty,dN=t=>{throw TypeError(t)},pN=(t,e,n)=>((t,e,n)=>e in t?hN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n),fN=(t,e,n)=>e.has(t)||dN("Cannot "+n),mN=(t,e,n)=>(fN(t,e,"read from private field"),n?n.call(t):e.get(t)),gN=(t,e,n)=>e.has(t)?dN("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),yN=(t,e,n,i)=>(fN(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),vN=(t,e,n)=>(fN(t,e,"access private method"),n);const _N=kt({VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1}},CD);function bN(){var t;if(typeof navigator>"u"){return PD(Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0])||_N.ENGLISH}return null!==(t=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).map(t=>PD(t)).filter(t=>t)[0])&&void 0!==t?t:_N.LOCAL}const xN={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:_N.STYLE,secondaryLanguage:_N.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(xN);const wN=JD();const SN=new class extends WD{constructor(){super(...arguments),pN(this,"primaryLanguage",xN.primaryLanguage),pN(this,"secondaryLanguage"),pN(this,"session",!0),pN(this,"caching",!0),pN(this,"telemetry",!0),pN(this,"_unit","metric"),pN(this,"_apiKey","")}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,ED.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){ED.fetch=t}get fetch(){return ED.fetch}},MN="localcache_source",TN="localcache",AN=typeof caches<"u",{addProtocol:EN}=AD;function CN(t,e){if(AN&&SN.caching&&SN.session&&t.host===xN.maptilerApiHost){if("Source"===e&&t.href.includes("tiles.json"))return t.href.replace("https://","".concat(MN,"://"));if("Tile"===e||"Glyphs"===e)return t.href.replace("https://","".concat(TN,"://"))}return t.href}let PN;async function IN(){return PN||(PN=await caches.open("maptiler_sdk")),PN}let LN=0;function kN(){EN(MN,async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace("".concat(MN,"://"),"https://");const n=t;n.signal=e.signal;const i=await fetch(t.url,n),r=await i.json();return r.tiles&&r.tiles.length>0&&(r.tiles[0]+="&last-modified=".concat(i.headers.get("Last-Modified"))),{data:r,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires")}}),EN(TN,async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace("".concat(TN,"://"),"https://");const n=new URL(t.url),i=new URL(n);i.searchParams.delete("mtsid"),i.searchParams.delete("key");const r=i.toString(),a=new URL(n);a.searchParams.delete("last-modified");const o=a.toString(),s=async t=>({data:await t.arrayBuffer(),cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires")}),l=await IN(),c=await l.match(r);if(c)return s(c);const u=t;u.signal=e.signal;const h=await fetch(o,u);return h.status>=200&&h.status<300&&(l.put(r,h.clone()).catch(()=>{}),++LN>100&&(async function(){const t=await IN(),e=await t.keys(),n=e.slice(0,Math.max(e.length-1e3,0));for(const i of n)t.delete(i)}(),LN=0)),s(h)})}function RN(t,e){let n=null;try{n=new URL(t)}catch(i){return{url:t}}return n.host===xN.maptilerApiHost&&(n.searchParams.has("key")||n.searchParams.append("key",SN.apiKey),SN.session&&n.searchParams.append("mtsid",wN)),{url:CN(n,e)}}function DN(t){return(e,n)=>{if(null!=t){var i;const r=t(e,n),a=RN(null!==(i=null==r?void 0:r.url)&&void 0!==i?i:"",n);return kt(kt({},r),a)}return RN(e,n)}}function NN(){return Math.random().toString(36).substring(2)}function zN(t){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t)}function FN(t){const e=document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed.";if(!e)return;let n=null;if("string"==typeof t?n=document.getElementById(t):t instanceof HTMLElement&&(n=t),!n)throw new Error("The Map container must be provided.");const i=document.createElement("div");throw i.innerHTML=e,i.classList.add("webgl-warning-div"),n.appendChild(i),new Error(e)}function ON(t,e){return!(!Array.isArray(t)||2!==t.length||"get"!==t[0]||"string"!=typeof t[1]||e&&!t[1].startsWith("name:")||!e&&"name"!==t[1])}function BN(t,e,n){const i=structuredClone(t),r=t=>{if("string"!=typeof t)for(let i=0;i<t.length;i+=1)ON(t[i],n)?t[i]=structuredClone(e):r(t[i])};return ON(i,n)?e:(r(i),i)}function UN(t,e){const n=e?/\{name:\S+\}/:/\{name\}/;return{contains:n.test(t),exactMatch:new RegExp("^".concat(n.source,"$")).test(t)}}function jN(t,e,n){const i=n?/\{name:\S+\}/:/\{name\}/,r=t.split(i);return["concat",...r.flatMap((t,n)=>n===r.length-1?[t]:[t,e])]}function VN(t){var e;const n=TD(/\{name(?::(\S+))?\}/g,{language:1}),i=[];for(;;){var r;const a=n.exec(t);if(!a)break;const o=null!==(r=null==(e=a.groups)?void 0:e.language)&&void 0!==r?r:null;i.push(o)}return i}function HN(t){return Array.isArray(t)&&2===t.length&&"get"===t[0]&&"string"==typeof t[1]?"name"===t[1].trim()?{isLanguage:!0,localization:null}:t[1].trim().startsWith("name:")?{isLanguage:!0,localization:t[1].trim().split(":").pop()}:null:null}function GN(t){const e=[],n=structuredClone(t),i=t=>{if("string"!=typeof t)for(let n=0;n<t.length;n+=1){const r=HN(t[n]);r?e.push(r.localization):i(t[n])}};return i([n]),e}let WN=class extends AD.Marker{addTo(t){return super.addTo(t)}};AD.Popup;AD.Style;AD.CanvasSource;AD.GeoJSONSource;AD.ImageSource;AD.RasterTileSource;AD.RasterDEMTileSource;AD.VectorTileSource;AD.VideoSource;class qN extends AD.NavigationControl{onAdd(t){return super.onAdd(t)}}class ZN extends AD.GeolocateControl{onAdd(t){return super.onAdd(t)}}AD.AttributionControl;class XN extends AD.LogoControl{onAdd(t){return super.onAdd(t)}}class YN extends AD.ScaleControl{onAdd(t){return super.onAdd(t)}}class KN extends AD.FullscreenControl{onAdd(t){return super.onAdd(t)}}AD.TerrainControl;AD.BoxZoomHandler;AD.ScrollZoomHandler;AD.CooperativeGesturesHandler;AD.KeyboardHandler;AD.TwoFingersTouchPitchHandler;AD.MapWheelEvent;AD.MapTouchEvent;AD.MapMouseEvent;class JN extends XN{constructor(){var t,e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(n),pN(this,"logoURL",""),pN(this,"linkURL",""),this.logoURL=null!==(t=n.logoURL)&&void 0!==t?t:xN.maptilerLogoURL,this.linkURL=null!==(e=n.linkURL)&&void 0!==e?e:xN.maptilerURL}onAdd(t){var e;this._map=t,this._compact=null!==(e=this.options.compact)&&void 0!==e&&e,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const n=window.document.createElement("a");return n.style.backgroundRepeat="no-repeat",n.style.cursor="pointer",n.style.display="block",n.style.height="23px",n.style.margin="0 0 -4px -4px",n.style.overflow="hidden",n.style.width="88px",n.style.backgroundImage="url(".concat(this.logoURL,")"),n.style.backgroundSize="100px 30px",n.style.width="100px",n.style.height="30px",n.target="_blank",n.rel="noopener",n.href=this.linkURL,n.setAttribute("aria-label","MapTiler logo"),n.setAttribute("rel","noopener"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var $N={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class QN{constructor(t,e,n,i){this.message=(t?"".concat(t,": "):"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function tz(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}class ez extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class nz{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new nz(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error("".concat(t," not found in scope."))}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const iz={kind:"null"},rz={kind:"number"},az={kind:"string"},oz={kind:"boolean"},sz={kind:"color"},lz={kind:"projectionDefinition"},cz={kind:"object"},uz={kind:"value"},hz={kind:"collator"},dz={kind:"formatted"},pz={kind:"padding"},fz={kind:"colorArray"},mz={kind:"numberArray"},gz={kind:"resolvedImage"},yz={kind:"variableAnchorOffsetCollection"};function vz(t,e){return{kind:"array",itemType:t,N:e}}function _z(t){if("array"===t.kind){const e=_z(t.itemType);return"number"==typeof t.N?"array<".concat(e,", ").concat(t.N,">"):"value"===t.itemType.kind?"array":"array<".concat(e,">")}return t.kind}const bz=[iz,rz,az,oz,sz,lz,dz,cz,vz(uz),pz,mz,fz,gz,yz];function xz(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!xz(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of bz)if(!xz(t,e))return null}return"Expected ".concat(_z(t)," but found ").concat(_z(e)," instead.")}function wz(t,e){return e.some(e=>e.kind===t.kind)}function Sz(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function Mz(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const Tz=.96422,Az=.82521,Ez=4/29,Cz=6/29,Pz=3*Cz*Cz,Iz=Cz*Cz*Cz,Lz=Math.PI/180,kz=180/Math.PI;function Rz(t){return(t%=360)<0&&(t+=360),t}function Dz(t){let e,n,[i,r,a,o]=t;i=Nz(i),r=Nz(r),a=Nz(a);const s=zz((.2225045*i+.7168786*r+.0606169*a)/1);i===r&&r===a?e=n=s:(e=zz((.4360747*i+.3850649*r+.1430804*a)/Tz),n=zz((.0139322*i+.0971045*r+.7141733*a)/Az));const l=116*s-16;return[l<0?0:l,500*(e-s),200*(s-n),o]}function Nz(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function zz(t){return t>Iz?Math.pow(t,1/3):t/Pz+Ez}function Fz(t){let[e,n,i,r]=t,a=(e+16)/116,o=isNaN(n)?a:a+n/500,s=isNaN(i)?a:a-i/200;return a=1*Bz(a),o=Tz*Bz(o),s=Az*Bz(s),[Oz(3.1338561*o-1.6168667*a-.4906146*s),Oz(-.9787684*o+1.9161415*a+.033454*s),Oz(.0719453*o-.2289914*a+1.4052427*s),r]}function Oz(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function Bz(t){return t>Cz?t*t*t:Pz*(t-Ez)}const Uz=Object.hasOwn||function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function jz(t,e){return Uz(t,e)?t[e]:void 0}function Vz(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=jz(Zz,t);if(e){const[t,n,i]=e;return[t/255,n/255,i/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let n=1;return[Hz(t.slice(n,n+=e)),Hz(t.slice(n,n+=e)),Hz(t.slice(n,n+=e)),Hz(t.slice(n,n+e)||"ff")]}if(t.startsWith("rgb")){const e=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=t.match(e);if(n){const[t,e,i,r,a,o,s,l,c,u,h,d]=n,p=[r||" ",s||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[i,o,c].join(""),n="%%%"===t?100:""===t?255:0;if(n){const t=[Wz(+e/n,0,1),Wz(+a/n,0,1),Wz(+l/n,0,1),h?Gz(+h,d):1];if(qz(t))return t}}return}}const n=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[t,e,i,r,a,o,s,l,c]=n,u=[i||" ",a||" ",s].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,Wz(+r,0,100),Wz(+o,0,100),l?Gz(+l,c):1];if(qz(t))return function(t){let[e,n,i,r]=t;function a(t){const r=(t+e/30)%12,a=n*Math.min(i,1-i);return i-a*Math.max(-1,Math.min(r-3,9-r,1))}return e=Rz(e),n/=100,i/=100,[a(0),a(8),a(4),r]}(t)}}}function Hz(t){return parseInt(t.padEnd(2,t),16)/255}function Gz(t,e){return Wz(e?t/100:t,0,1)}function Wz(t,e,n){return Math.min(Math.max(e,t),n)}function qz(t){return!t.some(Number.isNaN)}const Zz={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Xz(t,e,n){return t+n*(e-t)}function Yz(t,e,n){return t.map((t,i)=>Xz(t,e[i],n))}class Kz{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.r=t,this.g=e,this.b=n,this.a=i,r||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[t,e,n,i]))}static parse(t){if(t instanceof Kz)return t;if("string"!=typeof t)return;const e=Vz(t);return e?new Kz(...e,!1):void 0}get rgb(){const{r:t,g:e,b:n,a:i}=this,r=i||1/0;return this.overwriteGetter("rgb",[t/r,e/r,n/r,i])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,n,i,r]=Dz(t),a=Math.sqrt(n*n+i*i);return[Math.round(1e4*a)?Rz(Math.atan2(i,n)*kz):NaN,a,e,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Dz(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,n,i]=this.rgb;return"rgba(".concat([t,e,n].map(t=>Math.round(255*t)).join(","),",").concat(i,")")}static interpolate(t,e,n){switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb"){case"rgb":{const[i,r,a,o]=Yz(t.rgb,e.rgb,n);return new Kz(i,r,a,o,!1)}case"hcl":{const[i,r,a,o]=t.hcl,[s,l,c,u]=e.hcl;let h,d;if(isNaN(i)||isNaN(s))isNaN(i)?isNaN(s)?h=NaN:(h=s,(1===a||0===a)&&(d=l)):(h=i,(1===c||0===c)&&(d=r));else{let t=s-i;s>i&&t>180?t-=360:s<i&&i-s>180&&(t+=360),h=i+n*t}const[p,f,m,g]=function(t){let[e,n,i,r]=t;return e=isNaN(e)?0:e*Lz,Fz([i,Math.cos(e)*n,Math.sin(e)*n,r])}([h,null!==d&&void 0!==d?d:Xz(r,l,n),Xz(a,c,n),Xz(o,u,n)]);return new Kz(p,f,m,g,!1)}case"lab":{const[i,r,a,o]=Fz(Yz(t.lab,e.lab,n));return new Kz(i,r,a,o,!1)}}}}Kz.black=new Kz(0,0,0,1),Kz.white=new Kz(1,1,1,1),Kz.transparent=new Kz(0,0,0,0),Kz.red=new Kz(1,0,0,1);class Jz{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $z=["bottom","center","top"];class Qz{constructor(t,e,n,i,r,a){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r,this.verticalAlign=a}}class tF{constructor(t){this.sections=t}static fromString(t){return new tF([new Qz(t,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof tF?t:tF.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}}class eF{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof eF)return t;if("number"==typeof t)return new eF([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new eF(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new eF(Yz(t.values,e.values,n))}}class nF{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof nF)return t;if("number"==typeof t)return new nF([t]);if(Array.isArray(t)){for(const e of t)if("number"!=typeof e)return;return new nF(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new nF(Yz(t.values,e.values,n))}}class iF{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof iF)return t;if("string"==typeof t){const e=Kz.parse(t);return e?new iF([e]):void 0}if(!Array.isArray(t))return;const e=[];for(const n of t){if("string"!=typeof n)return;const t=Kz.parse(n);if(!t)return;e.push(t)}return new iF(e)}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb";const r=[];if(t.values.length!=e.values.length)throw new Error("colorArray: Arrays have mismatched length (".concat(t.values.length," vs. ").concat(e.values.length,"), cannot interpolate."));for(let a=0;a<t.values.length;a++)r.push(Kz.interpolate(t.values[a],e.values[a],n,i));return new iF(r)}}class rF extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const aF=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class oF{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof oF)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2===0){for(let e=0;e<t.length;e+=2){const n=t[e],i=t[e+1];if("string"!=typeof n||!aF.has(n)||!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new oF(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){const i=t.values,r=e.values;if(i.length!==r.length)throw new rF("Cannot interpolate values of different length. from: ".concat(t.toString(),", to: ").concat(e.toString()));const a=[];for(let o=0;o<i.length;o+=2){if(i[o]!==r[o])throw new rF("Cannot interpolate values containing mismatched anchors. from[".concat(o,"]: ").concat(i[o],", to[").concat(o,"]: ").concat(r[o]));a.push(i[o]);const[t,e]=i[o+1],[s,l]=r[o+1];a.push([Xz(t,s,n),Xz(e,l,n)])}return new oF(a)}}class sF{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new sF({name:t,available:!1}):null}}class lF{constructor(t,e,n){this.from=t,this.to=e,this.transition=n}static interpolate(t,e,n){return new lF(t,e,n)}static parse(t){return t instanceof lF?t:Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]?new lF(t[0],t[1],t[2]):"object"==typeof t&&"string"==typeof t.from&&"string"==typeof t.to&&"number"==typeof t.transition?new lF(t.from,t.to,t.transition):"string"==typeof t?new lF(t,t,1):void 0}}function cF(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?typeof i>"u"||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([t,e,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function uF(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof lF||t instanceof Kz||t instanceof Jz||t instanceof tF||t instanceof eF||t instanceof nF||t instanceof iF||t instanceof oF||t instanceof sF)return!0;if(Array.isArray(t)){for(const e of t)if(!uF(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!uF(t[e]))return!1;return!0}return!1}function hF(t){if(null===t)return iz;if("string"==typeof t)return az;if("boolean"==typeof t)return oz;if("number"==typeof t)return rz;if(t instanceof Kz)return sz;if(t instanceof lF)return lz;if(t instanceof Jz)return hz;if(t instanceof tF)return dz;if(t instanceof eF)return pz;if(t instanceof nF)return mz;if(t instanceof iF)return fz;if(t instanceof oF)return yz;if(t instanceof sF)return gz;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=hF(i);if(n){if(n===t)continue;n=uz;break}n=t}return vz(n||uz,e)}return cz}function dF(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Kz||t instanceof lF||t instanceof tF||t instanceof eF||t instanceof nF||t instanceof iF||t instanceof oF||t instanceof sF?t.toString():JSON.stringify(t)}class pF{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!uF(t[1]))return e.error("invalid value");const n=t[1];let i=hF(n);const r=e.expectedType;return"array"===i.kind&&0===i.N&&r&&"array"===r.kind&&("number"!=typeof r.N||0===r.N)&&(i=r),new pF(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const fF={string:az,number:rz,boolean:oz,object:cz};class mF{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,a;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in fF)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=fF[n],i++}else r=uz;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],i++}n=vz(r,a)}else{if(!fF[r])throw new Error("Types doesn't contain name = ".concat(r));n=fF[r]}const a=[];for(;i<t.length;i++){const n=e.parse(t[i],i,uz);if(!n)return null;a.push(n)}return new mF(n,a)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!xz(this.type,hF(n)))return n;if(e===this.args.length-1)throw new rF("Expected value to be of type ".concat(_z(this.type),", but found ").concat(_z(hF(n))," instead."))}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const gF={"to-boolean":oz,"to-color":sz,"to-number":rz,"to-string":az};class yF{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(!gF[n])throw new Error("Can't parse ".concat(n," as it is not part of the known types"));if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=gF[n],r=[];for(let a=1;a<t.length;a++){const n=e.parse(t[a],a,uz);if(!n)return null;r.push(n)}return new yF(i,r)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof Kz)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?"Invalid rgba value ".concat(JSON.stringify(e),": expected an array containing either three or four numeric values."):cF(e[0],e[1],e[2],e[3]),!n))return new Kz(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new rF(n||"Could not parse color from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"padding":{let e;for(const n of this.args){e=n.evaluate(t);const i=eF.parse(e);if(i)return i}throw new rF("Could not parse padding from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"numberArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=nF.parse(e);if(i)return i}throw new rF("Could not parse numberArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"colorArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=iF.parse(e);if(i)return i}throw new rF("Could not parse colorArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"variableAnchorOffsetCollection":{let e;for(const n of this.args){e=n.evaluate(t);const i=oF.parse(e);if(i)return i}throw new rF("Could not parse variableAnchorOffsetCollection from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"number":{let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new rF("Could not convert ".concat(JSON.stringify(e)," to number."))}case"formatted":return tF.fromString(dF(this.args[0].evaluate(t)));case"resolvedImage":return sF.fromString(dF(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return dF(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const vF=["Unknown","Point","LineString","Polygon"];class _F{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?vF[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache.get(t);return e||(e=Kz.parse(t),this._parseColorCache.set(t,e)),e}}class bF{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new nz,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this.registry=t,this.path=n,this.key=n.map(t=>"[".concat(t,"]")).join(""),this.scope=r,this.errors=a,this.expectedType=i,this._isConstant=e}parse(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new mF(e,[t]):"coerce"===n?new yF(e,[t]):t}if((null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t)&&(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found ".concat(typeof i,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;const r=this.registry[i];if(r){let i=r.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,r=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind){if("projectionDefinition"===t.kind&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(t.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(t.kind)&&["value","number","array"].includes(r.kind)||"colorArray"===t.kind&&["value","string","array"].includes(r.kind)||"variableAnchorOffsetCollection"===t.kind&&["value","array"].includes(r.kind))i=n(i,t,e.typeAnnotation||"coerce");else if(this.checkSubtype(t,r))return null}else i=n(i,t,e.typeAnnotation||"assert")}if(!(i instanceof pF)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){const t=new _F;try{i=new pF(i.type,i.evaluate(t))}catch(kX){return this.error(kX.message),null}}return i}return this.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0)}return typeof t>"u"?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found ".concat(typeof t," instead."))}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new bF(this.registry,this._isConstant,i,e||null,r,this.errors)}error(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(t=>"[".concat(t,"]")).join(""));this.errors.push(new ez(r,t))}checkSubtype(t,e){const n=xz(t,e);return n&&this.error(n),n}}class xF{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=e.parse(t[r+1],r+1);if(!a)return null;n.push([i,a])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new xF(n,i):null}outputDefined(){return this.result.outputDefined()}}class wF{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new wF(n,e.scope.get(n)):e.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class SF{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,rz),i=e.parse(t[2],2,vz(e.expectedType||uz));if(!n||!i)return null;const r=i.type;return new SF(r.itemType,n,i)}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new rF("Array index out of bounds: ".concat(e," < 0."));if(e>=n.length)throw new rF("Array index out of bounds: ".concat(e," > ").concat(n.length-1,"."));if(e!==Math.floor(e))throw new rF("Array index must be an integer, but found ".concat(e," instead."));return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class MF{constructor(t,e){this.type=oz,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,uz),i=e.parse(t[2],2,uz);return n&&i?wz(n.type,[oz,az,rz,iz,uz])?new MF(n,i):e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(_z(n.type)," instead")):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!Sz(e,["boolean","string","number","null"]))throw new rF("Expected first argument to be of type boolean, string, number or null, but found ".concat(_z(hF(e))," instead."));if(!Sz(n,["string","array"]))throw new rF("Expected second argument to be of type array or string, but found ".concat(_z(hF(n))," instead."));return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class TF{constructor(t,e,n){this.type=rz,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,uz),i=e.parse(t[2],2,uz);if(!n||!i)return null;if(!wz(n.type,[oz,az,rz,iz,uz]))return e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(_z(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,rz);return r?new TF(n,i,r):null}return new TF(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Sz(e,["boolean","string","number","null"]))throw new rF("Expected first argument to be of type boolean, string, number or null, but found ".concat(_z(hF(e))," instead."));let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(t)),Sz(n,["string"])){const t=n.indexOf(e,i);return-1===t?-1:[...n.slice(0,t)].length}if(Sz(n,["array"]))return n.indexOf(e,i);throw new rF("Expected second argument to be of type array or string, but found ".concat(_z(hF(n))," instead."))}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class AF{constructor(t,e,n,i,r,a){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a}static parse(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!==1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},a=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const s=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,hF(t)))return null}else n=hF(t);if(typeof r[String(t)]<"u")return c.error("Branch labels must be unique.");r[String(t)]=a.length}const u=e.parse(s,l,i);if(!u)return null;i=i||u.type,a.push(u)}const o=e.parse(t[1],1,uz);if(!o)return null;const s=e.parse(t[t.length-1],t.length-1,i);return!s||"value"!==o.type.kind&&e.concat(1).checkSubtype(n,o.type)?null:new AF(n,i,o,r,a,s)}evaluate(t){const e=this.input.evaluate(t);return(hF(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class EF{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!==0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let a=1;a<t.length-1;a+=2){const r=e.parse(t[a],a,oz);if(!r)return null;const o=e.parse(t[a+1],a+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=e.parse(t[t.length-1],t.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new EF(n,i,r)}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(t=>{let[e,n]=t;return n.outputDefined()})&&this.otherwise.outputDefined()}}class CF{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,uz),i=e.parse(t[2],2,rz);if(!n||!i)return null;if(!wz(n.type,[vz(uz),az,uz]))return e.error("Expected first argument to be of type array or string, but found ".concat(_z(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,rz);return r?new CF(n.type,n,i,r):null}return new CF(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);let i;if(this.endIndex&&(i=this.endIndex.evaluate(t)),Sz(e,["string"]))return[...e].slice(n,i).join("");if(Sz(e,["array"]))return e.slice(n,i);throw new rF("Expected first argument to be of type array or string, but found ".concat(_z(hF(e))," instead."))}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function PF(t,e){const n=t.length-1;let i,r,a=0,o=n,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),i=t[s],r=t[s+1],i<=e){if(s===n||e<r)return s;a=s+1}else{if(!(i>e))throw new rF("Input is not a number.");o=s-1}return 0}class IF{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,rz);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let a=1;a<t.length;a+=2){const n=1===a?-1/0:t[a],o=t[a+1],s=a,l=a+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new IF(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);return n[PF(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function LF(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kF,RF;var DF=function(){if(RF)return kF;function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}return RF=1,kF=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},kF}(),NF=LF(DF);class zF{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of r)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(t,e,n,i){let r=0;if("exponential"===t.name)r=FF(e,t.base,n,i);else if("linear"===t.name)r=FF(e,1,n,i);else if("cubic-bezier"===t.name){const a=t.controlPoints;r=new NF(a[0],a[1],a[2],a[3]).solve(FF(e,1,n,i))}return r}static parse(t,e){let[n,i,r,...a]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const t=i.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,rz),!r)return null;const o=[];let s=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||e.expectedType==fz?e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType):s=sz;for(let l=0;l<a.length;l+=2){const t=a[l],n=a[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,s);if(!c)return null;s=s||c.type,o.push([t,c])}return Mz(s,rz)||Mz(s,lz)||Mz(s,sz)||Mz(s,pz)||Mz(s,mz)||Mz(s,fz)||Mz(s,yz)||Mz(s,vz(rz))?new zF(s,n,i,r,o):e.error("Type ".concat(_z(s)," is not interpolatable."))}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const a=PF(e,i),o=e[a],s=e[a+1],l=zF.interpolationFactor(this.interpolation,i,o,s),c=n[a].evaluate(t),u=n[a+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Xz(c,u,l);case"color":return Kz.interpolate(c,u,l);case"padding":return eF.interpolate(c,u,l);case"colorArray":return iF.interpolate(c,u,l);case"numberArray":return nF.interpolate(c,u,l);case"variableAnchorOffsetCollection":return oF.interpolate(c,u,l);case"array":return Yz(c,u,l);case"projectionDefinition":return lF.interpolate(c,u,l)}case"interpolate-hcl":switch(this.type.kind){case"color":return Kz.interpolate(c,u,l,"hcl");case"colorArray":return iF.interpolate(c,u,l,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Kz.interpolate(c,u,l,"lab");case"colorArray":return iF.interpolate(c,u,l,"lab")}}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function FF(t,e,n,i){const r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}Kz.interpolate,eF.interpolate,nF.interpolate,iF.interpolate,oF.interpolate;class OF{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const a of t.slice(1)){const t=e.parse(a,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}if(!n)throw new Error("No output type");return i&&r.some(t=>xz(i,t.type))?new OF(uz,r):new OF(n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof sF&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function BF(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function UF(t,e,n,i){return 0===i.compare(e,n)}function jF(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=oz,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let a=e.parse(t[1],1,uz);if(!a)return null;if(!BF(n,a.type))return e.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(_z(a.type),"'."));let o=e.parse(t[2],2,uz);if(!o)return null;if(!BF(n,o.type))return e.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(_z(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '".concat(_z(a.type),"' and '").concat(_z(o.type),"'."));i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new mF(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new mF(a.type,[o])));let s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(s=e.parse(t[3],3,hz),!s)return null}return new r(a,o,s)}evaluate(r){const a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=hF(a),n=hF(o);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new rF('Expected arguments for "'.concat(t,'" to be (string, string) or (number, number), but found (').concat(e.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const t=hF(a),n=hF(o);if("string"!==t.kind||"string"!==n.kind)return e(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):e(r,a,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const VF=jF("==",function(t,e,n){return e===n},UF),HF=jF("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!UF(0,e,n,i)}),GF=jF("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),WF=jF(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),qF=jF("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),ZF=jF(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class XF{constructor(t,e,n){this.type=hz,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,oz);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,oz);if(!r)return null;let a=null;return n.locale&&(a=e.parse(n.locale,1,az),!a)?null:new XF(i,r,a)}evaluate(t){return new Jz(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class YF{constructor(t,e,n,i,r){this.type=az,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,rz);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,az),!r))return null;let a=null;if(i.currency&&(a=e.parse(i.currency,1,az),!a))return null;let o=null;if(i["min-fraction-digits"]&&(o=e.parse(i["min-fraction-digits"],1,rz),!o))return null;let s=null;return i["max-fraction-digits"]&&(s=e.parse(i["max-fraction-digits"],1,rz),!s)?null:new YF(n,r,a,o,s)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class KF{constructor(t){this.type=dz,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let a=1;a<=t.length-1;++a){const n=t[a];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,rz),!t))return null;let a=null;if(n["text-font"]&&(a=e.parse(n["text-font"],1,vz(az)),!a))return null;let o=null;if(n["text-color"]&&(o=e.parse(n["text-color"],1,sz),!o))return null;let s=null;if(n["vertical-align"]){if("string"==typeof n["vertical-align"]&&!$z.includes(n["vertical-align"]))return e.error("'vertical-align' must be one of: 'bottom', 'center', 'top' but found '".concat(n["vertical-align"],"' instead."));if(s=e.parse(n["vertical-align"],1,az),!s)return null}const l=i[i.length-1];l.scale=t,l.font=a,l.textColor=o,l.verticalAlign=s}else{const n=e.parse(t[a],1,uz);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null,verticalAlign:null})}}return new KF(i)}evaluate(t){return new tF(this.sections.map(e=>{const n=e.content.evaluate(t);return hF(n)===gz?new Qz("",n,null,null,null,e.verticalAlign?e.verticalAlign.evaluate(t):null):new Qz(dF(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null,e.verticalAlign?e.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor),e.verticalAlign&&t(e.verticalAlign)}outputDefined(){return!1}}class JF{constructor(t){this.type=gz,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,az);return n?new JF(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=sF.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class $F{constructor(t){this.type=rz,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found ".concat(_z(n.type)," instead.")):new $F(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return[...e].length;if(Array.isArray(e))return e.length;throw new rF("Expected value to be of type string or array, but found ".concat(_z(hF(e))," instead."))}eachChild(t){t(this.input)}outputDefined(){return!1}}const QF=8192;function tO(t,e){const n=function(t){return(180+t)/360}(t[0]),i=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}(t[1]),r=Math.pow(2,e.z);return[Math.round(n*r*QF),Math.round(i*r*QF)]}function eO(t,e){const n=Math.pow(2,e.z),i=(t[0]/QF+e.x)/n,r=(t[1]/QF+e.y)/n;return[nO(i),iO(r)]}function nO(t){return 360*t-180}function iO(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function rO(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function aO(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function oO(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function sO(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],a=t[0]-n[0],o=t[1]-n[1];return i*o-a*r===0&&i*a<=0&&r*o<=0}function lO(t,e,n,i){const r=[e[0]-t[0],e[1]-t[1]];return 0!==function(t,e){return t[0]*e[1]-t[1]*e[0]}([i[0]-n[0],i[1]-n[1]],r)&&!(!fO(t,e,n,i)||!fO(n,i,t,e))}function cO(t,e,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(lO(t,e,i[n],i[n+1]))return!0;return!1}function uO(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(const r of e)for(let e=0;e<r.length-1;e++){if(sO(t,r[e],r[e+1]))return n;oO(t,r[e],r[e+1])&&(i=!i)}return i}function hO(t,e){for(const n of e)if(uO(t,n))return!0;return!1}function dO(t,e){for(const n of t)if(!uO(n,e))return!1;for(let n=0;n<t.length-1;++n)if(cO(t[n],t[n+1],e))return!1;return!0}function pO(t,e){for(const n of e)if(dO(t,n))return!0;return!1}function fO(t,e,n,i){const r=t[0]-n[0],a=t[1]-n[1],o=e[0]-n[0],s=e[1]-n[1],l=i[0]-n[0],c=i[1]-n[1],u=r*c-l*a,h=o*c-l*s;return u>0&&h<0||u<0&&h>0}function mO(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=[];for(let i=0;i<t[r].length;i++){const o=tO(t[r][i],n);rO(e,o),a.push(o)}i.push(a)}return i}function gO(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=mO(t[r],e,n);i.push(a)}return i}function yO(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}rO(e,t)}function vO(t,e,n,i){const r=Math.pow(2,i.z)*QF,a=[i.x*QF,i.y*QF],o=[];for(const s of t)for(const t of s){const i=[t.x+a[0],t.y+a[1]];yO(i,e,n,r),o.push(i)}return o}function _O(t,e,n,i){const r=Math.pow(2,i.z)*QF,a=[i.x*QF,i.y*QF],o=[];for(const s of t){const t=[];for(const n of s){const i=[n.x+a[0],n.y+a[1]];rO(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){!function(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}(e);for(const t of o)for(const i of t)yO(i,e,n,r)}return o}class bO{constructor(t,e){this.type=oz,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(uF(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const n of e.features){const{type:e,coordinates:i}=n.geometry;"Polygon"===e&&t.push(i),"MultiPolygon"===e&&t.push(...i)}if(t.length){return new bO(e,{type:"MultiPolygon",coordinates:t})}}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new bO(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new bO(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=mO(e.coordinates,i,r),o=vO(t.geometry(),n,i,r);if(!aO(n,i))return!1;for(const t of o)if(!uO(t,a))return!1}if("MultiPolygon"===e.type){const a=gO(e.coordinates,i,r),o=vO(t.geometry(),n,i,r);if(!aO(n,i))return!1;for(const t of o)if(!hO(t,a))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=mO(e.coordinates,i,r),o=_O(t.geometry(),n,i,r);if(!aO(n,i))return!1;for(const t of o)if(!dO(t,a))return!1}if("MultiPolygon"===e.type){const a=gO(e.coordinates,i,r),o=_O(t.geometry(),n,i,r);if(!aO(n,i))return!1;for(const t of o)if(!pO(t,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class xO{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1);const a=i+1;if(a<this.length&&n(e[a],e[i])<0&&(i=a),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}}function wO(t){let e=0;for(let n,i,r=0,a=t.length,o=a-1;r<a;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}const SO=1/298.257223563,MO=SO*(2-SO),TO=Math.PI/180;class AO{constructor(t){const e=6378.137*TO*1e3,n=Math.cos(t*TO),i=1/(1-MO*(1-n*n)),r=Math.sqrt(i);this.kx=e*r*n,this.ky=e*r*i*(1-MO)}distance(t,e){const n=this.wrap(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(t,e){let n,i,r,a,o=1/0;for(let s=0;s<t.length-1;s++){let l=t[s][0],c=t[s][1],u=this.wrap(t[s+1][0]-l)*this.kx,h=(t[s+1][1]-c)*this.ky,d=0;(0!==u||0!==h)&&(d=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=t[s+1][0],c=t[s+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<o&&(o=p,n=l,i=c,r=s,a=d)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,a))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function EO(t,e){return e[0]-t[0]}function CO(t){return t[1]-t[0]+1}function PO(t,e){return t[1]>=t[0]&&t[1]<e}function IO(t,e){if(t[0]>t[1])return[null,null];const n=CO(t);if(e){if(2===n)return[t,null];const e=Math.floor(n/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}function LO(t,e){if(!PO(e,t.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let i=e[0];i<=e[1];++i)rO(n,t[i]);return n}function kO(t){const e=[1/0,1/0,-1/0,-1/0];for(const n of t)for(const t of n)rO(e,t);return e}function RO(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function DO(t,e,n){if(!RO(t)||!RO(e))return NaN;let i=0,r=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),n.distance([0,0],[i,r])}function NO(t,e,n){const i=n.pointOnLine(e,t);return n.distance(t,i.point)}function zO(t,e,n,i,r){const a=Math.min(NO(t,[n,i],r),NO(e,[n,i],r)),o=Math.min(NO(n,[t,e],r),NO(i,[t,e],r));return Math.min(a,o)}function FO(t,e,n,i,r){if(!PO(e,t.length)||!PO(i,n.length))return 1/0;let a=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(let t=i[0];t<i[1];++t){const i=n[t],o=n[t+1];if(lO(e,s,i,o))return 0;a=Math.min(a,zO(e,s,i,o,r))}}return a}function OO(t,e,n,i,r){if(!PO(e,t.length)||!PO(i,n.length))return NaN;let a=1/0;for(let o=e[0];o<=e[1];++o)for(let e=i[0];e<=i[1];++e)if(a=Math.min(a,r.distance(t[o],n[e])),0===a)return a;return a}function BO(t,e,n){if(uO(t,e,!0))return 0;let i=1/0;for(const r of e){const e=r[0],a=r[r.length-1];if(e!==a&&(i=Math.min(i,NO(t,[a,e],n)),0===i))return i;const o=n.pointOnLine(r,t);if(i=Math.min(i,n.distance(t,o.point)),0===i)return i}return i}function UO(t,e,n,i){if(!PO(e,t.length))return NaN;for(let a=e[0];a<=e[1];++a)if(uO(t[a],n,!0))return 0;let r=1/0;for(let a=e[0];a<e[1];++a){const e=t[a],o=t[a+1];for(const t of n)for(let n=0,a=t.length,s=a-1;n<a;s=n++){const a=t[s],l=t[n];if(lO(e,o,a,l))return 0;r=Math.min(r,zO(e,o,a,l,i))}}return r}function jO(t,e){for(const n of t)for(const t of n)if(uO(t,e,!0))return!0;return!1}function VO(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=kO(t),a=kO(e);if(i!==1/0&&DO(r,a,n)>=i)return i;if(aO(r,a)){if(jO(t,e))return 0}else if(jO(e,t))return 0;let o=1/0;for(const s of t)for(let t=0,i=s.length,r=i-1;t<i;r=t++){const i=s[r],a=s[t];for(const t of e)for(let e=0,r=t.length,s=r-1;e<r;s=e++){const r=t[s],l=t[e];if(lO(i,a,r,l))return 0;o=Math.min(o,zO(i,a,r,l,n))}}return o}function HO(t,e,n,i,r,a){if(!a)return;const o=DO(LO(i,a),r,n);o<e&&t.push([o,a,[0,0]])}function GO(t,e,n,i,r,a,o){if(!a||!o)return;const s=DO(LO(i,a),LO(r,o),n);s<e&&t.push([s,a,o])}function WO(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=Math.min(i.distance(t[0],n[0][0]),r);if(0===a)return a;const o=new xO([[0,[0,t.length-1],[0,0]]],EO),s=kO(n);for(;o.length>0;){const r=o.pop();if(r[0]>=a)continue;const l=r[1],c=e?50:100;if(CO(l)<=c){if(!PO(l,t.length))return NaN;if(e){const e=UO(t,l,n,i);if(isNaN(e)||0===e)return e;a=Math.min(a,e)}else for(let e=l[0];e<=l[1];++e){const r=BO(t[e],n,i);if(a=Math.min(a,r),0===a)return 0}}else{const n=IO(l,e);HO(o,a,i,t,s,n[0]),HO(o,a,i,t,s,n[1])}}return a}function qO(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(a,r.distance(t[0],n[0]));if(0===o)return o;const s=new xO([[0,[0,t.length-1],[0,n.length-1]]],EO);for(;s.length>0;){const a=s.pop();if(a[0]>=o)continue;const l=a[1],c=a[2],u=e?50:100,h=i?50:100;if(CO(l)<=u&&CO(c)<=h){if(!PO(l,t.length)&&PO(c,n.length))return NaN;let a;if(e&&i)a=FO(t,l,n,c,r),o=Math.min(o,a);else if(e&&!i){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(a=NO(n[t],e,r),o=Math.min(o,a),0===o)return o}else if(!e&&i){const e=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(a=NO(t[n],e,r),o=Math.min(o,a),0===o)return o}else a=OO(t,l,n,c,r),o=Math.min(o,a)}else{const a=IO(l,e),u=IO(c,i);GO(s,o,r,t,n,a[0],u[0]),GO(s,o,r,t,n,a[0],u[1]),GO(s,o,r,t,n,a[1],u[0]),GO(s,o,r,t,n,a[1],u[1])}}return o}function ZO(t,e){const n=t.geometry();if(0===n.length||0===n[0].length)return NaN;const i=function(t){if(t.length<=1)return[t];const e=[];let n,i;for(const r of t){const t=wO(r);0!==t&&(r.area=Math.abs(t),void 0===i&&(i=t<0),i===t<0?(n&&e.push(n),n=[r]):n.push(r))}return n&&e.push(n),e}(n).map(e=>e.map(e=>e.map(e=>eO([e.x,e.y],t.canonical)))),r=new AO(i[0][0][0][1]);let a=1/0;for(const o of e)for(const t of i){switch(o.type){case"Point":a=Math.min(a,WO([o.coordinates],!1,t,r,a));break;case"LineString":a=Math.min(a,WO(o.coordinates,!0,t,r,a));break;case"Polygon":a=Math.min(a,VO(t,o.coordinates,r,a))}if(0===a)return a}return a}function XO(t){return"MultiPolygon"===t.type?t.coordinates.map(t=>({type:"Polygon",coordinates:t})):"MultiLineString"===t.type?t.coordinates.map(t=>({type:"LineString",coordinates:t})):"MultiPoint"===t.type?t.coordinates.map(t=>({type:"Point",coordinates:t})):[t]}class YO{constructor(t,e){this.type=rz,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'distance' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(uF(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new YO(e,e.features.map(t=>XO(t.geometry)).flat());if("Feature"===e.type)return new YO(e,XO(e.geometry));if("type"in e&&"coordinates"in e)return new YO(e,XO(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>eO([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new AO(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,qO(i,!1,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,qO(i,!1,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,WO(i,!1,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>eO([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new AO(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,qO(i,!0,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,qO(i,!0,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,WO(i,!0,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("Polygon"===t.geometryType())return ZO(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class KO{constructor(t){this.type=uz,this.key=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=t[1];return null==n?e.error("Global state property must be defined."):"string"!=typeof n?e.error("Global state property must be string, but found ".concat(typeof t[1]," instead.")):new KO(n)}evaluate(t){var e;const n=null===(e=t.globals)||void 0===e?void 0:e.globalState;return n&&0!==Object.keys(n).length?jz(n,this.key):null}eachChild(){}outputDefined(){return!1}}const JO={"==":VF,"!=":HF,">":WF,"<":GF,">=":ZF,"<=":qF,array:mF,at:SF,boolean:mF,case:EF,coalesce:OF,collator:XF,format:KF,image:JF,in:MF,"index-of":TF,interpolate:zF,"interpolate-hcl":zF,"interpolate-lab":zF,length:$F,let:xF,literal:pF,match:AF,number:mF,"number-format":YF,object:mF,slice:CF,step:IF,string:mF,"to-boolean":yF,"to-color":yF,"to-number":yF,"to-string":yF,var:wF,within:bO,distance:YO,"global-state":KO};class $O{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const n=t[0],i=$O.definitions[n];if(!i)return e.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(e=>{let[n]=e;return!Array.isArray(n)||n.length===t.length-1});let s=null;for(const[l,c]of o){s=new bF(e.registry,iB,e.path,null,e.scope);const i=[];let a=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=s.parse(n,1+i.length,r);if(!o){a=!0;break}i.push(o)}if(!a){if(Array.isArray(l)&&l.length!==i.length){s.error("Expected ".concat(l.length," arguments, but found ").concat(i.length," instead."));continue}for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];s.concat(t+1).checkSubtype(e,n.type)}if(0===s.errors.length)return new $O(n,r,c,i)}}if(1===o.length)e.errors.push(...s.errors);else{const n=(o.length?o:a).map(t=>{let[e]=t;return n=e,Array.isArray(n)?"(".concat(n.map(_z).join(", "),")"):"(".concat(_z(n.type),"...)");var n}).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(_z(n.type))}e.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(t,e){$O.definitions=e;for(const n in e)t[n]=$O}}function QO(t,e){let[n,i,r,a]=e;n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=a?a.evaluate(t):1,s=cF(n,i,r,o);if(s)throw new rF(s);return new Kz(n/255,i/255,r/255,o,!1)}function tB(t,e){return t in e}function eB(t,e){const n=e[t];return typeof n>"u"?null:n}function nB(t){return{type:t}}function iB(t){if(t instanceof wF)return iB(t.boundExpression);if(t instanceof $O&&"error"===t.name)return!1;if(t instanceof XF)return!1;if(t instanceof bO)return!1;if(t instanceof YO)return!1;if(t instanceof KO)return!1;const e=t instanceof yF||t instanceof mF;let n=!0;return t.eachChild(t=>{n=e?n&&iB(t):n&&t instanceof pF}),!!n&&(rB(t)&&oB(t,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]))}function rB(t){if(t instanceof $O){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof bO||t instanceof YO)return!1;let e=!0;return t.eachChild(t=>{e&&!rB(t)&&(e=!1)}),e}function aB(t){if(t instanceof $O&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!aB(t)&&(e=!1)}),e}function oB(t,e){if(t instanceof $O&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!oB(t,e)&&(n=!1)}),n}function sB(t){return{result:"success",value:t}}function lB(t){return{result:"error",value:t}}function cB(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function uB(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function hB(t){return!!t.expression&&t.expression.interpolated}function dB(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function pB(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)&&hF(t)===cz}$O.register(JO,{error:[{kind:"error"},[az],(t,e)=>{let[n]=e;throw new rF(n.evaluate(t))}],typeof:[az,[uz],(t,e)=>{let[n]=e;return _z(hF(n.evaluate(t)))}],"to-rgba":[vz(rz,4),[sz],(t,e)=>{let[n]=e;const[i,r,a,o]=n.evaluate(t).rgb;return[255*i,255*r,255*a,o]}],rgb:[sz,[rz,rz,rz],QO],rgba:[sz,[rz,rz,rz,rz],QO],has:{type:oz,overloads:[[[az],(t,e)=>{let[n]=e;return tB(n.evaluate(t),t.properties())}],[[az,cz],(t,e)=>{let[n,i]=e;return tB(n.evaluate(t),i.evaluate(t))}]]},get:{type:uz,overloads:[[[az],(t,e)=>{let[n]=e;return eB(n.evaluate(t),t.properties())}],[[az,cz],(t,e)=>{let[n,i]=e;return eB(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[uz,[az],(t,e)=>{let[n]=e;return eB(n.evaluate(t),t.featureState||{})}],properties:[cz,[],t=>t.properties()],"geometry-type":[az,[],t=>t.geometryType()],id:[uz,[],t=>t.id()],zoom:[rz,[],t=>t.globals.zoom],"heatmap-density":[rz,[],t=>t.globals.heatmapDensity||0],elevation:[rz,[],t=>t.globals.elevation||0],"line-progress":[rz,[],t=>t.globals.lineProgress||0],accumulated:[uz,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[rz,nB(rz),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[rz,nB(rz),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:rz,overloads:[[[rz,rz],(t,e)=>{let[n,i]=e;return n.evaluate(t)-i.evaluate(t)}],[[rz],(t,e)=>{let[n]=e;return-n.evaluate(t)}]]},"/":[rz,[rz,rz],(t,e)=>{let[n,i]=e;return n.evaluate(t)/i.evaluate(t)}],"%":[rz,[rz,rz],(t,e)=>{let[n,i]=e;return n.evaluate(t)%i.evaluate(t)}],ln2:[rz,[],()=>Math.LN2],pi:[rz,[],()=>Math.PI],e:[rz,[],()=>Math.E],"^":[rz,[rz,rz],(t,e)=>{let[n,i]=e;return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[rz,[rz],(t,e)=>{let[n]=e;return Math.sqrt(n.evaluate(t))}],log10:[rz,[rz],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN10}],ln:[rz,[rz],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))}],log2:[rz,[rz],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN2}],sin:[rz,[rz],(t,e)=>{let[n]=e;return Math.sin(n.evaluate(t))}],cos:[rz,[rz],(t,e)=>{let[n]=e;return Math.cos(n.evaluate(t))}],tan:[rz,[rz],(t,e)=>{let[n]=e;return Math.tan(n.evaluate(t))}],asin:[rz,[rz],(t,e)=>{let[n]=e;return Math.asin(n.evaluate(t))}],acos:[rz,[rz],(t,e)=>{let[n]=e;return Math.acos(n.evaluate(t))}],atan:[rz,[rz],(t,e)=>{let[n]=e;return Math.atan(n.evaluate(t))}],min:[rz,nB(rz),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[rz,nB(rz),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[rz,[rz],(t,e)=>{let[n]=e;return Math.abs(n.evaluate(t))}],round:[rz,[rz],(t,e)=>{let[n]=e;const i=n.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[rz,[rz],(t,e)=>{let[n]=e;return Math.floor(n.evaluate(t))}],ceil:[rz,[rz],(t,e)=>{let[n]=e;return Math.ceil(n.evaluate(t))}],"filter-==":[oz,[az,uz],(t,e)=>{let[n,i]=e;return t.properties()[n.value]===i.value}],"filter-id-==":[oz,[uz],(t,e)=>{let[n]=e;return t.id()===n.value}],"filter-type-==":[oz,[az],(t,e)=>{let[n]=e;return t.geometryType()===n.value}],"filter-<":[oz,[az,uz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[oz,[uz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[oz,[az,uz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[oz,[uz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[oz,[az,uz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[oz,[uz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[oz,[az,uz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[oz,[uz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[oz,[uz],(t,e)=>{let[n]=e;return n.value in t.properties()}],"filter-has-id":[oz,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[oz,[vz(az)],(t,e)=>{let[n]=e;return n.value.indexOf(t.geometryType())>=0}],"filter-id-in":[oz,[vz(uz)],(t,e)=>{let[n]=e;return n.value.indexOf(t.id())>=0}],"filter-in-small":[oz,[az,vz(uz)],(t,e)=>{let[n,i]=e;return i.value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[oz,[az,vz(uz)],(t,e)=>{let[n,i]=e;return function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:oz,overloads:[[[oz,oz],(t,e)=>{let[n,i]=e;return n.evaluate(t)&&i.evaluate(t)}],[nB(oz),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:oz,overloads:[[[oz,oz],(t,e)=>{let[n,i]=e;return n.evaluate(t)||i.evaluate(t)}],[nB(oz),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[oz,[oz],(t,e)=>{let[n]=e;return!n.evaluate(t)}],"is-supported-script":[oz,[az],(t,e)=>{let[n]=e;const i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[az,[az],(t,e)=>{let[n]=e;return n.evaluate(t).toUpperCase()}],downcase:[az,[az],(t,e)=>{let[n]=e;return n.evaluate(t).toLowerCase()}],concat:[az,nB(uz),(t,e)=>e.map(e=>dF(e.evaluate(t))).join("")],"resolved-locale":[az,[hz],(t,e)=>{let[n]=e;return n.evaluate(t).resolvedLocale()}]});class fB{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new _F,this._defaultValue=e?function(t){if("color"===t.type&&pB(t.default))return new Kz(0,0,0,0);switch(t.type){case"color":return Kz.parse(t.default)||null;case"padding":return eF.parse(t.default)||null;case"numberArray":return nF.parse(t.default)||null;case"colorArray":return iF.parse(t.default)||null;case"variableAnchorOffsetCollection":return oF.parse(t.default)||null;case"projectionDefinition":return lF.parse(t.default)||null;default:return void 0===t.default?null:t.default}}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!==t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new rF("Expected value to be one of ".concat(Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", "),", but found ").concat(JSON.stringify(t)," instead."));return t}catch(PX){return this._warningHistory[PX.message]||(this._warningHistory[PX.message]=!0,typeof console<"u"&&console.warn(PX.message)),this._defaultValue}}}function mB(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in JO}function gB(t,e){const n=new bF(JO,iB,[],e?function(t){const e={color:sz,string:az,number:rz,enum:az,boolean:oz,formatted:dz,padding:pz,numberArray:mz,colorArray:fz,projectionDefinition:lz,resolvedImage:gz,variableAnchorOffsetCollection:yz};return"array"===t.type?vz(e[t.value]||uz,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?sB(new fB(i,e)):lB(n.errors)}class yB{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!aB(e.expression),this.globalStateRefs=xB(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}}class vB{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!aB(e.expression),this.globalStateRefs=xB(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}interpolationFactor(t,e,n){return this.interpolationType?zF.interpolationFactor(this.interpolationType,t,e,n):0}}function _B(t,e){const n=gB(t,e);if("error"===n.result)return n;const i=n.value.expression,r=rB(i);if(!r&&!cB(e))return lB([new ez("","data expressions not supported")]);const a=oB(i,["zoom"]);if(!a&&!uB(e))return lB([new ez("","zoom expressions not supported")]);const o=bB(i);if(!o&&!a)return lB([new ez("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof ez)return lB([o]);if(o instanceof zF&&!hB(e))return lB([new ez("",'"interpolate" expressions cannot be used with this property')]);if(!o)return sB(new yB(r?"constant":"source",n.value));const s=o instanceof zF?o.interpolation:void 0;return sB(new vB(r?"camera":"composite",n.value,o.labels,s))}function bB(t){let e=null;if(t instanceof xF)e=bB(t.result);else if(t instanceof OF){for(const n of t.args)if(e=bB(n),e)break}else(t instanceof IF||t instanceof zF)&&t.input instanceof $O&&"zoom"===t.input.name&&(e=t);return e instanceof ez||t.eachChild(t=>{const n=bB(t);n instanceof ez?e=n:!e&&n?e=new ez("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new ez("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function xB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return t instanceof KO&&e.add(t.key),t.eachChild(t=>{xB(t,e)}),e}function wB(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!wB(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function SB(t){const e=t.key,n=t.value;return n?[new QN(e,n,"constants have been deprecated as of v8")]:[]}function MB(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function TB(t){if(Array.isArray(t))return t.map(TB);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=TB(t[n]);return e}return MB(t)}function AB(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=t.validateSpec;let l=[];const c=dB(n);if("object"!==c)return[new QN(e,n,"object expected, ".concat(c," found"))];for(const u in n){const t=u.split(".")[0],c=jz(i,t)||i["*"];let h;if(jz(r,t))h=r[t];else if(jz(i,t))h=s;else if(r["*"])h=r["*"];else{if(!i["*"]){l.push(new QN(e,n[u],'unknown property "'.concat(u,'"')));continue}h=s}l=l.concat(h({key:(e&&"".concat(e,"."))+u,value:n[u],valueSpec:c,style:a,styleSpec:o,object:n,objectKey:u,validateSpec:s},n))}for(const u in i)r[u]||i[u].required&&void 0===i[u].default&&void 0===n[u]&&l.push(new QN(e,n,'missing required property "'.concat(u,'"')));return l}function EB(t){const e=t.value,n=t.valueSpec,i=t.validateSpec,r=t.style,a=t.styleSpec,o=t.key,s=t.arrayElementValidator||i;if("array"!==dB(e))return[new QN(o,e,"array expected, ".concat(dB(e)," found"))];if(n.length&&e.length!==n.length)return[new QN(o,e,"array length ".concat(n.length," expected, length ").concat(e.length," found"))];if(n["min-length"]&&e.length<n["min-length"])return[new QN(o,e,"array length at least ".concat(n["min-length"]," expected, length ").concat(e.length," found"))];let l={type:n.value,values:n.values};a.$version<7&&(l.function=n.function),"object"===dB(n.value)&&(l=n.value);let c=[];for(let u=0;u<e.length;u++)c=c.concat(s({array:e,arrayIndex:u,value:e[u],valueSpec:l,validateSpec:t.validateSpec,style:r,styleSpec:a,key:"".concat(o,"[").concat(u,"]")}));return c}function CB(t){const e=t.key,n=t.value,i=t.valueSpec;let r=dB(n);return"number"===r&&n!==n&&(r="NaN"),"number"!==r?[new QN(e,n,"number expected, ".concat(r," found"))]:"minimum"in i&&n<i.minimum?[new QN(e,n,"".concat(n," is less than the minimum value ").concat(i.minimum))]:"maximum"in i&&n>i.maximum?[new QN(e,n,"".concat(n," is greater than the maximum value ").concat(i.maximum))]:[]}function PB(t){const e=t.valueSpec,n=MB(t.value.type);let i,r,a,o={};const s="categorical"!==n&&void 0===t.value.property,l=!s,c="array"===dB(t.value.stops)&&"array"===dB(t.value.stops[0])&&"object"===dB(t.value.stops[0][0]),u=AB({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new QN(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(EB({key:t.key,value:i,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===dB(i)&&0===i.length&&e.push(new QN(t.key,i,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&s&&u.push(new QN(t.key,t.value,'missing required property "property"')),"identity"!==n&&!t.value.stops&&u.push(new QN(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!hB(t.valueSpec)&&u.push(new QN(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!cB(t.valueSpec)?u.push(new QN(t.key,t.value,"property functions not supported")):s&&!uB(t.valueSpec)&&u.push(new QN(t.key,t.value,"zoom functions not supported"))),("categorical"===n||c)&&void 0===t.value.property&&u.push(new QN(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,s=t.key;if("array"!==dB(i))return[new QN(s,i,"array expected, ".concat(dB(i)," found"))];if(2!==i.length)return[new QN(s,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==dB(i[0]))return[new QN(s,i,"object expected, ".concat(dB(i[0])," found"))];if(void 0===i[0].zoom)return[new QN(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new QN(s,i,"object stop key must have value")];if(a&&a>MB(i[0].zoom))return[new QN(s,i[0].zoom,"stop zoom values must appear in ascending order")];MB(i[0].zoom)!==a&&(a=MB(i[0].zoom),r=void 0,o={}),n=n.concat(AB({key:"".concat(s,"[0]"),value:i[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:CB,value:d}}))}else n=n.concat(d({key:"".concat(s,"[0]"),value:i[0],validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},i));return mB(TB(i[1]))?n.concat([new QN("".concat(s,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(t.validateSpec({key:"".concat(s,"[1]"),value:i[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,a){const s=dB(t.value),l=MB(t.value),c=null!==t.value?t.value:a;if(i){if(s!==i)return[new QN(t.key,c,"".concat(s," stop domain type must match previous stop domain type ").concat(i))]}else i=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new QN(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let i="number expected, ".concat(s," found");return cB(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new QN(t.key,c,i)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==r&&l<r?[new QN(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new QN(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new QN(t.key,c,"integer expected, found ".concat(l))]}}function IB(t){const e=("property"===t.expressionContext?_B:gB)(TB(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new QN("".concat(t.key).concat(e.key),t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new QN(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!aB(n))return[new QN(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!aB(n))return[new QN(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!oB(n,["zoom","feature-state"]))return[new QN(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!rB(n))return[new QN(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function LB(t){const e=t.key,n=t.value,i=dB(n);return"string"!==i?[new QN(e,n,"color expected, ".concat(i," found"))]:Kz.parse(String(n))?[]:[new QN(e,n,'color expected, "'.concat(n,'" found'))]}function kB(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(MB(n))&&r.push(new QN(e,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(MB(n))&&r.push(new QN(e,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function RB(t){return wB(TB(t.value))?IB(tz({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):DB(t)}function DB(t){const e=t.value,n=t.key;if("array"!==dB(e))return[new QN(n,e,"array expected, ".concat(dB(e)," found"))];const i=t.styleSpec;let r,a=[];if(e.length<1)return[new QN(n,e,"filter array must have at least 1 element")];switch(a=a.concat(kB({key:"".concat(n,"[0]"),value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),MB(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===MB(e[1])&&a.push(new QN(n,e,'"$type" cannot be use with operator "'.concat(e[0],'"')));case"==":case"!=":3!==e.length&&a.push(new QN(n,e,'filter array for operator "'.concat(e[0],'" must have 3 elements')));case"in":case"!in":e.length>=2&&(r=dB(e[1]),"string"!==r&&a.push(new QN("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found"))));for(let o=2;o<e.length;o++)r=dB(e[o]),"$type"===MB(e[1])?a=a.concat(kB({key:"".concat(n,"[").concat(o,"]"),value:e[o],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new QN("".concat(n,"[").concat(o,"]"),e[o],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)a=a.concat(DB({key:"".concat(n,"[").concat(i,"]"),value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=dB(e[1]),2!==e.length?a.push(new QN(n,e,'filter array for "'.concat(e[0],'" operator must have 2 elements'))):"string"!==r&&a.push(new QN("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found")))}return a}function NB(t,e){const n=t.key,i=t.validateSpec,r=t.style,a=t.styleSpec,o=t.value,s=t.objectKey,l=a["".concat(e,"_").concat(t.layerType)];if(!l)return[];const c=s.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return i({key:n,value:o,valueSpec:a.transition,style:r,styleSpec:a});const u=t.valueSpec||l[s];if(!u)return[new QN(n,o,'unknown property "'.concat(s,'"'))];let h;if("string"===dB(o)&&cB(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(o)))return[new QN(n,o,'"'.concat(s,'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": ').concat(JSON.stringify(h[1])," }`."))];const d=[];return"symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&d.push(new QN(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&pB(TB(o))&&"identity"===MB(o.type)&&d.push(new QN(n,o,'"text-font" does not support identity functions'))),d.concat(i({key:t.key,value:o,valueSpec:u,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:s}))}function zB(t){return NB(t,"paint")}function FB(t){return NB(t,"layout")}function OB(t){let e=[];const n=t.value,i=t.key,r=t.style,a=t.styleSpec;if("object"!==dB(n))return[new QN(i,n,"object expected, ".concat(dB(n)," found"))];!n.type&&!n.ref&&e.push(new QN(i,n,'either "type" or "ref" is required'));let o=MB(n.type);const s=MB(n.ref);if(n.id){const a=MB(n.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];MB(t.id)===a&&e.push(new QN(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new QN(i,n[t],'"'.concat(t,'" is prohibited for ref layers')))}),r.layers.forEach(e=>{MB(e.id)===s&&(t=e)}),t?t.ref?e.push(new QN(i,n.ref,"ref cannot reference another ref layer")):o=MB(t.type):e.push(new QN(i,n.ref,'ref layer "'.concat(s,'" not found')))}else if("background"!==o)if(n.source){const t=r.sources&&r.sources[n.source],a=t&&MB(t.type);t?"vector"===a&&"raster"===o?e.push(new QN(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster-dem"!==a&&"hillshade"===o||"raster-dem"!==a&&"color-relief"===o?e.push(new QN(i,n.source,'layer "'.concat(n.id,'" requires a raster-dem source'))):"raster"===a&&"raster"!==o?e.push(new QN(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==o&&"color-relief"!==o?e.push(new QN(i,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"===o&&n.paint&&n.paint["line-gradient"]&&("geojson"!==a||!t.lineMetrics)&&e.push(new QN(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):e.push(new QN(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):e.push(new QN(i,n.source,'source "'.concat(n.source,'" not found')))}else e.push(new QN(i,n,'missing required property "source"'));return e=e.concat(AB({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:"".concat(i,".type"),value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:n,objectKey:"type"}),filter:RB,layout:t=>AB({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>FB(tz({layerType:o},t))}}),paint:t=>AB({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>zB(tz({layerType:o},t))}})}})),e}function BB(t){const e=t.value,n=t.key,i=dB(e);return"string"!==i?[new QN(n,e,"string expected, ".concat(i," found"))]:[]}const UB={promoteId:function(t){let{key:e,value:n}=t;if("string"===dB(n))return BB({key:e,value:n});{const t=[];for(const i in n)t.push(...BB({key:"".concat(e,".").concat(i),value:n[i]}));return t}}};function jB(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style,a=t.validateSpec;if(!e.type)return[new QN(n,e,'"type" is required')];const o=MB(e.type);let s;switch(o){case"vector":case"raster":return s=AB({key:n,value:e,valueSpec:i["source_".concat(o.replace("-","_"))],style:t.style,styleSpec:i,objectElementValidators:UB,validateSpec:a}),s;case"raster-dem":return s=function(t){var e;const n=null!==(e=t.sourceName)&&void 0!==e?e:"",i=t.value,r=t.styleSpec,a=r.source_raster_dem,o=t.style;let s=[];const l=dB(i);if(void 0===i)return s;if("object"!==l)return s.push(new QN("source_raster_dem",i,"object expected, ".concat(l," found"))),s;const c="custom"===MB(i.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?'"'.concat(t.value.encoding,'"'):"Default";for(const d in i)!c&&u.includes(d)?s.push(new QN(d,i[d],'In "'.concat(n,'": "').concat(d,'" is only valid when "encoding" is set to "custom". ').concat(h," encoding found"))):a[d]?s=s.concat(t.validateSpec({key:d,value:i[d],valueSpec:a[d],validateSpec:t.validateSpec,style:o,styleSpec:r})):s.push(new QN(d,i[d],'unknown property "'.concat(d,'"')));return s}({sourceName:n,value:e,style:t.style,styleSpec:i,validateSpec:a}),s;case"geojson":if(s=AB({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,validateSpec:a,objectElementValidators:UB}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],a="string"==typeof i?[i,["accumulated"],["get",t]]:i;s.push(...IB({key:"".concat(n,".").concat(t,".map"),value:r,expressionContext:"cluster-map"})),s.push(...IB({key:"".concat(n,".").concat(t,".reduce"),value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return AB({key:n,value:e,valueSpec:i.source_video,style:r,validateSpec:a,styleSpec:i});case"image":return AB({key:n,value:e,valueSpec:i.source_image,style:r,validateSpec:a,styleSpec:i});case"canvas":return[new QN(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kB({key:"".concat(n,".type"),value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function VB(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let a=[];const o=dB(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new QN("light",e,"object expected, ".concat(o," found"))]),a;for(const s in e){const o=s.match(/^(.*)-transition$/);a=o&&i[o[1]]&&i[o[1]].transition?a.concat(t.validateSpec({key:s,value:e[s],valueSpec:n.transition,validateSpec:t.validateSpec,style:r,styleSpec:n})):i[s]?a.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n})):a.concat([new QN(s,e[s],'unknown property "'.concat(s,'"'))])}return a}function HB(t){const e=t.value,n=t.styleSpec,i=n.sky,r=t.style,a=dB(e);if(void 0===e)return[];if("object"!==a)return[new QN("sky",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=i[s]?o.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):o.concat([new QN(s,e[s],'unknown property "'.concat(s,'"'))]);return o}function GB(t){const e=t.value,n=t.styleSpec,i=n.terrain,r=t.style;let a=[];const o=dB(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new QN("terrain",e,"object expected, ".concat(o," found"))]),a;for(const s in e)a=i[s]?a.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n})):a.concat([new QN(s,e[s],'unknown property "'.concat(s,'"'))]);return a}function WB(t){let e=[];const n=t.value,i=t.key;if(Array.isArray(n)){const r=[],a=[];for(const o in n){n[o].id&&r.includes(n[o].id)&&e.push(new QN(i,n,"all the sprites' ids must be unique, but ".concat(n[o].id," is duplicated"))),r.push(n[o].id),n[o].url&&a.includes(n[o].url)&&e.push(new QN(i,n,"all the sprites' URLs must be unique, but ".concat(n[o].url," is duplicated"))),a.push(n[o].url);const s={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(AB({key:"".concat(i,"[").concat(o,"]"),value:n[o],valueSpec:s,validateSpec:t.validateSpec}))}return e}return BB({key:i,value:n})}function qB(t){return function(t){return!!t&&t.constructor===Object}(t.value)?[]:[new QN(t.key,t.value,"object expected, ".concat(dB(t.value)," found"))]}const ZB={"*":()=>[],array:EB,boolean:function(t){const e=t.value,n=t.key,i=dB(e);return"boolean"!==i?[new QN(n,e,"boolean expected, ".concat(i," found"))]:[]},number:CB,color:LB,constants:SB,enum:kB,filter:RB,function:PB,layer:OB,object:AB,source:jB,light:VB,sky:HB,terrain:GB,projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,r=t.style,a=dB(e);if(void 0===e)return[];if("object"!==a)return[new QN("projection",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=i[s]?o.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):o.concat([new QN(s,e[s],'unknown property "'.concat(s,'"'))]);return o},projectionDefinition:function(t){const e=t.key;let n=t.value;n=n instanceof String?n.valueOf():n;const i=dB(n);return"array"!==i||function(t){return Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]}(n)||function(t){return!!["interpolate","step","literal"].includes(t[0])}(n)?["array","string"].includes(i)?[]:[new QN(e,n,'projection expected, invalid type "'.concat(i,'" found'))]:[new QN(e,n,"projection expected, invalid array ".concat(JSON.stringify(n)," found"))]},string:BB,formatted:function(t){return 0===BB(t).length?[]:IB(t)},resolvedImage:function(t){return 0===BB(t).length?[]:IB(t)},padding:function(t){const e=t.key,n=t.value;if("array"===dB(n)){if(n.length<1||n.length>4)return[new QN(e,n,"padding requires 1 to 4 values; ".concat(n.length," values found"))];const i={type:"number"};let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return CB({key:e,value:n,valueSpec:{}})},numberArray:function(t){const e=t.key,n=t.value;if("array"===dB(n)){const i={type:"number"};if(n.length<1)return[new QN(e,n,"array length at least 1 expected, length 0 found")];let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return CB({key:e,value:n,valueSpec:{}})},colorArray:function(t){const e=t.key,n=t.value;if("array"===dB(n)){if(n.length<1)return[new QN(e,n,"array length at least 1 expected, length 0 found")];let t=[];for(let i=0;i<n.length;i++)t=t.concat(LB({key:"".concat(e,"[").concat(i,"]"),value:n[i]}));return t}return LB({key:e,value:n})},variableAnchorOffsetCollection:function(t){const e=t.key,n=t.value,i=dB(n),r=t.styleSpec;if("array"!==i||n.length<1||n.length%2!==0)return[new QN(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let o=0;o<n.length;o+=2)a=a.concat(kB({key:"".concat(e,"[").concat(o,"]"),value:n[o],valueSpec:r.layout_symbol["text-anchor"]})),a=a.concat(EB({key:"".concat(e,"[").concat(o+1,"]"),value:n[o+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:r}));return a},sprite:WB,state:qB};function XB(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return t.validateSpec=XB,n.expression&&pB(MB(e))?PB(t):n.expression&&mB(TB(e))?IB(t):n.type&&ZB[n.type]?ZB[n.type](t):AB(tz({},t,{valueSpec:n.type?i[n.type]:n}))}function YB(t){const e=t.value,n=t.key,i=BB(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new QN(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new QN(n,e,'"glyphs" url must include a "{range}" token'))),i}function KB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$N,n=[];return n=n.concat(XB({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:XB,objectElementValidators:{glyphs:YB,"*":()=>[]}})),t.constants&&(n=n.concat(SB({key:"constants",value:t.constants}))),$B(n)}function JB(t){return function(e){return t(kt(kt({},e),{},{validateSpec:XB}))}}function $B(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function QB(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return $B(t.apply(this,n))}}function tU(t){if(!t)return{style:HD[jD[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if("string"==typeof t){const e=function(t){try{const e=JSON.parse(t),n=KB(e);return{isValidJSON:!0,isValidStyle:0===n.length,styleObject:0===n.length?e:null}}catch(e){return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}(t);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:HD[jD[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:t.startsWith("http")?{style:t,requiresUrlMonitoring:!0,isFallback:!1}:t.toLowerCase().includes(".json")?{style:eU(t),requiresUrlMonitoring:!0,isFallback:!1}:{style:OD(t),requiresUrlMonitoring:!0,isFallback:!1}}return t instanceof BD?{style:t.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:t instanceof UD?{style:t.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:0===KB(t).length?{style:t,requiresUrlMonitoring:!1,isFallback:!1}:{style:HD[jD[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function eU(t){try{return new URL(t).href}catch(e){}return new URL(t,location.origin).href}function nU(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}function iU(t){t.parentNode&&t.parentNode.removeChild(t)}KB.source=QB(JB(jB)),KB.sprite=QB(JB(WB)),KB.glyphs=QB(JB(YB)),KB.light=QB(JB(VB)),KB.sky=QB(JB(HB)),KB.terrain=QB(JB(GB)),KB.state=QB(JB(qB)),KB.layer=QB(JB(OB)),KB.filter=QB(JB(RB)),KB.paintProperty=QB(JB(zB)),KB.layoutProperty=QB(JB(FB));class rU{constructor(){pN(this,"_map"),pN(this,"_container"),pN(this,"_terrainButton"),function(t,e){for(const n of t)"function"==typeof e[n]&&(e[n]=e[n].bind(e))}(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=nU("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=nU("button","maplibregl-ctrl-terrain",this._container),nU("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){iU(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){aU(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function aU(t){t.hasTerrain()?t.disableTerrain():t.enableTerrain()}class oU extends qN{constructor(){var t,e,n;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({showCompass:null===(t=i.showCompass)||void 0===t||t,showZoom:null===(e=i.showZoom)||void 0===e||e,visualizePitch:null===(n=i.visualizePitch)||void 0===n||n}),pN(this,"_rotateCompassArrow",()=>{const t=this._map.getBearing(),e=this._map.getPitch(),n=this.options.visualizePitch?"scale(".concat(Math.min(1.5,1/Math.cos(e*(Math.PI/180))**.5),") rotateX(").concat(Math.min(70,e),"deg) rotateZ(").concat(-t,"deg)"):"rotate(".concat(-t,"deg)");this._compassIcon.style.transform=n}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{0===this._map.getPitch()?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}))}_createButton(t,e){const n=super._createButton(t,e);return n.clickFunction=e,n}}const sU=AD.Marker,lU=AD.LngLat,cU=AD.LngLatBounds;class uU extends ZN{constructor(){super(...arguments),pN(this,"lastUpdatedCenter",new lU(0,0)),pN(this,"_updateCamera",t=>{var e,n;const i=new lU(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,a=kt(kt({bearing:this._map.getBearing()},this.options.fitBoundsOptions),{},{linear:!0}),o=this._map.getZoom();o>(null!==(e=null==(n=this.options.fitBoundsOptions)?void 0:n.maxZoom)&&void 0!==e?e:30)&&(a.zoom=o),this._map.fitBounds(cU.fromLngLat(i,r),a,{geolocateSource:!0});let s=!1;const l=()=>{s=!0};this._map.once("click",l),this._map.once("dblclick",l),this._map.once("dragstart",l),this._map.once("mousedown",l),this._map.once("touchstart",l),this._map.once("wheel",l),this._map.once("moveend",()=>{this._map.off("click",l),this._map.off("dblclick",l),this._map.off("dragstart",l),this._map.off("mousedown",l),this._map.off("touchstart",l),this._map.off("wheel",l),!s&&(this.lastUpdatedCenter=this._map.getCenter())})}),pN(this,"_finishSetupUI",t=>{if(this._map){if(!1===t){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=nU("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new sU({element:this._dotElement}),this._circleElement=nU("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sU({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const e=t.originalEvent&&"resize"===t.originalEvent.type,n=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&"ACTIVE_LOCK"===this._watchState&&!e&&n>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),pN(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if("BACKGROUND"!==this._watchState&&"ACTIVE_LOCK"!==this._watchState)return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],e=this._map.project(t),n=this._map.unproject([e.x,e.y]),i=this._map.unproject([e.x+20,e.y]),r=n.distanceTo(i)/20,a=Math.ceil(2*this._accuracy/r);this._circleElement.style.width="".concat(a,"px"),this._circleElement.style.height="".concat(a,"px")}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}}}var hU,dU,pU,fU,mU;class gU{constructor(t,e,n){if(gN(this,hU),gN(this,dU),gN(this,pU),gN(this,fU),gN(this,mU),"string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error('No element has been found with selector "'.concat(t,'" when creating an external control.'));yN(this,dU,e)}else yN(this,dU,t);e&&yN(this,pU,t=>{e(mN(this,hU),mN(this,dU),t)}),n&&yN(this,fU,t=>{n(mN(this,hU),mN(this,dU),t)}),yN(this,mU,mN(this,dU).parentElement)}onAdd(t){return yN(this,hU,t),mN(this,pU)&&mN(this,dU).addEventListener("click",mN(this,pU)),mN(this,fU)&&mN(this,hU).on("render",mN(this,fU)),iU(mN(this,dU)),mN(this,dU)}onRemove(){mN(this,pU)&&mN(this,dU).removeEventListener("click",mN(this,pU)),mN(this,fU)&&mN(this,hU).off("render",mN(this,fU)),mN(this,mU)?mN(this,mU).appendChild(mN(this,dU)):iU(mN(this,dU))}}hU=new WeakMap,dU=new WeakMap,pU=new WeakMap,fU=new WeakMap,mU=new WeakMap;class yU{constructor(){pN(this,"map"),pN(this,"container"),pN(this,"projectionButton")}onAdd(t){return this.map=t,this.container=nU("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=nU("button","maplibregl-ctrl-projection",this.container),nU("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),t.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){iU(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){vU(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function vU(t){void 0===t.getProjection()&&t.setProjection({type:"mercator"}),t.isGlobeProjection()?t.enableMercatorProjection():t.enableGlobeProjection()}const _U={"zoom-in":t=>t.zoomIn(),"zoom-out":t=>t.zoomOut(),"toggle-projection":vU,"toggle-terrain":aU,"reset-view":t=>{0===t.getPitch()?t.easeTo({pitch:Math.min(t.getMaxPitch(),80)}):t.resetNorthPitch()},"reset-bearing":t=>{t.rotateTo(0)},"reset-pitch":t=>{t.setPitch(0)},"reset-roll":t=>{t.setRoll(0)}};var bU,xU,wU,SU,MU,TU,AU,EU,CU,PU,IU,LU;class kU extends gU{constructor(t,e){if(e&&!(e in _U))throw new Error('data-maptiler-control value "'.concat(e,'" is invalid.'));super(t,e&&_U[e]),gN(this,bU),gN(this,xU,new Map)}onAdd(t){return yN(this,bU,t),super.onAdd(t)}onRemove(){for(const[t,e]of mN(this,xU)){const n=t.deref();n&&n.removeEventListener("click",e)}mN(this,xU).clear(),super.onRemove()}configureGroupItem(t,e){if(!e)return;if(!(e in _U))throw new Error('data-maptiler-control value "'.concat(e,'" is invalid.'));const n=n=>{_U[e](mN(this,bU),t,n)};t.addEventListener("click",n),mN(this,xU).set(new WeakRef(t),n)}}bU=new WeakMap,xU=new WeakMap,pN(kU,"controlCallbacks",_U);class RU{constructor(t,e){var n;gN(this,CU),gN(this,wU),pN(this,"map"),gN(this,SU),gN(this,MU),gN(this,TU),gN(this,AU,!1),gN(this,EU),void 0!==t.style&&yN(this,AU,!0),yN(this,wU,kt(kt(kt({zoomAdjust:-4,position:"top-right"},e),{},{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1},t),{},{containerStyle:kt({border:"1px solid #000",width:"400px",height:"300px"},null!==(n=t.containerStyle)&&void 0!==n?n:{})})),void 0!==t.lockZoom&&(mN(this,wU).minZoom=t.lockZoom,mN(this,wU).maxZoom=t.lockZoom)}setStyle(t,e){mN(this,AU)||this.map.setStyle(t,e),vN(this,CU,IU).call(this)}addLayer(t,e){return mN(this,AU)||this.map.addLayer(t,e),vN(this,CU,IU).call(this),this.map}moveLayer(t,e){return mN(this,AU)||this.map.moveLayer(t,e),vN(this,CU,IU).call(this),this.map}removeLayer(t){return mN(this,AU)||this.map.removeLayer(t),vN(this,CU,IU).call(this),this}setLayerZoomRange(t,e,n){return mN(this,AU)||this.map.setLayerZoomRange(t,e,n),vN(this,CU,IU).call(this),this}setFilter(t,e,n){return mN(this,AU)||this.map.setFilter(t,e,n),vN(this,CU,IU).call(this),this}setPaintProperty(t,e,n,i){return mN(this,AU)||this.map.setPaintProperty(t,e,n,i),vN(this,CU,IU).call(this),this}setLayoutProperty(t,e,n,i){return mN(this,AU)||this.map.setLayoutProperty(t,e,n,i),vN(this,CU,IU).call(this),this}setGlyphs(t,e){return mN(this,AU)||this.map.setGlyphs(t,e),vN(this,CU,IU).call(this),this}onAdd(t){yN(this,SU,t),yN(this,MU,nU("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[e,n]of Object.entries(mN(this,wU).containerStyle))mN(this,MU).style.setProperty(e,n);return mN(this,wU).container=mN(this,MU),mN(this,wU).zoom=t.getZoom()+mN(this,wU).zoomAdjust,this.map=new Rj(mN(this,wU)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{vN(this,CU,PU).call(this,mN(this,wU).parentRect),yN(this,EU,vN(this,CU,LU).call(this))}),mN(this,MU)}onRemove(){var t;null==(t=mN(this,EU))||t.call(this),iU(mN(this,MU))}}wU=new WeakMap,SU=new WeakMap,MU=new WeakMap,TU=new WeakMap,AU=new WeakMap,EU=new WeakMap,CU=new WeakSet,PU=function(t){void 0===t||void 0===t.linePaint&&void 0===t.fillPaint||(yN(this,TU,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:mN(this,TU)}),(void 0!==t.lineLayout||void 0!==t.linePaint)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:kt({},t.lineLayout),paint:kt({"line-color":"#FFF","line-width":1,"line-opacity":.85},t.linePaint)}),void 0!==t.fillPaint&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:kt({"fill-color":"#08F","fill-opacity":.135},t.fillPaint)}),vN(this,CU,IU).call(this))},IU=function(){if(void 0===mN(this,TU))return;const{devicePixelRatio:t}=window,e=mN(this,SU).getCanvas(),n=e.width/t,i=e.height/t,r=mN(this,SU).unproject.bind(mN(this,SU)),a=r([0,0]),o=r([n,0]),s=r([0,i]),l=r([n,i]);mN(this,TU).geometry.coordinates=[[s.toArray(),l.toArray(),o.toArray(),a.toArray(),s.toArray()]];const c=this.map.getSource("parentRect");void 0!==c&&c.setData(mN(this,TU))},LU=function(){const{pitchAdjust:t}=mN(this,wU),e=()=>{a("parent")},n=()=>{a("minimap")},i=()=>{mN(this,SU).on("move",e),this.map.on("move",n)},r=()=>{mN(this,SU).off("move",e),this.map.off("move",n)},a=e=>{r();const n="parent"===e?mN(this,SU):this.map,a="parent"===e?this.map:mN(this,SU),o=n.getCenter(),s=n.getZoom()+mN(this,wU).zoomAdjust*("parent"===e?1:-1),l=n.getBearing(),c=n.getPitch();a.jumpTo({center:o,zoom:s,bearing:l,pitch:t?c:0}),vN(this,CU,IU).call(this),i()};return i(),()=>{r()}};class DU{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;pN(this,"map"),pN(this,"registeredModules",new Set),pN(this,"viewerType"),this.map=t,this.viewerType="Map",setTimeout(async()=>{if(!SN.telemetry)return;const t=this.preparePayload();try{(await fetch(t,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(EX){console.warn("The metrics could not be sent to MapTiler Cloud",EX)}},Math.max(1e3,e))}registerModule(t,e){this.registeredModules.add("".concat(t,":").concat(e))}registerViewerType(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Map";this.viewerType=t}preparePayload(){const t=new URL(xN.telemetryURL);return t.searchParams.append("sdk","3.8.0"),t.searchParams.append("key",SN.apiKey),t.searchParams.append("mtsid",wN),t.searchParams.append("session",SN.session?"1":"0"),t.searchParams.append("caching",SN.caching?"1":"0"),t.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),t.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),t.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),t.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&t.searchParams.append("modules",Array.from(this.registeredModules).join("|")),t.href}}var NU=typeof Float32Array<"u"?Float32Array:Array;function zU(){var t=new NU(16);return NU!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function FU(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+c*i,t[5]=o*r+u*i,t[6]=s*r+h*i,t[7]=l*r+d*i,t[8]=c*r-a*i,t[9]=u*r-o*i,t[10]=h*r-s*i,t[11]=d*r-l*i,t}function OU(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+c*i,t[1]=o*r+u*i,t[2]=s*r+h*i,t[3]=l*r+d*i,t[4]=c*r-a*i,t[5]=u*r-o*i,t[6]=h*r-s*i,t[7]=d*r-l*i,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var BU,UU,jU,VU,HU,GU,WU,qU,ZU=function(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(a=1/(i-r),t[10]=(r+i)*a,t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t};function XU(){var t=new NU(3);return NU!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function YU(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function KU(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2];return t[0]=r*l-a*s,t[1]=a*o-i*l,t[2]=i*s-r*o,t}function JU(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function $U(){if(VU)return jU;VU=1;const t=(UU||(UU=1,BU={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),BU),e={};for(const r of Object.keys(t))e[t[r]]=r;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};jU=n;for(const r of Object.keys(n)){if(!("channels"in n[r]))throw new Error("missing channels property: "+r);if(!("labels"in n[r]))throw new Error("missing channel labels property: "+r);if(n[r].labels.length!==n[r].channels)throw new Error("channel and label counts mismatch: "+r);const{channels:t,labels:e}=n[r];delete n[r].channels,delete n[r].labels,Object.defineProperty(n[r],"channels",{value:t}),Object.defineProperty(n[r],"labels",{value:e})}function i(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2}return n.rgb.hsl=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=a-r;let s,l;a===r?s=0:e===a?s=(n-i)/o:n===a?s=2+(i-e)/o:i===a&&(s=4+(e-n)/o),s=Math.min(60*s,360),s<0&&(s+=360);const c=(r+a)/2;return l=a===r?0:c<=.5?o/(a+r):o/(2-a-r),[s,100*l,100*c]},n.rgb.hsv=function(t){let e,n,i,r,a;const o=t[0]/255,s=t[1]/255,l=t[2]/255,c=Math.max(o,s,l),u=c-Math.min(o,s,l),h=function(t){return(c-t)/6/u+.5};return 0===u?(r=0,a=0):(a=u/c,e=h(o),n=h(s),i=h(l),o===c?r=i-n:s===c?r=1/3+e-i:l===c&&(r=2/3+n-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*a,100*c]},n.rgb.hwb=function(t){const e=t[0],i=t[1];let r=t[2];const a=n.rgb.hsl(t)[0],o=1/255*Math.min(e,Math.min(i,r));return r=1-1/255*Math.max(e,Math.max(i,r)),[a,100*o,100*r]},n.rgb.cmyk=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.min(1-e,1-n,1-i);return[100*((1-e-r)/(1-r)||0),100*((1-n-r)/(1-r)||0),100*((1-i-r)/(1-r)||0),100*r]},n.rgb.keyword=function(n){const r=e[n];if(r)return r;let a,o=1/0;for(const e of Object.keys(t)){const r=i(n,t[e]);r<o&&(o=r,a=e)}return a},n.keyword.rgb=function(e){return t[e]},n.rgb.xyz=function(t){let e=t[0]/255,n=t[1]/255,i=t[2]/255;e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92;return[100*(.4124*e+.3576*n+.1805*i),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},n.rgb.lab=function(t){const e=n.rgb.xyz(t);let i=e[0],r=e[1],a=e[2];i/=95.047,r/=100,a/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;return[116*r-16,500*(i-r),200*(r-a)]},n.hsl.rgb=function(t){const e=t[0]/360,n=t[1]/100,i=t[2]/100;let r,a,o;if(0===n)return o=255*i,[o,o,o];r=i<.5?i*(1+n):i+n-i*n;const s=2*i-r,l=[0,0,0];for(let c=0;c<3;c++)a=e+1/3*-(c-1),a<0&&a++,a>1&&a--,o=6*a<1?s+6*(r-s)*a:2*a<1?r:3*a<2?s+(r-s)*(2/3-a)*6:s,l[c]=255*o;return l},n.hsl.hsv=function(t){const e=t[0];let n=t[1]/100,i=t[2]/100,r=n;const a=Math.max(i,.01);i*=2,n*=i<=1?i:2-i,r*=a<=1?a:2-a;return[e,100*(0===i?2*r/(a+r):2*n/(i+n)),100*((i+n)/2)]},n.hsv.rgb=function(t){const e=t[0]/60,n=t[1]/100;let i=t[2]/100;const r=Math.floor(e)%6,a=e-Math.floor(e),o=255*i*(1-n),s=255*i*(1-n*a),l=255*i*(1-n*(1-a));switch(i*=255,r){case 0:return[i,l,o];case 1:return[s,i,o];case 2:return[o,i,l];case 3:return[o,s,i];case 4:return[l,o,i];case 5:return[i,o,s]}},n.hsv.hsl=function(t){const e=t[0],n=t[1]/100,i=t[2]/100,r=Math.max(i,.01);let a,o;o=(2-n)*i;const s=(2-n)*r;return a=n*r,a/=s<=1?s:2-s,a=a||0,o/=2,[e,100*a,100*o]},n.hwb.rgb=function(t){const e=t[0]/360;let n=t[1]/100,i=t[2]/100;const r=n+i;let a;r>1&&(n/=r,i/=r);const o=Math.floor(6*e),s=1-i;a=6*e-o,1&o&&(a=1-a);const l=n+a*(s-n);let c,u,h;switch(o){default:case 6:case 0:c=s,u=l,h=n;break;case 1:c=l,u=s,h=n;break;case 2:c=n,u=s,h=l;break;case 3:c=n,u=l,h=s;break;case 4:c=l,u=n,h=s;break;case 5:c=s,u=n,h=l}return[255*c,255*u,255*h]},n.cmyk.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100,r=t[3]/100;return[255*(1-Math.min(1,e*(1-r)+r)),255*(1-Math.min(1,n*(1-r)+r)),255*(1-Math.min(1,i*(1-r)+r))]},n.xyz.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100;let r,a,o;return r=3.2406*e+-1.5372*n+-.4986*i,a=-.9689*e+1.8758*n+.0415*i,o=.0557*e+-.204*n+1.057*i,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,r=Math.min(Math.max(0,r),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[255*r,255*a,255*o]},n.xyz.lab=function(t){let e=t[0],n=t[1],i=t[2];e/=95.047,n/=100,i/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*n-16,500*(e-n),200*(n-i)]},n.lab.xyz=function(t){let e,n,i;n=(t[0]+16)/116,e=t[1]/500+n,i=n-t[2]/200;const r=n**3,a=e**3,o=i**3;return n=r>.008856?r:(n-16/116)/7.787,e=a>.008856?a:(e-16/116)/7.787,i=o>.008856?o:(i-16/116)/7.787,e*=95.047,n*=100,i*=108.883,[e,n,i]},n.lab.lch=function(t){const e=t[0],n=t[1],i=t[2];let r;r=360*Math.atan2(i,n)/2/Math.PI,r<0&&(r+=360);return[e,Math.sqrt(n*n+i*i),r]},n.lch.lab=function(t){const e=t[0],n=t[1],i=t[2]/360*2*Math.PI;return[e,n*Math.cos(i),n*Math.sin(i)]},n.rgb.ansi16=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[i,r,a]=t;let o=null===e?n.rgb.hsv(t)[2]:e;if(o=Math.round(o/50),0===o)return 30;let s=30+(Math.round(a/255)<<2|Math.round(r/255)<<1|Math.round(i/255));return 2===o&&(s+=60),s},n.hsv.ansi16=function(t){return n.rgb.ansi16(n.hsv.rgb(t),t[2])},n.rgb.ansi256=function(t){const e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},n.ansi16.rgb=function(t){let e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},n.ansi256.rgb=function(t){if(t>=232){const e=10*(t-232)+8;return[e,e,e]}let e;t-=16;return[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},n.rgb.hex=function(t){const e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},n.hex.rgb=function(t){const e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];let n=e[0];3===e[0].length&&(n=n.split("").map(t=>t+t).join(""));const i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},n.rgb.hcg=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.max(Math.max(e,n),i),a=Math.min(Math.min(e,n),i),o=r-a;let s,l;return s=o<1?a/(1-o):0,l=o<=0?0:r===e?(n-i)/o%6:r===n?2+(i-e)/o:4+(e-n)/o,l/=6,l%=1,[360*l,100*o,100*s]},n.hsl.hcg=function(t){const e=t[1]/100,n=t[2]/100,i=n<.5?2*e*n:2*e*(1-n);let r=0;return i<1&&(r=(n-.5*i)/(1-i)),[t[0],100*i,100*r]},n.hsv.hcg=function(t){const e=t[1]/100,n=t[2]/100,i=e*n;let r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],100*i,100*r]},n.hcg.rgb=function(t){const e=t[0]/360,n=t[1]/100,i=t[2]/100;if(0===n)return[255*i,255*i,255*i];const r=[0,0,0],a=e%1*6,o=a%1,s=1-o;let l=0;switch(Math.floor(a)){case 0:r[0]=1,r[1]=o,r[2]=0;break;case 1:r[0]=s,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=o;break;case 3:r[0]=0,r[1]=s,r[2]=1;break;case 4:r[0]=o,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=s}return l=(1-n)*i,[255*(n*r[0]+l),255*(n*r[1]+l),255*(n*r[2]+l)]},n.hcg.hsv=function(t){const e=t[1]/100,n=e+t[2]/100*(1-e);let i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},n.hcg.hsl=function(t){const e=t[1]/100,n=t[2]/100*(1-e)+.5*e;let i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},n.hcg.hwb=function(t){const e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},n.hwb.hcg=function(t){const e=t[1]/100,n=1-t[2]/100,i=n-e;let r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],100*i,100*r]},n.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},n.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},n.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},n.gray.hsl=function(t){return[0,0,t[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(t){return[0,100,t[0]]},n.gray.cmyk=function(t){return[0,0,0,t[0]]},n.gray.lab=function(t){return[t[0],0,0]},n.gray.hex=function(t){const e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},n.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]},jU}function QU(){if(GU)return HU;GU=1;const t=$U();function e(e){const n=function(){const e={},n=Object.keys(t);for(let t=n.length,i=0;i<t;i++)e[n[i]]={distance:-1,parent:null};return e}(),i=[e];for(n[e].distance=0;i.length;){const e=i.pop(),r=Object.keys(t[e]);for(let t=r.length,a=0;a<t;a++){const t=r[a],o=n[t];-1===o.distance&&(o.distance=n[e].distance+1,o.parent=e,i.unshift(t))}}return n}function n(t,e){return function(n){return e(t(n))}}function i(e,i){const r=[i[e].parent,e];let a=t[i[e].parent][e],o=i[e].parent;for(;i[o].parent;)r.unshift(i[o].parent),a=n(t[i[o].parent][o],a),o=i[o].parent;return a.conversion=r,a}return HU=function(t){const n=e(t),r={},a=Object.keys(n);for(let e=a.length,o=0;o<e;o++){const t=a[o];null!==n[t].parent&&(r[t]=i(t,n))}return r},HU}!function(){var t=XU()}();var tj=function(){if(qU)return WU;qU=1;const t=$U(),e=QU(),n={};return Object.keys(t).forEach(i=>{n[i]={},Object.defineProperty(n[i],"channels",{value:t[i].channels}),Object.defineProperty(n[i],"labels",{value:t[i].labels});const r=e(i);Object.keys(r).forEach(t=>{const e=r[t];n[i][t]=function(t){const e=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=n[0];if(null==r)return r;r.length>1&&(n=r);const a=t(n);if("object"==typeof a)for(let t=a.length,o=0;o<t;o++)a[o]=Math.round(a[o]);return a};return"conversion"in t&&(e.conversion=t.conversion),e}(e),n[i][t].raw=function(t){const e=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=n[0];return null==r?r:(r.length>1&&(n=r),t(n))};return"conversion"in t&&(e.conversion=t.conversion),e}(e)})}),WU=n}();const ej=JU(tj);function nj(t){let{gl:e,type:n,source:i}=t;const r=e.createShader(n);if(null===r)throw new Error("Cannot create shader");if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error("Shader compilation error:",e.getShaderInfoLog(r)),e.deleteShader(r),new Error("Cannot compile shader");return r}function ij(t){let{gl:e,vertexShaderSource:n,fragmentShaderSource:i,attributesKeys:r,uniformsKeys:a,vertices:o,indices:s}=t;const l=function(t){let{gl:e,vertexShaderSource:n,fragmentShaderSource:i}=t;const r=nj({gl:e,type:e.VERTEX_SHADER,source:n}),a=nj({gl:e,type:e.FRAGMENT_SHADER,source:i}),o=e.createProgram();if(e.attachShader(o,r),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw console.error("Error: ",e.getProgramInfoLog(o)),new Error("Cannot link shader program");return o}({gl:e,vertexShaderSource:n,fragmentShaderSource:i}),c=r.reduce((t,n)=>(t[n]=e.getAttribLocation(l,"a_".concat(n)),t),{}),u=a.reduce((t,n)=>(t[n]=function(t,e,n){const i=t.getUniformLocation(e,n);if(null===i)throw new Error("Cannot get uniform location for ".concat(n));return i}(e,l,"u_".concat(n)),t),{}),h=e.createBuffer();let d,p;return e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW),void 0!==s&&(d=e.createBuffer(),p=s.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),e.STATIC_DRAW)),{shaderProgram:l,programInfo:{attributesLocations:c,uniformsLocations:u},positionBuffer:h,indexBuffer:d,indexBufferLength:p}}function rj(t){if(!t)return[1,1,1,0];if("transparent"===t)return[1,1,1,0];try{var e;const n=function(t){return aj=null!==aj&&void 0!==aj?aj:document.createElement("canvas").getContext("2d"),aj?(aj.fillStyle=t,aj.fillStyle):"#000000"}(t),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(n);if(null!=i&&i.length){const t=!!i[4];return[...ej.hex.rgb(n).map(t=>t/255),t?parseInt(i[4],16)/255:1]}const r=null!==(e=n.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi))&&void 0!==e?e:["0","0","0"];if(n.includes("rgb")){const t=n.includes("rgba"),e=[...r.map(t=>parseFloat(t)).map((t,e)=>e<3?t/255:t)];return t||e.push(1),e}}catch(n){}return console.warn(["[parseColorStringToVec4]: Color ".concat(t," is either not a valid color or its type is not supported, defaulting to black")]),[0,0,0,1]}let aj;const oj=.5,sj=.5,lj=.5,cj=[...[-.5,-.5,lj,oj,-.5,lj,oj,sj,lj,-.5,sj,lj],...[-.5,-.5,-.5,-.5,sj,-.5,oj,sj,-.5,oj,-.5,-.5],...[-.5,sj,-.5,-.5,sj,lj,oj,sj,lj,oj,sj,-.5],...[-.5,-.5,-.5,oj,-.5,-.5,oj,-.5,lj,-.5,-.5,lj],...[oj,-.5,-.5,oj,sj,-.5,oj,sj,lj,oj,-.5,lj],...[-.5,-.5,-.5,-.5,-.5,lj,-.5,sj,lj,-.5,sj,-.5]],uj=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],hj="precision mediump float;\n\nvarying vec3 vTextureCoord;\n\n%USE_TEXTURE_MACRO_MARKER%\n\n# ifdef USE_TEXTURE\nuniform samplerCube u_cubeSampler;\nuniform float u_fadeOpacity;\n# endif\n\nuniform vec4 u_bgColor;\n\nvoid main(void) {\n  #ifdef USE_TEXTURE\n  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);\n\n    gl_FragColor = mix(\n      u_bgColor,\n      texColor,\n      min(texColor.a, u_fadeOpacity)\n    );\n\n    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);\n\n  #else\n  gl_FragColor = u_bgColor;\n  #endif\n}\n";const dj={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var pj=(t=>(t.POSITIVE_X="pX",t.NEGATIVE_X="nX",t.POSITIVE_Y="pY",t.NEGATIVE_Y="nY",t.POSITIVE_Z="pZ",t.NEGATIVE_Z="nZ",t))(pj||{});let fj,mj,gj;function yj(t,e){if(e===pj.POSITIVE_X)return t.TEXTURE_CUBE_MAP_POSITIVE_X;if(e===pj.NEGATIVE_X)return t.TEXTURE_CUBE_MAP_NEGATIVE_X;if(e===pj.POSITIVE_Y)return t.TEXTURE_CUBE_MAP_POSITIVE_Y;if(e===pj.NEGATIVE_Y)return t.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(e===pj.POSITIVE_Z)return t.TEXTURE_CUBE_MAP_POSITIVE_Z;if(e===pj.NEGATIVE_Z)return t.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error("[CubemapLayer][loadCubemapTexture]: Invalid key ".concat(e))}function vj(t,e,n){return t+(e-t)*n}const _j="https://api.maptiler.com/resources/space",bj=["vertexPosition"],xj=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],wj="%USE_TEXTURE_MACRO_MARKER%",Sj=dj.stars;class Mj{constructor(t){var e,n;pN(this,"id","Cubemap Layer"),pN(this,"type","custom"),pN(this,"renderingMode","3d"),pN(this,"map"),pN(this,"faces"),pN(this,"useCubemapTexture",!0),pN(this,"currentFadeOpacity",0),pN(this,"cubeMapNeedsUpdate",!1),pN(this,"bgColor"),pN(this,"previousBgColor",[0,0,0,0]),pN(this,"targetBgColor",[0,0,0,0]),pN(this,"transitionDelta",0),pN(this,"gl"),pN(this,"cubemap"),pN(this,"texture"),pN(this,"currentFacesDefinitionKey",""),pN(this,"options"),pN(this,"animationActive",!0),pN(this,"imageIsAnimating",!1),pN(this,"imageFadeInDelta",0);const i=function(t,e){var n,i;if(!Tj(t))return{color:"transparent"};if(!0===t)return e;const r=kt({},t);if(t.faces||t.path)return delete r.preset,r;const a=t.preset;if(void 0!==a&&!(a in dj))throw new Error('[CubemapLayer]: Invalid preset "'.concat(a,'". Available presets: ').concat(Object.keys(dj).join(", ")));return kt(kt({},r),{},{color:null!==(n=null!==(i=r.color)&&void 0!==i?i:dj[a].color)&&void 0!==n?n:"hsl(233,100%,92%)"})}(t,Sj);this.options=i,this.currentFacesDefinitionKey=JSON.stringify(null!==(e=null!==(n=i.faces)&&void 0!==n?n:i.preset)&&void 0!==e?e:i.path),this.bgColor=[0,0,0,0],this.targetBgColor=rj(i.color),this.faces=Aj(i),this.useCubemapTexture=null!==this.faces}updateCubemap(){let{facesNeedUpdate:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{facesNeedUpdate:!0};this.useCubemapTexture=null!==this.faces;const e=xj.filter(t=>"cubeSampler"!==t&&"fadeOpacity"!==t||this.useCubemapTexture);this.cubemap=ij({gl:this.gl,vertexShaderSource:"attribute vec3 a_vertexPosition;\nvarying vec3 vTextureCoord;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\n  \nvoid main(void) {\n  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);\n  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);\n}\n",fragmentShaderSource:this.useCubemapTexture?hj.replace(wj,"#define USE_TEXTURE"):hj.replace(wj,""),attributesKeys:bj,uniformsKeys:e,vertices:cj,indices:uj}),this.cubeMapNeedsUpdate=t,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(t,e){this.map=t,this.gl=e,this.updateCubemap()}onRemove(t,e){this.cubemap&&(e.deleteProgram(this.cubemap.shaderProgram),e.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(t,e){if(!0===this.cubeMapNeedsUpdate&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;!function(t){let{gl:e,faces:n,onReady:i,forceRefresh:r}=t;fj&&!r&&gj===JSON.stringify(n)&&i(fj,mj),gj=JSON.stringify(n);const a=null!==fj&&void 0!==fj?fj:e.createTexture();if(e.bindTexture(e.TEXTURE_CUBE_MAP,a),!n)return void console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");const o=Object.keys(n).length;if(6!==o)return void console.warn("[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ".concat(o));const s=Object.entries(n).map(t=>{let[e,n]=t;return new Promise((t,i)=>{const r=e;if(void 0===n)return void i(new Error("[CubemapLayer][loadCubemapTexture]: Face ".concat(e," is undefined")));const a=new Image;a.crossOrigin="anonymous";const o=()=>{t({image:a,key:r})};a.src=n,a.complete&&a.naturalWidth>0?o():a.onload=o,a.onerror=()=>{i(new Error("[CubemapLayer][loadCubemapTexture]: Error loading image ".concat(n)))}})});Promise.all(s).then(t=>{for(let i=0;i<t.length;i++){var n;const r=e.RGBA,o=e.RGBA,s=e.UNSIGNED_BYTE,{image:l,key:c}=null!==(n=t[i])&&void 0!==n?n:{};if(!l||!c){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const u=yj(e,c);e.bindTexture(e.TEXTURE_CUBE_MAP,a),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(u,0,r,o,s,l)}e.bindTexture(e.TEXTURE_CUBE_MAP,a),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);const r=t.map(t=>t.image);i(a,r),mj=r,fj=a}).catch(t=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",t)})}({gl:t,faces:e,onReady:t=>{this.texture=t,this.animateIn()}})}}prerender(t,e){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const t=()=>{this.transitionDelta<1&&(requestAnimationFrame(t),this.bgColor=function(t,e,n){return[vj(t[0],e[0],n),vj(t[1],e[1],n),vj(t[2],e[2],n),vj(t[3],e[3],n)]}(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(t)}async animateIn(){if(!this.imageIsAnimating)return this.animationActive?new Promise(t=>{this.imageIsAnimating=!0;const e=()=>{this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=vj(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1?requestAnimationFrame(e):(this.imageIsAnimating=!1,this.imageFadeInDelta=0,t())};requestAnimationFrame(e)}):(this.currentFadeOpacity=1,this.imageFadeInDelta=1,void this.map.triggerRepaint())}async animateOut(){if(!this.imageIsAnimating&&this.animationActive)return new Promise(t=>{const e=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=vj(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1)return this.imageIsAnimating=!1,this.imageFadeInDelta=0,void t();requestAnimationFrame(e)};requestAnimationFrame(e)})}setAnimationActive(t){this.animationActive=t}render(t,e){if(!this.map.isGlobeProjection())return;if(void 0===this.map)throw new Error("[CubemapLayer]: Map is undefined");if(void 0===this.cubemap)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.DST_ALPHA),t.useProgram(this.cubemap.shaderProgram),t.bindBuffer(t.ARRAY_BUFFER,this.cubemap.positionBuffer),t.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const n=t.canvas,i=n.clientWidth/n.clientHeight,r=this.map.transform,a=r.fov*(Math.PI/180),o=zU();ZU(o,a,i,.1,1e4),OU(o,o,r.rollInRadians),FU(o,o,-r.pitchInRadians),OU(o,o,r.bearingInRadians);const s=r.center.lat*Math.PI/180,l=r.center.lng*Math.PI/180;FU(o,o,s),function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-c*i,t[1]=o*r-u*i,t[2]=s*r-h*i,t[3]=l*r-d*i,t[8]=a*i+c*r,t[9]=o*i+u*r,t[10]=s*i+h*r,t[11]=l*i+d*r}(o,o,-l),t.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,o);const c=zU();if(t.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,c),t.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),t.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture),t.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),void 0===this.cubemap.indexBuffer)throw new Error("Index buffer is undefined");if(void 0===this.cubemap.indexBufferLength)throw new Error("Index buffer length is undefined");t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),t.drawElements(t.TRIANGLES,this.cubemap.indexBufferLength,t.UNSIGNED_SHORT,0)}setBgColor(t){this.targetBgColor=t,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(t){var e,n;if(await this.animateOut(),!t.faces&&!t.preset&&!t.path)return this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",void await this.animateIn();this.faces=Aj(t),this.currentFacesDefinitionKey=JSON.stringify(null!==(e=null!==(n=t.faces)&&void 0!==n?n:t.preset)&&void 0!==e?e:t.path)}async setCubemap(t){var e,n;const i="boolean"==typeof t?Sj:t;this.options=i;const r=JSON.stringify(null!==(e=null!==(n=i.faces)&&void 0!==n?n:i.preset)&&void 0!==e?e:i.path),a=this.currentFacesDefinitionKey!==r;a&&(await this.setCubemapFaces(i),this.cubeMapNeedsUpdate=!0);const o=rj(i.color);if(i.color&&this.targetBgColor.toString()!==o.toString())this.setBgColor(o);else if(!i.color&&i.preset&&i.preset in dj){const t=dj[i.preset];this.setBgColor(rj(t.color))}this.updateCubemap({facesNeedUpdate:a})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function Tj(t){return!!t&&("boolean"==typeof t||!(!t.path&&!t.preset&&!t.faces&&!t.color||t.preset&&!(t.preset in dj)||t.faces&&(!t.faces.pX||!t.faces.nX||!t.faces.pY||!t.faces.nY||!t.faces.pZ||!t.faces.nZ)))}function Aj(t){if(t.faces)return t.faces;if(t.preset)return{pX:"".concat(_j,"/").concat(t.preset,"/px.webp"),nX:"".concat(_j,"/").concat(t.preset,"/nx.webp"),pY:"".concat(_j,"/").concat(t.preset,"/py.webp"),nY:"".concat(_j,"/").concat(t.preset,"/ny.webp"),pZ:"".concat(_j,"/").concat(t.preset,"/pz.webp"),nZ:"".concat(_j,"/").concat(t.preset,"/nz.webp")};if(t.path){var e;const n=t.path.baseUrl,i=null!==(e=t.path.format)&&void 0!==e?e:"png";return{pX:"".concat(n,"/px.").concat(i),nX:"".concat(n,"/nx.").concat(i),pY:"".concat(n,"/py.").concat(i),nY:"".concat(n,"/ny.").concat(i),pZ:"".concat(n,"/pz.").concat(i),nZ:"".concat(n,"/nz.").concat(i)}}return null}const Ej=["position"],Cj=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],Pj=[-2,-2,0,2,-2,0,-2,2,0,2,2,0],Ij={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]};class Lj{constructor(t){pN(this,"id","Halo Layer"),pN(this,"type","custom"),pN(this,"renderingMode","3d"),pN(this,"gradient"),pN(this,"scale",0),pN(this,"animationDelta",0),pN(this,"map"),pN(this,"plane"),pN(this,"animationActive",!0),this.gradient="boolean"!=typeof t?kt(kt({},Ij),t):Ij}onAdd(t,e){this.map=t,this.plane=ij({gl:e,vertexShaderSource:"attribute vec3 a_position;\n\nuniform mat4 u_matrix;\nuniform mat4 u_rotationMatrix;\n\nuniform float u_scale;\n\nvarying vec2 v_pos;\nvarying float v_scale;\n\nvoid main() {\n  v_scale = u_scale;\n  v_pos = a_position.xy * u_scale;\n  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);\n}\n",fragmentShaderSource:"precision mediump float;\nvarying vec2 v_pos;\n      \nuniform int u_stopsNumber;\nuniform float u_stops[100];\nuniform vec4 u_colors[100];\nuniform float u_maxDistance;\n\nvarying float v_scale;\n\nconst float EPSILON = 0.000001;\n\nvec2 center = vec2(0.0, 0.0);\nvoid main() {\n  float rawDistance = distance(center, v_pos);\n  float distanceFromGlobeEdge = rawDistance - 1.0;\n\n    vec4 color = u_colors[0];\n\n  // if we're further than the max distance, we should not render anything.\n  // This is to always render a circle, otherwise we end up rendering\n  // to the corners of the plane.\n  if (distance(center, v_pos) > u_maxDistance * v_scale) {\n    discard;\n  }\n\n  for (int i = 1; i < 100; i++) {\n    // if we're past the last stop\n    // we should fill to the end with the last stop color\n    if (i >= u_stopsNumber) {\n      color = u_colors[i - 1];\n      break;\n    }\n\n    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);\n    float lastStopValue = u_stops[i - 1];\n    float thisStopValue = u_stops[i];\n\n    // this is to avoid blending errors when the stops are the same\n    // eg when you would want a sharp edge between two stops.\n    // `numbersAreEqual` will be 1.0 if the numbers are equal, 0.0 if they are not.\n    // We then subtract EPSILON from the last stop making the stop value _almost_ equal\n    // to the next stop but not enough to cause blending issues.\n    // It's more efficient to do this than an if / else statement.\n    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));\n    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;\n\n    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);\n\n    if (distanceFromGlobeEdge <= scaledStopPosition) {\n      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);\n      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);\n      break;\n    }\n  }\n  \n  // gl_FragColor = color;\n  gl_FragColor = vec4(color.rgb * color.a, color.a);\n}\n",attributesKeys:Ej,uniformsKeys:Cj,vertices:Pj}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){return this.animationActive?new Promise(t=>{this.animationDelta=0;const e=()=>{if(this.animationDelta<1)return this.scale=vj(0,this.gradient.scale,this.animationDelta),this.animationDelta+=.06,this.map.triggerRepaint(),void requestAnimationFrame(e);t()};requestAnimationFrame(e)}):(this.scale=this.gradient.scale,this.animationDelta=1,void this.map.triggerRepaint())}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(t=>{const e=()=>{if(this.animationDelta<1)return this.scale=vj(this.gradient.scale,0,this.animationDelta),this.animationDelta+=.06,this.map.triggerRepaint(),void requestAnimationFrame(e);t()};e()})}onRemove(t,e){void 0!==this.plane&&(e.deleteProgram(this.plane.shaderProgram),e.deleteBuffer(this.plane.positionBuffer))}prerender(t,e){}render(t,e){if(void 0===this.map)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(void 0===this.plane)throw new Error("[RadialGradientLayer]: Plane is undefined");t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.useProgram(this.plane.shaderProgram),t.bindBuffer(t.ARRAY_BUFFER,this.plane.positionBuffer);const n=this.plane.programInfo.attributesLocations.position;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,3,t.FLOAT,!1,0,0);const i=zU(),r=this.scale;!function(t,e,n){var i=n[0],r=n[1],a=n[2];t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(i,i,[r,r,r]);const a=zU();!function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],b=n[1],x=n[2],w=n[3];t[0]=_*i+b*s+x*h+w*m,t[1]=_*r+b*l+x*d+w*g,t[2]=_*a+b*c+x*p+w*y,t[3]=_*o+b*u+x*f+w*v,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*i+b*s+x*h+w*m,t[5]=_*r+b*l+x*d+w*g,t[6]=_*a+b*c+x*p+w*y,t[7]=_*o+b*u+x*f+w*v,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*i+b*s+x*h+w*m,t[9]=_*r+b*l+x*d+w*g,t[10]=_*a+b*c+x*p+w*y,t[11]=_*o+b*u+x*f+w*v,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*i+b*s+x*h+w*m,t[13]=_*r+b*l+x*d+w*g,t[14]=_*a+b*c+x*p+w*y,t[15]=_*o+b*u+x*f+w*v}(a,e.defaultProjectionData.mainMatrix,i);const o=this.plane.programInfo.uniformsLocations.matrix;t.uniformMatrix4fv(o,!1,a);const s=zU(),l=this.map.transform.cameraPosition,c=YU(XU(),l),u=function(t,e,n){var i=new NU(3);return i[0]=t,i[1]=e,i[2]=n,i}(0,1,0),h=XU();KU(h,u,c),YU(h,h);const d=XU();KU(d,c,h),YU(d,d),function(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g){t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=m,t[15]=g}(s,h[0],h[1],h[2],0,d[0],d[1],d[2],0,c[0],c[1],c[2],0,0,0,0,1);const p=this.plane.programInfo.uniformsLocations.rotationMatrix;t.uniformMatrix4fv(p,!1,s);const f=this.gradient.stops.length,m=[],g=[];for(let y=0;y<=f;y++)if(y<f){m[y]=this.gradient.stops[y][0];const t=rj(this.gradient.stops[y][1]);g.push(...t)}t.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,f),t.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(m)),t.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(g)),t.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,2),t.uniform1f(this.plane.programInfo.uniformsLocations.scale,r),t.drawArrays(t.TRIANGLE_STRIP,0,4)}async setGradient(t){var e,n,i;if(!1!==t)return await this.animateOut(),"boolean"==typeof(i=t)||"number"==typeof i.scale&&i.stops&&0!==i.stops.length&&!i.stops.some(t=>"number"!=typeof t[0]||"string"!=typeof t[1])?(!0===t?(this.gradient.scale=Ij.scale,this.gradient.stops=Ij.stops):(this.gradient.scale=null!==(e=t.scale)&&void 0!==e?e:Ij.scale,this.gradient.stops=null!==(n=t.stops)&&void 0!==n?n:Ij.stops),void await this.animateIn()):(this.gradient.scale=Ij.scale,void(this.gradient.stops=[[0,"transparent"],[1,"transparent"]]));await this.animateOut()}setAnimationActive(t){this.animationActive=t}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}const kj="COUNTRY";let Rj=class t extends AD.Map{constructor(t){var e,n;FN(t.container),t.apiKey&&(SN.apiKey=t.apiKey);const{style:i,requiresUrlMonitoring:r,isFallback:a}=tU(t.style);a&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),SN.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const o=location.hash;let s={compact:!1};t.customAttribution?s.customAttribution=t.customAttribution:t.attributionControl&&"object"==typeof t.attributionControl&&(s=kt(kt({},s),t.attributionControl));const l=kt(kt({},t),{},{style:i,maplibreLogo:!1,transformRequest:DN(t.transformRequest),attributionControl:!0!==t.forceNoAttributionControl&&s});delete l.style,super(l),pN(this,"telemetry"),pN(this,"space"),pN(this,"halo"),pN(this,"options"),pN(this,"isTerrainEnabled",!1),pN(this,"terrainExaggeration",1),pN(this,"primaryLanguage"),pN(this,"terrainGrowing",!1),pN(this,"terrainFlattening",!1),pN(this,"minimap"),pN(this,"forceLanguageUpdate"),pN(this,"languageAlwaysBeenStyle"),pN(this,"isReady",!1),pN(this,"terrainAnimationDuration",1e3),pN(this,"monitoredStyleUrls"),pN(this,"styleInProcess",!1),pN(this,"curentProjection"),pN(this,"originalLabelStyle",new window.Map),pN(this,"isStyleLocalized",!1),pN(this,"languageIsUpdated",!1),pN(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=t,this.setStyle(i),r&&this.monitorStyleUrl(i);const c=()=>{let t="The distant style could not be loaded.";this.getStyle()?t+="Leaving the style as is.":(this.setStyle(HD.STREETS),t+='Loading default MapTiler Cloud style "'.concat(HD.STREETS.getDefaultVariant().getId(),'" as a fallback.')),console.warn(t)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",t=>{if(t.error instanceof AD.AJAXError){const e=t.error.url,n=new URL(e);n.search="";const i=n.href;return void(this.monitoredStyleUrls&&this.monitoredStyleUrls.has(i)&&(this.monitoredStyleUrls.delete(i),c()))}this.styleInProcess&&c()}),SN.caching&&!AN&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),SN.caching&&AN&&kN(),typeof t.language>"u")this.primaryLanguage=SN.primaryLanguage;else{const e=kD(t.language,_N);this.primaryLanguage=null!==e&&void 0!==e?e:SN.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===_N.STYLE||this.primaryLanguage===_N.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===_N.STYLE,this.terrainExaggeration=null!==(e=t.terrainExaggeration)&&void 0!==e?e:this.terrainExaggeration,this.curentProjection=t.projection,this.on("styledata",()=>{"mercator"===this.curentProjection?this.setProjection({type:"mercator"}):"globe"===this.curentProjection&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!t.geolocate||t.center||t.hash&&o)return;try{if(t.geolocate===kj)return void await this.fitToIpBounds()}catch(jX){console.warn(jX.message)}let e;try{await this.centerOnIpPoint(t.zoom),e=this.getCameraHash()}catch(jX){console.warn(jX.message)}"granted"===(await navigator.permissions.query({name:"geolocation"})).state&&navigator.geolocation.getCurrentPosition(n=>{e===this.getCameraHash()&&(this.terrain?this.easeTo({center:[n.coords.longitude,n.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[n.coords.longitude,n.coords.latitude],zoom:t.zoom||12,duration:2e3})}))},null,{maximumAge:864e5,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{null===this.getTerrain()&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let e={logo:null};try{const t=Object.keys(this.style.sourceCaches).map(t=>this.getSource(t)).filter(t=>t&&"url"in t&&"string"==typeof t.url&&t.url.includes("tiles.json")),n=new URL(t[0].url);n.searchParams.has("key")||n.searchParams.append("key",SN.apiKey),e=await(await fetch(n.href)).json()}catch(n){}if(t.customControls){const e="[data-maptiler-control-group]",n="[data-maptiler-control]",i=t=>{let e=t.dataset.maptilerControl;return("true"===e||""===e)&&(e=void 0),e},r=t=>t.dataset.maptilerPosition;let a=[...this._container.ownerDocument.querySelectorAll(e)],o=[...this._container.ownerDocument.querySelectorAll(n)].filter(t=>null===t.closest(e));if("string"==typeof t.customControls){const e=t.customControls;a=a.filter(t=>t.matches(e)||null!==t.closest(e)),o=o.filter(t=>t.matches(e)||null!==t.closest(e))}for(const t of a){const e=new kU(t);this.addControl(e,r(t));for(const r of t.querySelectorAll(n))e.configureGroupItem(r,i(r))}for(const t of o)this.addControl(new kU(t,i(t)),r(t));const s=()=>{const{lng:t,lat:e}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(t)),this._container.style.setProperty("--maptiler-center-lat",String(e)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};s(),this.on("render",s)}if(!0!==t.forceNoAttributionControl)if("logo"in e&&e.logo){const n=e.logo;this.addControl(new JN({logoURL:n}),t.logoPosition)}else t.maptilerLogo&&this.addControl(new JN,t.logoPosition);if(t.scaleControl){const e=!0===t.scaleControl||void 0===t.scaleControl?"bottom-right":t.scaleControl,n=new YN({unit:SN.unit});this.addControl(n,e),SN.on("unit",t=>{n.setUnit(t)})}if(!1!==t.navigationControl){const e=!0===t.navigationControl||void 0===t.navigationControl?"top-right":t.navigationControl;this.addControl(new oU,e)}if(!1!==t.geolocateControl){const e=!0===t.geolocateControl||void 0===t.geolocateControl?"top-right":t.geolocateControl;this.addControl(new uU({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),e)}if(t.terrainControl){const e=!0===t.terrainControl||void 0===t.terrainControl?"top-right":t.terrainControl;this.addControl(new rU,e)}if(t.projectionControl){const e=!0===t.projectionControl||void 0===t.projectionControl?"top-right":t.projectionControl;this.addControl(new yU,e)}if(t.fullscreenControl){const e=!0===t.fullscreenControl||void 0===t.fullscreenControl?"top-right":t.fullscreenControl;this.addControl(new KN({}),e)}this.isReady=!0,this.fire("ready",{target:this})});let u,h=!1,d=!1;this.once("ready",()=>{h=!0,d&&this.fire("loadWithTerrain",u)}),this.once("style.load",()=>{const{minimap:e}=t;if("object"==typeof e){var n;const{zoom:i,center:r,style:a,language:o,apiKey:s,maptilerLogo:l,canvasContextAttributes:c,refreshExpiredTiles:u,maxBounds:h,scrollZoom:d,minZoom:p,maxZoom:f,boxZoom:m,locale:g,fadeDuration:y,crossSourceCollisions:v,clickTolerance:_,bounds:b,fitBoundsOptions:x,pixelRatio:w,validateStyle:S}=t;this.minimap=new RU(e,{zoom:i,center:r,style:a,language:o,apiKey:s,container:"null",maptilerLogo:l,canvasContextAttributes:c,refreshExpiredTiles:u,maxBounds:h,scrollZoom:d,minZoom:p,maxZoom:f,boxZoom:m,locale:g,fadeDuration:y,crossSourceCollisions:v,clickTolerance:_,bounds:b,fitBoundsOptions:x,pixelRatio:w,validateStyle:S}),this.addControl(this.minimap,null!==(n=e.position)&&void 0!==n?n:"bottom-left")}else!0===e?(this.minimap=new RU({},t),this.addControl(this.minimap,"bottom-left")):void 0!==e&&!1!==e&&(this.minimap=new RU({},t),this.addControl(this.minimap,e))});const p=t=>{t.terrain&&(d=!0,u={type:"loadWithTerrain",target:this,terrain:t.terrain},this.off("terrain",p),h&&this.fire("loadWithTerrain",u))};this.on("terrain",p),t.terrain&&this.enableTerrain(null!==(n=t.terrainExaggeration)&&void 0!==n?n:this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",t=>{!0!==this._removed?(console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",t)):console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.")});const e=this.getLayersOrder()[0];t.space&&this.initSpace({options:t,before:e}),t.halo&&this.initHalo({options:t,before:e})}),this.telemetry=new DU(this)}getSpace(){return this.space}setSpace(t){if(!1!==t){if(this.isGlobeProjection()){if(this.space)return this.space.setCubemap(t),void(this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]));this.space=new Mj(t),this.once("load",()=>{const t=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,t)})}}else this.space=void 0}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(t){this.halo?this.halo.setAnimationActive(t):this.once("load",()=>{var e;null==(e=this.halo)||e.setAnimationActive(t)})}setSpaceAnimationActive(t){this.space?this.space.setAnimationActive(t):this.once("load",()=>{var e;null==(e=this.space)||e.setAnimationActive(t)})}setSpaceFromStyle(t){let{style:e}=t;var n,i,r;if(this.options.space)return void this.setSpace(this.options.space);const a=null==(i=null==(n=e.metadata)?void 0:n.maptiler)?void 0:i.space;if(a)if(Tj(a)){if(JSON.stringify(null==(r=this.space)?void 0:r.getConfig())!==JSON.stringify(a))(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const t=this.getLayersOrder()[0];this.addLayer(this.space,t)}this.space.setCubemap(a)}})();else if(this.space&&!this.getLayer(this.space.id)){const t=this.getLayersOrder()[0];this.addLayer(this.space,t)}}else this.setSpace({color:"transparent"});else this.setSpace({color:"transparent"})}setHaloFromStyle(t){let{style:e}=t;var n,i,r;const a=null==(n=e.metadata)?void 0:n.maptiler;if(JSON.stringify(null==(i=this.halo)?void 0:i.getConfig())!==JSON.stringify(null==a?void 0:a.halo))null!=a&&a.halo||this.options.halo?(()=>{var t;if(this.halo){var e;if(!this.getLayer(this.halo.id)){var n;const e=this.getLayersOrder().indexOf(null!==(n=null==(t=this.space)?void 0:t.id)&&void 0!==n?n:"")+1,i=this.getLayersOrder()[e];this.addLayer(this.halo,i)}const i=null!==(e=null==a?void 0:a.halo)&&void 0!==e?e:this.options.halo;i&&this.halo.setGradient(i)}})():this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});else if(this.halo&&!this.getLayer(this.halo.id)){var o;const t=this.getLayersOrder().indexOf(null!==(o=null==(r=this.space)?void 0:r.id)&&void 0!==o?o:"")+1,e=this.getLayersOrder()[t];this.addLayer(this.halo,e)}}initSpace(t){let{options:e=this.options,before:n,spec:i}=t;if(this.space)return void(this.getLayer(this.space.id)||this.addLayer(this.space,n));if(!1===e.space)return;const r=i;if(e.space)return this.space=new Mj(e.space),void this.addLayer(this.space,n);r&&(this.space=new Mj(r),this.addLayer(this.space,n))}initHalo(t){let{options:e=this.options,before:n,spec:i}=t;if(this.halo&&this.getLayer(this.halo.id)||!1===e.halo)return;const r=i;if(e.halo)return this.halo=new Lj(e.halo),void this.addLayer(this.halo,n);r&&(this.halo=new Lj(r),this.addLayer(this.halo,n))}getHalo(){return this.halo}setHalo(t){if(this.isGlobeProjection()){if(this.halo)return void this.halo.setGradient(t);this.halo=new Lj(t),this.once("load",()=>{var t,e;const n=this.getLayersOrder(),i=n[0],r=n.indexOf(null!==(t=null==(e=this.space)?void 0:e.id)&&void 0!==t?t:"")+2,a=n[r];this.halo&&this.addLayer(this.halo,this.space?a:i)})}}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new t(kt({},this.options))),this.once("load",()=>{this.jumpTo(e)})}setTerrainAnimationDuration(t){this.terrainAnimationDuration=Math.max(t,0)}async onLoadAsync(){return new Promise(t=>{this.loaded()?t(this):this.once("load",()=>{t(this)})})}async onReadyAsync(){return new Promise(t=>{this.isReady?t(this):this.once("ready",()=>{t(this)})})}async onLoadWithTerrainAsync(){return new Promise(t=>{this.isReady&&this.terrain?t(this):this.once("loadWithTerrain",()=>{t(this)})})}monitorStyleUrl(t){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const e=new URL(t);e.search="",this.monitoredStyleUrls.add(e.href)}setStyle(t,e){var n,i,r,a,o;this.originalLabelStyle.clear(),null==(n=this.minimap)||n.setStyle(t),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const s=tU(t);if(s.requiresUrlMonitoring&&this.monitorStyleUrl(s.style),s.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const l=this.getStyle(),c=s.style;try{super.setStyle(s.style,e),this.styleInProcess=!0}catch(OX){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",OX)}const u=t=>{var e,n,i,r,a;const o=null!==(e=null==t?void 0:t.target.getStyle())&&void 0!==e?e:s.style,l=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:o}):this.initSpace({before:l,spec:null==(i=null==(n=o.metadata)?void 0:n.maptiler)?void 0:i.space}),this.halo?this.setHaloFromStyle({style:o}):this.initHalo({before:l,spec:null==(a=null==(r=o.metadata)?void 0:r.maptiler)?void 0:a.halo})};if("string"==typeof s.style||s.requiresUrlMonitoring)return this.on("styledata",u),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",u),this.once("styledata",u),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if((null==(i=null==l?void 0:l.terrain)?void 0:i.source)!==(null==(r=null==c?void 0:c.terrain)?void 0:r.source)||(null==(a=null==l?void 0:l.terrain)?void 0:a.exaggeration)!==(null==(o=null==c?void 0:c.terrain)?void 0:o.exaggeration))return this.once("terrain",()=>{const t=s.style;t.projection&&"mercator"!==t.projection.type?(this.setSpaceFromStyle({style:s.style}),this.setHaloFromStyle({style:s.style})):console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...")}),this;try{u()}catch(h){}return this}addLayer(t,e){var n;return null==(n=this.minimap)||n.addLayer(t,e),super.addLayer(t,e)}moveLayer(t,e){var n;return null==(n=this.minimap)||n.moveLayer(t,e),super.moveLayer(t,e)}removeLayer(t){var e;return null==(e=this.minimap)||e.removeLayer(t),super.removeLayer(t)}setLayerZoomRange(t,e,n){var i;return null==(i=this.minimap)||i.setLayerZoomRange(t,e,n),super.setLayerZoomRange(t,e,n)}setFilter(t,e,n){var i;return null==(i=this.minimap)||i.setFilter(t,e,n),super.setFilter(t,e,n)}setPaintProperty(t,e,n,i){var r;return null==(r=this.minimap)||r.setPaintProperty(t,e,n,i),super.setPaintProperty(t,e,n,i)}setLayoutProperty(t,e,n,i){var r;return null==(r=this.minimap)||r.setLayoutProperty(t,e,n,i),super.setLayoutProperty(t,e,n,i)}setGlyphs(t,e){var n;return null==(n=this.minimap)||n.setGlyphs(t,e),super.setGlyphs(t,e)}getStyleLanguage(){return this.style&&this.style.stylesheet&&this.style.stylesheet.metadata&&"object"==typeof this.style.stylesheet.metadata&&"maptiler:language"in this.style.stylesheet.metadata&&"string"==typeof this.style.stylesheet.metadata["maptiler:language"]?ID(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(t){var e;null==(e=this.minimap)||e.map.setLanguage(t),this.onStyleReady(()=>{this.setPrimaryLanguage(t)})}setPrimaryLanguage(t){const e=this.getStyleLanguage(),n=kD(t,_N);if(!n)return void console.warn('The language "'.concat(n,'" is not supported.'));if((n.flag!==_N.STYLE.flag||!e||e.flag!==_N.AUTO.flag&&e.flag!==_N.VISITOR.flag)&&(n.flag!==_N.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===n&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===_N.STYLE_LOCK.flag)return void console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");this.primaryLanguage=n;let i=n;if(n.flag===_N.STYLE.flag){if(!e)return void console.warn("The style has no default languages or has an invalid one.");i=e}let r=_N.LOCAL.flag,a=["get",r];i.flag===_N.VISITOR.flag?(r=bN().flag,a=["case",["all",["has",r],["has",_N.LOCAL.flag]],["case",["==",["get",r],["get",_N.LOCAL.flag]],["get",_N.LOCAL.flag],["format",["get",r],{"font-scale":.8},"\n",["get",_N.LOCAL.flag],{"font-scale":1.1}]],["get",_N.LOCAL.flag]]):i.flag===_N.VISITOR_ENGLISH.flag?(r=_N.ENGLISH.flag,a=["case",["all",["has",r],["has",_N.LOCAL.flag]],["case",["==",["get",r],["get",_N.LOCAL.flag]],["get",_N.LOCAL.flag],["format",["get",r],{"font-scale":.8},"\n",["get",_N.LOCAL.flag],{"font-scale":1.1}]],["get",_N.LOCAL.flag]]):i.flag===_N.AUTO.flag?(r=bN().flag,a=["coalesce",["get",r],["get",_N.LOCAL.flag]]):i===_N.LOCAL?(r=_N.LOCAL.flag,a=["get",r]):(r=i.flag,a=["coalesce",["get",r],["get",_N.LOCAL.flag]]);const{layers:o}=this.getStyle(),s=0===this.originalLabelStyle.size;if(s){const t=function(t,e){const n=[];for(const a of t){if("symbol"!==a.type)continue;const t=a,{id:i,layout:r}=t;if(!r||!("text-field"in r))continue;const o=e.getLayoutProperty(i,"text-field");if(o)if("string"==typeof o){const t=VN(o);n.push(t)}else{const t=GN(o);n.push(t)}}const i=n.flat(),r={unlocalized:0,localized:{}};for(const a of i)null===a?r.unlocalized+=1:(a in r.localized||(r.localized[a]=0),r.localized[a]+=1);return r}(o,this);this.isStyleLocalized=Object.keys(t.localized).length>0}for(const l of o){if("symbol"!==l.type)continue;const t=l,e=this.getSource(t.source);if(!e||!("url"in e)||"string"!=typeof e.url||new URL(e.url).host!==xN.maptilerApiHost)continue;const{id:n,layout:i}=t;if(!i||!("text-field"in i))continue;let r;if(s?(r=this.getLayoutProperty(n,"text-field"),this.originalLabelStyle.set(n,r)):r=this.originalLabelStyle.get(n),"string"==typeof r){const{contains:t,exactMatch:e}=UN(r,this.isStyleLocalized);if(!t)continue;if(e)this.setLayoutProperty(n,"text-field",a);else{const t=jN(r,a,this.isStyleLocalized);this.setLayoutProperty(n,"text-field",t)}}else{const t=BN(r,a,this.isStyleLocalized);this.setLayoutProperty(n,"text-field",t)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t){if(!this.terrain)return;const e=performance.now(),n=this.terrain.exaggeration,i=t-n,r=()=>{if(!this.terrain||this.terrainFlattening)return;const a=(performance.now()-e)/this.terrainAnimationDuration;if(a<.99){const t=n+(1-(1-a)**4)*i;this.terrain.exaggeration=t,requestAnimationFrame(r)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(r)}enableTerrain(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.terrainExaggeration;if(t<0)return void console.warn("Terrain exaggeration cannot be negative.");const e=n=>{!this.terrain||"data"!==n.type||"source"!==n.dataType||!("source"in n)||"maptiler-terrain"!==n.sourceId||"raster-dem"!==n.source.type||n.isSourceLoaded&&(this.off("data",e),this.growTerrain(t))},n=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",e),this.addSource(xN.terrainSourceId,{type:"raster-dem",url:xN.terrainSourceURL}),this.setTerrain({source:xN.terrainSourceId,exaggeration:0})};if(this.getTerrain())return this.isTerrainEnabled=!0,void this.growTerrain(t);if(this.loaded()||this.isTerrainEnabled)n();else{const t=()=>{this.getTerrain()&&this.getSource(xN.terrainSourceId)||n()};this.once("load",()=>{t()}),this.once("moveend",()=>{t()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=performance.now(),e=this.terrain.exaggeration,n=()=>{if(!this.terrain||this.terrainGrowing)return;const i=(performance.now()-t)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,i<.99){const t=e*(1-i)**4;this.terrain.exaggeration=t,requestAnimationFrame(n)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(xN.terrainSourceId)&&this.removeSource(xN.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(n)}setTerrainExaggeration(t){!(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",()=>{t()})}async fitToIpBounds(){const t=await FD.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(t){var e,n;const i=await FD.info();this.jumpTo({center:[null!==(e=i.longitude)&&void 0!==e?e:0,null!==(n=i.latitude)&&void 0!==n?n:0],zoom:t||11})}getCameraHash(){const t=new Float32Array(5),e=this.getCenter();return t[0]=e.lng,t[1]=e.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),uN(new Uint8Array(t.buffer))}getSdkConfig(){return SN}getMaptilerSessionId(){return wN}setTransformRequest(t){return super.setTransformRequest(DN(t)),this}isGlobeProjection(){const t=this.getProjection();return!!t&&"globe"===t.type}enableGlobeProjection(){!0!==this.isGlobeProjection()&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){!1!==this.isGlobeProjection()&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};const Dj=["idle","render","load","remove","idle"],Nj=["error"],zj=["resize"],Fj=["webglcontextlost","webglcontextrestored"],Oj=["moveend","movestart","move","zoomend","zoomstart","zoom","rotatestart","rotateend","rotate","dragstart","dragend","drag","boxzoomcancel","boxzoomend","boxzoomstart"],Bj=["click","dblclick","mousedown","mouseup","mousemove","mouseout","mouseover","contextmenu","touchstart","touchend","touchmove","touchcancel"],Uj=["cooperativegestureprevented"],jj=["data","dataloading","sourcedata","sourcedataloading","dataabort","sourcedataabort"];Error;AD.Evented;function Vj(t){if(typeof DOMParser<"u"){const e=(new DOMParser).parseFromString(t,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function Hj(t,e){if(!t.hasChildNodes())return!1;for(const n of Array.from(t.childNodes)){const t=n.nodeName;if("string"==typeof t&&t.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function Gj(t){if(typeof XMLSerializer<"u")return(new XMLSerializer).serializeToString(t);throw new Error("No XML serializer found")}function Wj(t){const e="string"==typeof t?Vj(t):t;if(!Hj(e,"gpx"))throw new Error("The XML document is not valid GPX");const n=aV(e,"trk"),i=aV(e,"rte"),r=aV(e,"wpt"),a={type:"FeatureCollection",features:[]};for(const o of Array.from(n)){const t=Qj(o);t&&a.features.push(t)}for(const o of Array.from(i)){const t=tV(o);t&&a.features.push(t)}for(const o of Array.from(r))a.features.push(eV(o));return a}function qj(t,e){let n=t;if("string"==typeof n&&Vj(n),!Hj(n,"kml"))throw new Error("The XML document is not valid KML");const i={type:"FeatureCollection",features:[]},r={},a={},o={},s=aV(n,"Placemark"),l=aV(n,"Style"),c=aV(n,"StyleMap");for(const h of Array.from(l)){const t=rV(void 0!==e?e(h):Gj(h)).toString(16);r["#".concat(oV(h,"id"))]=t,a[t]=h}for(const h of Array.from(c)){r["#".concat(oV(h,"id"))]=rV(void 0!==e?e(h):Gj(h)).toString(16);const t=aV(h,"Pair"),n={};for(const e of Array.from(t)){var u;n[null!==uV(lV(e,"key"))&&void 0!==u?u:""]=uV(lV(e,"styleUrl"))}o["#".concat(oV(h,"id"))]=n}for(const h of Array.from(s))i.features=i.features.concat(Jj(h,r,a,o));return i}function Zj(t){if(null===t)return["#000000",1];let e="",n=1,i=t;return i.startsWith("#")&&i.substring(1),(6===i.length||3===i.length)&&i,8===i.length&&(Number.parseInt(i.substring(0,2),16)/255,"#".concat(i.substring(6,8)).concat(i.substring(4,6)).concat(i.substring(2,4))),[null!==e&&void 0!==e?e:"#000000",null!==n&&void 0!==n?n:1]}function Xj(t){return cV(t.split(" "))}function Yj(t){let e=aV(t,"coord");const n=[],i=[];0===e.length&&aV(t,"gx:coord");for(const o of Array.from(e)){var r;n.push(Xj(null!==uV(o)&&void 0!==r?r:""))}const a=aV(t,"when");for(const o of Array.from(a))i.push(uV(o));return{coords:n,times:i}}function Kj(t){const e=["Polygon","LineString","Point","Track","gx:Track"];let n,i,r,a,o;const s=[],l=[];if(null!==lV(t,"MultiGeometry"))return Kj(lV(t,"MultiGeometry"));if(null!==lV(t,"MultiTrack"))return Kj(lV(t,"MultiTrack"));if(null!==lV(t,"gx:MultiTrack"))return Kj(lV(t,"gx:MultiTrack"));for(0;r<e.length;r++)if(aV(t,e[r]),i)for(0;a<i.length;a++){var c,u;if(i[a],"Point"===e[r])s.push({type:"Point",coordinates:dV(null!==uV(lV(n,"coordinates"))&&void 0!==c?c:"")});else if("LineString"===e[r])s.push({type:"LineString",coordinates:pV(null!==uV(lV(n,"coordinates"))&&void 0!==u?u:"")});else if("Polygon"===e[r]){const t=aV(n,"LinearRing"),e=[];for(0;o<t.length;o++){var h;e.push(pV(null!==uV(lV(t[o],"coordinates"))&&void 0!==h?h:""))}s.push({type:"Polygon",coordinates:e})}else if("Track"===e[r]||"gx:Track"===e[r]){const t=Yj(n);s.push({type:"LineString",coordinates:t.coords}),t.times.length&&l.push(t.times)}}return{geoms:s,coordTimes:l}}function Jj(t,e,n,i){var r,a,o;const s=Kj(t),l={},c=uV(lV(t,"name")),u=uV(lV(t,"address")),h=uV(lV(t,"description")),d=lV(t,"TimeSpan"),p=lV(t,"TimeStamp"),f=lV(t,"ExtendedData"),m=lV(t,"visibility");let g,y=uV(lV(t,"styleUrl")),v=lV(t,"LineStyle"),_=lV(t,"PolyStyle");if(!s.geoms.length)return[];if(c&&(l.name=c),u&&(l.address=u),y){var b,x;y.startsWith("#")||"#".concat(y),l.styleUrl=y,e[y]&&(l.styleHash=e[y]),i[y]&&(l.styleMapHash=i[y],l.styleHash=e[null!==i[y].normal&&void 0!==b?b:""]);const t=n[null!==l.styleHash&&void 0!==x?x:""];if(t){v||lV(t,"LineStyle"),_||lV(t,"PolyStyle");const e=lV(t,"IconStyle");if(e){const t=lV(e,"Icon");if(t){const e=uV(lV(t,"href"));e&&(l.icon=e)}}}}if(h&&(l.description=h),d){const t=uV(lV(d,"begin")),e=uV(lV(d,"end"));t&&e&&(l.timespan={begin:t,end:e})}if(null!==p&&(l.timestamp=null!==uV(lV(p,"when"))&&void 0!==r?r:(new Date).toISOString()),null!==v){var w;const t=Zj(uV(lV(v,"color"))),e=t[0],n=t[1],i=Number.parseFloat(null!==uV(lV(v,"width"))&&void 0!==w?w:"");e&&(l.stroke=e),Number.isNaN(n)||(l["stroke-opacity"]=n),Number.isNaN(i)||(l["stroke-width"]=i)}if(_){const t=Zj(uV(lV(_,"color"))),e=t[0],n=t[1],i=uV(lV(_,"fill")),r=uV(lV(_,"outline"));e&&(l.fill=e),Number.isNaN(n)||(l["fill-opacity"]=n),i&&(l["fill-opacity"]="1"===i?l["fill-opacity"]||1:0),r&&(l["stroke-opacity"]="1"===r?l["stroke-opacity"]||1:0)}if(f){const t=aV(f,"Data"),e=aV(f,"SimpleData");for(0;g<t.length;g++){var S,M;l[null!==t[g].getAttribute("name")&&void 0!==S?S:""]=null!==uV(lV(t[g],"value"))&&void 0!==M?M:""}for(0;g<e.length;g++){var T,A;l[null!==e[g].getAttribute("name")&&void 0!==T?T:""]=null!==uV(e[g])&&void 0!==A?A:""}}null!==m&&(l.visibility=null!==uV(m)&&void 0!==a?a:""),0!==s.coordTimes.length&&(l.coordTimes=1===s.coordTimes.length?s.coordTimes[0]:s.coordTimes);const E={type:"Feature",geometry:1===s.geoms.length?s.geoms[0]:{type:"GeometryCollection",geometries:s.geoms},properties:l};return oV(t,"id")&&(E.id=null!==oV(t,"id")&&void 0!==o?o:void 0),[E]}function $j(t,e){const n=aV(t,e),i=[],r=[];let a=[];const o=n.length;if(!(o<2)){for(let t=0;t<o;t++){const e=fV(n[t]);i.push(e.coordinates),e.time&&r.push(e.time),(e.heartRate||a.length)&&(0===a.length&&new Array(t).fill(null),a.push(e.heartRate))}return{line:i,times:r,heartRates:a}}}function Qj(t){const e=aV(t,"trkseg"),n=[],i=[],r=[];let a;for(let s=0;s<e.length;s++)if($j(e[s],"trkpt"),void 0!==a&&(a.line&&n.push(a.line),a.times&&a.times.length&&i.push(a.times),r.length||a.heartRates&&a.heartRates.length)){if(!r.length)for(let t=0;t<s;t++)r.push(new Array(n[t].length).fill(null));a.heartRates&&a.heartRates.length?r.push(a.heartRates):r.push(new Array(a.line.length).fill(null))}if(0===n.length)return;const o=kt(kt({},iV(t)),nV(lV(t,"extensions")));return 0!==i.length&&(o.coordTimes=1===n.length?i[0]:i),0!==r.length&&(o.heartRates=1===n.length?r[0]:r),1===n.length?{type:"Feature",properties:o,geometry:{type:"LineString",coordinates:n[0]}}:{type:"Feature",properties:o,geometry:{type:"MultiLineString",coordinates:n}}}function tV(t){const e=$j(t,"rtept");return void 0===e?void 0:{type:"Feature",properties:kt(kt({},iV(t)),nV(lV(t,"extensions"))),geometry:{type:"LineString",coordinates:e.line}}}function eV(t){return{type:"Feature",properties:kt(kt({},iV(t)),hV(t,["sym"])),geometry:{type:"Point",coordinates:fV(t).coordinates}}}function nV(t){const e={};if(t){const r=lV(t,"line");if(r){var n,i;const t=uV(lV(r,"color")),a=Number.parseFloat(null!==uV(lV(r,"opacity"))&&void 0!==n?n:"0"),o=Number.parseFloat(null!==uV(lV(r,"width"))&&void 0!==i?i:"0");t&&(e.stroke=t),Number.isNaN(a)||(e["stroke-opacity"]=a),Number.isNaN(o)||(e["stroke-width"]=96*o/25.4)}}return e}function iV(t){const e=hV(t,["name","cmt","desc","type","time","keywords"]),n=aV(t,"link");if(0!==n.length){e.links=[];for(const t of Array.from(n)){const n=kt({href:oV(t,"href")},hV(t,["text","type"]));e.links.push(n)}}return e}function rV(t){let e=0;if(!t||!t.length)return e;for(let n=0;n<t.length;n++)(e<<5)-e+t.charCodeAt(n)|0;return e}function aV(t,e){return t.getElementsByTagName(e)}function oV(t,e){return t.getAttribute(e)}function sV(t,e){var n;return Number.parseFloat(null!==oV(t,e)&&void 0!==n?n:"0")}function lV(t,e){const n=aV(t,e);return n.length?n[0]:null}function cV(t){return t.map(Number.parseFloat).map(t=>Number.isNaN(t)?null:t)}function uV(t){return t&&function(t){t.normalize&&t.normalize()}(t),t&&t.textContent}function hV(t,e){const n={};let i,r;for(0;r<e.length;r++){var a;lV(t,e[r]),i&&(n[e[r]]=null!==uV(i)&&void 0!==a?a:"")}return n}function dV(t){return cV(t.replace(/\s*/g,"").split(","))}function pV(t){const e=t.replace(/^\s*|\s*$/g,"").split(/\s+/),n=[];for(const i of e)n.push(dV(i));return n}function fV(t){var e,n;const i=[sV(t,"lon"),sV(t,"lat")],r=lV(t,"ele"),a=lV(t,"gpxtpx:hr")||lV(t,"hr"),o=lV(t,"time");let s;return r&&(Number.parseFloat(null!==uV(r)&&void 0!==e?e:"0"),Number.isNaN(s)||i.push(s)),{coordinates:i,time:o?uV(o):null,heartRate:null!==a?Number.parseFloat(null!==uV(a)&&void 0!==n?n:"0"):null}}const mV=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function gV(){return mV[~~(Math.random()*mV.length)][~~(4*Math.random())]}function yV(){return"maptiler_source_".concat(NN())}function vV(){return"maptiler_layer_".concat(NN())}function _V(t,e){if(e<=t[0].zoom)return t[0].value;if(e>=t[t.length-1].zoom)return t[t.length-1].value;for(let n=0;n<t.length-1;n+=1)if(e>=t[n].zoom&&e<t[n+1].zoom){const i=t[n+1].zoom-t[n].zoom,r=(e-t[n].zoom)/i;return r*t[n+1].value+(1-r)*t[n].value}return 0}function bV(t){return["interpolate",["linear"],["zoom"],...t.flatMap(t=>[t.zoom,t.value])]}function xV(t){return["interpolate",["linear"],["zoom"],...t.flatMap(t=>[t.zoom,t.value])]}function wV(t,e){if("number"==typeof e&&"number"==typeof t)return 2*e+t;if("number"==typeof e&&Array.isArray(t))return["interpolate",["linear"],["zoom"],...t.flatMap(t=>[t.zoom,2*e+t.value])];if("number"==typeof t&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(e=>[e.zoom,2*e.value+t])];if(Array.isArray(t)&&Array.isArray(e)){const n=Array.from(new Set([...t.map(t=>t.zoom),...e.map(t=>t.zoom)])).sort((t,e)=>t<e?-1:1);return["interpolate",["linear"],["zoom"],...n.flatMap(n=>[n,2*_V(e,n)+_V(t,n)])]}return 0}function SV(t,e){return["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,t.value])]}function MV(t){const e=t.trimStart(),n="".concat(e).concat(" ".repeat(t.length-e.length)),i=Array.from(n);if(!i.every(t=>" "===t||"_"===t))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!i.some(t=>"_"===t)||!i.some(t=>" "===t))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const r=[1];for(let a=1;a<i.length;a+=1){i[a-1]===i[a]?r[r.length-1]+=1:r.push(1)}return r}function TV(t,e){return["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,t.color])]}function AV(t,e){return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.025*t.pointRadius])],2,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.05*t.pointRadius])],4,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.1*t.pointRadius])],8,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.25*t.pointRadius])],16,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,t.pointRadius])]]:["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,t.pointRadius])]}function EV(t,e){return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.025*t.value])],2,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.05*t.value])],4,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.1*t.value])],8,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.25*t.value])],16,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,t.value])]]:["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,t.value])]}function CV(t,e){return t.every(e=>e.color[3]===t[0].color[3])?t[0].color[3]?t[0].color[3]/255:1:["interpolate",["linear"],["get",e],...t.getRawColorStops().flatMap(t=>{const e=t.value,n=t.color;return[e,4===n.length?n[3]/255:1]})]}function PV(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(n,i)=>{const r=i/e;return[r,t.getColorHex(r)]}).flat()]}function IV(t){const e=t.toString(16);return 1===e.length?"0".concat(e):e}class LV extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),pN(this,"min",0),pN(this,"max",1),"min"in t&&(this.min=t.min),"max"in t&&(this.max=t.max),"stops"in t&&this.setStops(t.stops,{clone:!1})}static fromArrayDefinition(t){return new LV({stops:t.map(t=>({value:t[0],color:t[1]}))})}setStops(t){const e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{clone:!0}).clone?this.clone():this;e.length=0;let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r+=1)n=Math.min(n,t[r].value),i=Math.max(i,t[r].value),e.push({value:t[r].value,color:t[r].color.slice()});return e.sort((t,e)=>t.value<e.value?-1:1),this.min=n,this.max=i,e}scale(t,e){const n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0}).clone,i=this[0].value,r=this.at(-1).value-i,a=e-t,o=[];for(let s=0;s<this.length;s+=1){const e=(this[s].value-i)/r*a+t;n?o.push({value:e,color:this[s].color.slice()}):this[s].value=e}return n?new LV({stops:o}):this}at(t){return t<0?this[this.length+t]:this[t]}clone(){return new LV({stops:this.getRawColorStops()})}getRawColorStops(){const t=[];for(let e=0;e<this.length;e+=1)t.push({value:this[e].value,color:this[e].color});return t}reverse(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clone:!0}).clone?this.clone():this;for(let e=0;e<~~(t.length/2);e+=1){const n=t[e].color;t[e].color=t.at(-(e+1)).color,t.at(-(e+1)).color=n}return t}getBounds(){return{min:this.min,max:this.max}}getColor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{smooth:!0};if(t<=this[0].value)return this[0].color;if(t>=this.at(-1).value)return this.at(-1).color;for(let n=0;n<this.length-1;n+=1){if(t>this[n+1].value)continue;const i=this[n].color;if(!e.smooth)return i.slice();const r=this[n].value,a=this[n+1].value,o=this[n+1].color,s=(a-t)/(a-r);return i.map((t,e)=>Math.round(t*s+o[e]*(1-s)))}return[0,0,0]}getColorHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{smooth:!0,withAlpha:!1};return n=this.getColor(t,e),"#".concat(IV(n[0])).concat(IV(n[1])).concat(IV(n[2])).concat(4===n.length?IV(n[3]):"");var n}getColorRelative(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{smooth:!0};const n=this.getBounds();return this.getColor(n.min+t*(n.max-n.min),e)}getCanvasStrip(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{horizontal:!0,size:512,smooth:!0};const e=document.createElement("canvas");e.width=t.horizontal?t.size:1,e.height=t.horizontal?1:t.size;const n=e.getContext("2d");if(!n)throw new Error("Canvs context is missing");const i=n.getImageData(0,0,e.width,e.height),r=i.data,a=t.size,o=this[0].value,s=(this.at(-1).value-o)/a;for(let l=0;l<a;l+=1){const e=this.getColor(o+l*s,{smooth:t.smooth});r[4*l]=e[0],r[4*l+1]=e[1],r[4*l+2]=e[2],r[4*l+3]=e.length>3?e[3]:255}return n.putImageData(i,0,0),e}resample(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;const n=this.getBounds(),i=this.scale(0,1),r=1/(e-1);let a;if("ease-in-square"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=n**2;return{value:n,color:i.getColor(a)}});else if("ease-out-square"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=1-(1-n)**2;return{value:n,color:i.getColor(a)}});else if("ease-out-sqrt"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=n**.5;return{value:n,color:i.getColor(a)}});else if("ease-in-sqrt"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=1-(1-n)**.5;return{value:n,color:i.getColor(a)}});else if("ease-out-exp"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=1-2**(-10*n);return{value:n,color:i.getColor(a)}});else{if("ease-in-exp"!==t)throw new Error("Invalid ressampling method.");a=Array.from({length:e},(t,e)=>{const n=e*r,a=2**(10*n-10);return{value:n,color:i.getColor(a)}})}return new LV({stops:a}).scale(n.min,n.max)}transparentStart(){const t=this.getRawColorStops();t.unshift({value:t[0].value,color:t[0].color.slice()}),t[1].value+=.001;for(const e of t)3===e.color.length&&e.color.push(255);return t[0].color[3]=0,new LV({stops:t})}hasTransparentStart(){return 4===this[0].color.length&&0===this[0].color[3]}}const kV={NULL:new LV({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new LV({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new LV({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new LV({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new LV({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new LV({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new LV({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new LV({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new LV({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new LV({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new LV({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new LV({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new LV({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new LV({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new LV({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new LV({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new LV({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new LV({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new LV({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new LV({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new LV({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new LV({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new LV({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new LV({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new LV({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new LV({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new LV({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new LV({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new LV({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new LV({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new LV({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new LV({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new LV({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new LV({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new LV({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new LV({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new LV({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new LV({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new LV({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new LV({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new LV({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new LV({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new LV({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new LV({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new LV({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new LV({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new LV({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new LV({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new LV({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};Symbol.toStringTag;!function(){if(typeof window>"u")return;const t=AD.getRTLTextPluginStatus();if("unavailable"===t||"requested"===t)try{AD.setRTLTextPlugin(xN.rtlPluginURL,!0)}catch(e){}}();AD.Map,AD.Marker,AD.Popup,AD.Style,AD.CanvasSource,AD.GeoJSONSource,AD.ImageSource,AD.RasterTileSource,AD.RasterDEMTileSource,AD.VectorTileSource,AD.VideoSource,AD.NavigationControl,AD.GeolocateControl,AD.AttributionControl,AD.LogoControl,AD.ScaleControl,AD.FullscreenControl,AD.TerrainControl,AD.BoxZoomHandler,AD.ScrollZoomHandler,AD.CooperativeGesturesHandler,AD.KeyboardHandler,AD.TwoFingersTouchPitchHandler,AD.MapWheelEvent,AD.MapTouchEvent,AD.MapMouseEvent,AD.config,AD.getVersion;const{setRTLTextPlugin:RV,getRTLTextPluginStatus:DV,LngLat:NV,LngLatBounds:zV,MercatorCoordinate:FV,Evented:OV,AJAXError:BV,prewarm:UV,clearPrewarmedResources:jV,Hash:VV,Point:HV,EdgeInsets:GV,DragRotateHandler:WV,DragPanHandler:qV,TwoFingersTouchZoomRotateHandler:ZV,DoubleClickZoomHandler:XV,TwoFingersTouchZoomHandler:YV,TwoFingersTouchRotateHandler:KV,getWorkerCount:JV,setWorkerCount:$V,getMaxParallelImageRequests:QV,setMaxParallelImageRequests:tH,getWorkerUrl:eH,setWorkerUrl:nH,addSourceType:iH,importScriptInWorkers:rH,addProtocol:aH,removeProtocol:oH}=AD,sH=["resetTrigger","selectedLocation","selectedAsteroid","simulationTrigger","simulationParams"];function lH(t){let{resetTrigger:e,selectedLocation:n,selectedAsteroid:r,simulationTrigger:a,simulationParams:o}=t;Je(t,sH);const s=200,l=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(0,i.useRef)(n),{dispatch:h}=Ot(),d=()=>{new Audio("/asteroid.mp3").play().catch(t=>console.error("Sound error:",t))};(0,i.useEffect)(()=>{const t=()=>{const e=l.current;if(!e)return void console.error("Map container not found");if(0===e.offsetWidth||0===e.offsetHeight)return console.warn("Map container has no dimensions, retrying..."),void setTimeout(t,100);const n=[90.368603,23.807133];let i;SN.apiKey="4xlqmw5O239jIs3v38vu";try{i=new Rj({container:e,style:"https://api.maptiler.com/maps/basic-v2/style.json?key=".concat(SN.apiKey),center:n,zoom:1.8,minZoom:.5,maxZoom:18,projection:"globe",bearing:0,pitch:0}),c.current=i;const t={width:s,height:s,data:new Uint8Array(16e4),onAdd:function(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.context=t.getContext("2d")},render:function(){const t=performance.now()%1e3/1e3,e=70*t+30,n=this.context;return n.clearRect(0,0,this.width,this.height),n.beginPath(),n.arc(this.width/2,this.height/2,e,0,2*Math.PI),n.fillStyle="rgba(255, 200, 200,"+(1-t)+")",n.fill(),n.beginPath(),n.arc(this.width/2,this.height/2,30,0,2*Math.PI),n.fillStyle="rgba(255, 100, 100, 1)",n.strokeStyle="white",n.lineWidth=2+4*(1-t),n.fill(),n.stroke(),this.data=n.getImageData(0,0,this.width,this.height).data,i.triggerRepaint(),!0}};i.on("load",()=>{i.addImage("pulsing-dot",t,{pixelRatio:2}),i.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:n}}]}}),i.addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"pulsing-dot"}}),i.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,90],"sky-atmosphere-sun-intensity":15}})})}catch(uA){return void console.error("Error initializing map:",uA)}return()=>{if(c.current){try{c.current.remove()}catch(rJ){console.debug("Map already removed:",rJ.message)}c.current=null}}},e=setTimeout(t,100);return()=>{clearTimeout(e),c.current&&(c.current.remove(),c.current=null)}},[]);const p=t=>{if(console.log("Getting coordinates for location:",t),"object"===typeof t&&t.centroid){const e=[t.centroid.lon,t.centroid.lat];return console.log("Using search result coordinates:",e,"from centroid:",t.centroid),h({type:"SET_IMPACT_AREA",payload:{lat:t.centroid.lat,lng:t.centroid.lon}}),e}if("string"===typeof t&&UA[t]){const e=UA[t];if(e.centroid){const t=[e.centroid.lon,e.centroid.lat];return console.log("Using dropdown location coordinates:",t),h({type:"SET_IMPACT_AREA",payload:{lat:e.centroid.lat,lng:e.centroid.lon}}),t}}const e=[90.368603,23.807133];return console.log("Using default coordinates:",e),e};return(0,i.useEffect)(()=>{if(!c.current||!n)return;u.current=n;const t=p(n);c.current.flyTo({center:t,zoom:6,duration:1500,essential:!0}),c.current.getSource("points")&&c.current.getSource("points").setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}]})},[n]),(0,i.useEffect)(()=>{if(!l.current)return;l.current.querySelectorAll(".meteor-container, .impact-explosion").forEach(t=>t.remove()),console.log("RealMap: cleaned up meteors due to resetTrigger =",e)},[e]),(0,i.useEffect)(()=>{if(!c.current||!r||!a)return;const t=u.current;if(!t)return;const e=p(t);console.log("Simulation: currentLocation from ref =",t),console.log("Simulation: targetCoords =",e),console.log("Simulation: map center =",c.current.getCenter());let n=null,i=null;const s=()=>{l.current.querySelectorAll(".meteor-container, .impact-explosion").forEach(t=>t.remove());const t=c.current.project(e);console.log("Meteor: targetCoords for projection =",e),console.log("Meteor: targetPixel screen coordinates =",t);const r=document.createElement("div");r.className="meteor-container",l.current.appendChild(r),i=document.createElement("div"),i.className="meteor meteor-falling";const a=(null===o||void 0===o?void 0:o.diameter)||250,s=Math.max(8,Math.min(40,a/25));i.style.width="".concat(s,"px"),i.style.height="".concat(s,"px");const u=(null===o||void 0===o?void 0:o.entryAngle)||45,h=u*Math.PI/180,p=t.x-500*Math.cos(h),f=t.y-500*Math.sin(h);i.style.left="".concat(p,"px"),i.style.top="".concat(f,"px"),r.appendChild(i);let m=null;const g=(null===o||void 0===o?void 0:o.velocity)||19.3,y=Math.max(1e3,2e3-50*(g-19.3)),v=t=>{m||(m=t);const r=Math.min((t-m)/y,1),a=c.current.project(e),o=p+(a.x-p)*r,s=f+(a.y-f)*r,h=40*Math.sin(r*Math.PI),g=u*Math.PI/180,_=o+h*Math.sin(g),b=s-h*Math.cos(g);i.style.left="".concat(_,"px"),i.style.top="".concat(b,"px");const x=Math.atan2(a.y-f,a.x-p)*(180/Math.PI);if(i.style.transform="rotate(".concat(x+45,"deg)"),r<1)requestAnimationFrame(v);else{d(),i.className="meteor meteor-impact",n=document.createElement("div"),n.className="impact-explosion",n.style.left="".concat(a.x,"px"),n.style.top="".concat(a.y,"px"),n.style.position="absolute",n.style.pointerEvents="none",n.style.zIndex="20";for(let t=0;t<8;t++){const e=document.createElement("div");e.className="impact-debris",e.style.left="50%",e.style.top="50%",e.style.transform="rotate(".concat(45*t,"deg)"),n.appendChild(e)}l.current.appendChild(n),(()=>{if(!c.current)return;const t=document.createElement("div");t.className="meteor",document.body.appendChild(t),d(),setTimeout(()=>{t.remove()},5e3)})()}};new Audio("/incoming.mp3").play().catch(t=>console.error("Incoming sound error:",t)),requestAnimationFrame(v);const _=()=>{if(n){const t=c.current.project(e);n.style.left="".concat(t.x,"px"),n.style.top="".concat(t.y,"px")}};return c.current.on("move",_),c.current.on("rotate",_),()=>{c.current&&(c.current.off("move",_),c.current.off("rotate",_))}};let h;return setTimeout(()=>{h=s()},500),()=>{h&&h()}},[r,a,o]),(0,Rt.jsx)("div",{ref:l,className:"real-map-container",style:{width:"50vw",height:"80vh",alignItems:"flex-start"}})}_k.register(Dk,zk,LR,NR,CR,hR,sR);const cH=function(){const{dispatch:t,state:e}=Ot(),[n,r]=(0,i.useState)(null),[a,o]=(0,i.useState)(null),[s,l]=(0,i.useState)(""),[c,u]=(0,i.useState)([]),[h,d]=(0,i.useState)(!1),[p,f]=(0,i.useState)(0),[m,g]=(0,i.useState)({diameter:250,velocity:19.3,entryAngle:45,impactLocation:"Ocean (Pacific)",selectedAsteroid:null}),y=(0,i.useCallback)(async t=>{if(t.trim()){d(!0);try{const e=await fetch("https://nominatim.openstreetmap.org/search?q=".concat(encodeURIComponent(t),"&format=json&limit=5")),n=await e.json();u(n)}catch(uA){u([])}d(!1)}else u([])},[]);i.useEffect(()=>{const t=setTimeout(()=>{y(s)},300);return()=>clearTimeout(t)},[s,y]);const[v,_]=(0,i.useState)(null),b=(0,i.useMemo)(()=>{const t=UA[n]||n;if(!t)return null;const e=t.population||("ocean"===t.type?5e4:1e5),i=t.density||("ocean"===t.type?100:500),r=m.diameter/1e3,a=m.velocity,o=m.entryAngle*Math.PI/180,s=r/2,l=1e3*a,c=.5*(26e11*(4/3*Math.PI*Math.pow(s,3)))*Math.pow(l,2)*(Math.sin(o)||.1)/4184e12,u=.5*Math.pow(c/.001,1/3),h=Math.PI*Math.pow(u,2),d=Math.min(e,h*i),p=.15*d,f=Math.round(.25*d),g=Math.round(.47*d),y=Math.round(.28*d),v=f+g+y;let _=0,b=0;return n&&"string"!==typeof n?(_=parseFloat(n.lat),b=parseFloat(n.lon)):"Ocean (Pacific)"===n?(_=0,b=180):UA[n]&&UA[n].coords&&(_=UA[n].coords.lat,b=UA[n].coords.lng),{blastRadius:u.toFixed(1),affectedPopulation:Math.round(d).toLocaleString(),casualties:Math.round(p).toLocaleString(),energy:c.toFixed(0),asteroidDiameter:r.toFixed(2),latitude:_,longitude:b,simulationParams:{diameter:m.diameter,velocity:m.velocity,entryAngle:m.entryAngle},populationBreakdown:{directImpact:f,secondary:g,longTerm:y,totalAffected:v}}},[n,m]),x=(0,i.useCallback)(t=>{var e;console.log("Simulation started at:",n),g(t),o(null===(e=t.selectedAsteroid)||void 0===e?void 0:e.name),r(t.impactLocation),f(t=>t+1)},[]),w=(0,i.useCallback)(()=>{console.log("Reset simulation"),f(t=>t+1),r(null),o(null),g({diameter:250,velocity:19.3,entryAngle:45,impactLocation:"Ocean (Pacific)",selectedAsteroid:null})},[]);(0,i.useEffect)(()=>{b&&t({type:"SET_IMPACT_DATA",payload:b})},[b,t]);const S=(0,i.useCallback)(n=>{console.log("Dashboard: Setting selected location to:",n),r(n),t({type:"SET_IMPACT_AREA",payload:kt(kt({},e.impactArea),{},{location:n})})},[]);return(0,Rt.jsxs)("div",{className:"dashboard",children:[(0,Rt.jsxs)("div",{className:"dashboard-container",children:[(0,Rt.jsx)("aside",{className:"dashboard-sidebar",children:(0,Rt.jsx)(wD,{handleReset:w,onRunSimulation:x,onLocationChange:S,searchQuery:s,setSearchQuery:l,searchLoading:h,searchResults:c})}),(0,Rt.jsxs)("main",{className:"dashboard-main",children:[(0,Rt.jsxs)("div",{className:"visualization-panel",children:[(0,Rt.jsxs)("div",{className:"panel-header",children:[(0,Rt.jsx)("h3",{children:"Selected Impact Zone"}),(0,Rt.jsx)("span",{className:"impact-zone-label",children:(t=>{if(!t)return"No Location Selected";if("string"===typeof t)return t;if(t.display_name){const e=t.display_name.split(",");return e.length>=2?"".concat(e[0].trim(),", ").concat(e[1].trim()):e[0].trim()}return t.name?t.name:"Unknown Location"})(n)})]}),(0,Rt.jsx)("div",{className:"earth-container",children:(0,Rt.jsx)(i.Suspense,{fallback:(0,Rt.jsx)("div",{className:"loading-spinner"}),children:(0,Rt.jsx)(lH,{handleReset:w,selectedLocation:n,selectedAsteroid:a,simulationTrigger:p,resetTrigger:p,simulationParams:m,zoom:.5,center:{lat:0,lng:0}})})})]}),(0,Rt.jsx)("div",{className:"results-section",children:(0,Rt.jsxs)("div",{className:"results-grid",children:[(0,Rt.jsx)(jA,{impactData:b}),(0,Rt.jsx)(_D,{impactData:b}),(0,Rt.jsx)(bD,{impactData:b,simulationParams:m,selectedLocation:n})]})})]})]}),(0,Rt.jsxs)("footer",{className:"story-footer",children:[(0,Rt.jsxs)("div",{className:"footer-container",children:[(0,Rt.jsxs)("div",{className:"footer-logo",children:[(0,Rt.jsx)("div",{className:"logo-icon",children:(0,Rt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,Rt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,Rt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,Rt.jsxs)("div",{className:"footer-nav",children:[(0,Rt.jsx)("h4",{children:"Navigation"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/",children:"Home"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/story",children:"Story Mode"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/dashboard",children:"Simulation Dashboard"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/results",children:"Impact Results"})})]})]}),(0,Rt.jsxs)("div",{className:"footer-sources",children:[(0,Rt.jsx)("h4",{children:"Data Sources"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,Rt.jsxs)("div",{className:"footer-bottom",children:[(0,Rt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,Rt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})]})};_k.register(LR,NR,zk,Dk,pR,CR,hR);const uH=function(){return(0,Rt.jsxs)("div",{className:"impact-analysis",children:[(0,Rt.jsxs)("div",{className:"analysis-header",children:[(0,Rt.jsx)("div",{className:"header-icon",children:"\ud83d\udcc8"}),(0,Rt.jsx)("h3",{children:"Impact Analysis"}),(0,Rt.jsxs)("select",{className:"analysis-filter",defaultValue:"Energy Distribution",children:[(0,Rt.jsx)("option",{children:"Energy Distribution"}),(0,Rt.jsx)("option",{children:"Seismic Effects"}),(0,Rt.jsx)("option",{children:"Atmospheric Impact"})]})]}),(0,Rt.jsx)("div",{className:"chart-container",children:(0,Rt.jsx)(yD,{data:{labels:["0 sec","10 sec","30 sec","60 sec","2 min","5 min","10 min"],datasets:[{label:"Energy Distribution",data:[0,15,45,75,85,92,95],borderColor:"#00d4ff",backgroundColor:"rgba(0, 212, 255, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:"#00d4ff",pointBorderColor:"#ffffff",pointBorderWidth:2},{label:"Population Effects",data:[0,25,55,70,80,85,90],borderColor:"#ff6b35",backgroundColor:"rgba(255, 107, 53, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:"#ff6b35",pointBorderColor:"#ffffff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#ffffff",padding:20,usePointStyle:!0,font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.1)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",font:{size:11}}},y:{grid:{color:"rgba(255, 255, 255, 0.1)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",font:{size:11},callback:function(t){return t+"%"}}}}}})})]})};_k.register(Tk,CR,hR);const hH=function(){return(0,Rt.jsxs)("div",{className:"impact-distribution",children:[(0,Rt.jsxs)("div",{className:"distribution-header",children:[(0,Rt.jsx)("div",{className:"header-icon",children:"\ud83d\udcca"}),(0,Rt.jsx)("h3",{children:"Impact Distribution"}),(0,Rt.jsxs)("select",{className:"distribution-filter",defaultValue:"Population",children:[(0,Rt.jsx)("option",{children:"Population"}),(0,Rt.jsx)("option",{children:"Economic"}),(0,Rt.jsx)("option",{children:"Environmental"})]})]}),(0,Rt.jsxs)("div",{className:"distribution-content",children:[(0,Rt.jsx)("div",{className:"chart-container",children:(0,Rt.jsx)(vD,{data:{labels:["Direct Impact (23%)","Tsunami (29%)","Seismic Effects (26%)","Other Effects (22%)"],datasets:[{data:[23,29,26,22],backgroundColor:["#ff6b35","#00d4ff","#8b5cf6","#22c55e"],borderColor:["#ff6b35","#00d4ff","#8b5cf6","#22c55e"],borderWidth:2,cutout:"65%"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,callbacks:{label:function(t){return"".concat(t.label,": ").concat(t.parsed,"%")}}}}}})}),(0,Rt.jsxs)("div",{className:"distribution-legend",children:[(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--orange"}),(0,Rt.jsxs)("div",{className:"legend-info",children:[(0,Rt.jsx)("span",{className:"legend-label",children:"Direct Impact (23%)"}),(0,Rt.jsx)("span",{className:"legend-description",children:"Immediate blast effects"})]})]}),(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--blue"}),(0,Rt.jsxs)("div",{className:"legend-info",children:[(0,Rt.jsx)("span",{className:"legend-label",children:"Tsunami (29%)"}),(0,Rt.jsx)("span",{className:"legend-description",children:"Coastal wave damage"})]})]}),(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--purple"}),(0,Rt.jsxs)("div",{className:"legend-info",children:[(0,Rt.jsx)("span",{className:"legend-label",children:"Seismic Effects (26%)"}),(0,Rt.jsx)("span",{className:"legend-description",children:"Earthquake-like damage"})]})]}),(0,Rt.jsxs)("div",{className:"legend-item",children:[(0,Rt.jsx)("div",{className:"legend-color legend-color--green"}),(0,Rt.jsxs)("div",{className:"legend-info",children:[(0,Rt.jsx)("span",{className:"legend-label",children:"Other Effects (22%)"}),(0,Rt.jsx)("span",{className:"legend-description",children:"Secondary impacts"})]})]})]})]})]})},dH=t=>{let{label:e,value:n,unit:i,color:r,maxValue:a}=t;const o=Math.min(n/a*100,100);return(0,Rt.jsxs)("div",{className:"metric-visualization-card",children:[(0,Rt.jsx)("h3",{className:"metric-label",children:e}),(0,Rt.jsxs)("div",{className:"metric-value-container",children:[(0,Rt.jsx)("span",{className:"metric-value",style:{color:r},children:n}),(0,Rt.jsx)("span",{className:"metric-unit",children:i})]}),(0,Rt.jsx)("div",{className:"metric-progress-bar",children:(0,Rt.jsx)("div",{className:"metric-progress",style:{width:"".concat(o,"%"),backgroundColor:r}})}),(0,Rt.jsx)("p",{className:"metric-description",children:"Energy Released"===e?"TNT EQUIVALENT":"Blast Radius"===e?"DAMAGE ZONE":"Population Affected"===e?"DIRECT IMPACT ZONE":"MAXIMUM WAVE HEIGHT"})]})},pH=()=>{const t=(0,i.useRef)(null),{state:e}=Ot(),{impactData:n}=e;return(0,i.useEffect)(()=>{const e=t.current;if(!e)return;const i=e.getContext("2d"),r=e.width,a=e.height;if(i.clearRect(0,0,r,a),!n)return i.font="16px Arial",i.fillStyle="#e0e0e0",i.textAlign="center",void i.fillText("No impact data available for visualization.",r/2,a/2);const o=parseFloat(n.blastRadius)||0,s=parseFloat(n.affectedPopulation.replace(/,/g,"")||0),l=parseFloat(n.energy)||0,c=Math.min(2*o,r/2-20),u={x:r/2,y:a/2},h=0,d=188,p=212,f=255,m=0,g=0,y=Math.min(l/1e3,1),v=h+(f-h)*y,_=d+(m-d)*y,b=p+(g-p)*y,x=1e3+2e3*Math.min(s/5e5,1),w=1+1.5*(1-y);for(let t=0;t<x;t++){const t=Math.random()*Math.PI*2,e=Math.random()*c,n=u.x+e*Math.cos(t),r=u.y+e*Math.sin(t),a=.3+.7*(1-e/c);i.beginPath(),i.arc(n,r,w,0,2*Math.PI),i.fillStyle="rgba(".concat(v,", ").concat(_,", ").concat(b,", ").concat(a,")"),i.fill()}i.beginPath(),i.arc(u.x,u.y,c,0,2*Math.PI),i.strokeStyle="rgba(".concat(v,", ").concat(_,", ").concat(b,", 0.8)"),i.lineWidth=2,i.stroke(),i.font="14px Arial",i.fillStyle="#e0e0e0",i.textAlign="center",i.fillText("Impact Zone: ".concat(o.toFixed(1)," km Radius"),r/2,a-20)},[n]),(0,Rt.jsxs)("div",{className:"impact-zone-map-container",children:[(0,Rt.jsx)("h3",{children:"Affected Area Visualization"}),(0,Rt.jsx)("canvas",{ref:t,width:"500",height:"400",className:"impact-zone-canvas"})]})},fH=()=>{const t=(0,i.useRef)(null),{state:e}=Ot(),{impactData:n}=e;return(0,i.useEffect)(()=>{const e=t.current;if(!e)return;const i=e.getContext("2d"),r=e.height,a=300,o=r/2,s=Math.min(600,r)/3;if(i.clearRect(0,0,600,r),!n||!n.populationBreakdown)return i.font="16px Arial",i.fillStyle="#e0e0e0",i.textAlign="center",void i.fillText("No population impact data.",a,o);const{directImpact:l,secondary:c,longTerm:u,totalAffected:h}=n.populationBreakdown;if(0===h)return i.font="16px Arial",i.fillStyle="#e0e0e0",i.textAlign="center",void i.fillText("No population affected.",a,o);const d=l/h*Math.PI*2,p=c/h*Math.PI*2,f=u/h*Math.PI*2;let m=0;const g=.8*s;i.beginPath(),i.moveTo(a,o),i.arc(a,o,g,m,m+d),i.closePath(),i.fillStyle="#dc2626",i.fill(),m+=d,i.beginPath(),i.moveTo(a,o),i.arc(a,o,g,m,m+p),i.closePath(),i.fillStyle="#fb923c",i.fill(),m+=p,i.beginPath(),i.moveTo(a,o),i.arc(a,o,g,m,m+f),i.closePath(),i.fillStyle="#facc15",i.fill();const y=15,v=175;let _=r-100;i.font="12px Arial",i.fillStyle="#e0e0e0",i.textAlign="left",i.fillStyle="#dc2626",i.fillRect(v,_,y,y),i.fillStyle="#e0e0e0",i.fillText("Direct Impact: ".concat(l.toLocaleString()),200,_+7.5+4),_+=20,i.fillStyle="#fb923c",i.fillRect(v,_,y,y),i.fillStyle="#e0e0e0",i.fillText("Secondary: ".concat(c.toLocaleString()),200,_+7.5+4),_+=20,i.fillStyle="#facc15",i.fillRect(v,_,y,y),i.fillStyle="#e0e0e0",i.fillText("Long Term: ".concat(u.toLocaleString()),200,_+7.5+4),_+=20,i.fillStyle="#e0e0e0",i.fillText("Total Affected: ".concat(h.toLocaleString()),200,_+7.5+4)},[n]),(0,Rt.jsxs)("div",{className:"population-impact-visualization-container",children:[(0,Rt.jsx)("h3",{children:"Population Impact Breakdown"}),(0,Rt.jsx)("canvas",{ref:t,width:"600",height:"400",className:"population-impact-canvas"})," "]})};function mH(){const t=(0,i.useRef)(null),e=(0,i.useRef)(null),n=(0,i.useRef)(null),r=(0,i.useRef)(null),a=(0,i.useRef)(!1),{state:o}=Ot(),{impactArea:s}=o,l=t=>{if(!e.current||!t)return;n.current&&n.current.remove();const i=new WN({color:"red"}).setLngLat([t.lng,t.lat]).addTo(e.current);n.current=i,e.current.flyTo({center:[t.lng,t.lat],zoom:5,speed:.8})},c=n=>{if(!e.current||!n)return;r.current&&r.current.remove();const i=document.createElement("div");i.className="impact-explosion",i.style.position="absolute",i.style.pointerEvents="none",i.style.zIndex=20;for(let t=0;t<8;t++){const e=document.createElement("div");e.className="impact-debris",e.style.left="50%",e.style.top="50%",e.style.transform="rotate(".concat(45*t,"deg)"),i.appendChild(e)}t.current.appendChild(i),r.current=i;const a=()=>{if(!e.current||!r.current)return;const t=e.current.project([n.lng,n.lat]);i.style.left="".concat(t.x,"px"),i.style.top="".concat(t.y,"px"),requestAnimationFrame(a)};a()};return(0,i.useEffect)(()=>{if(e.current)return;const i=t.current;if(!i)return;SN.apiKey="4xlqmw5O239jIs3v38vu";const o=[(null===s||void 0===s?void 0:s.lng)||90.368603,(null===s||void 0===s?void 0:s.lat)||23.807133],u=new Rj({container:i,style:"https://api.maptiler.com/maps/basic-v2/style.json?key=".concat(SN.apiKey),center:o,zoom:4,minZoom:4,maxZoom:4,projection:"globe",bearing:0,pitch:0,interactive:!1});return e.current=u,u.on("load",()=>{a.current||(u.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,90],"sky-atmosphere-sun-intensity":15}}),null!==s&&void 0!==s&&s.lng&&null!==s&&void 0!==s&&s.lat&&(l(s),c(s)))}),()=>{if(e.current&&!a.current){try{e.current.remove()}catch(t){console.debug("Map already cleaned:",null===t||void 0===t?void 0:t.message)}a.current=!0,e.current=null,r.current&&(r.current.remove(),r.current=null),n.current&&(n.current.remove(),n.current=null)}}},[]),(0,i.useEffect)(()=>{e.current&&s&&(l(s),c(s))},[s]),(0,Rt.jsx)("div",{ref:t,className:"real-map-container",style:{width:"50vw",height:"80vh",position:"relative"}})}var gH=Uint8Array,yH=Uint16Array,vH=Int32Array,_H=new gH([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bH=new gH([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xH=new gH([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wH=function(t,e){for(var n=new yH(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var r=new vH(n[30]);for(i=1;i<30;++i)for(var a=n[i];a<n[i+1];++a)r[a]=a-n[i]<<5|i;return{b:n,r:r}},SH=wH(_H,2),MH=SH.b,TH=SH.r;MH[28]=258,TH[258]=28;for(var AH=wH(bH,0),EH=(AH.b,AH.r),CH=new yH(32768),PH=0;PH<32768;++PH){var IH=(43690&PH)>>1|(21845&PH)<<1;IH=(61680&(IH=(52428&IH)>>2|(13107&IH)<<2))>>4|(3855&IH)<<4,CH[PH]=((65280&IH)>>8|(255&IH)<<8)>>1}var LH=function(t,e,n){for(var i=t.length,r=0,a=new yH(e);r<i;++r)t[r]&&++a[t[r]-1];var o,s=new yH(e);for(r=1;r<e;++r)s[r]=s[r-1]+a[r-1]<<1;if(n){o=new yH(1<<e);var l=15-e;for(r=0;r<i;++r)if(t[r])for(var c=r<<4|t[r],u=e-t[r],h=s[t[r]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)o[CH[h]>>l]=c}else for(o=new yH(i),r=0;r<i;++r)t[r]&&(o[r]=CH[s[t[r]-1]++]>>15-t[r]);return o},kH=new gH(288);for(PH=0;PH<144;++PH)kH[PH]=8;for(PH=144;PH<256;++PH)kH[PH]=9;for(PH=256;PH<280;++PH)kH[PH]=7;for(PH=280;PH<288;++PH)kH[PH]=8;var RH=new gH(32);for(PH=0;PH<32;++PH)RH[PH]=5;var DH=LH(kH,9,0),NH=LH(RH,5,0),zH=function(t){return(t+7)/8|0},FH=function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new gH(t.subarray(e,n))},OH=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>8},BH=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>8,t[i+2]|=n>>16},UH=function(t,e){for(var n=[],i=0;i<t.length;++i)t[i]&&n.push({s:i,f:t[i]});var r=n.length,a=n.slice();if(!r)return{t:ZH,l:0};if(1==r){var o=new gH(n[0].s+1);return o[n[0].s]=1,{t:o,l:1}}n.sort(function(t,e){return t.f-e.f}),n.push({s:-1,f:25001});var s=n[0],l=n[1],c=0,u=1,h=2;for(n[0]={s:-1,f:s.f+l.f,l:s,r:l};u!=r-1;)s=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:s.f+l.f,l:s,r:l};var d=a[0].s;for(i=1;i<r;++i)a[i].s>d&&(d=a[i].s);var p=new yH(d+1),f=jH(n[u-1],p,0);if(f>e){i=0;var m=0,g=f-e,y=1<<g;for(a.sort(function(t,e){return p[e.s]-p[t.s]||t.f-e.f});i<r;++i){var v=a[i].s;if(!(p[v]>e))break;m+=y-(1<<f-p[v]),p[v]=e}for(m>>=g;m>0;){var _=a[i].s;p[_]<e?m-=1<<e-p[_]++-1:++i}for(;i>=0&&m;--i){var b=a[i].s;p[b]==e&&(--p[b],++m)}f=e}return{t:new gH(p),l:f}},jH=function(t,e,n){return-1==t.s?Math.max(jH(t.l,e,n+1),jH(t.r,e,n+1)):e[t.s]=n},VH=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new yH(++e),i=0,r=t[0],a=1,o=function(t){n[i++]=t},s=1;s<=e;++s)if(t[s]==r&&s!=e)++a;else{if(!r&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(r),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(r);a=1,r=t[s]}return{c:n.subarray(0,i),n:e}},HH=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},GH=function(t,e,n){var i=n.length,r=zH(e+2);t[r]=255&i,t[r+1]=i>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var a=0;a<i;++a)t[r+a+4]=n[a];return 8*(r+4+i)},WH=function(t,e,n,i,r,a,o,s,l,c,u){OH(e,u++,n),++r[256];for(var h=UH(r,15),d=h.t,p=h.l,f=UH(a,15),m=f.t,g=f.l,y=VH(d),v=y.c,_=y.n,b=VH(m),x=b.c,w=b.n,S=new yH(19),M=0;M<v.length;++M)++S[31&v[M]];for(M=0;M<x.length;++M)++S[31&x[M]];for(var T=UH(S,7),A=T.t,E=T.l,C=19;C>4&&!A[xH[C-1]];--C);var P,I,L,k,R=c+5<<3,D=HH(r,kH)+HH(a,RH)+o,N=HH(r,d)+HH(a,m)+o+14+3*C+HH(S,A)+2*S[16]+3*S[17]+7*S[18];if(l>=0&&R<=D&&R<=N)return GH(e,u,t.subarray(l,l+c));if(OH(e,u,1+(N<D)),u+=2,N<D){P=LH(d,p,0),I=d,L=LH(m,g,0),k=m;var z=LH(A,E,0);OH(e,u,_-257),OH(e,u+5,w-1),OH(e,u+10,C-4),u+=14;for(M=0;M<C;++M)OH(e,u+3*M,A[xH[M]]);u+=3*C;for(var F=[v,x],O=0;O<2;++O){var B=F[O];for(M=0;M<B.length;++M){var U=31&B[M];OH(e,u,z[U]),u+=A[U],U>15&&(OH(e,u,B[M]>>5&127),u+=B[M]>>12)}}}else P=DH,I=kH,L=NH,k=RH;for(M=0;M<s;++M){var j=i[M];if(j>255){BH(e,u,P[(U=j>>18&31)+257]),u+=I[U+257],U>7&&(OH(e,u,j>>23&31),u+=_H[U]);var V=31&j;BH(e,u,L[V]),u+=k[V],V>3&&(BH(e,u,j>>5&8191),u+=bH[V])}else BH(e,u,P[j]),u+=I[j]}return BH(e,u,P[256]),u+I[256]},qH=new vH([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ZH=new gH(0),XH=function(t,e,n,i,r,a){var o=a.z||t.length,s=new gH(i+o+5*(1+Math.ceil(o/7e3))+r),l=s.subarray(i,s.length-r),c=a.l,u=7&(a.r||0);if(e){u&&(l[0]=a.r>>3);for(var h=qH[e-1],d=h>>13,p=8191&h,f=(1<<n)-1,m=a.p||new yH(32768),g=a.h||new yH(f+1),y=Math.ceil(n/3),v=2*y,_=function(e){return(t[e]^t[e+1]<<y^t[e+2]<<v)&f},b=new vH(25e3),x=new yH(288),w=new yH(32),S=0,M=0,T=a.i||0,A=0,E=a.w||0,C=0;T+2<o;++T){var P=_(T),I=32767&T,L=g[P];if(m[I]=L,g[P]=I,E<=T){var k=o-T;if((S>7e3||A>24576)&&(k>423||!c)){u=WH(t,l,0,b,x,w,M,A,C,T-C,u),A=S=M=0,C=T;for(var R=0;R<286;++R)x[R]=0;for(R=0;R<30;++R)w[R]=0}var D=2,N=0,z=p,F=I-L&32767;if(k>2&&P==_(T-F))for(var O=Math.min(d,k)-1,B=Math.min(32767,T),U=Math.min(258,k);F<=B&&--z&&I!=L;){if(t[T+D]==t[T+D-F]){for(var j=0;j<U&&t[T+j]==t[T+j-F];++j);if(j>D){if(D=j,N=F,j>O)break;var V=Math.min(F,j-2),H=0;for(R=0;R<V;++R){var G=T-F+R&32767,W=G-m[G]&32767;W>H&&(H=W,L=G)}}}F+=(I=L)-(L=m[I])&32767}if(N){b[A++]=268435456|TH[D]<<18|EH[N];var q=31&TH[D],Z=31&EH[N];M+=_H[q]+bH[Z],++x[257+q],++w[Z],E=T+D,++S}else b[A++]=t[T],++x[t[T]]}}for(T=Math.max(T,E);T<o;++T)b[A++]=t[T],++x[t[T]];u=WH(t,l,c,b,x,w,M,A,C,T-C,u),c||(a.r=7&u|l[u/8|0]<<3,u-=7,a.h=g,a.p=m,a.i=T,a.w=E)}else{for(T=a.w||0;T<o+c;T+=65535){var X=T+65535;X>=o&&(l[u/8|0]=c,X=o),u=GH(l,u+1,t.subarray(T,X))}a.i=o}return FH(s,0,i+zH(u)+r)},YH=function(){var t=1,e=0;return{p:function(n){for(var i=t,r=e,a=0|n.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}t=i,e=r},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(e%=65521))<<8|e>>8}}},KH=function(t,e,n,i,r){if(!r&&(r={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),o=new gH(a.length+t.length);o.set(a),o.set(t,a.length),t=o,r.w=a.length}return XH(t,null==e.level?6:e.level,null==e.mem?r.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,n,i,r)},JH=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},$H=function(t,e){var n=e.level,i=0==n?0:n<6?1:9==n?3:2;if(t[0]=120,t[1]=i<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var r=YH();r.p(e.dictionary),JH(t,2,r.d())}};function QH(t,e){e||(e={});var n=YH();n.p(t);var i=KH(t,e,e.dictionary?6:2,4);return $H(i,e),JH(i,i.length-4,n.d()),i}var tG="undefined"!=typeof TextDecoder&&new TextDecoder;try{tG.decode(ZH,{stream:!0})}catch(rJ){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function eG(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function nG(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==e);l=!0);}catch(t){c=!0,r=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return eG(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?eG(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iG(t){return new TextDecoder(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8").decode(t)}const rG=new TextEncoder;const aG=(()=>{const t=new Uint8Array(4);return!((new Uint32Array(t.buffer)[0]=1)&t[0])})(),oG={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class sG{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8192,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,It.A)(this,"buffer",void 0),(0,It.A)(this,"byteLength",void 0),(0,It.A)(this,"byteOffset",void 0),(0,It.A)(this,"length",void 0),(0,It.A)(this,"offset",void 0),(0,It.A)(this,"lastWrittenByte",void 0),(0,It.A)(this,"littleEndian",void 0),(0,It.A)(this,"_data",void 0),(0,It.A)(this,"_mark",void 0),(0,It.A)(this,"_marks",void 0);let n=!1;"number"===typeof t?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0,r=t.byteLength-i;let a=i;(ArrayBuffer.isView(t)||t instanceof sG)&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+i),t=t.buffer),this.lastWrittenByte=n?r:0,this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,r),this._mark=0,this._marks=[]}available(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+=t,this}back(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.available(t)){const e=2*(this.offset+t),n=new Uint8Array(e);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=e,this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.readArray(t,"uint8")}readArray(t,e){const n=oG[e].BYTES_PER_ELEMENT*t,i=this.byteOffset+this.offset,r=this.buffer.slice(i,i+n);if(this.littleEndian===aG&&"uint8"!==e&&"int8"!==e){const t=new Uint8Array(this.buffer.slice(i,i+n));t.reverse();const r=new oG[e](t.buffer);return this.offset+=n,r.reverse(),r}const a=new oG[e](r);return this.offset+=n,a}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return iG(this.readBytes(t))}decodeText(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";return iG(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(function(t){return rG.encode(t)}(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function lG(t){let e=t.length;for(;--e>=0;)t[e]=0}const cG=256,uG=286,hG=30,dG=15,pG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fG=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),mG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yG=new Array(576);lG(yG);const vG=new Array(60);lG(vG);const _G=new Array(512);lG(_G);const bG=new Array(256);lG(bG);const xG=new Array(29);lG(xG);const wG=new Array(hG);function SG(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let MG,TG,AG;function EG(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}lG(wG);const CG=t=>t<256?_G[t]:_G[256+(t>>>7)],PG=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},IG=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,PG(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},LG=(t,e,n)=>{IG(t,n[2*e],n[2*e+1])},kG=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},RG=(t,e,n)=>{const i=new Array(16);let r,a,o=0;for(r=1;r<=dG;r++)o=o+n[r-1]<<1,i[r]=o;for(a=0;a<=e;a++){let e=t[2*a+1];0!==e&&(t[2*a]=kG(i[e]++,e))}},DG=t=>{let e;for(e=0;e<uG;e++)t.dyn_ltree[2*e]=0;for(e=0;e<hG;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},NG=t=>{t.bi_valid>8?PG(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},zG=(t,e,n,i)=>{const r=2*e,a=2*n;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[n]},FG=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&zG(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!zG(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},OG=(t,e,n)=>{let i,r,a,o,s=0;if(0!==t.sym_next)do{i=255&t.pending_buf[t.sym_buf+s++],i+=(255&t.pending_buf[t.sym_buf+s++])<<8,r=t.pending_buf[t.sym_buf+s++],0===i?LG(t,r,e):(a=bG[r],LG(t,a+cG+1,e),o=pG[a],0!==o&&(r-=xG[a],IG(t,r,o)),i--,a=CG(i),LG(t,a,n),o=fG[a],0!==o&&(i-=wG[a],IG(t,i,o)))}while(s<t.sym_next);LG(t,256,e)},BG=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.elems;let o,s,l,c=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<a;o++)0!==n[2*o]?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[2*o+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[2*l]=1,t.depth[l]=0,t.opt_len--,r&&(t.static_len-=i[2*l+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)FG(t,n,o);l=a;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],FG(t,n,1),s=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=s,n[2*l]=n[2*o]+n[2*s],t.depth[l]=(t.depth[o]>=t.depth[s]?t.depth[o]:t.depth[s])+1,n[2*o+1]=n[2*s+1]=l,t.heap[1]=l++,FG(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,i=e.max_code,r=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,u,h,d,p,f,m=0;for(d=0;d<=dG;d++)t.bl_count[d]=0;for(n[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)u=t.heap[c],d=n[2*n[2*u+1]+1]+1,d>l&&(d=l,m++),n[2*u+1]=d,u>i||(t.bl_count[d]++,p=0,u>=s&&(p=o[u-s]),f=n[2*u],t.opt_len+=f*(d+p),a&&(t.static_len+=f*(r[2*u+1]+p)));if(0!==m){do{for(d=l-1;0===t.bl_count[d];)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[l]--,m-=2}while(m>0);for(d=l;0!==d;d--)for(u=t.bl_count[d];0!==u;)h=t.heap[--c],h>i||(n[2*h+1]!==d&&(t.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),u--)}})(t,e),RG(n,c,t.bl_count)},UG=(t,e,n)=>{let i,r,a=-1,o=e[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=e[2*(i+1)+1],++s<l&&r===o||(s<c?t.bl_tree[2*r]+=s:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4))},jG=(t,e,n)=>{let i,r,a=-1,o=e[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),i=0;i<=n;i++)if(r=o,o=e[2*(i+1)+1],!(++s<l&&r===o)){if(s<c)do{LG(t,r,t.bl_tree)}while(0!==--s);else 0!==r?(r!==a&&(LG(t,r,t.bl_tree),s--),LG(t,16,t.bl_tree),IG(t,s-3,2)):s<=10?(LG(t,17,t.bl_tree),IG(t,s-3,3)):(LG(t,18,t.bl_tree),IG(t,s-11,7));s=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4)}};let VG=!1;const HG=(t,e,n,i)=>{IG(t,0+(i?1:0),3),NG(t),PG(t,n),PG(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var GG=t=>{VG||((()=>{let t,e,n,i,r;const a=new Array(16);for(n=0,i=0;i<28;i++)for(xG[i]=n,t=0;t<1<<pG[i];t++)bG[n++]=i;for(bG[n-1]=i,r=0,i=0;i<16;i++)for(wG[i]=r,t=0;t<1<<fG[i];t++)_G[r++]=i;for(r>>=7;i<hG;i++)for(wG[i]=r<<7,t=0;t<1<<fG[i]-7;t++)_G[256+r++]=i;for(e=0;e<=dG;e++)a[e]=0;for(t=0;t<=143;)yG[2*t+1]=8,t++,a[8]++;for(;t<=255;)yG[2*t+1]=9,t++,a[9]++;for(;t<=279;)yG[2*t+1]=7,t++,a[7]++;for(;t<=287;)yG[2*t+1]=8,t++,a[8]++;for(RG(yG,287,a),t=0;t<hG;t++)vG[2*t+1]=5,vG[2*t]=kG(t,5);MG=new SG(yG,pG,257,uG,dG),TG=new SG(vG,fG,0,hG,dG),AG=new SG(new Array(0),mG,0,19,7)})(),VG=!0),t.l_desc=new EG(t.dyn_ltree,MG),t.d_desc=new EG(t.dyn_dtree,TG),t.bl_desc=new EG(t.bl_tree,AG),t.bi_buf=0,t.bi_valid=0,DG(t)},WG=(t,e,n,i)=>{let r,a,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<cG;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),BG(t,t.l_desc),BG(t,t.d_desc),o=(t=>{let e;for(UG(t,t.dyn_ltree,t.l_desc.max_code),UG(t,t.dyn_dtree,t.d_desc.max_code),BG(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*gG[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=r&&(r=a)):r=a=n+5,n+4<=r&&-1!==e?HG(t,e,n,i):4===t.strategy||a===r?(IG(t,2+(i?1:0),3),OG(t,yG,vG)):(IG(t,4+(i?1:0),3),((t,e,n,i)=>{let r;for(IG(t,e-257,5),IG(t,n-1,5),IG(t,i-4,4),r=0;r<i;r++)IG(t,t.bl_tree[2*gG[r]+1],3);jG(t,t.dyn_ltree,e-1),jG(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),OG(t,t.dyn_ltree,t.dyn_dtree)),DG(t),i&&NG(t)},qG=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(bG[n]+cG+1)]++,t.dyn_dtree[2*CG(e)]++),t.sym_next===t.sym_end),ZG=t=>{IG(t,2,3),LG(t,256,yG),(t=>{16===t.bi_valid?(PG(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)},XG={_tr_init:GG,_tr_stored_block:HG,_tr_flush_block:WG,_tr_tally:qG,_tr_align:ZG};var YG=(t,e,n,i)=>{let r=65535&t,a=t>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{r=r+e[i++]|0,a=a+r|0}while(--o);r%=65521,a%=65521}return r|a<<16};const KG=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var JG=(t,e,n,i)=>{const r=KG,a=i+n;t^=-1;for(let o=i;o<a;o++)t=t>>>8^r[255&(t^e[o])];return-1^t},$G={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},QG={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:tW,_tr_stored_block:eW,_tr_flush_block:nW,_tr_tally:iW,_tr_align:rW}=XG,{Z_NO_FLUSH:aW,Z_PARTIAL_FLUSH:oW,Z_FULL_FLUSH:sW,Z_FINISH:lW,Z_BLOCK:cW,Z_OK:uW,Z_STREAM_END:hW,Z_STREAM_ERROR:dW,Z_DATA_ERROR:pW,Z_BUF_ERROR:fW,Z_DEFAULT_COMPRESSION:mW,Z_FILTERED:gW,Z_HUFFMAN_ONLY:yW,Z_RLE:vW,Z_FIXED:_W,Z_DEFAULT_STRATEGY:bW,Z_UNKNOWN:xW,Z_DEFLATED:wW}=QG,SW=258,MW=262,TW=42,AW=113,EW=666,CW=(t,e)=>(t.msg=$G[e],e),PW=t=>2*t-(t>4?9:0),IW=t=>{let e=t.length;for(;--e>=0;)t[e]=0},LW=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do{n=t.head[--i],t.head[i]=n>=r?n-r:0}while(--e);e=r,i=e;do{n=t.prev[--i],t.prev[i]=n>=r?n-r:0}while(--e)};let kW=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const RW=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},DW=(t,e)=>{nW(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,RW(t.strm)},NW=(t,e)=>{t.pending_buf[t.pending++]=e},zW=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},FW=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),1===t.state.wrap?t.adler=YG(t.adler,e,r,n):2===t.state.wrap&&(t.adler=JG(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},OW=(t,e)=>{let n,i,r=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match;const l=t.strstart>t.w_size-MW?t.strstart-(t.w_size-MW):0,c=t.window,u=t.w_mask,h=t.prev,d=t.strstart+SW;let p=c[a+o-1],f=c[a+o];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do{if(n=e,c[n+o]===f&&c[n+o-1]===p&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d);if(i=SW-(d-a),a=d-SW,i>o){if(t.match_start=e,o=i,i>=s)break;p=c[a+o-1],f=c[a+o]}}}while((e=h[e&u])>l&&0!==--r);return o<=t.lookahead?o:t.lookahead},BW=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-MW)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),LW(t),i+=e),0===t.strm.avail_in)break;if(n=FW(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=kW(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=kW(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<MW&&0!==t.strm.avail_in)},UW=(t,e)=>{let n,i,r,a=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,s=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r)break;if(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<a&&(0===n&&e!==lW||e===aW||n!==i+t.strm.avail_in))break;o=e===lW&&n===i+t.strm.avail_in?1:0,eW(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,RW(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(FW(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(0===o);return s-=t.strm.avail_in,s&&(s>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=s&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-s,t.strm.next_in),t.strstart),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==aW&&e!==lW&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(FW(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,a=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=a||(i||e===lW)&&e!==aW&&0===t.strm.avail_in&&i<=r)&&(n=i>r?r:i,o=e===lW&&0===t.strm.avail_in&&n===i?1:0,eW(t,t.block_start,n,o),t.block_start+=n,RW(t.strm)),o?3:1)},jW=(t,e)=>{let n,i;for(;;){if(t.lookahead<MW){if(BW(t),t.lookahead<MW&&e===aW)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=kW(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-MW&&(t.match_length=OW(t,n)),t.match_length>=3)if(i=iW(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=kW(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=kW(t,t.ins_h,t.window[t.strstart+1]);else i=iW(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(DW(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===lW?(DW(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(DW(t,!1),0===t.strm.avail_out)?1:2},VW=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<MW){if(BW(t),t.lookahead<MW&&e===aW)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=kW(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-MW&&(t.match_length=OW(t,n),t.match_length<=5&&(t.strategy===gW||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=iW(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=kW(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(DW(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=iW(t,0,t.window[t.strstart-1]),i&&DW(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=iW(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===lW?(DW(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(DW(t,!1),0===t.strm.avail_out)?1:2};function HW(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const GW=[new HW(0,0,0,0,UW),new HW(4,4,8,4,jW),new HW(4,5,16,8,jW),new HW(4,6,32,32,jW),new HW(4,4,16,16,VW),new HW(8,16,32,32,VW),new HW(8,16,128,128,VW),new HW(8,32,128,256,VW),new HW(32,128,258,1024,VW),new HW(32,258,258,4096,VW)];function WW(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=wW,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),IW(this.dyn_ltree),IW(this.dyn_dtree),IW(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),IW(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),IW(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const qW=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==TW&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==AW&&e.status!==EW?1:0},ZW=t=>{if(qW(t))return CW(t,dW);t.total_in=t.total_out=0,t.data_type=xW;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?TW:AW,t.adler=2===e.wrap?0:1,e.last_flush=-2,tW(e),uW},XW=t=>{const e=ZW(t);return e===uW&&(t=>{t.window_size=2*t.w_size,IW(t.head),t.max_lazy_match=GW[t.level].max_lazy,t.good_match=GW[t.level].good_length,t.nice_match=GW[t.level].nice_length,t.max_chain_length=GW[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0})(t.state),e},YW=(t,e,n,i,r,a)=>{if(!t)return dW;let o=1;if(e===mW&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==wW||i<8||i>15||e<0||e>9||a<0||a>_W||8===i&&1!==o)return CW(t,dW);8===i&&(i=9);const s=new WW;return t.state=s,s.strm=t,s.status=TW,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=e,s.strategy=a,s.method=n,XW(t)};var KW=(t,e)=>{if(qW(t)||e>cW||e<0)return t?CW(t,dW):dW;const n=t.state;if(!t.output||0!==t.avail_in&&!t.input||n.status===EW&&e!==lW)return CW(t,0===t.avail_out?fW:dW);const i=n.last_flush;if(n.last_flush=e,0!==n.pending){if(RW(t),0===t.avail_out)return n.last_flush=-1,uW}else if(0===t.avail_in&&PW(e)<=PW(i)&&e!==lW)return CW(t,fW);if(n.status===EW&&0!==t.avail_in)return CW(t,fW);if(n.status===TW&&0===n.wrap&&(n.status=AW),n.status===TW){let e=wW+(n.w_bits-8<<4)<<8,i=-1;if(i=n.strategy>=yW||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=i<<6,0!==n.strstart&&(e|=32),e+=31-e%31,zW(n,e),0!==n.strstart&&(zW(n,t.adler>>>16),zW(n,65535&t.adler)),t.adler=1,n.status=AW,RW(t),0!==n.pending)return n.last_flush=-1,uW}if(57===n.status)if(t.adler=0,NW(n,31),NW(n,139),NW(n,8),n.gzhead)NW(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),NW(n,255&n.gzhead.time),NW(n,n.gzhead.time>>8&255),NW(n,n.gzhead.time>>16&255),NW(n,n.gzhead.time>>24&255),NW(n,9===n.level?2:n.strategy>=yW||n.level<2?4:0),NW(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(NW(n,255&n.gzhead.extra.length),NW(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=JG(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(NW(n,0),NW(n,0),NW(n,0),NW(n,0),NW(n,0),NW(n,9===n.level?2:n.strategy>=yW||n.level<2?4:0),NW(n,3),n.status=AW,RW(t),0!==n.pending)return n.last_flush=-1,uW;if(69===n.status){if(n.gzhead.extra){let e=n.pending,i=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+i>n.pending_buf_size;){let r=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>e&&(t.adler=JG(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex+=r,RW(t),0!==n.pending)return n.last_flush=-1,uW;e=0,i-=r}let r=new Uint8Array(n.gzhead.extra);n.pending_buf.set(r.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending+=i,n.gzhead.hcrc&&n.pending>e&&(t.adler=JG(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let e,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=JG(t.adler,n.pending_buf,n.pending-i,i)),RW(t),0!==n.pending)return n.last_flush=-1,uW;i=0}e=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,NW(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>i&&(t.adler=JG(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let e,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=JG(t.adler,n.pending_buf,n.pending-i,i)),RW(t),0!==n.pending)return n.last_flush=-1,uW;i=0}e=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,NW(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>i&&(t.adler=JG(t.adler,n.pending_buf,n.pending-i,i))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(RW(t),0!==n.pending))return n.last_flush=-1,uW;NW(n,255&t.adler),NW(n,t.adler>>8&255),t.adler=0}if(n.status=AW,RW(t),0!==n.pending)return n.last_flush=-1,uW}if(0!==t.avail_in||0!==n.lookahead||e!==aW&&n.status!==EW){let i=0===n.level?UW(n,e):n.strategy===yW?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(BW(t),0===t.lookahead)){if(e===aW)return 1;break}if(t.match_length=0,n=iW(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(DW(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===lW?(DW(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(DW(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===vW?((t,e)=>{let n,i,r,a;const o=t.window;for(;;){if(t.lookahead<=SW){if(BW(t),t.lookahead<=SW&&e===aW)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,i=o[r],i===o[++r]&&i===o[++r]&&i===o[++r])){a=t.strstart+SW;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<a);t.match_length=SW-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=iW(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=iW(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(DW(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===lW?(DW(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(DW(t,!1),0===t.strm.avail_out)?1:2})(n,e):GW[n.level].func(n,e);if(3!==i&&4!==i||(n.status=EW),1===i||3===i)return 0===t.avail_out&&(n.last_flush=-1),uW;if(2===i&&(e===oW?rW(n):e!==cW&&(eW(n,0,0,!1),e===sW&&(IW(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),RW(t),0===t.avail_out))return n.last_flush=-1,uW}return e!==lW?uW:n.wrap<=0?hW:(2===n.wrap?(NW(n,255&t.adler),NW(n,t.adler>>8&255),NW(n,t.adler>>16&255),NW(n,t.adler>>24&255),NW(n,255&t.total_in),NW(n,t.total_in>>8&255),NW(n,t.total_in>>16&255),NW(n,t.total_in>>24&255)):(zW(n,t.adler>>>16),zW(n,65535&t.adler)),RW(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?uW:hW)},JW=(t,e)=>{let n=e.length;if(qW(t))return dW;const i=t.state,r=i.wrap;if(2===r||1===r&&i.status!==TW||i.lookahead)return dW;if(1===r&&(t.adler=YG(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){0===r&&(IW(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(n-i.w_size,n),0),e=t,n=i.w_size}const a=t.avail_in,o=t.next_in,s=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,BW(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=kW(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,BW(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=o,t.input=s,t.avail_in=a,i.wrap=r,uW},$W={deflateInit:(t,e)=>YW(t,e,wW,15,8,bW),deflateInit2:YW,deflateReset:XW,deflateResetKeep:ZW,deflateSetHeader:(t,e)=>qW(t)||2!==t.state.wrap?dW:(t.state.gzhead=e,uW),deflate:KW,deflateEnd:t=>{if(qW(t))return dW;const e=t.state.status;return t.state=null,e===AW?CW(t,pW):uW},deflateSetDictionary:JW,deflateInfo:"pako deflate (from Nodeca project)"};const QW=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var tq=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const e in n)QW(n,e)&&(t[e]=n[e])}}return t},eq=t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,a=t.length;i<a;i++){let e=t[i];n.set(e,r),r+=e.length}return n};let nq=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(aJ){nq=!1}const iq=new Uint8Array(256);for(let n=0;n<256;n++)iq[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;iq[254]=iq[254]=1;var rq=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,i,r,a,o=t.length,s=0;for(r=0;r<o;r++)n=t.charCodeAt(r),55296===(64512&n)&&r+1<o&&(i=t.charCodeAt(r+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(s),a=0,r=0;a<s;r++)n=t.charCodeAt(r),55296===(64512&n)&&r+1<o&&(i=t.charCodeAt(r+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},aq=(t,e)=>{const n=e||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,r;const a=new Array(2*n);for(r=0,i=0;i<n;){let e=t[i++];if(e<128){a[r++]=e;continue}let o=iq[e];if(o>4)a[r++]=65533,i+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&i<n;)e=e<<6|63&t[i++],o--;o>1?a[r++]=65533:e<65536?a[r++]=e:(e-=65536,a[r++]=55296|e>>10&1023,a[r++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&nq)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n})(a,r)},oq=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128===(192&t[n]);)n--;return n<0||0===n?e:n+iq[t[n]]>e?n:e};var sq=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const lq=Object.prototype.toString,{Z_NO_FLUSH:cq,Z_SYNC_FLUSH:uq,Z_FULL_FLUSH:hq,Z_FINISH:dq,Z_OK:pq,Z_STREAM_END:fq,Z_DEFAULT_COMPRESSION:mq,Z_DEFAULT_STRATEGY:gq,Z_DEFLATED:yq}=QG;function vq(t){this.options=tq({level:mq,method:yq,chunkSize:16384,windowBits:15,memLevel:8,strategy:gq},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new sq,this.strm.avail_out=0;let n=$W.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==pq)throw new Error($G[n]);if(e.header&&$W.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"===typeof e.dictionary?rq(e.dictionary):"[object ArrayBuffer]"===lq.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=$W.deflateSetDictionary(this.strm,t),n!==pq)throw new Error($G[n]);this._dict_set=!0}}function _q(t,e){const n=new vq(e);if(n.push(t,!0),n.err)throw n.msg||$G[n.err];return n.result}vq.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?dq:cq,"string"===typeof t?n.input=rq(t):"[object ArrayBuffer]"===lq.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(a===uq||a===hq)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=$W.deflate(n,a),r===fq)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=$W.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===pq;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},vq.prototype.onData=function(t){this.chunks.push(t)},vq.prototype.onEnd=function(t){t===pq&&(this.result=eq(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var bq={Deflate:vq,deflate:_q,deflateRaw:function(t,e){return(e=e||{}).raw=!0,_q(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,_q(t,e)},constants:QG};const xq=16209;var wq=function(t,e){let n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M,T;const A=t.state;n=t.next_in,M=t.input,i=n+(t.avail_in-5),r=t.next_out,T=t.output,a=r-(e-t.avail_out),o=r+(t.avail_out-257),s=A.dmax,l=A.wsize,c=A.whave,u=A.wnext,h=A.window,d=A.hold,p=A.bits,f=A.lencode,m=A.distcode,g=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;t:do{p<15&&(d+=M[n++]<<p,p+=8,d+=M[n++]<<p,p+=8),v=f[d&g];e:for(;;){if(_=v>>>24,d>>>=_,p-=_,_=v>>>16&255,0===_)T[r++]=65535&v;else{if(!(16&_)){if(0===(64&_)){v=f[(65535&v)+(d&(1<<_)-1)];continue e}if(32&_){A.mode=16191;break t}t.msg="invalid literal/length code",A.mode=xq;break t}b=65535&v,_&=15,_&&(p<_&&(d+=M[n++]<<p,p+=8),b+=d&(1<<_)-1,d>>>=_,p-=_),p<15&&(d+=M[n++]<<p,p+=8,d+=M[n++]<<p,p+=8),v=m[d&y];n:for(;;){if(_=v>>>24,d>>>=_,p-=_,_=v>>>16&255,!(16&_)){if(0===(64&_)){v=m[(65535&v)+(d&(1<<_)-1)];continue n}t.msg="invalid distance code",A.mode=xq;break t}if(x=65535&v,_&=15,p<_&&(d+=M[n++]<<p,p+=8,p<_&&(d+=M[n++]<<p,p+=8)),x+=d&(1<<_)-1,x>s){t.msg="invalid distance too far back",A.mode=xq;break t}if(d>>>=_,p-=_,_=r-a,x>_){if(_=x-_,_>c&&A.sane){t.msg="invalid distance too far back",A.mode=xq;break t}if(w=0,S=h,0===u){if(w+=l-_,_<b){b-=_;do{T[r++]=h[w++]}while(--_);w=r-x,S=T}}else if(u<_){if(w+=l+u-_,_-=u,_<b){b-=_;do{T[r++]=h[w++]}while(--_);if(w=0,u<b){_=u,b-=_;do{T[r++]=h[w++]}while(--_);w=r-x,S=T}}}else if(w+=u-_,_<b){b-=_;do{T[r++]=h[w++]}while(--_);w=r-x,S=T}for(;b>2;)T[r++]=S[w++],T[r++]=S[w++],T[r++]=S[w++],b-=3;b&&(T[r++]=S[w++],b>1&&(T[r++]=S[w++]))}else{w=r-x;do{T[r++]=T[w++],T[r++]=T[w++],T[r++]=T[w++],b-=3}while(b>2);b&&(T[r++]=T[w++],b>1&&(T[r++]=T[w++]))}break}}break}}while(n<i&&r<o);b=p>>3,n-=b,p-=b<<3,d&=(1<<p)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<o?o-r+257:257-(r-o),A.hold=d,A.bits=p};const Sq=15,Mq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Tq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Aq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Eq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Cq=(t,e,n,i,r,a,o,s)=>{const l=s.bits;let c,u,h,d,p,f,m=0,g=0,y=0,v=0,_=0,b=0,x=0,w=0,S=0,M=0,T=null;const A=new Uint16Array(16),E=new Uint16Array(16);let C,P,I,L=null;for(m=0;m<=Sq;m++)A[m]=0;for(g=0;g<i;g++)A[e[n+g]]++;for(_=l,v=Sq;v>=1&&0===A[v];v--);if(_>v&&(_=v),0===v)return r[a++]=20971520,r[a++]=20971520,s.bits=1,0;for(y=1;y<v&&0===A[y];y++);for(_<y&&(_=y),w=1,m=1;m<=Sq;m++)if(w<<=1,w-=A[m],w<0)return-1;if(w>0&&(0===t||1!==v))return-1;for(E[1]=0,m=1;m<Sq;m++)E[m+1]=E[m]+A[m];for(g=0;g<i;g++)0!==e[n+g]&&(o[E[e[n+g]]++]=g);if(0===t?(T=L=o,f=20):1===t?(T=Mq,L=Tq,f=257):(T=Aq,L=Eq,f=0),M=0,g=0,m=y,p=a,b=_,x=0,h=-1,S=1<<_,d=S-1,1===t&&S>852||2===t&&S>592)return 1;for(;;){C=m-x,o[g]+1<f?(P=0,I=o[g]):o[g]>=f?(P=L[o[g]-f],I=T[o[g]-f]):(P=96,I=0),c=1<<m-x,u=1<<b,y=u;do{u-=c,r[p+(M>>x)+u]=C<<24|P<<16|I}while(0!==u);for(c=1<<m-1;M&c;)c>>=1;if(0!==c?(M&=c-1,M+=c):M=0,g++,0===--A[m]){if(m===v)break;m=e[n+o[g]]}if(m>_&&(M&d)!==h){for(0===x&&(x=_),p+=y,b=m-x,w=1<<b;b+x<v&&(w-=A[b+x],!(w<=0));)b++,w<<=1;if(S+=1<<b,1===t&&S>852||2===t&&S>592)return 1;h=M&d,r[h]=_<<24|b<<16|p-a}}return 0!==M&&(r[p+M]=m-x<<24|64<<16),s.bits=_,0};const{Z_FINISH:Pq,Z_BLOCK:Iq,Z_TREES:Lq,Z_OK:kq,Z_STREAM_END:Rq,Z_NEED_DICT:Dq,Z_STREAM_ERROR:Nq,Z_DATA_ERROR:zq,Z_MEM_ERROR:Fq,Z_BUF_ERROR:Oq,Z_DEFLATED:Bq}=QG,Uq=16180,jq=16190,Vq=16191,Hq=16192,Gq=16194,Wq=16199,qq=16200,Zq=16206,Xq=16209,Yq=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Kq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Jq=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Uq||e.mode>16211?1:0},$q=t=>{if(Jq(t))return Nq;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Uq,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,kq},Qq=t=>{if(Jq(t))return Nq;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,$q(t)},tZ=(t,e)=>{let n;if(Jq(t))return Nq;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Nq:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,Qq(t))},eZ=(t,e)=>{if(!t)return Nq;const n=new Kq;t.state=n,n.strm=t,n.window=null,n.mode=Uq;const i=tZ(t,e);return i!==kq&&(t.state=null),i};let nZ,iZ,rZ=!0;const aZ=t=>{if(rZ){nZ=new Int32Array(512),iZ=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Cq(1,t.lens,0,288,nZ,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Cq(2,t.lens,0,32,iZ,0,t.work,{bits:5}),rZ=!1}t.lencode=nZ,t.lenbits=9,t.distcode=iZ,t.distbits=5},oZ=(t,e,n,i)=>{let r;const a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(e.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(e.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var sZ=(t,e)=>{let n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M=0;const T=new Uint8Array(4);let A,E;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Jq(t)||!t.output||!t.input&&0!==t.avail_in)return Nq;n=t.state,n.mode===Vq&&(n.mode=Hq),o=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,i=t.input,s=t.avail_in,c=n.hold,u=n.bits,h=s,d=l,S=kq;t:for(;;)switch(n.mode){case Uq:if(0===n.wrap){n.mode=Hq;break}for(;u<16;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,T[0]=255&c,T[1]=c>>>8&255,n.check=JG(n.check,T,2,0),c=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",n.mode=Xq;break}if((15&c)!==Bq){t.msg="unknown compression method",n.mode=Xq;break}if(c>>>=4,u-=4,w=8+(15&c),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){t.msg="invalid window size",n.mode=Xq;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&c?16189:Vq,c=0,u=0;break;case 16181:for(;u<16;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==Bq){t.msg="unknown compression method",n.mode=Xq;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Xq;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(T[0]=255&c,T[1]=c>>>8&255,n.check=JG(n.check,T,2,0)),c=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,n.check=JG(n.check,T,4,0)),c=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(T[0]=255&c,T[1]=c>>>8&255,n.check=JG(n.check,T,2,0)),c=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(T[0]=255&c,T[1]=c>>>8&255,n.check=JG(n.check,T,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(p=n.length,p>s&&(p=s),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+p),w)),512&n.flags&&4&n.wrap&&(n.check=JG(n.check,i,p,a)),s-=p,a+=p,n.length-=p),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===s)break t;p=0;do{w=i[a+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<s);if(512&n.flags&&4&n.wrap&&(n.check=JG(n.check,i,p,a)),s-=p,a+=p,w)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===s)break t;p=0;do{w=i[a+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<s);if(512&n.flags&&4&n.wrap&&(n.check=JG(n.check,i,p,a)),s-=p,a+=p,w)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(4&n.wrap&&c!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Xq;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Vq;break;case 16189:for(;u<32;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}t.adler=n.check=Yq(c),c=0,u=0,n.mode=jq;case jq:if(0===n.havedict)return t.next_out=o,t.avail_out=l,t.next_in=a,t.avail_in=s,n.hold=c,n.bits=u,Dq;t.adler=n.check=1,n.mode=Vq;case Vq:if(e===Iq||e===Lq)break t;case Hq:if(n.last){c>>>=7&u,u-=7&u,n.mode=Zq;break}for(;u<3;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}switch(n.last=1&c,c>>>=1,u-=1,3&c){case 0:n.mode=16193;break;case 1:if(aZ(n),n.mode=Wq,e===Lq){c>>>=2,u-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Xq}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Xq;break}if(n.length=65535&c,c=0,u=0,n.mode=Gq,e===Lq)break t;case Gq:n.mode=16195;case 16195:if(p=n.length,p){if(p>s&&(p=s),p>l&&(p=l),0===p)break t;r.set(i.subarray(a,a+p),o),s-=p,a+=p,l-=p,o+=p,n.length-=p;break}n.mode=Vq;break;case 16196:for(;u<14;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Xq;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}n.lens[C[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[C[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},S=Cq(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,S){t.msg="invalid code lengths set",n.mode=Xq;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;M=n.lencode[c&(1<<n.lenbits)-1],g=M>>>24,y=M>>>16&255,v=65535&M,!(g<=u);){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(E=g+2;u<E;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){t.msg="invalid bit length repeat",n.mode=Xq;break}w=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(E=g+3;u<E;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}c>>>=g,u-=g,w=0,p=3+(7&c),c>>>=3,u-=3}else{for(E=g+7;u<E;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}c>>>=g,u-=g,w=0,p=11+(127&c),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Xq;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===Xq)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Xq;break}if(n.lenbits=9,A={bits:n.lenbits},S=Cq(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,S){t.msg="invalid literal/lengths set",n.mode=Xq;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},S=Cq(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,S){t.msg="invalid distances set",n.mode=Xq;break}if(n.mode=Wq,e===Lq)break t;case Wq:n.mode=qq;case qq:if(s>=6&&l>=258){t.next_out=o,t.avail_out=l,t.next_in=a,t.avail_in=s,n.hold=c,n.bits=u,wq(t,d),o=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,i=t.input,s=t.avail_in,c=n.hold,u=n.bits,n.mode===Vq&&(n.back=-1);break}for(n.back=0;M=n.lencode[c&(1<<n.lenbits)-1],g=M>>>24,y=M>>>16&255,v=65535&M,!(g<=u);){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(y&&0===(240&y)){for(_=g,b=y,x=v;M=n.lencode[x+((c&(1<<_+b)-1)>>_)],g=M>>>24,y=M>>>16&255,v=65535&M,!(_+g<=u);){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}c>>>=_,u-=_,n.back+=_}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===y){n.mode=16205;break}if(32&y){n.back=-1,n.mode=Vq;break}if(64&y){t.msg="invalid literal/length code",n.mode=Xq;break}n.extra=15&y,n.mode=16201;case 16201:if(n.extra){for(E=n.extra;u<E;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;M=n.distcode[c&(1<<n.distbits)-1],g=M>>>24,y=M>>>16&255,v=65535&M,!(g<=u);){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(0===(240&y)){for(_=g,b=y,x=v;M=n.distcode[x+((c&(1<<_+b)-1)>>_)],g=M>>>24,y=M>>>16&255,v=65535&M,!(_+g<=u);){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}c>>>=_,u-=_,n.back+=_}if(c>>>=g,u-=g,n.back+=g,64&y){t.msg="invalid distance code",n.mode=Xq;break}n.offset=v,n.extra=15&y,n.mode=16203;case 16203:if(n.extra){for(E=n.extra;u<E;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Xq;break}n.mode=16204;case 16204:if(0===l)break t;if(p=d-l,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Xq;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=r,f=o-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{r[o++]=m[f++]}while(--p);0===n.length&&(n.mode=qq);break;case 16205:if(0===l)break t;r[o++]=n.length,l--,n.mode=qq;break;case Zq:if(n.wrap){for(;u<32;){if(0===s)break t;s--,c|=i[a++]<<u,u+=8}if(d-=l,t.total_out+=d,n.total+=d,4&n.wrap&&d&&(t.adler=n.check=n.flags?JG(n.check,r,d,o-d):YG(n.check,r,d,o-d)),d=l,4&n.wrap&&(n.flags?c:Yq(c))!==n.check){t.msg="incorrect data check",n.mode=Xq;break}c=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break t;s--,c+=i[a++]<<u,u+=8}if(4&n.wrap&&c!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Xq;break}c=0,u=0}n.mode=16208;case 16208:S=Rq;break t;case Xq:S=zq;break t;case 16210:return Fq;default:return Nq}return t.next_out=o,t.avail_out=l,t.next_in=a,t.avail_in=s,n.hold=c,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<Xq&&(n.mode<Zq||e!==Pq))&&oZ(t,t.output,t.next_out,d-t.avail_out),h-=t.avail_in,d-=t.avail_out,t.total_in+=h,t.total_out+=d,n.total+=d,4&n.wrap&&d&&(t.adler=n.check=n.flags?JG(n.check,r,d,t.next_out-d):YG(n.check,r,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Vq?128:0)+(n.mode===Wq||n.mode===Gq?256:0),(0===h&&0===d||e===Pq)&&S===kq&&(S=Oq),S},lZ={inflateReset:Qq,inflateReset2:tZ,inflateResetKeep:$q,inflateInit:t=>eZ(t,15),inflateInit2:eZ,inflate:sZ,inflateEnd:t=>{if(Jq(t))return Nq;let e=t.state;return e.window&&(e.window=null),t.state=null,kq},inflateGetHeader:(t,e)=>{if(Jq(t))return Nq;const n=t.state;return 0===(2&n.wrap)?Nq:(n.head=e,e.done=!1,kq)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,a;return Jq(t)?Nq:(i=t.state,0!==i.wrap&&i.mode!==jq?Nq:i.mode===jq&&(r=1,r=YG(r,e,n,0),r!==i.check)?zq:(a=oZ(t,e,n,n),a?(i.mode=16210,Fq):(i.havedict=1,kq)))},inflateInfo:"pako inflate (from Nodeca project)"};var cZ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const uZ=Object.prototype.toString,{Z_NO_FLUSH:hZ,Z_FINISH:dZ,Z_OK:pZ,Z_STREAM_END:fZ,Z_NEED_DICT:mZ,Z_STREAM_ERROR:gZ,Z_DATA_ERROR:yZ,Z_MEM_ERROR:vZ}=QG;function _Z(t){this.options=tq({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new sq,this.strm.avail_out=0;let n=lZ.inflateInit2(this.strm,e.windowBits);if(n!==pZ)throw new Error($G[n]);if(this.header=new cZ,lZ.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=rq(e.dictionary):"[object ArrayBuffer]"===uZ.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=lZ.inflateSetDictionary(this.strm,e.dictionary),n!==pZ)))throw new Error($G[n])}function bZ(t,e){const n=new _Z(e);if(n.push(t),n.err)throw n.msg||$G[n.err];return n.result}_Z.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let a,o,s;if(this.ended)return!1;for(o=e===~~e?e:!0===e?dZ:hZ,"[object ArrayBuffer]"===uZ.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),a=lZ.inflate(n,o),a===mZ&&r&&(a=lZ.inflateSetDictionary(n,r),a===pZ?a=lZ.inflate(n,o):a===yZ&&(a=mZ));n.avail_in>0&&a===fZ&&n.state.wrap>0&&0!==t[n.next_in];)lZ.inflateReset(n),a=lZ.inflate(n,o);switch(a){case gZ:case yZ:case mZ:case vZ:return this.onEnd(a),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(0===n.avail_out||a===fZ))if("string"===this.options.to){let t=oq(n.output,n.next_out),e=n.next_out-t,r=aq(n.output,t);n.next_out=e,n.avail_out=i-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==pZ||0!==s){if(a===fZ)return a=lZ.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},_Z.prototype.onData=function(t){this.chunks.push(t)},_Z.prototype.onEnd=function(t){t===pZ&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=eq(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var xZ={Inflate:_Z,inflate:bZ,inflateRaw:function(t,e){return(e=e||{}).raw=!0,bZ(t,e)},ungzip:bZ,constants:QG};const{Deflate:wZ,deflate:SZ,deflateRaw:MZ,gzip:TZ}=bq,{Inflate:AZ,inflate:EZ,inflateRaw:CZ,ungzip:PZ}=xZ;var IZ=AZ,LZ=EZ;const kZ=[];for(let n=0;n<256;n++){let t=n;for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;kZ[n]=t}const RZ=4294967295;function DZ(t,e){return(function(t,e,n){let i=t;for(let r=0;r<n;r++)i=kZ[255&(i^e[r])]^i>>>8;return i}(RZ,t,e)^RZ)>>>0}function NZ(t,e,n){const i=t.readUint32(),r=DZ(new Uint8Array(t.buffer,t.byteOffset+t.offset-e-4,e),e);if(r!==i)throw new Error("CRC mismatch for chunk ".concat(n,". Expected ").concat(i,", found ").concat(r))}function zZ(t,e,n){for(let i=0;i<n;i++)e[i]=t[i]}function FZ(t,e,n,i){let r=0;for(;r<i;r++)e[r]=t[r];for(;r<n;r++)e[r]=t[r]+e[r-i]&255}function OZ(t,e,n,i){let r=0;if(0===n.length)for(;r<i;r++)e[r]=t[r];else for(;r<i;r++)e[r]=t[r]+n[r]&255}function BZ(t,e,n,i,r){let a=0;if(0===n.length){for(;a<r;a++)e[a]=t[a];for(;a<i;a++)e[a]=t[a]+(e[a-r]>>1)&255}else{for(;a<r;a++)e[a]=t[a]+(n[a]>>1)&255;for(;a<i;a++)e[a]=t[a]+(e[a-r]+n[a]>>1)&255}}function UZ(t,e,n,i,r){let a=0;if(0===n.length){for(;a<r;a++)e[a]=t[a];for(;a<i;a++)e[a]=t[a]+e[a-r]&255}else{for(;a<r;a++)e[a]=t[a]+n[a]&255;for(;a<i;a++)e[a]=t[a]+jZ(e[a-r],n[a],n[a-r])&255}}function jZ(t,e,n){const i=t+e-n,r=Math.abs(i-t),a=Math.abs(i-e),o=Math.abs(i-n);return r<=a&&r<=o?t:a<=o?e:n}function VZ(t,e,n,i,r,a){switch(t){case 0:zZ(e,n,r);break;case 1:FZ(e,n,r,a);break;case 2:OZ(e,n,i,r);break;case 3:BZ(e,n,i,r,a);break;case 4:UZ(e,n,i,r,a);break;default:throw new Error("Unsupported filter: ".concat(t))}}const HZ=new Uint16Array([255]),GZ=255===new Uint8Array(HZ.buffer)[0];function WZ(t){return(255&t)<<8|t>>8&255}const qZ=new Uint16Array([255]),ZZ=255===new Uint8Array(qZ.buffer)[0],XZ=new Uint8Array(0);function YZ(t){const{data:e,width:n,height:i,channels:r,depth:a}=t,o=Math.ceil(a/8)*r,s=Math.ceil(a/8*r*n),l=new Uint8Array(i*s);let c,u,h=XZ,d=0;for(let p=0;p<i;p++){switch(c=e.subarray(d+1,d+1+s),u=l.subarray(p*s,(p+1)*s),e[d]){case 0:zZ(c,u,s);break;case 1:FZ(c,u,s,o);break;case 2:OZ(c,u,h,s);break;case 3:BZ(c,u,h,s,o);break;case 4:UZ(c,u,h,s,o);break;default:throw new Error("Unsupported filter: ".concat(e[d]))}h=u,d+=s+1}if(16===a){const t=new Uint16Array(l.buffer);if(ZZ)for(let e=0;e<t.length;e++)t[e]=KZ(t[e]);return t}return l}function KZ(t){return(255&t)<<8|t>>8&255}const JZ=Uint8Array.of(137,80,78,71,13,10,26,10);function $Z(t){if(!function(t){if(t.length<JZ.length)return!1;for(let e=0;e<JZ.length;e++)if(t[e]!==JZ[e])return!1;return!0}(t.readBytes(JZ.length)))throw new Error("wrong PNG signature")}const QZ="tEXt",tX=new TextDecoder("latin1");function eX(t){if(iX(t),0===t.length||t.length>79)throw new Error("keyword length must be between 1 and 79")}const nX=/^[\u0000-\u00FF]*$/;function iX(t){if(!nX.test(t))throw new Error("invalid latin1 text")}function rX(t,e,n){const i=aX(e);t[i]=function(t,e){return tX.decode(t.readBytes(e))}(e,n-i.length-1)}function aX(t){for(t.mark();0!==t.readByte(););const e=t.offset;t.reset();const n=tX.decode(t.readBytes(e-t.offset-1));return t.skip(1),eX(n),n}const oX=-1,sX=0,lX=2,cX=3,uX=4,hX=6,dX=-1,pX=0,fX=-1,mX=0,gX=-1,yX=0,vX=1,_X=0,bX=1,xX=2,wX=0,SX=1;class MX extends sG{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),(0,It.A)(this,"_checkCrc",void 0),(0,It.A)(this,"_inflator",void 0),(0,It.A)(this,"_png",void 0),(0,It.A)(this,"_apng",void 0),(0,It.A)(this,"_end",void 0),(0,It.A)(this,"_hasPalette",void 0),(0,It.A)(this,"_palette",void 0),(0,It.A)(this,"_hasTransparency",void 0),(0,It.A)(this,"_transparency",void 0),(0,It.A)(this,"_compressionMethod",void 0),(0,It.A)(this,"_filterMethod",void 0),(0,It.A)(this,"_interlaceMethod",void 0),(0,It.A)(this,"_colorType",void 0),(0,It.A)(this,"_isAnimated",void 0),(0,It.A)(this,"_numberOfFrames",void 0),(0,It.A)(this,"_numberOfPlays",void 0),(0,It.A)(this,"_frames",void 0),(0,It.A)(this,"_writingDataChunks",void 0);const{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new IZ,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=dX,this._filterMethod=fX,this._interlaceMethod=gX,this._colorType=oX,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for($Z(this);!this._end;){const t=this.readUint32(),e=this.readChars(4);this.decodeChunk(t,e)}return this.decodeImage(),this._png}decodeApng(){for($Z(this);!this._end;){const t=this.readUint32(),e=this.readChars(4);this.decodeApngChunk(t,e)}return this.decodeApngImage(),this._apng}decodeChunk(t,e){const n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case QZ:rX(this._png.text,this,t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-n!==t)throw new Error("Length mismatch while decoding chunk ".concat(e));this._checkCrc?NZ(this,t+4,e):this.skip(4)}decodeApngChunk(t,e){const n=this.offset;switch("fdAT"!==e&&"IDAT"!==e&&this._writingDataChunks&&this.pushDataToFrame(),e){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(t);break;default:this.decodeChunk(t,e),this.offset=n+t}if(this.offset-n!==t)throw new Error("Length mismatch while decoding chunk ".concat(e));this._checkCrc?NZ(this,t+4,e):this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=function(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error("invalid bit depth: ".concat(t));return t}(this.readUint8());const e=this.readUint8();let n;switch(this._colorType=e,e){case sX:n=1;break;case lX:n=3;break;case cX:n=1;break;case uX:n=2;break;case hX:n=4;break;default:throw new Error("Unknown color type: ".concat(e))}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==pX)throw new Error("Unsupported compression method: ".concat(this._compressionMethod));this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const t={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(t)}decodePLTE(t){if(t%3!==0)throw new RangeError("PLTE field length must be a multiple of 3. Got ".concat(t));const e=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let i=0;i<e;i++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._writingDataChunks=!0;const e=t,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(t)}decodeFDAT(t){this._writingDataChunks=!0;let e=t,n=this.offset+this.byteOffset;if(n+=4,e-=4,this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(t)}decodetRNS(t){switch(this._colorType){case sX:case lX:if(t%2!==0)throw new RangeError("tRNS chunk length must be a multiple of 2. Got ".concat(t));if(t/2>this._png.width*this._png.height)throw new Error("tRNS chunk contains more alpha values than there are pixels (".concat(t/2," vs ").concat(this._png.width*this._png.height,")"));this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break;case cX:{if(t>this._palette.length)throw new Error("tRNS chunk contains more alpha values than there are palette colors (".concat(t," vs ").concat(this._palette.length,")"));let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}default:throw new Error("tRNS chunk is not supported for color type ".concat(this._colorType))}}decodeiCCP(t){const e=aX(this),n=this.readUint8();if(n!==pX)throw new Error("Unsupported iCCP compression method: ".concat(n));const i=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:LZ(i)}}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:e,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let t=0;t<this._numberOfFrames;t++){const e={sequenceNumber:this._frames[t].sequenceNumber,delayNumber:this._frames[t].delayNumber,delayDenominator:this._frames[t].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(t);if(n){if(n.data=YZ({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===t||0===n.xOffset&&0===n.yOffset&&n.width===this._png.width&&n.height===this._png.height)e.data=n.data;else{const i=this._apng.frames.at(t-1);this.disposeFrame(n,i,e),this.addFrameDataToCanvas(e,n)}this._apng.frames.push(e)}}return this._apng}disposeFrame(t,e,n){switch(t.disposeOp){case _X:break;case bX:for(let e=0;e<this._png.height;e++)for(let i=0;i<this._png.width;i++){const r=(e*t.width+i)*this._png.channels;for(let t=0;t<this._png.channels;t++)n.data[r+t]=0}break;case xX:n.data.set(e.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(t,e){const n=1<<this._png.depth,i=(t,n)=>({index:((t+e.yOffset)*this._png.width+e.xOffset+n)*this._png.channels,frameIndex:(t*e.width+n)*this._png.channels});switch(e.blendOp){case wX:for(let n=0;n<e.height;n++)for(let r=0;r<e.width;r++){const{index:a,frameIndex:o}=i(n,r);for(let n=0;n<this._png.channels;n++)t.data[a+n]=e.data[o+n]}break;case SX:for(let r=0;r<e.height;r++)for(let a=0;a<e.width;a++){const{index:o,frameIndex:s}=i(r,a);for(let i=0;i<this._png.channels;i++){const r=e.data[s+this._png.channels-1]/n,a=i%(this._png.channels-1)===0?1:e.data[s+i],l=Math.floor(r*a+(1-r)*t.data[o+i]);t.data[o+i]+=l}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var t;if(this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));const e=this._isAnimated?(null===(t=this._frames)||void 0===t?void 0:t.at(0)).data:this._inflator.result;if(this._filterMethod!==mX)throw new Error("Filter method ".concat(this._filterMethod," not supported"));if(this._interlaceMethod===yX)this._png.data=YZ({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(this._interlaceMethod!==vX)throw new Error("Interlace method ".concat(this._interlaceMethod," not supported"));this._png.data=function(t){const{data:e,width:n,height:i,channels:r,depth:a}=t,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],s=Math.ceil(a/8)*r,l=new Uint8Array(i*n*s);let c=0;for(let u=0;u<7;u++){const t=o[u],r=Math.ceil((n-t.x)/t.xStep),a=Math.ceil((i-t.y)/t.yStep);if(r<=0||a<=0)continue;const h=r*s,d=new Uint8Array(h);for(let o=0;o<a;o++){const a=e[c++],u=e.subarray(c,c+h);c+=h;const p=new Uint8Array(h);VZ(a,u,p,d,h,s),d.set(p);for(let e=0;e<r;e++){const r=t.x+e*t.xStep,a=t.y+o*t.yStep;if(!(r>=n||a>=i))for(let t=0;t<s;t++)l[(a*n+r)*s+t]=p[e*s+t]}}}if(16===a){const t=new Uint16Array(l.buffer);if(GZ)for(let e=0;e<t.length;e++)t[e]=WZ(t[e]);return t}return l}({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const t=this._inflator.result,e=this._frames.at(-1);e?e.data=t:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:_X,blendOp:wX,data:t}),this._inflator=new IZ,this._writingDataChunks=!1}}var TX;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(TX||(TX={}));var AX=function(){return"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:this}();function EX(){AX.console&&"function"==typeof AX.console.log&&AX.console.log.apply(AX.console,arguments)}var CX={log:EX,warn:function(t){AX.console&&("function"==typeof AX.console.warn?AX.console.warn.apply(AX.console,arguments):EX.call(null,arguments))},error:function(t){AX.console&&("function"==typeof AX.console.error?AX.console.error.apply(AX.console,arguments):EX(t))}};function PX(t,e,n){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){kX(i.response,e,n)},i.onerror=function(){CX.error("could not download file")},i.send()}function IX(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(n){}return e.status>=200&&e.status<=299}function LX(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var kX=AX.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,SD.A)(window))||window!==AX?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(t,e,n){var i=AX.URL||AX.webkitURL,r=document.createElement("a");e=e||t.name||"download",r.download=e,r.rel="noopener","string"==typeof t?(r.href=t,r.origin!==location.origin?IX(r.href)?PX(t,e,n):LX(r,r.target="_blank"):LX(r)):(r.href=i.createObjectURL(t),setTimeout(function(){i.revokeObjectURL(r.href)},4e4),setTimeout(function(){LX(r)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){if(e=e||t.name||"download","string"==typeof t)if(IX(t))PX(t,e,n);else{var i=document.createElement("a");i.href=t,i.target="_blank",setTimeout(function(){LX(i)})}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!==(0,SD.A)(e)&&(CX.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,n),e)}:function(t,e,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return PX(t,e,n);var r="application/octet-stream"===t.type,a=/constructor/i.test(AX.HTMLElement)||AX.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||r&&a)&&"object"===("undefined"==typeof FileReader?"undefined":(0,SD.A)(FileReader))){var s=new FileReader;s.onloadend=function(){var t=s.result;t=o?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},s.readAsDataURL(t)}else{var l=AX.URL||AX.webkitURL,c=l.createObjectURL(t);i?i.location=c:location.href=c,i=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function RX(t){var e;t=t||"",this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],i=0;i<n.length;i++){var r=n[i].re,a=n[i].process,o=r.exec(t);o&&(e=a(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==n.length&&(n="0"+n),"#"+t+e+n}}var DX=AX.atob.bind(AX),NX=AX.btoa.bind(AX);function zX(t,e){var n=t[0],i=t[1],r=t[2],a=t[3];n=OX(n,i,r,a,e[0],7,-680876936),a=OX(a,n,i,r,e[1],12,-389564586),r=OX(r,a,n,i,e[2],17,606105819),i=OX(i,r,a,n,e[3],22,-1044525330),n=OX(n,i,r,a,e[4],7,-176418897),a=OX(a,n,i,r,e[5],12,1200080426),r=OX(r,a,n,i,e[6],17,-1473231341),i=OX(i,r,a,n,e[7],22,-45705983),n=OX(n,i,r,a,e[8],7,1770035416),a=OX(a,n,i,r,e[9],12,-1958414417),r=OX(r,a,n,i,e[10],17,-42063),i=OX(i,r,a,n,e[11],22,-1990404162),n=OX(n,i,r,a,e[12],7,1804603682),a=OX(a,n,i,r,e[13],12,-40341101),r=OX(r,a,n,i,e[14],17,-1502002290),n=BX(n,i=OX(i,r,a,n,e[15],22,1236535329),r,a,e[1],5,-165796510),a=BX(a,n,i,r,e[6],9,-1069501632),r=BX(r,a,n,i,e[11],14,643717713),i=BX(i,r,a,n,e[0],20,-373897302),n=BX(n,i,r,a,e[5],5,-701558691),a=BX(a,n,i,r,e[10],9,38016083),r=BX(r,a,n,i,e[15],14,-660478335),i=BX(i,r,a,n,e[4],20,-405537848),n=BX(n,i,r,a,e[9],5,568446438),a=BX(a,n,i,r,e[14],9,-1019803690),r=BX(r,a,n,i,e[3],14,-187363961),i=BX(i,r,a,n,e[8],20,1163531501),n=BX(n,i,r,a,e[13],5,-1444681467),a=BX(a,n,i,r,e[2],9,-51403784),r=BX(r,a,n,i,e[7],14,1735328473),n=UX(n,i=BX(i,r,a,n,e[12],20,-1926607734),r,a,e[5],4,-378558),a=UX(a,n,i,r,e[8],11,-2022574463),r=UX(r,a,n,i,e[11],16,1839030562),i=UX(i,r,a,n,e[14],23,-35309556),n=UX(n,i,r,a,e[1],4,-1530992060),a=UX(a,n,i,r,e[4],11,1272893353),r=UX(r,a,n,i,e[7],16,-155497632),i=UX(i,r,a,n,e[10],23,-1094730640),n=UX(n,i,r,a,e[13],4,681279174),a=UX(a,n,i,r,e[0],11,-358537222),r=UX(r,a,n,i,e[3],16,-722521979),i=UX(i,r,a,n,e[6],23,76029189),n=UX(n,i,r,a,e[9],4,-640364487),a=UX(a,n,i,r,e[12],11,-421815835),r=UX(r,a,n,i,e[15],16,530742520),n=jX(n,i=UX(i,r,a,n,e[2],23,-995338651),r,a,e[0],6,-198630844),a=jX(a,n,i,r,e[7],10,1126891415),r=jX(r,a,n,i,e[14],15,-1416354905),i=jX(i,r,a,n,e[5],21,-57434055),n=jX(n,i,r,a,e[12],6,1700485571),a=jX(a,n,i,r,e[3],10,-1894986606),r=jX(r,a,n,i,e[10],15,-1051523),i=jX(i,r,a,n,e[1],21,-2054922799),n=jX(n,i,r,a,e[8],6,1873313359),a=jX(a,n,i,r,e[15],10,-30611744),r=jX(r,a,n,i,e[6],15,-1560198380),i=jX(i,r,a,n,e[13],21,1309151649),n=jX(n,i,r,a,e[4],6,-145523070),a=jX(a,n,i,r,e[11],10,-1120210379),r=jX(r,a,n,i,e[2],15,718787259),i=jX(i,r,a,n,e[9],21,-343485551),t[0]=YX(n,t[0]),t[1]=YX(i,t[1]),t[2]=YX(r,t[2]),t[3]=YX(a,t[3])}function FX(t,e,n,i,r,a){return e=YX(YX(e,t),YX(i,a)),YX(e<<r|e>>>32-r,n)}function OX(t,e,n,i,r,a,o){return FX(e&n|~e&i,t,e,r,a,o)}function BX(t,e,n,i,r,a,o){return FX(e&i|n&~i,t,e,r,a,o)}function UX(t,e,n,i,r,a,o){return FX(e^n^i,t,e,r,a,o)}function jX(t,e,n,i,r,a,o){return FX(n^(e|~i),t,e,r,a,o)}function VX(t){var e,n=t.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)zX(i,HX(t.substring(e-64,e)));t=t.substring(e-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)r[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(zX(i,r),e=0;e<16;e++)r[e]=0;return r[14]=8*n,zX(i,r),i}function HX(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}var GX="0123456789abcdef".split("");function WX(t){for(var e="",n=0;n<4;n++)e+=GX[t>>8*n+4&15]+GX[t>>8*n&15];return e}function qX(t){return String.fromCharCode(255&t,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function ZX(t){return VX(t).map(qX).join("")}var XX="5d41402abc4b2a76b9719d911017c592"!=function(t){for(var e=0;e<t.length;e++)t[e]=WX(t[e]);return t.join("")}(VX("hello"));function YX(t,e){if(XX){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}return t+e&4294967295}function KX(t,e){var n,i,r,a;if(t!==n){for(var o=(r=t,a=1+(256/t.length|0),new Array(a+1).join(r)),s=[],l=0;l<256;l++)s[l]=l;var c=0;for(l=0;l<256;l++){var u=s[l];c=(c+u+o.charCodeAt(l))%256,s[l]=s[c],s[c]=u}n=t,i=s}else s=i;var h=e.length,d=0,p=0,f="";for(l=0;l<h;l++)p=(p+(u=s[d=(d+1)%256]))%256,s[d]=s[p],s[p]=u,o=s[(s[d]+s[p])%256],f+=String.fromCharCode(e.charCodeAt(l)^o);return f}var JX={print:4,modify:8,copy:16,"annot-forms":32};function $X(t,e,n,i){this.v=1,this.r=2;var r=192;t.forEach(function(t){if(void 0!==JX.perm)throw new Error("Invalid permission: "+t);r+=JX[t]}),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var a=(e+this.padding).substr(0,32),o=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,o),this.P=-(1+(255^r)),this.encryptionKey=ZX(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=KX(this.encryptionKey,this.padding)}function QX(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",n=t.length,i=0;i<n;i++){var r=t.charCodeAt(i);e+=r<33||35===r||37===r||40===r||41===r||47===r||60===r||62===r||91===r||93===r||123===r||125===r||r>126?"#"+("0"+r.toString(16)).slice(-2):t[i]}return e}function tY(t){if("object"!==(0,SD.A)(t))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,i){if(i=i||!1,"string"!=typeof t||"function"!=typeof n||"boolean"!=typeof i)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var r=Math.random().toString(35);return e[t][r]=[n,!!i],r},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],0===Object.keys(e[n]).length&&delete e[n],!0;return!1},this.publish=function(n){if(e.hasOwnProperty(n)){var i=Array.prototype.slice.call(arguments,1),r=[];for(var a in e[n]){var o=e[n][a];try{o[0].apply(t,i)}catch(LX){AX.console&&CX.error("jsPDF PubSub Error",LX.message,LX)}o[1]&&r.push(a)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function eY(t){if(!(this instanceof eY))return new eY(t);var e="opacity,stroke-opacity".split(",");for(var n in t)t.hasOwnProperty(n)&&e.indexOf(n)>=0&&(this[n]=t[n]);this.id="",this.objectNumber=-1}function nY(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function iY(t,e,n,i,r){if(!(this instanceof iY))return new iY(t,e,n,i,r);this.type="axial"===t?2:3,this.coords=e,this.colors=n,nY.call(this,i,r)}function rY(t,e,n,i,r){if(!(this instanceof rY))return new rY(t,e,n,i,r);this.boundingBox=t,this.xStep=e,this.yStep=n,this.stream="",this.cloneIndex=0,nY.call(this,i,r)}function aY(t){var e,n="string"==typeof arguments[0]?arguments[0]:"p",i=arguments[1],r=arguments[2],a=arguments[3],o=[],s=1,l=16,c="S",u=null;"object"===(0,SD.A)(t=t||{})&&(n=t.orientation,i=t.unit||i,r=t.format||r,a=t.compress||t.compressPdf||a,null!==(u=t.encryption||null)&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),s="number"==typeof t.userUnit?Math.abs(t.userUnit):1,void 0!==t.precision&&(e=t.precision),void 0!==t.floatPrecision&&(l=t.floatPrecision),c=t.defaultPathOperation||"S"),o=t.filters||(!0===a?["FlateEncode"]:o),i=i||"mm",n=(""+(n||"P")).toLowerCase();var h=t.putOnlyUsedFonts||!1,d={},p={internal:{},__private__:{}};p.__private__.PubSub=tY;var f="1.3",m=p.__private__.getPdfVersion=function(){return f};p.__private__.setPdfVersion=function(t){f=t};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return g};var y=p.__private__.getPageFormat=function(t){return g[t]};r=r||"a4";var v="compat",_="advanced",b=v;function x(){this.saveGraphicsState(),J(new Lt(dt,0,0,-dt,0,pn()*dt).toString()+" cm"),this.setFontSize(this.getFontSize()/dt),c="n",b=_}function w(){this.restoreGraphicsState(),c="S",b=v}var S=p.__private__.combineFontStyleAndFontWeight=function(t,e){if("bold"==t&&"normal"==e||"bold"==t&&400==e||"normal"==t&&"italic"==e||"bold"==t&&"italic"==e)throw new Error("Invalid Combination of fontweight and fontstyle");return e&&(t=400==e||"normal"===e?"italic"===t?"italic":"normal":700!=e&&"bold"!==e||"normal"!==t?(700==e?"bold":e)+""+t:"bold"),t};p.advancedAPI=function(t){var e=b===v;return e&&x.call(this),"function"!=typeof t||(t(this),e&&w.call(this)),this},p.compatAPI=function(t){var e=b===_;return e&&w.call(this),"function"!=typeof t||(t(this),e&&x.call(this)),this},p.isAdvancedAPI=function(){return b===_};var M,T=function(t){if(b!==_)throw new Error(t+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},A=p.roundToPrecision=p.__private__.roundToPrecision=function(t,n){var i=e||n;if(isNaN(t)||isNaN(i))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return t.toFixed(i).replace(/0+$/,"")};M=p.hpf=p.__private__.hpf="number"==typeof l?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return A(t,l)}:"smart"===l?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return A(t,t>-1&&t<1?16:5)}:function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return A(t,16)};var E=p.f2=p.__private__.f2=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f2");return A(t,2)},C=p.__private__.f3=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f3");return A(t,3)},P=p.scale=p.__private__.scale=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.scale");return b===v?t*dt:b===_?t:void 0},I=function(t){return P(function(t){return b===v?pn()-t:b===_?t:void 0}(t))};p.__private__.setPrecision=p.setPrecision=function(t){"number"==typeof parseInt(t,10)&&(e=parseInt(t,10))};var L,k="00000000000000000000000000000000",R=p.__private__.getFileId=function(){return k},D=p.__private__.setFileId=function(t){return k=void 0!==t&&/^[a-fA-F0-9]{32}$/.test(t)?t.toUpperCase():k.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==u&&(ve=new $X(u.userPermissions,u.userPassword,u.ownerPassword,k)),k};p.setFileId=function(t){return D(t),this},p.getFileId=function(){return R()};var N=p.__private__.convertDateToPDFDate=function(t){var e=t.getTimezoneOffset(),n=e<0?"+":"-",i=Math.floor(Math.abs(e/60)),r=Math.abs(e%60),a=[n,U(i),"'",U(r),"'"].join("");return["D:",t.getFullYear(),U(t.getMonth()+1),U(t.getDate()),U(t.getHours()),U(t.getMinutes()),U(t.getSeconds()),a].join("")},z=p.__private__.convertPDFDateToDate=function(t){var e=parseInt(t.substr(2,4),10),n=parseInt(t.substr(6,2),10)-1,i=parseInt(t.substr(8,2),10),r=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),o=parseInt(t.substr(14,2),10);return new Date(e,n,i,r,a,o,0)},F=p.__private__.setCreationDate=function(t){var e;if(void 0===t&&(t=new Date),t instanceof Date)e=N(t);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(t))throw new Error("Invalid argument passed to jsPDF.setCreationDate");e=t}return L=e},O=p.__private__.getCreationDate=function(t){var e=L;return"jsDate"===t&&(e=z(L)),e};p.setCreationDate=function(t){return F(t),this},p.getCreationDate=function(t){return O(t)};var B,U=p.__private__.padd2=function(t){return("0"+parseInt(t)).slice(-2)},j=p.__private__.padd2Hex=function(t){return("00"+(t=t.toString())).substr(t.length)},V=0,H=[],G=[],W=0,q=[],Z=[],X=!1,Y=G;p.__private__.setCustomOutputDestination=function(t){X=!0,Y=t};var K=function(t){X||(Y=t)};p.__private__.resetCustomOutputDestination=function(){X=!1,Y=G};var J=p.__private__.out=function(t){return t=t.toString(),W+=t.length+1,Y.push(t),Y},$=p.__private__.write=function(t){return J(1===arguments.length?t.toString():Array.prototype.join.call(arguments," "))},Q=p.__private__.getArrayBuffer=function(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n);e--;)i[e]=t.charCodeAt(e);return n},tt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return tt};var et=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(t){return et=b===_?t/dt:t,this};var nt,it=p.__private__.getFontSize=p.getFontSize=function(){return b===v?et:et*dt},rt=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(t){return rt=t,this},p.__private__.getR2L=p.getR2L=function(){return rt};var at,ot=p.__private__.setZoomMode=function(t){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(t))nt=t;else if(isNaN(t)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(t))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+t+'" is not recognized.');nt=t}else nt=parseInt(t,10)};p.__private__.getZoomMode=function(){return nt};var st,lt=p.__private__.setPageMode=function(t){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(t))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+t+'" is not recognized.');at=t};p.__private__.getPageMode=function(){return at};var ct=p.__private__.setLayoutMode=function(t){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(t))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+t+'" is not recognized.');st=t};p.__private__.getLayoutMode=function(){return st},p.__private__.setDisplayMode=p.setDisplayMode=function(t,e,n){return ot(t),ct(e),lt(n),this};var ut={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(t){if(-1===Object.keys(ut).indexOf(t))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ut[t]},p.__private__.getDocumentProperties=function(){return ut},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(t){for(var e in ut)ut.hasOwnProperty(e)&&t[e]&&(ut[e]=t[e]);return this},p.__private__.setDocumentProperty=function(t,e){if(-1===Object.keys(ut).indexOf(t))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ut[t]=e};var ht,dt,pt,ft,mt,gt={},yt={},vt=[],_t={},bt={},xt={},wt={},St=null,Mt=0,Tt=[],At=new tY(p),Et=t.hotfixes||[],Ct={},Pt={},It=[],Lt=function t(e,n,i,r,a,o){if(!(this instanceof t))return new t(e,n,i,r,a,o);isNaN(e)&&(e=1),isNaN(n)&&(n=0),isNaN(i)&&(i=0),isNaN(r)&&(r=1),isNaN(a)&&(a=0),isNaN(o)&&(o=0),this._matrix=[e,n,i,r,a,o]};Object.defineProperty(Lt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Lt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Lt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Lt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Lt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Lt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Lt.prototype,"a",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Lt.prototype,"b",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Lt.prototype,"c",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Lt.prototype,"d",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Lt.prototype,"e",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Lt.prototype,"f",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Lt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Lt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Lt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Lt.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Lt.prototype.join=function(t){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(M).join(t)},Lt.prototype.multiply=function(t){var e=t.sx*this.sx+t.shy*this.shx,n=t.sx*this.shy+t.shy*this.sy,i=t.shx*this.sx+t.sy*this.shx,r=t.shx*this.shy+t.sy*this.sy,a=t.tx*this.sx+t.ty*this.shx+this.tx,o=t.tx*this.shy+t.ty*this.sy+this.ty;return new Lt(e,n,i,r,a,o)},Lt.prototype.decompose=function(){var t=this.sx,e=this.shy,n=this.shx,i=this.sy,r=this.tx,a=this.ty,o=Math.sqrt(t*t+e*e),s=(t/=o)*n+(e/=o)*i;n-=t*s,i-=e*s;var l=Math.sqrt(n*n+i*i);return s/=l,t*(i/=l)<e*(n/=l)&&(t=-t,e=-e,s=-s,o=-o),{scale:new Lt(o,0,0,l,0,0),translate:new Lt(1,0,0,1,r,a),rotate:new Lt(t,e,-e,t,0,0),skew:new Lt(1,0,s,1,0,0)}},Lt.prototype.toString=function(t){return this.join(" ")},Lt.prototype.inversed=function(){var t=this.sx,e=this.shy,n=this.shx,i=this.sy,r=this.tx,a=this.ty,o=1/(t*i-e*n),s=i*o,l=-e*o,c=-n*o,u=t*o;return new Lt(s,l,c,u,-s*r-c*a,-l*r-u*a)},Lt.prototype.applyToPoint=function(t){var e=t.x*this.sx+t.y*this.shx+this.tx,n=t.x*this.shy+t.y*this.sy+this.ty;return new en(e,n)},Lt.prototype.applyToRectangle=function(t){var e=this.applyToPoint(t),n=this.applyToPoint(new en(t.x+t.w,t.y+t.h));return new nn(e.x,e.y,n.x-e.x,n.y-e.y)},Lt.prototype.clone=function(){var t=this.sx,e=this.shy,n=this.shx,i=this.sy,r=this.tx,a=this.ty;return new Lt(t,e,n,i,r,a)},p.Matrix=Lt;var kt=p.matrixMult=function(t,e){return e.multiply(t)},Rt=new Lt(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Rt;var Dt=function(t,e){if(!bt[t]){var n=(e instanceof iY?"Sh":"P")+(Object.keys(_t).length+1).toString(10);e.id=n,bt[t]=n,_t[n]=e,At.publish("addPattern",e)}};p.ShadingPattern=iY,p.TilingPattern=rY,p.addShadingPattern=function(t,e){return T("addShadingPattern()"),Dt(t,e),this},p.beginTilingPattern=function(t){T("beginTilingPattern()"),an(t.boundingBox[0],t.boundingBox[1],t.boundingBox[2]-t.boundingBox[0],t.boundingBox[3]-t.boundingBox[1],t.matrix)},p.endTilingPattern=function(t,e){T("endTilingPattern()"),e.stream=Z[B].join("\n"),Dt(t,e),At.publish("endTilingPattern",e),It.pop().restore()};var Nt,zt=p.__private__.newObject=function(){var t=Ft();return Ot(t,!0),t},Ft=p.__private__.newObjectDeferred=function(){return V++,H[V]=function(){return W},V},Ot=function(t,e){return e="boolean"==typeof e&&e,H[t]=W,e&&J(t+" 0 obj"),t},Bt=p.__private__.newAdditionalObject=function(){var t={objId:Ft(),content:""};return q.push(t),t},Ut=Ft(),jt=Ft(),Vt=p.__private__.decodeColorString=function(t){var e=t.split(" ");if(2!==e.length||"g"!==e[1]&&"G"!==e[1])5!==e.length||"k"!==e[4]&&"K"!==e[4]||(e=[(1-e[0])*(1-e[3]),(1-e[1])*(1-e[3]),(1-e[2])*(1-e[3]),"r"]);else{var n=parseFloat(e[0]);e=[n,n,n,"r"]}for(var i="#",r=0;r<3;r++)i+=("0"+Math.floor(255*parseFloat(e[r])).toString(16)).slice(-2);return i},Ht=p.__private__.encodeColorString=function(t){var e;"string"==typeof t&&(t={ch1:t});var n=t.ch1,i=t.ch2,r=t.ch3,a=t.ch4,o="draw"===t.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var s=new RX(n);if(s.ok)n=s.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var l=parseInt(n.substr(1),16);n=l>>16&255,i=l>>8&255,r=255&l}if(void 0===i||void 0===a&&n===i&&i===r)e="string"==typeof n?n+" "+o[0]:2===t.precision?E(n/255)+" "+o[0]:C(n/255)+" "+o[0];else if(void 0===a||"object"===(0,SD.A)(a)){if(a&&!isNaN(a.a)&&0===a.a)return["1.","1.","1.",o[1]].join(" ");e="string"==typeof n?[n,i,r,o[1]].join(" "):2===t.precision?[E(n/255),E(i/255),E(r/255),o[1]].join(" "):[C(n/255),C(i/255),C(r/255),o[1]].join(" ")}else e="string"==typeof n?[n,i,r,a,o[2]].join(" "):2===t.precision?[E(n),E(i),E(r),E(a),o[2]].join(" "):[C(n),C(i),C(r),C(a),o[2]].join(" ");return e},Gt=p.__private__.getFilters=function(){return o},Wt=p.__private__.putStream=function(t){var e=(t=t||{}).data||"",n=t.filters||Gt(),i=t.alreadyAppliedFilters||[],r=t.addLength1||!1,a=e.length,o=t.objectId,s=function(t){return t};if(null!==u&&void 0===o)throw new Error("ObjectId must be passed to putStream for file encryption");null!==u&&(s=ve.encryptor(o,0));var l={};!0===n&&(n=["FlateEncode"]);var c=t.additionalKeyValues||[],h=(l=void 0!==aY.API.processDataByFilters?aY.API.processDataByFilters(e,n):{data:e,reverseChain:[]}).reverseChain+(Array.isArray(i)?i.join(" "):i.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===r&&c.push({key:"Length1",value:a})),0!=h.length)if(h.split("/").length-1==1)c.push({key:"Filter",value:h});else{c.push({key:"Filter",value:"["+h+"]"});for(var d=0;d<c.length;d+=1)if("DecodeParms"===c[d].key){for(var p=[],f=0;f<l.reverseChain.split("/").length-1;f+=1)p.push("null");p.push(c[d].value),c[d].value="["+p.join(" ")+"]"}}J("<<");for(var m=0;m<c.length;m++)J("/"+c[m].key+" "+c[m].value);J(">>"),0!==l.data.length&&(J("stream"),J(s(l.data)),J("endstream"))},qt=p.__private__.putPage=function(t){var e=t.number,n=t.data,i=t.objId,r=t.contentsObjId;Ot(i,!0),J("<</Type /Page"),J("/Parent "+t.rootDictionaryObjId+" 0 R"),J("/Resources "+t.resourceDictionaryObjId+" 0 R"),J("/MediaBox ["+parseFloat(M(t.mediaBox.bottomLeftX))+" "+parseFloat(M(t.mediaBox.bottomLeftY))+" "+M(t.mediaBox.topRightX)+" "+M(t.mediaBox.topRightY)+"]"),null!==t.cropBox&&J("/CropBox ["+M(t.cropBox.bottomLeftX)+" "+M(t.cropBox.bottomLeftY)+" "+M(t.cropBox.topRightX)+" "+M(t.cropBox.topRightY)+"]"),null!==t.bleedBox&&J("/BleedBox ["+M(t.bleedBox.bottomLeftX)+" "+M(t.bleedBox.bottomLeftY)+" "+M(t.bleedBox.topRightX)+" "+M(t.bleedBox.topRightY)+"]"),null!==t.trimBox&&J("/TrimBox ["+M(t.trimBox.bottomLeftX)+" "+M(t.trimBox.bottomLeftY)+" "+M(t.trimBox.topRightX)+" "+M(t.trimBox.topRightY)+"]"),null!==t.artBox&&J("/ArtBox ["+M(t.artBox.bottomLeftX)+" "+M(t.artBox.bottomLeftY)+" "+M(t.artBox.topRightX)+" "+M(t.artBox.topRightY)+"]"),"number"==typeof t.userUnit&&1!==t.userUnit&&J("/UserUnit "+t.userUnit),At.publish("putPage",{objId:i,pageContext:Tt[e],pageNumber:e,page:n}),J("/Contents "+r+" 0 R"),J(">>"),J("endobj");var a=n.join("\n");return b===_&&(a+="\nQ"),Ot(r,!0),Wt({data:a,filters:Gt(),objectId:r}),J("endobj"),i},Zt=p.__private__.putPages=function(){var t,e,n=[];for(t=1;t<=Mt;t++)Tt[t].objId=Ft(),Tt[t].contentsObjId=Ft();for(t=1;t<=Mt;t++)n.push(qt({number:t,data:Z[t],objId:Tt[t].objId,contentsObjId:Tt[t].contentsObjId,mediaBox:Tt[t].mediaBox,cropBox:Tt[t].cropBox,bleedBox:Tt[t].bleedBox,trimBox:Tt[t].trimBox,artBox:Tt[t].artBox,userUnit:Tt[t].userUnit,rootDictionaryObjId:Ut,resourceDictionaryObjId:jt}));Ot(Ut,!0),J("<</Type /Pages");var i="/Kids [";for(e=0;e<Mt;e++)i+=n[e]+" 0 R ";J(i+"]"),J("/Count "+Mt),J(">>"),J("endobj"),At.publish("postPutPages")},Xt=function(t){At.publish("putFont",{font:t,out:J,newObject:zt,putStream:Wt}),!0!==t.isAlreadyPutted&&(t.objectNumber=zt(),J("<<"),J("/Type /Font"),J("/BaseFont /"+QX(t.postScriptName)),J("/Subtype /Type1"),"string"==typeof t.encoding&&J("/Encoding /"+t.encoding),J("/FirstChar 32"),J("/LastChar 255"),J(">>"),J("endobj"))},Yt=function(t){t.objectNumber=zt();var e=[];e.push({key:"Type",value:"/XObject"}),e.push({key:"Subtype",value:"/Form"}),e.push({key:"BBox",value:"["+[M(t.x),M(t.y),M(t.x+t.width),M(t.y+t.height)].join(" ")+"]"}),e.push({key:"Matrix",value:"["+t.matrix.toString()+"]"});var n=t.pages[1].join("\n");Wt({data:n,additionalKeyValues:e,objectId:t.objectNumber}),J("endobj")},Kt=function(t,e){e||(e=21);var n=zt(),i=function(t,e){var n,i=[],r=1/(e-1);for(n=0;n<1;n+=r)i.push(n);if(i.push(1),0!=t[0].offset){var a={offset:0,color:t[0].color};t.unshift(a)}if(1!=t[t.length-1].offset){var o={offset:1,color:t[t.length-1].color};t.push(o)}for(var s="",l=0,c=0;c<i.length;c++){for(n=i[c];n>t[l+1].offset;)l++;var u=t[l].offset,h=(n-u)/(t[l+1].offset-u),d=t[l].color,p=t[l+1].color;s+=j(Math.round((1-h)*d[0]+h*p[0]).toString(16))+j(Math.round((1-h)*d[1]+h*p[1]).toString(16))+j(Math.round((1-h)*d[2]+h*p[2]).toString(16))}return s.trim()}(t.colors,e),r=[];r.push({key:"FunctionType",value:"0"}),r.push({key:"Domain",value:"[0.0 1.0]"}),r.push({key:"Size",value:"["+e+"]"}),r.push({key:"BitsPerSample",value:"8"}),r.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),r.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Wt({data:i,additionalKeyValues:r,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),J("endobj"),t.objectNumber=zt(),J("<< /ShadingType "+t.type),J("/ColorSpace /DeviceRGB");var a="/Coords ["+M(parseFloat(t.coords[0]))+" "+M(parseFloat(t.coords[1]))+" ";2===t.type?a+=M(parseFloat(t.coords[2]))+" "+M(parseFloat(t.coords[3])):a+=M(parseFloat(t.coords[2]))+" "+M(parseFloat(t.coords[3]))+" "+M(parseFloat(t.coords[4]))+" "+M(parseFloat(t.coords[5])),J(a+="]"),t.matrix&&J("/Matrix ["+t.matrix.toString()+"]"),J("/Function "+n+" 0 R"),J("/Extend [true true]"),J(">>"),J("endobj")},Jt=function(t,e){var n=Ft(),i=zt();e.push({resourcesOid:n,objectOid:i}),t.objectNumber=i;var r=[];r.push({key:"Type",value:"/Pattern"}),r.push({key:"PatternType",value:"1"}),r.push({key:"PaintType",value:"1"}),r.push({key:"TilingType",value:"1"}),r.push({key:"BBox",value:"["+t.boundingBox.map(M).join(" ")+"]"}),r.push({key:"XStep",value:M(t.xStep)}),r.push({key:"YStep",value:M(t.yStep)}),r.push({key:"Resources",value:n+" 0 R"}),t.matrix&&r.push({key:"Matrix",value:"["+t.matrix.toString()+"]"}),Wt({data:t.stream,additionalKeyValues:r,objectId:t.objectNumber}),J("endobj")},$t=function(t){for(var e in t.objectNumber=zt(),J("<<"),t)switch(e){case"opacity":J("/ca "+E(t[e]));break;case"stroke-opacity":J("/CA "+E(t[e]))}J(">>"),J("endobj")},Qt=function(t){Ot(t.resourcesOid,!0),J("<<"),J("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var t in J("/Font <<"),gt)gt.hasOwnProperty(t)&&(!1===h||!0===h&&d.hasOwnProperty(t))&&J("/"+t+" "+gt[t].objectNumber+" 0 R");J(">>")}(),function(){if(Object.keys(_t).length>0){for(var t in J("/Shading <<"),_t)_t.hasOwnProperty(t)&&_t[t]instanceof iY&&_t[t].objectNumber>=0&&J("/"+t+" "+_t[t].objectNumber+" 0 R");At.publish("putShadingPatternDict"),J(">>")}}(),function(t){if(Object.keys(_t).length>0){for(var e in J("/Pattern <<"),_t)_t.hasOwnProperty(e)&&_t[e]instanceof p.TilingPattern&&_t[e].objectNumber>=0&&_t[e].objectNumber<t&&J("/"+e+" "+_t[e].objectNumber+" 0 R");At.publish("putTilingPatternDict"),J(">>")}}(t.objectOid),function(){if(Object.keys(xt).length>0){var t;for(t in J("/ExtGState <<"),xt)xt.hasOwnProperty(t)&&xt[t].objectNumber>=0&&J("/"+t+" "+xt[t].objectNumber+" 0 R");At.publish("putGStateDict"),J(">>")}}(),function(){for(var t in J("/XObject <<"),Ct)Ct.hasOwnProperty(t)&&Ct[t].objectNumber>=0&&J("/"+t+" "+Ct[t].objectNumber+" 0 R");At.publish("putXobjectDict"),J(">>")}(),J(">>"),J("endobj")},te=function(t){yt[t.fontName]=yt[t.fontName]||{},yt[t.fontName][t.fontStyle]=t.id},ee=function(t,e,n,i,r){var a={id:"F"+(Object.keys(gt).length+1).toString(10),postScriptName:t,fontName:e,fontStyle:n,encoding:i,isStandardFont:r||!1,metadata:{}};return At.publish("addFont",{font:a,instance:this}),gt[a.id]=a,te(a),a.id},ne=p.__private__.pdfEscape=p.pdfEscape=function(t,e){return function(t,e){var n,i,r,a,o,s,l,c,u;if(r=(e=e||{}).sourceEncoding||"Unicode",o=e.outputEncoding,(e.autoencode||o)&&gt[ht].metadata&&gt[ht].metadata[r]&&gt[ht].metadata[r].encoding&&(a=gt[ht].metadata[r].encoding,!o&&gt[ht].encoding&&(o=gt[ht].encoding),!o&&a.codePages&&(o=a.codePages[0]),"string"==typeof o&&(o=a[o]),o)){for(l=!1,s=[],n=0,i=t.length;n<i;n++)(c=o[t.charCodeAt(n)])?s.push(String.fromCharCode(c)):s.push(t[n]),s[n].charCodeAt(0)>>8&&(l=!0);t=s.join("")}for(n=t.length;void 0===l&&0!==n;)t.charCodeAt(n-1)>>8&&(l=!0),n--;if(!l)return t;for(s=e.noBOM?[]:[254,255],n=0,i=t.length;n<i;n++){if((u=(c=t.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+t+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");s.push(u),s.push(c-(u<<8))}return String.fromCharCode.apply(void 0,s)}(t,e).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ie=p.__private__.beginPage=function(t){Z[++Mt]=[],Tt[Mt]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(t[0]),topRightY:Number(t[1])}},oe(Mt),K(Z[B])},re=function(t,e){var i,a,o;switch(n=e||n,"string"==typeof t&&(i=y(t.toLowerCase()),Array.isArray(i)&&(a=i[0],o=i[1])),Array.isArray(t)&&(a=t[0]*dt,o=t[1]*dt),isNaN(a)&&(a=r[0],o=r[1]),(a>14400||o>14400)&&(CX.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),a=Math.min(14400,a),o=Math.min(14400,o)),r=[a,o],n.substr(0,1)){case"l":o>a&&(r=[o,a]);break;case"p":a>o&&(r=[o,a])}ie(r),Oe(ze),J(qe),0!==$e&&J($e+" J"),0!==Qe&&J(Qe+" j"),At.publish("addPage",{pageNumber:Mt})},ae=function(t){t>0&&t<=Mt&&(Z.splice(t,1),Tt.splice(t,1),Mt--,B>Mt&&(B=Mt),this.setPage(B))},oe=function(t){t>0&&t<=Mt&&(B=t)},se=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return Z.length-1},le=function(t,e,n){var i,r=void 0;return n=n||{},t=void 0!==t?t:gt[ht].fontName,e=void 0!==e?e:gt[ht].fontStyle,i=t.toLowerCase(),void 0!==yt[i]&&void 0!==yt[i][e]?r=yt[i][e]:void 0!==yt[t]&&void 0!==yt[t][e]?r=yt[t][e]:!1===n.disableWarning&&CX.warn("Unable to look up font label for font '"+t+"', '"+e+"'. Refer to getFontList() for available fonts."),r||n.noFallback||null==(r=yt.times[e])&&(r=yt.times.normal),r},ce=p.__private__.putInfo=function(){var t=zt(),e=function(t){return t};for(var n in null!==u&&(e=ve.encryptor(t,0)),J("<<"),J("/Producer ("+ne(e("jsPDF "+aY.version))+")"),ut)ut.hasOwnProperty(n)&&ut[n]&&J("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+ne(e(ut[n]))+")");J("/CreationDate ("+ne(e(L))+")"),J(">>"),J("endobj")},ue=p.__private__.putCatalog=function(t){var e=(t=t||{}).rootDictionaryObjId||Ut;switch(zt(),J("<<"),J("/Type /Catalog"),J("/Pages "+e+" 0 R"),nt||(nt="fullwidth"),nt){case"fullwidth":J("/OpenAction [3 0 R /FitH null]");break;case"fullheight":J("/OpenAction [3 0 R /FitV null]");break;case"fullpage":J("/OpenAction [3 0 R /Fit]");break;case"original":J("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+nt;"%"===n.substr(n.length-1)&&(nt=parseInt(nt)/100),"number"==typeof nt&&J("/OpenAction [3 0 R /XYZ null null "+E(nt)+"]")}switch(st||(st="continuous"),st){case"continuous":J("/PageLayout /OneColumn");break;case"single":J("/PageLayout /SinglePage");break;case"two":case"twoleft":J("/PageLayout /TwoColumnLeft");break;case"tworight":J("/PageLayout /TwoColumnRight")}at&&J("/PageMode /"+at),At.publish("putCatalog"),J(">>"),J("endobj")},he=p.__private__.putTrailer=function(){J("trailer"),J("<<"),J("/Size "+(V+1)),J("/Root "+V+" 0 R"),J("/Info "+(V-1)+" 0 R"),null!==u&&J("/Encrypt "+ve.oid+" 0 R"),J("/ID [ <"+k+"> <"+k+"> ]"),J(">>")},de=p.__private__.putHeader=function(){J("%PDF-"+f),J("%\xba\xdf\xac\xe0")},pe=p.__private__.putXRef=function(){var t="0000000000";J("xref"),J("0 "+(V+1)),J("0000000000 65535 f ");for(var e=1;e<=V;e++)"function"==typeof H[e]?J((t+H[e]()).slice(-10)+" 00000 n "):void 0!==H[e]?J((t+H[e]).slice(-10)+" 00000 n "):J("0000000000 00000 n ")},fe=p.__private__.buildDocument=function(){var t;V=0,W=0,G=[],H=[],q=[],Ut=Ft(),jt=Ft(),K(G),At.publish("buildDocument"),de(),Zt(),function(){At.publish("putAdditionalObjects");for(var t=0;t<q.length;t++){var e=q[t];Ot(e.objId,!0),J(e.content),J("endobj")}At.publish("postPutAdditionalObjects")}(),t=[],function(){for(var t in gt)gt.hasOwnProperty(t)&&(!1===h||!0===h&&d.hasOwnProperty(t))&&Xt(gt[t])}(),function(){var t;for(t in xt)xt.hasOwnProperty(t)&&$t(xt[t])}(),function(){for(var t in Ct)Ct.hasOwnProperty(t)&&Yt(Ct[t])}(),function(t){var e;for(e in _t)_t.hasOwnProperty(e)&&(_t[e]instanceof iY?Kt(_t[e]):_t[e]instanceof rY&&Jt(_t[e],t))}(t),At.publish("putResources"),t.forEach(Qt),Qt({resourcesOid:jt,objectOid:Number.MAX_SAFE_INTEGER}),At.publish("postPutResources"),null!==u&&(ve.oid=zt(),J("<<"),J("/Filter /Standard"),J("/V "+ve.v),J("/R "+ve.r),J("/U <"+ve.toHexString(ve.U)+">"),J("/O <"+ve.toHexString(ve.O)+">"),J("/P "+ve.P),J(">>"),J("endobj")),ce(),ue();var e=W;return pe(),he(),J("startxref"),J(""+e),J("%%EOF"),K(Z[B]),G.join("\n")},me=p.__private__.getBlob=function(t){return new Blob([Q(t)],{type:"application/pdf"})},ge=p.output=p.__private__.output=(Nt=function(t,e){switch("string"==typeof(e=e||{})?e={filename:e}:e.filename=e.filename||"generated.pdf",t){case void 0:return fe();case"save":p.save(e.filename);break;case"arraybuffer":return Q(fe());case"blob":return me(fe());case"bloburi":case"bloburl":if(void 0!==AX.URL&&"function"==typeof AX.URL.createObjectURL)return AX.URL&&AX.URL.createObjectURL(me(fe()))||void 0;CX.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",i=fe();try{n=NX(i)}catch(u){n=NX(unescape(encodeURIComponent(i)))}return"data:application/pdf;filename="+e.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(AX)){var r="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",a=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';e.pdfObjectUrl&&(r=e.pdfObjectUrl,a="");var o='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+r+'"'+a+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(e)+");<\/script></body></html>",s=AX.open();return null!==s&&s.document.write(o),s}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(AX)){var l='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(e.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+e.filename+'" width="500px" height="400px" /></body></html>',c=AX.open();if(null!==c){c.document.write(l);var h=this;c.document.documentElement.querySelector("#pdfViewer").onload=function(){c.document.title=e.filename,c.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(h.output("bloburl"))}}return c}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(AX))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var d='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",e)+'"></iframe></body></html>',f=AX.open();if(null!==f&&(f.document.write(d),f.document.title=e.filename),f||"undefined"==typeof safari)return f;break;case"datauri":case"dataurl":return AX.document.location.href=this.output("datauristring",e);default:return null}},Nt.foo=function(){try{return Nt.apply(this,arguments)}catch(e){var t=e.stack||"";~t.indexOf(" at ")&&(t=t.split(" at ")[1]);var n="Error in function "+t.split("\n")[0].split("<")[0]+": "+e.message;if(!AX.console)throw new Error(n);AX.console.error(n,e),AX.alert&&alert(n)}},Nt.foo.bar=Nt,Nt.foo),ye=function(t){return!0===Array.isArray(Et)&&Et.indexOf(t)>-1};switch(i){case"pt":dt=1;break;case"mm":dt=72/25.4;break;case"cm":dt=72/2.54;break;case"in":dt=72;break;case"px":dt=1==ye("px_scaling")?.75:96/72;break;case"pc":case"em":dt=12;break;case"ex":dt=6;break;default:if("number"!=typeof i)throw new Error("Invalid unit: "+i);dt=i}var ve=null;F(),D();var _e=p.__private__.getPageInfo=p.getPageInfo=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Tt[t].objId,pageNumber:t,pageContext:Tt[t]}},be=p.__private__.getPageInfoByObjId=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var e in Tt)if(Tt[e].objId===t)break;return _e(e)},xe=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:Tt[B].objId,pageNumber:B,pageContext:Tt[B]}};p.addPage=function(){return re.apply(this,arguments),this},p.setPage=function(){return oe.apply(this,arguments),K.call(this,Z[B]),this},p.insertPage=function(t){return this.addPage(),this.movePage(B,t),this},p.movePage=function(t,e){var n,i;if(t>e){n=Z[t],i=Tt[t];for(var r=t;r>e;r--)Z[r]=Z[r-1],Tt[r]=Tt[r-1];Z[e]=n,Tt[e]=i,this.setPage(e)}else if(t<e){n=Z[t],i=Tt[t];for(var a=t;a<e;a++)Z[a]=Z[a+1],Tt[a]=Tt[a+1];Z[e]=n,Tt[e]=i,this.setPage(e)}return this},p.deletePage=function(){return ae.apply(this,arguments),this},p.__private__.text=p.text=function(t,e,n,i,r){var a,o,s,l,c,u,h,p,f,m=(i=i||{}).scope||this;if("number"==typeof t&&"number"==typeof e&&("string"==typeof n||Array.isArray(n))){var g=n;n=e,e=t,t=g}if(arguments[3]instanceof Lt==0?(s=arguments[4],l=arguments[5],"object"===(0,SD.A)(h=arguments[3])&&null!==h||("string"==typeof s&&(l=s,s=null),"string"==typeof h&&(l=h,h=null),"number"==typeof h&&(s=h,h=null),i={flags:h,angle:s,align:l})):(T("The transform parameter of text() with a Matrix value"),f=r),isNaN(e)||isNaN(n)||null==t)throw new Error("Invalid arguments passed to jsPDF.text");if(0===t.length)return m;var y,v="",x="number"==typeof i.lineHeightFactor?i.lineHeightFactor:Ne,w=m.internal.scaleFactor;function S(t){return t=t.split("\t").join(Array(i.TabLen||9).join(" ")),ne(t,h)}function A(t){for(var e,n=t.concat(),i=[],r=n.length;r--;)"string"==typeof(e=n.shift())?i.push(e):Array.isArray(t)&&(1===e.length||void 0===e[1]&&void 0===e[2])?i.push(e[0]):i.push([e[0],e[1],e[2]]);return i}function E(t,e){var n;if("string"==typeof t)n=e(t)[0];else if(Array.isArray(t)){for(var i,r,a=t.concat(),o=[],s=a.length;s--;)"string"==typeof(i=a.shift())?o.push(e(i)[0]):Array.isArray(i)&&"string"==typeof i[0]&&(r=e(i[0],i[1],i[2]),o.push([r[0],r[1],r[2]]));n=o}return n}var C=!1,I=!0;if("string"==typeof t)C=!0;else if(Array.isArray(t)){var L=t.concat();o=[];for(var k,R=L.length;R--;)("string"!=typeof(k=L.shift())||Array.isArray(k)&&"string"!=typeof k[0])&&(I=!1);C=I}if(!1===C)throw new Error('Type of text must be string or Array. "'+t+'" is not recognized.');"string"==typeof t&&(t=t.match(/[\r?\n]/)?t.split(/\r\n|\r|\n/g):[t]);var D=et/m.internal.scaleFactor,N=D*(x-1);switch(i.baseline){case"bottom":n-=N;break;case"top":n+=D-N;break;case"hanging":n+=D-2*N;break;case"middle":n+=D/2-N}if((u=i.maxWidth||0)>0&&("string"==typeof t?t=m.splitTextToSize(t,u):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce(function(t,e){return t.concat(m.splitTextToSize(e,u))},[]))),a={text:t,x:e,y:n,options:i,mutex:{pdfEscape:ne,activeFontKey:ht,fonts:gt,activeFontSize:et}},At.publish("preProcessText",a),t=a.text,s=(i=a.options).angle,f instanceof Lt==0&&s&&"number"==typeof s){s*=Math.PI/180,0===i.rotationDirection&&(s=-s),b===_&&(s=-s);var z=Math.cos(s),F=Math.sin(s);f=new Lt(z,F,-F,z,0,0)}else s&&s instanceof Lt&&(f=s);b!==_||f||(f=Rt),void 0!==(c=i.charSpace||Ke)&&(v+=M(P(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(p=i.horizontalScale)&&(v+=M(100*p)+" Tz\n"),i.lang;var O=-1,B=void 0!==i.renderingMode?i.renderingMode:i.stroke,U=m.internal.getCurrentPageInfo().pageContext;switch(B){case 0:case!1:case"fill":O=0;break;case 1:case!0:case"stroke":O=1;break;case 2:case"fillThenStroke":O=2;break;case 3:case"invisible":O=3;break;case 4:case"fillAndAddForClipping":O=4;break;case 5:case"strokeAndAddPathForClipping":O=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":O=6;break;case 7:case"addToPathForClipping":O=7}var j=void 0!==U.usedRenderingMode?U.usedRenderingMode:-1;-1!==O?v+=O+" Tr\n":-1!==j&&(v+="0 Tr\n"),-1!==O&&(U.usedRenderingMode=O),l=i.align||"left";var V,H=et*x,G=m.internal.pageSize.getWidth(),W=gt[ht];c=i.charSpace||Ke,u=i.maxWidth||0,h=Object.assign({autoencode:!0,noBOM:!0},i.flags);var q=[],Z=function(t){return m.getStringUnitWidth(t,{font:W,charSpace:c,fontSize:et,doKerning:!1})*et/w};if("[object Array]"===Object.prototype.toString.call(t)){var X;o=A(t),"left"!==l&&(V=o.map(Z));var Y,K=0;if("right"===l){e-=V[0],t=[],R=o.length;for(var $=0;$<R;$++)0===$?(Y=Ve(e),X=He(n)):(Y=P(K-V[$]),X=-H),t.push([o[$],Y,X]),K=V[$]}else if("center"===l){e-=V[0]/2,t=[],R=o.length;for(var Q=0;Q<R;Q++)0===Q?(Y=Ve(e),X=He(n)):(Y=P((K-V[Q])/2),X=-H),t.push([o[Q],Y,X]),K=V[Q]}else if("left"===l){t=[],R=o.length;for(var tt=0;tt<R;tt++)t.push(o[tt])}else if("justify"===l&&"Identity-H"===W.encoding){t=[],R=o.length,u=0!==u?u:G;for(var nt=0,it=0;it<R;it++)if(X=0===it?He(n):-H,Y=0===it?Ve(e):nt,it<R-1){var at=P((u-V[it])/(o[it].split(" ").length-1)),ot=o[it].split(" ");t.push([ot[0]+" ",Y,X]),nt=0;for(var st=1;st<ot.length;st++){var lt=(Z(ot[st-1]+" "+ot[st])-Z(ot[st]))*w+at;st==ot.length-1?t.push([ot[st],lt,0]):t.push([ot[st]+" ",lt,0]),nt-=lt}}else t.push([o[it],Y,X]);t.push(["",nt,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(t=[],R=o.length,u=0!==u?u:G,it=0;it<R;it++){X=0===it?He(n):-H,Y=0===it?Ve(e):0;var ct=o[it].split(" ").length-1,ut=ct>0?(u-V[it])/ct:0;it<R-1?q.push(M(P(ut))):q.push(0),t.push([o[it],Y,X])}}}!0===("boolean"==typeof i.R2L?i.R2L:rt)&&(t=E(t,function(t,e,n){return[t.split("").reverse().join(""),e,n]})),a={text:t,x:e,y:n,options:i,mutex:{pdfEscape:ne,activeFontKey:ht,fonts:gt,activeFontSize:et}},At.publish("postProcessText",a),t=a.text,y=a.mutex.isHex||!1;var dt=gt[ht].encoding;"WinAnsiEncoding"!==dt&&"StandardEncoding"!==dt||(t=E(t,function(t,e,n){return[S(t),e,n]})),o=A(t),t=[];for(var pt,ft,mt,yt=Array.isArray(o[0])?1:0,vt="",_t=function(t,e,n){var r="";return n instanceof Lt?(n="number"==typeof i.angle?kt(n,new Lt(1,0,0,1,t,e)):kt(new Lt(1,0,0,1,t,e),n),b===_&&(n=kt(new Lt(1,0,0,-1,0,0),n)),r=n.join(" ")+" Tm\n"):r=M(t)+" "+M(e)+" Td\n",r},bt=0;bt<o.length;bt++){switch(vt="",yt){case 1:mt=(y?"<":"(")+o[bt][0]+(y?">":")"),pt=parseFloat(o[bt][1]),ft=parseFloat(o[bt][2]);break;case 0:mt=(y?"<":"(")+o[bt]+(y?">":")"),pt=Ve(e),ft=He(n)}void 0!==q&&void 0!==q[bt]&&(vt=q[bt]+" Tw\n"),0===bt?t.push(vt+_t(pt,ft,f)+mt):0===yt?t.push(vt+mt):1===yt&&t.push(vt+_t(pt,ft,f)+mt)}t=0===yt?t.join(" Tj\nT* "):t.join(" Tj\n"),t+=" Tj\n";var xt="BT\n/";return xt+=ht+" "+et+" Tf\n",xt+=M(et*x)+" TL\n",xt+=Xe+"\n",xt+=v,xt+=t,J(xt+="ET"),d[ht]=!0,m};var we=p.__private__.clip=p.clip=function(t){return J("evenodd"===t?"W*":"W"),this};p.clipEvenOdd=function(){return we("evenodd")},p.__private__.discardPath=p.discardPath=function(){return J("n"),this};var Se=p.__private__.isValidStyle=function(t){var e=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(t)&&(e=!0),e};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(t){return Se(t)&&(c=t),this};var Me=p.__private__.getStyle=p.getStyle=function(t){var e=c;switch(t){case"D":case"S":e="S";break;case"F":e="f";break;case"FD":case"DF":e="B";break;case"f":case"f*":case"B":case"B*":e=t}return e},Te=p.close=function(){return J("h"),this};p.stroke=function(){return J("S"),this},p.fill=function(t){return Ae("f",t),this},p.fillEvenOdd=function(t){return Ae("f*",t),this},p.fillStroke=function(t){return Ae("B",t),this},p.fillStrokeEvenOdd=function(t){return Ae("B*",t),this};var Ae=function(t,e){"object"===(0,SD.A)(e)?Pe(e,t):J(t)},Ee=function(t){null===t||b===_&&void 0===t||(t=Me(t),J(t))};function Ce(t,e,n,i,r){var a=new rY(e||this.boundingBox,n||this.xStep,i||this.yStep,this.gState,r||this.matrix);a.stream=this.stream;var o=t+"$$"+this.cloneIndex+++"$$";return Dt(o,a),a}var Pe=function(t,e){var n=bt[t.key],i=_t[n];if(i instanceof iY)J("q"),J(Ie(e)),i.gState&&p.setGState(i.gState),J(t.matrix.toString()+" cm"),J("/"+n+" sh"),J("Q");else if(i instanceof rY){var r=new Lt(1,0,0,-1,0,pn());t.matrix&&(r=r.multiply(t.matrix||Rt),n=Ce.call(i,t.key,t.boundingBox,t.xStep,t.yStep,r).id),J("q"),J("/Pattern cs"),J("/"+n+" scn"),i.gState&&p.setGState(i.gState),J(e),J("Q")}},Ie=function(t){switch(t){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Le=p.moveTo=function(t,e){return J(M(P(t))+" "+M(I(e))+" m"),this},ke=p.lineTo=function(t,e){return J(M(P(t))+" "+M(I(e))+" l"),this},Re=p.curveTo=function(t,e,n,i,r,a){return J([M(P(t)),M(I(e)),M(P(n)),M(I(i)),M(P(r)),M(I(a)),"c"].join(" ")),this};p.__private__.line=p.line=function(t,e,n,i,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||!Se(r))throw new Error("Invalid arguments passed to jsPDF.line");return b===v?this.lines([[n-t,i-e]],t,e,[1,1],r||"S"):this.lines([[n-t,i-e]],t,e,[1,1]).stroke()},p.__private__.lines=p.lines=function(t,e,n,i,r,a){var o,s,l,c,u,h,d,p,f,m,g,y;if("number"==typeof t&&(y=n,n=e,e=t,t=y),i=i||[1,1],a=a||!1,isNaN(e)||isNaN(n)||!Array.isArray(t)||!Array.isArray(i)||!Se(r)||"boolean"!=typeof a)throw new Error("Invalid arguments passed to jsPDF.lines");for(Le(e,n),o=i[0],s=i[1],c=t.length,m=e,g=n,l=0;l<c;l++)2===(u=t[l]).length?(m=u[0]*o+m,g=u[1]*s+g,ke(m,g)):(h=u[0]*o+m,d=u[1]*s+g,p=u[2]*o+m,f=u[3]*s+g,m=u[4]*o+m,g=u[5]*s+g,Re(h,d,p,f,m,g));return a&&Te(),Ee(r),this},p.path=function(t){for(var e=0;e<t.length;e++){var n=t[e],i=n.c;switch(n.op){case"m":Le(i[0],i[1]);break;case"l":ke(i[0],i[1]);break;case"c":Re.apply(this,i);break;case"h":Te()}}return this},p.__private__.rect=p.rect=function(t,e,n,i,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||!Se(r))throw new Error("Invalid arguments passed to jsPDF.rect");return b===v&&(i=-i),J([M(P(t)),M(I(e)),M(P(n)),M(P(i)),"re"].join(" ")),Ee(r),this},p.__private__.triangle=p.triangle=function(t,e,n,i,r,a,o){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||isNaN(r)||isNaN(a)||!Se(o))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-t,i-e],[r-n,a-i],[t-r,e-a]],t,e,[1,1],o,!0),this},p.__private__.roundedRect=p.roundedRect=function(t,e,n,i,r,a,o){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||isNaN(r)||isNaN(a)||!Se(o))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var s=4/3*(Math.SQRT2-1);return r=Math.min(r,.5*n),a=Math.min(a,.5*i),this.lines([[n-2*r,0],[r*s,0,r,a-a*s,r,a],[0,i-2*a],[0,a*s,-r*s,a,-r,a],[2*r-n,0],[-r*s,0,-r,-a*s,-r,-a],[0,2*a-i],[0,-a*s,r*s,-a,r,-a]],t+r,e,[1,1],o,!0),this},p.__private__.ellipse=p.ellipse=function(t,e,n,i,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||!Se(r))throw new Error("Invalid arguments passed to jsPDF.ellipse");var a=4/3*(Math.SQRT2-1)*n,o=4/3*(Math.SQRT2-1)*i;return Le(t+n,e),Re(t+n,e-o,t+a,e-i,t,e-i),Re(t-a,e-i,t-n,e-o,t-n,e),Re(t-n,e+o,t-a,e+i,t,e+i),Re(t+a,e+i,t+n,e+o,t+n,e),Ee(r),this},p.__private__.circle=p.circle=function(t,e,n,i){if(isNaN(t)||isNaN(e)||isNaN(n)||!Se(i))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(t,e,n,n,i)},p.setFont=function(t,e,n){return n&&(e=S(e,n)),ht=le(t,e,{disableWarning:!1}),this};var De=p.__private__.getFont=p.getFont=function(){return gt[le.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var t,e,n={};for(t in yt)if(yt.hasOwnProperty(t))for(e in n[t]=[],yt[t])yt[t].hasOwnProperty(e)&&n[t].push(e);return n},p.addFont=function(t,e,n,i,r){var a=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==a.indexOf(arguments[3])?r=arguments[3]:arguments[3]&&-1==a.indexOf(arguments[3])&&(n=S(n,i)),ee.call(this,t,e,n,r=r||"Identity-H")};var Ne,ze=t.lineWidth||.200025,Fe=p.__private__.getLineWidth=p.getLineWidth=function(){return ze},Oe=p.__private__.setLineWidth=p.setLineWidth=function(t){return ze=t,J(M(P(t))+" w"),this};p.__private__.setLineDash=aY.API.setLineDash=aY.API.setLineDashPattern=function(t,e){if(t=t||[],e=e||0,isNaN(e)||!Array.isArray(t))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return t=t.map(function(t){return M(P(t))}).join(" "),e=M(P(e)),J("["+t+"] "+e+" d"),this};var Be=p.__private__.getLineHeight=p.getLineHeight=function(){return et*Ne};p.__private__.getLineHeight=p.getLineHeight=function(){return et*Ne};var Ue=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(t){return"number"==typeof(t=t||1.15)&&(Ne=t),this},je=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Ne};Ue(t.lineHeight);var Ve=p.__private__.getHorizontalCoordinate=function(t){return P(t)},He=p.__private__.getVerticalCoordinate=function(t){return b===_?t:Tt[B].mediaBox.topRightY-Tt[B].mediaBox.bottomLeftY-P(t)},Ge=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(t){return M(Ve(t))},We=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(t){return M(He(t))},qe=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Vt(qe)},p.__private__.setStrokeColor=p.setDrawColor=function(t,e,n,i){return qe=Ht({ch1:t,ch2:e,ch3:n,ch4:i,pdfColorType:"draw",precision:2}),J(qe),this};var Ze=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Vt(Ze)},p.__private__.setFillColor=p.setFillColor=function(t,e,n,i){return Ze=Ht({ch1:t,ch2:e,ch3:n,ch4:i,pdfColorType:"fill",precision:2}),J(Ze),this};var Xe=t.textColor||"0 g",Ye=p.__private__.getTextColor=p.getTextColor=function(){return Vt(Xe)};p.__private__.setTextColor=p.setTextColor=function(t,e,n,i){return Xe=Ht({ch1:t,ch2:e,ch3:n,ch4:i,pdfColorType:"text",precision:3}),this};var Ke=t.charSpace,Je=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Ke||0)};p.__private__.setCharSpace=p.setCharSpace=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Ke=t,this};var $e=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(t){var e=p.CapJoinStyles[t];if(void 0===e)throw new Error("Line cap style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return $e=e,J(e+" J"),this};var Qe=0;p.__private__.setLineJoin=p.setLineJoin=function(t){var e=p.CapJoinStyles[t];if(void 0===e)throw new Error("Line join style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Qe=e,J(e+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(t){if(t=t||0,isNaN(t))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return J(M(P(t))+" M"),this},p.GState=eY,p.setGState=function(t){(t="string"==typeof t?xt[wt[t]]:tn(null,t)).equals(St)||(J("/"+t.id+" gs"),St=t)};var tn=function(t,e){if(!t||!wt[t]){var n=!1;for(var i in xt)if(xt.hasOwnProperty(i)&&xt[i].equals(e)){n=!0;break}if(n)e=xt[i];else{var r="GS"+(Object.keys(xt).length+1).toString(10);xt[r]=e,e.id=r}return t&&(wt[t]=e.id),At.publish("addGState",e),e}};p.addGState=function(t,e){return tn(t,e),this},p.saveGraphicsState=function(){return J("q"),vt.push({key:ht,size:et,color:Xe}),this},p.restoreGraphicsState=function(){J("Q");var t=vt.pop();return ht=t.key,et=t.size,Xe=t.color,St=null,this},p.setCurrentTransformationMatrix=function(t){return J(t.toString()+" cm"),this},p.comment=function(t){return J("#"+t),this};var en=function(t,e){var n=t||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(t){isNaN(t)||(n=parseFloat(t))}});var i=e||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return i},set:function(t){isNaN(t)||(i=parseFloat(t))}});var r="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return r},set:function(t){r=t.toString()}}),this},nn=function(t,e,n,i){en.call(this,t,e),this.type="rect";var r=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return r},set:function(t){isNaN(t)||(r=parseFloat(t))}});var a=i||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return a},set:function(t){isNaN(t)||(a=parseFloat(t))}}),this},rn=function(){this.page=Mt,this.currentPage=B,this.pages=Z.slice(0),this.pagesContext=Tt.slice(0),this.x=pt,this.y=ft,this.matrix=mt,this.width=sn(B),this.height=cn(B),this.outputDestination=Y,this.id="",this.objectNumber=-1};rn.prototype.restore=function(){Mt=this.page,B=this.currentPage,Tt=this.pagesContext,Z=this.pages,pt=this.x,ft=this.y,mt=this.matrix,ln(B,this.width),un(B,this.height),Y=this.outputDestination};var an=function(t,e,n,i,r){It.push(new rn),Mt=B=0,Z=[],pt=t,ft=e,mt=r,ie([n,i])};for(var on in p.beginFormObject=function(t,e,n,i,r){return an(t,e,n,i,r),this},p.endFormObject=function(t){return function(t){if(Pt[t])It.pop().restore();else{var e=new rn,n="Xo"+(Object.keys(Ct).length+1).toString(10);e.id=n,Pt[t]=n,Ct[n]=e,At.publish("addFormObject",e),It.pop().restore()}}(t),this},p.doFormObject=function(t,e){var n=Ct[Pt[t]];return J("q"),J(e.toString()+" cm"),J("/"+n.id+" Do"),J("Q"),this},p.getFormObject=function(t){var e=Ct[Pt[t]];return{x:e.x,y:e.y,width:e.width,height:e.height,matrix:e.matrix}},p.save=function(t,e){return t=t||"generated.pdf",(e=e||{}).returnPromise=e.returnPromise||!1,!1===e.returnPromise?(kX(me(fe()),t),"function"==typeof kX.unload&&AX.setTimeout&&setTimeout(kX.unload,911),this):new Promise(function(e,n){try{var r=kX(me(fe()),t);"function"==typeof kX.unload&&AX.setTimeout&&setTimeout(kX.unload,911),e(r)}catch(i){n(i.message)}})},aY.API)aY.API.hasOwnProperty(on)&&("events"===on&&aY.API.events.length?function(t,e){var n,i,r;for(r=e.length-1;-1!==r;r--)n=e[r][0],i=e[r][1],t.subscribe.apply(t,[n].concat("function"==typeof i?[i]:i))}(At,aY.API.events):p[on]=aY.API[on]);function sn(t){return Tt[t].mediaBox.topRightX-Tt[t].mediaBox.bottomLeftX}function ln(t,e){Tt[t].mediaBox.topRightX=e+Tt[t].mediaBox.bottomLeftX}function cn(t){return Tt[t].mediaBox.topRightY-Tt[t].mediaBox.bottomLeftY}function un(t,e){Tt[t].mediaBox.topRightY=e+Tt[t].mediaBox.bottomLeftY}var hn=p.getPageWidth=function(t){return sn(t=t||B)/dt},dn=p.setPageWidth=function(t,e){ln(t,e*dt)},pn=p.getPageHeight=function(t){return cn(t=t||B)/dt},fn=p.setPageHeight=function(t,e){un(t,e*dt)};return p.internal={pdfEscape:ne,getStyle:Me,getFont:De,getFontSize:it,getCharSpace:Je,getTextColor:Ye,getLineHeight:Be,getLineHeightFactor:je,getLineWidth:Fe,write:$,getHorizontalCoordinate:Ve,getVerticalCoordinate:He,getCoordinateString:Ge,getVerticalCoordinateString:We,collections:{},newObject:zt,newAdditionalObject:Bt,newObjectDeferred:Ft,newObjectDeferredBegin:Ot,getFilters:Gt,putStream:Wt,events:At,scaleFactor:dt,pageSize:{getWidth:function(){return hn(B)},setWidth:function(t){dn(B,t)},getHeight:function(){return pn(B)},setHeight:function(t){fn(B,t)}},encryptionOptions:u,encryption:ve,getEncryptor:function(t){return null!==u?ve.encryptor(t,0):function(t){return t}},output:ge,getNumberOfPages:se,pages:Z,out:J,f2:E,f3:C,getPageInfo:_e,getPageInfoByObjId:be,getCurrentPageInfo:xe,getPDFVersion:m,Point:en,Rectangle:nn,Matrix:Lt,hasHotfix:ye},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return hn(B)},set:function(t){dn(B,t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return pn(B)},set:function(t){fn(B,t)},enumerable:!0,configurable:!0}),function(t){for(var e=0,n=tt.length;e<n;e++){var i=ee.call(this,t[e][0],t[e][1],t[e][2],tt[e][3],!0);!1===h&&(d[i]=!0);var r=t[e][0].split("-");te({id:i,fontName:r[0],fontStyle:r[1]||""})}At.publish("addFonts",{fonts:gt,dictionary:yt})}.call(p,tt),ht="F1",re(r,n),At.publish("initialized"),p}$X.prototype.lsbFirstWord=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},$X.prototype.toHexString=function(t){return t.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},$X.prototype.hexToBytes=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(String.fromCharCode(parseInt(t.substr(n,2),16)));return e.join("")},$X.prototype.processOwnerPassword=function(t,e){return KX(ZX(e).substr(0,5),t)},$X.prototype.encryptor=function(t,e){var n=ZX(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(t){return KX(n,t)}},eY.prototype.equals=function(t){var e,n="id,objectNumber,equals";if(!t||(0,SD.A)(t)!==(0,SD.A)(this))return!1;var i=0;for(e in this)if(!(n.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e))return!1;if(this[e]!==t[e])return!1;i++}for(e in t)t.hasOwnProperty(e)&&n.indexOf(e)<0&&i--;return 0===i},aY.API={events:[]},aY.version="3.0.3";var oY=aY.API,sY=1,lY=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},cY=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},uY=function(t){return t.toFixed(2)},hY=function(t){return t.toFixed(5)};oY.__acroform__={};var dY=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},pY=function(t){return t*sY},fY=function(t){var e=new IY,n=GY.internal.getHeight(t)||0,i=GY.internal.getWidth(t)||0;return e.BBox=[0,0,Number(uY(i)),Number(uY(n))],e},mY=oY.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<e},gY=oY.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<e)},yY=oY.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<e?1:0},vY=oY.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return yY(t,e-1)},_Y=oY.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return mY(t,e-1)},bY=oY.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return gY(t,e-1)},xY=oY.__acroform__.calculateCoordinates=function(t,e){var n=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,r=t[0],a=t[1],o=t[2],s=t[3],l={};return l.lowerLeft_X=n(r)||0,l.lowerLeft_Y=i(a+s)||0,l.upperRight_X=n(r+o)||0,l.upperRight_Y=i(a)||0,[Number(uY(l.lowerLeft_X)),Number(uY(l.lowerLeft_Y)),Number(uY(l.upperRight_X)),Number(uY(l.upperRight_Y))]},wY=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],n=t._V||t.DV,i=SY(t,n),r=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+r+" "+uY(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var a=fY(t);return a.scope=t.scope,a.stream=e.join("\n"),a}},SY=function(t,e){var n=0===t.fontSize?t.maxFontSize:t.fontSize,i={text:"",fontSize:""},r=(e=")"==(e="("==e.substr(0,1)?e.substr(1):e).substr(e.length-1)?e.substr(0,e.length-1):e).split(" ");r=t.multiline?r.map(function(t){return t.split("\n")}):r.map(function(t){return[t]});var a=n,o=GY.internal.getHeight(t)||0;o=o<0?-o:o;var s=GY.internal.getWidth(t)||0;s=s<0?-s:s;var l=function(e,n,i){if(e+1<r.length){var a=n+" "+r[e+1][0];return MY(a,t,i).width<=s-4}return!1};a++;t:for(;a>0;){e="",a--;var c,u,h=MY("3",t,a).height,d=t.multiline?o-a:(o-h)/2,p=d+=2,f=0,m=0,g=0;if(a<=0){e="(...) Tj\n",e+="% Width of Text: "+MY(e,t,a=12).width+", FieldWidth:"+s+"\n";break}for(var y="",v=0,_=0;_<r.length;_++)if(r.hasOwnProperty(_)){var b=!1;if(1!==r[_].length&&g!==r[_].length-1){if((h+2)*(v+2)+2>o)continue t;y+=r[_][g],b=!0,m=_,_--}else{y=" "==(y+=r[_][g]+" ").substr(y.length-1)?y.substr(0,y.length-1):y;var x=parseInt(_),w=l(x,y,a),S=_>=r.length-1;if(w&&!S){y+=" ",g=0;continue}if(w||S){if(S)m=x;else if(t.multiline&&(h+2)*(v+2)+2>o)continue t}else{if(!t.multiline)continue t;if((h+2)*(v+2)+2>o)continue t;m=x}}for(var M="",T=f;T<=m;T++){var A=r[T];if(t.multiline){if(T===m){M+=A[g]+" ",g=(g+1)%A.length;continue}if(T===f){M+=A[A.length-1]+" ";continue}}M+=A[0]+" "}switch(M=" "==M.substr(M.length-1)?M.substr(0,M.length-1):M,u=MY(M,t,a).width,t.textAlign){case"right":c=s-u-2;break;case"center":c=(s-u)/2;break;default:c=2}e+=uY(c)+" "+uY(p)+" Td\n",e+="("+lY(M)+") Tj\n",e+=-uY(c)+" 0 Td\n",p=-(a+2),u=0,f=b?m:m+1,v++,y=""}break}return i.text=e,i.fontSize=a,i},MY=function(t,e,n){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),r=e.scope.getStringUnitWidth(t,{font:i,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:r}},TY={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},AY=function(t,e){var n={type:"reference",object:t};void 0===e.internal.getPageInfo(t.page).pageContext.annotations.find(function(t){return t.type===n.type&&t.object===n.object})&&e.internal.getPageInfo(t.page).pageContext.annotations.push(n)},EY=oY.__acroform__.arrayToPdfArray=function(t,e,n){var i=function(t){return t};if(Array.isArray(t)){for(var r="[",a=0;a<t.length;a++)switch(0!==a&&(r+=" "),(0,SD.A)(t[a])){case"boolean":case"number":case"object":r+=t[a].toString();break;case"string":"/"!==t[a].substr(0,1)?(void 0!==e&&n&&(i=n.internal.getEncryptor(e)),r+="("+lY(i(t[a].toString()))+")"):r+=t[a].toString()}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},CY=function(t,e,n){var i=function(t){return t};return void 0!==e&&n&&(i=n.internal.getEncryptor(e)),(t=t||"").toString(),"("+lY(i(t))+")"},PY=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};PY.prototype.toString=function(){return this.objId+" 0 R"},PY.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},PY.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(t){return"content"!=t&&"appearanceStreamContent"!=t&&"scope"!=t&&"objId"!=t&&"_"!=t.substring(0,1)});for(var n in e)if(!1===Object.getOwnPropertyDescriptor(this,e[n]).configurable){var i=e[n],r=this[i];r&&(Array.isArray(r)?t.push({key:i,value:EY(r,this.objId,this.scope)}):r instanceof PY?(r.scope=this.scope,t.push({key:i,value:r.objId+" 0 R"})):"function"!=typeof r&&t.push({key:i,value:r}))}return t};var IY=function(){PY.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){t=e.trim()},get:function(){return t||null}})};dY(IY,PY);var LY=function(){PY.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var e=function(t){return t};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+lY(e(t))+")"}},set:function(e){t=e}})};dY(LY,PY);var kY=function t(){PY.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute F supplied.');e=t}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(e,3))},set:function(t){!0===Boolean(t)?this.F=_Y(e,3):this.F=bY(e,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute Ff supplied.');n=t}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==i.length)return i},set:function(t){i=void 0!==t?t:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(t){i[0]=t}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(t){i[1]=t}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(t){i[2]=t}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(t){i[3]=t}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){switch(t){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=t;break;default:throw new Error('Invalid value "'+t+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof UY)return;a="FieldObject"+t.FieldNum++}var e=function(t){return t};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+lY(e(a))+")"},set:function(t){a=t.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(t){a=t}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(t){o=t}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){s=t}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(t){l=t}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===c?50/sY:c},set:function(t){c=t}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(t){u=t}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof UY||this instanceof VY))return CY(h,this.objId,this.scope)},set:function(t){t=t.toString(),h=t}});var d=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof FY==0?CY(d,this.objId,this.scope):d},set:function(t){t=t.toString(),d=this instanceof FY==0?"("===t.substr(0,1)?cY(t.substr(1,t.length-2)):cY(t):t}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof FY==1?cY(d.substr(1,d.length-1)):d},set:function(t){t=t.toString(),d=this instanceof FY==1?"/"+t:t}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(t){this.V=t}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof FY==0?CY(p,this.objId,this.scope):p},set:function(t){t=t.toString(),p=this instanceof FY==0?"("===t.substr(0,1)?cY(t.substr(1,t.length-2)):cY(t):t}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof FY==1?cY(p.substr(1,p.length-1)):p},set:function(t){t=t.toString(),p=this instanceof FY==1?"/"+t:t}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var f,m=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return m},set:function(t){t=Boolean(t),m=t}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(f)return f},set:function(t){f=t}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,1))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,1):this.Ff=bY(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,2))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,2):this.Ff=bY(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,3))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,3):this.Ff=bY(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(t){if(-1===[0,1,2].indexOf(t))throw new Error('Invalid value "'+t+'" for attribute Q supplied.');g=t}}),Object.defineProperty(this,"textAlign",{get:function(){var t;switch(g){case 0:default:t="left";break;case 1:t="center";break;case 2:t="right"}return t},configurable:!0,enumerable:!0,set:function(t){switch(t){case"right":case 2:g=2;break;case"center":case 1:g=1;break;default:g=0}}})};dY(kY,PY);var RY=function(){kY.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){t=e}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return EY(e,this.objId,this.scope)},set:function(t){var n,i;i=[],"string"==typeof(n=t)&&(i=function(t,e,n){n||(n=1);for(var i,r=[];i=e.exec(t);)r.push(i[n]);return r}(n,/\((.*?)\)/g)),e=i}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();-1!==e.indexOf(t)&&(e.splice(e.indexOf(t),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,18))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,18):this.Ff=bY(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,19))},set:function(t){!0===this.combo&&(!0===Boolean(t)?this.Ff=_Y(this.Ff,19):this.Ff=bY(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,20))},set:function(t){!0===Boolean(t)?(this.Ff=_Y(this.Ff,20),e.sort()):this.Ff=bY(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,22))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,22):this.Ff=bY(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,23):this.Ff=bY(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,27))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,27):this.Ff=bY(this.Ff,27)}}),this.hasAppearanceStream=!1};dY(RY,kY);var DY=function(){RY.call(this),this.fontName="helvetica",this.combo=!1};dY(DY,RY);var NY=function(){DY.call(this),this.combo=!0};dY(NY,DY);var zY=function(){NY.call(this),this.edit=!0};dY(zY,NY);var FY=function(){kY.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,15))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,15):this.Ff=bY(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,16))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,16):this.Ff=bY(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,17))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,17):this.Ff=bY(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,26):this.Ff=bY(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(e).length){var n,i=[];for(n in i.push("<<"),e)i.push("/"+n+" ("+lY(t(e[n]))+")");return i.push(">>"),i.join("\n")}},set:function(t){"object"===(0,SD.A)(t)&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){"string"==typeof t&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(e){t="/"+e}})};dY(FY,kY);var OY=function(){FY.call(this),this.pushButton=!0};dY(OY,FY);var BY=function(){FY.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=void 0!==e?e:[]}})};dY(BY,FY);var UY=function(){var t,e;kY.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(t){e=t}});var n,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};this.scope&&(t=this.scope.internal.getEncryptor(this.objId));var e,n=[];for(e in n.push("<<"),i)n.push("/"+e+" ("+lY(t(i[e]))+")");return n.push(">>"),n.join("\n")},set:function(t){"object"===(0,SD.A)(t)&&(i=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(t){"string"==typeof t&&(i.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=GY.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};dY(UY,kY),BY.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var n=this.Kids[e];n.appearanceStreamContent=t.createAppearanceStream(n.optionName),n.caption=t.getCA()}},BY.prototype.createOption=function(t){var e=new UY;return e.Parent=this,e.optionName=t,this.Kids.push(e),WY.call(this.scope,e),e};var jY=function(){FY.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=GY.CheckBox.createAppearanceStream()};dY(jY,FY);var VY=function(){kY.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,13))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,13):this.Ff=bY(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,21))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,21):this.Ff=bY(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,23):this.Ff=bY(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,24))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,24):this.Ff=bY(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,25))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,25):this.Ff=bY(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,26):this.Ff=bY(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};dY(VY,kY);var HY=function(){VY.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(vY(this.Ff,14))},set:function(t){!0===Boolean(t)?this.Ff=_Y(this.Ff,14):this.Ff=bY(this.Ff,14)}}),this.password=!0};dY(HY,VY);var GY={CheckBox:{createAppearanceStream:function(){return{N:{On:GY.CheckBox.YesNormal},D:{On:GY.CheckBox.YesPushDown,Off:GY.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=fY(t);e.scope=t.scope;var n=[],i=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),a=SY(t,t.caption);return n.push("0.749023 g"),n.push("0 0 "+uY(GY.internal.getWidth(t))+" "+uY(GY.internal.getHeight(t))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+i+" "+uY(a.fontSize)+" Tf "+r),n.push("BT"),n.push(a.text),n.push("ET"),n.push("Q"),n.push("EMC"),e.stream=n.join("\n"),e},YesNormal:function(t){var e=fY(t);e.scope=t.scope;var n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,i=t.scope.__private__.encodeColorString(t.color),r=[],a=GY.internal.getHeight(t),o=GY.internal.getWidth(t),s=SY(t,t.caption);return r.push("1 g"),r.push("0 0 "+uY(o)+" "+uY(a)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+uY(o-1)+" "+uY(a-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+n+" "+uY(s.fontSize)+" Tf "+i),r.push(s.text),r.push("ET"),r.push("Q"),e.stream=r.join("\n"),e},OffPushDown:function(t){var e=fY(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+uY(GY.internal.getWidth(t))+" "+uY(GY.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join("\n"),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:GY.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=GY.RadioButton.Circle.YesNormal,e.D[t]=GY.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=fY(t);e.scope=t.scope;var n=[],i=GY.internal.getWidth(t)<=GY.internal.getHeight(t)?GY.internal.getWidth(t)/4:GY.internal.getHeight(t)/4;i=Number((.9*i).toFixed(5));var r=GY.internal.Bezier_C,a=Number((i*r).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+hY(GY.internal.getWidth(t)/2)+" "+hY(GY.internal.getHeight(t)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join("\n"),e},YesPushDown:function(t){var e=fY(t);e.scope=t.scope;var n=[],i=GY.internal.getWidth(t)<=GY.internal.getHeight(t)?GY.internal.getWidth(t)/4:GY.internal.getHeight(t)/4;i=Number((.9*i).toFixed(5));var r=Number((2*i).toFixed(5)),a=Number((r*GY.internal.Bezier_C).toFixed(5)),o=Number((i*GY.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+hY(GY.internal.getWidth(t)/2)+" "+hY(GY.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+hY(GY.internal.getWidth(t)/2)+" "+hY(GY.internal.getHeight(t)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+o+" "+o+" "+i+" 0 "+i+" c"),n.push("-"+o+" "+i+" -"+i+" "+o+" -"+i+" 0 c"),n.push("-"+i+" -"+o+" -"+o+" -"+i+" 0 -"+i+" c"),n.push(o+" -"+i+" "+i+" -"+o+" "+i+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join("\n"),e},OffPushDown:function(t){var e=fY(t);e.scope=t.scope;var n=[],i=GY.internal.getWidth(t)<=GY.internal.getHeight(t)?GY.internal.getWidth(t)/4:GY.internal.getHeight(t)/4;i=Number((.9*i).toFixed(5));var r=Number((2*i).toFixed(5)),a=Number((r*GY.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+hY(GY.internal.getWidth(t)/2)+" "+hY(GY.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join("\n"),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:GY.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=GY.RadioButton.Cross.YesNormal,e.D[t]=GY.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=fY(t);e.scope=t.scope;var n=[],i=GY.internal.calculateCross(t);return n.push("q"),n.push("1 1 "+uY(GY.internal.getWidth(t)-2)+" "+uY(GY.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(uY(i.x1.x)+" "+uY(i.x1.y)+" m"),n.push(uY(i.x2.x)+" "+uY(i.x2.y)+" l"),n.push(uY(i.x4.x)+" "+uY(i.x4.y)+" m"),n.push(uY(i.x3.x)+" "+uY(i.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join("\n"),e},YesPushDown:function(t){var e=fY(t);e.scope=t.scope;var n=GY.internal.calculateCross(t),i=[];return i.push("0.749023 g"),i.push("0 0 "+uY(GY.internal.getWidth(t))+" "+uY(GY.internal.getHeight(t))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+uY(GY.internal.getWidth(t)-2)+" "+uY(GY.internal.getHeight(t)-2)+" re"),i.push("W"),i.push("n"),i.push(uY(n.x1.x)+" "+uY(n.x1.y)+" m"),i.push(uY(n.x2.x)+" "+uY(n.x2.y)+" l"),i.push(uY(n.x4.x)+" "+uY(n.x4.y)+" m"),i.push(uY(n.x3.x)+" "+uY(n.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join("\n"),e},OffPushDown:function(t){var e=fY(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+uY(GY.internal.getWidth(t))+" "+uY(GY.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join("\n"),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+n}};GY.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=GY.internal.getWidth(t),n=GY.internal.getHeight(t),i=Math.min(e,n);return{x1:{x:(e-i)/2,y:(n-i)/2+i},x2:{x:(e-i)/2+i,y:(n-i)/2},x3:{x:(e-i)/2,y:(n-i)/2},x4:{x:(e-i)/2+i,y:(n-i)/2+i}}}},GY.internal.getWidth=function(t){var e=0;return"object"===(0,SD.A)(t)&&(e=pY(t.Rect[2])),e},GY.internal.getHeight=function(t){var e=0;return"object"===(0,SD.A)(t)&&(e=pY(t.Rect[3])),e};var WY=oY.addField=function(t){if(function(t,e){if(e.scope=t,void 0!==t.internal&&(void 0===t.internal.acroformPlugin||!1===t.internal.acroformPlugin.isInitialized)){if(kY.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(TY)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");sY=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new LY,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){var e;(e=t).internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0}),t.internal.events.subscribe("buildDocument",function(){!function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var e=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];i.objId=void 0,i.hasAnnotation&&AY(i,t)}}(t)}),t.internal.events.subscribe("putCatalog",function(){!function(t){if(void 0===t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(t)}),t.internal.events.subscribe("postPutPages",function(e){!function(t,e){var n=!t;for(var i in t||(e.internal.newObjectDeferredBegin(e.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),e.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),t=t||e.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(t.hasOwnProperty(i)){var r=t[i],a=[],o=r.Rect;if(r.Rect&&(r.Rect=xY(r.Rect,e)),e.internal.newObjectDeferredBegin(r.objId,!0),r.DA=GY.createDefaultAppearanceStream(r),"object"===(0,SD.A)(r)&&"function"==typeof r.getKeyValueListForStream&&(a=r.getKeyValueListForStream()),r.Rect=o,r.hasAppearanceStream&&!r.appearanceStreamContent){var s=wY(r);a.push({key:"AP",value:"<</N "+s+">>"}),e.internal.acroformPlugin.xForms.push(s)}if(r.appearanceStreamContent){var l="";for(var c in r.appearanceStreamContent)if(r.appearanceStreamContent.hasOwnProperty(c)){var u=r.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var i in u)if(u.hasOwnProperty(i)){var h=u[i];"function"==typeof h&&(h=h.call(e,r)),l+="/"+i+" "+h+" ",e.internal.acroformPlugin.xForms.indexOf(h)>=0||e.internal.acroformPlugin.xForms.push(h)}}else"function"==typeof(h=u)&&(h=h.call(e,r)),l+="/"+i+" "+h,e.internal.acroformPlugin.xForms.indexOf(h)>=0||e.internal.acroformPlugin.xForms.push(h);l+=">>"}a.push({key:"AP",value:"<<\n"+l+">>"})}e.internal.putStream({additionalKeyValues:a,objectId:r.objId}),e.internal.out("endobj")}n&&function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var i=n,r=t[n];e.internal.newObjectDeferredBegin(r.objId,!0),"object"===(0,SD.A)(r)&&"function"==typeof r.putStream&&r.putStream(),delete t[i]}}(e.internal.acroformPlugin.xForms,e)}(e,t)}),t.internal.acroformPlugin.isInitialized=!0}}(this,t),!(t instanceof kY))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};oY.AcroFormChoiceField=RY,oY.AcroFormListBox=DY,oY.AcroFormComboBox=NY,oY.AcroFormEditBox=zY,oY.AcroFormButton=FY,oY.AcroFormPushButton=OY,oY.AcroFormRadioButton=BY,oY.AcroFormCheckBox=jY,oY.AcroFormTextField=VY,oY.AcroFormPasswordField=HY,oY.AcroFormAppearance=GY,oY.AcroForm={ChoiceField:RY,ListBox:DY,ComboBox:NY,EditBox:zY,Button:FY,PushButton:OY,RadioButton:BY,CheckBox:jY,TextField:VY,PasswordField:HY,Appearance:GY},aY.AcroForm={ChoiceField:RY,ListBox:DY,ComboBox:NY,EditBox:zY,Button:FY,PushButton:OY,RadioButton:BY,CheckBox:jY,TextField:VY,PasswordField:HY,Appearance:GY};aY.AcroForm;function qY(t){return t.reduce(function(t,e,n){return t[e]=n,t},{})}!function(t){var e="addImage_";t.__addimage__={};var n="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=t.__addimage__.getImageFileTypeByImageData=function(t,e){var r,a,o,s,l,c=n;if("RGBA"===(e=e||n)||void 0!==t.data&&t.data instanceof Uint8ClampedArray&&"height"in t&&"width"in t)return"RGBA";if(w(t))for(l in i)for(o=i[l],r=0;r<o.length;r+=1){for(s=!0,a=0;a<o[r].length;a+=1)if(void 0!==o[r][a]&&o[r][a]!==t[a]){s=!1;break}if(!0===s){c=l;break}}else for(l in i)for(o=i[l],r=0;r<o.length;r+=1){for(s=!0,a=0;a<o[r].length;a+=1)if(void 0!==o[r][a]&&o[r][a]!==t.charCodeAt(a)){s=!1;break}if(!0===s){c=l;break}}return c===n&&e!==n&&(c=e),c},a=function t(e){for(var n=this.internal.write,i=this.internal.putStream,r=(0,this.internal.getFilters)();-1!==r.indexOf("FlateEncode");)r.splice(r.indexOf("FlateEncode"),1);e.objectId=this.internal.newObject();var a=[];if(a.push({key:"Type",value:"/XObject"}),a.push({key:"Subtype",value:"/Image"}),a.push({key:"Width",value:e.width}),a.push({key:"Height",value:e.height}),e.colorSpace===y.INDEXED?a.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(e.palette.length/3-1)+" "+("sMask"in e&&void 0!==e.sMask?e.objectId+2:e.objectId+1)+" 0 R]"}):(a.push({key:"ColorSpace",value:"/"+e.colorSpace}),e.colorSpace===y.DEVICE_CMYK&&a.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),a.push({key:"BitsPerComponent",value:e.bitsPerComponent}),"decodeParameters"in e&&void 0!==e.decodeParameters&&a.push({key:"DecodeParms",value:"<<"+e.decodeParameters+">>"}),"transparency"in e&&Array.isArray(e.transparency)&&e.transparency.length>0){for(var o="",s=0,l=e.transparency.length;s<l;s++)o+=e.transparency[s]+" "+e.transparency[s]+" ";a.push({key:"Mask",value:"["+o+"]"})}void 0!==e.sMask&&a.push({key:"SMask",value:e.objectId+1+" 0 R"});var c=void 0!==e.filter?["/"+e.filter]:void 0;if(i({data:e.data,additionalKeyValues:a,alreadyAppliedFilters:c,objectId:e.objectId}),n("endobj"),"sMask"in e&&void 0!==e.sMask){var u,h=null!==(u=e.sMaskBitsPerComponent)&&void 0!==u?u:e.bitsPerComponent,d={width:e.width,height:e.height,colorSpace:"DeviceGray",bitsPerComponent:h,data:e.sMask};"filter"in e&&(d.decodeParameters="/Predictor ".concat(e.predictor," /Colors 1 /BitsPerComponent ").concat(h," /Columns ").concat(e.width),d.filter=e.filter),t.call(this,d)}if(e.colorSpace===y.INDEXED){var p=this.internal.newObject();i({data:M(new Uint8Array(e.palette)),objectId:p}),n("endobj")}},o=function(){var t=this.internal.collections[e+"images"];for(var n in t)a.call(this,t[n])},s=function(){var t,n=this.internal.collections[e+"images"],i=this.internal.write;for(var r in n)i("/I"+(t=n[r]).index,t.objectId,"0","R")},l=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",s))},c=function(){var t=this.internal.collections[e+"images"];return l.call(this),t},u=function(){return Object.keys(this.internal.collections[e+"images"]).length},h=function(e){return"function"==typeof t["process"+e.toUpperCase()]},d=function(t){return"object"===(0,SD.A)(t)&&1===t.nodeType},p=function(e,n){if("IMG"===e.nodeName&&e.hasAttribute("src")){var i=""+e.getAttribute("src");if(0===i.indexOf("data:image/"))return DX(unescape(i).split("base64,").pop());var r=t.loadFile(i,!0);if(void 0!==r)return r}if("CANVAS"===e.nodeName){if(0===e.width||0===e.height)throw new Error("Given canvas must have data. Canvas width: "+e.width+", height: "+e.height);var a;switch(n){case"PNG":a="image/png";break;case"WEBP":a="image/webp";break;default:a="image/jpeg"}return DX(e.toDataURL(a,1).split("base64,").pop())}},f=function(t){var n=this.internal.collections[e+"images"];if(n)for(var i in n)if(t===n[i].alias)return n[i]},m=function(t,e,n){return t||e||(t=-96,e=-96),t<0&&(t=-1*n.width*72/t/this.internal.scaleFactor),e<0&&(e=-1*n.height*72/e/this.internal.scaleFactor),0===t&&(t=e*n.width/n.height),0===e&&(e=t*n.height/n.width),[t,e]},g=function(t,e,n,i,r,a){var o=m.call(this,n,i,r),s=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,u=c.call(this);if(n=o[0],i=o[1],u[r.index]=r,a){a*=Math.PI/180;var h=Math.cos(a),d=Math.sin(a),p=function(t){return t.toFixed(4)},f=[p(h),p(d),p(-1*d),p(h),0,0,"cm"]}this.internal.write("q"),a?(this.internal.write([1,"0","0",1,s(t),l(e+i),"cm"].join(" ")),this.internal.write(f.join(" ")),this.internal.write([s(n),"0","0",s(i),"0","0","cm"].join(" "))):this.internal.write([s(n),"0","0",s(i),s(t),l(e+i),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+r.index+" Do"),this.internal.write("Q")},y=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var v=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},_=t.__addimage__.sHashCode=function(t){var e,n,i=0;if("string"==typeof t)for(n=t.length,e=0;e<n;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;else if(w(t))for(n=t.byteLength/2,e=0;e<n;e++)i=(i<<5)-i+t[e],i|=0;return i},b=t.__addimage__.validateStringAsBase64=function(t){(t=t||"").toString().trim();var e=!0;return 0===t.length&&(e=!1),t.length%4!=0&&(e=!1),!1===/^[A-Za-z0-9+/]+$/.test(t.substr(0,t.length-2))&&(e=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(t.substr(-2))&&(e=!1),e},x=t.__addimage__.extractImageFromDataUrl=function(t){if(null==t)return null;if(!(t=t.trim()).startsWith("data:"))return null;var e=t.indexOf(",");return e<0?null:t.substring(0,e).trim().endsWith("base64")?t.substring(e+1):null};t.__addimage__.isArrayBuffer=function(t){return t instanceof ArrayBuffer};var w=t.__addimage__.isArrayBufferView=function(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array},S=t.__addimage__.binaryStringToUint8Array=function(t){for(var e=t.length,n=new Uint8Array(e),i=0;i<e;i++)n[i]=t.charCodeAt(i);return n},M=t.__addimage__.arrayBufferToBinaryString=function(t){for(var e="",n=w(t)?t:new Uint8Array(t),i=0;i<n.length;i+=8192)e+=String.fromCharCode.apply(null,n.subarray(i,i+8192));return e};t.addImage=function(){var t,e,i,r,a,o,s,c,u;if("number"==typeof arguments[1]?(e=n,i=arguments[1],r=arguments[2],a=arguments[3],o=arguments[4],s=arguments[5],c=arguments[6],u=arguments[7]):(e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],o=arguments[5],s=arguments[6],c=arguments[7],u=arguments[8]),"object"===(0,SD.A)(t=arguments[0])&&!d(t)&&"imageData"in t){var h=t;t=h.imageData,e=h.format||e||n,i=h.x||i||0,r=h.y||r||0,a=h.w||h.width||a,o=h.h||h.height||o,s=h.alias||s,c=h.compression||c,u=h.rotation||h.angle||u}var p=this.internal.getFilters();if(void 0===c&&-1!==p.indexOf("FlateEncode")&&(c="SLOW"),isNaN(i)||isNaN(r))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var f=T.call(this,t,e,s,c);return g.call(this,i,r,a,o,f,u),this};var T=function(e,i,a,o){var s,l,c;if("string"==typeof e&&r(e)===n){e=unescape(e);var m=A(e,!1);(""!==m||void 0!==(m=t.loadFile(e,!0)))&&(e=m)}if(d(e)&&(e=p(e,i)),i=r(e,i),!h(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if((null==(c=a)||0===c.length)&&(a=function(t){return"string"==typeof t||w(t)?_(t):w(t.data)?_(t.data):null}(e)),(s=f.call(this,a))||(e instanceof Uint8Array||"RGBA"===i||(l=e,e=S(e)),s=this["process"+i.toUpperCase()](e,u.call(this),a,function(e){return e&&"string"==typeof e&&(e=e.toUpperCase()),e in t.image_compression?e:v.NONE}(o),l)),!s)throw new Error("An unknown error occurred whilst processing the image.");return s},A=t.__addimage__.convertBase64ToBinaryString=function(t,e){e="boolean"!=typeof e||e;var n,i="";if("string"==typeof t){var a;n=null!==(a=x(t))&&void 0!==a?a:t;try{i=DX(n)}catch(r){if(e)throw b(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+r.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return i};t.getImageProperties=function(e){var i,a,o="";if(d(e)&&(e=p(e)),"string"==typeof e&&r(e)===n&&(""===(o=A(e,!1))&&(o=t.loadFile(e)||""),e=o),a=r(e),!h(a))throw new Error("addImage does not support files of type '"+a+"', please ensure that a plugin for '"+a+"' support is added.");if(e instanceof Uint8Array||(e=S(e)),!(i=this["process"+a.toUpperCase()](e)))throw new Error("An unknown error occurred whilst processing the image");return i.fileType=a,i}}(aY.API),function(t){var e=function(t){if(void 0!==t&&""!=t)return!0};aY.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(t){for(var n,i,r,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,s=this.internal.getPageInfoByObjId(t.objId),l=t.pageContext.annotations,c=!1,u=0;u<l.length&&!c;u++)switch((n=l[u]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(0!=c){this.internal.write("/Annots [");for(var h=0;h<l.length;h++){n=l[h];var d=this.internal.pdfEscape,p=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var f=this.internal.newAdditionalObject(),m=this.internal.newAdditionalObject(),g=this.internal.getEncryptor(f.objId),y=n.title||"Note";r="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+d(g(n.contents))+")",r+=" /Popup "+m.objId+" 0 R",r+=" /P "+s.objId+" 0 R",r+=" /T ("+d(g(y))+") >>",f.content=r;var v=f.objId+" 0 R";r="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+v,n.open&&(r+=" /Open true"),r+=" >>",m.content=r,this.internal.write(f.objId,"0 R",m.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var _=n.color||"#000000";r="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+d(p(n.contents))+")",r+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+_+")",r+=" /Border [0 0 0]",r+=" >>",this.internal.write(r);break;case"link":if(n.options.name){var b=this.annotations._nameMap[n.options.name];n.options.pageNumber=b.page,n.options.top=b.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",r="",n.options.url)r="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+d(p(n.options.url))+") >>";else if(n.options.pageNumber)switch(r="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":r+=" /Fit]";break;case"FitH":r+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,r+=" /FitV "+n.options.left+"]";break;default:var x=o(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),r+=" /XYZ "+n.options.left+" "+x+" "+n.options.zoom+"]"}""!=r&&(r+=" >>",this.internal.write(r))}}this.internal.write("]")}}]),t.createAnnotation=function(t){var e=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":e.pageContext.annotations.push(t)}},t.link=function(t,e,n,i,r){var a=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:o(t),y:s(e),w:o(t+n),h:s(e+i)},options:r,type:"link"})},t.textWithLink=function(t,e,n,i){var r,a,o=this.getTextWidth(t),s=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==i.maxWidth){a=i.maxWidth;var l=this.splitTextToSize(t,a).length;r=Math.ceil(s*l)}else a=o,r=s;return this.text(t,e,n,i),n+=.2*s,"center"===i.align&&(e-=o/2),"right"===i.align&&(e-=o),this.link(e,n-s,a,r,i),o},t.getTextWidth=function(t){var e=this.internal.getFontSize();return this.getStringUnitWidth(t)*e/this.internal.scaleFactor}}(aY.API),function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];t.__arabicParser__={};var a=t.__arabicParser__.isInArabicSubstitutionA=function(t){return void 0!==e[t.charCodeAt(0)]},o=t.__arabicParser__.isArabicLetter=function(t){return"string"==typeof t&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(t)},s=t.__arabicParser__.isArabicEndLetter=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length<=2},l=t.__arabicParser__.isArabicAlfLetter=function(t){return o(t)&&r.indexOf(t.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length>=1};var c=t.__arabicParser__.arabicLetterHasFinalForm=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length>=3};var u=t.__arabicParser__.arabicLetterHasMedialForm=function(t){return o(t)&&a(t)&&4==e[t.charCodeAt(0)].length},h=t.__arabicParser__.resolveLigatures=function(t){var e=0,i=n,r="",a=0;for(e=0;e<t.length;e+=1)void 0!==i[t.charCodeAt(e)]?(a++,"number"==typeof(i=i[t.charCodeAt(e)])&&(r+=String.fromCharCode(i),i=n,a=0),e===t.length-1&&(i=n,r+=t.charAt(e-(a-1)),e-=a-1,a=0)):(i=n,r+=t.charAt(e-a),e-=a,a=0);return r};t.__arabicParser__.isArabicDiacritic=function(t){return void 0!==t&&void 0!==i[t.charCodeAt(0)]};var d=t.__arabicParser__.getCorrectForm=function(t,e,n){return o(t)?!1===a(t)?-1:!c(t)||!o(e)&&!o(n)||!o(n)&&s(e)||s(t)&&!o(e)||s(t)&&l(e)||s(t)&&s(e)?0:u(t)&&o(e)&&!s(e)&&o(n)&&c(n)?3:s(t)||!o(n)?1:2:-1},p=function(t){var n=0,i=0,r=0,a="",s="",l="",c=(t=t||"").split("\\s+"),u=[];for(n=0;n<c.length;n+=1){for(u.push(""),i=0;i<c[n].length;i+=1)a=c[n][i],s=c[n][i-1],l=c[n][i+1],o(a)?(r=d(a,s,l),u[n]+=-1!==r?String.fromCharCode(e[a.charCodeAt(0)][r]):a):u[n]+=a;u[n]=h(u[n])}return u.join(" ")},f=t.__arabicParser__.processArabic=t.processArabic=function(){var t,e="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(e)){var i=0;for(n=[],i=0;i<e.length;i+=1)Array.isArray(e[i])?n.push([p(e[i][0]),e[i][1],e[i][2]]):n.push([p(e[i])]);t=n}else t=p(e);return"string"==typeof arguments[0]?t:(arguments[0].text=t,arguments[0])};t.events.push(["preProcessText",f])}(aY.API),aY.API.autoPrint=function(t){var e;return(t=t||{}).variant=t.variant||"non-conform","javascript"===t.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},function(t){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(e){t=e}});var e=150;Object.defineProperty(this,"width",{get:function(){return e},set:function(t){e=isNaN(t)||!1===Number.isInteger(t)||t<0?150:t,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=e+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(t){n=isNaN(t)||!1===Number.isInteger(t)||t<0?300:t,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(t){i=t}});var r={};Object.defineProperty(this,"style",{get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,e){var n;if("2d"!==(t=t||"2d"))return null;for(n in e)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=e[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(aY.API),function(t){var e={left:0,top:0,bottom:0,right:0},n=!1,i=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var t=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var e=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(t){n=t}});var i=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return i},set:function(t){i=t}});var r=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return r},set:function(t){r=t}});var a=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return a},set:function(t){a=t}});var o=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return o},set:function(t){o=t}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(t){return i.call(this),this.internal.__cell__.headerFunction="function"==typeof t?t:void 0,this},t.getTextDimensions=function(t,e){i.call(this);var n=(e=e||{}).fontSize||this.getFontSize(),r=e.font||this.getFont(),a=e.scaleFactor||this.internal.scaleFactor,o=0,s=0,l=0,c=this;if(!Array.isArray(t)&&"string"!=typeof t){if("number"!=typeof t)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");t=String(t)}var u=e.maxWidth;u>0?"string"==typeof t?t=this.splitTextToSize(t,u):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce(function(t,e){return t.concat(c.splitTextToSize(e,u))},[])):t=Array.isArray(t)?t:[t];for(var h=0;h<t.length;h++)o<(l=this.getStringUnitWidth(t[h],{font:r})*n)&&(o=l);return 0!==o&&(s=t.length),{w:o/=a,h:Math.max((s*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/a,0)}},t.cellAddPage=function(){i.call(this),this.addPage();var t=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new a(t.left,t.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var t;t=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var r=this.internal.__cell__.lastCell,o=this.internal.__cell__.padding,s=this.internal.__cell__.margins||e,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==r.lineNumber&&(r.lineNumber===t.lineNumber?(t.x=(r.x||0)+(r.width||0),t.y=r.y||0):r.y+r.height+t.height+s.bottom>this.getPageHeight()?(this.cellAddPage(),t.y=s.top,c&&l&&(this.printHeaderRow(t.lineNumber,!0),t.y+=l[0].height)):t.y=r.y+r.height||t.y),void 0!==t.text[0]&&(this.rect(t.x,t.y,t.width,t.height,!0===n?"FD":void 0),"right"===t.align?this.text(t.text,t.x+t.width-o,t.y+o,{align:"right",baseline:"top"}):"center"===t.align?this.text(t.text,t.x+t.width/2,t.y+o,{align:"center",baseline:"top",maxWidth:t.width-o-o}):this.text(t.text,t.x+o,t.y+o,{align:"left",baseline:"top",maxWidth:t.width-o-o})),this.internal.__cell__.lastCell=t,this};t.table=function(t,n,l,c,u){if(i.call(this),!l)throw new Error("No data for PDF table.");var h,d,p,f,m=[],g=[],y=[],v={},_={},b=[],x=[],w=(u=u||{}).autoSize||!1,S=!1!==u.printHeaders,M=u.css&&void 0!==u.css["font-size"]?16*u.css["font-size"]:u.fontSize||12,T=u.margins||Object.assign({width:this.getPageWidth()},e),A="number"==typeof u.padding?u.padding:3,E=u.headerBackgroundColor||"#c8c8c8",C=u.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=S,this.internal.__cell__.margins=T,this.internal.__cell__.table_font_size=M,this.internal.__cell__.padding=A,this.internal.__cell__.headerBackgroundColor=E,this.internal.__cell__.headerTextColor=C,this.setFontSize(M),null==c)g=m=Object.keys(l[0]),y=m.map(function(){return"left"});else if(Array.isArray(c)&&"object"===(0,SD.A)(c[0]))for(m=c.map(function(t){return t.name}),g=c.map(function(t){return t.prompt||t.name||""}),y=c.map(function(t){return t.align||"left"}),h=0;h<c.length;h+=1)_[c[h].name]=.7499990551181103*c[h].width;else Array.isArray(c)&&"string"==typeof c[0]&&(g=m=c,y=m.map(function(){return"left"}));if(w||Array.isArray(c)&&"string"==typeof c[0])for(h=0;h<m.length;h+=1){for(v[f=m[h]]=l.map(function(t){return t[f]}),this.setFont(void 0,"bold"),b.push(this.getTextDimensions(g[h],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),d=v[f],this.setFont(void 0,"normal"),p=0;p<d.length;p+=1)b.push(this.getTextDimensions(d[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);_[f]=Math.max.apply(null,b)+A+A,b=[]}if(S){var P={};for(h=0;h<m.length;h+=1)P[m[h]]={},P[m[h]].text=g[h],P[m[h]].align=y[h];var I=s.call(this,P,_);x=m.map(function(e){return new a(t,n,_[e],I,P[e].text,void 0,P[e].align)}),this.setTableHeaderRow(x),this.printHeaderRow(1,!1)}var L=c.reduce(function(t,e){return t[e.name]=e.align,t},{});for(h=0;h<l.length;h+=1){"rowStart"in u&&u.rowStart instanceof Function&&u.rowStart({row:h,data:l[h]},this);var k=s.call(this,l[h],_);for(p=0;p<m.length;p+=1){var R=l[h][m[p]];"cellStart"in u&&u.cellStart instanceof Function&&u.cellStart({row:h,col:p,data:R},this),o.call(this,new a(t,n,_[m[p]],k,R,h+2,L[m[p]]))}}return this.internal.__cell__.table_x=t,this.internal.__cell__.table_y=n,this};var s=function(t,e){var n=this.internal.__cell__.padding,i=this.internal.__cell__.table_font_size,r=this.internal.scaleFactor;return Object.keys(t).map(function(i){var r=t[i];return this.splitTextToSize(r.hasOwnProperty("text")?r.text:r,e[i]-n-n)},this).map(function(t){return this.getLineHeightFactor()*t.length*i/r+n+n},this).reduce(function(t,e){return Math.max(t,e)},0)};t.setTableHeaderRow=function(t){i.call(this),this.internal.__cell__.tableHeaderRow=t},t.printHeaderRow=function(t,e){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var r;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var s=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(s[0],s[1],s[2],s[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){r=this.internal.__cell__.tableHeaderRow[c].clone(),e&&(r.y=this.internal.__cell__.margins.top||0,l.push(r)),r.lineNumber=t;var u=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,r),this.setTextColor(u)}l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),n=!1}}(aY.API);var ZY={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},XY=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],YY=qY(XY),KY=[100,200,300,400,500,600,700,800,900],JY=qY(KY);function $Y(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),n=function(t){return ZY[t=t||"normal"]?t:"normal"}(t.style),i=function(t){return t?"number"==typeof t?t>=100&&t<=900&&t%100==0?t:400:/^\d00$/.test(t)?parseInt(t):"bold"===t?700:400:400}(t.weight),r=function(t){return"number"==typeof YY[t=t||"normal"]?t:"normal"}(t.stretch);return{family:e,style:n,weight:i,stretch:r,src:t.src||[],ref:t.ref||{name:e,style:[r,n,i].join(" ")}}}function QY(t,e,n,i){var r;for(r=n;r>=0&&r<e.length;r+=i)if(t[e[r]])return t[e[r]];for(r=n;r>=0&&r<e.length;r-=i)if(t[e[r]])return t[e[r]]}var tK={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},eK={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function nK(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function iK(t){return t.trimLeft()}function rK(t,e){for(var n=0;n<t.length;){if(t.charAt(n)===e)return[t.substring(0,n),t.substring(n+1)];n+=1}return null}function aK(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===e?null:[e[0],t.substring(e[0].length)]}var oK,sK,lK,cK,uK,hK,dK,pK,fK,mK=["times"];function gK(t,e,n,i,r){var a=4,o=_K;switch(r){case aY.API.image_compression.FAST:a=1,o=vK;break;case aY.API.image_compression.MEDIUM:a=6,o=bK;break;case aY.API.image_compression.SLOW:a=9,o=xK}t=function(t,e,n,i){for(var r,a=t.length/e,o=new Uint8Array(t.length+a),s=[yK,vK,_K,bK,xK],l=0;l<a;l+=1){var c=l*e,u=t.subarray(c,c+e);if(i)o.set(i(u,n,r),c+l);else{for(var h=s.length,d=[],p=0;p<h;p+=1)d[p]=s[p](u,n,r);var f=SK(d.concat());o.set(d[f],c+l)}r=u}return o}(t,e,Math.ceil(n*i/8),o);var s=QH(t,{level:a});return aY.API.__addimage__.arrayBufferToBinaryString(s)}function yK(t){var e=Array.apply([],t);return e.unshift(0),e}function vK(t,e){var n=t.length,i=[];i[0]=1;for(var r=0;r<n;r+=1){var a=t[r-e]||0;i[r+1]=t[r]-a+256&255}return i}function _K(t,e,n){var i=t.length,r=[];r[0]=2;for(var a=0;a<i;a+=1){var o=n&&n[a]||0;r[a+1]=t[a]-o+256&255}return r}function bK(t,e,n){var i=t.length,r=[];r[0]=3;for(var a=0;a<i;a+=1){var o=t[a-e]||0,s=n&&n[a]||0;r[a+1]=t[a]+256-(o+s>>>1)&255}return r}function xK(t,e,n){var i=t.length,r=[];r[0]=4;for(var a=0;a<i;a+=1){var o=wK(t[a-e]||0,n&&n[a]||0,n&&n[a-e]||0);r[a+1]=t[a]-o+256&255}return r}function wK(t,e,n){if(t===e&&e===n)return t;var i=Math.abs(e-n),r=Math.abs(t-n),a=Math.abs(t+e-n-n);return i<=r&&i<=a?t:r<=a?e:n}function SK(t){var e=t.map(function(t){return t.reduce(function(t,e){return t+Math.abs(e)},0)});return e.indexOf(Math.min.apply(null,e))}function MK(t,e,n){var i=e*n,r=Math.floor(i/8),a=16-(i-8*r+n),o=(1<<n)-1;return AK(t,r)>>a&o}function TK(t,e,n,i){var r=n*i,a=Math.floor(r/8),o=16-(r-8*a+i),s=(1<<i)-1,l=(e&s)<<o;!function(t,e,n){if(e+1<t.byteLength)t.setUint16(e,n,!1);else{var i=n>>8&255;t.setUint8(e,i)}}(t,a,AK(t,a)&~(s<<o)&65535|l)}function AK(t,e){return e+1<t.byteLength?t.getUint16(e,!1):t.getUint8(e)<<8}function EK(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,i=t[e++]|t[e++]<<8,r=t[e++],a=r>>7,o=1<<1+(7&r);t[e++],t[e++];var s=null,l=null;a&&(s=e,l=o,e+=3*o);var c=!0,u=[],h=0,d=null,p=0,f=null;for(this.width=n,this.height=i;c&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,f=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((E=t[e++])>=0))throw Error("Invalid block size");if(0===E)break;e+=E}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var m=t[e++];h=t[e++]|t[e++]<<8,d=t[e++],1&m||(d=null),p=m>>2&7,e++;break;case 254:for(;;){if(!((E=t[e++])>=0))throw Error("Invalid block size");if(0===E)break;e+=E}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var g=t[e++]|t[e++]<<8,y=t[e++]|t[e++]<<8,v=t[e++]|t[e++]<<8,_=t[e++]|t[e++]<<8,b=t[e++],x=b>>6&1,w=1<<1+(7&b),S=s,M=l,T=!1;b>>7&&(T=!0,S=e,M=w,e+=3*w);var A=e;for(e++;;){var E;if(!((E=t[e++])>=0))throw Error("Invalid block size");if(0===E)break;e+=E}u.push({x:g,y:y,width:v,height:_,has_local_palette:T,palette_offset:S,palette_size:M,data_offset:A,data_length:e-A,transparent_index:d,interlaced:!!x,delay:h,disposal:p});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return f},this.frameInfo=function(t){if(t<0||t>=u.length)throw new Error("Frame index out of range.");return u[t]},this.decodeAndBlitFrameBGRA=function(e,i){var r=this.frameInfo(e),a=r.width*r.height,o=new Uint8Array(a);CK(t,r.data_offset,o,a);var s=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var c=r.width,u=n-c,h=c,d=4*(r.y*n+r.x),p=4*((r.y+r.height)*n+r.x),f=d,m=4*u;!0===r.interlaced&&(m+=4*n*7);for(var g=8,y=0,v=o.length;y<v;++y){var _=o[y];if(0===h&&(h=c,(f+=m)>=p&&(m=4*u+4*n*(g-1),f=d+(c+u)*(g<<1),g>>=1)),_===l)f+=4;else{var b=t[s+3*_],x=t[s+3*_+1],w=t[s+3*_+2];i[f++]=w,i[f++]=x,i[f++]=b,i[f++]=255}--h}},this.decodeAndBlitFrameRGBA=function(e,i){var r=this.frameInfo(e),a=r.width*r.height,o=new Uint8Array(a);CK(t,r.data_offset,o,a);var s=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var c=r.width,u=n-c,h=c,d=4*(r.y*n+r.x),p=4*((r.y+r.height)*n+r.x),f=d,m=4*u;!0===r.interlaced&&(m+=4*n*7);for(var g=8,y=0,v=o.length;y<v;++y){var _=o[y];if(0===h&&(h=c,(f+=m)>=p&&(m=4*u+4*n*(g-1),f=d+(c+u)*(g<<1),g>>=1)),_===l)f+=4;else{var b=t[s+3*_],x=t[s+3*_+1],w=t[s+3*_+2];i[f++]=b,i[f++]=x,i[f++]=w,i[f++]=255}--h}}}function CK(t,e,n,i){for(var r=t[e++],a=1<<r,o=a+1,s=o+1,l=r+1,c=(1<<l)-1,u=0,h=0,d=0,p=t[e++],f=new Int32Array(4096),m=null;;){for(;u<16&&0!==p;)h|=t[e++]<<u,u+=8,1===p?p=t[e++]:--p;if(u<l)break;var g=h&c;if(h>>=l,u-=l,g!==a){if(g===o)break;for(var y=g<s?g:m,v=0,_=y;_>a;)_=f[_]>>8,++v;var b=_;if(d+v+(y!==g?1:0)>i)return void CX.log("Warning, gif stream longer than expected.");n[d++]=b;var x=d+=v;for(y!==g&&(n[d++]=b),_=y;v--;)_=f[_],n[--x]=255&_,_>>=8;null!==m&&s<4096&&(f[s++]=m<<8|b,s>=c+1&&l<12&&(++l,c=c<<1|1)),m=g}else s=o+1,c=(1<<(l=r+1))-1,m=null}return d!==i&&CX.log("Warning, gif stream shorter than expected."),n}function PK(t){var e,n,i,r,a,o=Math.floor,s=new Array(64),l=new Array(64),c=new Array(64),u=new Array(64),h=new Array(65535),d=new Array(65535),p=new Array(64),f=new Array(64),m=[],g=0,y=7,v=new Array(64),_=new Array(64),b=new Array(64),x=new Array(256),w=new Array(2048),S=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],M=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],A=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],E=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],C=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],P=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],L=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function k(t,e){for(var n=0,i=0,r=new Array,a=1;a<=16;a++){for(var o=1;o<=t[a];o++)r[e[i]]=[],r[e[i]][0]=n,r[e[i]][1]=a,i++,n++;n*=2}return r}function R(t){for(var e=t[0],n=t[1]-1;n>=0;)e&1<<n&&(g|=1<<y),n--,--y<0&&(255==g?(D(255),D(0)):D(g),y=7,g=0)}function D(t){m.push(t)}function N(t){D(t>>8&255),D(255&t)}function z(t,e,n,i,r){for(var a,o=r[0],s=r[240],l=function(t,e){var n,i,r,a,o,s,l,c,u,h,d=0;for(u=0;u<8;++u){n=t[d],i=t[d+1],r=t[d+2],a=t[d+3],o=t[d+4],s=t[d+5],l=t[d+6];var f=n+(c=t[d+7]),m=n-c,g=i+l,y=i-l,v=r+s,_=r-s,b=a+o,x=a-o,w=f+b,S=f-b,M=g+v,T=g-v;t[d]=w+M,t[d+4]=w-M;var A=.707106781*(T+S);t[d+2]=S+A,t[d+6]=S-A;var E=.382683433*((w=x+_)-(T=y+m)),C=.5411961*w+E,P=1.306562965*T+E,I=.707106781*(M=_+y),L=m+I,k=m-I;t[d+5]=k+C,t[d+3]=k-C,t[d+1]=L+P,t[d+7]=L-P,d+=8}for(d=0,u=0;u<8;++u){n=t[d],i=t[d+8],r=t[d+16],a=t[d+24],o=t[d+32],s=t[d+40],l=t[d+48];var R=n+(c=t[d+56]),D=n-c,N=i+l,z=i-l,F=r+s,O=r-s,B=a+o,U=a-o,j=R+B,V=R-B,H=N+F,G=N-F;t[d]=j+H,t[d+32]=j-H;var W=.707106781*(G+V);t[d+16]=V+W,t[d+48]=V-W;var q=.382683433*((j=U+O)-(G=z+D)),Z=.5411961*j+q,X=1.306562965*G+q,Y=.707106781*(H=O+z),K=D+Y,J=D-Y;t[d+40]=J+Z,t[d+24]=J-Z,t[d+8]=K+X,t[d+56]=K-X,d++}for(u=0;u<64;++u)h=t[u]*e[u],p[u]=h>0?h+.5|0:h-.5|0;return p}(t,e),c=0;c<64;++c)f[S[c]]=l[c];var u=f[0]-n;n=f[0],0==u?R(i[0]):(R(i[d[a=32767+u]]),R(h[a]));for(var m=63;m>0&&0==f[m];)m--;if(0==m)return R(o),n;for(var g,y=1;y<=m;){for(var v=y;0==f[y]&&y<=m;)++y;var _=y-v;if(_>=16){g=_>>4;for(var b=1;b<=g;++b)R(s);_&=15}a=32767+f[y],R(r[(_<<4)+d[a]]),R(h[a]),y++}return 63!=m&&R(o),n}function F(t){t=Math.min(Math.max(t,1),100),a!=t&&(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var i=o((e[n]*t+50)/100);i=Math.min(Math.max(i,1),255),s[S[n]]=i}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var h=o((r[a]*t+50)/100);h=Math.min(Math.max(h,1),255),l[S[a]]=h}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,f=0;f<8;f++)for(var m=0;m<8;m++)c[p]=1/(s[S[p]]*d[f]*d[m]*8),u[p]=1/(l[S[p]]*d[f]*d[m]*8),p++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),a=t)}this.encode=function(t,a){a&&F(a),m=new Array,g=0,y=7,N(65496),N(65504),N(16),D(74),D(70),D(73),D(70),D(0),D(1),D(1),D(0),N(1),N(1),D(0),D(0),function(){N(65499),N(132),D(0);for(var t=0;t<64;t++)D(s[t]);D(1);for(var e=0;e<64;e++)D(l[e])}(),function(t,e){N(65472),N(17),D(8),N(e),N(t),D(3),D(1),D(17),D(0),D(2),D(17),D(1),D(3),D(17),D(1)}(t.width,t.height),function(){N(65476),N(418),D(0);for(var t=0;t<16;t++)D(M[t+1]);for(var e=0;e<=11;e++)D(T[e]);D(16);for(var n=0;n<16;n++)D(A[n+1]);for(var i=0;i<=161;i++)D(E[i]);D(1);for(var r=0;r<16;r++)D(C[r+1]);for(var a=0;a<=11;a++)D(P[a]);D(17);for(var o=0;o<16;o++)D(I[o+1]);for(var s=0;s<=161;s++)D(L[s])}(),N(65498),N(12),D(3),D(1),D(0),D(2),D(17),D(3),D(17),D(0),D(63),D(0);var o=0,h=0,d=0;g=0,y=7,this.encode.displayName="_encode_";for(var p,f,x,S,k,O,B,U,j,V=t.data,H=t.width,G=t.height,W=4*H,q=0;q<G;){for(p=0;p<W;){for(k=W*q+p,B=-1,U=0,j=0;j<64;j++)O=k+(U=j>>3)*W+(B=4*(7&j)),q+U>=G&&(O-=W*(q+1+U-G)),p+B>=W&&(O-=p+B-W+4),f=V[O++],x=V[O++],S=V[O++],v[j]=(w[f]+w[x+256|0]+w[S+512|0]>>16)-128,_[j]=(w[f+768|0]+w[x+1024|0]+w[S+1280|0]>>16)-128,b[j]=(w[f+1280|0]+w[x+1536|0]+w[S+1792|0]>>16)-128;o=z(v,c,o,e,i),h=z(_,u,h,n,r),d=z(b,u,d,n,r),p+=32}q+=8}if(y>=0){var Z=[];Z[1]=y+1,Z[0]=(1<<y+1)-1,R(Z)}return N(65497),new Uint8Array(m)},t=t||50,function(){for(var t=String.fromCharCode,e=0;e<256;e++)x[e]=t(e)}(),e=k(M,T),n=k(C,P),i=k(A,E),r=k(I,L),function(){for(var t=1,e=2,n=1;n<=15;n++){for(var i=t;i<e;i++)d[32767+i]=n,h[32767+i]=[],h[32767+i][1]=n,h[32767+i][0]=i;for(var r=-(e-1);r<=-t;r++)d[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=e-1+r;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)w[t]=19595*t,w[t+256|0]=38470*t,w[t+512|0]=7471*t+32768,w[t+768|0]=-11059*t,w[t+1024|0]=-21709*t,w[t+1280|0]=32768*t+8421375,w[t+1536|0]=-27439*t,w[t+1792|0]=-5329*t}(),F(t)}function IK(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function LK(t){function e(t){if(!t)throw Error("assert :P")}function n(t,e,n){for(var i=0;4>i;i++)if(t[e+i]!=n.charCodeAt(i))return!0;return!1}function i(t,e,n,i,r){for(var a=0;a<r;a++)t[e+a]=n[i+a]}function r(t,e,n,i){for(var r=0;r<i;r++)t[e+r]=n}function a(t){return new Int32Array(t)}function o(t,e){for(var n=[],i=0;i<t;i++)n.push(new e);return n}function s(t,e){var n=[];return function t(n,i,r){for(var a=r[i],o=0;o<a&&(n.push(r.length>i+1?[]:new e),!(r.length<i+1));o++)t(n[o],i+1,r)}(n,0,t),n}var l=function(){var t=this;function l(t,e){for(var n=1<<e-1>>>0;t&n;)n>>>=1;return n?(t&n-1)+n:t}function c(t,n,i,r,a){e(!(r%i));do{t[n+(r-=i)]=a}while(0<r)}function u(t,n,i,r,o){if(e(2328>=o),512>=o)var s=a(512);else if(null==(s=a(o)))return 0;return function(t,n,i,r,o,s){var u,d,p=n,f=1<<i,m=a(16),g=a(16);for(e(0!=o),e(null!=r),e(null!=t),e(0<i),d=0;d<o;++d){if(15<r[d])return 0;++m[r[d]]}if(m[0]==o)return 0;for(g[1]=0,u=1;15>u;++u){if(m[u]>1<<u)return 0;g[u+1]=g[u]+m[u]}for(d=0;d<o;++d)u=r[d],0<r[d]&&(s[g[u]++]=d);if(1==g[15])return(r=new h).g=0,r.value=s[0],c(t,p,1,f,r),f;var y,v=-1,_=f-1,b=0,x=1,w=1,S=1<<i;for(d=0,u=1,o=2;u<=i;++u,o<<=1){if(x+=w<<=1,0>(w-=m[u]))return 0;for(;0<m[u];--m[u])(r=new h).g=u,r.value=s[d++],c(t,p+b,o,S,r),b=l(b,u)}for(u=i+1,o=2;15>=u;++u,o<<=1){if(x+=w<<=1,0>(w-=m[u]))return 0;for(;0<m[u];--m[u]){if(r=new h,(b&_)!=v){for(p+=S,y=1<<(v=u)-i;15>v&&!(0>=(y-=m[v]));)++v,y<<=1;f+=S=1<<(y=v-i),t[n+(v=b&_)].g=y+i,t[n+v].value=p-n-v}r.g=u-i,r.value=s[d++],c(t,p+(b>>i),o,S,r),b=l(b,u)}}return x!=2*g[15]-1?0:f}(t,n,i,r,o,s)}function h(){this.value=this.g=0}function d(){this.value=this.g=0}function p(){this.G=o(5,h),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(On,d)}function f(t,n,i,r){e(null!=t),e(null!=n),e(2147483648>r),t.Ca=254,t.I=0,t.b=-8,t.Ka=0,t.oa=n,t.pa=i,t.Jd=n,t.Yc=i+r,t.Zc=4<=r?i+r-4+1:i,A(t)}function m(t,e){for(var n=0;0<e--;)n|=C(t,128)<<e;return n}function g(t,e){var n=m(t,e);return E(t)?-n:n}function y(t,n,i,r){var a,o=0;for(e(null!=t),e(null!=n),e(4294967288>r),t.Sb=r,t.Ra=0,t.u=0,t.h=0,4<r&&(r=4),a=0;a<r;++a)o+=n[i+a]<<8*a;t.Ra=o,t.bb=r,t.oa=n,t.pa=i}function v(t){for(;8<=t.u&&t.bb<t.Sb;)t.Ra>>>=8,t.Ra+=t.oa[t.pa+t.bb]<<jn-8>>>0,++t.bb,t.u-=8;S(t)&&(t.h=1,t.u=0)}function _(t,n){if(e(0<=n),!t.h&&n<=Un){var i=w(t)&Bn[n];return t.u+=n,v(t),i}return t.h=1,t.u=0}function b(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function x(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function w(t){return t.Ra>>>(t.u&jn-1)>>>0}function S(t){return e(t.bb<=t.Sb),t.h||t.bb==t.Sb&&t.u>jn}function M(t,e){t.u=e,t.h=S(t)}function T(t){t.u>=Vn&&(e(t.u>=Vn),v(t))}function A(t){e(null!=t&&null!=t.oa),t.pa<t.Zc?(t.I=(t.oa[t.pa++]|t.I<<8)>>>0,t.b+=8):(e(null!=t&&null!=t.oa),t.pa<t.Yc?(t.b+=8,t.I=t.oa[t.pa++]|t.I<<8):t.Ka?t.b=0:(t.I<<=8,t.b+=8,t.Ka=1))}function E(t){return m(t,1)}function C(t,e){var n=t.Ca;0>t.b&&A(t);var i=t.b,r=n*e>>>8,a=(t.I>>>i>r)+0;for(a?(n-=r,t.I-=r+1<<i>>>0):n=r+1,i=n,r=0;256<=i;)r+=8,i>>=8;return i=7^r+Hn[i],t.b-=i,t.Ca=(n<<i)-1,a}function P(t,e,n){t[e+0]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function I(t,e){return t[e+0]|t[e+1]<<8}function L(t,e){return I(t,e)|t[e+2]<<16}function k(t,e){return I(t,e)|I(t,e+2)<<16}function R(t,n){var i=1<<n;return e(null!=t),e(0<n),t.X=a(i),null==t.X?0:(t.Mb=32-n,t.Xa=n,1)}function D(t,n){e(null!=t),e(null!=n),e(t.Xa==n.Xa),i(n.X,0,t.X,0,1<<n.Xa)}function N(){this.X=[],this.Xa=this.Mb=0}function z(t,n,i,r){e(null!=i),e(null!=r);var a=i[0],o=r[0];return 0==a&&(a=(t*o+n/2)/n),0==o&&(o=(n*a+t/2)/t),0>=a||0>=o?0:(i[0]=a,r[0]=o,1)}function F(t,e){return t+(1<<e)-1>>>e}function O(t,e){return((4278255360&t)+(4278255360&e)>>>0&4278255360)+((16711935&t)+(16711935&e)>>>0&16711935)>>>0}function B(e,n){t[n]=function(n,i,r,a,o,s,l){var c;for(c=0;c<o;++c){var u=t[e](s[l+c-1],r,a+c);s[l+c]=O(n[i+c],u)}}}function U(){this.ud=this.hd=this.jd=0}function j(t,e){return((4278124286&(t^e))>>>1)+(t&e)>>>0}function V(t){return 0<=t&&256>t?t:0>t?0:255<t?255:void 0}function H(t,e){return V(t+(t-e+.5>>1))}function G(t,e,n){return Math.abs(e-n)-Math.abs(t-n)}function W(t,e,n,i,r,a,o){for(i=a[o-1],n=0;n<r;++n)a[o+n]=i=O(t[e+n],i)}function q(t,e,n,i,r){var a;for(a=0;a<n;++a){var o=t[e+a],s=o>>8&255,l=16711935&(l=(l=16711935&o)+((s<<16)+s));i[r+a]=(4278255360&o)+l>>>0}}function Z(t,e){e.jd=255&t,e.hd=t>>8&255,e.ud=t>>16&255}function X(t,e,n,i,r,a){var o;for(o=0;o<i;++o){var s=e[n+o],l=s>>>8,c=s,u=255&(u=(u=s>>>16)+((t.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(t.hd<<24>>24)*(l<<24>>24)>>>5)+((t.ud<<24>>24)*(u<<24>>24)>>>5)),r[a+o]=(4278255360&s)+(u<<16)+c}}function Y(e,n,i,r,a){t[n]=function(t,e,n,i,o,s,l,c,u){for(i=l;i<c;++i)for(l=0;l<u;++l)o[s++]=a(n[r(t[e++])])},t[e]=function(e,n,o,s,l,c,u){var h=8>>e.b,d=e.Ea,p=e.K[0],f=e.w;if(8>h)for(e=(1<<e.b)-1,f=(1<<h)-1;n<o;++n){var m,g=0;for(m=0;m<d;++m)m&e||(g=r(s[l++])),c[u++]=a(p[g&f]),g>>=h}else t["VP8LMapColor"+i](s,l,p,f,c,u,n,o,d)}}function K(t,e,n,i,r){for(n=e+n;e<n;){var a=t[e++];i[r++]=a>>16&255,i[r++]=a>>8&255,i[r++]=255&a}}function J(t,e,n,i,r){for(n=e+n;e<n;){var a=t[e++];i[r++]=a>>16&255,i[r++]=a>>8&255,i[r++]=255&a,i[r++]=a>>24&255}}function $(t,e,n,i,r){for(n=e+n;e<n;){var a=(o=t[e++])>>16&240|o>>12&15,o=240&o|o>>28&15;i[r++]=a,i[r++]=o}}function Q(t,e,n,i,r){for(n=e+n;e<n;){var a=(o=t[e++])>>16&248|o>>13&7,o=o>>5&224|o>>3&31;i[r++]=a,i[r++]=o}}function tt(t,e,n,i,r){for(n=e+n;e<n;){var a=t[e++];i[r++]=255&a,i[r++]=a>>8&255,i[r++]=a>>16&255}}function et(t,e,n,r,a,o){if(0==o)for(n=e+n;e<n;)P(r,((o=t[e++])[0]>>24|o[1]>>8&65280|o[2]<<8&16711680|o[3]<<24)>>>0),a+=32;else i(r,a,t,e,n)}function nt(e,n){t[n][0]=t[e+"0"],t[n][1]=t[e+"1"],t[n][2]=t[e+"2"],t[n][3]=t[e+"3"],t[n][4]=t[e+"4"],t[n][5]=t[e+"5"],t[n][6]=t[e+"6"],t[n][7]=t[e+"7"],t[n][8]=t[e+"8"],t[n][9]=t[e+"9"],t[n][10]=t[e+"10"],t[n][11]=t[e+"11"],t[n][12]=t[e+"12"],t[n][13]=t[e+"13"],t[n][14]=t[e+"0"],t[n][15]=t[e+"0"]}function it(t){return t==Vi||t==Hi||t==Gi||t==Wi}function rt(){this.eb=[],this.size=this.A=this.fb=0}function at(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ot(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new rt,this.f.kb=new at,this.sd=null}function st(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function lt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ct(t){return alert("todo:WebPSamplerProcessPlane"),t.T}function ut(t,e){var n=t.T,r=e.ba.f.RGBA,a=r.eb,o=r.fb+t.ka*r.A,s=gr[e.ba.S],l=t.y,c=t.O,u=t.f,h=t.N,d=t.ea,p=t.W,f=e.cc,m=e.dc,g=e.Mc,y=e.Nc,v=t.ka,_=t.ka+t.T,b=t.U,x=b+1>>1;for(0==v?s(l,c,null,null,u,h,d,p,u,h,d,p,a,o,null,null,b):(s(e.ec,e.fc,l,c,f,m,g,y,u,h,d,p,a,o-r.A,a,o,b),++n);v+2<_;v+=2)f=u,m=h,g=d,y=p,h+=t.Rc,p+=t.Rc,o+=2*r.A,s(l,(c+=2*t.fa)-t.fa,l,c,f,m,g,y,u,h,d,p,a,o-r.A,a,o,b);return c+=t.fa,t.j+_<t.o?(i(e.ec,e.fc,l,c,b),i(e.cc,e.dc,u,h,x),i(e.Mc,e.Nc,d,p,x),n--):1&_||s(l,c,null,null,u,h,d,p,u,h,d,p,a,o+r.A,null,null,b),n}function ht(t,n,i){var r=t.F,a=[t.J];if(null!=r){var o=t.U,s=n.ba.S,l=s==Bi||s==Gi;n=n.ba.f.RGBA;var c=[0],u=t.ka;c[0]=t.T,t.Kb&&(0==u?--c[0]:(--u,a[0]-=t.width),t.j+t.ka+t.T==t.o&&(c[0]=t.o-t.j-u));var h=n.eb;u=n.fb+u*n.A,t=Mi(r,a[0],t.width,o,c,h,u+(l?0:3),n.A),e(i==c),t&&it(s)&&wi(h,u,l,o,c,n.A)}return 0}function dt(t){var e=t.ma,n=e.ba.S,i=11>n,r=n==zi||n==Oi||n==Bi||n==Ui||12==n||it(n);if(e.memory=null,e.Ib=null,e.Jb=null,e.Nd=null,!Nn(e.Oa,t,r?11:12))return 0;if(r&&it(n)&&vn(),t.da)alert("todo:use_scaling");else{if(i){if(e.Ib=ct,t.Kb){if(n=t.U+1>>1,e.memory=a(t.U+2*n),null==e.memory)return 0;e.ec=e.memory,e.fc=0,e.cc=e.ec,e.dc=e.fc+t.U,e.Mc=e.cc,e.Nc=e.dc+n,e.Ib=ut,vn()}}else alert("todo:EmitYUV");r&&(e.Jb=ht,i&&gn())}if(i&&!Ir){for(t=0;256>t;++t)Lr[t]=89858*(t-128)+Tr>>Mr,Dr[t]=-22014*(t-128)+Tr,Rr[t]=-45773*(t-128),kr[t]=113618*(t-128)+Tr>>Mr;for(t=Ar;t<Er;++t)e=76283*(t-16)+Tr>>Mr,Nr[t-Ar]=Wt(e,255),zr[t-Ar]=Wt(e+8>>4,15);Ir=1}return 1}function pt(t){var n=t.ma,i=t.U,r=t.T;return e(!(1&t.ka)),0>=i||0>=r?0:(i=n.Ib(t,n),null!=n.Jb&&n.Jb(t,n,i),n.Dc+=i,1)}function ft(t){t.ma.memory=null}function mt(t,e,n,i){return 47!=_(t,8)?0:(e[0]=_(t,14)+1,n[0]=_(t,14)+1,i[0]=_(t,1),0!=_(t,3)?0:!t.h)}function gt(t,e){if(4>t)return t+1;var n=t-2>>1;return(2+(1&t)<<n)+_(e,n)+1}function yt(t,e){return 120<e?e-120:1<=(n=((n=Ji[e-1])>>4)*t+(8-(15&n)))?n:1;var n}function vt(t,e,n){var i=w(n),r=t[e+=255&i].g-8;return 0<r&&(M(n,n.u+8),i=w(n),e+=t[e].value,e+=i&(1<<r)-1),M(n,n.u+t[e].g),t[e].value}function _t(t,n,i){return i.g+=t.g,i.value+=t.value<<n>>>0,e(8>=i.g),t.g}function bt(t,n,i){var r=t.xc;return e((n=0==r?0:t.vc[t.md*(i>>r)+(n>>r)])<t.Wb),t.Ya[n]}function xt(t,n,r,a){var o=t.ab,s=t.c*n,l=t.C;n=l+n;var c=r,u=a;for(a=t.Ta,r=t.Ua;0<o--;){var h=t.gc[o],d=l,p=n,f=c,m=u,g=(u=a,c=r,h.Ea);switch(e(d<p),e(p<=h.nc),h.hc){case 2:qn(f,m,(p-d)*g,u,c);break;case 0:var y=d,v=p,_=u,b=c,x=(A=h).Ea;0==y&&(Gn(f,m,null,null,1,_,b),W(f,m+1,0,0,x-1,_,b+1),m+=x,b+=x,++y);for(var w=1<<A.b,S=w-1,M=F(x,A.b),T=A.K,A=A.w+(y>>A.b)*M;y<v;){var E=T,C=A,P=1;for(Wn(f,m,_,b-x,1,_,b);P<x;){var I=(P&~S)+w;I>x&&(I=x),(0,Jn[E[C++]>>8&15])(f,m+ +P,_,b+P-x,I-P,_,b+P),P=I}m+=x,b+=x,++y&S||(A+=M)}p!=h.nc&&i(u,c-g,u,c+(p-d-1)*g,g);break;case 1:for(g=f,v=m,x=(f=h.Ea)-(b=f&~(_=(m=1<<h.b)-1)),y=F(f,h.b),w=h.K,h=h.w+(d>>h.b)*y;d<p;){for(S=w,M=h,T=new U,A=v+b,E=v+f;v<A;)Z(S[M++],T),$n(T,g,v,m,u,c),v+=m,c+=m;v<E&&(Z(S[M++],T),$n(T,g,v,x,u,c),v+=x,c+=x),++d&_||(h+=y)}break;case 3:if(f==u&&m==c&&0<h.b){for(v=u,f=g=c+(p-d)*g-(b=(p-d)*F(h.Ea,h.b)),m=u,_=c,y=[],b=(x=b)-1;0<=b;--b)y[b]=m[_+b];for(b=x-1;0<=b;--b)v[f+b]=y[b];Zn(h,d,p,u,g,u,c)}else Zn(h,d,p,f,m,u,c)}c=a,u=r}u!=r&&i(a,r,c,u,s)}function wt(t,n){var i=t.V,r=t.Ba+t.c*t.C,a=n-t.C;if(e(n<=t.l.o),e(16>=a),0<a){var o=t.l,s=t.Ta,l=t.Ua,c=o.width;if(xt(t,a,i,r),a=l=[l],e((i=t.C)<(r=n)),e(o.v<o.va),r>o.o&&(r=o.o),i<o.j){var u=o.j-i;i=o.j,a[0]+=u*c}if(i>=r?i=0:(a[0]+=4*o.v,o.ka=i-o.j,o.U=o.va-o.v,o.T=r-i,i=1),i){if(l=l[0],11>(i=t.ca).S){var h=i.f.RGBA,d=(r=i.S,a=o.U,o=o.T,u=h.eb,h.A),p=o;for(h=h.fb+t.Ma*h.A;0<p--;){var f=s,m=l,g=a,y=u,v=h;switch(r){case Ni:Qn(f,m,g,y,v);break;case zi:ti(f,m,g,y,v);break;case Vi:ti(f,m,g,y,v),wi(y,v,0,g,1,0);break;case Fi:ii(f,m,g,y,v);break;case Oi:et(f,m,g,y,v,1);break;case Hi:et(f,m,g,y,v,1),wi(y,v,0,g,1,0);break;case Bi:et(f,m,g,y,v,0);break;case Gi:et(f,m,g,y,v,0),wi(y,v,1,g,1,0);break;case Ui:ei(f,m,g,y,v);break;case Wi:ei(f,m,g,y,v),Si(y,v,g,1,0);break;case ji:ni(f,m,g,y,v);break;default:e(0)}l+=c,h+=d}t.Ma+=o}else alert("todo:EmitRescaledRowsYUVA");e(t.Ma<=i.height)}}t.C=n,e(t.C<=t.i)}function St(t){var e;if(0<t.ua)return 0;for(e=0;e<t.Wb;++e){var n=t.Ya[e].G,i=t.Ya[e].H;if(0<n[1][i[1]+0].g||0<n[2][i[2]+0].g||0<n[3][i[3]+0].g)return 0}return 1}function Mt(t,n,i,r,a,o){if(0!=t.Z){var s=t.qd,l=t.rd;for(e(null!=mr[t.Z]);n<i;++n)mr[t.Z](s,l,r,a,r,a,o),s=r,l=a,a+=o;t.qd=s,t.rd=l}}function Tt(t,n){var i=t.l.ma,r=0==i.Z||1==i.Z?t.l.j:t.C;if(r=t.C<r?r:t.C,e(n<=t.l.o),n>r){var a=t.l.width,o=i.ca,s=i.tb+a*r,l=t.V,c=t.Ba+t.c*r,u=t.gc;e(1==t.ab),e(3==u[0].hc),Yn(u[0],r,n,l,c,o,s),Mt(i,r,n,o,s,a)}t.C=t.Ma=n}function At(t,n,i,r,a,o,s){var l=t.$/r,c=t.$%r,u=t.m,h=t.s,d=i+t.$,p=d;a=i+r*a;var f=i+r*o,m=280+h.ua,g=t.Pb?l:16777216,y=0<h.ua?h.Wa:null,v=h.wc,_=d<f?bt(h,c,l):null;e(t.C<o),e(f<=a);var b=!1;t:for(;;){for(;b||d<f;){var x=0;if(l>=g){var A=d-i;e((g=t).Pb),g.wd=g.m,g.xd=A,0<g.s.ua&&D(g.s.Wa,g.s.vb),g=l+Qi}if(c&v||(_=bt(h,c,l)),e(null!=_),_.Qb&&(n[d]=_.qb,b=!0),!b)if(T(u),_.jc){x=u,A=n;var E=d,C=_.pd[w(x)&On-1];e(_.jc),256>C.g?(M(x,x.u+C.g),A[E]=C.value,x=0):(M(x,x.u+C.g-256),e(256<=C.value),x=C.value),0==x&&(b=!0)}else x=vt(_.G[0],_.H[0],u);if(u.h)break;if(b||256>x){if(!b)if(_.nd)n[d]=(_.qb|x<<8)>>>0;else{if(T(u),b=vt(_.G[1],_.H[1],u),T(u),A=vt(_.G[2],_.H[2],u),E=vt(_.G[3],_.H[3],u),u.h)break;n[d]=(E<<24|b<<16|x<<8|A)>>>0}if(b=!1,++d,++c>=r&&(c=0,++l,null!=s&&l<=o&&!(l%16)&&s(t,l),null!=y))for(;p<d;)x=n[p++],y.X[(506832829*x&4294967295)>>>y.Mb]=x}else if(280>x){if(x=gt(x-256,u),A=vt(_.G[4],_.H[4],u),T(u),A=yt(r,A=gt(A,u)),u.h)break;if(d-i<A||a-d<x)break t;for(E=0;E<x;++E)n[d+E]=n[d+E-A];for(d+=x,c+=x;c>=r;)c-=r,++l,null!=s&&l<=o&&!(l%16)&&s(t,l);if(e(d<=a),c&v&&(_=bt(h,c,l)),null!=y)for(;p<d;)x=n[p++],y.X[(506832829*x&4294967295)>>>y.Mb]=x}else{if(!(x<m))break t;for(b=x-280,e(null!=y);p<d;)x=n[p++],y.X[(506832829*x&4294967295)>>>y.Mb]=x;x=d,e(!(b>>>(A=y).Xa)),n[x]=A.X[b],b=!0}b||e(u.h==S(u))}if(t.Pb&&u.h&&d<a)e(t.m.h),t.a=5,t.m=t.wd,t.$=t.xd,0<t.s.ua&&D(t.s.vb,t.s.Wa);else{if(u.h)break t;null!=s&&s(t,l>o?o:l),t.a=0,t.$=d-i}return 1}return t.a=3,0}function Et(t){e(null!=t),t.vc=null,t.yc=null,t.Ya=null;var n=t.Wa;null!=n&&(n.X=null),t.vb=null,e(null!=t)}function Ct(){var e=new on;return null==e?null:(e.a=0,e.xb=fr,nt("Predictor","VP8LPredictors"),nt("Predictor","VP8LPredictors_C"),nt("PredictorAdd","VP8LPredictorsAdd"),nt("PredictorAdd","VP8LPredictorsAdd_C"),qn=q,$n=X,Qn=K,ti=J,ei=$,ni=Q,ii=tt,t.VP8LMapColor32b=Xn,t.VP8LMapColor8b=Kn,e)}function Pt(t,n,i,s,l){var c=1,d=[t],f=[n],m=s.m,g=s.s,y=null,v=0;t:for(;;){if(i)for(;c&&_(m,1);){var b=d,x=f,S=s,A=1,E=S.m,C=S.gc[S.ab],P=_(E,2);if(S.Oc&1<<P)c=0;else{switch(S.Oc|=1<<P,C.hc=P,C.Ea=b[0],C.nc=x[0],C.K=[null],++S.ab,e(4>=S.ab),P){case 0:case 1:C.b=_(E,3)+2,A=Pt(F(C.Ea,C.b),F(C.nc,C.b),0,S,C.K),C.K=C.K[0];break;case 3:var I,L=_(E,8)+1,k=16<L?0:4<L?1:2<L?2:3;if(b[0]=F(C.Ea,k),C.b=k,I=A=Pt(L,1,0,S,C.K)){var D,N=L,z=C,B=1<<(8>>z.b),U=a(B);if(null==U)I=0;else{var j=z.K[0],V=z.w;for(U[0]=z.K[0][0],D=1;D<1*N;++D)U[D]=O(j[V+D],U[D-1]);for(;D<4*B;++D)U[D]=0;z.K[0]=null,z.K[0]=U,I=1}}A=I;break;case 2:break;default:e(0)}c=A}}if(d=d[0],f=f[0],c&&_(m,1)&&!(c=1<=(v=_(m,4))&&11>=v)){s.a=3;break t}var H;if(H=c)e:{var G,W,q,Z=s,X=d,Y=f,K=v,J=i,$=Z.m,Q=Z.s,tt=[null],et=1,nt=0,it=$i[K];n:for(;;){if(J&&_($,1)){var rt=_($,3)+2,at=F(X,rt),ot=F(Y,rt),st=at*ot;if(!Pt(at,ot,0,Z,tt))break n;for(tt=tt[0],Q.xc=rt,G=0;G<st;++G){var lt=tt[G]>>8&65535;tt[G]=lt,lt>=et&&(et=lt+1)}}if($.h)break n;for(W=0;5>W;++W){var ct=Xi[W];!W&&0<K&&(ct+=1<<K),nt<ct&&(nt=ct)}var ut=o(et*it,h),ht=et,dt=o(ht,p);if(null==dt)var pt=null;else e(65536>=ht),pt=dt;var ft=a(nt);if(null==pt||null==ft||null==ut){Z.a=1;break n}var mt=ut;for(G=q=0;G<et;++G){var gt=pt[G],yt=gt.G,vt=gt.H,bt=0,xt=1,wt=0;for(W=0;5>W;++W){ct=Xi[W],yt[W]=mt,vt[W]=q,!W&&0<K&&(ct+=1<<K);i:{var St,Mt=ct,Tt=Z,Ct=ft,It=mt,Lt=q,kt=0,Rt=Tt.m,Dt=_(Rt,1);if(r(Ct,0,0,Mt),Dt){var Nt=_(Rt,1)+1,zt=_(Rt,1),Ft=_(Rt,0==zt?1:8);Ct[Ft]=1,2==Nt&&(Ct[Ft=_(Rt,8)]=1);var Ot=1}else{var Bt=a(19),Ut=_(Rt,4)+4;if(19<Ut){Tt.a=3;var jt=0;break i}for(St=0;St<Ut;++St)Bt[Ki[St]]=_(Rt,3);var Vt=void 0,Ht=void 0,Gt=Tt,Wt=Bt,qt=Mt,Zt=Ct,Xt=0,Yt=Gt.m,Kt=8,Jt=o(128,h);r:for(;u(Jt,0,7,Wt,19);){if(_(Yt,1)){var $t=2+2*_(Yt,3);if((Vt=2+_(Yt,$t))>qt)break r}else Vt=qt;for(Ht=0;Ht<qt&&Vt--;){T(Yt);var Qt=Jt[0+(127&w(Yt))];M(Yt,Yt.u+Qt.g);var te=Qt.value;if(16>te)Zt[Ht++]=te,0!=te&&(Kt=te);else{var ee=16==te,ne=te-16,ie=Zi[ne],re=_(Yt,qi[ne])+ie;if(Ht+re>qt)break r;for(var ae=ee?Kt:0;0<re--;)Zt[Ht++]=ae}}Xt=1;break r}Xt||(Gt.a=3),Ot=Xt}(Ot=Ot&&!Rt.h)&&(kt=u(It,Lt,8,Ct,Mt)),Ot&&0!=kt?jt=kt:(Tt.a=3,jt=0)}if(0==jt)break n;if(xt&&1==Yi[W]&&(xt=0==mt[q].g),bt+=mt[q].g,q+=jt,3>=W){var oe,se=ft[0];for(oe=1;oe<ct;++oe)ft[oe]>se&&(se=ft[oe]);wt+=se}}if(gt.nd=xt,gt.Qb=0,xt&&(gt.qb=(yt[3][vt[3]+0].value<<24|yt[1][vt[1]+0].value<<16|yt[2][vt[2]+0].value)>>>0,0==bt&&256>yt[0][vt[0]+0].value&&(gt.Qb=1,gt.qb+=yt[0][vt[0]+0].value<<8)),gt.jc=!gt.Qb&&6>wt,gt.jc){var le,ce=gt;for(le=0;le<On;++le){var ue=le,he=ce.pd[ue],de=ce.G[0][ce.H[0]+ue];256<=de.value?(he.g=de.g+256,he.value=de.value):(he.g=0,he.value=0,ue>>=_t(de,8,he),ue>>=_t(ce.G[1][ce.H[1]+ue],16,he),ue>>=_t(ce.G[2][ce.H[2]+ue],0,he),_t(ce.G[3][ce.H[3]+ue],24,he))}}}Q.vc=tt,Q.Wb=et,Q.Ya=pt,Q.yc=ut,H=1;break e}H=0}if(!(c=H)){s.a=3;break t}if(0<v){if(g.ua=1<<v,!R(g.Wa,v)){s.a=1,c=0;break t}}else g.ua=0;var pe=s,fe=d,me=f,ge=pe.s,ye=ge.xc;if(pe.c=fe,pe.i=me,ge.md=F(fe,ye),ge.wc=0==ye?-1:(1<<ye)-1,i){s.xb=pr;break t}if(null==(y=a(d*f))){s.a=1,c=0;break t}c=(c=At(s,y,0,d,f,f,null))&&!m.h;break t}return c?(null!=l?l[0]=y:(e(null==y),e(i)),s.$=0,i||Et(g)):Et(g),c}function It(t,n){var i=t.c*t.i,r=i+n+16*n;return e(t.c<=n),t.V=a(r),null==t.V?(t.Ta=null,t.Ua=0,t.a=1,0):(t.Ta=t.V,t.Ua=t.Ba+i+n,1)}function Lt(t,n){var i=t.C,r=n-i,a=t.V,o=t.Ba+t.c*i;for(e(n<=t.l.o);0<r;){var s=16<r?16:r,l=t.l.ma,c=t.l.width,u=c*s,h=l.ca,d=l.tb+c*i,p=t.Ta,f=t.Ua;xt(t,s,a,o),Ti(p,f,h,d,u),Mt(l,i,i+s,h,d,c),r-=s,a+=s*t.c,i+=s}e(i==n),t.C=t.Ma=n}function kt(){this.ub=this.yd=this.td=this.Rb=0}function Rt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Dt(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function Nt(){this.Yb=function(){var t=[];return function t(e,n,i){for(var r=i[n],a=0;a<r&&(e.push(i.length>n+1?[]:0),!(i.length<n+1));a++)t(e[a],n+1,i)}(t,0,[3,11]),t}()}function zt(){this.jb=a(3),this.Wc=s([4,8],Nt),this.Xc=s([4,17],Nt)}function Ft(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function Ot(){this.ld=this.La=this.dd=this.tc=0}function Bt(){this.Na=this.la=0}function Ut(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function jt(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Vt(){this.uc=this.M=this.Nb=0,this.wa=Array(new Ot),this.Y=0,this.ya=Array(new jt),this.aa=0,this.l=new qt}function Ht(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Gt(){this.cb=this.a=0,this.sc="",this.m=new b,this.Od=new kt,this.Kc=new Rt,this.ed=new Ft,this.Qa=new Dt,this.Ic=this.$c=this.Aa=0,this.D=new Vt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,b),this.ia=0,this.pb=o(4,Ut),this.Pa=new zt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ht),this.Hd=0,this.rb=Array(new Bt),this.sb=0,this.wa=Array(new Ot),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new jt),this.L=this.aa=0,this.gd=s([4,2],Ot),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Wt(t,e){return 0>t?0:t>e?e:t}function qt(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Zt(){var t=new Gt;return null!=t&&(t.a=0,t.sc="OK",t.cb=0,t.Xb=0,nr||(nr=Jt)),t}function Xt(t,e,n){return 0==t.a&&(t.a=e,t.sc=n,t.cb=0),0}function Yt(t,e,n){return 3<=n&&157==t[e+0]&&1==t[e+1]&&42==t[e+2]}function Kt(t,n){if(null==t)return 0;if(t.a=0,t.sc="OK",null==n)return Xt(t,2,"null VP8Io passed to VP8GetHeaders()");var i=n.data,a=n.w,o=n.ha;if(4>o)return Xt(t,7,"Truncated header.");var s=i[a+0]|i[a+1]<<8|i[a+2]<<16,l=t.Od;if(l.Rb=!(1&s),l.td=s>>1&7,l.yd=s>>4&1,l.ub=s>>5,3<l.td)return Xt(t,3,"Incorrect keyframe parameters.");if(!l.yd)return Xt(t,4,"Frame not displayable.");a+=3,o-=3;var c=t.Kc;if(l.Rb){if(7>o)return Xt(t,7,"cannot parse picture header");if(!Yt(i,a,o))return Xt(t,3,"Bad code word");c.c=16383&(i[a+4]<<8|i[a+3]),c.Td=i[a+4]>>6,c.i=16383&(i[a+6]<<8|i[a+5]),c.Ud=i[a+6]>>6,a+=7,o-=7,t.za=c.c+15>>4,t.Ub=c.i+15>>4,n.width=c.c,n.height=c.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,r((s=t.Pa).jb,0,255,s.jb.length),e(null!=(s=t.Qa)),s.Cb=0,s.Bb=0,s.Fb=1,r(s.Zb,0,0,s.Zb.length),r(s.Lb,0,0,s.Lb)}if(l.ub>o)return Xt(t,7,"bad partition length");f(s=t.m,i,a,l.ub),a+=l.ub,o-=l.ub,l.Rb&&(c.Ld=E(s),c.Kd=E(s)),c=t.Qa;var u,h=t.Pa;if(e(null!=s),e(null!=c),c.Cb=E(s),c.Cb){if(c.Bb=E(s),E(s)){for(c.Fb=E(s),u=0;4>u;++u)c.Zb[u]=E(s)?g(s,7):0;for(u=0;4>u;++u)c.Lb[u]=E(s)?g(s,6):0}if(c.Bb)for(u=0;3>u;++u)h.jb[u]=E(s)?m(s,8):255}else c.Bb=0;if(s.Ka)return Xt(t,3,"cannot parse segment header");if((c=t.ed).zd=E(s),c.Tb=m(s,6),c.wb=m(s,3),c.Pc=E(s),c.Pc&&E(s)){for(h=0;4>h;++h)E(s)&&(c.vd[h]=g(s,6));for(h=0;4>h;++h)E(s)&&(c.od[h]=g(s,6))}if(t.L=0==c.Tb?0:c.zd?1:2,s.Ka)return Xt(t,3,"cannot parse filter header");var d=o;if(o=u=a,a=u+d,c=d,t.Xb=(1<<m(t.m,2))-1,d<3*(h=t.Xb))i=7;else{for(u+=3*h,c-=3*h,d=0;d<h;++d){var p=i[o+0]|i[o+1]<<8|i[o+2]<<16;p>c&&(p=c),f(t.Jc[+d],i,u,p),u+=p,c-=p,o+=3}f(t.Jc[+h],i,u,c),i=u<a?0:5}if(0!=i)return Xt(t,i,"cannot parse partitions");for(i=m(u=t.m,7),o=E(u)?g(u,4):0,a=E(u)?g(u,4):0,c=E(u)?g(u,4):0,h=E(u)?g(u,4):0,u=E(u)?g(u,4):0,d=t.Qa,p=0;4>p;++p){if(d.Cb){var y=d.Zb[p];d.Fb||(y+=i)}else{if(0<p){t.pb[p]=t.pb[0];continue}y=i}var v=t.pb[p];v.Sc[0]=tr[Wt(y+o,127)],v.Sc[1]=er[Wt(y+0,127)],v.Eb[0]=2*tr[Wt(y+a,127)],v.Eb[1]=101581*er[Wt(y+c,127)]>>16,8>v.Eb[1]&&(v.Eb[1]=8),v.Qc[0]=tr[Wt(y+h,117)],v.Qc[1]=er[Wt(y+u,127)],v.lc=y+u}if(!l.Rb)return Xt(t,4,"Not a key frame.");for(E(s),l=t.Pa,i=0;4>i;++i){for(o=0;8>o;++o)for(a=0;3>a;++a)for(c=0;11>c;++c)h=C(s,lr[i][o][a][c])?m(s,8):or[i][o][a][c],l.Wc[i][o].Yb[a][c]=h;for(o=0;17>o;++o)l.Xc[i][o]=l.Wc[i][cr[o]]}return t.kc=E(s),t.kc&&(t.Bd=m(s,8)),t.cb=1}function Jt(t,e,n,i,r,a,o){var s=e[r].Yb[n];for(n=0;16>r;++r){if(!C(t,s[n+0]))return r;for(;!C(t,s[n+1]);)if(s=e[++r].Yb[0],n=0,16==r)return 16;var l=e[r+1].Yb;if(C(t,s[n+2])){var c=t,u=0;if(C(c,(d=s)[(h=n)+3]))if(C(c,d[h+6])){for(s=0,h=2*(u=C(c,d[h+8]))+(d=C(c,d[h+9+u])),u=0,d=ir[h];d[s];++s)u+=u+C(c,d[s]);u+=3+(8<<h)}else C(c,d[h+7])?(u=7+2*C(c,165),u+=C(c,145)):u=5+C(c,159);else u=C(c,d[h+4])?3+C(c,d[h+5]):2;s=l[2]}else u=1,s=l[1];l=o+rr[r],0>(c=t).b&&A(c);var h,d=c.b,p=(h=c.Ca>>1)-(c.I>>d)>>31;--c.b,c.Ca+=p,c.Ca|=1,c.I-=(h+1&p)<<d,a[l]=((u^p)-p)*i[(0<r)+0]}return 16}function $t(t){var e=t.rb[t.sb-1];e.la=0,e.Na=0,r(t.zc,0,0,t.zc.length),t.ja=0}function Qt(t,e,n,i,r){r=t[e+n+32*i]+(r>>3),t[e+n+32*i]=-256&r?0>r?0:255:r}function te(t,e,n,i,r,a){Qt(t,e,0,n,i+r),Qt(t,e,1,n,i+a),Qt(t,e,2,n,i-a),Qt(t,e,3,n,i-r)}function ee(t){return(20091*t>>16)+t}function ne(t,e,n,i){var r,o=0,s=a(16);for(r=0;4>r;++r){var l=t[e+0]+t[e+8],c=t[e+0]-t[e+8],u=(35468*t[e+4]>>16)-ee(t[e+12]),h=ee(t[e+4])+(35468*t[e+12]>>16);s[o+0]=l+h,s[o+1]=c+u,s[o+2]=c-u,s[o+3]=l-h,o+=4,e++}for(r=o=0;4>r;++r)l=(t=s[o+0]+4)+s[o+8],c=t-s[o+8],u=(35468*s[o+4]>>16)-ee(s[o+12]),Qt(n,i,0,0,l+(h=ee(s[o+4])+(35468*s[o+12]>>16))),Qt(n,i,1,0,c+u),Qt(n,i,2,0,c-u),Qt(n,i,3,0,l-h),o++,i+=32}function ie(t,e,n,i){var r=t[e+0]+4,a=35468*t[e+4]>>16,o=ee(t[e+4]),s=35468*t[e+1]>>16;te(n,i,0,r+o,t=ee(t[e+1]),s),te(n,i,1,r+a,t,s),te(n,i,2,r-a,t,s),te(n,i,3,r-o,t,s)}function re(t,e,n,i,r){ne(t,e,n,i),r&&ne(t,e+16,n,i+4)}function ae(t,e,n,i){ai(t,e+0,n,i,1),ai(t,e+32,n,i+128,1)}function oe(t,e,n,i){var r;for(t=t[e+0]+4,r=0;4>r;++r)for(e=0;4>e;++e)Qt(n,i,e,r,t)}function se(t,e,n,i){t[e+0]&&li(t,e+0,n,i),t[e+16]&&li(t,e+16,n,i+4),t[e+32]&&li(t,e+32,n,i+128),t[e+48]&&li(t,e+48,n,i+128+4)}function le(t,e,n,i){var r,o=a(16);for(r=0;4>r;++r){var s=t[e+0+r]+t[e+12+r],l=t[e+4+r]+t[e+8+r],c=t[e+4+r]-t[e+8+r],u=t[e+0+r]-t[e+12+r];o[0+r]=s+l,o[8+r]=s-l,o[4+r]=u+c,o[12+r]=u-c}for(r=0;4>r;++r)s=(t=o[0+4*r]+3)+o[3+4*r],l=o[1+4*r]+o[2+4*r],c=o[1+4*r]-o[2+4*r],u=t-o[3+4*r],n[i+0]=s+l>>3,n[i+16]=u+c>>3,n[i+32]=s-l>>3,n[i+48]=u-c>>3,i+=64}function ce(t,e,n){var i,r=e-32,a=Ri,o=255-t[r-1];for(i=0;i<n;++i){var s,l=a,c=o+t[e-1];for(s=0;s<n;++s)t[e+s]=l[c+t[r+s]];e+=32}}function ue(t,e){ce(t,e,4)}function he(t,e){ce(t,e,8)}function de(t,e){ce(t,e,16)}function pe(t,e){var n;for(n=0;16>n;++n)i(t,e+32*n,t,e-32,16)}function fe(t,e){var n;for(n=16;0<n;--n)r(t,e,t[e-1],16),e+=32}function me(t,e,n){var i;for(i=0;16>i;++i)r(e,n+32*i,t,16)}function ge(t,e){var n,i=16;for(n=0;16>n;++n)i+=t[e-1+32*n]+t[e+n-32];me(i>>5,t,e)}function ye(t,e){var n,i=8;for(n=0;16>n;++n)i+=t[e-1+32*n];me(i>>4,t,e)}function ve(t,e){var n,i=8;for(n=0;16>n;++n)i+=t[e+n-32];me(i>>4,t,e)}function _e(t,e){me(128,t,e)}function be(t,e,n){return t+2*e+n+2>>2}function xe(t,e){var n,r=e-32;for(r=new Uint8Array([be(t[r-1],t[r+0],t[r+1]),be(t[r+0],t[r+1],t[r+2]),be(t[r+1],t[r+2],t[r+3]),be(t[r+2],t[r+3],t[r+4])]),n=0;4>n;++n)i(t,e+32*n,r,0,r.length)}function we(t,e){var n=t[e-1],i=t[e-1+32],r=t[e-1+64],a=t[e-1+96];P(t,e+0,16843009*be(t[e-1-32],n,i)),P(t,e+32,16843009*be(n,i,r)),P(t,e+64,16843009*be(i,r,a)),P(t,e+96,16843009*be(r,a,a))}function Se(t,e){var n,i=4;for(n=0;4>n;++n)i+=t[e+n-32]+t[e-1+32*n];for(i>>=3,n=0;4>n;++n)r(t,e+32*n,i,4)}function Me(t,e){var n=t[e-1+0],i=t[e-1+32],r=t[e-1+64],a=t[e-1-32],o=t[e+0-32],s=t[e+1-32],l=t[e+2-32],c=t[e+3-32];t[e+0+96]=be(i,r,t[e-1+96]),t[e+1+96]=t[e+0+64]=be(n,i,r),t[e+2+96]=t[e+1+64]=t[e+0+32]=be(a,n,i),t[e+3+96]=t[e+2+64]=t[e+1+32]=t[e+0+0]=be(o,a,n),t[e+3+64]=t[e+2+32]=t[e+1+0]=be(s,o,a),t[e+3+32]=t[e+2+0]=be(l,s,o),t[e+3+0]=be(c,l,s)}function Te(t,e){var n=t[e+1-32],i=t[e+2-32],r=t[e+3-32],a=t[e+4-32],o=t[e+5-32],s=t[e+6-32],l=t[e+7-32];t[e+0+0]=be(t[e+0-32],n,i),t[e+1+0]=t[e+0+32]=be(n,i,r),t[e+2+0]=t[e+1+32]=t[e+0+64]=be(i,r,a),t[e+3+0]=t[e+2+32]=t[e+1+64]=t[e+0+96]=be(r,a,o),t[e+3+32]=t[e+2+64]=t[e+1+96]=be(a,o,s),t[e+3+64]=t[e+2+96]=be(o,s,l),t[e+3+96]=be(s,l,l)}function Ae(t,e){var n=t[e-1+0],i=t[e-1+32],r=t[e-1+64],a=t[e-1-32],o=t[e+0-32],s=t[e+1-32],l=t[e+2-32],c=t[e+3-32];t[e+0+0]=t[e+1+64]=a+o+1>>1,t[e+1+0]=t[e+2+64]=o+s+1>>1,t[e+2+0]=t[e+3+64]=s+l+1>>1,t[e+3+0]=l+c+1>>1,t[e+0+96]=be(r,i,n),t[e+0+64]=be(i,n,a),t[e+0+32]=t[e+1+96]=be(n,a,o),t[e+1+32]=t[e+2+96]=be(a,o,s),t[e+2+32]=t[e+3+96]=be(o,s,l),t[e+3+32]=be(s,l,c)}function Ee(t,e){var n=t[e+0-32],i=t[e+1-32],r=t[e+2-32],a=t[e+3-32],o=t[e+4-32],s=t[e+5-32],l=t[e+6-32],c=t[e+7-32];t[e+0+0]=n+i+1>>1,t[e+1+0]=t[e+0+64]=i+r+1>>1,t[e+2+0]=t[e+1+64]=r+a+1>>1,t[e+3+0]=t[e+2+64]=a+o+1>>1,t[e+0+32]=be(n,i,r),t[e+1+32]=t[e+0+96]=be(i,r,a),t[e+2+32]=t[e+1+96]=be(r,a,o),t[e+3+32]=t[e+2+96]=be(a,o,s),t[e+3+64]=be(o,s,l),t[e+3+96]=be(s,l,c)}function Ce(t,e){var n=t[e-1+0],i=t[e-1+32],r=t[e-1+64],a=t[e-1+96];t[e+0+0]=n+i+1>>1,t[e+2+0]=t[e+0+32]=i+r+1>>1,t[e+2+32]=t[e+0+64]=r+a+1>>1,t[e+1+0]=be(n,i,r),t[e+3+0]=t[e+1+32]=be(i,r,a),t[e+3+32]=t[e+1+64]=be(r,a,a),t[e+3+64]=t[e+2+64]=t[e+0+96]=t[e+1+96]=t[e+2+96]=t[e+3+96]=a}function Pe(t,e){var n=t[e-1+0],i=t[e-1+32],r=t[e-1+64],a=t[e-1+96],o=t[e-1-32],s=t[e+0-32],l=t[e+1-32],c=t[e+2-32];t[e+0+0]=t[e+2+32]=n+o+1>>1,t[e+0+32]=t[e+2+64]=i+n+1>>1,t[e+0+64]=t[e+2+96]=r+i+1>>1,t[e+0+96]=a+r+1>>1,t[e+3+0]=be(s,l,c),t[e+2+0]=be(o,s,l),t[e+1+0]=t[e+3+32]=be(n,o,s),t[e+1+32]=t[e+3+64]=be(i,n,o),t[e+1+64]=t[e+3+96]=be(r,i,n),t[e+1+96]=be(a,r,i)}function Ie(t,e){var n;for(n=0;8>n;++n)i(t,e+32*n,t,e-32,8)}function Le(t,e){var n;for(n=0;8>n;++n)r(t,e,t[e-1],8),e+=32}function ke(t,e,n){var i;for(i=0;8>i;++i)r(e,n+32*i,t,8)}function Re(t,e){var n,i=8;for(n=0;8>n;++n)i+=t[e+n-32]+t[e-1+32*n];ke(i>>4,t,e)}function De(t,e){var n,i=4;for(n=0;8>n;++n)i+=t[e+n-32];ke(i>>3,t,e)}function Ne(t,e){var n,i=4;for(n=0;8>n;++n)i+=t[e-1+32*n];ke(i>>3,t,e)}function ze(t,e){ke(128,t,e)}function Fe(t,e,n){var i=t[e-n],r=t[e+0],a=3*(r-i)+Li[1020+t[e-2*n]-t[e+n]],o=ki[112+(a+4>>3)];t[e-n]=Ri[255+i+ki[112+(a+3>>3)]],t[e+0]=Ri[255+r-o]}function Oe(t,e,n,i){var r=t[e+0],a=t[e+n];return Di[255+t[e-2*n]-t[e-n]]>i||Di[255+a-r]>i}function Be(t,e,n,i){return 4*Di[255+t[e-n]-t[e+0]]+Di[255+t[e-2*n]-t[e+n]]<=i}function Ue(t,e,n,i,r){var a=t[e-3*n],o=t[e-2*n],s=t[e-n],l=t[e+0],c=t[e+n],u=t[e+2*n],h=t[e+3*n];return 4*Di[255+s-l]+Di[255+o-c]>i?0:Di[255+t[e-4*n]-a]<=r&&Di[255+a-o]<=r&&Di[255+o-s]<=r&&Di[255+h-u]<=r&&Di[255+u-c]<=r&&Di[255+c-l]<=r}function je(t,e,n,i){var r=2*i+1;for(i=0;16>i;++i)Be(t,e+i,n,r)&&Fe(t,e+i,n)}function Ve(t,e,n,i){var r=2*i+1;for(i=0;16>i;++i)Be(t,e+i*n,1,r)&&Fe(t,e+i*n,1)}function He(t,e,n,i){var r;for(r=3;0<r;--r)je(t,e+=4*n,n,i)}function Ge(t,e,n,i){var r;for(r=3;0<r;--r)Ve(t,e+=4,n,i)}function We(t,e,n,i,r,a,o,s){for(a=2*a+1;0<r--;){if(Ue(t,e,n,a,o))if(Oe(t,e,n,s))Fe(t,e,n);else{var l=t,c=e,u=n,h=l[c-2*u],d=l[c-u],p=l[c+0],f=l[c+u],m=l[c+2*u],g=27*(v=Li[1020+3*(p-d)+Li[1020+h-f]])+63>>7,y=18*v+63>>7,v=9*v+63>>7;l[c-3*u]=Ri[255+l[c-3*u]+v],l[c-2*u]=Ri[255+h+y],l[c-u]=Ri[255+d+g],l[c+0]=Ri[255+p-g],l[c+u]=Ri[255+f-y],l[c+2*u]=Ri[255+m-v]}e+=i}}function qe(t,e,n,i,r,a,o,s){for(a=2*a+1;0<r--;){if(Ue(t,e,n,a,o))if(Oe(t,e,n,s))Fe(t,e,n);else{var l=t,c=e,u=n,h=l[c-u],d=l[c+0],p=l[c+u],f=ki[112+(4+(m=3*(d-h))>>3)],m=ki[112+(m+3>>3)],g=f+1>>1;l[c-2*u]=Ri[255+l[c-2*u]+g],l[c-u]=Ri[255+h+m],l[c+0]=Ri[255+d-f],l[c+u]=Ri[255+p-g]}e+=i}}function Ze(t,e,n,i,r,a){We(t,e,n,1,16,i,r,a)}function Xe(t,e,n,i,r,a){We(t,e,1,n,16,i,r,a)}function Ye(t,e,n,i,r,a){var o;for(o=3;0<o;--o)qe(t,e+=4*n,n,1,16,i,r,a)}function Ke(t,e,n,i,r,a){var o;for(o=3;0<o;--o)qe(t,e+=4,1,n,16,i,r,a)}function Je(t,e,n,i,r,a,o,s){We(t,e,r,1,8,a,o,s),We(n,i,r,1,8,a,o,s)}function $e(t,e,n,i,r,a,o,s){We(t,e,1,r,8,a,o,s),We(n,i,1,r,8,a,o,s)}function Qe(t,e,n,i,r,a,o,s){qe(t,e+4*r,r,1,8,a,o,s),qe(n,i+4*r,r,1,8,a,o,s)}function tn(t,e,n,i,r,a,o,s){qe(t,e+4,1,r,8,a,o,s),qe(n,i+4,1,r,8,a,o,s)}function en(){this.ba=new ot,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new lt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function rn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function an(){this.ua=0,this.Wa=new N,this.vb=new N,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new p,this.yc=new h}function on(){this.xb=this.a=0,this.l=new qt,this.ca=new ot,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new x,this.Pb=0,this.wd=new x,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new an,this.ab=0,this.gc=o(4,rn),this.Oc=0}function sn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new qt,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ln(t,e,n,i,r,a,o){for(t=null==t?0:t[e+0],e=0;e<o;++e)r[a+e]=t+n[i+e]&255,t=r[a+e]}function cn(t,e,n,i,r,a,o){var s;if(null==t)ln(null,null,n,i,r,a,o);else for(s=0;s<o;++s)r[a+s]=t[e+s]+n[i+s]&255}function un(t,e,n,i,r,a,o){if(null==t)ln(null,null,n,i,r,a,o);else{var s,l=t[e+0],c=l,u=l;for(s=0;s<o;++s)c=u+(l=t[e+s])-c,u=n[i+s]+(-256&c?0>c?0:255:c)&255,c=l,r[a+s]=u}}function hn(t,n,r,o){var s=n.width,l=n.o;if(e(null!=t&&null!=n),0>r||0>=o||r+o>l)return null;if(!t.Cc){if(null==t.ga){var c;if(t.ga=new sn,(c=null==t.ga)||(c=n.width*n.o,e(0==t.Gb.length),t.Gb=a(c),t.Uc=0,null==t.Gb?c=0:(t.mb=t.Gb,t.nb=t.Uc,t.rc=null,c=1),c=!c),!c){c=t.ga;var u=t.Fa,h=t.P,d=t.qc,p=t.mb,f=t.nb,m=h+1,g=d-1,v=c.l;if(e(null!=u&&null!=p&&null!=n),mr[0]=null,mr[1]=ln,mr[2]=cn,mr[3]=un,c.ca=p,c.tb=f,c.c=n.width,c.i=n.height,e(0<c.c&&0<c.i),1>=d)n=0;else if(c.$a=3&u[h+0],c.Z=u[h+0]>>2&3,c.Lc=u[h+0]>>4&3,h=u[h+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||h)n=0;else if(v.put=pt,v.ac=dt,v.bc=ft,v.ma=c,v.width=n.width,v.height=n.height,v.Da=n.Da,v.v=n.v,v.va=n.va,v.j=n.j,v.o=n.o,c.$a)t:{e(1==c.$a),n=Ct();e:for(;;){if(null==n){n=0;break t}if(e(null!=c),c.mc=n,n.c=c.c,n.i=c.i,n.l=c.l,n.l.ma=c,n.l.width=c.c,n.l.height=c.i,n.a=0,y(n.m,u,m,g),!Pt(c.c,c.i,1,n,null))break e;if(1==n.ab&&3==n.gc[0].hc&&St(n.s)?(c.ic=1,u=n.c*n.i,n.Ta=null,n.Ua=0,n.V=a(u),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(c.ic=0,n=It(n,c.c)),!n)break e;n=1;break t}c.mc=null,n=0}else n=g>=c.c*c.i;c=!n}if(c)return null;1!=t.ga.Lc?t.Ga=0:o=l-r}e(null!=t.ga),e(r+o<=l);t:{if(n=(u=t.ga).c,l=u.l.o,0==u.$a){if(m=t.rc,g=t.Vc,v=t.Fa,h=t.P+1+r*n,d=t.mb,p=t.nb+r*n,e(h<=t.P+t.qc),0!=u.Z)for(e(null!=mr[u.Z]),c=0;c<o;++c)mr[u.Z](m,g,v,h,d,p,n),m=d,g=p,p+=n,h+=n;else for(c=0;c<o;++c)i(d,p,v,h,n),m=d,g=p,p+=n,h+=n;t.rc=m,t.Vc=g}else{if(e(null!=u.mc),n=r+o,e(null!=(c=u.mc)),e(n<=c.i),c.C>=n)n=1;else if(u.ic||gn(),u.ic){u=c.V,m=c.Ba,g=c.c;var _=c.i,b=(v=1,h=c.$/g,d=c.$%g,p=c.m,f=c.s,c.$),x=g*_,w=g*n,M=f.wc,A=b<w?bt(f,d,h):null;e(b<=x),e(n<=_),e(St(f));e:for(;;){for(;!p.h&&b<w;){if(d&M||(A=bt(f,d,h)),e(null!=A),T(p),256>(_=vt(A.G[0],A.H[0],p)))u[m+b]=_,++b,++d>=g&&(d=0,++h<=n&&!(h%16)&&Tt(c,h));else{if(!(280>_)){v=0;break e}_=gt(_-256,p);var E,C=vt(A.G[4],A.H[4],p);if(T(p),!(b>=(C=yt(g,C=gt(C,p)))&&x-b>=_)){v=0;break e}for(E=0;E<_;++E)u[m+b+E]=u[m+b+E-C];for(b+=_,d+=_;d>=g;)d-=g,++h<=n&&!(h%16)&&Tt(c,h);b<w&&d&M&&(A=bt(f,d,h))}e(p.h==S(p))}Tt(c,h>n?n:h);break e}!v||p.h&&b<x?(v=0,c.a=p.h?5:3):c.$=b,n=v}else n=At(c,c.V,c.Ba,c.c,c.i,n,Lt);if(!n){o=0;break t}}r+o>=l&&(t.Cc=1),o=1}if(!o)return null;if(t.Cc&&(null!=(o=t.ga)&&(o.mc=null),t.ga=null,0<t.Ga))return alert("todo:WebPDequantizeLevels"),null}return t.nb+r*s}function dn(t,e,n,i,r,a){for(;0<r--;){var o,s=t,l=e+(n?1:0),c=t,u=e+(n?0:3);for(o=0;o<i;++o){var h=c[u+4*o];255!=h&&(h*=32897,s[l+4*o+0]=s[l+4*o+0]*h>>23,s[l+4*o+1]=s[l+4*o+1]*h>>23,s[l+4*o+2]=s[l+4*o+2]*h>>23)}e+=a}}function pn(t,e,n,i,r){for(;0<i--;){var a;for(a=0;a<n;++a){var o=t[e+2*a+0],s=15&(c=t[e+2*a+1]),l=4369*s,c=(240&c|c>>4)*l>>16;t[e+2*a+0]=(240&o|o>>4)*l>>16&240|(15&o|o<<4)*l>>16>>4&15,t[e+2*a+1]=240&c|s}e+=r}}function fn(t,e,n,i,r,a,o,s){var l,c,u=255;for(c=0;c<r;++c){for(l=0;l<i;++l){var h=t[e+l];a[o+4*l]=h,u&=h}e+=n,o+=s}return 255!=u}function mn(t,e,n,i,r){var a;for(a=0;a<r;++a)n[i+a]=t[e+a]>>8}function gn(){wi=dn,Si=pn,Mi=fn,Ti=mn}function yn(n,i,r){t[n]=function(t,n,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_){var b,x=_-1>>1,w=s[l+0]|c[u+0]<<16,S=h[d+0]|p[f+0]<<16;e(null!=t);var M=3*w+S+131074>>2;for(i(t[n+0],255&M,M>>16,m,g),null!=a&&(M=3*S+w+131074>>2,i(a[o+0],255&M,M>>16,y,v)),b=1;b<=x;++b){var T=s[l+b]|c[u+b]<<16,A=h[d+b]|p[f+b]<<16,E=w+T+S+A+524296,C=E+2*(T+S)>>3;M=C+w>>1,w=(E=E+2*(w+A)>>3)+T>>1,i(t[n+2*b-1],255&M,M>>16,m,g+(2*b-1)*r),i(t[n+2*b-0],255&w,w>>16,m,g+(2*b-0)*r),null!=a&&(M=E+S>>1,w=C+A>>1,i(a[o+2*b-1],255&M,M>>16,y,v+(2*b-1)*r),i(a[o+2*b+0],255&w,w>>16,y,v+(2*b+0)*r)),w=T,S=A}1&_||(M=3*w+S+131074>>2,i(t[n+_-1],255&M,M>>16,m,g+(_-1)*r),null!=a&&(M=3*S+w+131074>>2,i(a[o+_-1],255&M,M>>16,y,v+(_-1)*r)))}}function vn(){gr[Ni]=yr,gr[zi]=_r,gr[Fi]=vr,gr[Oi]=br,gr[Bi]=xr,gr[Ui]=wr,gr[ji]=Sr,gr[Vi]=_r,gr[Hi]=br,gr[Gi]=xr,gr[Wi]=wr}function _n(t){return t&~Pr?0>t?0:255:t>>Cr}function bn(t,e){return _n((19077*t>>8)+(26149*e>>8)-14234)}function xn(t,e,n){return _n((19077*t>>8)-(6419*e>>8)-(13320*n>>8)+8708)}function wn(t,e){return _n((19077*t>>8)+(33050*e>>8)-17685)}function Sn(t,e,n,i,r){i[r+0]=bn(t,n),i[r+1]=xn(t,e,n),i[r+2]=wn(t,e)}function Mn(t,e,n,i,r){i[r+0]=wn(t,e),i[r+1]=xn(t,e,n),i[r+2]=bn(t,n)}function Tn(t,e,n,i,r){var a=xn(t,e,n);e=a<<3&224|wn(t,e)>>3,i[r+0]=248&bn(t,n)|a>>5,i[r+1]=e}function An(t,e,n,i,r){var a=240&wn(t,e)|15;i[r+0]=240&bn(t,n)|xn(t,e,n)>>4,i[r+1]=a}function En(t,e,n,i,r){i[r+0]=255,Sn(t,e,n,i,r+1)}function Cn(t,e,n,i,r){Mn(t,e,n,i,r),i[r+3]=255}function Pn(t,e,n,i,r){Sn(t,e,n,i,r),i[r+3]=255}function Wt(t,e){return 0>t?0:t>e?e:t}function In(e,n,i){t[e]=function(t,e,r,a,o,s,l,c,u){for(var h=c+(-2&u)*i;c!=h;)n(t[e+0],r[a+0],o[s+0],l,c),n(t[e+1],r[a+0],o[s+0],l,c+i),e+=2,++a,++s,c+=2*i;1&u&&n(t[e+0],r[a+0],o[s+0],l,c)}}function Ln(t,e,n){return 0==n?0==t?0==e?6:5:0==e?4:0:n}function kn(t,e,n,i,r){switch(t>>>30){case 3:ai(e,n,i,r,0);break;case 2:oi(e,n,i,r);break;case 1:li(e,n,i,r)}}function Rn(t,e){var n,a,o=e.M,s=e.Nb,l=t.oc,c=t.pc+40,u=t.oc,h=t.pc+584,d=t.oc,p=t.pc+600;for(n=0;16>n;++n)l[c+32*n-1]=129;for(n=0;8>n;++n)u[h+32*n-1]=129,d[p+32*n-1]=129;for(0<o?l[c-1-32]=u[h-1-32]=d[p-1-32]=129:(r(l,c-32-1,127,21),r(u,h-32-1,127,9),r(d,p-32-1,127,9)),a=0;a<t.za;++a){var f=e.ya[e.aa+a];if(0<a){for(n=-1;16>n;++n)i(l,c+32*n-4,l,c+32*n+12,4);for(n=-1;8>n;++n)i(u,h+32*n-4,u,h+32*n+4,4),i(d,p+32*n-4,d,p+32*n+4,4)}var m=t.Gd,g=t.Hd+a,y=f.ad,v=f.Hc;if(0<o&&(i(l,c-32,m[g].y,0,16),i(u,h-32,m[g].f,0,8),i(d,p-32,m[g].ea,0,8)),f.Za){var _=l,b=c-32+16;for(0<o&&(a>=t.za-1?r(_,b,m[g].y[15],4):i(_,b,m[g+1].y,0,4)),n=0;4>n;n++)_[b+128+n]=_[b+256+n]=_[b+384+n]=_[b+0+n];for(n=0;16>n;++n,v<<=2)_=l,b=c+Fr[n],hr[f.Ob[n]](_,b),kn(v,y,16*+n,_,b)}else if(_=Ln(a,o,f.Ob[0]),ur[_](l,c),0!=v)for(n=0;16>n;++n,v<<=2)kn(v,y,16*+n,l,c+Fr[n]);for(n=f.Gc,_=Ln(a,o,f.Dd),dr[_](u,h),dr[_](d,p),v=y,_=u,b=h,255&(f=0|n)&&(170&f?si(v,256,_,b):ci(v,256,_,b)),f=d,v=p,255&(n>>=8)&&(170&n?si(y,320,f,v):ci(y,320,f,v)),o<t.Ub-1&&(i(m[g].y,0,l,c+480,16),i(m[g].f,0,u,h+224,8),i(m[g].ea,0,d,p+224,8)),n=8*s*t.B,m=t.sa,g=t.ta+16*a+16*s*t.R,y=t.qa,f=t.ra+8*a+n,v=t.Ha,_=t.Ia+8*a+n,n=0;16>n;++n)i(m,g+n*t.R,l,c+32*n,16);for(n=0;8>n;++n)i(y,f+n*t.B,u,h+32*n,8),i(v,_+n*t.B,d,p+32*n,8)}}function Dn(t,i,r,a,o,s,l,c,u){var h=[0],d=[0],p=0,f=null!=u?u.kd:0,m=null!=u?u:new nn;if(null==t||12>r)return 7;m.data=t,m.w=i,m.ha=r,i=[i],r=[r],m.gb=[m.gb];t:{var g=i,v=r,_=m.gb;if(e(null!=t),e(null!=v),e(null!=_),_[0]=0,12<=v[0]&&!n(t,g[0],"RIFF")){if(n(t,g[0]+8,"WEBP")){_=3;break t}var b=k(t,g[0]+4);if(12>b||4294967286<b){_=3;break t}if(f&&b>v[0]-8){_=7;break t}_[0]=b,g[0]+=12,v[0]-=12}_=0}if(0!=_)return _;for(b=0<m.gb[0],r=r[0];;){t:{var w=t;v=i,_=r;var S=h,M=d,T=g=[0];if((C=p=[p])[0]=0,8>_[0])_=7;else{if(!n(w,v[0],"VP8X")){if(10!=k(w,v[0]+4)){_=3;break t}if(18>_[0]){_=7;break t}var A=k(w,v[0]+8),E=1+L(w,v[0]+12);if(2147483648<=E*(w=1+L(w,v[0]+15))){_=3;break t}null!=T&&(T[0]=A),null!=S&&(S[0]=E),null!=M&&(M[0]=w),v[0]+=18,_[0]-=18,C[0]=1}_=0}}if(p=p[0],g=g[0],0!=_)return _;if(v=!!(2&g),!b&&p)return 3;if(null!=s&&(s[0]=!!(16&g)),null!=l&&(l[0]=v),null!=c&&(c[0]=0),l=h[0],g=d[0],p&&v&&null==u){_=0;break}if(4>r){_=7;break}if(b&&p||!b&&!p&&!n(t,i[0],"ALPH")){r=[r],m.na=[m.na],m.P=[m.P],m.Sa=[m.Sa];t:{A=t,_=i,b=r;var C=m.gb;S=m.na,M=m.P,T=m.Sa,E=22,e(null!=A),e(null!=b),w=_[0];var P=b[0];for(e(null!=S),e(null!=T),S[0]=null,M[0]=null,T[0]=0;;){if(_[0]=w,b[0]=P,8>P){_=7;break t}var I=k(A,w+4);if(4294967286<I){_=3;break t}var R=8+I+1&-2;if(E+=R,0<C&&E>C){_=3;break t}if(!n(A,w,"VP8 ")||!n(A,w,"VP8L")){_=0;break t}if(P[0]<R){_=7;break t}n(A,w,"ALPH")||(S[0]=A,M[0]=w+8,T[0]=I),w+=R,P-=R}}if(r=r[0],m.na=m.na[0],m.P=m.P[0],m.Sa=m.Sa[0],0!=_)break}r=[r],m.Ja=[m.Ja],m.xa=[m.xa];t:if(C=t,_=i,b=r,S=m.gb[0],M=m.Ja,T=m.xa,A=_[0],w=!n(C,A,"VP8 "),E=!n(C,A,"VP8L"),e(null!=C),e(null!=b),e(null!=M),e(null!=T),8>b[0])_=7;else{if(w||E){if(C=k(C,A+4),12<=S&&C>S-12){_=3;break t}if(f&&C>b[0]-8){_=7;break t}M[0]=C,_[0]+=8,b[0]-=8,T[0]=E}else T[0]=5<=b[0]&&47==C[A+0]&&!(C[A+4]>>5),M[0]=b[0];_=0}if(r=r[0],m.Ja=m.Ja[0],m.xa=m.xa[0],i=i[0],0!=_)break;if(4294967286<m.Ja)return 3;if(null==c||v||(c[0]=m.xa?2:1),l=[l],g=[g],m.xa){if(5>r){_=7;break}c=l,f=g,v=s,null==t||5>r?t=0:5<=r&&47==t[i+0]&&!(t[i+4]>>5)?(b=[0],C=[0],S=[0],y(M=new x,t,i,r),mt(M,b,C,S)?(null!=c&&(c[0]=b[0]),null!=f&&(f[0]=C[0]),null!=v&&(v[0]=S[0]),t=1):t=0):t=0}else{if(10>r){_=7;break}c=g,null==t||10>r||!Yt(t,i+3,r-3)?t=0:(f=t[i+0]|t[i+1]<<8|t[i+2]<<16,v=16383&(t[i+7]<<8|t[i+6]),t=16383&(t[i+9]<<8|t[i+8]),1&f||3<(f>>1&7)||!(f>>4&1)||f>>5>=m.Ja||!v||!t?t=0:(l&&(l[0]=v),c&&(c[0]=t),t=1))}if(!t)return 3;if(l=l[0],g=g[0],p&&(h[0]!=l||d[0]!=g))return 3;null!=u&&(u[0]=m,u.offset=i-u.w,e(4294967286>i-u.w),e(u.offset==u.ha-r));break}return 0==_||7==_&&p&&null==u?(null!=s&&(s[0]|=null!=m.na&&0<m.na.length),null!=a&&(a[0]=l),null!=o&&(o[0]=g),0):_}function Nn(t,e,n){var i=e.width,r=e.height,a=0,o=0,s=i,l=r;if(e.Da=null!=t&&0<t.Da,e.Da&&(s=t.cd,l=t.bd,a=t.v,o=t.j,11>n||(a&=-2,o&=-2),0>a||0>o||0>=s||0>=l||a+s>i||o+l>r))return 0;if(e.v=a,e.j=o,e.va=a+s,e.o=o+l,e.U=s,e.T=l,e.da=null!=t&&0<t.da,e.da){if(!z(s,l,n=[t.ib],a=[t.hb]))return 0;e.ib=n[0],e.hb=a[0]}return e.ob=null!=t&&t.ob,e.Kb=null==t||!t.Sd,e.da&&(e.ob=e.ib<3*i/4&&e.hb<3*r/4,e.Kb=0),1}function zn(t){if(null==t)return 2;if(11>t.S){var e=t.f.RGBA;e.fb+=(t.height-1)*e.A,e.A=-e.A}else e=t.f.kb,t=t.height,e.O+=(t-1)*e.fa,e.fa=-e.fa,e.N+=(t-1>>1)*e.Ab,e.Ab=-e.Ab,e.W+=(t-1>>1)*e.Db,e.Db=-e.Db,null!=e.F&&(e.J+=(t-1)*e.lb,e.lb=-e.lb);return 0}function Fn(t,e,n,i){if(null==i||0>=t||0>=e)return 2;if(null!=n){if(n.Da){var r=n.cd,o=n.bd,s=-2&n.v,l=-2&n.j;if(0>s||0>l||0>=r||0>=o||s+r>t||l+o>e)return 2;t=r,e=o}if(n.da){if(!z(t,e,r=[n.ib],o=[n.hb]))return 2;t=r[0],e=o[0]}}i.width=t,i.height=e;t:{var c=i.width,u=i.height;if(t=i.S,0>=c||0>=u||!(t>=Ni&&13>t))t=2;else{if(0>=i.Rd&&null==i.sd){s=o=r=e=0;var h=(l=c*Ur[t])*u;if(11>t||(o=(u+1)/2*(e=(c+1)/2),12==t&&(s=(r=c)*u)),null==(u=a(h+2*o+s))){t=1;break t}i.sd=u,11>t?((c=i.f.RGBA).eb=u,c.fb=0,c.A=l,c.size=h):((c=i.f.kb).y=u,c.O=0,c.fa=l,c.Fd=h,c.f=u,c.N=0+h,c.Ab=e,c.Cd=o,c.ea=u,c.W=0+h+o,c.Db=e,c.Ed=o,12==t&&(c.F=u,c.J=0+h+2*o),c.Tc=s,c.lb=r)}if(e=1,r=i.S,o=i.width,s=i.height,r>=Ni&&13>r)if(11>r)t=i.f.RGBA,e&=(l=Math.abs(t.A))*(s-1)+o<=t.size,e&=l>=o*Ur[r],e&=null!=t.eb;else{t=i.f.kb,l=(o+1)/2,h=(s+1)/2,c=Math.abs(t.fa),u=Math.abs(t.Ab);var d=Math.abs(t.Db),p=Math.abs(t.lb),f=p*(s-1)+o;e&=c*(s-1)+o<=t.Fd,e&=u*(h-1)+l<=t.Cd,e=(e&=d*(h-1)+l<=t.Ed)&c>=o&u>=l&d>=l,e&=null!=t.y,e&=null!=t.f,e&=null!=t.ea,12==r&&(e&=p>=o,e&=f<=t.Tc,e&=null!=t.F)}else e=0;t=e?0:2}}return 0!=t||null!=n&&n.fd&&(t=zn(i)),t}var On=64,Bn=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Un=24,jn=32,Vn=8,Hn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];B("Predictor0","PredictorAdd0"),t.Predictor0=function(){return 4278190080},t.Predictor1=function(t){return t},t.Predictor2=function(t,e,n){return e[n+0]},t.Predictor3=function(t,e,n){return e[n+1]},t.Predictor4=function(t,e,n){return e[n-1]},t.Predictor5=function(t,e,n){return j(j(t,e[n+1]),e[n+0])},t.Predictor6=function(t,e,n){return j(t,e[n-1])},t.Predictor7=function(t,e,n){return j(t,e[n+0])},t.Predictor8=function(t,e,n){return j(e[n-1],e[n+0])},t.Predictor9=function(t,e,n){return j(e[n+0],e[n+1])},t.Predictor10=function(t,e,n){return j(j(t,e[n-1]),j(e[n+0],e[n+1]))},t.Predictor11=function(t,e,n){var i=e[n+0];return 0>=G(i>>24&255,t>>24&255,(e=e[n-1])>>24&255)+G(i>>16&255,t>>16&255,e>>16&255)+G(i>>8&255,t>>8&255,e>>8&255)+G(255&i,255&t,255&e)?i:t},t.Predictor12=function(t,e,n){var i=e[n+0];return(V((t>>24&255)+(i>>24&255)-((e=e[n-1])>>24&255))<<24|V((t>>16&255)+(i>>16&255)-(e>>16&255))<<16|V((t>>8&255)+(i>>8&255)-(e>>8&255))<<8|V((255&t)+(255&i)-(255&e)))>>>0},t.Predictor13=function(t,e,n){var i=e[n-1];return(H((t=j(t,e[n+0]))>>24&255,i>>24&255)<<24|H(t>>16&255,i>>16&255)<<16|H(t>>8&255,i>>8&255)<<8|H(255&t,255&i))>>>0};var Gn=t.PredictorAdd0;t.PredictorAdd1=W,B("Predictor2","PredictorAdd2"),B("Predictor3","PredictorAdd3"),B("Predictor4","PredictorAdd4"),B("Predictor5","PredictorAdd5"),B("Predictor6","PredictorAdd6"),B("Predictor7","PredictorAdd7"),B("Predictor8","PredictorAdd8"),B("Predictor9","PredictorAdd9"),B("Predictor10","PredictorAdd10"),B("Predictor11","PredictorAdd11"),B("Predictor12","PredictorAdd12"),B("Predictor13","PredictorAdd13");var Wn=t.PredictorAdd2;Y("ColorIndexInverseTransform","MapARGB","32b",function(t){return t>>8&255},function(t){return t}),Y("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(t){return t},function(t){return t>>8&255});var qn,Zn=t.ColorIndexInverseTransform,Xn=t.MapARGB,Yn=t.VP8LColorIndexInverseTransformAlpha,Kn=t.MapAlpha,Jn=t.VP8LPredictorsAdd=[];Jn.length=16,(t.VP8LPredictors=[]).length=16,(t.VP8LPredictorsAdd_C=[]).length=16,(t.VP8LPredictors_C=[]).length=16;var $n,Qn,ti,ei,ni,ii,ri,ai,oi,si,li,ci,ui,hi,di,pi,fi,mi,gi,yi,vi,_i,bi,xi,wi,Si,Mi,Ti,Ai=a(511),Ei=a(2041),Ci=a(225),Pi=a(767),Ii=0,Li=Ei,ki=Ci,Ri=Pi,Di=Ai,Ni=0,zi=1,Fi=2,Oi=3,Bi=4,Ui=5,ji=6,Vi=7,Hi=8,Gi=9,Wi=10,qi=[2,3,7],Zi=[3,3,11],Xi=[280,256,256,256,40],Yi=[0,1,1,1,0],Ki=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Ji=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],$i=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Qi=8,tr=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],er=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],nr=null,ir=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],rr=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ar=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],or=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],sr=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],lr=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],cr=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ur=[],hr=[],dr=[],pr=1,fr=2,mr=[],gr=[];yn("UpsampleRgbLinePair",Sn,3),yn("UpsampleBgrLinePair",Mn,3),yn("UpsampleRgbaLinePair",Pn,4),yn("UpsampleBgraLinePair",Cn,4),yn("UpsampleArgbLinePair",En,4),yn("UpsampleRgba4444LinePair",An,2),yn("UpsampleRgb565LinePair",Tn,2);var yr=t.UpsampleRgbLinePair,vr=t.UpsampleBgrLinePair,_r=t.UpsampleRgbaLinePair,br=t.UpsampleBgraLinePair,xr=t.UpsampleArgbLinePair,wr=t.UpsampleRgba4444LinePair,Sr=t.UpsampleRgb565LinePair,Mr=16,Tr=1<<Mr-1,Ar=-227,Er=482,Cr=6,Pr=(256<<Cr)-1,Ir=0,Lr=a(256),kr=a(256),Rr=a(256),Dr=a(256),Nr=a(Er-Ar),zr=a(Er-Ar);In("YuvToRgbRow",Sn,3),In("YuvToBgrRow",Mn,3),In("YuvToRgbaRow",Pn,4),In("YuvToBgraRow",Cn,4),In("YuvToArgbRow",En,4),In("YuvToRgba4444Row",An,2),In("YuvToRgb565Row",Tn,2);var Fr=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Or=[0,2,8],Br=[8,7,6,4,4,2,2,2,1,1,1,1];this.WebPDecodeRGBA=function(t,n,s,l,c){var u=zi,h=new en,d=new ot;h.ba=d,d.S=u,d.width=[d.width],d.height=[d.height];var p=d.width,f=d.height,m=new st;if(null==m||null==t)var g=2;else e(null!=m),g=Dn(t,n,s,m.width,m.height,m.Pd,m.Qd,m.format,null);if(0!=g?p=0:(null!=p&&(p[0]=m.width[0]),null!=f&&(f[0]=m.height[0]),p=1),p){d.width=d.width[0],d.height=d.height[0],null!=l&&(l[0]=d.width),null!=c&&(c[0]=d.height);t:{if(l=new qt,(c=new nn).data=t,c.w=n,c.ha=s,c.kd=1,n=[0],e(null!=c),(0==(t=Dn(c.data,c.w,c.ha,null,null,null,n,null,c))||7==t)&&n[0]&&(t=4),0==(n=t)){if(e(null!=h),l.data=c.data,l.w=c.w+c.offset,l.ha=c.ha-c.offset,l.put=pt,l.ac=dt,l.bc=ft,l.ma=h,c.xa){if(null==(t=Ct())){h=1;break t}if(function(t,n){var i=[0],r=[0],a=[0];e:for(;;){if(null==t)return 0;if(null==n)return t.a=2,0;if(t.l=n,t.a=0,y(t.m,n.data,n.w,n.ha),!mt(t.m,i,r,a)){t.a=3;break e}if(t.xb=fr,n.width=i[0],n.height=r[0],!Pt(i[0],r[0],1,t,null))break e;return 1}return e(0!=t.a),0}(t,l)){if(l=0==(n=Fn(l.width,l.height,h.Oa,h.ba))){e:{l=t;n:for(;;){if(null==l){l=0;break e}if(e(null!=l.s.yc),e(null!=l.s.Ya),e(0<l.s.Wb),e(null!=(s=l.l)),e(null!=(c=s.ma)),0!=l.xb){if(l.ca=c.ba,l.tb=c.tb,e(null!=l.ca),!Nn(c.Oa,s,Oi)){l.a=2;break n}if(!It(l,s.width))break n;if(s.da)break n;if((s.da||it(l.ca.S))&&gn(),11>l.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=l.ca.f.kb.F&&gn()),l.Pb&&0<l.s.ua&&null==l.s.vb.X&&!R(l.s.vb,l.s.Wa.Xa)){l.a=1;break n}l.xb=0}if(!At(l,l.V,l.Ba,l.c,l.i,s.o,wt))break n;c.Dc=l.Ma,l=1;break e}e(0!=l.a),l=0}l=!l}l&&(n=t.a)}else n=t.a}else{if(null==(t=new Zt)){h=1;break t}if(t.Fa=c.na,t.P=c.P,t.qc=c.Sa,Kt(t,l)){if(0==(n=Fn(l.width,l.height,h.Oa,h.ba))){if(t.Aa=0,s=h.Oa,e(null!=(c=t)),null!=s){if(0<(p=0>(p=s.Md)?0:100<p?255:255*p/100)){for(f=m=0;4>f;++f)12>(g=c.pb[f]).lc&&(g.ia=p*Br[0>g.lc?0:g.lc]>>3),m|=g.ia;m&&(alert("todo:VP8InitRandom"),c.ia=1)}c.Ga=s.Id,100<c.Ga?c.Ga=100:0>c.Ga&&(c.Ga=0)}(function(t,n){if(null==t)return 0;if(null==n)return Xt(t,2,"NULL VP8Io parameter in VP8Decode().");if(!t.cb&&!Kt(t,n))return 0;if(e(t.cb),null==n.ac||n.ac(n)){n.ob&&(t.L=0);var s=Or[t.L];if(2==t.L?(t.yb=0,t.zb=0):(t.yb=n.v-s>>4,t.zb=n.j-s>>4,0>t.yb&&(t.yb=0),0>t.zb&&(t.zb=0)),t.Va=n.o+15+s>>4,t.Hb=n.va+15+s>>4,t.Hb>t.za&&(t.Hb=t.za),t.Va>t.Ub&&(t.Va=t.Ub),0<t.L){var l=t.ed;for(s=0;4>s;++s){var c;if(t.Qa.Cb){var u=t.Qa.Lb[s];t.Qa.Fb||(u+=l.Tb)}else u=l.Tb;for(c=0;1>=c;++c){var h=t.gd[s][c],d=u;if(l.Pc&&(d+=l.vd[0],c&&(d+=l.od[0])),0<(d=0>d?0:63<d?63:d)){var p=d;0<l.wb&&(p=4<l.wb?p>>2:p>>1)>9-l.wb&&(p=9-l.wb),1>p&&(p=1),h.dd=p,h.tc=2*d+p,h.ld=40<=d?2:15<=d?1:0}else h.tc=0;h.La=c}}}s=0}else Xt(t,6,"Frame setup failed"),s=t.a;if(s=0==s){if(s){t.$c=0,0<t.Aa||(t.Ic=1);e:{s=t.Ic,l=4*(p=t.za);var f=32*p,m=p+1,g=0<t.L?p*(0<t.Aa?2:1):0,y=(2==t.Aa?2:1)*p;if((h=l+832+(c=3*(16*s+Or[t.L])/2*f)+(u=null!=t.Fa&&0<t.Fa.length?t.Kc.c*t.Kc.i:0))!=h)s=0;else{if(h>t.Vb){if(t.Vb=0,t.Ec=a(h),t.Fc=0,null==t.Ec){s=Xt(t,1,"no memory during frame initialization.");break e}t.Vb=h}h=t.Ec,d=t.Fc,t.Ac=h,t.Bc=d,d+=l,t.Gd=o(f,Ht),t.Hd=0,t.rb=o(m+1,Bt),t.sb=1,t.wa=g?o(g,Ot):null,t.Y=0,t.D.Nb=0,t.D.wa=t.wa,t.D.Y=t.Y,0<t.Aa&&(t.D.Y+=p),e(!0),t.oc=h,t.pc=d,d+=832,t.ya=o(y,jt),t.aa=0,t.D.ya=t.ya,t.D.aa=t.aa,2==t.Aa&&(t.D.aa+=p),t.R=16*p,t.B=8*p,p=(f=Or[t.L])*t.R,f=f/2*t.B,t.sa=h,t.ta=d+p,t.qa=t.sa,t.ra=t.ta+16*s*t.R+f,t.Ha=t.qa,t.Ia=t.ra+8*s*t.B+f,t.$c=0,d+=c,t.mb=u?h:null,t.nb=u?d:null,e(d+u<=t.Fc+t.Vb),$t(t),r(t.Ac,t.Bc,0,l),s=1}}if(s){if(n.ka=0,n.y=t.sa,n.O=t.ta,n.f=t.qa,n.N=t.ra,n.ea=t.Ha,n.Vd=t.Ia,n.fa=t.R,n.Rc=t.B,n.F=null,n.J=0,!Ii){for(s=-255;255>=s;++s)Ai[255+s]=0>s?-s:s;for(s=-1020;1020>=s;++s)Ei[1020+s]=-128>s?-128:127<s?127:s;for(s=-112;112>=s;++s)Ci[112+s]=-16>s?-16:15<s?15:s;for(s=-255;510>=s;++s)Pi[255+s]=0>s?0:255<s?255:s;Ii=1}ri=le,ai=re,si=ae,li=oe,ci=se,oi=ie,ui=Ze,hi=Xe,di=Je,pi=$e,fi=Ye,mi=Ke,gi=Qe,yi=tn,vi=je,_i=Ve,bi=He,xi=Ge,hr[0]=Se,hr[1]=ue,hr[2]=xe,hr[3]=we,hr[4]=Me,hr[5]=Ae,hr[6]=Te,hr[7]=Ee,hr[8]=Pe,hr[9]=Ce,ur[0]=ge,ur[1]=de,ur[2]=pe,ur[3]=fe,ur[4]=ye,ur[5]=ve,ur[6]=_e,dr[0]=Re,dr[1]=he,dr[2]=Ie,dr[3]=Le,dr[4]=Ne,dr[5]=De,dr[6]=ze,s=1}else s=0}s&&(s=function(t,n){for(t.M=0;t.M<t.Va;++t.M){var o,s=t.Jc[t.M&t.Xb],l=t.m,c=t;for(o=0;o<c.za;++o){var u=l,h=c,d=h.Ac,p=h.Bc+4*o,f=h.zc,m=h.ya[h.aa+o];if(h.Qa.Bb?m.$b=C(u,h.Pa.jb[0])?2+C(u,h.Pa.jb[2]):C(u,h.Pa.jb[1]):m.$b=0,h.kc&&(m.Ad=C(u,h.Bd)),m.Za=!C(u,145)+0,m.Za){var g=m.Ob,y=0;for(h=0;4>h;++h){var v,_=f[0+h];for(v=0;4>v;++v){_=sr[d[p+v]][_];for(var b=ar[C(u,_[0])];0<b;)b=ar[2*b+C(u,_[b])];_=-b,d[p+v]=_}i(g,y,d,p,4),y+=4,f[0+h]=_}}else _=C(u,156)?C(u,128)?1:3:C(u,163)?2:0,m.Ob[0]=_,r(d,p,_,4),r(f,0,_,4);m.Dd=C(u,142)?C(u,114)?C(u,183)?1:3:2:0}if(c.m.Ka)return Xt(t,7,"Premature end-of-partition0 encountered.");for(;t.ja<t.za;++t.ja){if(c=s,u=(l=t).rb[l.sb-1],d=l.rb[l.sb+l.ja],o=l.ya[l.aa+l.ja],p=l.kc?o.Ad:0)u.la=d.la=0,o.Za||(u.Na=d.Na=0),o.Hc=0,o.Gc=0,o.ia=0;else{var x,w;if(u=d,d=c,p=l.Pa.Xc,f=l.ya[l.aa+l.ja],m=l.pb[f.$b],h=f.ad,g=0,y=l.rb[l.sb-1],_=v=0,r(h,g,0,384),f.Za)var S=0,M=p[3];else{b=a(16);var T=u.Na+y.Na;if(T=nr(d,p[1],T,m.Eb,0,b,0),u.Na=y.Na=(0<T)+0,1<T)ri(b,0,h,g);else{var A=b[0]+3>>3;for(b=0;256>b;b+=16)h[g+b]=A}S=1,M=p[0]}var E=15&u.la,P=15&y.la;for(b=0;4>b;++b){var I=1&P;for(A=w=0;4>A;++A)E=E>>1|(I=(T=nr(d,M,T=I+(1&E),m.Sc,S,h,g))>S)<<7,w=w<<2|(3<T?3:1<T?2:0!=h[g+0]),g+=16;E>>=4,P=P>>1|I<<7,v=(v<<8|w)>>>0}for(M=E,S=P>>4,x=0;4>x;x+=2){for(w=0,E=u.la>>4+x,P=y.la>>4+x,b=0;2>b;++b){for(I=1&P,A=0;2>A;++A)T=I+(1&E),E=E>>1|(I=0<(T=nr(d,p[2],T,m.Qc,0,h,g)))<<3,w=w<<2|(3<T?3:1<T?2:0!=h[g+0]),g+=16;E>>=2,P=P>>1|I<<5}_|=w<<4*x,M|=E<<4<<x,S|=(240&P)<<x}u.la=M,y.la=S,f.Hc=v,f.Gc=_,f.ia=43690&_?0:m.ia,p=!(v|_)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[o.$b][o.Za],l.wa[l.Y+l.ja].La|=!p),c.Ka)return Xt(t,7,"Premature end-of-file encountered.")}if($t(t),l=n,c=1,o=(s=t).D,u=0<s.L&&s.M>=s.zb&&s.M<=s.Va,0==s.Aa)e:{if(o.M=s.M,o.uc=u,Rn(s,o),c=1,o=(w=s.D).Nb,u=(_=Or[s.L])*s.R,d=_/2*s.B,b=16*o*s.R,A=8*o*s.B,p=s.sa,f=s.ta-u+b,m=s.qa,h=s.ra-d+A,g=s.Ha,y=s.Ia-d+A,P=0==(E=w.M),v=E>=s.Va-1,2==s.Aa&&Rn(s,w),w.uc)for(I=(T=s).D.M,e(T.D.uc),w=T.yb;w<T.Hb;++w){S=w,M=I;var L=(k=(j=T).D).Nb;x=j.R;var k=k.wa[k.Y+S],R=j.sa,D=j.ta+16*L*x+16*S,N=k.dd,z=k.tc;if(0!=z)if(e(3<=z),1==j.L)0<S&&_i(R,D,x,z+4),k.La&&xi(R,D,x,z),0<M&&vi(R,D,x,z+4),k.La&&bi(R,D,x,z);else{var F=j.B,O=j.qa,B=j.ra+8*L*F+8*S,U=j.Ha,j=j.Ia+8*L*F+8*S;L=k.ld,0<S&&(hi(R,D,x,z+4,N,L),pi(O,B,U,j,F,z+4,N,L)),k.La&&(mi(R,D,x,z,N,L),yi(O,B,U,j,F,z,N,L)),0<M&&(ui(R,D,x,z+4,N,L),di(O,B,U,j,F,z+4,N,L)),k.La&&(fi(R,D,x,z,N,L),gi(O,B,U,j,F,z,N,L))}}if(s.ia&&alert("todo:DitherRow"),null!=l.put){if(w=16*E,E=16*(E+1),P?(l.y=s.sa,l.O=s.ta+b,l.f=s.qa,l.N=s.ra+A,l.ea=s.Ha,l.W=s.Ia+A):(w-=_,l.y=p,l.O=f,l.f=m,l.N=h,l.ea=g,l.W=y),v||(E-=_),E>l.o&&(E=l.o),l.F=null,l.J=null,null!=s.Fa&&0<s.Fa.length&&w<E&&(l.J=hn(s,l,w,E-w),l.F=s.mb,null==l.F&&0==l.F.length)){c=Xt(s,3,"Could not decode alpha data.");break e}w<l.j&&(_=l.j-w,w=l.j,e(!(1&_)),l.O+=s.R*_,l.N+=s.B*(_>>1),l.W+=s.B*(_>>1),null!=l.F&&(l.J+=l.width*_)),w<E&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=w-l.j,l.U=l.va-l.v,l.T=E-w,c=l.put(l))}o+1!=s.Ic||v||(i(s.sa,s.ta-u,p,f+16*s.R,u),i(s.qa,s.ra-d,m,h+8*s.B,d),i(s.Ha,s.Ia-d,g,y+8*s.B,d))}if(!c)return Xt(t,6,"Output aborted.")}return 1}(t,n)),null!=n.bc&&n.bc(n),s&=1}return s?(t.cb=0,s):0})(t,l)||(n=t.a)}}else n=t.a}0==n&&null!=h.Oa&&h.Oa.fd&&(n=zn(h.ba))}h=n}u=0!=h?null:11>u?d.f.RGBA.eb:d.f.kb.y}else u=null;return u};var Ur=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(t,e){for(var n="",i=0;i<4;i++)n+=String.fromCharCode(t[e++]);return n}function u(t,e){return t[e+0]|t[e+1]<<8}function h(t,e){return(t[e+0]|t[e+1]<<8|t[e+2]<<16)>>>0}function d(t,e){return(t[e+0]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}new l;var p=[0],f=[0],m=[],g=new l,y=t,v=function(t,e){var n={},i=0,r=!1,a=0,o=0;if(n.frames=[],!function(t,e){for(var n=0;n<4;n++)if(t[e+n]!="RIFF".charCodeAt(n))return!0;return!1}(t,e)){for(d(t,e+=4),e+=8;e<t.length;){var s=c(t,e),l=d(t,e+=4);e+=4;var p=l+(1&l);switch(s){case"VP8 ":case"VP8L":void 0===n.frames[i]&&(n.frames[i]={}),(g=n.frames[i]).src_off=r?o:e-8,g.src_size=a+l+8,i++,r&&(r=!1,a=0,o=0);break;case"VP8X":(g=n.header={}).feature_flags=t[e];var f=e+4;g.canvas_width=1+h(t,f),f+=3,g.canvas_height=1+h(t,f),f+=3;break;case"ALPH":r=!0,a=p+8,o=e-8;break;case"ANIM":(g=n.header).bgcolor=d(t,e),f=e+4,g.loop_count=u(t,f),f+=2;break;case"ANMF":var m,g;(g=n.frames[i]={}).offset_x=2*h(t,e),e+=3,g.offset_y=2*h(t,e),e+=3,g.width=1+h(t,e),e+=3,g.height=1+h(t,e),e+=3,g.duration=h(t,e),e+=3,m=t[e++],g.dispose=1&m,g.blend=m>>1&1}"ANMF"!=s&&(e+=p)}return n}}(y,0);v.response=y,v.rgbaoutput=!0,v.dataurl=!1;var _=v.header?v.header:null,b=v.frames?v.frames:null;if(_){_.loop_counter=_.loop_count,p=[_.canvas_height],f=[_.canvas_width];for(var x=0;x<b.length&&0!=b[x].blend;x++);}var w=b[0],S=g.WebPDecodeRGBA(y,w.src_off,w.src_size,f,p);w.rgba=S,w.imgwidth=f[0],w.imgheight=p[0];for(var M=0;M<f[0]*p[0]*4;M++)m[M]=S[M];return this.width=f,this.height=p,this.data=m,this}!function(t){var e,n,i,r,a,o,s,l,c,u=function(t){return t=t||{},this.isStrokeTransparent=t.isStrokeTransparent||!1,this.strokeOpacity=t.strokeOpacity||1,this.strokeStyle=t.strokeStyle||"#000000",this.fillStyle=t.fillStyle||"#000000",this.isFillTransparent=t.isFillTransparent||!1,this.fillOpacity=t.fillOpacity||1,this.font=t.font||"10px sans-serif",this.textBaseline=t.textBaseline||"alphabetic",this.textAlign=t.textAlign||"left",this.lineWidth=t.lineWidth||1,this.lineJoin=t.lineJoin||"miter",this.lineCap=t.lineCap||"butt",this.path=t.path||[],this.transform=void 0!==t.transform?t.transform.clone():new l,this.globalCompositeOperation=t.globalCompositeOperation||"normal",this.globalAlpha=t.globalAlpha||1,this.clip_path=t.clip_path||[],this.currentPoint=t.currentPoint||new o,this.miterLimit=t.miterLimit||10,this.lastPoint=t.lastPoint||new o,this.lineDashOffset=t.lineDashOffset||0,this.lineDash=t.lineDash||[],this.margin=t.margin||[0,0,0,0],this.prevPageLastElemOffset=t.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof t.ignoreClearRect||t.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new h(this),e=this.internal.f2,n=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,o=this.internal.Point,s=this.internal.Rectangle,l=this.internal.Matrix,c=new u}]);var h=function(t){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var e=t;Object.defineProperty(this,"pdf",{get:function(){return e}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(t){n=Boolean(t)}});var i=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return i},set:function(t){i=Boolean(t)}});var r=0;Object.defineProperty(this,"posX",{get:function(){return r},set:function(t){isNaN(t)||(r=t)}});var a=0;Object.defineProperty(this,"posY",{get:function(){return a},set:function(t){isNaN(t)||(a=t)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(t){var e;"number"==typeof t?e=[t,t,t,t]:((e=new Array(4))[0]=t[0],e[1]=t.length>=2?t[1]:e[0],e[2]=t.length>=3?t[2]:e[0],e[3]=t.length>=4?t[3]:e[1]),c.margin=e}});var o=!1;Object.defineProperty(this,"autoPaging",{get:function(){return o},set:function(t){o=t}});var s=0;Object.defineProperty(this,"lastBreak",{get:function(){return s},set:function(t){s=t}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(t){l=t}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(t){t instanceof u&&(c=t)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(t){c.path=t}});var h=[];Object.defineProperty(this,"ctxStack",{get:function(){return h},set:function(t){h=t}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(t){var e;e=d(t),this.ctx.fillStyle=e.style,this.ctx.isFillTransparent=0===e.a,this.ctx.fillOpacity=e.a,this.pdf.setFillColor(e.r,e.g,e.b,{a:e.a}),this.pdf.setTextColor(e.r,e.g,e.b,{a:e.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(t){var e=d(t);this.ctx.strokeStyle=e.style,this.ctx.isStrokeTransparent=0===e.a,this.ctx.strokeOpacity=e.a,0===e.a?this.pdf.setDrawColor(255,255,255):(e.a,this.pdf.setDrawColor(e.r,e.g,e.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(t){-1!==["butt","round","square"].indexOf(t)&&(this.ctx.lineCap=t,this.pdf.setLineCap(t))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(t){isNaN(t)||(this.ctx.lineWidth=t,this.pdf.setLineWidth(t))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(t){-1!==["bevel","round","miter"].indexOf(t)&&(this.ctx.lineJoin=t,this.pdf.setLineJoin(t))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(t){isNaN(t)||(this.ctx.miterLimit=t,this.pdf.setMiterLimit(t))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(t){this.ctx.textBaseline=t}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(t){-1!==["right","end","center","left","start"].indexOf(t)&&(this.ctx.textAlign=t)}});var p=null,f=null;Object.defineProperty(this,"fontFaces",{get:function(){return f},set:function(t){p=null,f=t}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(t){var e;if(this.ctx.font=t,null!==(e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(t))){var n=e[1];e[2];var i=e[3],r=e[4];e[5];var a=e[6],o=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(r)[2];r="px"===o?Math.floor(parseFloat(r)*this.pdf.internal.scaleFactor):"em"===o?Math.floor(parseFloat(r)*this.pdf.getFontSize()):Math.floor(parseFloat(r)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(r);var s=function(t){var e,n,i=[],r=t.trim();if(""===r)return mK;if(r in eK)return[eK[r]];for(;""!==r;){switch(n=null,e=(r=iK(r)).charAt(0)){case'"':case"'":n=rK(r.substring(1),e);break;default:n=aK(r)}if(null===n)return mK;if(i.push(n[0]),""!==(r=iK(n[1]))&&","!==r.charAt(0))return mK;r=r.replace(/^,/,"")}return i}(a);if(this.fontFaces){var l=function(t,e){if(null===p){var n=function(t){var e=[];return Object.keys(t).forEach(function(n){t[n].forEach(function(t){var i=null;switch(t){case"bold":i={family:n,weight:"bold"};break;case"italic":i={family:n,style:"italic"};break;case"bolditalic":i={family:n,weight:"bold",style:"italic"};break;case"":case"normal":i={family:n}}null!==i&&(i.ref={name:n,style:t},e.push(i))})}),e}(t.getFontList());p=function(t){for(var e={},n=0;n<t.length;++n){var i=$Y(t[n]),r=i.family,a=i.stretch,o=i.style,s=i.weight;e[r]=e[r]||{},e[r][a]=e[r][a]||{},e[r][a][o]=e[r][a][o]||{},e[r][a][o][s]=i}return e}(n.concat(e))}return p}(this.pdf,this.fontFaces),c=s.map(function(t){return{family:t,stretch:"normal",weight:i,style:n}}),u=function(t,e,n){for(var i=(n=n||{}).defaultFontFamily||"times",r=Object.assign({},tK,n.genericFontFamilies||{}),a=null,o=null,s=0;s<e.length;++s)if(r[(a=$Y(e[s])).family]&&(a.family=r[a.family]),t.hasOwnProperty(a.family)){o=t[a.family];break}if(!(o=o||t[i]))throw new Error("Could not find a font-family for the rule '"+nK(a)+"' and default family '"+i+"'.");if(o=function(t,e){if(e[t])return e[t];var n=YY[t],i=n<=YY.normal?-1:1,r=QY(e,XY,n,i);if(!r)throw new Error("Could not find a matching font-stretch value for "+t);return r}(a.stretch,o),o=function(t,e){if(e[t])return e[t];for(var n=ZY[t],i=0;i<n.length;++i)if(e[n[i]])return e[n[i]];throw new Error("Could not find a matching font-style for "+t)}(a.style,o),!(o=function(t,e){if(e[t])return e[t];if(400===t&&e[500])return e[500];if(500===t&&e[400])return e[400];var n=JY[t],i=QY(e,KY,n,t<400?-1:1);if(!i)throw new Error("Could not find a matching font-weight for value "+t);return i}(a.weight,o)))throw new Error("Failed to resolve a font for the rule '"+nK(a)+"'.");return o}(l,c);this.pdf.setFont(u.ref.name,u.ref.style)}else{var h="";("bold"===i||parseInt(i,10)>=700||"bold"===n)&&(h="bold"),"italic"===n&&(h+="italic"),0===h.length&&(h="normal");for(var d="",f={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},m=0;m<s.length;m++){if(void 0!==this.pdf.internal.getFont(s[m],h,{noFallback:!0,disableWarning:!0})){d=s[m];break}if("bolditalic"===h&&void 0!==this.pdf.internal.getFont(s[m],"bold",{noFallback:!0,disableWarning:!0}))d=s[m],h="bold";else if(void 0!==this.pdf.internal.getFont(s[m],"normal",{noFallback:!0,disableWarning:!0})){d=s[m],h="normal";break}}if(""===d)for(var g=0;g<s.length;g++)if(f[s[g]]){d=f[s[g]];break}d=""===d?"Times":d,this.pdf.setFont(d,h)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(t){this.ctx.globalCompositeOperation=t}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(t){this.ctx.globalAlpha=t}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(t){this.ctx.lineDashOffset=t,F.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(t){this.ctx.lineDash=t,F.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(t){this.ctx.ignoreClearRect=Boolean(t)}})};h.prototype.setLineDash=function(t){this.lineDash=t},h.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},h.prototype.fill=function(){b.call(this,"fill",!1)},h.prototype.stroke=function(){b.call(this,"stroke",!1)},h.prototype.beginPath=function(){this.path=[{type:"begin"}]},h.prototype.moveTo=function(t,e){if(isNaN(t)||isNaN(e))throw CX.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new o(t,e));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new o(t,e)},h.prototype.closePath=function(){var t=new o(0,0),e=0;for(e=this.path.length-1;-1!==e;e--)if("begin"===this.path[e].type&&"object"===(0,SD.A)(this.path[e+1])&&"number"==typeof this.path[e+1].x){t=new o(this.path[e+1].x,this.path[e+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(t.x,t.y)},h.prototype.lineTo=function(t,e){if(isNaN(t)||isNaN(e))throw CX.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new o(t,e));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new o(n.x,n.y)},h.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),b.call(this,null,!0)},h.prototype.quadraticCurveTo=function(t,e,n,i){if(isNaN(n)||isNaN(i)||isNaN(t)||isNaN(e))throw CX.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var r=this.ctx.transform.applyToPoint(new o(n,i)),a=this.ctx.transform.applyToPoint(new o(t,e));this.path.push({type:"qct",x1:a.x,y1:a.y,x:r.x,y:r.y}),this.ctx.lastPoint=new o(r.x,r.y)},h.prototype.bezierCurveTo=function(t,e,n,i,r,a){if(isNaN(r)||isNaN(a)||isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i))throw CX.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var s=this.ctx.transform.applyToPoint(new o(r,a)),l=this.ctx.transform.applyToPoint(new o(t,e)),c=this.ctx.transform.applyToPoint(new o(n,i));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:s.x,y:s.y}),this.ctx.lastPoint=new o(s.x,s.y)},h.prototype.arc=function(t,e,n,i,r,a){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||isNaN(r))throw CX.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(a=Boolean(a),!this.ctx.transform.isIdentity){var s=this.ctx.transform.applyToPoint(new o(t,e));t=s.x,e=s.y;var l=this.ctx.transform.applyToPoint(new o(0,n)),c=this.ctx.transform.applyToPoint(new o(0,0));n=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(r-i)>=2*Math.PI&&(i=0,r=2*Math.PI),this.path.push({type:"arc",x:t,y:e,radius:n,startAngle:i,endAngle:r,counterclockwise:a})},h.prototype.arcTo=function(t,e,n,i,r){throw new Error("arcTo not implemented.")},h.prototype.rect=function(t,e,n,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i))throw CX.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.lineTo(t,e),this.lineTo(t+n,e),this.lineTo(t,e)},h.prototype.fillRect=function(t,e,n,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i))throw CX.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var r={};"butt"!==this.lineCap&&(r.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(r.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(t,e,n,i),this.fill(),r.hasOwnProperty("lineCap")&&(this.lineCap=r.lineCap),r.hasOwnProperty("lineJoin")&&(this.lineJoin=r.lineJoin)}},h.prototype.strokeRect=function(t,e,n,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i))throw CX.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");f.call(this)||(this.beginPath(),this.rect(t,e,n,i),this.stroke())},h.prototype.clearRect=function(t,e,n,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i))throw CX.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(t,e,n,i))},h.prototype.save=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(e),t){this.ctx.fontSize=this.pdf.internal.getFontSize();var i=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=i}},h.prototype.restore=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(e),t&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},h.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var d=function(t){var e,n,i,r;if(!0===t.isCanvasGradient&&(t=t.getColor()),!t)return{r:0,g:0,b:0,a:0,style:t};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(t))e=0,n=0,i=0,r=0;else{var a=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(t);if(null!==a)e=parseInt(a[1]),n=parseInt(a[2]),i=parseInt(a[3]),r=1;else if(null!==(a=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(t)))e=parseInt(a[1]),n=parseInt(a[2]),i=parseInt(a[3]),r=parseFloat(a[4]);else{if(r=1,"string"==typeof t&&"#"!==t.charAt(0)){var o=new RX(t);t=o.ok?o.toHex():"#000000"}4===t.length?(e=t.substring(1,2),e+=e,n=t.substring(2,3),n+=n,i=t.substring(3,4),i+=i):(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7)),e=parseInt(e,16),n=parseInt(n,16),i=parseInt(i,16)}}return{r:e,g:n,b:i,a:r,style:t}},p=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},f=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};h.prototype.fillText=function(t,e,n,i){if(isNaN(e)||isNaN(n)||"string"!=typeof t)throw CX.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(i=isNaN(i)?void 0:i,!p.call(this)){var r=D(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;C.call(this,{text:t,x:e,y:n,scale:a,angle:r,align:this.textAlign,maxWidth:i})}},h.prototype.strokeText=function(t,e,n,i){if(isNaN(e)||isNaN(n)||"string"!=typeof t)throw CX.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!f.call(this)){i=isNaN(i)?void 0:i;var r=D(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;C.call(this,{text:t,x:e,y:n,scale:a,renderingMode:"stroke",angle:r,align:this.textAlign,maxWidth:i})}},h.prototype.measureText=function(t){if("string"!=typeof t)throw CX.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var e=this.pdf,n=this.pdf.internal.scaleFactor,i=e.internal.getFontSize(),r=e.getStringUnitWidth(t)*i/e.internal.scaleFactor;return new function(t){var e=(t=t||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return e}}),this}({width:r*=Math.round(96*n/72*1e4)/1e4})},h.prototype.scale=function(t,e){if(isNaN(t)||isNaN(e))throw CX.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new l(t,0,0,e,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},h.prototype.rotate=function(t){if(isNaN(t))throw CX.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var e=new l(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0);this.ctx.transform=this.ctx.transform.multiply(e)},h.prototype.translate=function(t,e){if(isNaN(t)||isNaN(e))throw CX.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new l(1,0,0,1,t,e);this.ctx.transform=this.ctx.transform.multiply(n)},h.prototype.transform=function(t,e,n,i,r,a){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(i)||isNaN(r)||isNaN(a))throw CX.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var o=new l(t,e,n,i,r,a);this.ctx.transform=this.ctx.transform.multiply(o)},h.prototype.setTransform=function(t,e,n,i,r,a){t=isNaN(t)?1:t,e=isNaN(e)?0:e,n=isNaN(n)?0:n,i=isNaN(i)?1:i,r=isNaN(r)?0:r,a=isNaN(a)?0:a,this.ctx.transform=new l(t,e,n,i,r,a)};var m=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};h.prototype.drawImage=function(t,e,n,i,r,a,o,c,u){var h=this.pdf.getImageProperties(t),d=1,p=1,f=1,y=1;void 0!==i&&void 0!==c&&(f=c/i,y=u/r,d=h.width/i*c/i,p=h.height/r*u/r),void 0===a&&(a=e,o=n,e=0,n=0),void 0!==i&&void 0===c&&(c=i,u=r),void 0===i&&void 0===c&&(c=h.width,u=h.height);for(var b,w=this.ctx.transform.decompose(),S=D(w.rotate.shx),M=new l,T=(M=(M=(M=M.multiply(w.translate)).multiply(w.skew)).multiply(w.scale)).applyToRectangle(new s(a-e*f,o-n*y,i*d,r*p)),A=g.call(this,T),E=[],C=0;C<A.length;C+=1)-1===E.indexOf(A[C])&&E.push(A[C]);if(_(E),this.autoPaging)for(var P=E[0],I=E[E.length-1],L=P;L<I+1;L++){this.pdf.setPage(L);var k=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],R=1===L?this.posY+this.margin[0]:this.margin[0],N=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],z=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],F=1===L?0:N+(L-2)*z;if(0!==this.ctx.clip_path.length){var O=this.path;b=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=v(b,this.posX+this.margin[3],-F+R+this.ctx.prevPageLastElemOffset),x.call(this,"fill",!0),this.path=O}var B=JSON.parse(JSON.stringify(T));B=v([B],this.posX+this.margin[3],-F+R+this.ctx.prevPageLastElemOffset)[0];var U=(L>P||L<I)&&m.call(this);U&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],k,z,null).clip().discardPath()),this.pdf.addImage(t,"JPEG",B.x,B.y,B.w,B.h,null,null,S),U&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(t,"JPEG",T.x,T.y,T.w,T.h,null,null,S)};var g=function(t,e,n){var i=[];e=e||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var r=this.posY+this.ctx.prevPageLastElemOffset;switch(t.type){default:case"mt":case"lt":i.push(Math.floor((t.y+r)/n)+1);break;case"arc":i.push(Math.floor((t.y+r-t.radius)/n)+1),i.push(Math.floor((t.y+r+t.radius)/n)+1);break;case"qct":var a=N(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x,t.y);i.push(Math.floor((a.y+r)/n)+1),i.push(Math.floor((a.y+a.h+r)/n)+1);break;case"bct":var o=z(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x2,t.y2,t.x,t.y);i.push(Math.floor((o.y+r)/n)+1),i.push(Math.floor((o.y+o.h+r)/n)+1);break;case"rect":i.push(Math.floor((t.y+r)/n)+1),i.push(Math.floor((t.y+t.h+r)/n)+1)}for(var s=0;s<i.length;s+=1)for(;this.pdf.internal.getNumberOfPages()<i[s];)y.call(this);return i},y=function(){var t=this.fillStyle,e=this.strokeStyle,n=this.font,i=this.lineCap,r=this.lineWidth,a=this.lineJoin;this.pdf.addPage(),this.fillStyle=t,this.strokeStyle=e,this.font=n,this.lineCap=i,this.lineWidth=r,this.lineJoin=a},v=function(t,e,n){for(var i=0;i<t.length;i++)switch(t[i].type){case"bct":t[i].x2+=e,t[i].y2+=n;case"qct":t[i].x1+=e,t[i].y1+=n;default:t[i].x+=e,t[i].y+=n}return t},_=function(t){return t.sort(function(t,e){return t-e})},b=function(t,e){for(var n,i,r=this.fillStyle,a=this.strokeStyle,o=this.lineCap,s=this.lineWidth,l=Math.abs(s*this.ctx.transform.scaleX),c=this.lineJoin,u=JSON.parse(JSON.stringify(this.path)),h=JSON.parse(JSON.stringify(this.path)),d=[],p=0;p<h.length;p++)if(void 0!==h[p].x)for(var f=g.call(this,h[p]),b=0;b<f.length;b+=1)-1===d.indexOf(f[b])&&d.push(f[b]);for(var w=0;w<d.length;w++)for(;this.pdf.internal.getNumberOfPages()<d[w];)y.call(this);if(_(d),this.autoPaging)for(var S=d[0],M=d[d.length-1],T=S;T<M+1;T++){this.pdf.setPage(T),this.fillStyle=r,this.strokeStyle=a,this.lineCap=o,this.lineWidth=l,this.lineJoin=c;var A=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],E=1===T?this.posY+this.margin[0]:this.margin[0],C=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],P=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],I=1===T?0:C+(T-2)*P;if(0!==this.ctx.clip_path.length){var L=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=v(n,this.posX+this.margin[3],-I+E+this.ctx.prevPageLastElemOffset),x.call(this,t,!0),this.path=L}if(i=JSON.parse(JSON.stringify(u)),this.path=v(i,this.posX+this.margin[3],-I+E+this.ctx.prevPageLastElemOffset),!1===e||0===T){var k=(T>S||T<M)&&m.call(this);k&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],A,P,null).clip().discardPath()),x.call(this,t,e),k&&this.pdf.restoreGraphicsState()}this.lineWidth=s}else this.lineWidth=l,x.call(this,t,e),this.lineWidth=s;this.path=u},x=function(t,e){if(("stroke"!==t||e||!f.call(this))&&("stroke"===t||e||!p.call(this))){for(var n,i,r=[],a=this.path,o=0;o<a.length;o++){var s=a[o];switch(s.type){case"begin":r.push({begin:!0});break;case"close":r.push({close:!0});break;case"mt":r.push({start:s,deltas:[],abs:[]});break;case"lt":var l=r.length;if(a[o-1]&&!isNaN(a[o-1].x)&&(n=[s.x-a[o-1].x,s.y-a[o-1].y],l>0))for(;l>=0;l--)if(!0!==r[l-1].close&&!0!==r[l-1].begin){r[l-1].deltas.push(n),r[l-1].abs.push(s);break}break;case"bct":n=[s.x1-a[o-1].x,s.y1-a[o-1].y,s.x2-a[o-1].x,s.y2-a[o-1].y,s.x-a[o-1].x,s.y-a[o-1].y],r[r.length-1].deltas.push(n);break;case"qct":var c=a[o-1].x+2/3*(s.x1-a[o-1].x),u=a[o-1].y+2/3*(s.y1-a[o-1].y),h=s.x+2/3*(s.x1-s.x),d=s.y+2/3*(s.y1-s.y),m=s.x,g=s.y;n=[c-a[o-1].x,u-a[o-1].y,h-a[o-1].x,d-a[o-1].y,m-a[o-1].x,g-a[o-1].y],r[r.length-1].deltas.push(n);break;case"arc":r.push({deltas:[],abs:[],arc:!0}),Array.isArray(r[r.length-1].abs)&&r[r.length-1].abs.push(s)}}i=e?null:"stroke"===t?"stroke":"fill";for(var y=!1,v=0;v<r.length;v++)if(r[v].arc)for(var _=r[v].abs,b=0;b<_.length;b++){var x=_[b];"arc"===x.type?M.call(this,x.x,x.y,x.radius,x.startAngle,x.endAngle,x.counterclockwise,void 0,e,!y):P.call(this,x.x,x.y),y=!0}else if(!0===r[v].close)this.pdf.internal.out("h"),y=!1;else if(!0!==r[v].begin){var w=r[v].start.x,S=r[v].start.y;I.call(this,r[v].deltas,w,S),y=!0}i&&T.call(this,i),e&&A.call(this)}},w=function(t){var e=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=e*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return t-n;case"top":return t+e-n;case"hanging":return t+e-2*n;case"middle":return t+e/2-n;default:return t}},S=function(t){return t+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};h.prototype.createLinearGradient=function(){var t=function(){};return t.colorStops=[],t.addColorStop=function(t,e){this.colorStops.push([t,e])},t.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},t.isCanvasGradient=!0,t},h.prototype.createPattern=function(){return this.createLinearGradient()},h.prototype.createRadialGradient=function(){return this.createLinearGradient()};var M=function(t,e,n,i,r,a,o,s,l){for(var c=k.call(this,n,i,r,a),u=0;u<c.length;u++){var h=c[u];0===u&&(l?E.call(this,h.x1+t,h.y1+e):P.call(this,h.x1+t,h.y1+e)),L.call(this,t,e,h.x2,h.y2,h.x3,h.y3,h.x4,h.y4)}s?A.call(this):T.call(this,o)},T=function(t){switch(t){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},A=function(){this.pdf.clip(),this.pdf.discardPath()},E=function(t,e){this.pdf.internal.out(n(t)+" "+i(e)+" m")},C=function(t){var e;switch(t.align){case"right":case"end":e="right";break;case"center":e="center";break;default:e="left"}var n=this.pdf.getTextDimensions(t.text),i=w.call(this,t.y),r=S.call(this,i)-n.h,a=this.ctx.transform.applyToPoint(new o(t.x,i)),c=this.ctx.transform.decompose(),u=new l;u=(u=(u=u.multiply(c.translate)).multiply(c.skew)).multiply(c.scale);for(var h,d,p,f=this.ctx.transform.applyToRectangle(new s(t.x,i,n.w,n.h)),y=u.applyToRectangle(new s(t.x,r,n.w,n.h)),b=g.call(this,y),M=[],T=0;T<b.length;T+=1)-1===M.indexOf(b[T])&&M.push(b[T]);if(_(M),this.autoPaging)for(var A=M[0],E=M[M.length-1],C=A;C<E+1;C++){this.pdf.setPage(C);var P=1===C?this.posY+this.margin[0]:this.margin[0],I=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],L=this.pdf.internal.pageSize.height-this.margin[2],k=L-this.margin[0],R=this.pdf.internal.pageSize.width-this.margin[1],D=R-this.margin[3],N=1===C?0:I+(C-2)*k;if(0!==this.ctx.clip_path.length){var z=this.path;h=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=v(h,this.posX+this.margin[3],-1*N+P),x.call(this,"fill",!0),this.path=z}var F=v([JSON.parse(JSON.stringify(y))],this.posX+this.margin[3],-N+P+this.ctx.prevPageLastElemOffset)[0];t.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*t.scale),p=this.lineWidth,this.lineWidth=p*t.scale);var O="text"!==this.autoPaging;if(O||F.y+F.h<=L){if(O||F.y>=P&&F.x<=R){var B=O?t.text:this.pdf.splitTextToSize(t.text,t.maxWidth||R-F.x)[0],U=v([JSON.parse(JSON.stringify(f))],this.posX+this.margin[3],-N+P+this.ctx.prevPageLastElemOffset)[0],j=O&&(C>A||C<E)&&m.call(this);j&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],D,k,null).clip().discardPath()),this.pdf.text(B,U.x,U.y,{angle:t.angle,align:e,renderingMode:t.renderingMode}),j&&this.pdf.restoreGraphicsState()}}else F.y<L&&(this.ctx.prevPageLastElemOffset+=L-F.y);t.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=p)}else t.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*t.scale),p=this.lineWidth,this.lineWidth=p*t.scale),this.pdf.text(t.text,a.x+this.posX,a.y+this.posY,{angle:t.angle,align:e,renderingMode:t.renderingMode,maxWidth:t.maxWidth}),t.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=p)},P=function(t,e,r,a){r=r||0,a=a||0,this.pdf.internal.out(n(t+r)+" "+i(e+a)+" l")},I=function(t,e,n){return this.pdf.lines(t,e,n,null,null)},L=function(t,n,i,o,s,l,c,u){this.pdf.internal.out([e(r(i+t)),e(a(o+n)),e(r(s+t)),e(a(l+n)),e(r(c+t)),e(a(u+n)),"c"].join(" "))},k=function(t,e,n,i){for(var r=2*Math.PI,a=Math.PI/2;e>n;)e-=r;var o=Math.abs(n-e);o<r&&i&&(o=r-o);for(var s=[],l=i?-1:1,c=e;o>1e-5;){var u=c+l*Math.min(o,a);s.push(R.call(this,t,c,u)),o-=Math.abs(u-c),c=u}return s},R=function(t,e,n){var i=(n-e)/2,r=t*Math.cos(i),a=t*Math.sin(i),o=r,s=-a,l=o*o+s*s,c=l+o*r+s*a,u=4/3*(Math.sqrt(2*l*c)-c)/(o*a-s*r),h=o-u*s,d=s+u*o,p=h,f=-d,m=i+e,g=Math.cos(m),y=Math.sin(m);return{x1:t*Math.cos(e),y1:t*Math.sin(e),x2:h*g-d*y,y2:h*y+d*g,x3:p*g-f*y,y3:p*y+f*g,x4:t*Math.cos(n),y4:t*Math.sin(n)}},D=function(t){return 180*t/Math.PI},N=function(t,e,n,i,r,a){var o=t+.5*(n-t),l=e+.5*(i-e),c=r+.5*(n-r),u=a+.5*(i-a),h=Math.min(t,r,o,c),d=Math.max(t,r,o,c),p=Math.min(e,a,l,u),f=Math.max(e,a,l,u);return new s(h,p,d-h,f-p)},z=function(t,e,n,i,r,a,o,l){var c,u,h,d,p,f,m,g,y,v,_,b,x,w,S=n-t,M=i-e,T=r-n,A=a-i,E=o-r,C=l-a;for(u=0;u<41;u++)y=(m=(h=t+(c=u/40)*S)+c*((p=n+c*T)-h))+c*(p+c*(r+c*E-p)-m),v=(g=(d=e+c*M)+c*((f=i+c*A)-d))+c*(f+c*(a+c*C-f)-g),0==u?(_=y,b=v,x=y,w=v):(_=Math.min(_,y),b=Math.min(b,v),x=Math.max(x,y),w=Math.max(w,v));return new s(Math.round(_),Math.round(b),Math.round(x-_),Math.round(w-b))},F=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var t,e,n=(t=this.ctx.lineDash,e=this.ctx.lineDashOffset,JSON.stringify({lineDash:t,lineDashOffset:e}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(aY.API),function(t){var e=function(t){var e,n,i,r,a,o,s,l,c,u;for(/[^\x00-\xFF]/.test(t),n=[],i=0,r=(t+=e="\0\0\0\0".slice(t.length%4||4)).length;r>i;i+=4)0!==(a=(t.charCodeAt(i)<<24)+(t.charCodeAt(i+1)<<16)+(t.charCodeAt(i+2)<<8)+t.charCodeAt(i+3))?(o=(a=((a=((a=((a=(a-(u=a%85))/85)-(c=a%85))/85)-(l=a%85))/85)-(s=a%85))/85)%85,n.push(o+33,s+33,l+33,c+33,u+33)):n.push(122);return function(t,e){for(var n=e;n>0;n--)t.pop()}(n,e.length),String.fromCharCode.apply(String,n)+"~>"},n=function(t){var e,n,i,r,a,o=String,s="length",l=255,c="charCodeAt",u="slice",h="replace";for(t[u](-2),t=t[u](0,-2)[h](/\s/g,"")[h]("z","!!!!!"),i=[],r=0,a=(t+=e="uuuuu"[u](t[s]%5||5))[s];a>r;r+=5)n=52200625*(t[c](r)-33)+614125*(t[c](r+1)-33)+7225*(t[c](r+2)-33)+85*(t[c](r+3)-33)+(t[c](r+4)-33),i.push(l&n>>24,l&n>>16,l&n>>8,l&n);return function(t,e){for(var n=e;n>0;n--)t.pop()}(i,e[s]),o.fromCharCode.apply(o,i)},i=function(t){return t.split("").map(function(t){return("0"+t.charCodeAt().toString(16)).slice(-2)}).join("")+">"},r=function(t){var e=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(t=t.replace(/\s/g,"")).indexOf(">")&&(t=t.substr(0,t.indexOf(">"))),t.length%2&&(t+="0"),!1===e.test(t))return"";for(var n="",i=0;i<t.length;i+=2)n+=String.fromCharCode("0x"+(t[i]+t[i+1]));return n},a=function(t){for(var e=new Uint8Array(t.length),n=t.length;n--;)e[n]=t.charCodeAt(n);return(e=QH(e)).reduce(function(t,e){return t+String.fromCharCode(e)},"")};t.processDataByFilters=function(t,o){var s=0,l=t||"",c=[];for("string"==typeof(o=o||[])&&(o=[o]),s=0;s<o.length;s+=1)switch(o[s]){case"ASCII85Decode":case"/ASCII85Decode":l=n(l),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=e(l),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=r(l),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=i(l),c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=a(l),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[s]+'" is not implemented')}return{data:l,reverseChain:c.reverse().join(" ")}}}(aY.API),(fK=aY.API).loadFile=function(t,e,n){return function(t,e,n){e=!1!==e,n="function"==typeof n?n:function(){};var i=void 0;try{i=function(t,e,n){var i=new XMLHttpRequest,r=0,a=function(t){var e=t.length,n=[],i=String.fromCharCode;for(r=0;r<e;r+=1)n.push(i(255&t.charCodeAt(r)));return n.join("")};if(i.open("GET",t,!e),i.overrideMimeType("text/plain; charset=x-user-defined"),!1===e&&(i.onload=function(){200===i.status?n(a(this.responseText)):n(void 0)}),i.send(null),e&&200===i.status)return a(i.responseText)}(t,e,n)}catch(_T){}return i}(t,e,n)},fK.loadImageFile=fK.loadFile,function(t){function e(){return(AX.html2canvas?Promise.resolve(AX.html2canvas):n.e(239).then(n.t.bind(n,5239,23))).catch(function(t){return Promise.reject(new Error("Could not load html2canvas: "+t))}).then(function(t){return t.default?t.default:t})}function i(){return(AX.DOMPurify?Promise.resolve(AX.DOMPurify):n.e(977).then(n.bind(n,7977))).catch(function(t){return Promise.reject(new Error("Could not load dompurify: "+t))}).then(function(t){return t.default?t.default:t})}var r=function(t){var e=(0,SD.A)(t);return"undefined"===e?"undefined":"string"===e||t instanceof String?"string":"number"===e||t instanceof Number?"number":"function"===e||t instanceof Function?"function":t&&t.constructor===Array?"array":t&&1===t.nodeType?"element":"object"===e?"object":"unknown"},a=function(t,e){var n=document.createElement(t);for(var i in e.className&&(n.className=e.className),e.innerHTML&&e.dompurify&&(n.innerHTML=e.dompurify.sanitize(e.innerHTML)),e.style)n.style[i]=e.style[i];return n},o=function t(e,n){for(var i=3===e.nodeType?document.createTextNode(e.nodeValue):e.cloneNode(!1),r=e.firstChild;r;r=r.nextSibling)!0!==n&&1===r.nodeType&&"SCRIPT"===r.nodeName||i.appendChild(t(r,n));return 1===e.nodeType&&("CANVAS"===e.nodeName?(i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0)):"TEXTAREA"!==e.nodeName&&"SELECT"!==e.nodeName||(i.value=e.value),i.addEventListener("load",function(){i.scrollTop=e.scrollTop,i.scrollLeft=e.scrollLeft},!0)),i},s=function t(e){var n=Object.assign(t.convert(Promise.resolve()),JSON.parse(JSON.stringify(t.template))),i=t.convert(Promise.resolve(),n);return(i=i.setProgress(1,t,1,[t])).set(e)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(t,e){return t.__proto__=e||s.prototype,t},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(t,e){return this.then(function(){switch(e=e||function(t){switch(r(t)){case"string":return"string";case"element":return"canvas"===t.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(t),e){case"string":return this.then(i).then(function(e){return this.set({src:a("div",{innerHTML:t,dompurify:e})})});case"element":return this.set({src:t});case"canvas":return this.set({canvas:t});case"img":return this.set({img:t});default:return this.error("Unknown source type.")}})},s.prototype.to=function(t){switch(t){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var t={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},e=o(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===e.tagName&&(t.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:t}),this.prop.container.appendChild(e),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(e).then(function(t){var e=Object.assign({},this.opt.html2canvas);return delete e.onrendered,t(this.prop.container,e)}).then(function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(e).then(function(t){var e=this.opt.jsPDF,n=this.opt.fontFaces,i="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,r=Object.assign({async:!0,allowTaint:!0,scale:i,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete r.onrendered,e.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,e.context2d.posX=this.opt.x,e.context2d.posY=this.opt.y,e.context2d.margin=this.opt.margin,e.context2d.fontFaces=n,n)for(var a=0;a<n.length;++a){var o=n[a],s=o.src.find(function(t){return"truetype"===t.format});s&&e.addFont(s.url,o.ref.name,o.ref.style)}return r.windowHeight=r.windowHeight||0,r.windowHeight=0==r.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):r.windowHeight,e.context2d.save(!0),t(this.prop.container,r)}).then(function(t){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var t=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=t})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(t,e,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(t,e):this.outputPdf(t,e)},s.prototype.outputPdf=function(t,e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(t,e)})},s.prototype.outputImg=function(t){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(t){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+t+'" is not supported.'}})},s.prototype.save=function(t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(t?{filename:t}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(t){if("object"!==r(t))return this;var e=Object.keys(t||{}).map(function(e){if(e in s.template.prop)return function(){this.prop[e]=t[e]};switch(e){case"margin":return this.setMargin.bind(this,t.margin);case"jsPDF":return function(){return this.opt.jsPDF=t.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,t.pageSize);default:return function(){this.opt[e]=t[e]}}},this);return this.then(function(){return this.thenList(e)})},s.prototype.get=function(t,e){return this.then(function(){var n=t in s.template.prop?this.prop[t]:this.opt[t];return e?e(n):n})},s.prototype.setMargin=function(t){return this.then(function(){switch(r(t)){case"number":t=[t,t,t,t];case"array":if(2===t.length&&(t=[t[0],t[1],t[0],t[1]]),4===t.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=t}).then(this.setPageSize)},s.prototype.setPageSize=function(t){function e(t,e){return Math.floor(t*e/72*96)}return this.then(function(){(t=t||aY.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(t.inner={width:t.width-this.opt.margin[1]-this.opt.margin[3],height:t.height-this.opt.margin[0]-this.opt.margin[2]},t.inner.px={width:e(t.inner.width,t.k),height:e(t.inner.height,t.k)},t.inner.ratio=t.inner.height/t.inner.width),this.prop.pageSize=t})},s.prototype.setProgress=function(t,e,n,i){return null!=t&&(this.progress.val=t),null!=e&&(this.progress.state=e),null!=n&&(this.progress.n=n),null!=i&&(this.progress.stack=i),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(t,e,n,i){return this.setProgress(t?this.progress.val+t:null,e||null,n?this.progress.n+n:null,i?this.progress.stack.concat(i):null)},s.prototype.then=function(t,e){var n=this;return this.thenCore(t,e,function(t,e){return n.updateProgress(null,null,1,[t]),Promise.prototype.then.call(this,function(e){return n.updateProgress(null,t),e}).then(t,e).then(function(t){return n.updateProgress(1),t})})},s.prototype.thenCore=function(t,e,n){n=n||Promise.prototype.then;var i=this;t&&(t=t.bind(i)),e&&(e=e.bind(i));var r=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?i:s.convert(Object.assign({},i),Promise.prototype),a=n.call(r,t,e);return s.convert(a,i.__proto__)},s.prototype.thenExternal=function(t,e){return Promise.prototype.then.call(this,t,e)},s.prototype.thenList=function(t){var e=this;return t.forEach(function(t){e=e.thenCore(t)}),e},s.prototype.catch=function(t){t&&(t=t.bind(this));var e=Promise.prototype.catch.call(this,t);return s.convert(e,this)},s.prototype.catchExternal=function(t){return Promise.prototype.catch.call(this,t)},s.prototype.error=function(t){return this.then(function(){throw new Error(t)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,aY.getPageSize=function(t,e,n){if("object"===(0,SD.A)(t)){var i=t;t=i.orientation,e=i.unit||e,n=i.format||n}e=e||"mm",n=n||"a4",t=(""+(t||"P")).toLowerCase();var r,a=(""+n).toLowerCase(),o={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(e){case"pt":r=1;break;case"mm":r=72/25.4;break;case"cm":r=72/2.54;break;case"in":r=72;break;case"px":r=.75;break;case"pc":case"em":r=12;break;case"ex":r=6;break;default:throw"Invalid unit: "+e}var s,l=0,c=0;if(o.hasOwnProperty(a))l=o[a][1]/r,c=o[a][0]/r;else try{l=n[1],c=n[0]}catch(RX){throw new Error("Invalid format: "+n)}if("p"===t||"portrait"===t)t="p",c>l&&(s=c,c=l,l=s);else{if("l"!==t&&"landscape"!==t)throw"Invalid orientation: "+t;t="l",l>c&&(s=c,c=l,l=s)}return{width:c,height:l,unit:e,k:r,orientation:t}},t.html=function(t,e){(e=e||{}).callback=e.callback||function(){},e.html2canvas=e.html2canvas||{},e.html2canvas.canvas=e.html2canvas.canvas||this.canvas,e.jsPDF=e.jsPDF||this,e.fontFaces=e.fontFaces?e.fontFaces.map($Y):null;var n=new s(e);return e.worker?n:n.from(t).doCallback()}}(aY.API),aY.API.addJS=function(t){return lK=t,this.internal.events.subscribe("postPutResources",function(){oK=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(oK+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),sK=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+lK+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==oK&&void 0!==sK&&this.internal.out("/Names <</JavaScript "+oK+" 0 R>>")}),this},function(t){var e;t.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=t.outline.render().split(/\r\n/),r=0;r<i.length;r++){var a=i[r],o=n.exec(a);if(null!=o){var s=o[1];t.internal.newObjectDeferredBegin(s,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(r=0;r<l;r++){var u=t.internal.newObject();c.push(u);var h=t.internal.getPageInfo(r+1);t.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var d=t.internal.newObject();for(t.internal.write("<< /Names [ "),r=0;r<c.length;r++)t.internal.write("(page_"+(r+1)+")"+c[r]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+d+" 0 R"),t.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(t,e,n){var i={title:e,options:n,children:[]};return null==t&&(t=this.root),t.children.push(i),i},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(e){e.id=t.internal.newObjectDeferred();for(var n=0;n<e.children.length;n++)this.genIds_r(e.children[n])},t.outline.renderRoot=function(t){this.objStart(t),this.line("/Type /Outlines"),t.children.length>0&&(this.line("/First "+this.makeRef(t.children[0])),this.line("/Last "+this.makeRef(t.children[t.children.length-1]))),this.line("/Count "+this.count_r({count:0},t)),this.objEnd()},t.outline.renderItems=function(e){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<e.children.length;i++){var r=e.children[i];this.objStart(r),this.line("/Title "+this.makeString(r.title)),this.line("/Parent "+this.makeRef(e)),i>0&&this.line("/Prev "+this.makeRef(e.children[i-1])),i<e.children.length-1&&this.line("/Next "+this.makeRef(e.children[i+1])),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1])));var a=this.count=this.count_r({count:0},r);if(a>0&&this.line("/Count "+a),r.options&&r.options.pageNumber){var o=t.internal.getPageInfo(r.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var s=0;s<e.children.length;s++)this.renderItems(e.children[s])},t.outline.line=function(t){this.ctx.val+=t+"\r\n"},t.outline.makeRef=function(t){return t.id+" 0 R"},t.outline.makeString=function(e){return"("+t.internal.pdfEscape(e)+")"},t.outline.objStart=function(t){this.ctx.val+="\r\n"+t.id+" 0 obj\r\n<<\r\n"},t.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},t.outline.count_r=function(t,e){for(var n=0;n<e.children.length;n++)t.count++,this.count_r(t,e.children[n]);return t.count}}])}(aY.API),function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(t,n,i,r,a,o){var s,l=this.decode.DCT_DECODE,c=null;if("string"==typeof t||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,s=function(t){for(var n,i=256*t.charCodeAt(4)+t.charCodeAt(5),r=t.length,a={width:0,height:0,numcomponents:1},o=4;o<r;o+=2){if(o+=i,-1!==e.indexOf(t.charCodeAt(o+1))){n=256*t.charCodeAt(o+5)+t.charCodeAt(o+6),a={width:256*t.charCodeAt(o+7)+t.charCodeAt(o+8),height:n,numcomponents:t.charCodeAt(o+9)};break}i=256*t.charCodeAt(o+2)+t.charCodeAt(o+3)}return a}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),s.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}c={data:t,width:s.width,height:s.height,colorSpace:o,bitsPerComponent:8,filter:l,index:n,alias:i}}return c}}(aY.API),aY.API.processPNG=function(t,e,n,i){if(this.__addimage__.isArrayBuffer(t)&&(t=new Uint8Array(t)),this.__addimage__.isArrayBufferView(t)){var r,a=function(t,e){return new MX(t,e).decode()}(t,{checkCrc:!0}),o=a.width,s=a.height,l=a.channels,c=a.palette,u=a.depth;r=c&&1===l?function(t){for(var e=t.width,n=t.height,i=t.data,r=t.palette,a=t.depth,o=!1,s=[],l=[],c=void 0,u=!1,h=0,d=0;d<r.length;d++){var p=nG(r[d],4),f=p[0],m=p[1],g=p[2],y=p[3];s.push(f,m,g),null!=y&&(0===y?(h++,l.length<1&&l.push(d)):y<255&&(u=!0))}if(u||h>1){o=!0,l=void 0;var v=e*n;c=new Uint8Array(v);for(var _=new DataView(i.buffer),b=0;b<v;b++){var x=nG(r[MK(_,b,a)],4)[3];c[b]=x}}else 0===h&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:o?8:void 0,colorBytes:i,alphaBytes:c,needSMask:o,palette:s,mask:l}}(a):2===l||4===l?function(t){for(var e=t.data,n=t.width,i=t.height,r=t.channels,a=t.depth,o=2===r?"DeviceGray":"DeviceRGB",s=r-1,l=n*i,c=s,u=l*c,h=1*l,d=Math.ceil(u*a/8),p=Math.ceil(h*a/8),f=new Uint8Array(d),m=new Uint8Array(p),g=new DataView(e.buffer),y=new DataView(f.buffer),v=new DataView(m.buffer),_=!1,b=0;b<l;b++){for(var x=b*r,w=0;w<c;w++)TK(y,MK(g,x+w,a),b*c+w,a);var S=MK(g,x+c,a);S<(1<<a)-1&&(_=!0),TK(v,S,1*b,a)}return{colorSpace:o,colorsPerPixel:s,sMaskBitsPerComponent:_?a:void 0,colorBytes:f,alphaBytes:m,needSMask:_}}(a):function(t){var e=t.data,n=1===t.channels?"DeviceGray":"DeviceRGB";return{colorSpace:n,colorsPerPixel:"DeviceGray"===n?1:3,colorBytes:e instanceof Uint16Array?function(t){for(var e=t.length,n=new Uint8Array(2*e),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0;r<e;r++)i.setUint16(2*r,t[r],!1);return n}(e):e,needSMask:!1}}(a);var h,d,p,f=r,m=f.colorSpace,g=f.colorsPerPixel,y=f.sMaskBitsPerComponent,v=f.colorBytes,_=f.alphaBytes,b=f.needSMask,x=f.palette,w=f.mask,S=null;return i!==aY.API.image_compression.NONE?(S=function(t){var e;switch(t){case aY.API.image_compression.FAST:e=11;break;case aY.API.image_compression.MEDIUM:e=13;break;case aY.API.image_compression.SLOW:e=14;break;default:e=12}return e}(i),h=this.decode.FLATE_DECODE,d="/Predictor ".concat(S," /Colors ").concat(g," /BitsPerComponent ").concat(u," /Columns ").concat(o),t=gK(v,Math.ceil(o*g*u/8),g,u,i),b&&(p=gK(_,Math.ceil(o*y/8),1,y,i))):(h=void 0,d=void 0,t=v,b&&(p=_)),(this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t))&&(t=this.__addimage__.arrayBufferToBinaryString(t)),(p&&this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),{alias:n,data:t,index:e,filter:h,decodeParameters:d,transparency:w,palette:x,sMask:p,predictor:S,width:o,height:s,bitsPerComponent:u,sMaskBitsPerComponent:y,colorSpace:m}}},function(t){t.processGIF89A=function(e,n,i,r){var a=new EK(e),o=a.width,s=a.height,l=[];a.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:o,height:s},u=new PK(100).encode(c,100);return t.processJPEG.call(this,u,n,i,r)},t.processGIF87A=t.processGIF89A}(aY.API),IK.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:r,green:i,blue:n,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},IK.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[t]()}catch(n){CX.log("bit decode error:"+n)}},IK.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),n=e%4;for(t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,r=0;r<e;r++)for(var a=this.datav.getUint8(this.pos++,!0),o=i*this.width*4+8*r*4,s=0;s<8&&8*r+s<this.width;s++){var l=this.palette[a>>7-s&1];this.data[o+4*s]=l.blue,this.data[o+4*s+1]=l.green,this.data[o+4*s+2]=l.red,this.data[o+4*s+3]=255}0!==n&&(this.pos+=4-n)}},IK.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,r=0;r<t;r++){var a=this.datav.getUint8(this.pos++,!0),o=i*this.width*4+2*r*4,s=a>>4,l=15&a,c=this.palette[s];if(this.data[o]=c.blue,this.data[o+1]=c.green,this.data[o+2]=c.red,this.data[o+3]=255,2*r+1>=this.width)break;c=this.palette[l],this.data[o+4]=c.blue,this.data[o+4+1]=c.green,this.data[o+4+2]=c.red,this.data[o+4+3]=255}0!==e&&(this.pos+=4-e)}},IK.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var r=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+4*i;if(r<this.palette.length){var o=this.palette[r];this.data[a]=o.red,this.data[a+1]=o.green,this.data[a+2]=o.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}0!==t&&(this.pos+=4-t)}},IK.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,r=0;r<this.width;r++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,s=(a>>5&e)/e*255|0,l=(a>>10&e)/e*255|0,c=a>>15?255:0,u=i*this.width*4+4*r;this.data[u]=l,this.data[u+1]=s,this.data[u+2]=o,this.data[u+3]=c}this.pos+=t}},IK.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),n=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&e)/e*255|0,l=(o>>5&n)/n*255|0,c=(o>>11)/e*255|0,u=r*this.width*4+4*a;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=s,this.data[u+3]=255}this.pos+=t}},IK.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*n;this.data[o]=a,this.data[o+1]=r,this.data[o+2]=i,this.data[o+3]=255}this.pos+=this.width%4}},IK.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;this.data[s]=a,this.data[s+1]=r,this.data[s+2]=i,this.data[s+3]=o}},IK.prototype.getData=function(){return this.data},function(t){t.processBMP=function(e,n,i,r){var a=new IK(e,!1),o=a.width,s=a.height,l={data:a.getData(),width:o,height:s},c=new PK(100).encode(l,100);return t.processJPEG.call(this,c,n,i,r)}}(aY.API),LK.prototype.getData=function(){return this.data},function(t){t.processWEBP=function(e,n,i,r){var a=new LK(e),o=a.width,s=a.height,l={data:a.getData(),width:o,height:s},c=new PK(100).encode(l,100);return t.processJPEG.call(this,c,n,i,r)}}(aY.API),aY.API.processRGBA=function(t,e,n){for(var i=t.data,r=i.length,a=new Uint8Array(r/4*3),o=new Uint8Array(r/4),s=0,l=0,c=0;c<r;c+=4){var u=i[c],h=i[c+1],d=i[c+2],p=i[c+3];a[s++]=u,a[s++]=h,a[s++]=d,o[l++]=p}var f=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:f,index:e,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},aY.API.setLanguage=function(t){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]&&(this.internal.languageSettings.languageCode=t,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},cK=aY.API,uK=cK.getCharWidthsArray=function(t,e){var n,i,r=(e=e||{}).font||this.internal.getFont(),a=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:r.metadata.Unicode.widths,l=s.fof?s.fof:1,c=e.kerning?e.kerning:r.metadata.Unicode.kerning,u=c.fof?c.fof:1,h=!1!==e.doKerning,d=0,p=t.length,f=0,m=s[0]||l,g=[];for(n=0;n<p;n++)i=t.charCodeAt(n),"function"==typeof r.metadata.widthOfString?g.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(i))+o*(1e3/a)||0)/1e3):(d=h&&"object"===(0,SD.A)(c[i])&&!isNaN(parseInt(c[i][f],10))?c[i][f]/u:0,g.push((s[i]||m)/l+d)),f=i;return g},hK=cK.getStringUnitWidth=function(t,e){var n=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),r=e.charSpace||this.internal.getCharSpace();return cK.processArabic&&(t=cK.processArabic(t)),"function"==typeof i.metadata.widthOfString?i.metadata.widthOfString(t,n,r)/n:uK.apply(this,arguments).reduce(function(t,e){return t+e},0)},dK=function(t,e,n,i){for(var r=[],a=0,o=t.length,s=0;a!==o&&s+e[a]<n;)s+=e[a],a++;r.push(t.slice(0,a));var l=a;for(s=0;a!==o;)s+e[a]>i&&(r.push(t.slice(l,a)),s=0,l=a),s+=e[a],a++;return l!==a&&r.push(t.slice(l,a)),r},pK=function(t,e,n){n||(n={});var i,r,a,o,s,l,c,u=[],h=[u],d=n.textIndent||0,p=0,f=0,m=t.split(" "),g=uK.apply(this,[" ",n])[0];if(l=-1===n.lineIndent?m[0].length+2:n.lineIndent||0){var y=Array(l).join(" "),v=[];m.map(function(t){(t=t.split(/\s*\n/)).length>1?v=v.concat(t.map(function(t,e){return(e&&t.length?"\n":"")+t})):v.push(t[0])}),m=v,l=hK.apply(this,[y,n])}for(a=0,o=m.length;a<o;a++){var _=0;if(i=m[a],l&&"\n"==i[0]&&(i=i.substr(1),_=1),d+p+(f=(r=uK.apply(this,[i,n])).reduce(function(t,e){return t+e},0))>e||_){if(f>e){for(s=dK.apply(this,[i,r,e-(d+p),e]),u.push(s.shift()),u=[s.pop()];s.length;)h.push([s.shift()]);f=r.slice(i.length-(u[0]?u[0].length:0)).reduce(function(t,e){return t+e},0)}else u=[i];h.push(u),d=f+l,p=g}else u.push(i),d+=p+f,p=g}return c=l?function(t,e){return(e?y:"")+t.join(" ")}:function(t){return t.join(" ")},h.map(c)},cK.splitTextToSize=function(t,e,n){var i,r=(n=n||{}).fontSize||this.internal.getFontSize(),a=function(t){if(t.widths&&t.kerning)return{widths:t.widths,kerning:t.kerning};var e=this.internal.getFont(t.fontName,t.fontStyle),n="Unicode";return e.metadata[n]?{widths:e.metadata[n].widths||{0:1},kerning:e.metadata[n].kerning||{}}:{font:e.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);i=Array.isArray(t)?t:String(t).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/r;a.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/r:0,a.lineIndent=n.lineIndent;var s,l,c=[];for(s=0,l=i.length;s<l;s++)c=c.concat(pK.apply(this,[i[s],o,a]));return c},function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="0123456789abcdef",n="klmnopqrstuvwxyz",i={},r={},a=0;a<16;a++)i[n[a]]=e[a],r[e[a]]=n[a];var o=function(t){return"0x"+parseInt(t,10).toString(16)},s=t.__fontmetrics__.compress=function(t){var e,n,i,a,l=["{"];for(var c in t){if(e=t[c],isNaN(parseInt(c,10))?n="'"+c+"'":(c=parseInt(c,10),n=(n=o(c).slice(2)).slice(0,-1)+r[n.slice(-1)]),"number"==typeof e)e<0?(i=o(e).slice(3),a="-"):(i=o(e).slice(2),a=""),i=a+i.slice(0,-1)+r[i.slice(-1)];else{if("object"!==(0,SD.A)(e))throw new Error("Don't know what to do with value type "+(0,SD.A)(e)+".");i=s(e)}l.push(n+i)}return l.push("}"),l.join("")},l=t.__fontmetrics__.uncompress=function(t){if("string"!=typeof t)throw new Error("Invalid argument passed to uncompress.");for(var e,n,r,a,o={},s=1,l=o,c=[],u="",h="",d=t.length-1,p=1;p<d;p+=1)"'"==(a=t[p])?e?(r=e.join(""),e=void 0):e=[]:e?e.push(a):"{"==a?(c.push([l,r]),l={},r=void 0):"}"==a?((n=c.pop())[0][n[1]]=l,r=void 0,l=n[0]):"-"==a?s=-1:void 0===r?i.hasOwnProperty(a)?(u+=i[a],r=parseInt(u,16)*s,s=1,u=""):u+=a:i.hasOwnProperty(a)?(h+=i[a],l[r]=parseInt(h,16)*s,s=1,r=void 0,h=""):h+=a;return o},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},h={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(t){var e=t.font,n=h.Unicode[e.postScriptName];n&&(e.metadata.Unicode={},e.metadata.Unicode.widths=n.widths,e.metadata.Unicode.kerning=n.kerning);var i=u.Unicode[e.postScriptName];i&&(e.metadata.Unicode.encoding=i,e.encoding=i.codePages[0])}])}(aY.API),function(t){var e=function(t){for(var e=t.length,n=new Uint8Array(e),i=0;i<e;i++)n[i]=t.charCodeAt(i);return n};t.API.events.push(["addFont",function(n){var i=void 0,r=n.font,a=n.instance;if(!r.isStandardFont){if(void 0===a)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if("string"!=typeof(i=!1===a.existsFileInVFS(r.postScriptName)?a.loadFile(r.postScriptName):a.getFileFromVFS(r.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");!function(n,i){i=/^\x00\x01\x00\x00/.test(i)?e(i):e(DX(i)),n.metadata=t.API.TTFFont.open(i),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(r,i)}}])}(aY),aY.API.addSvgAsImage=function(t,e,i,r,a,o,s,l){if(isNaN(e)||isNaN(i))throw CX.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(r)||isNaN(a))throw CX.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=r,c.height=a;var u=c.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},d=this;return(AX.canvg?Promise.resolve(AX.canvg):n.e(455).then(n.bind(n,8455))).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t}).then(function(e){return e.fromString(u,t,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(t){return t.render(h)}).then(function(){d.addImage(c.toDataURL("image/jpeg",1),e,i,r,a,s,l)})},aY.API.putTotalPages=function(t){var e,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),n=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var r=0;r<this.internal.pages[i].length;r++)this.internal.pages[i][r]=this.internal.pages[i][r].replace(e,n);return this},aY.API.viewerPreferences=function(t,e){var n;t=t||{},e=e||!1;var i,r,a,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(o),l=[],c=0,u=0,h=0;function d(t,e){var n,i=!1;for(n=0;n<t.length;n+=1)t[n]===e&&(i=!0);return i}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===t||!0===e){var p=s.length;for(h=0;h<p;h+=1)n[s[h]].value=n[s[h]].defaultValue,n[s[h]].explicitSet=!1}if("object"===(0,SD.A)(t))for(r in t)if(a=t[r],d(s,r)&&void 0!==a){if("boolean"===n[r].type&&"boolean"==typeof a)n[r].value=a;else if("name"===n[r].type&&d(n[r].valueSet,a))n[r].value=a;else if("integer"===n[r].type&&Number.isInteger(a))n[r].value=a;else if("array"===n[r].type){for(c=0;c<a.length;c+=1)if(i=!0,1===a[c].length&&"number"==typeof a[c][0])l.push(String(a[c]-1));else if(a[c].length>1){for(u=0;u<a[c].length;u+=1)"number"!=typeof a[c][u]&&(i=!1);!0===i&&l.push([a[c][0]-1,a[c][1]-1].join(" "))}n[r].value="["+l.join(" ")+"]"}else n[r].value=n[r].defaultValue;n[r].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var t,e=[];for(t in n)!0===n[t].explicitSet&&("name"===n[t].type?e.push("/"+t+" /"+n[t].value):e.push("/"+t+" "+n[t].value));0!==e.length&&this.internal.write("/ViewerPreferences\n<<\n"+e.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(t){var e=function(){var t='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',e=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(t)),i=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),r=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),a=unescape(encodeURIComponent("</x:xmpmeta>")),o=n.length+i.length+r.length+e.length+a.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+o+" >>"),this.internal.write("stream"),this.internal.write(e+n+i+r+a),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(t,i){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:t,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",e)),this}}(aY.API),function(t){var e=t.API,n=e.pdfEscape16=function(t,e){for(var n,i=e.metadata.Unicode.widths,r=["","0","00","000","0000"],a=[""],o=0,s=t.length;o<s;++o){if(n=e.metadata.characterToGlyph(t.charCodeAt(o)),e.metadata.glyIdsUsed.push(n),e.metadata.toUnicode[n]=t.charCodeAt(o),-1==i.indexOf(n)&&(i.push(n),i.push([parseInt(e.metadata.widthOfGlyph(n),10)])),"0"==n)return a.join("");n=n.toString(16),a.push(r[4-n.length],n)}return a.join("")},i=function(t){var e,n,i,r,a,o,s;for(a="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",i=[],o=0,s=(n=Object.keys(t).sort(function(t,e){return t-e})).length;o<s;o++)e=n[o],i.length>=100&&(a+="\n"+i.length+" beginbfchar\n"+i.join("\n")+"\nendbfchar",i=[]),void 0!==t[e]&&null!==t[e]&&"function"==typeof t[e].toString&&(r=("0000"+t[e].toString(16)).slice(-4),e=("0000"+(+e).toString(16)).slice(-4),i.push("<"+e+"><"+r+">"));return i.length&&(a+="\n"+i.length+" beginbfchar\n"+i.join("\n")+"\nendbfchar\n"),a+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};e.events.push(["putFont",function(e){!function(e){var n=e.font,r=e.out,a=e.newObject,o=e.putStream;if(n.metadata instanceof t.API.TTFFont&&"Identity-H"===n.encoding){for(var s=n.metadata.Unicode.widths,l=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),c="",u=0;u<l.length;u++)c+=String.fromCharCode(l[u]);var h=a();o({data:c,addLength1:!0,objectId:h}),r("endobj");var d=a();o({data:i(n.metadata.toUnicode),addLength1:!0,objectId:d}),r("endobj");var p=a();r("<<"),r("/Type /FontDescriptor"),r("/FontName /"+QX(n.fontName)),r("/FontFile2 "+h+" 0 R"),r("/FontBBox "+t.API.PDFObject.convert(n.metadata.bbox)),r("/Flags "+n.metadata.flags),r("/StemV "+n.metadata.stemV),r("/ItalicAngle "+n.metadata.italicAngle),r("/Ascent "+n.metadata.ascender),r("/Descent "+n.metadata.decender),r("/CapHeight "+n.metadata.capHeight),r(">>"),r("endobj");var f=a();r("<<"),r("/Type /Font"),r("/BaseFont /"+QX(n.fontName)),r("/FontDescriptor "+p+" 0 R"),r("/W "+t.API.PDFObject.convert(s)),r("/CIDToGIDMap /Identity"),r("/DW 1000"),r("/Subtype /CIDFontType2"),r("/CIDSystemInfo"),r("<<"),r("/Supplement 0"),r("/Registry (Adobe)"),r("/Ordering ("+n.encoding+")"),r(">>"),r(">>"),r("endobj"),n.objectNumber=a(),r("<<"),r("/Type /Font"),r("/Subtype /Type0"),r("/ToUnicode "+d+" 0 R"),r("/BaseFont /"+QX(n.fontName)),r("/Encoding /"+n.encoding),r("/DescendantFonts ["+f+" 0 R]"),r(">>"),r("endobj"),n.isAlreadyPutted=!0}}(e)}]),e.events.push(["putFont",function(e){!function(e){var n=e.font,r=e.out,a=e.newObject,o=e.putStream;if(n.metadata instanceof t.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var s=n.metadata.rawData,l="",c=0;c<s.length;c++)l+=String.fromCharCode(s[c]);var u=a();o({data:l,addLength1:!0,objectId:u}),r("endobj");var h=a();o({data:i(n.metadata.toUnicode),addLength1:!0,objectId:h}),r("endobj");var d=a();r("<<"),r("/Descent "+n.metadata.decender),r("/CapHeight "+n.metadata.capHeight),r("/StemV "+n.metadata.stemV),r("/Type /FontDescriptor"),r("/FontFile2 "+u+" 0 R"),r("/Flags 96"),r("/FontBBox "+t.API.PDFObject.convert(n.metadata.bbox)),r("/FontName /"+QX(n.fontName)),r("/ItalicAngle "+n.metadata.italicAngle),r("/Ascent "+n.metadata.ascender),r(">>"),r("endobj"),n.objectNumber=a();for(var p=0;p<n.metadata.hmtx.widths.length;p++)n.metadata.hmtx.widths[p]=parseInt(n.metadata.hmtx.widths[p]*(1e3/n.metadata.head.unitsPerEm));r("<</Subtype/TrueType/Type/Font/ToUnicode "+h+" 0 R/BaseFont/"+QX(n.fontName)+"/FontDescriptor "+d+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),r("endobj"),n.isAlreadyPutted=!0}}(e)}]);var r=function(t){var e,i=t.text||"",r=t.x,a=t.y,o=t.options||{},s=t.mutex||{},l=s.pdfEscape,c=s.activeFontKey,u=s.fonts,h=c,d="",p=0,f="",m=u[h].encoding;if("Identity-H"!==u[h].encoding)return{text:i,x:r,y:a,options:o,mutex:s};for(f=i,h=c,Array.isArray(i)&&(f=i[0]),p=0;p<f.length;p+=1)u[h].metadata.hasOwnProperty("cmap")&&(e=u[h].metadata.cmap.unicode.codeMap[f[p].charCodeAt(0)]),e||f[p].charCodeAt(0)<256&&u[h].metadata.hasOwnProperty("Unicode")?d+=f[p]:d+="";var g="";return parseInt(h.slice(1))<14||"WinAnsiEncoding"===m?g=l(d,h).split("").map(function(t){return t.charCodeAt(0).toString(16)}).join(""):"Identity-H"===m&&(g=n(d,u[h])),s.isHex=!0,{text:g,x:r,y:a,options:o,mutex:s}};e.events.push(["postProcessText",function(t){var e=t.text||"",n=[],i={text:e,x:t.x,y:t.y,options:t.options,mutex:t.mutex};if(Array.isArray(e)){var a=0;for(a=0;a<e.length;a+=1)Array.isArray(e[a])&&3===e[a].length?n.push([r(Object.assign({},i,{text:e[a][0]})).text,e[a][1],e[a][2]]):n.push(r(Object.assign({},i,{text:e[a]})).text);t.text=n}else t.text=r(Object.assign({},i,{text:e})).text}])}(aY),function(t){var e=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]},t.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},t.getFileFromVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]?this.internal.vFS[t]:null}}(aY.API),function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(t){var n,i,r,a,o,s,l,c=e,u=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],d={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},p={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},f=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],m=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,y=0;this.__bidiEngine__={};var v=function(t){var e=t.charCodeAt(),n=e>>8,i=p[n];return void 0!==i?c[256*i+(255&e)]:252===n||253===n?"AL":m.test(n)?"L":8===n?"R":"N"},_=function(t){for(var e,n=0;n<t.length;n++){if("L"===(e=v(t.charAt(n))))return!1;if("R"===e)return!0}return!1},b=function(t,e,o,s){var l,c,u,h,d=e[s];switch(d){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"N":case"AN":break;case"EN":g&&(d="AN");break;case"AL":g=!0,d="R";break;case"WS":case"BN":d="N";break;case"CS":s<1||s+1>=e.length||"EN"!==(l=o[s-1])&&"AN"!==l||"EN"!==(c=e[s+1])&&"AN"!==c?d="N":g&&(c="AN"),d=c===l?c:"N";break;case"ES":d="EN"===(l=s>0?o[s-1]:"B")&&s+1<e.length&&"EN"===e[s+1]?"EN":"N";break;case"ET":if(s>0&&"EN"===o[s-1]){d="EN";break}if(g){d="N";break}for(u=s+1,h=e.length;u<h&&"ET"===e[u];)u++;d=u<h&&"EN"===e[u]?"EN":"N";break;case"NSM":if(r&&!a){for(h=e.length,u=s+1;u<h&&"NSM"===e[u];)u++;if(u<h){var p=t[s],f=p>=1425&&p<=2303||64286===p;if(l=e[u],f&&("R"===l||"AL"===l)){d="R";break}}}d=s<1||"B"===(l=e[s-1])?"N":o[s-1];break;case"B":g=!1,n=!0,d=y;break;case"S":i=!0,d="N"}return d},x=function(t,e,n){var i=t.split("");return n&&w(i,n,{hiLevel:y}),i.reverse(),e&&e.reverse(),i.join("")},w=function(t,e,r){var a,o,s,l,c,p=-1,f=t.length,m=0,_=[],x=y?h:u,w=[];for(g=!1,n=!1,i=!1,o=0;o<f;o++)w[o]=v(t[o]);for(s=0;s<f;s++){if(c=m,_[s]=b(t,w,_,s),a=240&(m=x[c][d[_[s]]]),m&=15,e[s]=l=x[m][5],a>0)if(16===a){for(o=p;o<s;o++)e[o]=1;p=-1}else p=-1;if(x[m][6])-1===p&&(p=s);else if(p>-1){for(o=p;o<s;o++)e[o]=l;p=-1}"B"===w[s]&&(e[s]=0),r.hiLevel|=l}i&&function(t,e,n){for(var i=0;i<n;i++)if("S"===t[i]){e[i]=y;for(var r=i-1;r>=0&&"WS"===t[r];r--)e[r]=y}}(w,e,f)},S=function(t,e,i,r,a){if(!(a.hiLevel<t)){if(1===t&&1===y&&!n)return e.reverse(),void(i&&i.reverse());for(var o,s,l,c,u=e.length,h=0;h<u;){if(r[h]>=t){for(l=h+1;l<u&&r[l]>=t;)l++;for(c=h,s=l-1;c<s;c++,s--)o=e[c],e[c]=e[s],e[s]=o,i&&(o=i[c],i[c]=i[s],i[s]=o);h=l}h++}}},M=function(t,e,n){var i=t.split(""),r={hiLevel:y};return n||(n=[]),w(i,n,r),function(t,e,n){if(0!==n.hiLevel&&l)for(var i,r=0;r<t.length;r++)1===e[r]&&(i=f.indexOf(t[r]))>=0&&(t[r]=f[i+1])}(i,n,r),S(2,i,e,n,r),S(1,i,e,n,r),i.join("")};return this.__bidiEngine__.doBidiReorder=function(t,e,n){if(function(t,e){if(e)for(var n=0;n<t.length;n++)e[n]=n;void 0===a&&(a=_(t)),void 0===s&&(s=_(t))}(t,e),r||!o||s)if(r&&o&&a^s)y=a?1:0,t=x(t,e,n);else if(!r&&o&&s)y=a?1:0,t=M(t,e,n),t=x(t,e);else if(!r||a||o||s){if(r&&!o&&a^s)t=x(t,e),a?(y=0,t=M(t,e,n)):(y=1,t=M(t,e,n),t=x(t,e));else if(r&&a&&!o&&s)y=1,t=M(t,e,n),t=x(t,e);else if(!r&&!o&&a^s){var i=l;a?(y=1,t=M(t,e,n),y=0,l=!1,t=M(t,e,n),l=i):(y=0,t=M(t,e,n),t=x(t,e),y=1,l=!1,t=M(t,e,n),l=i,t=x(t,e))}}else y=0,t=M(t,e,n);else y=a?1:0,t=M(t,e,n);return t},this.__bidiEngine__.setOptions=function(t){t&&(r=t.isInputVisual,o=t.isOutputVisual,a=t.isInputRtl,s=t.isOutputRtl,l=t.isSymmetricSwapping)},this.__bidiEngine__.setOptions(t),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(t){var e=t.text;t.x,t.y;var i=t.options||{};t.mutex,i.lang;var r=[];if(i.isInputVisual="boolean"!=typeof i.isInputVisual||i.isInputVisual,n.setOptions(i),"[object Array]"===Object.prototype.toString.call(e)){var a=0;for(r=[],a=0;a<e.length;a+=1)"[object Array]"===Object.prototype.toString.call(e[a])?r.push([n.doBidiReorder(e[a][0]),e[a][1],e[a][2]]):r.push([n.doBidiReorder(e[a])]);t.text=r}else t.text=n.doBidiReorder(e);n.setOptions({isInputVisual:!0})}])}(aY),aY.API.TTFFont=function(){function t(t){var e;if(this.rawData=t,e=this.contents=new RK(t),this.contents.pos=4,"ttcf"===e.readString(4))throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new $K(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new DK(this.contents),this.head=new FK(this),this.name=new GK(this),this.cmap=new BK(this),this.toUnicode={},this.hhea=new UK(this),this.maxp=new WK(this),this.hmtx=new qK(this),this.post=new VK(this),this.os2=new jK(this),this.loca=new JK(this),this.glyf=new XK(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var t,e,n,i,r;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var e,n,i,r;for(r=[],e=0,n=(i=this.bbox).length;e<n;e++)t=i[e],r.push(Math.round(t*this.scaleFactor));return r}.call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(r=this.familyClass)||2===r||3===r||4===r||5===r||7===r,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(t){var e;return(null!=(e=this.cmap.unicode)?e.codeMap[t]:void 0)||0},t.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},t.prototype.widthOfString=function(t,e,n){var i,r,a,o;for(a=0,r=0,o=(t=""+t).length;0<=o?r<o:r>o;r=0<=o?++r:--r)i=t.charCodeAt(r),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/e)||0;return a*(e/1e3)},t.prototype.lineHeight=function(t,e){var n;return null==e&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},t}();var kK,RK=function(){function t(t){this.data=null!=t?t:[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(t){return this.data[this.pos++]=t},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},t.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},t.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},t.prototype.readString=function(t){var e,n;for(n=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},t.prototype.writeString=function(t){var e,n,i;for(i=[],e=0,n=t.length;0<=n?e<n:e>n;e=0<=n?++e:--e)i.push(this.writeByte(t.charCodeAt(e)));return i},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(t){return this.writeInt16(t)},t.prototype.readLongLong=function(){var t,e,n,i,r,a,o,s;return t=this.readByte(),e=this.readByte(),n=this.readByte(),i=this.readByte(),r=this.readByte(),a=this.readByte(),o=this.readByte(),s=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^r)+65536*(255^a)+256*(255^o)+(255^s)+1):72057594037927940*t+281474976710656*e+1099511627776*n+4294967296*i+16777216*r+65536*a+256*o+s},t.prototype.writeLongLong=function(t){var e,n;return e=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(t){return this.writeInt32(t)},t.prototype.read=function(t){var e,n;for(e=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)e.push(this.readByte());return e},t.prototype.write=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(this.writeByte(e));return r},t}(),DK=function(){var t;function e(t){var e,n,i;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,i=this.tableCount;0<=i?n<i:n>i;n=0<=i?++n:--n)e={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[e.tag]=e}return e.prototype.encode=function(e){var n,i,r,a,o,s,l,c,u,h,d,p,f;for(f in d=Object.keys(e).length,s=Math.log(2),u=16*Math.floor(Math.log(d)/s),a=Math.floor(u/s),c=16*d-u,(i=new RK).writeInt(this.scalarType),i.writeShort(d),i.writeShort(u),i.writeShort(a),i.writeShort(c),r=16*d,l=i.pos+r,o=null,p=[],e)for(h=e[f],i.writeString(f),i.writeInt(t(h)),i.writeInt(l),i.writeInt(h.length),p=p.concat(h),"head"===f&&(o=l),l+=h.length;l%4;)p.push(0),l++;return i.write(p),n=2981146554-t(i.data),i.pos=o+8,i.writeUInt32(n),i.data},t=function(t){var e,n,i,r;for(t=ZK.call(t);t.length%4;)t.push(0);for(i=new RK(t),n=0,e=0,r=t.length;e<r;e=e+=4)n+=i.readUInt32();return 4294967295&n},e}(),NK={}.hasOwnProperty,zK=function(t,e){for(var n in e)NK.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};kK=function(){function t(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}();var FK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="head",t.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},t.prototype.encode=function(t){var e;return(e=new RK).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(t),e.writeShort(this.glyphDataFormat),e.data},t}(),OK=function(){function t(t,e){var n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),u=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(s=0;s<256;++s)this.codeMap[s]=t.readByte();break;case 4:for(d=t.readUInt16(),h=d/2,t.pos+=6,r=function(){var e,n;for(n=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)n.push(t.readUInt16());return n}(),t.pos+=2,f=function(){var e,n;for(n=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)n.push(t.readUInt16());return n}(),l=function(){var e,n;for(n=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)n.push(t.readUInt16());return n}(),c=function(){var e,n;for(n=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)n.push(t.readUInt16());return n}(),i=(this.length-t.pos+this.offset)/2,o=function(){var e,n;for(n=[],s=e=0;0<=i?e<i:e>i;s=0<=i?++e:--e)n.push(t.readUInt16());return n}(),s=g=0,v=r.length;g<v;s=++g)for(m=r[s],n=y=p=f[s];p<=m?y<=m:y>=m;n=p<=m?++y:--y)0===c[s]?a=n+l[s]:0!==(a=o[c[s]/2+(n-p)-(h-s)]||0)&&(a+=l[s]),this.codeMap[n]=65535&a}t.pos=u}return t.encode=function(t,e){var n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,b,x,w,S,M,T,A,E,C,P,I,L,k,R,D,N,z,F,O,B,U,j,V,H,G,W,q,Z;switch(P=new RK,a=Object.keys(t).sort(function(t,e){return t-e}),e){case"macroman":for(f=0,m=function(){var t=[];for(p=0;p<256;++p)t.push(0);return t}(),y={0:0},r={},I=0,D=a.length;I<D;I++)null==y[G=t[i=a[I]]]&&(y[G]=++f),r[i]={old:t[i],new:y[t[i]]},m[i]=y[t[i]];return P.writeUInt16(1),P.writeUInt16(0),P.writeUInt32(12),P.writeUInt16(0),P.writeUInt16(262),P.writeUInt16(0),P.write(m),{charMap:r,subtable:P.data,maxGlyphID:f+1};case"unicode":for(E=[],u=[],v=0,y={},n={},g=l=null,L=0,N=a.length;L<N;L++)null==y[b=t[i=a[L]]]&&(y[b]=++v),n[i]={old:b,new:y[b]},o=y[b]-i,null!=g&&o===l||(g&&u.push(g),E.push(i),l=o),g=i;for(g&&u.push(g),u.push(65535),E.push(65535),T=2*(M=E.length),S=2*Math.pow(Math.log(M)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,w=2*M-S,s=[],x=[],d=[],p=k=0,z=E.length;k<z;p=++k){if(A=E[p],c=u[p],65535===A){s.push(0),x.push(0);break}if(A-(C=n[A].new)>=32768)for(s.push(0),x.push(2*(d.length+M-p)),i=R=A;A<=c?R<=c:R>=c;i=A<=c?++R:--R)d.push(n[i].new);else s.push(C-A),x.push(0)}for(P.writeUInt16(3),P.writeUInt16(1),P.writeUInt32(12),P.writeUInt16(4),P.writeUInt16(16+8*M+2*d.length),P.writeUInt16(0),P.writeUInt16(T),P.writeUInt16(S),P.writeUInt16(h),P.writeUInt16(w),V=0,F=u.length;V<F;V++)i=u[V],P.writeUInt16(i);for(P.writeUInt16(0),H=0,O=E.length;H<O;H++)i=E[H],P.writeUInt16(i);for(W=0,B=s.length;W<B;W++)o=s[W],P.writeUInt16(o);for(q=0,U=x.length;q<U;q++)_=x[q],P.writeUInt16(_);for(Z=0,j=d.length;Z<j;Z++)f=d[Z],P.writeUInt16(f);return{charMap:n,subtable:P.data,maxGlyphID:v+1}}},t}(),BK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="cmap",t.prototype.parse=function(t){var e,n,i;for(t.pos=this.offset,this.version=t.readUInt16(),i=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=i?n<i:n>i;n=0<=i?++n:--n)e=new OK(t,this.offset),this.tables.push(e),e.isUnicode&&null==this.unicode&&(this.unicode=e);return!0},t.encode=function(t,e){var n,i;return null==e&&(e="macroman"),n=OK.encode(t,e),(i=new RK).writeUInt16(0),i.writeUInt16(1),n.table=i.data.concat(n.subtable),n},t}(),UK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="hhea",t.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},t}(),jK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="OS/2",t.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var e,n;for(n=[],e=0;e<10;++e)n.push(t.readByte());return n}(),this.charRange=function(){var e,n;for(n=[],e=0;e<4;++e)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var e,n;for(n=[],e=0;e<2;e=++e)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},t}(),VK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="post",t.prototype.parse=function(t){var e,n,i;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var r;for(n=t.readUInt16(),this.glyphNameIndex=[],r=0;0<=n?r<n:r>n;r=0<=n?++r:--r)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],i=[];t.pos<this.offset+this.length;)e=t.readByte(),i.push(this.names.push(t.readString(e)));return i;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 262144:return this.map=function(){var e,n,i;for(i=[],r=e=0,n=this.file.maxp.numGlyphs;0<=n?e<n:e>n;r=0<=n?++e:--e)i.push(t.readUInt32());return i}.call(this)}},t}(),HK=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},GK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="name",t.prototype.parse=function(t){var e,n,i,r,a,o,s,l,c,u,h;for(t.pos=this.offset,t.readShort(),e=t.readShort(),o=t.readShort(),n=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+o+t.readShort()});for(s={},r=c=0,u=n.length;c<u;r=++c)i=n[r],t.pos=i.offset,l=t.readString(i.length),a=new HK(l,i),null==s[h=i.nameID]&&(s[h]=[]),s[i.nameID].push(a);this.strings=s,this.copyright=s[0],this.fontFamily=s[1],this.fontSubfamily=s[2],this.uniqueSubfamily=s[3],this.fontName=s[4],this.version=s[5];try{this.postscriptName=s[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(DX){this.postscriptName=s[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=s[7],this.manufacturer=s[8],this.designer=s[9],this.description=s[10],this.vendorUrl=s[11],this.designerUrl=s[12],this.license=s[13],this.licenseUrl=s[14],this.preferredFamily=s[15],this.preferredSubfamily=s[17],this.compatibleFull=s[18],this.sampleText=s[19]},t}(),WK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="maxp",t.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},t}(),qK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="hmtx",t.prototype.parse=function(t){var e,n,i,r,a,o,s;for(t.pos=this.offset,this.metrics=[],e=0,o=this.file.hhea.numberOfMetrics;0<=o?e<o:e>o;e=0<=o?++e:--e)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,r;for(r=[],e=n=0;0<=i?n<i:n>i;e=0<=i?++n:--n)r.push(t.readInt16());return r}(),this.widths=function(){var t,e,n,i;for(i=[],t=0,e=(n=this.metrics).length;t<e;t++)r=n[t],i.push(r.advance);return i}.call(this),n=this.widths[this.widths.length-1],s=[],e=a=0;0<=i?a<i:a>i;e=0<=i?++a:--a)s.push(this.widths.push(n));return s},t.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},t}(),ZK=[].slice,XK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(t){var e,n,i,r,a,o,s,l,c,u;return t in this.cache?this.cache[t]:(r=this.file.loca,e=this.file.contents,n=r.indexOf(t),0===(i=r.lengthOf(t))?this.cache[t]=null:(e.pos=this.offset+n,a=(o=new RK(e.read(i))).readShort(),l=o.readShort(),u=o.readShort(),s=o.readShort(),c=o.readShort(),this.cache[t]=-1===a?new KK(o,l,u,s,c):new YK(o,a,l,u,s,c),this.cache[t]))},t.prototype.encode=function(t,e,n){var i,r,a,o,s;for(a=[],r=[],o=0,s=e.length;o<s;o++)i=t[e[o]],r.push(a.length),i&&(a=a.concat(i.encode(n)));return r.push(a.length),{table:a,offsets:r}},t}(),YK=function(){function t(t,e,n,i,r,a){this.raw=t,this.numberOfContours=e,this.xMin=n,this.yMin=i,this.xMax=r,this.yMax=a,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),KK=function(){function t(t,e,n,i,r){var a,o;for(this.raw=t,this.xMin=e,this.yMin=n,this.xMax=i,this.yMax=r,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return t.prototype.encode=function(){var t,e,n;for(e=new RK(ZK.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)e.pos=this.glyphOffsets[t];return e.data},t}(),JK=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return zK(t,kK),t.prototype.tag="loca",t.prototype.parse=function(t){var e,n;return t.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=0===e?function(){var e,i;for(i=[],n=0,e=this.length;n<e;n+=2)i.push(2*t.readUInt16());return i}.call(this):function(){var e,i;for(i=[],n=0,e=this.length;n<e;n+=4)i.push(t.readUInt32());return i}.call(this)},t.prototype.indexOf=function(t){return this.offsets[t]},t.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},t.prototype.encode=function(t,e){for(var n=new Uint32Array(this.offsets.length),i=0,r=0,a=0;a<n.length;++a)if(n[a]=i,r<e.length&&e[r]==a){++r,n[a]=i;var o=this.offsets[a],s=this.offsets[a+1]-o;s>0&&(i+=s)}for(var l=new Array(4*n.length),c=0;c<n.length;++c)l[4*c+3]=255&n[c],l[4*c+2]=(65280&n[c])>>8,l[4*c+1]=(16711680&n[c])>>16,l[4*c]=(4278190080&n[c])>>24;return l},t}(),$K=function(){function t(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var t,e,n,i,r;for(e in i=this.font.cmap.tables[0].codeMap,t={},r=this.subset)n=r[e],t[e]=i[n];return t},t.prototype.glyphsFor=function(t){var e,n,i,r,a,o,s;for(i={},a=0,o=t.length;a<o;a++)i[r=t[a]]=this.font.glyf.glyphFor(r);for(r in e=[],i)(null!=(n=i[r])?n.compound:void 0)&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(r in s=this.glyphsFor(e))n=s[r],i[r]=n;return i},t.prototype.encode=function(t,e){var n,i,r,a,o,s,l,c,u,h,d,p,f,m,g;for(i in n=BK.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),d={0:0},g=n.charMap)d[(s=g[i]).old]=s.new;for(p in h=n.maxGlyphID,a)p in d||(d[p]=h++);return c=function(t){var e,n;for(e in n={},t)n[t[e]]=e;return n}(d),u=Object.keys(c).sort(function(t,e){return t-e}),f=function(){var t,e,n;for(n=[],t=0,e=u.length;t<e;t++)o=u[t],n.push(c[o]);return n}(),r=this.font.glyf.encode(a,f,d),l=this.font.loca.encode(r.offsets,f),m={cmap:this.font.cmap.raw(),glyf:r.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(m["OS/2"]=this.font.os2.raw()),this.font.directory.encode(m)},t}();aY.API.PDFObject=function(){var t;function e(){}return t=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},e.convert=function(n){var i,r,a,o;if(Array.isArray(n))return"["+function(){var t,r,a;for(a=[],t=0,r=n.length;t<r;t++)i=n[t],a.push(e.convert(i));return a}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+t(n.getUTCFullYear(),4)+t(n.getUTCMonth(),2)+t(n.getUTCDate(),2)+t(n.getUTCHours(),2)+t(n.getUTCMinutes(),2)+t(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(r in a=["<<"],n)o=n[r],a.push("/"+r+" "+e.convert(o));return a.push(">>"),a.join("\n")}return""+n},e}();const QK=function(){const{state:t}=Ot(),{impactData:e}=t,n=et(),r=()=>{n("/dashboard")},a=e?parseFloat(e.energy).toFixed(1):0,o=e?parseFloat(e.blastRadius).toFixed(1):0,s=e?(parseFloat(e.affectedPopulation.replace(/,/g,""))/1e3).toFixed(0):0,l=e?86.3:0;return(0,Rt.jsxs)("div",{className:"results",children:[(0,Rt.jsx)("section",{className:"results-header",children:(0,Rt.jsx)("div",{className:"container",children:(0,Rt.jsxs)("div",{className:"header-content",children:[(0,Rt.jsxs)("div",{className:"header-text",children:[(0,Rt.jsx)("h1",{className:"results-title",children:"Impact Results"}),(0,Rt.jsx)("p",{className:"results-subtitle",children:"Detailed impact simulation results for a 250m object at 19.3 km/s"}),(0,Rt.jsxs)("div",{className:"impact-location",children:[(0,Rt.jsx)("span",{className:"location-label",children:"Impact Location:"}),(0,Rt.jsx)("span",{className:"location-value",children:"Asteroid Ocean at FL 69,047 W"})]}),(0,Rt.jsxs)("div",{className:"action-buttons",children:[(0,Rt.jsx)("button",{className:"btn btn--primary",onClick:r,children:"\ud83d\udce5 New Simulation"}),(0,Rt.jsx)("button",{className:"btn btn--secondary",onClick:()=>{var t,n,i,r,a,o,s,l,c,u;if(!e)return void alert("No impact data available to download.");const h=new aY;let d=20;h.setFontSize(22),h.text("Asteroid Impact Report",105,d,null,null,"center"),d+=10,h.setFontSize(12),h.text("Date: ".concat((new Date).toLocaleDateString()),105,d,null,null,"center"),d+=20,h.setFontSize(16),h.text("Impact Parameters:",20,d),d+=10,h.setFontSize(12),h.text("Asteroid Diameter: ".concat(e.asteroidDiameter," km"),20,d),d+=7,h.text("Impact Energy: ".concat(e.energy," megatons TNT"),20,d),d+=7,h.text("Blast Radius: ".concat(e.blastRadius," km"),20,d),d+=7,h.text("Impact Location: Lat ".concat(null===(t=e.latitude)||void 0===t?void 0:t.toFixed(2),", Lng ").concat(null===(n=e.longitude)||void 0===n?void 0:n.toFixed(2)),20,d),d+=10,h.setFontSize(16),h.text("Population Impact:",20,d),d+=10,h.setFontSize(12),h.text("Affected Population: ".concat(e.affectedPopulation),20,d),d+=7,h.text("Casualties: ".concat(e.casualties),20,d),d+=7,h.text("Direct Impact: ".concat((null===(i=e.populationBreakdown)||void 0===i||null===(r=i.directImpact)||void 0===r?void 0:r.toLocaleString())||"N/A"),20,d),d+=7,h.text("Secondary Effects: ".concat((null===(a=e.populationBreakdown)||void 0===a||null===(o=a.secondary)||void 0===o?void 0:o.toLocaleString())||"N/A"),20,d),d+=7,h.text("Long Term Effects: ".concat((null===(s=e.populationBreakdown)||void 0===s||null===(l=s.longTerm)||void 0===l?void 0:l.toLocaleString())||"N/A"),20,d),d+=7,h.text("Total Affected: ".concat((null===(c=e.populationBreakdown)||void 0===c||null===(u=c.totalAffected)||void 0===u?void 0:u.toLocaleString())||"N/A"),20,d),d+=10,h.save("asteroid_impact_report.pdf")},children:"\ud83d\udcca Download Report"})]})]}),(0,Rt.jsx)("div",{className:"header-visual",children:(0,Rt.jsx)(i.Suspense,{fallback:(0,Rt.jsx)("div",{className:"loading-spinner"}),children:(0,Rt.jsx)(mH,{impactData:e})})})]})})}),(0,Rt.jsx)("section",{className:"metrics-section",children:(0,Rt.jsxs)("div",{className:"container",children:[(0,Rt.jsxs)("div",{className:"visualizations-row",children:[(0,Rt.jsx)(pH,{}),(0,Rt.jsx)(fH,{})]}),(0,Rt.jsxs)("div",{className:"new-metrics-visualizations-grid",children:[(0,Rt.jsx)(dH,{label:"Energy Released",value:a,unit:"Mt",color:"#00bcd4",maxValue:100}),(0,Rt.jsx)(dH,{label:"Blast Radius",value:o,unit:"km",color:"#9c27b0",maxValue:500}),(0,Rt.jsx)(dH,{label:"Population Affected",value:s,unit:"K",color:"#ff9800",maxValue:1e3}),(0,Rt.jsx)(dH,{label:"Tsunami Height",value:l,unit:"m",color:"#00bcd4",maxValue:100})]}),(0,Rt.jsx)("div",{className:"metrics-grid"})]})}),(0,Rt.jsx)("section",{className:"analysis-section",children:(0,Rt.jsx)("div",{className:"container",children:(0,Rt.jsxs)("div",{className:"analysis-grid",children:[(0,Rt.jsx)(uH,{}),(0,Rt.jsx)(hH,{})]})})}),(0,Rt.jsx)("section",{className:"new-simulation",children:(0,Rt.jsx)("div",{className:"container",children:(0,Rt.jsxs)("div",{className:"simulation-prompt",children:[(0,Rt.jsx)("h2",{children:"Ready to Run Another Simulation?"}),(0,Rt.jsx)("p",{children:"Customize asteroid parameters, impact location and more to see different scenarios and outcomes."}),(0,Rt.jsx)("button",{className:"btn btn--primary btn--large",onClick:r,children:"New Simulation \u2192"})]})})}),(0,Rt.jsx)("footer",{className:"results-footer",children:(0,Rt.jsxs)("div",{className:"container",children:[(0,Rt.jsxs)("div",{className:"footer-content",children:[(0,Rt.jsxs)("div",{className:"footer-logo",children:[(0,Rt.jsx)("div",{className:"logo-icon",children:(0,Rt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,Rt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,Rt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,Rt.jsxs)("div",{className:"footer-nav",children:[(0,Rt.jsx)("h4",{children:"Navigation"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/",children:"Home"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/story",children:"Story Mode"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/dashboard",children:"Simulation Dashboard"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"/results",children:"Impact Results"})})]})]}),(0,Rt.jsxs)("div",{className:"footer-sources",children:[(0,Rt.jsx)("h4",{children:"Data Sources"}),(0,Rt.jsxs)("ul",{children:[(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,Rt.jsx)("li",{children:(0,Rt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,Rt.jsxs)("div",{className:"footer-bottom",children:[(0,Rt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,Rt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})})]})},tJ="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=".concat("AIzaSyCU_3pVcZZOwqBh448m-G7NduL613sQ63M"),eJ=["What is the NASA Space Apps Challenge?","Tell me about the Artemis program.","What are the latest discoveries about Mars?","How can I join a 'Meteor Madness' team?","What happens when an asteroid impacts Earth?"],nJ=()=>{const{state:t}=Ot(),[e,n]=(0,i.useState)([{id:1,sender:"bot",text:"\ud83d\udc4b Hi! I\u2019m your NASA Space Apps Chatbot. Ask me anything about NASA, space, or the Space Apps Challenge! \n\n (I can also use Google Search to find current information!)\n\n*Note: Current simulation data is mocked for display purposes.*"}]),[r,a]=(0,i.useState)(""),[o,s]=(0,i.useState)(!1),[l,c]=(0,i.useState)(!0),u=(0,i.useRef)(null);(0,i.useEffect)(()=>{var t;null===(t=u.current)||void 0===t||t.scrollIntoView({behavior:"smooth"})},[e]);const h=()=>c(t=>!t),d=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const i=e||r.trim();if(!i||o)return;const l={sender:"user",text:i,id:Date.now()};n(t=>[...t,l]),e||a(""),s(!0);const c=(null===t||void 0===t?void 0:t.simulationParams)||{},u=(null===t||void 0===t?void 0:t.selectedAsteroid)||"N/A",h={contents:[{parts:[{text:i+"\n\n[SIMULATOR_CONTEXT]\nCurrent Threat Level: ".concat((null===t||void 0===t?void 0:t.threatLevel)||"Unknown","\nSelected Asteroid: ").concat(u,"\nImpact Location: ").concat(c.location||"N/A","\nDiameter: ").concat(c.diameter||"N/A"," meters\nVelocity: ").concat(c.velocity||"N/A"," km/s\nAngle: ").concat(c.angle||"N/A"," degrees\n[/SIMULATOR_CONTEXT]")}]}],systemInstruction:{parts:[{text:"\nYou are a friendly and helpful NASA Space Apps Chatbot, specialized in NASA, space, and asteroid simulation. \nYour primary focus is to answer questions based on the user's query.\n\nIMPORTANT: The user's query will be followed by a [SIMULATOR_CONTEXT] block containing the current simulation settings. If the user asks a question about the 'current threat level', 'diameter', 'velocity', 'angle', or 'impact location', you MUST use the data provided in the [SIMULATOR_CONTEXT] block for your answer, regardless of other knowledge.\n\nFor any question that is clearly unrelated to space, NASA, or the Space Apps Challenge, you must politely respond with: \n\"\u274c Sorry, I can only answer questions about NASA, Space, and NASA Space Apps Challenge. Try asking something like: 'What is the Space Apps Challenge?'\"\n"}]},tools:[{google_search:{}}]};try{var d,p,f,m,g,y,v;const t=await(async(t,e)=>{for(let n=0;n<3;n++)try{const i=await fetch(t,e);if(i.ok)return i.json();if(!(429===i.status&&n<2)){const t=await i.text();throw new Error("API error: ".concat(i.status," ").concat(i.statusText," - ").concat(t))}{const t=1e3*Math.pow(2,n)+500*Math.random();await new Promise(e=>setTimeout(e,t))}}catch(uA){if(2===n)throw console.error("Fetch failed after multiple retries:",uA),new Error("Could not connect to the service.");const e=1e3*Math.pow(2,n)+500*Math.random();await new Promise(t=>setTimeout(t,e))}})(tJ,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});let e=(null===t||void 0===t||null===(d=t.candidates)||void 0===d||null===(p=d[0])||void 0===p||null===(f=p.content)||void 0===f||null===(m=f.parts)||void 0===m||null===(g=m[0])||void 0===g?void 0:g.text)||"\u26a0\ufe0f No response text found. Please check the network connection.",i=[];const r=null===t||void 0===t||null===(y=t.candidates)||void 0===y||null===(v=y[0])||void 0===v?void 0:v.groundingMetadata;if(r&&r.groundingAttributions&&(i=r.groundingAttributions.map(t=>{var e,n;return{uri:null===(e=t.web)||void 0===e?void 0:e.uri,title:null===(n=t.web)||void 0===n?void 0:n.title}}).filter(t=>t.uri&&t.title)),i.length>0){const t=i.slice(0,3).map((t,e)=>"".concat(e+1,". [").concat(t.title.substring(0,50)).concat(t.title.length>50?"...":"","](").concat(t.uri,")")).join("\n");e+="\n\n---\n**Sources:**\n".concat(t)}const a=Date.now()+100;n(t=>[...t,{sender:"bot",text:"",id:a}]),(t=>{let e="",i=0;const r=setInterval(()=>{i<t.length?(e+=t.charAt(i),i++,n(t=>{const n=[...t],i=n.length-1;return n[i]&&"bot"===n[i].sender&&(n[i].text=e,n[i].isTyping=!0),n})):(clearInterval(r),s(!1),n(t=>{const e=[...t],n=e.length-1;return e[n]&&"bot"===e[n].sender&&delete e[n].isTyping,e}))},12)})(e)}catch(_){console.error(_),n(t=>[...t,{sender:"bot",text:"\u26a0\ufe0f Error: Could not fetch response. Please try again.",id:Date.now()+200}]),s(!1)}};return(0,Rt.jsx)(Rt.Fragment,{children:(0,Rt.jsxs)("div",{className:"chat-fixed-container",children:[(0,Rt.jsx)("button",{className:"chat-toggle-button ".concat(l?"open-icon":"closed-icon"),onClick:h,"aria-expanded":l,"aria-controls":"nasa-chatbot",children:(0,Rt.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,Rt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),(0,Rt.jsxs)("div",{id:"nasa-chatbot",className:"chat-wrapper ".concat(l?"open":"closed"),children:[(0,Rt.jsxs)("div",{className:"chat-header",children:[(0,Rt.jsxs)("div",{className:"chat-header-title",children:[(0,Rt.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,Rt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"NASA Space Apps Chatbot"]}),(0,Rt.jsx)("button",{className:"chat-close-button",onClick:h,"aria-label":"Close Chat",children:(0,Rt.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,Rt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Rt.jsxs)("div",{className:"chat-body",children:[e.map(t=>(0,Rt.jsx)("div",{className:"chat-message-row ".concat(t.sender),children:(0,Rt.jsxs)("div",{className:"chat-message-bubble ".concat(t.sender),children:[(0,Rt.jsx)("div",{dangerouslySetInnerHTML:{__html:t.text.replace(/\n/g,"<br/>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}}),t.isTyping&&(0,Rt.jsx)("span",{className:"typing-cursor"})]})},t.id)),o&&(0,Rt.jsx)("div",{className:"chat-message-row bot",children:(0,Rt.jsx)("div",{className:"chat-message-bubble bot loading",children:(0,Rt.jsx)("span",{className:"animate-pulse",children:"\ud83e\udd14Thinking..."})})}),(0,Rt.jsx)("div",{ref:u})]}),(0,Rt.jsxs)("div",{className:"chat-input-area",children:[(0,Rt.jsx)("div",{className:"quick-questions",children:eJ.map((t,e)=>(0,Rt.jsx)("button",{onClick:()=>d(t),disabled:o,className:"quick-question-button",title:t,children:t.length>30?t.substring(0,27)+"...":t},e))}),(0,Rt.jsxs)("div",{className:"chat-input-group",children:[(0,Rt.jsx)("input",{type:"text",value:r,placeholder:"Ask about NASA, space, or Space Apps...",onChange:t=>a(t.target.value),onKeyDown:t=>"Enter"===t.key&&d(),disabled:o,className:"chat-input"}),(0,Rt.jsx)("button",{onClick:()=>d(),disabled:o||""===r.trim(),className:"chat-send-button",children:(0,Rt.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,Rt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]})]})]})})};const iJ=function(){return(0,i.useEffect)(()=>{document.documentElement.classList.add("dark-mode"),document.documentElement.classList.remove("light-mode")},[]),(0,Rt.jsx)(Ft,{children:(0,Rt.jsx)(Mt,{future:{v7_relativeSplatPath:!0,v7_fetcherPersist:!0,v7_normalizeFormMethod:!0},children:(0,Rt.jsxs)("div",{className:"App",children:[(0,Rt.jsx)(Bt,{}),(0,Rt.jsxs)(vt,{children:[(0,Rt.jsx)(gt,{path:"/",element:(0,Rt.jsx)(OA,{})}),(0,Rt.jsx)(gt,{path:"/story",element:(0,Rt.jsx)(BA,{})}),(0,Rt.jsx)(gt,{path:"/dashboard",element:(0,Rt.jsx)(cH,{})}),(0,Rt.jsx)(gt,{path:"/results",element:(0,Rt.jsx)(QK,{})})]}),(0,Rt.jsx)(nJ,{})]})})})};a.createRoot(document.getElementById("root")).render((0,Rt.jsx)(i.StrictMode,{children:(0,Rt.jsx)(Ft,{children:(0,Rt.jsx)(iJ,{})})}))})()})();
//# sourceMappingURL=main.89441ae9.js.map